<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Ubuntu20.04中安装flameshot截屏工具</title>
      <link href="/2020/08/02/Ubuntu20-04%E4%B8%AD%E5%AE%89%E8%A3%85flameshot%E6%88%AA%E5%B1%8F%E5%B7%A5%E5%85%B7/"/>
      <url>/2020/08/02/Ubuntu20-04%E4%B8%AD%E5%AE%89%E8%A3%85flameshot%E6%88%AA%E5%B1%8F%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><p>截图工具，可添加文字、箭头等</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>在软件商店里有，直接搜索软件名<code>flameshot</code>安装就行</p><h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="/images/2020/08/20200802125316.png" alt></p><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><table><thead><tr><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td>←、↓、↑、→</td><td>移动选择区域 1px</td></tr><tr><td>Shift + ←、↓、↑、→</td><td>将选择区域大小更改 1px</td></tr><tr><td>Esc</td><td>退出截图</td></tr><tr><td>Ctrl + C</td><td>复制到粘贴板</td></tr><tr><td>Ctrl + S</td><td>将选择区域保存为文件</td></tr><tr><td>Ctrl + Z</td><td>撤销最近的一次操作</td></tr><tr><td>鼠标右键</td><td>展示颜色拾取器</td></tr><tr><td>鼠标滚轮</td><td>改变工具的宽度</td></tr></tbody></table><p>边按住 Shift 键并拖动选择区域的其中一个控制点将会对它相反方向的控制点做类似的拖放操作。</p><h2 id="Flameshot-命令行选项"><a href="#Flameshot-命令行选项" class="headerlink" title="Flameshot 命令行选项"></a>Flameshot 命令行选项</h2><p>Flameshot 支持一系列的命令行选项来延时截图和保存图片到自定义的路径。</p><p>要使用 Flameshot GUI 模式，运行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flameshot gui</span><br></pre></td></tr></table></figure><p>要使用 GUI 模式截屏并将你选取的区域保存到一个自定义的路径，运行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flameshot gui -p ~/myStuff/captures</span><br></pre></td></tr></table></figure><p>要延时 2 秒后打开 GUI 模式可以使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flameshot gui -d 2000</span><br></pre></td></tr></table></figure><p>要延时 2 秒并将截图保存到一个自定义的路径（无 GUI）可以使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flameshot full -p ~/myStuff/captures -d 2000</span><br></pre></td></tr></table></figure><p>要截图全屏并保存到自定义的路径和粘贴板中使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flameshot full -c -p ~/myStuff/captures</span><br></pre></td></tr></table></figure><p>要在截屏中包含鼠标并将图片保存为 PNG 格式可以使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flameshot screen -r</span><br></pre></td></tr></table></figure><p>要对屏幕 1 进行截屏并将截屏复制到粘贴板中可以运行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flameshot screen -n 1 -c</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.jianshu.com/p/20fc667279ea" target="_blank" rel="noopener">Linux中的截图工具 - Flameshot</a><br><a href="https://www.sinocalife.com/ubuntu-20-04-screenshot-trident-tools-gnome-screenshot-flameshot-shutter" target="_blank" rel="noopener">Ubuntu 20.04 截图软件的使用 (gnome-screenshot、flameshot、shutter 截图编辑三叉戟)</a></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu刷新DNS</title>
      <link href="/2020/07/31/Ubuntu%E5%88%B7%E6%96%B0DNS/"/>
      <url>/2020/07/31/Ubuntu%E5%88%B7%E6%96%B0DNS/</url>
      
        <content type="html"><![CDATA[<h1 id="方式一-刷新DNS"><a href="#方式一-刷新DNS" class="headerlink" title="方式一:刷新DNS"></a>方式一:刷新DNS</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/nscd restart</span><br></pre></td></tr></table></figure><p>如果发现提示命令找不到：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo: /etc/init.d/nscd: <span class="built_in">command</span> not found</span><br></pre></td></tr></table></figure><p>需要先安装nscd包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nscd</span><br></pre></td></tr></table></figure><h1 id="方式二-重启网络刷dns"><a href="#方式二-重启网络刷dns" class="headerlink" title="方式二:重启网络刷dns"></a>方式二:重启网络刷dns</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/networking restart</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>循环冗余校验（CRC）算法</title>
      <link href="/2020/07/28/%E5%BE%AA%E7%8E%AF%E5%86%97%E4%BD%99%E6%A0%A1%E9%AA%8C%EF%BC%88CRC%EF%BC%89%E7%AE%97%E6%B3%95/"/>
      <url>/2020/07/28/%E5%BE%AA%E7%8E%AF%E5%86%97%E4%BD%99%E6%A0%A1%E9%AA%8C%EF%BC%88CRC%EF%BC%89%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol><li><a href="https://www.zhihu.com/question/20303082/answer/158430490" target="_blank" rel="noopener">知乎:https://www.zhihu.com/question/20303082/answer/158430490 – 作者：红猴子</a></li><li><a href="https://blog.csdn.net/liyuanbhu/article/details/7882789" target="_blank" rel="noopener">循环冗余校验（CRC）算法入门引导</a></li></ol><h1 id="从奇偶校验说起"><a href="#从奇偶校验说起" class="headerlink" title="从奇偶校验说起"></a>从奇偶校验说起</h1><p>所谓通讯过程的校验是指在通讯数据后加上一些附加信息，通过这些附加信息来判断接收到的数据是否和发送出的数据相同。比如说RS232串行通讯可以设置奇偶校验位，所谓奇偶校验就是在发送的每一个字节后都加上一位，使得每个字节中1的个数为奇数个或偶数个。比如我们要发送的字节是0x1a，二进制表示为0001 1010。</p><p>采用奇校验，则在数据后补上个0，数据变为0001 1010 0，数据中1的个数为奇数个（3个）</p><p>采用偶校验，则在数据后补上个1，数据变为0001 1010 1，数据中1的个数为偶数个（4个）</p><p>接收方通过计算数据中1个数是否满足奇偶性来确定数据是否有错。</p><p>奇偶校验的缺点也很明显，首先，它对错误的检测概率大约只有50%。也就是只有一半的错误它能够检测出来。另外，每传输一个字节都要附加一位校验位，对传输效率的影响很大。因此，在高速数据通讯中很少采用奇偶校验。奇偶校验优点也很明显，它很简单，因此可以用硬件来实现，这样可以减少软件的负担。因此，奇偶校验也被广泛的应用着。</p><p>奇偶校验就先介绍到这来，之所以从奇偶校验说起，是因为这种校验方式最简单，而且后面将会知道奇偶校验其实就是CRC 校验的一种(CRC-1)。</p><h1 id="累加和校验"><a href="#累加和校验" class="headerlink" title="累加和校验"></a>累加和校验</h1><p>另一种常见的校验方式是累加和校验。所谓累加和校验实现方式有很多种，最常用的一种是在一次通讯数据包的最后加入一个字节的校验数据。这个字节内容为前面数据包中全部数据的忽略进位的按字节累加和。比如下面的例子：</p><p>我们要传输的信息为： 6、23、4</p><p>加上校验和后的数据包：6、23、4、33</p><p>这里 33 为前三个字节的校验和。接收方收到全部数据后对前三个数据进行同样的累加计算，如果累加和与最后一个字节相同的话就认为传输的数据没有错误。</p><p>累加和校验由于实现起来非常简单，也被广泛的采用。但是这种校验方式的检错能力也比较一般，对于单字节的校验和大概有1/256 的概率将原本是错误的通讯数据误判为正确数据。之所以这里介绍这种校验，是因为CRC校验在传输数据的形式上与累加和校验是相同的，都可以表示为：通讯数据 校验字节（也可能是多个字节）</p><h1 id="CRC-Cyclic-Redundancy-算法"><a href="#CRC-Cyclic-Redundancy-算法" class="headerlink" title="CRC(Cyclic Redundancy )算法"></a>CRC(Cyclic Redundancy )算法</h1><p>CRC 算法的基本思想是将传输的数据当做一个位数很长的数。将这个数除以另一个数。得到的余数作为校验数据附加到原数据后面<br><img src="/images/2020/07/20200727006.png" alt></p><h2 id="发送端计算CRC的过程"><a href="#发送端计算CRC的过程" class="headerlink" title="发送端计算CRC的过程"></a>发送端计算CRC的过程</h2><ul><li>为什么添加4个0后面说明</li><li>什么是生成多项式后面说明</li><li>为什么是XOR后面说明</li></ul><p><img src="/images/2020/07/20200727002.png" alt></p><h2 id="验证码串是否正确"><a href="#验证码串是否正确" class="headerlink" title="验证码串是否正确"></a>验证码串是否正确</h2><p><img src="/images/2020/07/20200727004.png" alt></p><h1 id="生成多项式"><a href="#生成多项式" class="headerlink" title="生成多项式"></a>生成多项式</h1><p>比如说我们有两个二进制数，分别为：1101 和1011。</p><p>1101 与如下的多项式相联系：<br><img src="/images/2020/07/20200727008.png" alt></p><p>1011与如下的多项式相联系：<br><img src="/images/2020/07/20200727009.png" alt></p><p>两个多项式的乘法：<br><img src="/images/2020/07/20200727007.png" alt></p><p>得到结果后，<strong>合并同类项时采用模2运算</strong>。也就是说乘除法采用正常的多项式乘除法，而加减法都采用模2运算。所谓模2运算就是结果除以2后取余数。比如3 mod 2 = 1。<br>因此，上面最终得到的多项式为：<br><img src="/images/2020/07/20200727010.png" alt><br>对应的二进制数:111111 (注意:这里理论上要有7个1,但这里只写了6个1,去掉的是最高位的1,原因在后面会说明)</p><p>加减法采用模2运算后其实就成了一种运算了，就是我们通常所说的异或运算：</p><table><thead><tr><th>异或加法</th><th>异或减法</th></tr></thead><tbody><tr><td>0+0=0</td><td>0-0=0</td></tr><tr><td>0+1=1</td><td>1-0=1</td></tr><tr><td>1+0=1</td><td>0-1=1</td></tr><tr><td>1+1=0</td><td>1-1=0</td></tr></tbody></table><p>采用了模2的加减法后，不需要考虑借位的问题，所以除法变简单了。最后得到的余数就是CRC 校验字。为了进行CRC运算，也就是这种特殊的除法运算，必须要指定个被除数，在CRC算法中，这个被除数有一个专有名称叫做“生成多项式”。生成多项式的选取是个很有难度的问题，如果选的不好，那么检出错误的概率就会低很多。好在这个问题已经被专家们研究了很长一段时间了，对于我们这些使用者来说，只要把现成的成果拿来用就行了。</p><p>最常用的几种生成多项式如下：<br><img src="/images/2020/07/20200727005.png" alt></p><h2 id="什么是位宽"><a href="#什么是位宽" class="headerlink" title="什么是位宽"></a>什么是位宽</h2><p>文献中提到的生成多项式经常会说到多项式的位宽（Width，简记为W），这个<strong>位宽不是多项式对应的二进制数的位数，而是位数减1</strong>。</p><p>比如CRC8中用到的位宽为8的生成多项式，其实对应得二进制数有九位：100110001。另外一点，多项式表示和二进制表示都很繁琐，交流起来不方便，因此，文献中多用16进制简写法来表示，因为生成多项式的最高位肯定为1，最高位的位置由位宽可知，<strong>故在简记式中，将最高的1统一去掉了</strong>，如CRC32的生成多项式简记为04C11DB7实际上表示的是104C11DB7。当然，这样简记除了方便外，在编程计算时也有它的用处。</p><h2 id="为什么理论上有7个1但只写了6个"><a href="#为什么理论上有7个1但只写了6个" class="headerlink" title="为什么理论上有7个1但只写了6个"></a>为什么理论上有7个1但只写了6个</h2><ul><li>对于<strong>对应的二进制数:111111 (注意:这里理论上要有7个1,但这里只写了6个1,去掉的是最高位的1,原因在后面会说明)</strong>的例子，是将最高的1统一去掉了</li></ul><h2 id="为什么需要补4个0"><a href="#为什么需要补4个0" class="headerlink" title="为什么需要补4个0"></a>为什么需要补4个0</h2><ul><li>对于<strong>发送端计算CRC的过程</strong>的例子，除数是5位数10011，也就是位宽为4（W=4），按照CRC算法的要求，计算前要在原始数据后填上W个0，也就是4个0。</li></ul><h2 id="奇偶校验与生成多项式的关系"><a href="#奇偶校验与生成多项式的关系" class="headerlink" title="奇偶校验与生成多项式的关系"></a>奇偶校验与生成多项式的关系</h2><p>位宽W=1的生成多项式(CRC1)有两种，分别是X^1和X^1+X^0，读者可以自己证明10 对应的就是奇偶校验中的奇校验，而11对应则是偶校验。因此，写到这里我们知道了奇偶校验其实就是CRC校验的一种特例，这也是我要以奇偶校验作为开篇介绍的原因了。</p>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu中Rime输入法的安装和配置</title>
      <link href="/2020/07/26/ubuntu%E4%B8%ADRime%E8%BE%93%E5%85%A5%E6%B3%95%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/"/>
      <url>/2020/07/26/ubuntu%E4%B8%ADRime%E8%BE%93%E5%85%A5%E6%B3%95%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="官方网站及文档"><a href="#官方网站及文档" class="headerlink" title="官方网站及文档"></a>官方网站及文档</h1><p><a href="https://rime.im/" target="_blank" rel="noopener">https://rime.im/</a></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ol><li><p>安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ibus-rime</span><br></pre></td></tr></table></figure></li><li><p>添加Rime输入法<br><img src="/images/2020/07/20200724004.png" alt></p></li></ol><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><ul><li>Rime的配置是没有界面的</li><li>根据个人喜好修改配置文件：一般用户直接修改<code>default.yaml</code>即可。修改前最好备份一下<ul><li>网上有很多高端教程要大家创建<code>default.custom.yaml</code>，是因为rime升级的时候貌似会进行覆盖操作</li><li>但我实践中还是认为找个地方记下来才靠谱，这种基础配置，除非系统爆炸，否则不会再打开第二次的。增加<code>default.custom.yaml</code>，以后看到反而更容易出现混乱。</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.config/ibus/rime/default.yaml</span><br></pre></td></tr></table></figure><p>如下修改</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">schema_list:</span>   </span><br><span class="line"><span class="attr">  - schema:</span> <span class="string">luna_pinyin_simp</span> <span class="comment">#simp是简体，第一位是默认输入法 </span></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line"><span class="attr">  page_size:</span> <span class="number">7</span> <span class="comment">#每页候选词个数</span></span><br><span class="line"><span class="attr">ascii_composer:</span></span><br><span class="line"><span class="attr">  switch_key:</span></span><br><span class="line"><span class="attr">    Shift_L:</span> <span class="string">commit_code</span> <span class="comment">#左shift提交字母</span></span><br></pre></td></tr></table></figure><p>修改完之后重启</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ibus restart</span><br></pre></td></tr></table></figure><h1 id="修改候选字的大小"><a href="#修改候选字的大小" class="headerlink" title="修改候选字的大小"></a>修改候选字的大小</h1><ul><li>安装gnome的插件<code>ibus font setting</code></li><li>地址：<a href="https://extensions.gnome.org/extension/1121/ibus-font-setting/" target="_blank" rel="noopener">https://extensions.gnome.org/extension/1121/ibus-font-setting/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu18.04中ibus-Sunpinyin的安装与设置</title>
      <link href="/2020/07/26/Ubuntu18.04%E4%B8%ADibus-sunpinyin%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E8%AE%BE%E7%BD%AE/"/>
      <url>/2020/07/26/Ubuntu18.04%E4%B8%ADibus-sunpinyin%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E8%AE%BE%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ibus-sunpinyin</span><br></pre></td></tr></table></figure><h1 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h1><ol><li>配置<br>终端输入<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ibus-setup</span><br></pre></td></tr></table></figure></li></ol><p><img src="/images/2020/07/20200726002.png" alt></p><ol start="2"><li>在设置中添加sun-pinyin输入法<br><img src="/images/2020/07/20200726001.png" alt></li></ol><h1 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h1><p><img src="/images/2020/07/20200726004.png" alt></p><h2 id="有可能打不开-问题如下"><a href="#有可能打不开-问题如下" class="headerlink" title="有可能打不开(问题如下)"></a>有可能打不开(问题如下)</h2><ol><li>ubuntu18.04安装了ibus-pinyin, 选用了sunpinyin，但是无法调出sunpinyin的设置窗口。</li><li>当通过命令/usr/lib/ibus/ibus-setup-sunpinyin时，出现如下错误：</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/usr/share//ibus-sunpinyin/setup/main.py"</span>, line <span class="number">42</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">import</span> ibus</span><br><span class="line">ImportError: No module named ibus</span><br></pre></td></tr></table></figure><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>需要安装python-ibus，到 <a href="https://launchpad.net/ubuntu/trusty/amd64/python-ibus/1.5.5-1ubuntu3.2" target="_blank" rel="noopener">https://launchpad.net/ubuntu/trusty/amd64/python-ibus/1.5.5-1ubuntu3.2</a> 下载<code>python-ibus_1.5.5-1ubuntu3.2_all.deb</code>安装包，通过命令安装即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo gdebi python-ibus_1.5.5-1ubuntu3.2_all.deb</span><br><span class="line"></span><br><span class="line"><span class="comment">#   如果没有gdebi命令,用如下命令安装</span></span><br><span class="line">sudo apt-get install gdebi</span><br></pre></td></tr></table></figure><h1 id="修改候选字的大小"><a href="#修改候选字的大小" class="headerlink" title="修改候选字的大小"></a>修改候选字的大小</h1><ul><li>安装gnome的插件<code>ibus font setting</code></li><li>地址：<a href="https://extensions.gnome.org/extension/1121/ibus-font-setting/" target="_blank" rel="noopener">https://extensions.gnome.org/extension/1121/ibus-font-setting/</a></li></ul><h1 id="如果配置没有生效"><a href="#如果配置没有生效" class="headerlink" title="如果配置没有生效"></a>如果配置没有生效</h1><ol><li><p>遇事不决先重启</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ibus restart</span><br></pre></td></tr></table></figure></li><li><p>注销系统重新登录</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu设置开机自动加/挂载硬盘</title>
      <link href="/2020/07/25/Ubuntu%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E5%8A%A0-%E6%8C%82%E8%BD%BD%E7%A1%AC%E7%9B%98/"/>
      <url>/2020/07/25/Ubuntu%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E5%8A%A0-%E6%8C%82%E8%BD%BD%E7%A1%AC%E7%9B%98/</url>
      
        <content type="html"><![CDATA[<h1 id="找到要挂载的磁盘的名称"><a href="#找到要挂载的磁盘的名称" class="headerlink" title="找到要挂载的磁盘的名称"></a>找到要挂载的磁盘的名称</h1><p><img src="/images/2020/07/20200724001.png" alt></p><h1 id="查看磁盘的分区UUID"><a href="#查看磁盘的分区UUID" class="headerlink" title="查看磁盘的分区UUID"></a>查看磁盘的分区UUID</h1><ol><li>新打开一个终端：sudo blkid </li><li>找到分区的UUID与tpye<br><img src="/images/2020/07/20200724003.png" alt></li></ol><h1 id="在-etc-fstab中添加"><a href="#在-etc-fstab中添加" class="headerlink" title="在/etc/fstab中添加"></a>在/etc/fstab中添加</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/fstab: static file system information.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Use 'blkid' to print the universally unique identifier for a</span></span><br><span class="line"><span class="comment"># device; this may be used with UUID= as a more robust way to name devices</span></span><br><span class="line"><span class="comment"># that works even if disks are added and removed. See fstab(5).</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># &lt;file system&gt; &lt;mount point&gt;   &lt;type&gt;  &lt;options&gt;       &lt;dump&gt;  &lt;pass&gt;</span></span><br><span class="line"><span class="comment"># # &lt;file system&gt; 磁盘设备名或该设备的Label</span></span><br><span class="line"><span class="comment"># # &lt;mount point&gt; 挂载点（目录）</span></span><br><span class="line"><span class="comment"># # &lt;type&gt; 磁盘分区的文件系统</span></span><br><span class="line"><span class="comment"># # &lt;options&gt; 文件系统参数</span></span><br><span class="line"><span class="comment"># # &lt;dump&gt; 能否被dump命令作用</span></span><br><span class="line"><span class="comment"># # &lt;pass&gt; 是否以fsck检测扇区</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># / was on /dev/nvme0n1p5 during installation</span></span><br><span class="line">UUID=81ae4ddb-7784-45bf-b770-47cb89c85aca /               ext4    errors=remount-ro 0       1</span><br><span class="line"><span class="comment"># /boot/efi was on /dev/nvme0n1p1 during installation</span></span><br><span class="line">UUID=3024-823F  /boot/efi       vfat    <span class="built_in">umask</span>=0077      0       1</span><br><span class="line"><span class="comment"># swap was on /dev/nvme0n1p6 during installation</span></span><br><span class="line">UUID=7b9777a0-d735-4c9e-b6ba-109ffce567c2 none            swap    sw              0       0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制前面的</span></span><br><span class="line"><span class="comment"># UUID=81ae4ddb-7784-45bf-b770-47cb89c85aca /               ext4    errors=remount-ro 0       1</span></span><br><span class="line"><span class="comment"># 将UUID改为前面得到的UUID</span></span><br><span class="line"><span class="comment"># 把/改为/media/zjc/otherDocuments</span></span><br><span class="line"><span class="comment"># 把errors=remount-ro改为defaults</span></span><br><span class="line"><span class="comment"># 后面的1改0</span></span><br><span class="line">UUID=EC9CB4199CB3DBF0 /media/zjc/otherDocuments               ntfs    defaults 0       1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu18.04如何固定图标到任务栏</title>
      <link href="/2020/07/18/Ubuntu18-04%E5%A6%82%E4%BD%95%E5%9B%BA%E5%AE%9A%E5%9B%BE%E6%A0%87%E5%88%B0%E4%BB%BB%E5%8A%A1%E6%A0%8F/"/>
      <url>/2020/07/18/Ubuntu18-04%E5%A6%82%E4%BD%95%E5%9B%BA%E5%AE%9A%E5%9B%BE%E6%A0%87%E5%88%B0%E4%BB%BB%E5%8A%A1%E6%A0%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="添加图标"><a href="#添加图标" class="headerlink" title="添加图标"></a>添加图标</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /usr/share/applications/softName.desktop</span><br><span class="line">或者</span><br><span class="line">sudo vim ~/.local/share/applications/softName.desktop</span><br></pre></td></tr></table></figure><ul><li>softName就是添加快捷方式的名称，也就是软件的名称</li></ul><p>添加如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Desktop Entry]</span><br><span class="line">#!/usr/bin/env xdg-open</span><br><span class="line">[Desktop Entry]</span><br><span class="line">Version=1.0</span><br><span class="line">Terminal=false</span><br><span class="line">Type=Application</span><br><span class="line">Name=</span><br><span class="line">Exec=</span><br><span class="line">Icon=</span><br><span class="line">NoDisplay=false</span><br><span class="line">StartupWMClass=</span><br></pre></td></tr></table></figure><p><img src="/images/2020/07/20200701006.png" alt></p><p>说明</p><ul><li>[Desktop Entry] 每个desktop文件都以这个标签开始，说明这是一个Desktop Entry文件</li><li>Version = 1.0 标明Desktop Entry的版本（可选）</li><li>Name = IdeaIU 程序名称（必须），这里以创建一个idea的快捷方式为例</li><li>GenericName = IdeaIU 程序通用名称（可选）</li><li>Comment =IdeaIU 程序描述（可选）</li><li>Exec = 程序的启动命令（必选），可以带参数运行</li><li>Icon = 设置快捷方式的图标（可选），当Type为Application，此项有效</li><li>Terminal = false 是否在终端中运行（可选），当Type为Application，此项有效</li><li>Type = Application desktop的类型（必选），常见值有“Application”和“Link”</li><li>Categories = GNOME;Application;Network; //注明在菜单栏中显示的类别（可选）</li></ul><h1 id="将图标放到任务栏"><a href="#将图标放到任务栏" class="headerlink" title="将图标放到任务栏"></a>将图标放到任务栏</h1><p>点击应用按钮，把刚生成的应用图标拖到任务栏中<br><img src="/images/2020/07/20200701003.png" alt></p><p>但是有可能会出现启动应用出现双图标,如下<br><img src="/images/2020/07/20200701004.png" alt></p><p>为了解决这个问题，首先打开应用，然后在终端输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xprop |grep WM_CLASS</span><br></pre></td></tr></table></figure><p>此时鼠标指针会变成一个十字准心，点击已经打开的软件界面，终端会反馈一条信息，包括2个字符串<br><img src="/images/2020/07/20200701005.png" alt><br>把第1个字符串里的内容添加到StartupWMClass里，保存，关闭应用重新打开，将不会出现双图标的情况了</p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中批量下载bilibili网站的视频</title>
      <link href="/2020/07/11/Ubuntu%E4%B8%AD%E6%89%B9%E9%87%8F%E4%B8%8B%E8%BD%BDbilibili%E7%BD%91%E7%AB%99%E7%9A%84%E8%A7%86%E9%A2%91/"/>
      <url>/2020/07/11/Ubuntu%E4%B8%AD%E6%89%B9%E9%87%8F%E4%B8%8B%E8%BD%BDbilibili%E7%BD%91%E7%AB%99%E7%9A%84%E8%A7%86%E9%A2%91/</url>
      
        <content type="html"><![CDATA[<h1 id="方案一-you-get"><a href="#方案一-you-get" class="headerlink" title="方案一:you-get"></a>方案一:you-get</h1><h2 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h2><p><a href="https://github.com/soimort/you-get" target="_blank" rel="noopener">Github地址:https://github.com/soimort/you-get</a></p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install you-get</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">you-get --playlist -o ./ https://www.bilibili.com/video/视频地址\?p\=1</span><br></pre></td></tr></table></figure><h1 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h1><h2 id="项目地址-1"><a href="#项目地址-1" class="headerlink" title="项目地址"></a>项目地址</h2><p><a href="https://github.com/Henryhaohao/Bilibili_video_download" target="_blank" rel="noopener">Github地址:https://github.com/Henryhaohao/Bilibili_video_download</a></p><h2 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h2><ol><li>将项目克隆到本地</li><li>运行</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python /your/address/bilibili_video_download.py</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装分区管理工具gparted</title>
      <link href="/2020/07/08/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E5%88%86%E5%8C%BA%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7gparted/"/>
      <url>/2020/07/08/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E5%88%86%E5%8C%BA%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7gparted/</url>
      
        <content type="html"><![CDATA[<h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><ul><li><a href="https://gparted.org/index.php" target="_blank" rel="noopener">官网</a></li><li>GNOME Partition Editor,分区管理工具</li></ul><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ul><li><p><a href="https://gparted.org/download.php" target="_blank" rel="noopener">https://gparted.org/download.php</a></p></li><li><p>Ubuntu安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gparted</span><br></pre></td></tr></table></figure></li><li><p>主界面<br><img src="/images/2020/07/20200708001.png" alt></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中基于Docker安装QQ和WeChat</title>
      <link href="/2020/07/08/Ubuntu%E4%B8%AD%E5%9F%BA%E4%BA%8EDocker%E5%AE%89%E8%A3%85QQ%E5%92%8CWeChat/"/>
      <url>/2020/07/08/Ubuntu%E4%B8%AD%E5%9F%BA%E4%BA%8EDocker%E5%AE%89%E8%A3%85QQ%E5%92%8CWeChat/</url>
      
        <content type="html"><![CDATA[<h1 id="github上有这两个项目"><a href="#github上有这两个项目" class="headerlink" title="github上有这两个项目"></a>github上有这两个项目</h1><ul><li><a href="https://github.com/bestwu/docker-wechat" target="_blank" rel="noopener">https://github.com/bestwu/docker-wechat</a></li><li><a href="https://github.com/bestwu/docker-qq" target="_blank" rel="noopener">https://github.com/bestwu/docker-qq</a></li></ul><h1 id="有个管理脚本脚本"><a href="#有个管理脚本脚本" class="headerlink" title="有个管理脚本脚本"></a>有个管理脚本脚本</h1><ul><li><a href="https://github.com/ygcaicn/ubuntu_qq" target="_blank" rel="noopener">https://github.com/ygcaicn/ubuntu_qq</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装桌面搜索应用DocFetcher</title>
      <link href="/2020/07/07/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E6%A1%8C%E9%9D%A2%E6%90%9C%E7%B4%A2%E5%BA%94%E7%94%A8DocFetcher/"/>
      <url>/2020/07/07/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E6%A1%8C%E9%9D%A2%E6%90%9C%E7%B4%A2%E5%BA%94%E7%94%A8DocFetcher/</url>
      
        <content type="html"><![CDATA[<h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><ul><li>DocFetcher 是一个使用 Java 语言开发的开源桌面搜索应用程序<ul><li>能搜索docx和pdf的内容</li></ul></li></ul><h1 id="平台"><a href="#平台" class="headerlink" title="平台"></a>平台</h1><p>Windows，Linux 和 OS X</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ol><li>基于java,所以需要运行环境：Java Runtime Environment（JRE）1.7 +</li><li>参考官网说明:<a href="http://docfetcher.sourceforge.net/en/download.html" target="_blank" rel="noopener">http://docfetcher.sourceforge.net/en/download.html</a></li></ol><h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><h2 id="建立索引"><a href="#建立索引" class="headerlink" title="建立索引"></a>建立索引</h2><p>为了快速的进行文本检索，DocFetcher 在检索文档文本前需要建立索引，用户可以根据需要为文件夹或者整个磁盘建立索引，当然，仅仅在第一次检索时需要为所要检索的文件夹或磁盘建立索引，建立索引后，当文件内容发生了变化 DocFetcher 会自动更新索引。以下是建立索引的详细方法：</p><ol><li><p>如图所示，右击[搜索范围]框的空白处，选择弹出菜单中的[建立索引 - 资料夹]。<br><img src="/images/2020/07/20200707003.png" alt></p></li><li><p>在弹出的选择窗口中选择需要检索文档的位置，点击[确认]。<br><img src="/images/2020/07/20200707004.png" alt></p></li><li><p>在弹出的窗口中可以对索引的细节进行设置，可以选择所要检索的文件格式，在排除列表中可以使用正则表达式过滤不需要建立索引的文件和文件格式，其他选项没有特殊要求使用默认值即可。最后选择[执行]，将开始建立索引。<br><img src="/images/2020/07/20200707005.png" alt></p></li><li><p>建立索引的过程耗时较长，具体时间取决于所选建立索引的文件夹中包含的文件数量及文件大小。索引建立完成后在首页的[搜索范围]框内便有了对应的目录。</p></li></ol><h2 id="检索数据"><a href="#检索数据" class="headerlink" title="检索数据"></a>检索数据</h2><p>对于建立好索引的目录，可以通过勾选检索目录、勾选文件类型、设定文件大小、输入关键字来进行文本检索，这里仅对 DocFetcher 的检索语法做简单介绍，详细内容请参照官方文档。</p><ul><li>短语搜索：需要将所要检索的短语放入英文双引号内。如 ：”可转债”，返回包含词语”可转债”的文件；</li><li>布尔运算：支持复杂条件的检索，常用运算符包含 AND、OR 、NOT 等，短语间没有运算符时将默认使用 OR。如 “可转债” AND “可交换债”，返回既包含短语”可转债”又包含短语”可交换债”的文件；</li><li>通配符：问号（’?’）和星号（’<em>‘）可用于表示某些字符未知。如 ：”可”</em>，返回包含”可以”、”可转债”、”可交换债”等包含以”可”开头的语句的文件；</li><li>模糊搜索：可以搜索与给定单词类似的单词。如，roam~，返回包含 foam 和的单词的文档 roams 的文件。</li></ul><h3 id="检索关键字格式"><a href="#检索关键字格式" class="headerlink" title="检索关键字格式"></a>检索关键字格式</h3><p>关键字是默认分词的，中文分词有时候一言难尽，所以<strong>如果想搜索整个词语请务必使用英文双引号括住</strong>，否则将导致 DocFetcher 将词语分词后使用 OR 运算进行检索，最终使检索结果出乎意料</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://hacpai.com/article/1568960776746#part1-%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95" target="_blank" rel="noopener">DocFetcher 使用教程——高效的文档文本检索工具</a></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装离线API文档大全Zeal</title>
      <link href="/2020/07/07/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E7%A6%BB%E7%BA%BFAPI%E6%96%87%E6%A1%A3%E5%A4%A7%E5%85%A8Zeal/"/>
      <url>/2020/07/07/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E7%A6%BB%E7%BA%BFAPI%E6%96%87%E6%A1%A3%E5%A4%A7%E5%85%A8Zeal/</url>
      
        <content type="html"><![CDATA[<h1 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h1><p><a href="https://zealdocs.org/" target="_blank" rel="noopener">Zeal</a></p><h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><p>离线 API 文档大全</p><h1 id="平台"><a href="#平台" class="headerlink" title="平台"></a>平台</h1><p>Linux 和 Windows </p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ul><li>参考这里<a href="https://zealdocs.org/download.html" target="_blank" rel="noopener">https://zealdocs.org/download.html</a></li><li>ubuntu安装<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install zeal</span><br></pre></td></tr></table></figure></li></ul><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="下载文档"><a href="#下载文档" class="headerlink" title="下载文档"></a>下载文档</h2><p>在初次安装 Zeal 之后，需要转到 File → Options → Docsets 先下载文档，然后方能使用<br><img src="/images/2020/07/20200707001.png" alt></p><h2 id="使用文档"><a href="#使用文档" class="headerlink" title="使用文档"></a>使用文档</h2><ul><li>有两种方式来查询文档<ul><li>直接输入 keyword 关键字进行查询，这将搜索已下载的所有文档。</li><li>包含文档类型前缀的查询，例如：python:keyword 这将仅限于搜索 Python 文档。</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Scala中的特殊符号</title>
      <link href="/2020/07/05/Scala%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7/"/>
      <url>/2020/07/05/Scala%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="泛型限定"><a href="#泛型限定" class="headerlink" title="泛型限定"></a>泛型限定</h1><table><thead><tr><th>符号</th><th>作用</th><th>说明</th></tr></thead><tbody><tr><td>[T &lt;: UpperBound]</td><td>上界</td><td>无</td></tr><tr><td>[T &gt;: LowerBound]</td><td>下界</td><td>无</td></tr><tr><td>[T &lt;% ViewBound]</td><td>视界</td><td>比上界多了隐式转换</td></tr><tr><td>[T : ContextBound]</td><td>上下文界</td><td>是隐式参数的语法糖</td></tr><tr><td>[+T]</td><td>协变</td><td>C[+T]：如果A是B的子类，那么C[A]是C[B]的子类，称为协变</td></tr><tr><td>[-T]</td><td>逆变</td><td>C[-T]：如果A是B的子类，那么C[B]是C[A]的子类，称为逆变</td></tr><tr><td>=:=</td><td>A 必须和 B相等</td><td>Scala 2.10 中被移除了</td></tr><tr><td>&lt;:&lt;</td><td>A 必须是 B的子类</td><td>Scala 2.10 中被移除了</td></tr><tr><td>&lt;%&lt;</td><td>A 必须可以被看做是 B</td><td>Scala 2.10 中被移除了</td></tr></tbody></table><p>如果你在尝试使用 &lt;:&lt; 或者 &lt;%&lt; 的时候出错了，那请注意这些符号在 Scala 2.10 中被移除了。Scala School 里的例子仅能在 Scala 2.9.x 下正常工作。你可以使用新版本的 Scala，但可能会遇到错误</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">scala&gt;</span><span class="bash"> class Container[A](value: A) &#123; def addIt(implicit evidence: A =:= Int) = 123 + value &#125;</span></span><br><span class="line">defined class Container</span><br><span class="line"></span><br><span class="line"><span class="meta">scala&gt;</span><span class="bash"> (new Container(123)).addIt</span></span><br><span class="line">res11: Int = 246</span><br><span class="line"></span><br><span class="line"><span class="meta">scala&gt;</span><span class="bash"> (new Container(<span class="string">"123"</span>)).addIt</span></span><br><span class="line">&lt;console&gt;:10: error: could not find implicit value for parameter evidence: =:=[java.lang.String,Int]</span><br><span class="line"></span><br><span class="line">// 类似地，根据之前的隐式转换，我们可以将约束放松为可视性：</span><br><span class="line"><span class="meta">scala&gt;</span><span class="bash"> class Container[A](value: A) &#123; def addIt(implicit evidence: A &lt;%&lt; Int) = 123 + value &#125;</span></span><br><span class="line">defined class Container</span><br><span class="line"></span><br><span class="line"><span class="meta">scala&gt;</span><span class="bash"> (new Container(<span class="string">"123"</span>)).addIt</span></span><br><span class="line">res15: Int = 246</span><br></pre></td></tr></table></figure><h1 id="集合操作符"><a href="#集合操作符" class="headerlink" title="集合操作符"></a>集合操作符</h1><p>这些符号全都是连接的作用，将元素与集合、集合与集合相连接</p><h2 id="集合拼接-等操作"><a href="#集合拼接-等操作" class="headerlink" title="集合拼接 :: ++:等操作"></a>集合拼接 :: ++:等操作</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="keyword">val</span> a =  <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">a: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">scala&gt; <span class="keyword">val</span> b = <span class="type">List</span>(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>)</span><br><span class="line">b: <span class="type">List</span>[<span class="type">Int</span>] = <span class="type">List</span>(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br></pre></td></tr></table></figure><table><thead><tr><th>符号</th><th>位置</th><th>解释</th><th>操作</th><th>结果</th></tr></thead><tbody><tr><td>::</td><td>前插</td><td>把a当成一个元素，前插到b集合</td><td>a :: b</td><td>List(List(1, 2, 3), 4, 5, 6)</td></tr><tr><td>+:</td><td>前插</td><td>同上</td><td>a +: b</td><td>List(List(1, 2, 3), 4, 5, 6)</td></tr><tr><td>:+</td><td>后插</td><td>把b当成一个元素，后插到a集合</td><td>a :+ b</td><td>List(1, 2, 3, List(4, 5, 6))</td></tr><tr><td>++</td><td>拼接</td><td>a和b集合顺序合并</td><td>a ++ b</td><td>List(1, 2, 3, 4, 5, 6)</td></tr><tr><td>++:</td><td>拼接</td><td>同上</td><td>a ++:b</td><td>List(1, 2, 3, 4, 5, 6)</td></tr><tr><td>:::</td><td>拼接</td><td>同上</td><td>a :::b</td><td>List(1, 2, 3, 4, 5, 6)</td></tr></tbody></table><p><code>::</code>操作符是右结合的，如<code>9 :: 5 :: 2 :: Nil</code>相当于<code>9 :: (5 :: (2 :: Nil))</code>。所以 <code>:: +: :::</code>这些操作符都是在前面插入。<code>:+ ++ ++:</code>这些是追加、拼接。</p><h2 id="集合拼接-–-等操作"><a href="#集合拼接-–-等操作" class="headerlink" title="集合拼接 ++= –= 等操作"></a>集合拼接 ++= –= 等操作</h2><ul><li>++= —= </li><li>++= 用于拼接容器，而 += 用于拼接元素</li></ul><p><strong>加法</strong></p><ul><li>xs += x 把元素 x 添加到集合 xs 中。该操作有副作用，它会返回左操作符，这里是 xs 自身。</li><li>xs += (x, y, z) 添加指定的元素到集合 xs 中，并返回 xs 本身。（同样有副作用）</li><li>xs ++= ys 添加集合 ys 中的所有元素到集合 xs 中，并返回 xs 本身。（表达式有副作用）</li><li>xs add x 把元素 x 添加到集合 xs 中，如集合 xs 之前没有包含 x，该操作返回 true，否则返回 false。</li></ul><p><strong>移除</strong></p><ul><li>xs -= x 从集合 xs 中删除元素 x，并返回 xs 本身。（表达式有副作用）</li><li>xs -= (x, y, z) 从集合 xs 中删除指定的元素，并返回 xs 本身。（表达式有副作用）</li><li>xs –= ys 从集合 xs 中删除所有属于集合 ys 的元素，并返回 xs 本身。（表达式有副作用）</li><li>xs remove x 从集合 xs 中删除元素 x 。如之前 xs 中包含了 x 元素，返回 true，否则返回 false。</li><li>xs retain p 只保留集合 xs 中满足条件 p 的元素。</li><li>xs.clear() 删除集合 xs 中的所有元素。</li></ul><p><strong>更新</strong></p><ul><li>xs(x) = b （ 同 xs.update(x, b) ）参数 b 为布尔类型，如果值为 true 就把元素x加入集合 xs，否则从集合 xs 中删除 x。</li></ul><p><strong>克隆</strong></p><ul><li>xs.clone 产生一个与 xs 具有相同元素的可变集合。</li></ul><h1 id="字符串插值"><a href="#字符串插值" class="headerlink" title="字符串插值"></a>字符串插值</h1><table><thead><tr><th>符号</th><th>作用</th></tr></thead><tbody><tr><td>s 字符串插值器</td><td>在任何字符串前加上s，就可以直接在串中使用变量</td></tr><tr><td>f 插值器</td><td>在任何字符串字面前加上 f，就可以生成简单的格式化串，功能相似于其他语言中的 printf 函数</td></tr><tr><td>raw 插值器</td><td>除了对字面值中的字符不做编码外，raw 插值器与 s 插值器在功能上是相同的</td></tr></tbody></table><p><strong>举例</strong></p><ul><li><p>s 字符串插值器</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> name=<span class="string">"James"</span></span><br><span class="line"><span class="comment">// $name嵌套在一个将被s字符串插值器处理的字符串中。</span></span><br><span class="line"><span class="comment">// 插值器知道在这个字符串的这个地方应该插入这个name变量的值，以使输出字符串为Hello,James。</span></span><br><span class="line"><span class="comment">// 使用s插值器，在这个字符串中可以使用任何在处理范围内的名字。</span></span><br><span class="line">println(<span class="string">s"Hello,<span class="subst">$name</span>"</span>) <span class="comment">//Hello,James </span></span><br><span class="line"></span><br><span class="line">println(<span class="string">s"1+1=<span class="subst">$&#123;1+1&#125;</span>"</span>) <span class="comment">//将会输出字符串1+1=2。任何表达式都可以嵌入到$&#123;&#125;中。</span></span><br></pre></td></tr></table></figure></li><li><p>f 插值器</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> height=<span class="number">1.9</span>d</span><br><span class="line"><span class="keyword">val</span> name=<span class="string">"James"</span></span><br><span class="line"><span class="comment">// f 插值器是类型安全的</span></span><br><span class="line">println(<span class="string">f"<span class="subst">$name</span>%s is <span class="subst">$height</span>%2.2f meters tall"</span>)<span class="comment">//James is 1.90 meters tall </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> height:<span class="type">Double</span>=<span class="number">1.9</span>d</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果试图向只支持 int 的格式化串传入一个double 值，编译器则会报错。例如：</span></span><br><span class="line">scala&gt;<span class="string">f"<span class="subst">$height</span>%4d"</span></span><br><span class="line">&lt;console&gt;:<span class="number">9</span>: error: <span class="class"><span class="keyword">type</span> <span class="title">mismatch</span></span>;</span><br><span class="line"> found : <span class="type">Double</span></span><br><span class="line"> required: <span class="type">Int</span></span><br><span class="line">           <span class="string">f"<span class="subst">$height</span>%4d"</span></span><br><span class="line">              ^ f 插值器利用了java中的字符串数据格式。这种以%开头的格式在</span><br></pre></td></tr></table></figure></li><li><p>raw 插值器</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">scala&gt;<span class="string">s"a\nb"</span></span><br><span class="line">res0:<span class="type">String</span>=</span><br><span class="line">a</span><br><span class="line">b </span><br><span class="line"><span class="comment">// 这里，s 插值器用回车代替了\n。而raw插值器却不会如此处理。</span></span><br><span class="line"></span><br><span class="line">scala&gt;<span class="string">raw"a\nb"</span></span><br><span class="line">res1:<span class="type">String</span>=a\nb </span><br><span class="line"><span class="comment">// 当不想输入\n被转换为回车的时候，raw 插值器是非常实用的。</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="（下划线）的用法"><a href="#（下划线）的用法" class="headerlink" title="_（下划线）的用法"></a><code>_</code>（下划线）的用法</h1><ol><li><p>通配符</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//_可以起到类似于*作用的通配符</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.<span class="type">SparkContext</span>._</span><br></pre></td></tr></table></figure></li><li><p>指代集合中的每一个元素</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如 遍历集合筛选列表中大于某个值的元素。</span></span><br><span class="line"><span class="keyword">val</span> lst = <span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>)</span><br><span class="line"><span class="keyword">val</span> lstFilter = lst.filter(_ &gt; <span class="number">3</span>)</span><br></pre></td></tr></table></figure></li><li><p>获取元组中指定下标的元素值</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> ss = (<span class="number">1</span>,<span class="string">"22"</span>,<span class="string">"333"</span>)</span><br><span class="line">println(ss._1)</span><br></pre></td></tr></table></figure></li><li><p>使用模式匹配可以用来获取元组的组员</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> m = <span class="type">Map</span>(<span class="number">1</span> -&gt; <span class="number">2</span>,<span class="number">2</span> -&gt; <span class="number">4</span>)</span><br><span class="line"><span class="comment">//如果不需要所有部件， 则在不需要的部件使用_； 本例只取key,因此在value处用_</span></span><br><span class="line"><span class="keyword">for</span> ((k,_) &lt;- m) println(k)</span><br></pre></td></tr></table></figure></li><li><p>成员变量而非局部变量添加默认值</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s:<span class="type">Int</span>=_</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>可变长度参数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">scala&gt;</span><span class="bash"> val arr = Array(1,2,3,4,5)</span></span><br><span class="line">arr: Array[Int] = Array(1, 2, 3, 4, 5)</span><br><span class="line"></span><br><span class="line"><span class="meta">scala&gt;</span><span class="bash"> val Array(first, second, _*) = arr</span></span><br><span class="line">first: Int = 1</span><br><span class="line">second: Int = 2</span><br></pre></td></tr></table></figure></li><li><p>不需要的部件使用<code>_</code></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Some</span>(<span class="number">5</span>) <span class="keyword">match</span> &#123; </span><br><span class="line">    <span class="keyword">case</span> <span class="type">Some</span>(_) =&gt; println(<span class="string">"Yes"</span>) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">List</span>(<span class="number">1</span>,_,_) =&gt; <span class="string">" a list with three element and the first element is 1"</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">List</span>(_*)  =&gt; <span class="string">" a list with zero or more elements "</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">Map</span>[_,_] =&gt; <span class="string">" matches a map with any key type and any value type "</span></span><br><span class="line">    <span class="keyword">case</span> _ =&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> (a, _) = (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> (_ &lt;- <span class="number">1</span> to <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果不需要所有部件， 则在不需要的部件使用_； 本例只取key,因此在value处用 _ </span></span><br><span class="line"><span class="keyword">val</span> m = <span class="type">Map</span>(<span class="number">1</span> -&gt; <span class="number">2</span>,<span class="number">2</span> -&gt; <span class="number">4</span>)</span><br><span class="line"><span class="keyword">for</span> ((k,_) &lt;- m) println(k)</span><br></pre></td></tr></table></figure></li></ol><h1 id="参数序列处理"><a href="#参数序列处理" class="headerlink" title=":_*参数序列处理"></a><code>:_*</code>参数序列处理</h1><p>:_* 作为一个整体，告诉编译器你希望将某个参数当作参数序列处理</p><p>当函数接收的参数不定长的时候，假如你想输入一个队列，可以在一个队列后加入“:_*”，因此，这里的“1 to 5”也可以改写为：“Seq(1,2,3,4,5)”。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Sample</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">main</span> </span>(args: <span class="type">Array</span>[<span class="type">String</span>])=&#123;</span><br><span class="line">    <span class="keyword">val</span> result=sum(<span class="number">1</span> to <span class="number">5</span>:_*)   <span class="comment">// 在后面写上: _*将1 to 5转化为参数序列</span></span><br><span class="line">     println(result)</span><br><span class="line">   &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sum</span></span>(parms:<span class="type">Int</span>*)=&#123;</span><br><span class="line">    <span class="keyword">var</span> result=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span>(parm &lt;- parms)result+=parm</span><br><span class="line">    result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="模式匹配中使用"><a href="#模式匹配中使用" class="headerlink" title="模式匹配中使用 @"></a>模式匹配中使用 @</h1><p><code>@</code>的主要功能是在模式匹配中，匹配到一个模式后，将引用交给<code>@</code>前的参数<br><strong>案例1</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> o: <span class="type">Option</span>[<span class="type">Int</span>] = <span class="type">Some</span>(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">o <span class="keyword">match</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="type">Some</span>(x) =&gt; println(x)  <span class="comment">// 打印2</span></span><br><span class="line">  <span class="keyword">case</span> _ =&gt; println(<span class="string">"do nothing"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">o <span class="keyword">match</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> someRef @ <span class="type">Some</span>(x) =&gt; println(someRef)  <span class="comment">// 打印Some(2)</span></span><br><span class="line">  <span class="keyword">case</span> _ =&gt; println(<span class="string">"do nothing"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">o <span class="keyword">match</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> x @ <span class="type">Some</span>(_) =&gt; println(x)  <span class="comment">// 打印Some(2)</span></span><br><span class="line">  <span class="keyword">case</span> _ =&gt; println(<span class="string">"do nothing"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>案例2</strong></p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在处理 request 请求的时候，需要匹配请求的路径，然后还需要直接使用 requet</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">intent</span> </span>= &#123;</span><br><span class="line"> <span class="keyword">case</span> req @ <span class="type">GET</span>(<span class="type">Path</span>(<span class="type">Seg</span>(<span class="string">"api"</span> :: <span class="string">"user"</span> :: <span class="type">IntPathElement</span>(userId) :: <span class="type">Nil</span>))) =&gt;</span><br><span class="line">      <span class="keyword">val</span> f = (userManager ? <span class="type">FindUserById</span>(userId))</span><br><span class="line">      respond(f, req)</span><br><span class="line">      </span><br><span class="line"> <span class="keyword">case</span> req @ <span class="type">GET</span>(<span class="type">Path</span>(<span class="type">Seg</span>(<span class="string">"api"</span> :: <span class="string">"user"</span> :: <span class="type">Nil</span>))) &amp; <span class="type">Params</span>(<span class="type">EmailParam</span>(email)) =&gt;</span><br><span class="line">      <span class="keyword">val</span> f = (userManager ? <span class="type">FindUserByEmail</span>(email))</span><br><span class="line">      respond(f, req)  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Akka-相关特殊字符"><a href="#Akka-相关特殊字符" class="headerlink" title="Akka 相关特殊字符! ?"></a>Akka 相关特殊字符<code>! ?</code></h1><table><thead><tr><th>符号</th><th>作用</th></tr></thead><tbody><tr><td>!</td><td>表示“即发即忘”，例如异步发送消息并立即返回,也称为tell</td></tr><tr><td>?</td><td>异步发送消息并返回表示可能回复的Future,也称为ask</td></tr></tbody></table><p><strong>举例</strong></p><ul><li><p>send !</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="type">ArticleBody</span>(uri, body) =&gt; <span class="comment">//If we get the parsed article back, then we've just parsed it</span></span><br><span class="line">    cacheActor ! <span class="type">SetRequest</span>(uri, body) <span class="comment">//Cache it as we just</span></span><br><span class="line">    parsed it</span><br><span class="line">    senderRef ! body</span><br><span class="line">    context.stop(self)</span><br></pre></td></tr></table></figure></li><li><p>ask ?</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> future = pongActor ? <span class="string">"unknown"</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> BigData </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BigData </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装词典GoldenDict</title>
      <link href="/2020/06/14/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E8%AF%8D%E5%85%B8GoldenDict/"/>
      <url>/2020/06/14/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E8%AF%8D%E5%85%B8GoldenDict/</url>
      
        <content type="html"><![CDATA[<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install goldendict</span><br></pre></td></tr></table></figure><h1 id="添加词库"><a href="#添加词库" class="headerlink" title="添加词库"></a>添加词库</h1><ol><li><p>离线词库下载<br>测试过<a href="http://download.huzheng.org/zh_CN/" target="_blank" rel="noopener">http://download.huzheng.org/zh_CN/</a><br>测试过<a href="https://freemdict.com/2018/06/04/%e8%8b%b1%e6%b1%89-%e6%9c%97%e6%96%875-%c2%b7%e5%8f%8c%e8%a7%a3%c2%b7%e4%be%8b%e5%8f%a5%e5%8f%91%e9%9f%b3/" target="_blank" rel="noopener">英汉:朗文5++ ·双解·例句发音</a><br>没测试过<a href="http://download.huzheng.org/" target="_blank" rel="noopener">http://download.huzheng.org/</a></p></li><li><p>添加<br><img src="/images/2020/06/20200614003.png" alt></p></li></ol><ol start="3"><li><p>添加在线搜索<br>这里添加有道<code>http://dict.youdao.com/search?q=%GDWORD%&amp;ue=utf8</code><br><img src="/images/2020/06/20200614005.png" alt></p></li><li><p>取消百科的搜索<br><img src="/images/2020/06/20200614006.png" alt></p></li><li><p>调整词典顺序<br><img src="/images/2020/06/20200614004.png" alt></p></li></ol><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><ul><li><p>快捷键<br><img src="/images/2020/06/20200614007.png" alt></p></li><li><p>屏幕取词<br>将需要查询的内容选取,按<code>ctrl + c + c</code>快捷键</p></li></ul><h1 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h1><p><a href="https://www.jianshu.com/p/b6b2c1d78d7c" target="_blank" rel="noopener">安装使用 GoldenDict 查词神器 (Windows/Mac/Linux)</a></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中一键OCR识别图片截图文字转文本</title>
      <link href="/2020/06/14/Ubuntu%E4%B8%AD%E4%B8%80%E9%94%AEOCR%E8%AF%86%E5%88%AB%E5%9B%BE%E7%89%87%E6%88%AA%E5%9B%BE%E6%96%87%E5%AD%97%E8%BD%AC%E6%96%87%E6%9C%AC/"/>
      <url>/2020/06/14/Ubuntu%E4%B8%AD%E4%B8%80%E9%94%AEOCR%E8%AF%86%E5%88%AB%E5%9B%BE%E7%89%87%E6%88%AA%E5%9B%BE%E6%96%87%E5%AD%97%E8%BD%AC%E6%96%87%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<h1 id="主要思路"><a href="#主要思路" class="headerlink" title="主要思路"></a>主要思路</h1><p>利用截图软件gnome-screenshot 进行截取需要被文字识别的图片；利用文字识别OCR软件tesseract，进行识别将结果输出，复制到文件和剪切板</p><h1 id="步骤1：安装依赖软件"><a href="#步骤1：安装依赖软件" class="headerlink" title="步骤1：安装依赖软件"></a>步骤1：安装依赖软件</h1><h2 id="安装tesseract"><a href="#安装tesseract" class="headerlink" title="安装tesseract"></a>安装tesseract</h2><p>tesseract是一个开源的OCR引擎，最初是由惠普公司开发用来作为其平板扫描仪的OCR引擎，2005年惠普将其开源出来，之后google接手负责维护。目前稳定的版本是3.0。4.0版本加入了基于LSTM的神经网络技术，中文字符识别准确率有所提高。</p><ol><li><p>添加源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:alex-p/tesseract-ocr</span><br></pre></td></tr></table></figure></li><li><p>更新源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure></li><li><p>安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install tesseract-ocr</span><br></pre></td></tr></table></figure></li></ol><h2 id="安装中文字库"><a href="#安装中文字库" class="headerlink" title="安装中文字库"></a>安装中文字库</h2><ol><li>tesseract支持60多种语言的识别不同，使用之前需要先下载对应语言的字库，下载地址：<a href="https://github.com/tesseract-ocr/tessdata" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tessdata</a></li><li>下载完成之后把.traineddata字库文件放到tessdata目录下，默认路径是/usr/share/tesseract-ocr/4.00/tessdata</li></ol><h2 id="安装剩余软件：shutter，xclip-imagemagick"><a href="#安装剩余软件：shutter，xclip-imagemagick" class="headerlink" title="安装剩余软件：shutter，xclip, imagemagick"></a>安装剩余软件：shutter，xclip, imagemagick</h2><p>这3个不需要添加源，直接终端输入代码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 截屏软件</span><br><span class="line">sudo apt-get install shutter</span><br><span class="line"># 终端复制命令</span><br><span class="line">sudo apt-get install xclip</span><br><span class="line"># 图片处理</span><br><span class="line">sudo apt-get install imagemagick</span><br></pre></td></tr></table></figure><h1 id="步骤2：制作shell脚本"><a href="#步骤2：制作shell脚本" class="headerlink" title="步骤2：制作shell脚本"></a>步骤2：制作shell脚本</h1><ol><li><p>创建一个可执行脚本,脚本内容为以下代码,并脚本放到环境变量所在目录</p></li><li><p>注意：将代码中，SCR=”/home/Username/Documents/temp”双引号中的路径替换成你想要存放截图以及识别结果txt文档的路径</p></li><li><p>用<code>tesseract --list-langs</code>检查安装过的语言包</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tesseract --list-langs</span><br><span class="line">List of available languages (3):</span><br><span class="line">eng</span><br><span class="line">chi_sim</span><br><span class="line">osd</span><br></pre></td></tr></table></figure></li><li><p>脚本内容如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># Dependencies: tesseract-ocr imagemagick shutter xclip</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Name: OCR</span></span><br><span class="line"><span class="comment">#Date: 2020-06-14</span></span><br><span class="line"><span class="comment">#Fuction: take a screenshot and OCR the letters in the picture</span></span><br><span class="line"><span class="comment">#Path: /home/UserName/...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#you can only scan one character at a time</span></span><br><span class="line">SCR=<span class="string">"/home/UserName/Documents/temp"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####take a shot what you wana to OCR to text</span></span><br><span class="line"><span class="comment"># The purpose of assigning the result to the variable is</span></span><br><span class="line"><span class="comment"># to wait for this command to complete before executing the next line</span></span><br><span class="line">shutterOutput=`shutter -s -e -o <span class="variable">$SCR</span>.png &gt; /dev/null 2&gt;&amp;1`</span><br><span class="line"></span><br><span class="line"><span class="comment">####increase the png</span></span><br><span class="line">mogrify -modulate 100,0 -resize 400% <span class="variable">$SCR</span>.png</span><br><span class="line"><span class="comment">#should increase detection rate</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####OCR by tesseract</span></span><br><span class="line"><span class="comment"># Language packages are identified with the `tesseract --list-langs` command</span></span><br><span class="line">tesseract <span class="variable">$SCR</span>.png <span class="variable">$SCR</span> &amp;&gt; /dev/null -l eng+chi_sim</span><br><span class="line"></span><br><span class="line"><span class="comment">####use sed to delete the blanks &amp; get the text and copy to clipboard</span></span><br><span class="line">cat <span class="variable">$SCR</span>.txt | sed <span class="string">'s/ //g'</span> | xclip -selection clipboard</span><br><span class="line"></span><br><span class="line"><span class="comment"># If you need to delete the newline, please use this statement</span></span><br><span class="line"><span class="comment"># and comment the previous sentence (the first line plus #)</span></span><br><span class="line"><span class="comment">#cat $SCR.txt | sed 's/ //g'| xargs | xclip -selection clipboard</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The pop-up window prompts the end of OCR</span></span><br><span class="line">notify-send <span class="string">"OCR Done"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="步骤3：设置快捷键，一键调用shell脚本"><a href="#步骤3：设置快捷键，一键调用shell脚本" class="headerlink" title="步骤3：设置快捷键，一键调用shell脚本"></a>步骤3：设置快捷键，一键调用shell脚本</h1><ul><li>进入：设置-&gt;键盘 拉到底部，点击+</li><li>名称：自由设置，建议以shell脚本名称命名</li><li>命令：脚本名字<br><img src="/images/2020/06/20200614002.png" alt></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://zhuanlan.zhihu.com/p/114917496" target="_blank" rel="noopener">Linux系统（ubuntu）一键OCR识别图片截图文字转文本</a><br><a href="http://huanyouchen.github.io/2018/05/10/install-Tesseract-and-use-it-with-py/" target="_blank" rel="noopener">Tesseract安装使用</a></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux中使用tar和gzip进行打包拆包压缩解压</title>
      <link href="/2020/06/11/Linux%E4%B8%AD%E4%BD%BF%E7%94%A8tar%E5%92%8Cgzip%E8%BF%9B%E8%A1%8C%E6%89%93%E5%8C%85%E6%8B%86%E5%8C%85%E5%8E%8B%E7%BC%A9%E8%A7%A3%E5%8E%8B/"/>
      <url>/2020/06/11/Linux%E4%B8%AD%E4%BD%BF%E7%94%A8tar%E5%92%8Cgzip%E8%BF%9B%E8%A1%8C%E6%89%93%E5%8C%85%E6%8B%86%E5%8C%85%E5%8E%8B%E7%BC%A9%E8%A7%A3%E5%8E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="压缩格式："><a href="#压缩格式：" class="headerlink" title="压缩格式："></a>压缩格式：</h1><ul><li><p>windows (zip、rar)</p></li><li><p>linux  (gz ，bzip，zip)</p></li><li><p>先打包再压缩， 打包后可以拆包，压缩后可以解压</p></li><li><p>打包：目录可能有很多个文件，我先把它们打包成一个文件</p></li><li><p>压缩：把打包后的那个文件压缩</p></li></ul><h1 id="tar打包与拆包"><a href="#tar打包与拆包" class="headerlink" title="tar打包与拆包"></a>tar打包与拆包</h1><h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><ol><li><p>命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar  -cvf  打包后的文件名即归档文件.tar  欲打包的文件夹名</span><br></pre></td></tr></table></figure></li><li><p>例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar  -cvf  news.tar  ./java   把java文件夹打包成new.tar</span><br></pre></td></tr></table></figure></li></ol><h2 id="拆包"><a href="#拆包" class="headerlink" title="拆包"></a>拆包</h2><ol><li><p>命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar  -xvf  打包后的文件名即归档文件名.tar</span><br></pre></td></tr></table></figure></li><li><p>例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar  -xvf  news.tar   可以把new.tar拆包，拆出来java文件夹</span><br></pre></td></tr></table></figure></li></ol><h2 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- c ：打包，创建的一个归档文件 ，即打包文件夹</span><br><span class="line"></span><br><span class="line">- x ：拆包</span><br><span class="line"></span><br><span class="line">- z ：以gzip 格式压缩，默认压缩倍数 6倍  （0-9）</span><br><span class="line"></span><br><span class="line">- j ：以bzip2格式压缩</span><br><span class="line"></span><br><span class="line">- v ：显示打包或者拆包的文件信息</span><br><span class="line"></span><br><span class="line">- f ： 后面紧接一个 归档文件</span><br></pre></td></tr></table></figure><h1 id="gzip-压缩与解压-bzip2也可以"><a href="#gzip-压缩与解压-bzip2也可以" class="headerlink" title="gzip   压缩与解压(bzip2也可以)"></a>gzip   压缩与解压(bzip2也可以)</h1><h2 id="压缩"><a href="#压缩" class="headerlink" title="压缩"></a>压缩</h2><ol><li><p>命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip  要压缩的打包后的文件名即归档文件名.tar</span><br></pre></td></tr></table></figure></li><li><p>例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip  news.tar</span><br></pre></td></tr></table></figure></li></ol><h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><ol><li><p>命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip  -d  要解压的文件名.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gzip  -d  news.tar.gz</span><br></pre></td></tr></table></figure></li></ol><h1 id="打包且压缩"><a href="#打包且压缩" class="headerlink" title="打包且压缩"></a>打包且压缩</h1><ol><li><p>命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar  -czvf  打包并压缩后的文件名.tar.gz  欲打包及压缩的文件夹名</span><br></pre></td></tr></table></figure></li><li><p>例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar  -czvf  news.tar.gz  ./java</span><br><span class="line">或</span><br><span class="line">tar  -czvf  news.tar.gz  java/</span><br><span class="line">或</span><br><span class="line">tar  -czvf  news.tar.gz  java</span><br></pre></td></tr></table></figure></li></ol><h1 id="解压及拆包"><a href="#解压及拆包" class="headerlink" title="解压及拆包"></a>解压及拆包</h1><ol><li><p>命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar  -xzvf  打包及压缩后的文件名.tar.gz</span><br></pre></td></tr></table></figure></li><li><p>例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar  -xzvf  news.tar.gz</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中用final修饰静态变量后对静态代码块的影响</title>
      <link href="/2020/06/10/Java%E4%B8%AD%E7%94%A8final%E4%BF%AE%E9%A5%B0%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E5%90%8E%E5%AF%B9%E9%9D%99%E6%80%81%E4%BB%A3%E7%A0%81%E5%9D%97%E7%9A%84%E5%BD%B1%E5%93%8D/"/>
      <url>/2020/06/10/Java%E4%B8%AD%E7%94%A8final%E4%BF%AE%E9%A5%B0%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E5%90%8E%E5%AF%B9%E9%9D%99%E6%80%81%E4%BB%A3%E7%A0%81%E5%9D%97%E7%9A%84%E5%BD%B1%E5%93%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="判断如下代码打印结果"><a href="#判断如下代码打印结果" class="headerlink" title="判断如下代码打印结果"></a>判断如下代码打印结果</h1><p>User.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"user...."</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Emp.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Emp</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 注意,这里的final</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> age = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"Emp...."</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">System.out.println(User.age);</span><br><span class="line">System.out.println(Emp.age);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user....</span><br><span class="line">20</span><br><span class="line">30</span><br></pre></td></tr></table></figure><p>问:为什么不打印<code>Emp....</code>,按理来说,static代码块在代码类加载的时候就应该调用的,也就是说<code>Emp....</code>应该要打印出来的</p><h1 id="为什么不打印Emp"><a href="#为什么不打印Emp" class="headerlink" title="为什么不打印Emp...."></a>为什么不打印<code>Emp....</code></h1><p>我们分别查看User.java和Emp.java的字节码</p><h2 id="不加final的User的字节码"><a href="#不加final的User的字节码" class="headerlink" title="不加final的User的字节码"></a>不加final的User的字节码</h2><p><img src="/images/2020/06/20200610004.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  public static int age;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line"></span><br><span class="line">  static &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=0, args_size=0</span><br><span class="line">         0: bipush        20</span><br><span class="line">         2: putstatic     #10                 // Field age:I</span><br><span class="line">         5: getstatic     #12                 // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         8: ldc           #18                 // String user....</span><br><span class="line">        10: invokevirtual #20                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">        13: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 4: 0</span><br><span class="line">        line 6: 5</span><br><span class="line">        line 7: 13</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line"></span><br><span class="line">  public com.zjc.hbasedemo.User();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #29                 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         4: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 3: 0</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       5     0  this   Lcom/zjc/hbasedemo/User;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: &quot;User.java&quot;</span><br></pre></td></tr></table></figure><h2 id="加final的Emp的字节码"><a href="#加final的Emp的字节码" class="headerlink" title="加final的Emp的字节码"></a>加final的Emp的字节码</h2><p><img src="/images/2020/06/20200610003.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  public static final int age;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC, ACC_FINAL</span><br><span class="line">    ConstantValue: int 30</span><br><span class="line"></span><br><span class="line">  static &#123;&#125;;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=2, locals=0, args_size=0</span><br><span class="line">         0: getstatic     #12                 // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         3: ldc           #18                 // String Emp....</span><br><span class="line">         5: invokevirtual #20                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">         8: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 6: 0</span><br><span class="line">        line 7: 8</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line"></span><br><span class="line">  public com.zjc.hbasedemo.Emp();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=1, locals=1, args_size=1</span><br><span class="line">         0: aload_0</span><br><span class="line">         1: invokespecial #29                 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         4: return</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line 3: 0</span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            0       5     0  this   Lcom/zjc/hbasedemo/Emp;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: &quot;Emp.java&quot;</span><br></pre></td></tr></table></figure><h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>对于有final关键字来说</p><ul><li>对<code>final</code>的含义来说,是将变量变为一个”不可改变的变量(类似常量)”</li><li>而从字节码可以看出,有<code>final</code>关键字的变量比static更早被赋值,所以,当我们调用<code>Emp.age</code>时,并不需要static块的内容被加载,所以static块的内容不会被打印</li></ul><p>对于无final关键字来说,从字节码中可以得出<br>这段代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> age = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"user...."</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>相当于这段代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="comment">// (这代码在Test.java中调用也要跟着改,这里只是说明用)</span></span><br><span class="line"><span class="comment">// public static int age = 20;</span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> age = <span class="number">20</span>;</span><br><span class="line">            System.out.println(<span class="string">"User...."</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Java中的多态传递</title>
      <link href="/2020/06/10/Java%E4%B8%AD%E7%9A%84%E5%A4%9A%E6%80%81%E4%BC%A0%E9%80%92/"/>
      <url>/2020/06/10/Java%E4%B8%AD%E7%9A%84%E5%A4%9A%E6%80%81%E4%BC%A0%E9%80%92/</url>
      
        <content type="html"><![CDATA[<h1 id="下述代码中的A-a-new-C-中-类C是否实现了接口A"><a href="#下述代码中的A-a-new-C-中-类C是否实现了接口A" class="headerlink" title="下述代码中的A a = new C();中,类C是否实现了接口A"></a>下述代码中的<code>A a = new C();</code>中,类C是否实现了接口A</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">A a = new C();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">interface A &#123;</span><br><span class="line">&#125;</span><br><span class="line">class B implements A &#123;</span><br><span class="line">&#125;</span><br><span class="line">class C extends B &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们可以打印看看</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(C.class.getInterfaces().length);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">interface A &#123;</span><br><span class="line">&#125;</span><br><span class="line">class B implements A &#123;</span><br><span class="line">&#125;</span><br><span class="line">class C extends B &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打印结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0</span><br></pre></td></tr></table></figure><p><strong>说明C事实上是没有实现接口A的</strong></p><h1 id="那为什么A-a-new-C-没有报错呢"><a href="#那为什么A-a-new-C-没有报错呢" class="headerlink" title="那为什么A a = new C();没有报错呢?"></a>那为什么<code>A a = new C();</code>没有报错呢?</h1><ol><li><p>实现类是可以代替接口出现的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A a = new B();</span><br></pre></td></tr></table></figure></li><li><p>子类是可以代替父类对象出现的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">B b = new C();</span><br></pre></td></tr></table></figure></li><li><p>所以可以写成</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A a = new C();</span><br></pre></td></tr></table></figure></li></ol><p>语法上是没问题的,虽然C没有特定实现A,但由于有一个<strong>多态传递</strong>的功能,所以是不会报错的</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java细节 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java的类加载器</title>
      <link href="/2020/06/10/Java%E7%9A%84%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/"/>
      <url>/2020/06/10/Java%E7%9A%84%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="类加载器分类"><a href="#类加载器分类" class="headerlink" title="类加载器分类"></a>类加载器分类</h1><h2 id="Java虚拟机自带的加载器"><a href="#Java虚拟机自带的加载器" class="headerlink" title="Java虚拟机自带的加载器"></a>Java虚拟机自带的加载器</h2><ol><li>启动类加载器(Bootstrap) -&gt; 加载java核心类库</li><li>扩展类加载器(Extension)</li><li>应用类加载器(Application) -&gt; 自定义类一般都是应用加载器加载的</li></ol><h2 id="用户自定义的类加载器-本文不讲"><a href="#用户自定义的类加载器-本文不讲" class="headerlink" title="用户自定义的类加载器(本文不讲)"></a>用户自定义的类加载器(本文不讲)</h2><ol><li>java.lang.ClassLoader 的子类</li><li>用户可以定制类的加载方式</li></ol><h1 id="类加载器的作用"><a href="#类加载器的作用" class="headerlink" title="类加载器的作用"></a>类加载器的作用</h1><p>加载类</p><blockquote><p>  Java类加载器（英语：Java Classloader）是Java运行时环境（Java Runtime Environment）的一个部件，负责动态加载Java类到Java虚拟机的内存空间中。类通常是按需加载，即第一次使用该类时才加载。由于有了类加载器，Java运行时系统不需要知道文件与文件系统。</p></blockquote><h1 id="类加载器的加载路径"><a href="#类加载器的加载路径" class="headerlink" title="类加载器的加载路径"></a>类加载器的加载路径</h1><h2 id="打印加载路径的代码"><a href="#打印加载路径的代码" class="headerlink" title="打印加载路径的代码"></a>打印加载路径的代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassLoaderTest</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">System.out.println(<span class="string">"BootstrapClassLoader 的加载路径: "</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//String[] bootUrls = System.getProperty("sun.boot.class.path").split(";");</span></span><br><span class="line"></span><br><span class="line">URL[] urls = sun.misc.Launcher.getBootstrapClassPath().getURLs();</span><br><span class="line"><span class="keyword">for</span>(URL url : urls)</span><br><span class="line">System.out.println(url);</span><br><span class="line">System.out.println(<span class="string">"----------------------------"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//取得扩展类加载器</span></span><br><span class="line">URLClassLoader extClassLoader = (URLClassLoader)ClassLoader.getSystemClassLoader().getParent();</span><br><span class="line">System.out.println(extClassLoader);</span><br><span class="line">System.out.println(<span class="string">"扩展类加载器 的加载路径: "</span>);</span><br><span class="line"></span><br><span class="line">urls = extClassLoader.getURLs();</span><br><span class="line"><span class="keyword">for</span>(URL url : urls)</span><br><span class="line">System.out.println(url);</span><br><span class="line">System.out.println(<span class="string">"----------------------------"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//取得应用(系统)类加载器</span></span><br><span class="line">URLClassLoader appClassLoader = (URLClassLoader)ClassLoader.getSystemClassLoader();</span><br><span class="line"></span><br><span class="line">System.out.println(appClassLoader);</span><br><span class="line">System.out.println(<span class="string">"应用(系统)类加载器 的加载路径: "</span>);</span><br><span class="line"></span><br><span class="line">urls = appClassLoader.getURLs();</span><br><span class="line"><span class="keyword">for</span>(URL url : urls)</span><br><span class="line">System.out.println(url);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"----------------------------"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">BootstrapClassLoader 的加载路径:</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/resources.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/rt.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/sunrsasign.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/jsse.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/jce.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/charsets.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/jfr.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/classes</span><br><span class="line">----------------------------</span><br><span class="line">sun.misc.Launcher$ExtClassLoader@15db9742</span><br><span class="line">扩展类加载器 的加载路径:</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/ext/sunpkcs11.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/ext/nashorn.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/ext/cldrdata.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/ext/dnsns.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/ext/sunjce_provider.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/ext/jfxrt.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/ext/localedata.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/ext/jaccess.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/ext/sunec.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/jre/lib/ext/zipfs.jar</span><br><span class="line">----------------------------</span><br><span class="line">sun.misc.Launcher$AppClassLoader@73d16e93</span><br><span class="line">应用(系统)类加载器 的加载路径:</span><br><span class="line">file:/home/zjc/Documents/eclipse-workspace/hbase/target/classes/</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hbase/hbase-server/1.3.1/hbase-server-1.3.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hbase/hbase-common/1.3.1/hbase-common-1.3.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/github/stephenc/findbugs/findbugs-annotations/1.3.9-1/findbugs-annotations-1.3.9-1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hbase/hbase-protocol/1.3.1/hbase-protocol-1.3.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hbase/hbase-procedure/1.3.1/hbase-procedure-1.3.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hbase/hbase-common/1.3.1/hbase-common-1.3.1-tests.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hbase/hbase-prefix-tree/1.3.1/hbase-prefix-tree-1.3.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-httpclient/commons-httpclient/3.1/commons-httpclient-3.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-codec/commons-codec/1.9/commons-codec-1.9.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-collections/commons-collections/3.2.2/commons-collections-3.2.2.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hbase/hbase-hadoop-compat/1.3.1/hbase-hadoop-compat-1.3.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hbase/hbase-hadoop2-compat/1.3.1/hbase-hadoop2-compat-1.3.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/yammer/metrics/metrics-core/2.2.0/metrics-core-2.2.0.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/slf4j/slf4j-api/1.7.2/slf4j-api-1.7.2.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/google/guava/guava/12.0.1/guava-12.0.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/google/protobuf/protobuf-java/2.5.0/protobuf-java-2.5.0.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/sun/jersey/jersey-core/1.9/jersey-core-1.9.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/sun/jersey/jersey-server/1.9/jersey-server-1.9.jar</span><br><span class="line">file:/home/zjc/.m2/repository/asm/asm/3.1/asm-3.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-cli/commons-cli/1.2/commons-cli-1.2.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-io/commons-io/2.4/commons-io-2.4.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-lang/commons-lang/2.6/commons-lang-2.6.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-logging/commons-logging/1.2/commons-logging-1.2.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/commons/commons-math/2.2/commons-math-2.2.jar</span><br><span class="line">file:/home/zjc/.m2/repository/log4j/log4j/1.2.17/log4j-1.2.17.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/zookeeper/zookeeper/3.4.6/zookeeper-3.4.6.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/slf4j/slf4j-log4j12/1.6.1/slf4j-log4j12-1.6.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/mortbay/jetty/jetty/6.1.26/jetty-6.1.26.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/mortbay/jetty/jetty-util/6.1.26/jetty-util-6.1.26.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/mortbay/jetty/jetty-sslengine/6.1.26/jetty-sslengine-6.1.26.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/mortbay/jetty/jsp-2.1/6.1.14/jsp-2.1-6.1.14.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/mortbay/jetty/jsp-api-2.1/6.1.14/jsp-api-2.1-6.1.14.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/mortbay/jetty/servlet-api-2.5/6.1.14/servlet-api-2.5-6.1.14.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/codehaus/jackson/jackson-core-asl/1.9.13/jackson-core-asl-1.9.13.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/codehaus/jackson/jackson-mapper-asl/1.9.13/jackson-mapper-asl-1.9.13.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/codehaus/jackson/jackson-jaxrs/1.9.13/jackson-jaxrs-1.9.13.jar</span><br><span class="line">file:/home/zjc/.m2/repository/tomcat/jasper-compiler/5.5.23/jasper-compiler-5.5.23.jar</span><br><span class="line">file:/home/zjc/.m2/repository/tomcat/jasper-runtime/5.5.23/jasper-runtime-5.5.23.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-el/commons-el/1.0/commons-el-1.0.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/jamon/jamon-runtime/2.4.1/jamon-runtime-2.4.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/io/netty/netty-all/4.0.23.Final/netty-all-4.0.23.Final.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/htrace/htrace-core/3.1.0-incubating/htrace-core-3.1.0-incubating.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/lmax/disruptor/3.3.0/disruptor-3.3.0.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-common/2.5.1/hadoop-common-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-annotations/2.5.1/hadoop-annotations-2.5.1.jar</span><br><span class="line">file:/usr/lib/jvm/java-8-oracle/lib/tools.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/commons/commons-math3/3.1.1/commons-math3-3.1.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/xmlenc/xmlenc/0.52/xmlenc-0.52.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-net/commons-net/3.1/commons-net-3.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/sun/jersey/jersey-json/1.9/jersey-json-1.9.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/codehaus/jettison/jettison/1.1/jettison-1.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/sun/xml/bind/jaxb-impl/2.2.3-1/jaxb-impl-2.2.3-1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/codehaus/jackson/jackson-xc/1.8.3/jackson-xc-1.8.3.jar</span><br><span class="line">file:/home/zjc/.m2/repository/net/java/dev/jets3t/jets3t/0.9.0/jets3t-0.9.0.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/httpcomponents/httpcore/4.1.2/httpcore-4.1.2.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/jamesmurty/utils/java-xmlbuilder/0.4/java-xmlbuilder-0.4.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-configuration/commons-configuration/1.6/commons-configuration-1.6.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-digester/commons-digester/1.8/commons-digester-1.8.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-beanutils/commons-beanutils/1.7.0/commons-beanutils-1.7.0.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-beanutils/commons-beanutils-core/1.8.0/commons-beanutils-core-1.8.0.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/avro/avro/1.7.4/avro-1.7.4.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/thoughtworks/paranamer/paranamer/2.3/paranamer-2.3.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/xerial/snappy/snappy-java/1.0.4.1/snappy-java-1.0.4.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/jcraft/jsch/0.1.42/jsch-0.1.42.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/commons/commons-compress/1.4.1/commons-compress-1.4.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/tukaani/xz/1.0/xz-1.0.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-auth/2.5.1/hadoop-auth-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/httpcomponents/httpclient/4.2.5/httpclient-4.2.5.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/directory/server/apacheds-kerberos-codec/2.0.0-M15/apacheds-kerberos-codec-2.0.0-M15.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/directory/server/apacheds-i18n/2.0.0-M15/apacheds-i18n-2.0.0-M15.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/directory/api/api-asn1-api/1.0.0-M20/api-asn1-api-1.0.0-M20.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/directory/api/api-util/1.0.0-M20/api-util-1.0.0-M20.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-client/2.5.1/hadoop-client-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-mapreduce-client-app/2.5.1/hadoop-mapreduce-client-app-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-mapreduce-client-common/2.5.1/hadoop-mapreduce-client-common-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-yarn-client/2.5.1/hadoop-yarn-client-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/sun/jersey/jersey-client/1.9/jersey-client-1.9.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-yarn-server-common/2.5.1/hadoop-yarn-server-common-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-mapreduce-client-shuffle/2.5.1/hadoop-mapreduce-client-shuffle-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/fusesource/leveldbjni/leveldbjni-all/1.8/leveldbjni-all-1.8.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-yarn-api/2.5.1/hadoop-yarn-api-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-mapreduce-client-jobclient/2.5.1/hadoop-mapreduce-client-jobclient-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-mapreduce-client-core/2.5.1/hadoop-mapreduce-client-core-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-yarn-common/2.5.1/hadoop-yarn-common-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/javax/xml/bind/jaxb-api/2.2.2/jaxb-api-2.2.2.jar</span><br><span class="line">file:/home/zjc/.m2/repository/javax/xml/stream/stax-api/1.0-2/stax-api-1.0-2.jar</span><br><span class="line">file:/home/zjc/.m2/repository/javax/activation/activation/1.1/activation-1.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/javax/servlet/servlet-api/2.5/servlet-api-2.5.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/google/inject/guice/3.0/guice-3.0.jar</span><br><span class="line">file:/home/zjc/.m2/repository/javax/inject/javax.inject/1/javax.inject-1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/aopalliance/aopalliance/1.0/aopalliance-1.0.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/sun/jersey/contribs/jersey-guice/1.9/jersey-guice-1.9.jar</span><br><span class="line">file:/home/zjc/.m2/repository/com/google/inject/extensions/guice-servlet/3.0/guice-servlet-3.0.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hadoop/hadoop-hdfs/2.5.1/hadoop-hdfs-2.5.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/commons-daemon/commons-daemon/1.0.13/commons-daemon-1.0.13.jar</span><br><span class="line">file:/home/zjc/.m2/repository/junit/junit/4.12/junit-4.12.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/hamcrest/hamcrest-core/1.3/hamcrest-core-1.3.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hbase/hbase-client/1.3.1/hbase-client-1.3.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/apache/hbase/hbase-annotations/1.3.1/hbase-annotations-1.3.1.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/jruby/jcodings/jcodings/1.0.8/jcodings-1.0.8.jar</span><br><span class="line">file:/home/zjc/.m2/repository/org/jruby/joni/joni/2.1.2/joni-2.1.2.jar</span><br></pre></td></tr></table></figure><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>启动器加载路径</p><ol><li>安装目录/jre/lib/</li><li>安装目录/jre/classes</li></ol><p>扩展类加载器</p><ol><li>安装目录/jre/lib/ext/</li></ol><p>应用类加载器</p><ol><li>不指定情况下是<code>./</code>目录,即当前目录</li></ol><h1 id="类加载器的”辈份”"><a href="#类加载器的”辈份”" class="headerlink" title="类加载器的”辈份”"></a>类加载器的”辈份”</h1><h2 id="类加载器的执行顺序"><a href="#类加载器的执行顺序" class="headerlink" title="类加载器的执行顺序"></a>类加载器的执行顺序</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClassLoader</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"当前类加载器是:"</span> + TestClassLoader.class.getClassLoader());</span><br><span class="line">System.out.println(<span class="string">"父类加载器是:"</span> + TestClassLoader.class.getClassLoader().getParent());</span><br><span class="line">System.out.println(<span class="string">"爷爷类加载器是:"</span> + TestClassLoader.class.getClassLoader().getParent().getParent());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打印结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当前类加载器是:sun.misc.Launcher$AppClassLoader@73d16e93</span><br><span class="line">父类加载器是:sun.misc.Launcher$ExtClassLoader@15db9742</span><br><span class="line">爷爷类加载器是:null</span><br></pre></td></tr></table></figure><p>也就是说三者顺序如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">启动类加载器 &gt; 扩展类加载器 &gt; 应用类加载器</span><br></pre></td></tr></table></figure><h2 id="启动类加载器打印为null说明"><a href="#启动类加载器打印为null说明" class="headerlink" title="启动类加载器打印为null说明"></a>启动类加载器打印为null说明</h2><ul><li>因为启动类加载器不是用java写的,因为执行完启动类加载器后才会将java的核心类加载.</li><li>也就是说,启动类加载器是用系统语言写的(比如是c++)</li><li>所以不可能打印出扩展类加载器或应用类加载器那样的java的类,只能是null</li></ul><h1 id="双亲委派机制"><a href="#双亲委派机制" class="headerlink" title="双亲委派机制"></a>双亲委派机制</h1><ol><li>应用类加载器要加载环境变量classpath下的类</li><li>但不直接加载,而是交给父类加载器,即扩展类加载器加载</li><li>但不直接加载,而是交给父类加载器,即启动类加载器加载</li><li>如果启动类加载器能加载到则使用启动类加载到的类,否则返回null(返回null而不是抛出错误是因为此时不是java)</li><li>扩展类加载器收到null的情况下,才尝试加载,如果能加载到就使用扩展类加载器加载到的类,否则抛出异常</li><li>应用类加载器收到异常的情况下,才尝试加载,如果能加载到就使用应用类加载器加载到的类,否则抛出<code>ClassNotFound</code>异常</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java细节 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装和删除字体</title>
      <link href="/2020/06/04/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E5%92%8C%E5%88%A0%E9%99%A4%E5%AD%97%E4%BD%93/"/>
      <url>/2020/06/04/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E5%92%8C%E5%88%A0%E9%99%A4%E5%AD%97%E4%BD%93/</url>
      
        <content type="html"><![CDATA[<h1 id="通过命令管理字体"><a href="#通过命令管理字体" class="headerlink" title="通过命令管理字体"></a>通过命令管理字体</h1><h2 id="安装字体"><a href="#安装字体" class="headerlink" title="安装字体"></a>安装字体</h2><p>linux系统的字体文件放在/usr/share/fonts/目录以及用户的<del>/.fonts和</del>/.local/share/fonts目录下，第一个位置为系统所用用户共享，将字体安装到这个目录需要管理员权限；后面两个位置则为当前登陆用户所有,安装字体到这个目录不需要管理员权限。</p><ol><li><p>安装到 /usr/share/fonts/ (需要管理员权限)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 下载字体</span><br><span class="line">wget https://github.com/fangwentong/dotfiles/raw/master/ubuntu-gui/fonts/Monaco.ttf</span><br><span class="line"></span><br><span class="line"># 安装字体</span><br><span class="line">sudo mkdir -p /usr/share/fonts/custom</span><br><span class="line">sudo mv Monaco.ttf /usr/share/fonts/custom</span><br><span class="line">sudo chmod 744 /usr/share/fonts/custom/Monaco.ttf</span><br><span class="line"></span><br><span class="line">sudo mkfontscale  #生成核心字体信息</span><br><span class="line">sudo mkfontdir</span><br><span class="line">sudo fc-cache -fv</span><br></pre></td></tr></table></figure></li><li><p>安装到 ~/.fonts/ (安装到 ~/.local/share/fonts 原理相同)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 下载字体</span><br><span class="line">wget https://github.com/fangwentong/dotfiles/blob/ubuntu/fonts/Monaco.ttf?raw=true</span><br><span class="line"></span><br><span class="line"># 安装字体</span><br><span class="line">mkdir -p ~/.fonts</span><br><span class="line">mv Monaco.ttf ~/.fonts</span><br><span class="line">fc-cache -vf  #刷新系统字体缓存</span><br></pre></td></tr></table></figure></li></ol><h2 id="卸载字体"><a href="#卸载字体" class="headerlink" title="卸载字体"></a>卸载字体</h2><p>若不再需要某个字体，可以删除相应字体文件，刷新系统字体缓存即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fc-cache -vf  #刷新系统字体缓存</span><br></pre></td></tr></table></figure><h1 id="通过图形界面"><a href="#通过图形界面" class="headerlink" title="通过图形界面"></a>通过图形界面</h1><h2 id="系统自带工具安装"><a href="#系统自带工具安装" class="headerlink" title="系统自带工具安装"></a>系统自带工具安装</h2><p>这种方法的优点是安装前能预览字体效果，安装过程简单便捷，动几下鼠标就完成了安装，非常适合在图形界面下安装; 缺点是安装借助图形化工具，无法通过自动化脚本安装。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+   首先到这里下载字体,这里用Monaco.ttf进行说明</span><br><span class="line">+   然后在Ubuntu系统中，双击下载得到的Monaco.ttf文件，即用系统自带的字体查看器打开了该文件，点击面板上的安装按钮，即可完成安装</span><br><span class="line">+   这种方法安装后，字体文件存放在~/.local/share/fonts目录下。</span><br></pre></td></tr></table></figure><h2 id="安装第三方工具"><a href="#安装第三方工具" class="headerlink" title="安装第三方工具"></a>安装第三方工具</h2><ol><li><p>安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install font-manager</span><br></pre></td></tr></table></figure></li><li><p>界面<br><img src="/images/2020/06/20200604003.png" alt></p></li></ol><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.kutu66.com/ubuntu/article_165241" target="_blank" rel="noopener">在ubuntu中，如何删除字体</a><br><a href="https://blog.wentong.me/2014/05/add-fonts-to-your-linux/" target="_blank" rel="noopener">在linux中安装/卸载字体</a></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装Ganglia</title>
      <link href="/2020/06/04/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85Ganglia/"/>
      <url>/2020/06/04/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85Ganglia/</url>
      
        <content type="html"><![CDATA[<p>这里的系统是Ubuntu18.04</p><h1 id="依赖安装"><a href="#依赖安装" class="headerlink" title="依赖安装"></a>依赖安装</h1><h2 id="安装apache2服务-cendos下的httpd服务"><a href="#安装apache2服务-cendos下的httpd服务" class="headerlink" title="安装apache2服务(cendos下的httpd服务)"></a>安装apache2服务(cendos下的httpd服务)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install apache2</span><br></pre></td></tr></table></figure><h2 id="安装php"><a href="#安装php" class="headerlink" title="安装php"></a>安装php</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install php7.2</span><br></pre></td></tr></table></figure><h2 id="安装rrdtool"><a href="#安装rrdtool" class="headerlink" title="安装rrdtool"></a>安装rrdtool</h2><ol><li><p>说明<br>RRDtool用于数据存储和可视化，可以方便地对机器性能及系统运行状态进行可视化监控，广泛应用于对Hadoop，Spark等分布式系统的监测管理。轮询调度数据库，用于存储数据和可视化时间序列。RRD 也被用于生成用户界面的 web 前端。</p></li><li><p>安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install rrdtool</span><br></pre></td></tr></table></figure></li></ol><h1 id="ganglia简介"><a href="#ganglia简介" class="headerlink" title="ganglia简介"></a>ganglia简介</h1><p>Ganglia的核心包含 gmond、gmetad 以及一个 Web 接界面。主要是用来监控系统性能，如：cpu 、mem、硬盘利用率， I/O 负载、网络流量情况等，通过曲线很容易见到每个节点的工作状态，对合理调整、分配系统资源，提高系统整体性能起到重要作用。<br><img src="/images/2020/06/20200604001.png" alt></p><h2 id="Gmod"><a href="#Gmod" class="headerlink" title="Gmod"></a>Gmod</h2><p>Ganglia monitoring，它是一个守护进程，用于收集机器内的 metric，它还可以接受别的 node 发送过来的 metric，并且保存一小段时间（几十秒），运行在每一个需要监测的节点上，收集监测统计，发送和接受在同一个组播或单播通道上的统计信息。Gmond 可以扮演下面三种角色：</p><ul><li>收集 metric 并发送出去，同时也接收别的 node 发送过来的 metric；</li><li>只采集 metric 并发送出去（关键字 deaf）；</li><li>只接收别的机器发送过来的 metric（关键字 mute）； 默认情况下，gmond 监听 8649 端口，用来发送和接收 udp，tcp 数据包。</li></ul><h2 id="Gmetad"><a href="#Gmetad" class="headerlink" title="Gmetad"></a>Gmetad</h2><p>Ganglia meta daemon，也是一个守护进程，定期检查 gmonds ，从那里拉取数据，并将他们的指标存储在 RRD 存储引擎中。它可以查询多个集群并聚合指标。默认情况下 gmond 通过 multicast 的方式发送自己采集到的数据，整个 Multicast group 里的 node 都拥有整个 cluster 的全部 metrics。而 gmetad 可以从一个 cluster 的任意一个 node 拿到整个 cluster 的全部 metric 并记录到 rrd 数据库。 默认情况下，gmetad 监听 8651 端口，从这里可以拿到 gmetad 存放的最新 metric 数据，也可以给更高层的 gmetad 使用；监听 8652 端口，提供数据查询接口，供 web 使用。</p><h1 id="安装ganglia"><a href="#安装ganglia" class="headerlink" title="安装ganglia"></a>安装ganglia</h1><h2 id="主节点-master-node-安装"><a href="#主节点-master-node-安装" class="headerlink" title="主节点(master node)安装"></a>主节点(master node)安装</h2><ol><li><p>安装ganglia-monitor</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ganglia-monitor</span><br></pre></td></tr></table></figure></li><li><p>安装gmetad</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gmetad</span><br></pre></td></tr></table></figure></li><li><p>安装ganglia-webfrontend</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ganglia-webfrontend</span><br></pre></td></tr></table></figure></li></ol><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><ol><li><p>修改/etc/ganglia/gmond.conf配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 修改Cluster name</span><br><span class="line">cluster &#123;</span><br><span class="line">  name = &quot;localhost&quot; ## use the name from gmetad.conf 需要和gmetad的配置文件名相同</span><br><span class="line">  owner = &quot;unspecified&quot;</span><br><span class="line">  latlong = &quot;unspecified&quot;</span><br><span class="line">  url = &quot;unspecified&quot;</span><br><span class="line">&#125;</span><br><span class="line"># 修改 udp_send_channel，添加 host</span><br><span class="line">udp_send_channel = &#123;</span><br><span class="line">  # mcast_join = xxx.xxx.xxx.xxx</span><br><span class="line">  host = localhost</span><br><span class="line">  port = 8649</span><br><span class="line">  ttl = 1</span><br><span class="line">&#125;</span><br><span class="line"># 修改 udp_recv_channel，注释掉 mcast_join, bind</span><br><span class="line">udp_recv_channel = &#123;</span><br><span class="line">  # mcast_join = xxx.xxx.xxx.xxx</span><br><span class="line">  port = 8649</span><br><span class="line">  bind = localhost</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>修改/etc/ganglia/gmetad.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># data_source可以这样配置</span><br><span class="line"># data_source &quot;my cluster&quot; 10 localhost  my.machine.edu:8649  1.2.3.5:8655</span><br><span class="line"># data_source &quot;my grid&quot; 50 1.3.4.7:8655 grid.org:8651 grid-backup.org:8651</span><br><span class="line"># data_source &quot;another source&quot; 1.3.4.7:8655  1.3.4.8</span><br><span class="line"># data_source &quot;ganglia&quot; localhost  #&quot;群集名称(和前面配置保持一致)&quot; 轮询时间  ip地址或名称（名称需要可以解析）</span><br><span class="line"></span><br><span class="line">data_source &quot;localhost&quot; localhost   # 需要配置和gmond.conf相同</span><br><span class="line"></span><br><span class="line"># gridname &quot;域名&quot;  #任意写,也可不写</span><br></pre></td></tr></table></figure></li><li><p>如果有多台主机则需要在数据源那行增加所有主机的ip</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data_source &quot;ganglia&quot; localhost  #“群集名称” 轮询时间  ip地址或名称（名称需要可以解析）</span><br><span class="line">data_source &quot;web&quot; 192.168.2.146 192.168.2.98</span><br></pre></td></tr></table></figure></li><li><p>重启 ganglia-monitor 和 gmetad 服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart gmetad.service</span><br><span class="line">systemctl restart ganglia-monitor.service</span><br></pre></td></tr></table></figure></li></ol><h2 id="配置ganglia-webfrontend-配置apache2"><a href="#配置ganglia-webfrontend-配置apache2" class="headerlink" title="配置ganglia-webfrontend(配置apache2)"></a>配置ganglia-webfrontend(配置apache2)</h2><ol><li>查看apache2的默认访问目录<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/apache2/sites-enabled/000-default</span><br></pre></td></tr></table></figure></li></ol><p>找到DocumentRoot,我这里是</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DocumentRoot /var/www/html</span><br></pre></td></tr></table></figure><ol start="2"><li><p>我们需要将ganglia-webfronted的web相关代码链接到apache可以访问的位置或者移动到apache可以访问的目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /usr/share/ganglia-webfrontend/ /var/www/html/ganglia</span><br><span class="line">或者</span><br><span class="line">sudo mv /usr/share/ganglia-webfrontend/   /var/www/html/ganglia</span><br></pre></td></tr></table></figure></li><li><p>重启apache2</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart apache2.service</span><br></pre></td></tr></table></figure></li></ol><h1 id="配置完成-访问"><a href="#配置完成-访问" class="headerlink" title="配置完成,访问"></a>配置完成,访问</h1><p>然后在浏览器输入<a href="http://serverIP/ganglia" target="_blank" rel="noopener">http://serverIP/ganglia</a> 即可访问<br><img src="/images/2020/06/20200604002.png" alt></p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://blog.csdn.net/Scape1989/article/details/19252431" target="_blank" rel="noopener">ubuntu安装ganglia</a><br><a href="https://www.xitongjiaocheng.com/ubuntu/2018/64390.html" target="_blank" rel="noopener">ubuntu16.04安装ganglia</a></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu开启smb协议与手机互联</title>
      <link href="/2020/05/29/Ubuntu%E5%BC%80%E5%90%AFsmb%E5%8D%8F%E8%AE%AE%E4%B8%8E%E6%89%8B%E6%9C%BA%E4%BA%92%E8%81%94/"/>
      <url>/2020/05/29/Ubuntu%E5%BC%80%E5%90%AFsmb%E5%8D%8F%E8%AE%AE%E4%B8%8E%E6%89%8B%E6%9C%BA%E4%BA%92%E8%81%94/</url>
      
        <content type="html"><![CDATA[<h1 id="samba的安装"><a href="#samba的安装" class="headerlink" title="samba的安装"></a>samba的安装</h1><h2 id="方式一-命令行安装"><a href="#方式一-命令行安装" class="headerlink" title="方式一:命令行安装"></a>方式一:命令行安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get insall samba</span><br><span class="line">sudo apt-get install smbfs</span><br></pre></td></tr></table></figure><h2 id="方式二-图形界面gnome中安装"><a href="#方式二-图形界面gnome中安装" class="headerlink" title="方式二:图形界面gnome中安装"></a>方式二:图形界面gnome中安装</h2><ol><li>在需要共享的目录中右键(这个也可以在属性中找到)<br><img src="/images/2020/05/20200529022.png" alt></li><li>选择共享此目录后创建共享<br><img src="/images/2020/05/20200529023.png" alt></li><li>如果没有安装smba会自动提示你需要安装</li></ol><h1 id="创建共享目录"><a href="#创建共享目录" class="headerlink" title="创建共享目录"></a>创建共享目录</h1><h2 id="方式一-命令行创建"><a href="#方式一-命令行创建" class="headerlink" title="方式一:命令行创建"></a>方式一:命令行创建</h2><ol><li><p>创建需要共享的目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#   注意：XXX为用户名</span><br><span class="line">mkdir /home/XXX/share</span><br><span class="line">sudo chmod 777 /home/XXX/share</span><br></pre></td></tr></table></figure></li><li><p>将上述创建的文件夹添加到配置文件中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/samba/smb.conf /etc/samba/smb.conf.bak</span><br><span class="line">sudo vim /etc/samba/smb.conf</span><br><span class="line"></span><br><span class="line">#   在smb.conf最后添加</span><br><span class="line">[share]</span><br><span class="line">　　path = /home/XXX/share</span><br><span class="line">　　available = yes</span><br><span class="line">　　browsealbe = yes</span><br><span class="line">　　public = yes</span><br><span class="line">　　writable = yes</span><br></pre></td></tr></table></figure></li></ol><h2 id="方式二-图形界面gnome中创建"><a href="#方式二-图形界面gnome中创建" class="headerlink" title="方式二:图形界面gnome中创建"></a>方式二:图形界面gnome中创建</h2><ol><li>在需要共享的目录中右键(这个也可以在属性中找到)<br><img src="/images/2020/05/20200529022.png" alt></li><li>选择共享此目录后创建共享<br><img src="/images/2020/05/20200529023.png" alt></li><li>这样就共享了这个目录</li></ol><h1 id="配置其他设备连接时的用户名密码"><a href="#配置其他设备连接时的用户名密码" class="headerlink" title="配置其他设备连接时的用户名密码"></a>配置其他设备连接时的用户名密码</h1><h2 id="配置用户名和密码"><a href="#配置用户名和密码" class="headerlink" title="配置用户名和密码"></a>配置用户名和密码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo touch /etc/samba/smbpasswd</span><br><span class="line">sudo smbpasswd -a username</span><br><span class="line">然后会要求你输入samba帐户的密码</span><br></pre></td></tr></table></figure><p>注意</p><ol><li>如果没有配置目录，当你登录时会提示<code>session setup failed: NT_STATUS_LOGON_FAILURE</code></li><li>前面添加的用户必须是系统中存在的用户,不能凭空乱写,否则也会报错</li></ol><h2 id="重启samba服务器"><a href="#重启samba服务器" class="headerlink" title="重启samba服务器"></a>重启samba服务器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#   ubuntu比较乱,有可能是老版本的</span><br><span class="line">sudo /etc/init.d/samba restart</span><br><span class="line"></span><br><span class="line">#   而ubuntu18.04是底下这个命令</span><br><span class="line">sudo service smbd restart</span><br><span class="line"></span><br><span class="line">#   也有可能使用systemctl,这个看自己的机子</span><br></pre></td></tr></table></figure><h2 id="测试一下"><a href="#测试一下" class="headerlink" title="测试一下"></a>测试一下</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient -L //localhost/share</span><br></pre></td></tr></table></figure><h1 id="配置防火墙-非必要步骤"><a href="#配置防火墙-非必要步骤" class="headerlink" title="配置防火墙(非必要步骤)"></a>配置防火墙(非必要步骤)</h1><p>我是ubuntu18.04,又我习惯让局域网内可以连接的,所以使用如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#   查看现有规则</span><br><span class="line">sudo ufw status numbered</span><br><span class="line"></span><br><span class="line">#   配置错了可以用如下命令删除</span><br><span class="line">sudo ufw delete 序号</span><br><span class="line"></span><br><span class="line">#   我本地添加的规则,让局域网内能够连接</span><br><span class="line">sudo ufw allow from 192.168.0.0/16 to any app Samba</span><br><span class="line"></span><br><span class="line">#   也可以直接关闭防火墙</span><br><span class="line">ufw enable/disable  #   打开/关闭ufw</span><br></pre></td></tr></table></figure><h1 id="手机连接"><a href="#手机连接" class="headerlink" title="手机连接"></a>手机连接</h1><h2 id="首先查看电脑的ip"><a href="#首先查看电脑的ip" class="headerlink" title="首先查看电脑的ip"></a>首先查看电脑的ip</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p><img src="/images/2020/05/20200529029.png" alt></p><h2 id="手机连接-1"><a href="#手机连接-1" class="headerlink" title="手机连接"></a>手机连接</h2><ol><li><p>这里我们使用<code>iphone</code>自带的<code>文件</code>进行连接,如果iphone的文件没有如下功能则是ios版本太低,可以另外下app,比如<code>FileExplorer</code>等,只要能使用smb协议的都行<br><img src="/images/2020/05/20200529028.png" alt></p></li><li><p>连接服务器<br><img src="/images/2020/05/20200529024.png" alt></p></li><li><p>键入smb服务器地址,ip和我们前面查的保持一致<br><img src="/images/2020/05/20200529025.png" alt></p></li><li><p>键入用户名和密码(如果是客人的不需要用户名密码,但目录的权限相对的需要更改)<br><img src="/images/2020/05/20200529026.png" alt></p></li><li><p>可以看到,我们连接上了<br><img src="/images/2020/05/20200529027.png" alt></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中wps英文版如何改为中文版</title>
      <link href="/2020/05/28/Ubuntu%E4%B8%ADwps%E8%8B%B1%E6%96%87%E7%89%88%E5%A6%82%E4%BD%95%E6%94%B9%E4%B8%BA%E4%B8%AD%E6%96%87%E7%89%88/"/>
      <url>/2020/05/28/Ubuntu%E4%B8%ADwps%E8%8B%B1%E6%96%87%E7%89%88%E5%A6%82%E4%BD%95%E6%94%B9%E4%B8%BA%E4%B8%AD%E6%96%87%E7%89%88/</url>
      
        <content type="html"><![CDATA[<p>点击右上角那个A的标志进行切换</p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tampermonkey增加去除简书的推荐阅读脚本</title>
      <link href="/2020/05/22/Tampermonkey%E5%A2%9E%E5%8A%A0%E5%8E%BB%E9%99%A4%E7%AE%80%E4%B9%A6%E7%9A%84%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB%E8%84%9A%E6%9C%AC/"/>
      <url>/2020/05/22/Tampermonkey%E5%A2%9E%E5%8A%A0%E5%8E%BB%E9%99%A4%E7%AE%80%E4%B9%A6%E7%9A%84%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         去除简书掘金的多余信息</span></span><br><span class="line"><span class="comment">// @description  去除简书掘金的多余信息，比如推荐阅读，一言难尽, 并不想看到</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @author       zjc</span></span><br><span class="line"><span class="comment">// @match        *://www.jianshu.com/p/*</span></span><br><span class="line"><span class="comment">// @match        *://juejin.im/post/*</span></span><br><span class="line"><span class="comment">// @require      https://code.jquery.com/jquery-2.2.4.min.js</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 等待 1s 后执行</span></span><br><span class="line">    <span class="comment">// var timer = setTimeout(function()&#123;&#125;,1000);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每 0.1s 执行</span></span><br><span class="line">    <span class="keyword">var</span> interval = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 简书</span></span><br><span class="line">        <span class="comment">// 去除两个推荐阅读 (._3Z3nHf)</span></span><br><span class="line">        <span class="keyword">if</span>($(<span class="string">"._3Z3nHf"</span>).length === <span class="number">2</span>)&#123;</span><br><span class="line">            $(<span class="string">"._3Z3nHf"</span>).remove();</span><br><span class="line">            clearInterval(interval);</span><br><span class="line">        &#125;</span><br><span class="line">        $(<span class="string">"._gp-ck section"</span>).last().hide();</span><br><span class="line">        $(<span class="string">"._gp-ck .QxT4hD"</span>).hide();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 掘金</span></span><br><span class="line">        $(<span class="string">".main-area.recommended-area.shadow"</span>).hide();</span><br><span class="line">        $(<span class="string">".sidebar-block.related-entry-sidebar-block.shadow"</span>).hide();</span><br><span class="line">        $(<span class="string">".index-book-collect"</span>).hide();</span><br><span class="line">        $(<span class="string">".tag-list-box"</span>).hide();</span><br><span class="line">        $(<span class="string">".article-banner"</span>).hide();</span><br><span class="line">        $(<span class="string">".sidebar-block.author-block.shadow"</span>).hide();</span><br><span class="line">    &#125;,<span class="number">100</span>);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tampermonkey </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tampermonkey </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shell中no Login和login的区别</title>
      <link href="/2020/05/11/shell%E4%B8%ADnologin%E5%92%8Clogin%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2020/05/11/shell%E4%B8%ADnologin%E5%92%8Clogin%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是nologin-shell和login-shell？"><a href="#什么是nologin-shell和login-shell？" class="headerlink" title="什么是nologin shell和login shell？"></a>什么是nologin shell和login shell？</h1><p>按照bash文档的说法，login shell是第0个参数以<code>-</code>开头或者有一个参数为<code>-login</code>的shell。</p><blockquote><p>  A login shell is one whose first character of argument zero is a -, or one started with the –login option.</p></blockquote><ul><li>根据该定义，我们可以使用<code>bash --login</code>启动一个login shell或者通过<code>echo $0</code>的输出结果是否以<code>-</code>开头来判断一个shell是否为login shell。</li><li>经过测试<ul><li>通过图形界面启动的终端为no login shell</li><li>通过ssh远程连接得到的shell为login shell。</li></ul></li></ul><h1 id="为什么要关注是login-shell还是no-login-shell？"><a href="#为什么要关注是login-shell还是no-login-shell？" class="headerlink" title="为什么要关注是login shell还是no login shell？"></a>为什么要关注是login shell还是no login shell？</h1><p>区分login shell和no login shell的主要原因是它们启动和退出时自动执行的脚本不同。</p><h2 id="login-shell"><a href="#login-shell" class="headerlink" title="login shell"></a>login shell</h2><p>对于login shell其启动时自动执行的脚本文件顺序如下</p><ol><li>首先执行<code>/etc/profile</code></li><li>再执行<code>~/.bash_profile</code>, <code>~/.bash_login</code>, <code>~/.profile</code>中第一个存在的脚本（按顺序搜索，只会执行其中一个）</li></ol><p>如果shell启动时添加了<code>--noprofile</code>选项则不会执行上述文件。在login shell退出时，会执行<code>~/.bash_logout</code></p><h2 id="no-login-shell"><a href="#no-login-shell" class="headerlink" title="no login shell"></a>no login shell</h2><p>对于no login shell，启动时会执行<code>/etc/bash.bashrc</code>和<code>~/.bashrc</code>，如果shell启动时添加了<code>--norc</code>选项则不会执行上述文件，如果添加了<code>--rcfile &lt;filename&gt;</code>选项则会执行指定的filename文件，也不会执行上述文件。no login shell退出时不会自动执行脚本文件。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul><li>no login shell和login shell在启动和退出时会执行不同的脚本文件从而影响shell中的环境变量，本文根据bash的文档描述了两种shell启动时自动执行的脚本文件的区别。</li><li>login shell和no login shell启动时执行的脚本文件是完全不同的，因此，运行环境初始化脚本需要合理配置才能让login shell和no login shell都能执行，同时也可以为login shell和no login shell配置不同的运行环境初始化脚本。</li></ul><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul><li><a href="https://linux.die.net/man/1/bash" target="_blank" rel="noopener">Linux man page(bash)</a></li><li><a href="https://blog.csdn.net/j5856004/article/details/100638931" target="_blank" rel="noopener">no login shell和login shell</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Getent命令:用来查看系统的数据库中的相关记录</title>
      <link href="/2020/05/11/getent%E5%91%BD%E4%BB%A4-%E7%94%A8%E6%9D%A5%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3%E8%AE%B0%E5%BD%95/"/>
      <url>/2020/05/11/getent%E5%91%BD%E4%BB%A4-%E7%94%A8%E6%9D%A5%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>getent命令帮助用户administrative databases中查找相关信息。administrative databases包括：</p><ul><li>passwd – can be used to confirm usernames, userids, home directories and full names of your users</li><li>group – all the information about Unix groups known to your system</li><li>services – all the Unix services configured on your system</li><li>networks – networking information – what networks your system belongs to</li><li>protocols – everything your system knows about network protocols</li></ul><h1 id="一般语法"><a href="#一般语法" class="headerlink" title="一般语法"></a>一般语法</h1><ul><li>getent database [key …]</li><li>getent [选项…] 数据库 [键 …]</li><li>getent会在上面数据库中产找key对应的value</li></ul><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-s, –service=CONFIG</td><td>要使用的服务配置</td></tr><tr><td>-?, –help</td><td>给出该系统求助列表</td></tr><tr><td>–usage</td><td>给出简要的用法信息</td></tr><tr><td>-V, –version</td><td>打印程序版本号</td></tr></tbody></table><h1 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h1><h2 id="查找hostname对应的IP"><a href="#查找hostname对应的IP" class="headerlink" title="查找hostname对应的IP"></a>查找hostname对应的IP</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ubuntu$ getent hosts ubuntu</span><br><span class="line">127.0.1.1       ubuntu</span><br><span class="line">192.168.0.2     ubuntu</span><br></pre></td></tr></table></figure><h2 id="执行反向DNS查询（即根据域名查找对应IP）"><a href="#执行反向DNS查询（即根据域名查找对应IP）" class="headerlink" title="执行反向DNS查询（即根据域名查找对应IP）"></a>执行反向DNS查询（即根据域名查找对应IP）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu$ getent hosts myhost.mydomain.com</span><br><span class="line">15.77.3.40       myhost.mydomain.com myhost</span><br></pre></td></tr></table></figure><h2 id="根据用户名查找UID"><a href="#根据用户名查找UID" class="headerlink" title="根据用户名查找UID"></a>根据用户名查找UID</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu$ getent passwd greys</span><br><span class="line">greys:x:1000:1000:Gleb Reys,,,:/home/greys:/bin/bas</span><br></pre></td></tr></table></figure><h2 id="根据UID查找用户名"><a href="#根据UID查找用户名" class="headerlink" title="根据UID查找用户名"></a>根据UID查找用户名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu$ getent passwd 1000</span><br><span class="line">greys:x:1000:1000:Gleb Reys,,,:/home/greys:/bin/bash</span><br></pre></td></tr></table></figure><h2 id="获取当前登陆用户的信息"><a href="#获取当前登陆用户的信息" class="headerlink" title="获取当前登陆用户的信息"></a>获取当前登陆用户的信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ubuntu$ getent passwd `whoami`</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br></pre></td></tr></table></figure><h2 id="查找那个服务在使用特定端口"><a href="#查找那个服务在使用特定端口" class="headerlink" title="查找那个服务在使用特定端口"></a>查找那个服务在使用特定端口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ getent services 22</span><br><span class="line">ssh                   22/tcp</span><br><span class="line">$ getent services 21</span><br><span class="line">ftp                   21/tcp</span><br><span class="line">$ getent services 25</span><br><span class="line">smtp                  25/tcp mail</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>骑士周游问题</title>
      <link href="/2020/05/09/%E9%AA%91%E5%A3%AB%E5%91%A8%E6%B8%B8%E9%97%AE%E9%A2%98/"/>
      <url>/2020/05/09/%E9%AA%91%E5%A3%AB%E5%91%A8%E6%B8%B8%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="马踏棋盘算法介绍和游戏演示"><a href="#马踏棋盘算法介绍和游戏演示" class="headerlink" title="马踏棋盘算法介绍和游戏演示"></a>马踏棋盘算法介绍和游戏演示</h1><ul><li>马踏棋盘算法也被称为骑士周游问题</li><li>将马随机放在国际象棋的 8× 8 棋盘 <code>Board[0～7][0～7]</code>的某个方格中， 马按走棋规则(马走日字)进行移动。 要求每个方格只进入一次， 走遍棋盘上全部 64 个方格</li><li>游戏演示: <a href="http://www.4399.com/flash/146267_2.htm" target="_blank" rel="noopener">http://www.4399.com/flash/146267_2.htm</a></li></ul><p><img src="/images/2020/08/20200809160118.png" alt></p><h1 id="马踏棋盘游戏分析"><a href="#马踏棋盘游戏分析" class="headerlink" title="马踏棋盘游戏分析"></a>马踏棋盘游戏分析</h1><ol><li><p>马踏棋盘问题(骑士周游问题)实际上是图的深度优先搜索(DFS)的应用。</p></li><li><p>如果使用回溯（就是深度优先搜索） 来解决， 假如马儿踏了 53 个点， 如图： 走到了第 53 个， 坐标（1,0） ， 发现已经走到尽头， 没办法， 那就只能回退了，查看其他的路径， 就在棋盘上不停的回溯……<br>对第一种实现方式的思路图解<br><img src="/images/2020/08/20200809160159.png" alt></p></li><li><p>分析第一种方式的问题， 并使用贪心算法（greedyalgorithm） 进行优化。 解决马踏棋盘问题.<br><img src="/images/2020/08/20200809160208.png" alt></p></li><li><p>使用前面的游戏来验证算法是否正确。</p></li></ol><h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.algorithm.horse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Point;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HorseChessboard</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> X; <span class="comment">// 棋盘的列数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> Y; <span class="comment">// 棋盘的行数</span></span><br><span class="line">    <span class="comment">// 创建一个数组， 标记棋盘的各个位置是否被访问过</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> visited[];</span><br><span class="line">    <span class="comment">// 使用一个属性， 标记是否棋盘的所有位置都被访问</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> finished; <span class="comment">// 如果为 true,表示成功</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"骑士周游算法， 开始运行~~"</span>);</span><br><span class="line">        <span class="comment">// 测试骑士周游算法是否正确</span></span><br><span class="line">        X = <span class="number">8</span>;</span><br><span class="line">        Y = <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">int</span> row = <span class="number">1</span>; <span class="comment">// 马儿初始位置的行， 从 1 开始编号</span></span><br><span class="line">        <span class="keyword">int</span> column = <span class="number">1</span>; <span class="comment">// 马儿初始位置的列， 从 1 开始编号</span></span><br><span class="line">        <span class="comment">// 创建棋盘</span></span><br><span class="line">        <span class="keyword">int</span>[][] chessboard = <span class="keyword">new</span> <span class="keyword">int</span>[X][Y];</span><br><span class="line">        visited = <span class="keyword">new</span> <span class="keyword">boolean</span>[X * Y];<span class="comment">// 初始值都是 false</span></span><br><span class="line">        <span class="comment">// 测试一下耗时</span></span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        traversalChessboard(chessboard, row - <span class="number">1</span>, column - <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">long</span> end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">"共耗时: "</span> + (end - start) + <span class="string">" 毫秒"</span>);</span><br><span class="line">        <span class="comment">// 输出棋盘的最后情况</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] rows : chessboard) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> step : rows) &#123;</span><br><span class="line">                System.out.print(step + <span class="string">"\t"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 完成骑士周游问题的算法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chessboard 棋盘</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> row 马儿当前的位置的行 从 0 开始</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> column 马儿当前的位置的列 从 0 开始</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> step 是第几步 ,初始位置就是第 1 步</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">traversalChessboard</span><span class="params">(<span class="keyword">int</span>[][] chessboard, <span class="keyword">int</span> row,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> column, <span class="keyword">int</span> step)</span> </span>&#123;</span><br><span class="line">        chessboard[row][column] = step;</span><br><span class="line">        <span class="comment">// row = 4 X = 8 column = 4 = 4 * 8 + 4 = 36</span></span><br><span class="line">        visited[row * X + column] = <span class="keyword">true</span>; <span class="comment">// 标记该位置已经访问</span></span><br><span class="line">        <span class="comment">// 获取当前位置可以走的下一个位置的集合</span></span><br><span class="line">        ArrayList&lt;Point&gt; ps = next(<span class="keyword">new</span> Point(column, row));</span><br><span class="line">        <span class="comment">// 对 ps 进行排序,排序的规则就是对 ps 的所有的 Point 对象的下一步的位置的数目， 进行非递减排序</span></span><br><span class="line">        sort(ps);</span><br><span class="line">        <span class="comment">// 遍历 ps</span></span><br><span class="line">        <span class="keyword">while</span> (!ps.isEmpty()) &#123;</span><br><span class="line">            Point p = ps.remove(<span class="number">0</span>);<span class="comment">// 取出下一个可以走的位置</span></span><br><span class="line">            <span class="comment">// 判断该点是否已经访问过</span></span><br><span class="line">            <span class="keyword">if</span> (!visited[p.y * X + p.x]) &#123;<span class="comment">// 说明还没有访问过</span></span><br><span class="line">                traversalChessboard(chessboard, p.y, p.x, step + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断马儿是否完成了任务， 使用 step 和应该走的步数比较 ，</span></span><br><span class="line">        <span class="comment">// 如果没有达到数量， 则表示没有完成任务， 将整个棋盘置 0</span></span><br><span class="line">        <span class="comment">// 说明: step &lt; X * Y 成立的情况有两种</span></span><br><span class="line">        <span class="comment">// 1. 棋盘到目前位置,仍然没有走完</span></span><br><span class="line">        <span class="comment">// 2. 棋盘处于一个回溯过程</span></span><br><span class="line">        <span class="keyword">if</span> (step &lt; X * Y &amp;&amp; !finished) &#123;</span><br><span class="line">            chessboard[row][column] = <span class="number">0</span>;</span><br><span class="line">            visited[row * X + column] = <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            finished = <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能： 根据当前位置(Point 对象)， 计算马儿还能走哪些位置(Point)， 并放入到一个集合中(ArrayList), 最多 有 8</span></span><br><span class="line"><span class="comment">     * 个位置</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> curPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;Point&gt; <span class="title">next</span><span class="params">(Point curPoint)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建一个 ArrayList</span></span><br><span class="line">        ArrayList&lt;Point&gt; ps = <span class="keyword">new</span> ArrayList&lt;Point&gt;();</span><br><span class="line">        <span class="comment">// 创建一个 Point</span></span><br><span class="line">        Point p1 = <span class="keyword">new</span> Point();</span><br><span class="line">        <span class="comment">// 表示马儿可以走 5 这个位置</span></span><br><span class="line">        <span class="keyword">if</span> ((p1.x = curPoint.x - <span class="number">2</span>) &gt;= <span class="number">0</span> &amp;&amp; (p1.y = curPoint.y - <span class="number">1</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            ps.add(<span class="keyword">new</span> Point(p1));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断马儿可以走 6 这个位置</span></span><br><span class="line">        <span class="keyword">if</span> ((p1.x = curPoint.x - <span class="number">1</span>) &gt;= <span class="number">0</span> &amp;&amp; (p1.y = curPoint.y - <span class="number">2</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            ps.add(<span class="keyword">new</span> Point(p1));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断马儿可以走 7 这个位置</span></span><br><span class="line">        <span class="keyword">if</span> ((p1.x = curPoint.x + <span class="number">1</span>) &lt; X &amp;&amp; (p1.y = curPoint.y - <span class="number">2</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            ps.add(<span class="keyword">new</span> Point(p1));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断马儿可以走 0 这个位置</span></span><br><span class="line">        <span class="keyword">if</span> ((p1.x = curPoint.x + <span class="number">2</span>) &lt; X &amp;&amp; (p1.y = curPoint.y - <span class="number">1</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            ps.add(<span class="keyword">new</span> Point(p1));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断马儿可以走 1 这个位置</span></span><br><span class="line">        <span class="keyword">if</span> ((p1.x = curPoint.x + <span class="number">2</span>) &lt; X &amp;&amp; (p1.y = curPoint.y + <span class="number">1</span>) &lt; Y) &#123;</span><br><span class="line">            ps.add(<span class="keyword">new</span> Point(p1));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断马儿可以走 2 这个位置</span></span><br><span class="line">        <span class="keyword">if</span> ((p1.x = curPoint.x + <span class="number">1</span>) &lt; X &amp;&amp; (p1.y = curPoint.y + <span class="number">2</span>) &lt; Y) &#123;</span><br><span class="line">            ps.add(<span class="keyword">new</span> Point(p1));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断马儿可以走 3 这个位置</span></span><br><span class="line">        <span class="keyword">if</span> ((p1.x = curPoint.x - <span class="number">1</span>) &gt;= <span class="number">0</span> &amp;&amp; (p1.y = curPoint.y + <span class="number">2</span>) &lt; Y) &#123;</span><br><span class="line">            ps.add(<span class="keyword">new</span> Point(p1));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断马儿可以走 4 这个位置</span></span><br><span class="line">        <span class="keyword">if</span> ((p1.x = curPoint.x - <span class="number">2</span>) &gt;= <span class="number">0</span> &amp;&amp; (p1.y = curPoint.y + <span class="number">1</span>) &lt; Y) &#123;</span><br><span class="line">            ps.add(<span class="keyword">new</span> Point(p1));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据当前这个一步的所有的下一步的选择位置， 进行非递减排序, 减少回溯的次数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(ArrayList&lt;Point&gt; ps)</span> </span>&#123;</span><br><span class="line">        ps.sort(<span class="keyword">new</span> Comparator&lt;Point&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Point o1, Point o2)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 获取到 o1 的下一步的所有位置个数</span></span><br><span class="line">                <span class="keyword">int</span> count1 = next(o1).size();</span><br><span class="line">                <span class="comment">// 获取到 o2 的下一步的所有位置个数</span></span><br><span class="line">                <span class="keyword">int</span> count2 = next(o2).size();</span><br><span class="line">                <span class="keyword">if</span> (count1 &lt; count2) &#123;</span><br><span class="line">                    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (count1 == count2) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>弗洛伊德算法Floyd--最短路径问题</title>
      <link href="/2020/05/09/%E5%BC%97%E6%B4%9B%E4%BC%8A%E5%BE%B7%E7%AE%97%E6%B3%95Floyd-%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/"/>
      <url>/2020/05/09/%E5%BC%97%E6%B4%9B%E4%BC%8A%E5%BE%B7%E7%AE%97%E6%B3%95Floyd-%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="弗洛伊德-Floyd-算法介绍"><a href="#弗洛伊德-Floyd-算法介绍" class="headerlink" title="弗洛伊德(Floyd)算法介绍"></a>弗洛伊德(Floyd)算法介绍</h1><ol><li>和 Dijkstra 算法一样， 弗洛伊德(Floyd)算法也是一种用于寻找给定的加权图中顶点间最短路径的算法。 该算法名称以创始人之一、 1978 年图灵奖获得者、 斯坦福大学计算机科学系教授罗伯特· 弗洛伊德命名</li><li>弗洛伊德算法(Floyd)计算图中各个顶点之间的最短路径</li><li>迪杰斯特拉算法用于计算图中某一个顶点到其他顶点的最短路径。</li></ol><h2 id="弗洛伊德算法-VS-迪杰斯特拉算法"><a href="#弗洛伊德算法-VS-迪杰斯特拉算法" class="headerlink" title="弗洛伊德算法 VS 迪杰斯特拉算法"></a>弗洛伊德算法 VS 迪杰斯特拉算法</h2><ul><li>迪杰斯特拉算法通过选定的被访问顶点， 求出从出发访问顶点到其他顶点的最短路径；</li><li>弗洛伊德算法中每一个顶点都是出发访问点， 所以需要将每一个顶点看做被访问顶点，求出从每一个顶点到其他顶点的最短路径。</li></ul><h2 id="弗洛伊德-Floyd-算法步骤"><a href="#弗洛伊德-Floyd-算法步骤" class="headerlink" title="弗洛伊德(Floyd)算法步骤"></a>弗洛伊德(Floyd)算法步骤</h2><ol><li>设置顶点 vi 到顶点 vk 的最短路径已知为 Lik， 顶点 vk 到 vj 的最短路径已知为 Lkj， 顶点 vi 到 vj 的路径为 Lij，则 vi 到 vj 的最短路径为： min((Lik+Lkj),Lij)， vk 的取值为图中所有顶点， 则可获得 vi 到 vj 的最短路径</li><li>至于 vi 到 vk 的最短路径 Lik 或者 vk 到 vj 的最短路径 Lkj， 是以同样的方式获得</li></ol><h2 id="弗洛伊德-Floyd-算法图解分析"><a href="#弗洛伊德-Floyd-算法图解分析" class="headerlink" title="弗洛伊德(Floyd)算法图解分析"></a>弗洛伊德(Floyd)算法图解分析</h2><p><img src="/images/2020/08/20200809123012.png" alt></p><p><img src="/images/2020/08/20200809123022.png" alt></p><p><img src="/images/2020/08/20200809123030.png" alt></p><h3 id="第一轮循环…"><a href="#第一轮循环…" class="headerlink" title="第一轮循环…"></a>第一轮循环…</h3><p>第一轮循环中， 以 A(下标为： 0)作为中间顶点【即把 A 作为中间顶点的所有情况都进行遍历, 就会得到更新距离表 和 前驱关系】 ，距离表和前驱关系更新为：<br><img src="/images/2020/08/20200809123200.png" alt></p><h3 id="分析如下"><a href="#分析如下" class="headerlink" title="分析如下"></a>分析如下</h3><ul><li>以 A 顶点作为中间顶点是， B-&gt;A-&gt;C 的距离由 N-&gt;12</li><li>以 A 顶点作为中间顶点是， G-&gt;A-&gt;C 的距离由 N-&gt;9</li><li>以 A 顶点作为中间顶点是， G-&gt;A-&gt;B 的距离为7,由于距离表中G-&gt;…-&gt;B已经存在距离为 3, 所以不进行替换</li><li>更换中间顶点， 循环执行操作， 直到所有顶点都作为中间顶点更新后， 计算结束<br><img src="/images/2020/08/20200809123550.png" alt><br><img src="/images/2020/08/20200809123624.png" alt></li></ul><h1 id="最短路径问题"><a href="#最短路径问题" class="headerlink" title="最短路径问题"></a>最短路径问题</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p><img src="/images/2020/08/20200809110018.png" alt></p><ol><li>战争时期， 胜利乡有 7 个村庄(A, B, C, D, E, F, G) ， 现在有六个邮差， 从 G 点出发， 需要分别把邮件分别送到A, B, C , D, E, F 六个村庄</li><li>各个村庄的距离用边线表示(权) ， 比如 A – B 距离 5 公里</li><li>问： 如何计算出 G 村庄到 其它各个村庄的最短距离?</li></ol><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.algorithm.floyd;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FloydAlgorithm</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 测试看看图是否创建成功</span></span><br><span class="line">        <span class="keyword">char</span>[] vertex = &#123; <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span> &#125;;</span><br><span class="line">        <span class="comment">// 创建邻接矩阵</span></span><br><span class="line">        <span class="keyword">int</span>[][] matrix = <span class="keyword">new</span> <span class="keyword">int</span>[vertex.length][vertex.length];</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> N = <span class="number">65535</span>;</span><br><span class="line">        matrix[<span class="number">0</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">0</span>, <span class="number">5</span>, <span class="number">7</span>, N, N, N, <span class="number">2</span> &#125;;</span><br><span class="line">        matrix[<span class="number">1</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">5</span>, <span class="number">0</span>, N, <span class="number">9</span>, N, N, <span class="number">3</span> &#125;;</span><br><span class="line">        matrix[<span class="number">2</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">7</span>, N, <span class="number">0</span>, N, <span class="number">8</span>, N, N &#125;;</span><br><span class="line">        matrix[<span class="number">3</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; N, <span class="number">9</span>, N, <span class="number">0</span>, N, <span class="number">4</span>, N &#125;;</span><br><span class="line">        matrix[<span class="number">4</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; N, N, <span class="number">8</span>, N, <span class="number">0</span>, <span class="number">5</span>, <span class="number">4</span> &#125;;</span><br><span class="line">        matrix[<span class="number">5</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; N, N, N, <span class="number">4</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">6</span> &#125;;</span><br><span class="line">        matrix[<span class="number">6</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">2</span>, <span class="number">3</span>, N, N, <span class="number">4</span>, <span class="number">6</span>, <span class="number">0</span> &#125;;</span><br><span class="line">        <span class="comment">// 创建 Graph 对象</span></span><br><span class="line">        Graph graph = <span class="keyword">new</span> Graph(vertex.length, matrix, vertex);</span><br><span class="line">        <span class="comment">// 调用弗洛伊德算法</span></span><br><span class="line">        graph.floyd();</span><br><span class="line">        graph.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建图</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Graph</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">char</span>[] vertex; <span class="comment">// 存放顶点的数组</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][] dis; <span class="comment">// 保存， 从各个顶点出发到其它顶点的距离， 最后的结果， 也是保留在该数组</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][] pre;<span class="comment">// 保存到达目标顶点的前驱顶点</span></span><br><span class="line">    <span class="comment">// 构造器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * *</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 大小</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> matrix 邻接矩阵</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> vertex 顶点数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Graph</span><span class="params">(<span class="keyword">int</span> length, <span class="keyword">int</span>[][] matrix, <span class="keyword">char</span>[] vertex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.vertex = vertex;</span><br><span class="line">        <span class="keyword">this</span>.dis = matrix;</span><br><span class="line">        <span class="keyword">this</span>.pre = <span class="keyword">new</span> <span class="keyword">int</span>[length][length];</span><br><span class="line">        <span class="comment">// 对 pre 数组初始化, 注意存放的是前驱顶点的下标</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            Arrays.fill(pre[i], i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示 pre 数组和 dis 数组</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 为了显示便于阅读， 我们优化一下输出</span></span><br><span class="line">        <span class="keyword">char</span>[] vertex = &#123; <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span> &#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; dis.length; k++) &#123;</span><br><span class="line">            <span class="comment">// 先将 pre 数组输出的一行</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; dis.length; i++) &#123;</span><br><span class="line">                System.out.print(vertex[pre[k][i]] + <span class="string">" "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">            <span class="comment">// 输出 dis 数组的一行数据</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; dis.length; i++) &#123;</span><br><span class="line">                System.out.print(<span class="string">"("</span> + vertex[k] + <span class="string">"到"</span> + vertex[i] + <span class="string">"的最短路径是"</span></span><br><span class="line">                        + dis[k][i] + <span class="string">") "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 弗洛伊德算法, 比较容易理解， 而且容易实现</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">floyd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">0</span>; <span class="comment">// 变量保存距离</span></span><br><span class="line">        <span class="comment">// 对中间顶点遍历， k 就是中间顶点的下标 [A, B, C, D, E, F, G]</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; dis.length; k++) &#123; <span class="comment">//</span></span><br><span class="line">            <span class="comment">// 从 i 顶点开始出发 [A, B, C, D, E, F, G]</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; dis.length; i++) &#123;</span><br><span class="line">                <span class="comment">// 到达 j 顶点 // [A, B, C, D, E, F, G]</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; dis.length; j++) &#123;</span><br><span class="line">                    <span class="comment">// =&gt; 求出从 i 顶点出发， 经过 k 中间顶点， 到达j 顶点距离</span></span><br><span class="line">                    len = dis[i][k] + dis[k][j];</span><br><span class="line">                    <span class="keyword">if</span> (len &lt; dis[i][j]) &#123;<span class="comment">// 如果 len 小于 dis[i][j]</span></span><br><span class="line">                        dis[i][j] = len;<span class="comment">// 更新距离</span></span><br><span class="line">                        pre[i][j] = pre[k][j];<span class="comment">// 更新前驱顶点</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>迪克斯特拉算法Dijkstra--最短路径问题</title>
      <link href="/2020/05/09/%E8%BF%AA%E5%85%8B%E6%96%AF%E7%89%B9%E6%8B%89%E7%AE%97%E6%B3%95Dijkstra-%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/"/>
      <url>/2020/05/09/%E8%BF%AA%E5%85%8B%E6%96%AF%E7%89%B9%E6%8B%89%E7%AE%97%E6%B3%95Dijkstra-%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="迪克斯特拉算法Dijkstra算法基本介绍"><a href="#迪克斯特拉算法Dijkstra算法基本介绍" class="headerlink" title="迪克斯特拉算法Dijkstra算法基本介绍"></a>迪克斯特拉算法Dijkstra算法基本介绍</h1><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol><li>找出最便宜的点</li><li>对于该结点的邻居,检查是否有前往它们的更短路径,如果有,就更新其开销</li><li>重复这个过程,直到对图中的每个结点都这样做了</li><li>计算最终路径</li></ol><h2 id="手动演示"><a href="#手动演示" class="headerlink" title="手动演示"></a>手动演示</h2><p><img src="/images/2020/08/20200809103416.png" alt></p><h3 id="第一轮"><a href="#第一轮" class="headerlink" title="第一轮"></a>第一轮</h3><ol><li>从图中可知最便宜的点是<code>乐谱</code></li><li>邻居是黑胶唱片和海报</li></ol><p>此时可以更新表格如下</p><table><thead><tr><th>结点</th><th>开销</th></tr></thead><tbody><tr><td>黑胶唱片</td><td>5</td></tr><tr><td>海报</td><td>0</td></tr></tbody></table><h3 id="第二轮"><a href="#第二轮" class="headerlink" title="第二轮"></a>第二轮</h3><ol><li>从上一轮的表格可知最便宜的点是<code>海报</code></li><li>邻居是吉他和架子鼓</li></ol><p>此时可以更新表格如下</p><table><thead><tr><th>结点</th><th>开销</th></tr></thead><tbody><tr><td>黑胶唱片</td><td>5</td></tr><tr><td><del>海报</del></td><td><del>0</del></td></tr><tr><td>海报 -&gt; 吉他</td><td>0 + 30 = 30</td></tr><tr><td>海报 -&gt; 架子鼓</td><td>0 + 35 = 35</td></tr></tbody></table><h3 id="第三轮"><a href="#第三轮" class="headerlink" title="第三轮"></a>第三轮</h3><ol><li>从上一轮的表格可知最便宜的点是<code>黑胶唱片</code></li><li>邻居是吉他和架子鼓</li></ol><p>此时可以更新表格如下</p><table><thead><tr><th>结点</th><th>开销</th></tr></thead><tbody><tr><td><del>黑胶唱片</del></td><td><del>5</del></td></tr><tr><td><del>海报 -&gt; 吉他</del></td><td><del>0 + 30 = 30</del></td></tr><tr><td><del>海报 -&gt; 架子鼓</del></td><td><del>0 + 35 = 35</del></td></tr><tr><td>黑胶唱片 -&gt; 吉他</td><td>5 + 15 = 20</td></tr><tr><td>黑胶唱片 -&gt; 架子鼓</td><td>5 + 20 = 25</td></tr></tbody></table><h3 id="第四轮"><a href="#第四轮" class="headerlink" title="第四轮"></a>第四轮</h3><ol><li>从上一轮的表格可知最便宜的点是<code>黑胶唱片 -&gt; 吉他</code></li><li>邻居是钢琴(终点)</li></ol><p>此时可以更新表格如下</p><table><thead><tr><th>结点</th><th>开销</th></tr></thead><tbody><tr><td><del>黑胶唱片</del></td><td><del>5</del></td></tr><tr><td><del>海报 -&gt; 吉他</del></td><td><del>0 + 30 = 30</del></td></tr><tr><td><del>海报 -&gt; 架子鼓</del></td><td><del>0 + 35 = 35</del></td></tr><tr><td><del>黑胶唱片 -&gt; 吉他</del></td><td><del>5 + 15 = 20</del></td></tr><tr><td><del>黑胶唱片 -&gt; 架子鼓</del></td><td><del>5 + 20 = 25</del></td></tr><tr><td>黑胶唱片 -&gt; 吉他 -&gt; 钢琴</td><td>5 + 15 + 20 = 40</td></tr></tbody></table><h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>由于上一轮已经走到终点了,所以,需要对最后一个结点–架子鼓也需要计算一下开销,即<code>黑胶唱片 -&gt; 架子鼓 -&gt; 钢琴 =&gt; 5 + 20 + 10 = 35</code>,与前面<code>黑胶唱片 -&gt; 吉他 -&gt; 钢琴 =&gt; 5 + 15 + 20 = 40</code>进行比较,得到最终的路径为<code>黑胶唱片 -&gt; 架子鼓 -&gt; 钢琴</code></p><h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><p>如果有负权边,就不能使用迪克斯特拉算法,可以使用<code>贝尔曼--福德算法(Bellman-Fordalgorithm)</code></p><h1 id="最短路径问题"><a href="#最短路径问题" class="headerlink" title="最短路径问题"></a>最短路径问题</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p><img src="/images/2020/08/20200809110018.png" alt></p><ol><li>战争时期， 胜利乡有 7 个村庄(A, B, C, D, E, F, G) ， 现在有六个邮差， 从 G 点出发， 需要分别把邮件分别送到A, B, C , D, E, F 六个村庄</li><li>各个村庄的距离用边线表示(权) ， 比如 A – B 距离 5 公里</li><li>问： 如何计算出 G 村庄到 其它各个村庄的最短距离?</li></ol><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><ol><li>设置出发顶点为 v， 顶点集合 V{v1,v2,vi…}， v 到 V 中各顶点的距离构成距离集合 Dis， Dis{d1,d2,di…}， Dis集合记录着 v 到图中各顶点的距离(到自身可以看作 0， v 到 vi 距离对应为 di)</li><li>从 Dis 中选择值最小的 di 并移出 Dis 集合， 同时移出 V 集合中对应的顶点 vi， 此时的 v 到 vi 即为最短路径</li><li>更新 Dis 集合， 更新规则为： 比较 v 到 V 集合中顶点的距离值， 与 v 通过 vi 到 V 集合中顶点的距离值， 保留值较小的一个(同时也应该更新顶点的前驱节点为vi， 表明是通过 vi 到达的)</li><li>重复执行两步骤， 直到最短路径顶点为目标顶点即可结束</li></ol><p><img src="/images/2020/08/20200809111538.png" alt></p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.algorithm.dijkstra;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DijkstraAlgorithm</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] vertex = &#123; <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span> &#125;;</span><br><span class="line">        <span class="comment">// 邻接矩阵</span></span><br><span class="line">        <span class="keyword">int</span>[][] matrix = <span class="keyword">new</span> <span class="keyword">int</span>[vertex.length][vertex.length];</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> N = <span class="number">65535</span>;<span class="comment">// 表示不可以连接</span></span><br><span class="line">        matrix[<span class="number">0</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; N, <span class="number">5</span>, <span class="number">7</span>, N, N, N, <span class="number">2</span> &#125;;</span><br><span class="line">        matrix[<span class="number">1</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">5</span>, N, N, <span class="number">9</span>, N, N, <span class="number">3</span> &#125;;</span><br><span class="line">        matrix[<span class="number">2</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">7</span>, N, N, N, <span class="number">8</span>, N, N &#125;;</span><br><span class="line">        matrix[<span class="number">3</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; N, <span class="number">9</span>, N, N, N, <span class="number">4</span>, N &#125;;</span><br><span class="line">        matrix[<span class="number">4</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; N, N, <span class="number">8</span>, N, N, <span class="number">5</span>, <span class="number">4</span> &#125;;</span><br><span class="line">        matrix[<span class="number">5</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; N, N, N, <span class="number">4</span>, <span class="number">5</span>, N, <span class="number">6</span> &#125;;</span><br><span class="line">        matrix[<span class="number">6</span>] = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">2</span>, <span class="number">3</span>, N, N, <span class="number">4</span>, <span class="number">6</span>, N &#125;;</span><br><span class="line">        <span class="comment">// 创建 Graph 对象</span></span><br><span class="line">        Graph graph = <span class="keyword">new</span> Graph(vertex, matrix);</span><br><span class="line">        <span class="comment">// 测试, 看看图的邻接矩阵是否 ok</span></span><br><span class="line">        graph.showGraph();</span><br><span class="line">        <span class="comment">// 测试迪杰斯特拉算法</span></span><br><span class="line">        graph.dsj(<span class="number">2</span>);<span class="comment">// C</span></span><br><span class="line">        graph.showDijkstra();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Graph</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">char</span>[] vertex; <span class="comment">// 顶点数组</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][] matrix; <span class="comment">// 邻接矩阵</span></span><br><span class="line">    <span class="keyword">private</span> VisitedVertex vv; <span class="comment">// 已经访问的顶点的集合</span></span><br><span class="line">    <span class="comment">// 构造器</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Graph</span><span class="params">(<span class="keyword">char</span>[] vertex, <span class="keyword">int</span>[][] matrix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.vertex = vertex;</span><br><span class="line">        <span class="keyword">this</span>.matrix = matrix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示结果</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showDijkstra</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        vv.show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示图</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showGraph</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] link : matrix) &#123;</span><br><span class="line">            System.out.println(Arrays.toString(link));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 迪杰斯特拉算法实现</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 表示出发顶点对应的下标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dsj</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        vv = <span class="keyword">new</span> VisitedVertex(vertex.length, index);</span><br><span class="line">        update(index);<span class="comment">// 更新 index 顶点到周围顶点的距离和前驱顶点</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; vertex.length; j++) &#123;</span><br><span class="line">            index = vv.updateArr();<span class="comment">// 选择并返回新的访问顶点</span></span><br><span class="line">            update(index); <span class="comment">// 更新 index 顶点到周围顶点的距离和前驱顶点</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新 index 下标顶点到周围顶点的距离和周围顶点的前驱顶点</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 根据遍历我们的邻接矩阵的 matrix[index]行</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; matrix[index].length; j++) &#123;</span><br><span class="line">            <span class="comment">// len 含义是 : 出发顶点到 index 顶点的距离 + 从 index 顶点到 j 顶点的距离的和</span></span><br><span class="line">            len = vv.getDis(index) + matrix[index][j];</span><br><span class="line">            <span class="comment">// 如果 j 顶点没有被访问过， 并且 len 小于出发顶点到 j 顶点的距离， 就需要更新</span></span><br><span class="line">            <span class="keyword">if</span> (!vv.in(j) &amp;&amp; len &lt; vv.getDis(j)) &#123;</span><br><span class="line">                vv.updatePre(j, index); <span class="comment">// 更新 j 顶点的前驱为 index 顶点</span></span><br><span class="line">                vv.updateDis(j, len); <span class="comment">// 更新出发顶点到 j 顶点的距离</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 已访问顶点集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VisitedVertex</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 记录各个顶点是否访问过 1 表示访问过,0 未访问,会动态更新</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] already_arr;</span><br><span class="line">    <span class="comment">// 每个下标对应的值为前一个顶点下标, 会动态更新</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] pre_visited;</span><br><span class="line">    <span class="comment">// 记录出发顶点到其他所有顶点的距离,比如 G 为出发顶点， 就会记录 G 到其它顶点的距离， 会动态更新， 求的最短距离就会存放到 dis</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] dis;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造器</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length :表示顶点的个数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>        index: 出发顶点对应的下标, 比如 G 顶点， 下标就是 6</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">VisitedVertex</span><span class="params">(<span class="keyword">int</span> length, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.already_arr = <span class="keyword">new</span> <span class="keyword">int</span>[length];</span><br><span class="line">        <span class="keyword">this</span>.pre_visited = <span class="keyword">new</span> <span class="keyword">int</span>[length];</span><br><span class="line">        <span class="keyword">this</span>.dis = <span class="keyword">new</span> <span class="keyword">int</span>[length];</span><br><span class="line">        <span class="comment">// 初始化 dis 数组</span></span><br><span class="line">        Arrays.fill(dis, <span class="number">65535</span>);</span><br><span class="line">        <span class="keyword">this</span>.already_arr[index] = <span class="number">1</span>; <span class="comment">// 设置出发顶点被访问过</span></span><br><span class="line">        <span class="keyword">this</span>.dis[index] = <span class="number">0</span>;<span class="comment">// 设置出发顶点的访问距离为 0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能: 判断 index 顶点是否被访问过</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果访问过， 就返回 true, 否则访问 false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">in</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> already_arr[index] == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能: 更新出发顶点到 index 顶点的距离</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> len</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDis</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        dis[index] = len;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能: 更新 pre 这个顶点的前驱顶点为 index 顶点</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pre</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePre</span><span class="params">(<span class="keyword">int</span> pre, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        pre_visited[pre] = index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能:返回出发顶点到 index 顶点的距离</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDis</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dis[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 继续选择并返回新的访问顶点， 比如这里的 G 完后， 就是 A 点作为新的访问顶点(注意不是出发顶点)</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateArr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> min = <span class="number">65535</span>, index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; already_arr.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (already_arr[i] == <span class="number">0</span> &amp;&amp; dis[i] &lt; min) &#123;</span><br><span class="line">                min = dis[i];</span><br><span class="line">                index = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 更新 index 顶点被访问过</span></span><br><span class="line">        already_arr[index] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示最后的结果 即将三个数组的情况输出</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"=========================="</span>);</span><br><span class="line">        <span class="comment">// 输出 already_arr</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : already_arr) &#123;</span><br><span class="line">            System.out.print(i + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="comment">// 输出 pre_visited</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : pre_visited) &#123;</span><br><span class="line">            System.out.print(i + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="comment">// 输出 dis</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : dis) &#123;</span><br><span class="line">            System.out.print(i + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        <span class="comment">// 为了好看最后的最短距离， 我们处理</span></span><br><span class="line">        <span class="keyword">char</span>[] vertex = &#123; <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span> &#125;;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : dis) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i != <span class="number">65535</span>) &#123;</span><br><span class="line">                System.out.print(vertex[count] + <span class="string">"("</span> + i + <span class="string">") "</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"N "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li>《算法图解》的kindle版,第7章.作者: [美] Aditya Bhargava. 译者: 袁国忠.ISBN:978-7-115-44763-0</li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>克鲁斯卡尔算法--公交站问题--最小生成树</title>
      <link href="/2020/05/09/%E5%85%8B%E9%B2%81%E6%96%AF%E5%8D%A1%E5%B0%94%E7%AE%97%E6%B3%95-%E5%85%AC%E4%BA%A4%E7%AB%99%E9%97%AE%E9%A2%98-%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/"/>
      <url>/2020/05/09/%E5%85%8B%E9%B2%81%E6%96%AF%E5%8D%A1%E5%B0%94%E7%AE%97%E6%B3%95-%E5%85%AC%E4%BA%A4%E7%AB%99%E9%97%AE%E9%A2%98-%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<h1 id="最小生成树-Minimum-Cost-Spanning-Tree"><a href="#最小生成树-Minimum-Cost-Spanning-Tree" class="headerlink" title="最小生成树(Minimum Cost Spanning Tree)"></a>最小生成树(Minimum Cost Spanning Tree)</h1><p>简称MST。给定一个带权的无向连通图,如何选取一棵生成树,使树上所有边上权的总和为最小,这叫最小生成树</p><ol><li>N 个顶点， 一定有 N-1 条边</li><li>包含全部顶点</li><li>N-1 条边都在图中</li><li><strong>求最小生成树的算法主要是普里姆算法和克鲁斯卡尔算法</strong></li><li>举例说明(如图)<br><img src="/images/2020/08/20200808162537.png" alt><br>例如， 对于如上图 G4 所示的连通网可以有多棵权值总和不相同的生成树<br><img src="/images/2020/08/20200808162554.png" alt></li></ol><h1 id="克鲁斯卡尔算法介绍"><a href="#克鲁斯卡尔算法介绍" class="headerlink" title="克鲁斯卡尔算法介绍"></a>克鲁斯卡尔算法介绍</h1><h2 id="基本说明"><a href="#基本说明" class="headerlink" title="基本说明"></a>基本说明</h2><ol><li>克鲁斯卡尔(Kruskal)算法， 是用来求加权连通图的最小生成树的算法。</li><li>基本思想： 按照权值从小到大的顺序选择 n-1 条边， 并保证这 n-1 条边不构成回路</li><li>具体做法： 首先构造一个只含 n 个顶点的森林， 然后依权值从小到大从连通网中选择边加入到森林中， 并使森林中不产生回路， 直至森林变成一棵树为止</li></ol><h2 id="克鲁斯卡尔算法图解"><a href="#克鲁斯卡尔算法图解" class="headerlink" title="克鲁斯卡尔算法图解"></a>克鲁斯卡尔算法图解</h2><p>在含有 n 个顶点的连通图中选择 n-1 条边， 构成一棵极小连通子图， 并使该连通子图中 n-1 条边上权值之和达到最小， 则称其为连通网的最小生成树。<br><img src="/images/2020/08/20200808162537.png" alt><br>例如， 对于如上图 G4 所示的连通网可以有多棵权值总和不相同的生成树<br><img src="/images/2020/08/20200808162554.png" alt></p><p>以上图 G4 为例， 来对克鲁斯卡尔进行演示(假设， 用数组 R 保存最小生成树结果)。<br><img src="/images/2020/08/20200808162624.png" alt><br><img src="/images/2020/08/20200808162634.png" alt><br><img src="/images/2020/08/20200808162644.png" alt><br><img src="/images/2020/08/20200808162653.png" alt><br><img src="/images/2020/08/20200808162704.png" alt><br><img src="/images/2020/08/20200808162713.png" alt></p><h2 id="克鲁斯卡尔算法文字描述"><a href="#克鲁斯卡尔算法文字描述" class="headerlink" title="克鲁斯卡尔算法文字描述"></a>克鲁斯卡尔算法文字描述</h2><ol><li>将边&lt;E,F&gt;加入 R 中。边&lt;E,F&gt;的权值最小， 因此将它加入到最小生成树结果 R 中。</li><li>将边&lt;C,D&gt;加入 R 中。上一步操作之后， 边&lt;C,D&gt;的权值最小， 因此将它加入到最小生成树结果 R 中。</li><li>将边&lt;D,E&gt;加入 R 中。上一步操作之后， 边&lt;D,E&gt;的权值最小， 因此将它加入到最小生成树结果 R 中。</li><li>将边&lt;B,F&gt;加入 R 中。上一步操作之后， 边&lt;C,E&gt;的权值最小， 但&lt;C,E&gt;会和已有的边构成回路； 因此， 跳过边&lt;C,E&gt;。 同理， 跳过边&lt;C,F&gt;。 将边&lt;B,F&gt;加入到最小生成树结果 R 中。</li><li>将边&lt;E,G&gt;加入 R 中。上一步操作之后， 边&lt;E,G&gt;的权值最小， 因此将它加入到最小生成树结果 R 中。</li><li>将边&lt;A,B&gt;加入 R 中。上一步操作之后， 边&lt;F,G&gt;的权值最小， 但&lt;F,G&gt;会和已有的边构成回路； 因此， 跳过边&lt;F,G&gt;。 同理， 跳过边&lt;B,C&gt;。 将边&lt;A,B&gt;加入到最小生成树结果 R 中。</li></ol><p>此时， 最小生成树构造完成！ 它包括的边依次是： &lt;E,F&gt; &lt;C,D&gt; &lt;D,E&gt; &lt;B,F&gt; &lt;E,G&gt; &lt;A,B&gt;。</p><h2 id="克鲁斯卡尔算法分析"><a href="#克鲁斯卡尔算法分析" class="headerlink" title="克鲁斯卡尔算法分析"></a>克鲁斯卡尔算法分析</h2><p>根据前面介绍的克鲁斯卡尔算法的基本思想和做法， 我们能够了解到， 克鲁斯卡尔算法重点需要解决的以下两个问题：</p><ul><li>问题一 对图的所有边按照权值大小进行排序。( ==&gt; 很好解决， 采用排序算法进行排序即可)</li><li>问题二 将边添加到最小生成树中时， 怎么样判断是否形成了回路。( ==&gt; 解决如下)</li></ul><h2 id="如何判断是否构成回路-举例说明-如图"><a href="#如何判断是否构成回路-举例说明-如图" class="headerlink" title="如何判断是否构成回路-举例说明(如图)"></a>如何判断是否构成回路-举例说明(如图)</h2><p><img src="/images/2020/08/20200808163724.png" alt><br>在将&lt;E,F&gt; &lt;C,D&gt; &lt;D,E&gt;加入到最小生成树 R 中之后， 这几条边的顶点就都有了终点：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(01) C 的终点是 F。</span><br><span class="line">(02) D 的终点是 F。</span><br><span class="line">(03) E 的终点是 F。</span><br><span class="line">(04) F 的终点是 F。</span><br></pre></td></tr></table></figure><p>关于终点的说明：</p><ol><li>就是将所有顶点按照从小到大的顺序排列好之后； 某个顶点的终点就是”与它连通的最大顶点”。</li><li>因此， 接下来， 虽然&lt;C,E&gt;是权值最小的边。 但是 C 和 E 的终点都是 F， 即它们的终点相同， 因此， 将&lt;C,E&gt;加入最小生成树的话，会形成回路。这就是判断回路的方式。 也就是说， <strong>我们加入的边的两个顶点不能都指向同一个终点， 否则将构成回路</strong>。</li></ol><h1 id="应用场景-公交站问题"><a href="#应用场景-公交站问题" class="headerlink" title="应用场景-公交站问题"></a>应用场景-公交站问题</h1><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p><img src="/images/2020/08/20200808162402.png" alt></p><ol><li>某城市新增 7 个站点(A, B, C, D, E, F, G) ， 现在需要修路把 7 个站点连通</li><li>各个站点的距离用边线表示(权) ， 比如 A – B 距离 12 公里</li><li>问： 如何修路保证各个站点都能连通， 并且总的修建公路总里程最短</li></ol><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.algorithm.kruskal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KruskalCase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> edgeNum; <span class="comment">// 边的个数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">char</span>[] vertexs; <span class="comment">// 顶点数组</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][] matrix; <span class="comment">// 邻接矩阵</span></span><br><span class="line">    <span class="comment">// 使用 INF 表示两个顶点不能连通</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INF = Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] vertexs = &#123; <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span> &#125;;</span><br><span class="line">        <span class="comment">// 克鲁斯卡尔算法的邻接矩阵</span></span><br><span class="line">        <span class="keyword">int</span> matrix[][] = &#123;</span><br><span class="line">                <span class="comment">/* A */</span><span class="comment">/* B */</span><span class="comment">/* C */</span><span class="comment">/* D */</span><span class="comment">/* E */</span><span class="comment">/* F */</span><span class="comment">/* G */</span></span><br><span class="line">                <span class="comment">/* A */</span> &#123; <span class="number">0</span>, <span class="number">12</span>, INF, INF, INF, <span class="number">16</span>, <span class="number">14</span> &#125;,</span><br><span class="line">                <span class="comment">/* B */</span> &#123; <span class="number">12</span>, <span class="number">0</span>, <span class="number">10</span>, INF, INF, <span class="number">7</span>, INF &#125;,</span><br><span class="line">                <span class="comment">/* C */</span> &#123; INF, <span class="number">10</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, INF &#125;,</span><br><span class="line">                <span class="comment">/* D */</span> &#123; INF, INF, <span class="number">3</span>, <span class="number">0</span>, <span class="number">4</span>, INF, INF &#125;,</span><br><span class="line">                <span class="comment">/* E */</span> &#123; INF, INF, <span class="number">5</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">8</span> &#125;,</span><br><span class="line">                <span class="comment">/* F */</span> &#123; <span class="number">16</span>, <span class="number">7</span>, <span class="number">6</span>, INF, <span class="number">2</span>, <span class="number">0</span>, <span class="number">9</span> &#125;,</span><br><span class="line">                <span class="comment">/* G */</span> &#123; <span class="number">14</span>, INF, INF, INF, <span class="number">8</span>, <span class="number">9</span>, <span class="number">0</span> &#125; &#125;;</span><br><span class="line">        <span class="comment">// 大家可以在去测试其它的邻接矩阵， 结果都可以得到最小生成树.</span></span><br><span class="line">        <span class="comment">// 创建 KruskalCase 对象实例</span></span><br><span class="line">        KruskalCase kruskalCase = <span class="keyword">new</span> KruskalCase(vertexs, matrix);</span><br><span class="line">        <span class="comment">// 输出构建的</span></span><br><span class="line">        kruskalCase.print();</span><br><span class="line">        kruskalCase.kruskal();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KruskalCase</span><span class="params">(<span class="keyword">char</span>[] vertexs, <span class="keyword">int</span>[][] matrix)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 初始化顶点数和边的个数</span></span><br><span class="line">        <span class="keyword">int</span> vlen = vertexs.length;</span><br><span class="line">        <span class="comment">// 初始化顶点, 复制拷贝的方式</span></span><br><span class="line">        <span class="keyword">this</span>.vertexs = <span class="keyword">new</span> <span class="keyword">char</span>[vlen];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vertexs.length; i++) &#123;</span><br><span class="line">            <span class="keyword">this</span>.vertexs[i] = vertexs[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 初始化边, 使用的是复制拷贝的方式</span></span><br><span class="line">        <span class="keyword">this</span>.matrix = <span class="keyword">new</span> <span class="keyword">int</span>[vlen][vlen];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vlen; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; vlen; j++) &#123;</span><br><span class="line">                <span class="keyword">this</span>.matrix[i][j] = matrix[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 统计边的条数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vlen; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; vlen; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.matrix[i][j] != INF) &#123;</span><br><span class="line">                    edgeNum++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">kruskal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>; <span class="comment">// 表示最后结果数组的索引</span></span><br><span class="line">        <span class="keyword">int</span>[] ends = <span class="keyword">new</span> <span class="keyword">int</span>[edgeNum]; <span class="comment">// 用于保存"已有最小生成树" 中的每个顶点在最小生成树中的终点</span></span><br><span class="line">        <span class="comment">// 创建结果数组, 保存最后的最小生成树</span></span><br><span class="line">        EData[] rets = <span class="keyword">new</span> EData[edgeNum];</span><br><span class="line">        <span class="comment">// 获取图中 所有的边的集合 ， 一共有 12 边</span></span><br><span class="line">        EData[] edges = getEdges();</span><br><span class="line">        System.out.println(</span><br><span class="line">                <span class="string">"图的边的集合="</span> + Arrays.toString(edges) + <span class="string">" 共"</span> + edges.length); <span class="comment">// 12</span></span><br><span class="line">        <span class="comment">// 按照边的权值大小进行排序(从小到大)</span></span><br><span class="line">        sortEdges(edges);</span><br><span class="line">        <span class="comment">// 遍历 edges 数组， 将边添加到最小生成树中时， 判断是准备加入的边否形成了回路， 如果没有， 就加入 rets,否则不能加入</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; edgeNum; i++) &#123;</span><br><span class="line">            <span class="comment">// 获取到第 i 条边的第一个顶点(起点)</span></span><br><span class="line">            <span class="keyword">int</span> p1 = getPosition(edges[i].start); <span class="comment">// p1=4</span></span><br><span class="line">            <span class="comment">// 获取到第 i 条边的第 2 个顶点</span></span><br><span class="line">            <span class="keyword">int</span> p2 = getPosition(edges[i].end); <span class="comment">// p2 = 5</span></span><br><span class="line">            <span class="comment">// 获取 p1 这个顶点在已有最小生成树中的终点</span></span><br><span class="line">            <span class="keyword">int</span> m = getEnd(ends, p1); <span class="comment">// m = 4</span></span><br><span class="line">            <span class="comment">// 获取 p2 这个顶点在已有最小生成树中的终点</span></span><br><span class="line">            <span class="keyword">int</span> n = getEnd(ends, p2); <span class="comment">// n = 5</span></span><br><span class="line">            <span class="comment">// 是否构成回路</span></span><br><span class="line">            <span class="keyword">if</span> (m != n) &#123; <span class="comment">// 没有构成回路</span></span><br><span class="line">                ends[m] = n; <span class="comment">// 设置 m 在"已有最小生成树"中的终点 &lt;E,F&gt;</span></span><br><span class="line">                                <span class="comment">// [0,0,0,0,5,0,0,0,0,0,0,0]</span></span><br><span class="line">                rets[index++] = edges[i]; <span class="comment">// 有一条边加入到 rets 数组</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// &lt;E,F&gt; &lt;C,D&gt; &lt;D,E&gt; &lt;B,F&gt; &lt;E,G&gt; &lt;A,B&gt;。</span></span><br><span class="line">        <span class="comment">// 统计并打印 "最小生成树", 输出 rets</span></span><br><span class="line">        System.out.println(<span class="string">"最小生成树为"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            System.out.println(rets[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印邻接矩阵</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"邻接矩阵为: \n"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vertexs.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; vertexs.length; j++) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"%12d"</span>, matrix[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();<span class="comment">// 换行</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 功能： 对边进行排序处理, 冒泡排序</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param edges 边的集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sortEdges</span><span class="params">(EData[] edges)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; edges.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; edges.length - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (edges[j].weight &gt; edges[j + <span class="number">1</span>].weight) &#123;<span class="comment">// 交换</span></span><br><span class="line">                    EData tmp = edges[j];</span><br><span class="line">                    edges[j] = edges[j + <span class="number">1</span>];</span><br><span class="line">                    edges[j + <span class="number">1</span>] = tmp;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * *</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param ch 顶点的值， 比如'A','B'</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @return 返回 ch 顶点对应的下标， 如果找不到， 返回-1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getPosition</span><span class="params">(<span class="keyword">char</span> ch)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vertexs.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (vertexs[i] == ch) &#123;<span class="comment">// 找到</span></span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 找不到,返回-1</span></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 功能: 获取图中边， 放到 EData[] 数组中， 后面我们需要遍历该数组 是通过 matrix 邻接矩阵来获取 EData[] 形式</span></span><br><span class="line"><span class="comment">     * [['A','B', 12], ['B','F',7], .....]</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @return</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EData[] getEdges() &#123;</span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">        EData[] edges = <span class="keyword">new</span> EData[edgeNum];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; vertexs.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; vertexs.length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (matrix[i][j] != INF) &#123;</span><br><span class="line">                    edges[index++] = <span class="keyword">new</span> EData(vertexs[i], vertexs[j],</span><br><span class="line">                            matrix[i][j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> edges;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 功能: 获取下标为 i 的顶点的终点(), 用于后面判断两个顶点的终点是否相同</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param ends ： 数组就是记录了各个顶点对应的终点是哪个,ends 数组是在遍历过程中， 逐步形成</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param i : 表示传入的顶点对应的下标</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @return 返回的就是 下标为 i 的这个顶点对应的终点的下标, 一会回头还有来理解</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getEnd</span><span class="params">(<span class="keyword">int</span>[] ends, <span class="keyword">int</span> i)</span> </span>&#123; <span class="comment">// i = 4 [0,0,0,0,5,0,0,0,0,0,0,0]</span></span><br><span class="line">        <span class="keyword">while</span> (ends[i] != <span class="number">0</span>) &#123;</span><br><span class="line">            i = ends[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个类 EData ， 它的对象实例就表示一条边</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EData</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> start; <span class="comment">// 边的一个点</span></span><br><span class="line">    <span class="keyword">char</span> end; <span class="comment">// 边的另外一个点</span></span><br><span class="line">    <span class="keyword">int</span> weight; <span class="comment">// 边的权值</span></span><br><span class="line">    <span class="comment">// 构造器</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EData</span><span class="params">(<span class="keyword">char</span> start, <span class="keyword">char</span> end, <span class="keyword">int</span> weight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.start = start;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">        <span class="keyword">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写 toString, 便于输出边信息</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"EData [&lt;"</span> + start + <span class="string">", "</span> + end + <span class="string">"&gt;= "</span> + weight + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>普里姆算法--修路问题--最小生成树</title>
      <link href="/2020/05/09/%E6%99%AE%E9%87%8C%E5%A7%86%E7%AE%97%E6%B3%95-%E4%BF%AE%E8%B7%AF%E9%97%AE%E9%A2%98--%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/"/>
      <url>/2020/05/09/%E6%99%AE%E9%87%8C%E5%A7%86%E7%AE%97%E6%B3%95-%E4%BF%AE%E8%B7%AF%E9%97%AE%E9%A2%98--%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<h1 id="最小生成树"><a href="#最小生成树" class="headerlink" title="最小生成树"></a>最小生成树</h1><p><strong>修路问题本质就是就是最小生成树问题</strong>， 先介绍一下最小生成树(Minimum Cost Spanning Tree)， 简称 MST。给定一个带权的无向连通图,如何选取一棵生成树,使树上所有边上权的总和为最小,这叫最小生成树</p><ol><li>N 个顶点， 一定有 N-1 条边</li><li>包含全部顶点</li><li>N-1 条边都在图中</li><li>举例说明(如图:)<br><img src="/images/2020/08/20200808160753.png" alt></li><li><strong>求最小生成树的算法主要是普里姆算法和克鲁斯卡尔算法</strong></li></ol><h1 id="普里姆算法介绍"><a href="#普里姆算法介绍" class="headerlink" title="普里姆算法介绍"></a>普里姆算法介绍</h1><p>普利姆(Prim)算法求最小生成树， 也就是在包含 n 个顶点的连通图中， 找出只有(n-1)条边包含所有 n 个顶点的连通子图， 也就是所谓的极小连通子图<br>普利姆的算法如下:</p><ol><li>设 G=(V,E)是连通网， T=(U,D)是最小生成树， V,U 是顶点集合， E,D 是边的集合</li><li>若从顶点 u 开始构造最小生成树， 则从集合 V 中取出顶点 u 放入集合 U 中， 标记顶点 v 的 visited[u]=1</li><li>若集合 U 中顶点 ui 与集合 V-U 中的顶点 vj 之间存在边， 则<strong>寻找这些边中权值最小的边</strong>， 但不能构成回路， 将顶点 vj 加入集合 U 中， 将边（ui,vj） 加入集合 D 中， 标记 visited[vj]=1</li><li>重复步骤②， 直到 U 与 V 相等， 即所有顶点都被标记为访问过， 此时 D 中有 n-1 条边</li><li>提示: 单独看步骤很难理解， 我们通过代码来讲解， 比较好理解.</li><li>图解普利姆算法<br><img src="/images/2020/08/20200808161235.png" alt></li></ol><h1 id="应用场景-修路问题"><a href="#应用场景-修路问题" class="headerlink" title="应用场景-修路问题"></a>应用场景-修路问题</h1><p><img src="/images/2020/08/20200808160853.png" alt></p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol><li>有胜利乡有 7 个村庄(A, B, C, D, E, F, G) ， 现在需要修路把 7 个村庄连通</li><li>各个村庄的距离用边线表示(权) ， 比如 A – B 距离 5 公里</li><li>问： 如何修路保证各个村庄都能连通， 并且总的修建公路总里程最短?</li></ol><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ul><li>将 10 条边， 连接即可， 但是总的里程数不是最小(舍弃)</li><li>正确的思路， 就是尽可能的选择少的路线， 并且每条路线最小， 保证总里程数最少</li></ul><h2 id="使用普里姆算法解决修路问题"><a href="#使用普里姆算法解决修路问题" class="headerlink" title="使用普里姆算法解决修路问题"></a>使用普里姆算法解决修路问题</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.algorithm.prim;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrimAlgorithm</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 测试看看图是否创建 ok</span></span><br><span class="line">        <span class="keyword">char</span>[] data = <span class="keyword">new</span> <span class="keyword">char</span>[] &#123; <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>, <span class="string">'D'</span>, <span class="string">'E'</span>, <span class="string">'F'</span>, <span class="string">'G'</span> &#125;;</span><br><span class="line">        <span class="keyword">int</span> verxs = data.length;</span><br><span class="line">        <span class="comment">// 邻接矩阵的关系使用二维数组表示,10000 这个大数， 表示两个点不联通</span></span><br><span class="line">        <span class="keyword">int</span>[][] weight = <span class="keyword">new</span> <span class="keyword">int</span>[][] &#123; &#123; <span class="number">10000</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">2</span> &#125;,</span><br><span class="line">                &#123; <span class="number">5</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">9</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">3</span> &#125;,</span><br><span class="line">                &#123; <span class="number">7</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">8</span>, <span class="number">10000</span>, <span class="number">10000</span> &#125;,</span><br><span class="line">                &#123; <span class="number">10000</span>, <span class="number">9</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">4</span>, <span class="number">10000</span> &#125;,</span><br><span class="line">                &#123; <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">8</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">5</span>, <span class="number">4</span> &#125;,</span><br><span class="line">                &#123; <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">10000</span>, <span class="number">6</span> &#125;,</span><br><span class="line">                &#123; <span class="number">2</span>, <span class="number">3</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">10000</span> &#125;, &#125;;</span><br><span class="line">        <span class="comment">// 创建 MGraph 对象</span></span><br><span class="line">        MGraph graph = <span class="keyword">new</span> MGraph(verxs);</span><br><span class="line">        <span class="comment">// 创建一个 MinTree 对象</span></span><br><span class="line">        MinTree minTree = <span class="keyword">new</span> MinTree();</span><br><span class="line">        minTree.createGraph(graph, verxs, data, weight);</span><br><span class="line">        <span class="comment">// 输出</span></span><br><span class="line">        minTree.showGraph(graph);</span><br><span class="line">        <span class="comment">// 测试普利姆算法</span></span><br><span class="line">        minTree.prim(graph, <span class="number">1</span>);<span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建最小生成树-&gt;村庄的图</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinTree</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建图的邻接矩阵</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * *</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> graph  图对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verxs  图对应的顶点个数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data   图的各个顶点的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> weight 图的邻接矩阵</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createGraph</span><span class="params">(MGraph graph, <span class="keyword">int</span> verxs, <span class="keyword">char</span> data[],</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span>[][] weight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i, j;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; verxs; i++) &#123;<span class="comment">// 顶点</span></span><br><span class="line">            graph.data[i] = data[i];</span><br><span class="line">            <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; verxs; j++) &#123;</span><br><span class="line">                graph.weight[i][j] = weight[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示图的邻接矩阵</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showGraph</span><span class="params">(MGraph graph)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] link : graph.weight) &#123;</span><br><span class="line">            System.out.println(Arrays.toString(link));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 编写 prim 算法， 得到最小生成树</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * *</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> graph 图</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v     表示从图的第几个顶点开始生成'A'-&gt;0 'B'-&gt;1...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prim</span><span class="params">(MGraph graph, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// visited[] 标记结点(顶点)是否被访问过</span></span><br><span class="line">        <span class="keyword">int</span> visited[] = <span class="keyword">new</span> <span class="keyword">int</span>[graph.verxs];</span><br><span class="line">        <span class="comment">// visited[] 默认元素的值都是 0, 表示没有访问过</span></span><br><span class="line">        <span class="comment">// for(int i =0; i &lt;graph.verxs; i++) &#123;</span></span><br><span class="line">        <span class="comment">// visited[i] = 0;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// 把当前这个结点标记为已访问</span></span><br><span class="line">        visited[v] = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// h1 和 h2 记录两个顶点的下标</span></span><br><span class="line">        <span class="keyword">int</span> h1 = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> h2 = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> minWeight = <span class="number">10000</span>; <span class="comment">// 将 minWeight 初始成一个大数， 后面在遍历过程中， 会被替换</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt; graph.verxs; k++) &#123;<span class="comment">// 因为有 graph.verxs 顶点， 普利姆算法结束后，有 graph.verxs-1 边</span></span><br><span class="line">            <span class="comment">// 这个是确定每一次生成的子图 ， 和哪个结点的距离最近</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; graph.verxs; i++) &#123;<span class="comment">// i 结点表示被访问过的结点</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; graph.verxs; j++) &#123;<span class="comment">// j 结点表示还没有访问过的结点</span></span><br><span class="line">                    <span class="keyword">if</span> (visited[i] == <span class="number">1</span> &amp;&amp; visited[j] == <span class="number">0</span></span><br><span class="line">                            &amp;&amp; graph.weight[i][j] &lt; minWeight) &#123;</span><br><span class="line">                        <span class="comment">// 替换 minWeight(寻找已经访问过的结点和未访问过的结点间的权值最小的边)</span></span><br><span class="line">                        minWeight = graph.weight[i][j];</span><br><span class="line">                        h1 = i;</span><br><span class="line">                        h2 = j;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 找到一条边是最小</span></span><br><span class="line">            System.out.println(<span class="string">"边&lt;"</span> + graph.data[h1] + <span class="string">","</span> + graph.data[h2]</span><br><span class="line">                    + <span class="string">"&gt; 权值:"</span> + minWeight);</span><br><span class="line">            <span class="comment">// 将当前这个结点标记为已经访问</span></span><br><span class="line">            visited[h2] = <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// minWeight 重新设置为最大值 10000</span></span><br><span class="line">            minWeight = <span class="number">10000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MGraph</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> verxs; <span class="comment">// 表示图的节点个数</span></span><br><span class="line">    <span class="keyword">char</span>[] data;<span class="comment">// 存放结点数据</span></span><br><span class="line">    <span class="keyword">int</span>[][] weight; <span class="comment">// 存放边， 就是我们的邻接矩阵</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MGraph</span><span class="params">(<span class="keyword">int</span> verxs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.verxs = verxs;</span><br><span class="line">        data = <span class="keyword">new</span> <span class="keyword">char</span>[verxs];</span><br><span class="line">        weight = <span class="keyword">new</span> <span class="keyword">int</span>[verxs][verxs];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>贪心算法(集合覆盖问题)</title>
      <link href="/2020/05/08/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95--%E9%9B%86%E5%90%88%E8%A6%86%E7%9B%96%E9%97%AE%E9%A2%98/"/>
      <url>/2020/05/08/%E8%B4%AA%E5%BF%83%E7%AE%97%E6%B3%95--%E9%9B%86%E5%90%88%E8%A6%86%E7%9B%96%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="贪心算法介绍"><a href="#贪心算法介绍" class="headerlink" title="贪心算法介绍"></a>贪心算法介绍</h1><ul><li>贪婪算法(贪心算法)是指在对问题进行求解时， 在每一步选择中都采取最好或者最优(即最有利)的选择， 从而希望能够导致结果是最好或者最优的算法</li><li>贪婪算法所得到的结果不一定是最优的结果(有时候会是最优解)， 但是都是相对近似(接近)最优解的结果</li></ul><h1 id="贪心算法最佳应用-集合覆盖"><a href="#贪心算法最佳应用-集合覆盖" class="headerlink" title="贪心算法最佳应用-集合覆盖"></a>贪心算法最佳应用-集合覆盖</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>假设存在下面需要付费的广播台， 以及广播台信号可以覆盖的地区。 如何选择最少的广播台， 让所有的地区都可以接收到信号<br><img src="/images/2020/08/20200808155707.png" alt></p><h2 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h2><h3 id="方式一-穷举法"><a href="#方式一-穷举法" class="headerlink" title="方式一:穷举法"></a>方式一:穷举法</h3><p>如何找出覆盖所有地区的广播台的集合呢， 使用穷举法实现,列出每个可能的广播台的集合， 这被称为幂集。 假设总的有 n 个广播台， 则广播台的组合总共有<code>2ⁿ -1</code>个,假设每秒可以计算 10 个子集， 如图:<br><img src="/images/2020/08/20200808155851.png" alt></p><h3 id="方式二-贪婪算法-效率高"><a href="#方式二-贪婪算法-效率高" class="headerlink" title="方式二:贪婪算法(效率高)"></a>方式二:贪婪算法(效率高)</h3><ol><li>目前并没有算法可以快速计算得到准备的值， 使用贪婪算法， 则可以得到非常接近的解， 并且效率高。 选择策略上， 因为需要覆盖全部地区的最小集合:</li><li>遍历所有的广播电台, 找到一个覆盖了最多未覆盖的地区的电台(此电台可能包含一些已覆盖的地区， 但没有关系）</li><li>将这个电台加入到一个集合中(比如 ArrayList), 想办法把该电台覆盖的地区在下次比较时去掉。</li><li>重复第 1 步直到覆盖了全部的地区</li></ol><p><img src="/images/2020/08/20200808160017.png" alt></p><h2 id="贪婪算法代码实现"><a href="#贪婪算法代码实现" class="headerlink" title="贪婪算法代码实现"></a>贪婪算法代码实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.algorithm.greedy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreedyAlgorithm</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建广播电台,放入到 Map</span></span><br><span class="line">        HashMap&lt;String, HashSet&lt;String&gt;&gt; broadcasts = <span class="keyword">new</span> HashMap&lt;String, HashSet&lt;String&gt;&gt;();</span><br><span class="line">        <span class="comment">// 将各个电台放入到 broadcasts</span></span><br><span class="line">        HashSet&lt;String&gt; hashSet1 = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">        hashSet1.add(<span class="string">"北京"</span>);</span><br><span class="line">        hashSet1.add(<span class="string">"上海"</span>);</span><br><span class="line">        hashSet1.add(<span class="string">"天津"</span>);</span><br><span class="line">        HashSet&lt;String&gt; hashSet2 = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">        hashSet2.add(<span class="string">"广州"</span>);</span><br><span class="line">        hashSet2.add(<span class="string">"北京"</span>);</span><br><span class="line">        hashSet2.add(<span class="string">"深圳"</span>);</span><br><span class="line">        HashSet&lt;String&gt; hashSet3 = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">        hashSet3.add(<span class="string">"成都"</span>);</span><br><span class="line">        hashSet3.add(<span class="string">"上海"</span>);</span><br><span class="line">        hashSet3.add(<span class="string">"杭州"</span>);</span><br><span class="line">        HashSet&lt;String&gt; hashSet4 = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">        hashSet4.add(<span class="string">"上海"</span>);</span><br><span class="line">        hashSet4.add(<span class="string">"天津"</span>);</span><br><span class="line">        HashSet&lt;String&gt; hashSet5 = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">        hashSet5.add(<span class="string">"杭州"</span>);</span><br><span class="line">        hashSet5.add(<span class="string">"大连"</span>);</span><br><span class="line">        <span class="comment">// 加入到 map</span></span><br><span class="line">        broadcasts.put(<span class="string">"K1"</span>, hashSet1);</span><br><span class="line">        broadcasts.put(<span class="string">"K2"</span>, hashSet2);</span><br><span class="line">        broadcasts.put(<span class="string">"K3"</span>, hashSet3);</span><br><span class="line">        broadcasts.put(<span class="string">"K4"</span>, hashSet4);</span><br><span class="line">        broadcasts.put(<span class="string">"K5"</span>, hashSet5);</span><br><span class="line">        <span class="comment">// allAreas 存放所有的地区</span></span><br><span class="line">        HashSet&lt;String&gt; allAreas = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">        allAreas.add(<span class="string">"北京"</span>);</span><br><span class="line">        allAreas.add(<span class="string">"上海"</span>);</span><br><span class="line">        allAreas.add(<span class="string">"天津"</span>);</span><br><span class="line">        allAreas.add(<span class="string">"广州"</span>);</span><br><span class="line">        allAreas.add(<span class="string">"深圳"</span>);</span><br><span class="line">        allAreas.add(<span class="string">"成都"</span>);</span><br><span class="line">        allAreas.add(<span class="string">"杭州"</span>);</span><br><span class="line">        allAreas.add(<span class="string">"大连"</span>);</span><br><span class="line">        <span class="comment">// 创建 ArrayList, 存放选择的电台集合</span></span><br><span class="line">        ArrayList&lt;String&gt; selects = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="comment">// 定义一个临时的集合， 在遍历的过程中， 存放遍历过程中的电台覆盖的地区和当前还没有覆盖的地区的交集</span></span><br><span class="line">        HashSet&lt;String&gt; tempSet = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">        <span class="comment">// 定义给 maxKey ， 保存在一次遍历过程中， 能够覆盖最大未覆盖的地区对应的电台的 key</span></span><br><span class="line">        <span class="comment">// 如果 maxKey 不为 null , 则会加入到 selects</span></span><br><span class="line">        String maxKey = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (allAreas.size() != <span class="number">0</span>) &#123; <span class="comment">// 如果 allAreas 不为 0, 则表示还没有覆盖到所有的地区</span></span><br><span class="line">            <span class="comment">// 每进行一次 while,需要</span></span><br><span class="line">            maxKey = <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">// 遍历 broadcasts, 取出对应 key</span></span><br><span class="line">            <span class="keyword">for</span> (String key : broadcasts.keySet()) &#123;</span><br><span class="line">                <span class="comment">// 每进行一次 for</span></span><br><span class="line">                tempSet.clear();</span><br><span class="line">                <span class="comment">// 当前这个 key 能够覆盖的地区</span></span><br><span class="line">                HashSet&lt;String&gt; areas = broadcasts.get(key);</span><br><span class="line">                tempSet.addAll(areas);</span><br><span class="line">                <span class="comment">// 求出 tempSet 和 allAreas 集合的交集, 交集会赋给 tempSet</span></span><br><span class="line">                tempSet.retainAll(allAreas);</span><br><span class="line">                <span class="comment">// 如果当前这个集合包含的未覆盖地区的数量， 比 maxKey 指向的集合地区还多</span></span><br><span class="line">                <span class="comment">// 就需要重置 maxKey</span></span><br><span class="line">                <span class="comment">// tempSet.size() &gt;broadcasts.get(maxKey).size())</span></span><br><span class="line">                <span class="comment">// 体现出贪心算法的特点,每次都选择最优的</span></span><br><span class="line">                <span class="keyword">if</span> (tempSet.size() &gt; <span class="number">0</span> &amp;&amp; (maxKey == <span class="keyword">null</span></span><br><span class="line">                        || tempSet.size() &gt; broadcasts.get(maxKey).size())) &#123;</span><br><span class="line">                    maxKey = key;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// maxKey != null, 就应该将 maxKey 加入 selects</span></span><br><span class="line">            <span class="keyword">if</span> (maxKey != <span class="keyword">null</span>) &#123;</span><br><span class="line">                selects.add(maxKey);</span><br><span class="line">                <span class="comment">// 将 maxKey 指向的广播电台覆盖的地区， 从 allAreas 去掉</span></span><br><span class="line">                allAreas.removeAll(broadcasts.get(maxKey));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"得到的选择结果是"</span> + selects);<span class="comment">// [K1,K2,K3,K5]</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="贪心算法注意事项和细节"><a href="#贪心算法注意事项和细节" class="headerlink" title="贪心算法注意事项和细节"></a>贪心算法注意事项和细节</h2><ul><li>贪婪算法所得到的结果不一定是最优的结果(有时候会是最优解)， 但是都是相对近似(接近)最优解的结果</li><li>比如上题的算法选出的是 K1, K2, K3, K5， 符合覆盖了全部的地区</li><li>但是我们发现 K2, K3,K4,K5 也可以覆盖全部地区， 如果 K2 的使用成本低于 K1,那么我们上题的 K1, K2, K3,K5 虽然是满足条件， 但是并不是最优的</li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KMP算法(字符串查找算法)</title>
      <link href="/2020/05/08/KMP%E7%AE%97%E6%B3%95--%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95/"/>
      <url>/2020/05/08/KMP%E7%AE%97%E6%B3%95--%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="应用场景-字符串匹配问题"><a href="#应用场景-字符串匹配问题" class="headerlink" title="应用场景-字符串匹配问题"></a>应用场景-字符串匹配问题</h1><ul><li>有一个字符串 str1= “BBC ABCDAB ABCDABCDABDE”，和一个子串 str2=”ABCDABD”</li><li>现在要判断 str1 是否含有 str2,如果存在，就返回第一次出现的位置,如果没有，则返回-1</li></ul><h1 id="解决方式一-暴力匹配算法"><a href="#解决方式一-暴力匹配算法" class="headerlink" title="解决方式一:暴力匹配算法"></a>解决方式一:暴力匹配算法</h1><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>如果用暴力匹配的思路，并假设现在 str1 匹配到 i 位置，子串 str2 匹配到 j 位置，则有</p><ul><li>如果当前字符匹配成功（即 str1[i] == str2[j]），则 i++， j++，继续匹配下一个字符</li><li>如果匹配失败（即 str1[i]! = str2[j]） ， 令 i = i - (j - 1)， j = 0。 相当于每次匹配失败时， i 回溯， j 被置为 0。</li></ul><h2 id="有什么问题"><a href="#有什么问题" class="headerlink" title="有什么问题"></a>有什么问题</h2><ul><li>用暴力方法解决的话就会有大量的回溯， 每次只移动一位， 若是不匹配， 移动到下一位接着判断， 浪费了大量的时间。 (不可行!)</li></ul><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.algorithm.kmp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViolenceMatch</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 测试暴力匹配算法</span></span><br><span class="line">        String str1 = <span class="string">"BBC ABCDAB ABCDABCDABDE"</span>;</span><br><span class="line">        String str2 = <span class="string">"ABCDABD"</span>;</span><br><span class="line">        <span class="keyword">int</span> index = violenceMatch(str1, str2);</span><br><span class="line">        System.out.println(<span class="string">"index="</span> + index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 暴力匹配算法实现</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">violenceMatch</span><span class="params">(String str1, String str2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">char</span>[] s1 = str1.toCharArray();</span><br><span class="line">        <span class="keyword">char</span>[] s2 = str2.toCharArray();</span><br><span class="line">        <span class="keyword">int</span> s1Len = s1.length;</span><br><span class="line">        <span class="keyword">int</span> s2Len = s2.length;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>; <span class="comment">// i 索引指向 s1</span></span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>; <span class="comment">// j 索引指向 s2</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; s1Len &amp;&amp; j &lt; s2Len) &#123;<span class="comment">// 保证匹配时， 不越界</span></span><br><span class="line">            <span class="keyword">if</span> (s1[i] == s2[j]) &#123;<span class="comment">// 匹配 ok</span></span><br><span class="line">                i++;</span><br><span class="line">                j++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// 没有匹配成功</span></span><br><span class="line">                <span class="comment">// 如果失配（即 str1[i]! = str2[j]） ， 令 i = i - (j - 1)， j = 0。</span></span><br><span class="line">                i = i - (j - <span class="number">1</span>);</span><br><span class="line">                j = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 判断是否匹配成功</span></span><br><span class="line">        <span class="keyword">if</span> (j == s2Len) &#123;</span><br><span class="line">            <span class="keyword">return</span> i - j;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="KMP-算法介绍"><a href="#KMP-算法介绍" class="headerlink" title="KMP 算法介绍"></a>KMP 算法介绍</h1><ol><li>KMP 是一个解决模式串在文本串是否出现过， 如果出现过， 最早出现的位置的经典算法</li><li>Knuth-Morris-Pratt 字符串查找算法， 简称为 “KMP 算法”， 常用于在一个文本串 S 内查找一个模式串 P 的出现位置， 这个算法由 Donald Knuth、 Vaughan Pratt、 James H. Morris 三人于 1977 年联合发表， 故取这 3 人的姓氏命名此算法.</li><li>KMP 方法算法就利用之前判断过信息， 通过一个 next 数组， 保存模式串中前后最长公共子序列的长度， 每次回溯时， 通过 next 数组找到， 前面匹配过的位置，省去了大量的计算时间</li><li>参考资料： <a href="https://www.cnblogs.com/ZuoAndFutureGirl/p/9028287.html" target="_blank" rel="noopener">https://www.cnblogs.com/ZuoAndFutureGirl/p/9028287.html</a></li></ol><h2 id="字符串匹配问题"><a href="#字符串匹配问题" class="headerlink" title="字符串匹配问题"></a>字符串匹配问题</h2><ul><li>有一个字符串 str1= “BBC ABCDAB ABCDABCDABDE”， 和一个子串 str2=”ABCDABD”</li><li>现在要判断 str1 是否含有 str2, 如果存在， 就返回第一次出现的位置, 如果没有， 则返回-1</li><li>要求： 使用 KMP 算法完成判断， 不能使用简单的暴力匹配算法.</li></ul><h2 id="思路分析图解"><a href="#思路分析图解" class="headerlink" title="思路分析图解"></a>思路分析图解</h2><p>举例来说， 有一个字符串 Str1 = “BBC ABCDAB ABCDABCDABDE”， 判断， 里面是否包含另一个字符串 Str2 =”ABCDABD”？</p><ol><li><p>首先， 用 Str1 的第一个字符和 Str2 的第一个字符去比较， 不符合， 关键词向后移动一位<br><img src="/images/2020/08/20200808145222.png" alt></p></li><li><p>重复第一步， 还是不符合， 再后移<br><img src="/images/2020/08/20200808145257.png" alt></p></li><li><p>一直重复， 直到 Str1 有一个字符与 Str2 的第一个字符符合为止<br><img src="/images/2020/08/20200808145747.png" alt></p></li><li><p>接着比较字符串和搜索词的下一个字符， 还是符合<br><img src="/images/2020/08/20200808145802.png" alt></p></li><li><p>遇到 Str1 有一个字符与 Str2 对应的字符不符合。<br><img src="/images/2020/08/20200808145816.png" alt></p></li><li><p>这时候， 想到的是继续遍历 Str1 的下一个字符， 重复第 1 步。 (其实是很不明智的， 因为此时 BCD 已经比较过了，没有必要再做重复的工作，一个基本事实是，当空格与 D 不匹配时， 你其实知道前面六个字符是”ABCDAB”。KMP 算法的想法是，设法利用这个已知信息， 不要把”搜索位置”移回已经比较过的位置，继续把它向后移， 这样就提高了效率。)<br><img src="/images/2020/08/20200808145828.png" alt></p></li><li><p>怎么做到把刚刚重复的步骤省略掉？ 可以对 Str2 计算出一张《部分匹配表》，这张表的产生在后面介绍<br><img src="/images/2020/08/20200808145839.png" alt></p></li><li><p>已知空格与 D 不匹配时， 前面六个字符”ABCDAB”是匹配的。 查表可知， 最后一个匹配字符 B 对应的”部分匹配值”为2，因此按照下面的公式算出向后移动的位数：移动位数 = 已匹配的字符数 - 对应的部分匹配值因为 6 - 2 等于 4， 所以将搜索词向后移动 4 位</p></li><li><p>因为空格与Ｃ 不匹配， 搜索词还要继续往后移。这时，已匹配的字符数为 2（”AB”），对应的”部分匹配值”为 0。所以，移动位数 = 2 - 0，结果为2，于是将搜索词向后移 2 位<br><img src="/images/2020/08/20200808145851.png" alt></p></li><li><p>因为空格与 A 不匹配， 继续后移一位。<br><img src="/images/2020/08/20200808145901.png" alt></p></li><li><p>逐位比较， 直到发现 C 与 D 不匹配。 于是， 移动位数 = 6 - 2， 继续将搜索词向后移动 4 位<br><img src="/images/2020/08/20200808145911.png" alt></p></li><li><p>逐位比较， 直到搜索词的最后一位， 发现完全匹配， 于是搜索完成。 如果还要继续搜索（即找出全部匹配），移动位数 = 7 - 0， 再将搜索词向后移动 7 位，这里就不再重复了<br><img src="/images/2020/08/20200808145920.png" alt></p></li><li><p>介绍《部分匹配表》 怎么产生的先介绍前缀， 后缀是什么<br><img src="/images/2020/08/20200808145930.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&quot;部分匹配值&quot;就是&quot;前缀&quot;和&quot;后缀&quot;的最长的共有元素的长度。 以&quot;ABCDABD&quot;为例，</span><br><span class="line">==&gt; &quot;A&quot;的前缀和后缀都为空集， 共有元素的长度为 0；</span><br><span class="line">==&gt; &quot;AB&quot;的前缀为[A]， 后缀为[B]， 共有元素的长度为 0；</span><br><span class="line">==&gt; &quot;ABC&quot;的前缀为[A, AB]， 后缀为[BC, C]， 共有元素的长度 0；</span><br><span class="line">==&gt; &quot;ABCD&quot;的前缀为[A, AB, ABC]， 后缀为[BCD, CD, D]， 共有元素的长度为 0；</span><br><span class="line">==&gt; &quot;ABCDA&quot;的前缀为[A, AB, ABC, ABCD]， 后缀为[BCDA, CDA, DA, A]， 共有元素为&quot;A&quot;， 长度为 1；</span><br><span class="line">==&gt; &quot;ABCDAB&quot;的前缀为[A, AB, ABC, ABCD, ABCDA]， 后缀为[BCDAB, CDAB, DAB, AB, B]， 共有元素为&quot;AB&quot;，长度为 2；</span><br><span class="line">==&gt; &quot;ABCDABD&quot;的前缀为[A, AB, ABC, ABCD, ABCDA, ABCDAB]， 后缀为[BCDABD, CDABD, DABD, ABD, BD,D]， 共有元素的长度为 0。</span><br></pre></td></tr></table></figure></li><li><p>“部分匹配”的实质是， 有时候，字符串头部和尾部会有重复。比如，”ABCDAB”之中有两个”AB”，那么它的”部分匹配值”就是 2（”AB”的长度）。搜索词移动的时候，第一个”AB”向后移动 4 位（字符串长度-部分匹配值） ， 就可以来到第二个”AB”的位置。<br><img src="/images/2020/08/20200808145943.png" alt><br>到此 KMP 算法思想分析完毕!</p></li></ol><h2 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.algorithm.kmp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KMPAlgorithm</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str1 = <span class="string">"BBC ABCDAB ABCDABCDABDE"</span>;</span><br><span class="line">        String str2 = <span class="string">"ABCDABD"</span>;</span><br><span class="line">        <span class="comment">// String str2 = "BBC";</span></span><br><span class="line">        <span class="keyword">int</span>[] next = kmpNext(<span class="string">"ABCDABD"</span>); <span class="comment">// [0, 1, 2, 0]</span></span><br><span class="line">        System.out.println(<span class="string">"next="</span> + Arrays.toString(next));</span><br><span class="line">        <span class="keyword">int</span> index = kmpSearch(str1, str2, next);</span><br><span class="line">        System.out.println(<span class="string">"index="</span> + index); <span class="comment">// 15 了</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * kmp 搜索算法</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str1 源字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str2 子串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> next 部分匹配表, 是子串对应的部分匹配表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果是-1 就是没有匹配到， 否则返回第一个匹配的位置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">kmpSearch</span><span class="params">(String str1, String str2, <span class="keyword">int</span>[] next)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 遍历</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; str1.length(); i++) &#123;</span><br><span class="line">            <span class="comment">// 需要处理 str1.charAt(i) ！ = str2.charAt(j), 去调整 j 的大小</span></span><br><span class="line">            <span class="comment">// KMP 算法核心点, 可以验证...</span></span><br><span class="line">            <span class="keyword">while</span> (j &gt; <span class="number">0</span> &amp;&amp; str1.charAt(i) != str2.charAt(j)) &#123;</span><br><span class="line">                j = next[j - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (str1.charAt(i) == str2.charAt(j)) &#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (j == str2.length()) &#123;<span class="comment">// 找到了 // j = 3 i</span></span><br><span class="line">                <span class="keyword">return</span> i - j + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取到一个字符串(子串) 的部分匹配值表</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dest 目标字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] kmpNext(String dest) &#123;</span><br><span class="line">        <span class="comment">// 创建一个 next 数组保存部分匹配值</span></span><br><span class="line">        <span class="keyword">int</span>[] next = <span class="keyword">new</span> <span class="keyword">int</span>[dest.length()];</span><br><span class="line">        next[<span class="number">0</span>] = <span class="number">0</span>; <span class="comment">// 如果字符串是长度为 1 部分匹配值就是 0</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, j = <span class="number">0</span>; i &lt; dest.length(); i++) &#123;</span><br><span class="line">            <span class="comment">// 当 dest.charAt(i) != dest.charAt(j) ， 我们需要从 next[j-1]获取新的 j</span></span><br><span class="line">            <span class="comment">// 直到我们发现 有 dest.charAt(i) == dest.charAt(j)成立才退出</span></span><br><span class="line">            <span class="comment">// 这是 kmp 算法的核心点</span></span><br><span class="line">            <span class="keyword">while</span> (j &gt; <span class="number">0</span> &amp;&amp; dest.charAt(i) != dest.charAt(j)) &#123;</span><br><span class="line">                j = next[j - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 当 dest.charAt(i) == dest.charAt(j) 满足时， 部分匹配值就是+1</span></span><br><span class="line">            <span class="keyword">if</span> (dest.charAt(i) == dest.charAt(j)) &#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            next[i] = j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动态规划算法--背包问题</title>
      <link href="/2020/05/08/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%AE%97%E6%B3%95--%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/"/>
      <url>/2020/05/08/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%AE%97%E6%B3%95--%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="动态规划算法介绍"><a href="#动态规划算法介绍" class="headerlink" title="动态规划算法介绍"></a>动态规划算法介绍</h1><ol><li>动态规划(Dynamic Programming)算法的核心思想是： 将大问题划分为小问题进行解决， 从而一步步获取最优解的处理算法</li><li>动态规划算法与分治算法类似， 其基本思想也是将待求解问题分解成若干个子问题， 先求解子问题， 然后从这些子问题的解得到原问题的解。</li><li>与分治法不同的是， 适合于用动态规划求解的问题， 经分解得到子问题往往不是互相独立的。 ( 即下一个子阶段的求解是建立在上一个子阶段的解的基础上， 进行进一步的求解 )</li><li>动态规划可以通过填表的方式来逐步推进， 得到最优解</li></ol><h1 id="背包问题"><a href="#背包问题" class="headerlink" title="背包问题"></a>背包问题</h1><ul><li>背包问题主要是指一个给定容量的背包、 若干具有一定价值和重量的物品，如何选择物品放入背包使物品的价值最大。其中又分 <ul><li>0-1背包</li><li>完全背包(完全背包指的是： 每种物品都有无限件可用, 无限背包可以转化为 01 背包)</li></ul></li></ul><h2 id="0-1背包问题"><a href="#0-1背包问题" class="headerlink" title="0-1背包问题"></a>0-1背包问题</h2><p>背包问题： 有一个背包， 容量为 4 磅 ， 现有如下物品<br><img src="/images/2020/08/20200808141329.png" alt></p><ul><li>要求达到的目标为装入的背包的总价值最大， 并且重量不超出</li><li>要求装入的物品不能重复</li></ul><h2 id="0-1背包问题的解决"><a href="#0-1背包问题的解决" class="headerlink" title="0-1背包问题的解决"></a>0-1背包问题的解决</h2><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p><img src="/images/2020/08/20200808142237.png" alt><br>算法的主要思想，利用动态规划来解决。每次遍历到的第 i 个物品，根据 w[i]和 v[i]来确定是否需要将该物品,即对于给定的 n 个物品， 设 v[i]、 w[i]分别为第 i 个物品的价值和重量， C 为背包的容量。 再令 v[i][j]表示在前 i 个物品中能够装入容量为 j 的背包中的最大价值。 则我们有下面的结果：</p><ol><li><code>v[i][0]=v[0][j]=0;</code> //表示 填入表 第一行和第一列是 0</li><li>当 <code>w[i]&gt; j</code>时： <code>v[i][j]=v[i-1][j]</code>  ==&gt; 当准备加入新增的商品的容量大于 当前背包的容量时， 就直接使用上一个单元格的装入策略</li><li>当 <code>j&gt;=w[i]</code>时： <code>v[i][j]=max{v[i-1][j], v[i]+v[i-1][j-w[i]]}</code> ==&gt; 当准备加入的新增的商品的容量小于等于当前背包的容量<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 装入的方式:</span><br><span class="line">v[i-1][j]： 就是上一个单元格的装入的最大值</span><br><span class="line">v[i] : 表示当前商品的价值</span><br><span class="line">v[i-1][j-w[i]] ： 装入 i-1 商品， 到剩余空间 j-w[i]的最大值</span><br><span class="line">当 j&gt;=w[i]时： v[i][j]=max&#123;v[i-1][j], v[i]+v[i-1][j-w[i]]&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="图解分析"><a href="#图解分析" class="headerlink" title="图解分析"></a>图解分析</h3><p><img src="/images/2020/08/20200808142238.png" alt><br><img src="/images/2020/08/20200808142236.png" alt></p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.algorithm.dynamic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KnapsackProblem</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] w = &#123; <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span> &#125;;<span class="comment">// 物品的重量</span></span><br><span class="line">        <span class="keyword">int</span>[] val = &#123; <span class="number">1500</span>, <span class="number">3000</span>, <span class="number">2000</span> &#125;; <span class="comment">// 物品的价值 这里 val[i] 就是前面讲的 v[i]</span></span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">4</span>; <span class="comment">// 背包的容量</span></span><br><span class="line">        <span class="keyword">int</span> n = val.length; <span class="comment">// 物品的个数</span></span><br><span class="line">        <span class="comment">// 创建二维数组，</span></span><br><span class="line">        <span class="comment">// v[i][j] 表示在前 i 个物品中能够装入容量为 j 的背包中的最大价值</span></span><br><span class="line">        <span class="keyword">int</span>[][] v = <span class="keyword">new</span> <span class="keyword">int</span>[n + <span class="number">1</span>][m + <span class="number">1</span>];</span><br><span class="line">        <span class="comment">// 为了记录放入商品的情况， 我们定一个二维数组</span></span><br><span class="line">        <span class="keyword">int</span>[][] path = <span class="keyword">new</span> <span class="keyword">int</span>[n + <span class="number">1</span>][m + <span class="number">1</span>];</span><br><span class="line">        <span class="comment">// 初始化第一行和第一列, 这里在本程序中， 可以不去处理， 因为默认就是 0</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.length; i++) &#123;</span><br><span class="line">            v[i][<span class="number">0</span>] = <span class="number">0</span>; <span class="comment">// 将第一列设置为 0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v[<span class="number">0</span>].length; i++) &#123;</span><br><span class="line">            v[<span class="number">0</span>][i] = <span class="number">0</span>; <span class="comment">// 将第一行设置 0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据前面得到公式来动态规划处理</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; v.length; i++) &#123; <span class="comment">// 不处理第一行 i 是从 1 开始的</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; v[<span class="number">0</span>].length; j++) &#123;<span class="comment">// 不处理第一列, j 是从 1 开始的</span></span><br><span class="line">                <span class="comment">// 公式</span></span><br><span class="line">                <span class="keyword">if</span> (w[i - <span class="number">1</span>] &gt; j) &#123; <span class="comment">// 因为我们程序 i 是从 1 开始的， 因此原来公式中的 w[i] 修改成</span></span><br><span class="line">                                    <span class="comment">// w[i-1]</span></span><br><span class="line">                    v[i][j] = v[i - <span class="number">1</span>][j];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 说明:</span></span><br><span class="line">                    <span class="comment">// 因为我们的 i 从 1 开始的， 因此公式需要调整成</span></span><br><span class="line">                    <span class="comment">// v[i][j]=Math.max(v[i-1][j], val[i-1]+v[i-1][j-w[i-1]]);</span></span><br><span class="line">                    <span class="comment">// v[i][j] = Math.max(v[i - 1][j], val[i - 1] + v[i - 1][j -</span></span><br><span class="line">                    <span class="comment">// w[i - 1]]);</span></span><br><span class="line">                    <span class="comment">// 为了记录商品存放到背包的情况， 我们不能直接的使用上面的公式， 需要使用 if-else 来体现公式</span></span><br><span class="line">                    <span class="keyword">if</span> (v[i - <span class="number">1</span>][j] &lt; val[i - <span class="number">1</span>] + v[i - <span class="number">1</span>][j - w[i - <span class="number">1</span>]]) &#123;</span><br><span class="line">                        v[i][j] = val[i - <span class="number">1</span>] + v[i - <span class="number">1</span>][j - w[i - <span class="number">1</span>]];</span><br><span class="line">                        <span class="comment">// 把当前的情况记录到 path</span></span><br><span class="line">                        path[i][j] = <span class="number">1</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        v[i][j] = v[i - <span class="number">1</span>][j];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 输出一下 v 看看目前的情况</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; v[i].length; j++) &#123;</span><br><span class="line">                System.out.print(v[i][j] + <span class="string">" "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"============================"</span>);</span><br><span class="line">        <span class="comment">// 输出最后我们是放入的哪些商品</span></span><br><span class="line">        <span class="comment">// 遍历 path, 这样输出会把所有的放入情况都得到, 其实我们只需要最后的放入</span></span><br><span class="line"><span class="comment">//      for (int i = 0; i &lt; path.length; i++) &#123;</span></span><br><span class="line"><span class="comment">//          for (int j = 0; j &lt; path[i].length; j++) &#123;</span></span><br><span class="line"><span class="comment">//              if (path[i][j] == 1) &#123;</span></span><br><span class="line"><span class="comment">//                  System.out.printf("第%d 个商品放入到背包\n", i);</span></span><br><span class="line"><span class="comment">//              &#125;</span></span><br><span class="line"><span class="comment">//          &#125;</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line">        <span class="comment">// 动脑筋</span></span><br><span class="line">        <span class="keyword">int</span> i = path.length - <span class="number">1</span>; <span class="comment">// 行的最大下标</span></span><br><span class="line">        <span class="keyword">int</span> j = path[<span class="number">0</span>].length - <span class="number">1</span>; <span class="comment">// 列的最大下标</span></span><br><span class="line">        <span class="keyword">while</span> (i &gt; <span class="number">0</span> &amp;&amp; j &gt; <span class="number">0</span>) &#123; <span class="comment">// 从 path 的最后开始找</span></span><br><span class="line">            <span class="keyword">if</span> (path[i][j] == <span class="number">1</span>) &#123;</span><br><span class="line">                System.out.printf(<span class="string">"第%d 个商品放入到背包\n"</span>, i);</span><br><span class="line">                j -= w[i - <span class="number">1</span>]; <span class="comment">// w[i-1]</span></span><br><span class="line">            &#125;</span><br><span class="line">            i--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>分治算法--汉诺塔问题</title>
      <link href="/2020/05/08/%E5%88%86%E6%B2%BB%E7%AE%97%E6%B3%95--%E6%B1%89%E8%AF%BA%E5%A1%94%E9%97%AE%E9%A2%98/"/>
      <url>/2020/05/08/%E5%88%86%E6%B2%BB%E7%AE%97%E6%B3%95--%E6%B1%89%E8%AF%BA%E5%A1%94%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="分治算法介绍"><a href="#分治算法介绍" class="headerlink" title="分治算法介绍"></a>分治算法介绍</h1><ol><li><p>分治法是一种很重要的算法。 字面上的解释是“分而治之” ， 就是把一个复杂的问题分成两个或更多的相同或相似的子问题，再把子问题分成更小的子问题……直到最后子问题可以简单的直接求解， 原问题的解即子问题的解的合并。这个技巧是很多高效算法的基础， 如排序算法(快速排序， 归并排序)， 傅立叶变换(快速傅立叶变换)……</p></li><li><p>分治算法可以求解的一些经典问题</p></li></ol><ul><li>二分搜索</li><li>大整数乘法</li><li>棋盘覆盖</li><li>合并排序</li><li>快速排序</li><li>线性时间选择</li><li>最接近点对问题</li><li>循环赛日程表</li><li>汉诺塔</li></ul><h1 id="分治算法的基本步骤"><a href="#分治算法的基本步骤" class="headerlink" title="分治算法的基本步骤"></a>分治算法的基本步骤</h1><p>分治法在每一层递归上都有三个步骤：<br>1) 分解： 将原问题分解为若干个规模较小， 相互独立， 与原问题形式相同的子问题<br>2) 解决： 若子问题规模较小而容易被解决则直接解， 否则递归地解各个子问题<br>3) 合并： 将各个子问题的解合并为原问题的解。</p><h1 id="分治-Divide-and-Conquer-P-算法设计模式"><a href="#分治-Divide-and-Conquer-P-算法设计模式" class="headerlink" title="分治(Divide-and-Conquer(P))算法设计模式"></a>分治(Divide-and-Conquer(P))算法设计模式</h1><p><img src="/images/2020/08/20200808140633.png" alt></p><h1 id="分治算法最佳实践-汉诺塔"><a href="#分治算法最佳实践-汉诺塔" class="headerlink" title="分治算法最佳实践-汉诺塔"></a>分治算法最佳实践-汉诺塔</h1><h2 id="汉诺塔的传说"><a href="#汉诺塔的传说" class="headerlink" title="汉诺塔的传说"></a>汉诺塔的传说</h2><p>汉诺塔： 汉诺塔（又称河内塔） 问题是源于印度一个古老传说的益智玩具。 大梵天创造世界的时候做了三根金刚石柱子， 在一根柱子上从下往上按照大小顺序摞着 64 片黄金圆盘。 大梵天命令婆罗门把圆盘从下面开始按大小顺序重新摆放在另一根柱子上。 并且规定， 在小圆盘上不能放大圆盘，三根柱子之间一次只能移动一个圆盘。假如每秒钟一次， 共需多长时间呢？ 移完这些金片需要 5845.54 亿年以上，太阳系的预期寿命据说也就是数百亿年。 真的过了 5845.54 亿年， 地球上的一切生命， 连同梵塔、 庙宇等， 都早已经灰飞烟灭。</p><h2 id="汉诺塔游戏的演示和思路分析"><a href="#汉诺塔游戏的演示和思路分析" class="headerlink" title="汉诺塔游戏的演示和思路分析"></a>汉诺塔游戏的演示和思路分析</h2><ol><li>如果是有一个盘， A-&gt;C, </li><li>如果我们有 n &gt;= 2 情况， 我们总是可以看做是两个盘 <ul><li>最下边的盘</li><li>上面的盘</li></ul></li><li>先把最上面的盘 A-&gt;B</li><li>把最下边的盘 A-&gt;C</li><li>把 B 塔的所有盘 从 B-&gt;C</li></ol><h2 id="汉诺塔游戏的代码实现"><a href="#汉诺塔游戏的代码实现" class="headerlink" title="汉诺塔游戏的代码实现"></a>汉诺塔游戏的代码实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.algorithm.dac;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hanoitower</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        hanoiTower(<span class="number">5</span>, <span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 汉诺塔的移动的方法</span></span><br><span class="line"><span class="comment">     * 使用分治算法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> num 盘的数量</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> a a柱子</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> b b柱子</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> c c柱子</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hanoiTower</span><span class="params">(<span class="keyword">int</span> num, <span class="keyword">char</span> a, <span class="keyword">char</span> b, <span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//如果只有一个盘</span></span><br><span class="line">        <span class="keyword">if</span> (num == <span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"第 1 个盘从 "</span> + a + <span class="string">"-&gt;"</span> + c);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果我们有 n &gt;= 2 情况， 我们总是可以看做是两个盘 1.最下边的一个盘 2. 上面的所有盘</span></span><br><span class="line">            <span class="comment">// 1. 先把 最上面的所有盘 A-&gt;B， 移动过程会使用到 c</span></span><br><span class="line">            hanoiTower(num - <span class="number">1</span>, a, c, b);</span><br><span class="line">            <span class="comment">// 2. 把最下边的盘 A-&gt;C</span></span><br><span class="line">            System.out.println(<span class="string">"第"</span> + num + <span class="string">"个盘从 "</span> + a + <span class="string">"-&gt;"</span> + c);</span><br><span class="line">            <span class="comment">// 3. 把 B 塔的所有盘 从 B-&gt;C , 移动过程使用到 a 塔</span></span><br><span class="line">            hanoiTower(num - <span class="number">1</span>, b, a, c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>二分查找算法--非递归</title>
      <link href="/2020/05/08/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95-%E9%9D%9E%E9%80%92%E5%BD%92/"/>
      <url>/2020/05/08/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE%E7%AE%97%E6%B3%95-%E9%9D%9E%E9%80%92%E5%BD%92/</url>
      
        <content type="html"><![CDATA[<h1 id="二分查找算法-非递归-介绍"><a href="#二分查找算法-非递归-介绍" class="headerlink" title="二分查找算法(非递归)介绍"></a>二分查找算法(非递归)介绍</h1><ul><li>前面我们讲过了二分查找算法， 是使用递归的方式， 下面我们讲解二分查找算法的非递归方式</li><li>二分查找法只适用于从有序的数列中进行查找(比如数字和字母等)， 将数列排序后再进行查找</li><li>二分查找法的运行时间为对数时间<code>O(㏒₂ n)</code>， 即查找到需要的目标位置最多只需要㏒₂ n 步， 假设从[0,99]的队列(100 个数， 即 n=100)中寻到目标数 30，则需要查找步数为㏒₂ 100 , 即最多需要查找 7 次( 2^6 &lt; 100 &lt; 2^7)</li></ul><h1 id="二分查找算法-非递归-代码实现"><a href="#二分查找算法-非递归-代码实现" class="headerlink" title="二分查找算法(非递归)代码实现"></a>二分查找算法(非递归)代码实现</h1><p>数组 {1,3, 8, 10, 11, 67, 100}, 编程实现二分查找， 要求使用非递归的方式完成.</p><p>代码实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.algorithm.binarysearchnorecursion;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinarySearchNoRecur</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123; <span class="number">1</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">67</span>, <span class="number">100</span> &#125;;</span><br><span class="line">        <span class="keyword">int</span> index = binarySearch(arr, <span class="number">100</span>);</span><br><span class="line">        System.out.println(<span class="string">"index="</span> + index);<span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 二分查找的非递归实现</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arr    待查找的数组, arr 是升序排序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> target 需要查找的数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回对应下标， -1 表示没有找到</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">binarySearch</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> right = arr.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left &lt;= right) &#123; <span class="comment">// 说明继续查找</span></span><br><span class="line">            <span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (arr[mid] == target) &#123;</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[mid] &gt; target) &#123;</span><br><span class="line">                right = mid - <span class="number">1</span>;<span class="comment">// 需要向左边查找</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                left = mid + <span class="number">1</span>; <span class="comment">// 需要向右边查找</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>图的基本介绍与深度和广度优先遍历算法</title>
      <link href="/2020/05/07/%E5%9B%BE%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%92%8C%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E9%81%8D%E5%8E%86%E7%AE%97%E6%B3%95/"/>
      <url>/2020/05/07/%E5%9B%BE%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E4%B8%8E%E6%B7%B1%E5%BA%A6%E5%92%8C%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E9%81%8D%E5%8E%86%E7%AE%97%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="图基本介绍"><a href="#图基本介绍" class="headerlink" title="图基本介绍"></a>图基本介绍</h1><h2 id="为什么要有图"><a href="#为什么要有图" class="headerlink" title="为什么要有图"></a>为什么要有图</h2><ul><li>前面我们学了线性表和树</li><li>线性表局限于一个直接前驱和一个直接后继的关系</li><li>树也只能有一个直接前驱也就是父节点</li><li>当我们需要表示多对多的关系时，这里我们就用到了图</li></ul><h2 id="图的举例说明"><a href="#图的举例说明" class="headerlink" title="图的举例说明"></a>图的举例说明</h2><p>图是一种数据结构，其中结点可以具有零个或多个相邻元素。两个结点之间的连接称为边。结点也可以称为顶点。如图<br><img src="/images/2020/08/20200807104417.png" alt></p><h2 id="图的常用概念"><a href="#图的常用概念" class="headerlink" title="图的常用概念"></a>图的常用概念</h2><ul><li>顶点(vertex)</li><li>边(edge)</li><li>路径</li><li>无向图<br><img src="/images/2020/08/20200807104508.png" alt></li><li>有向图<br><img src="/images/2020/08/20200807104535.png" alt></li><li>带权图<br><img src="/images/2020/08/20200807104557.png" alt></li></ul><h1 id="图的表示方式"><a href="#图的表示方式" class="headerlink" title="图的表示方式"></a>图的表示方式</h1><p>图的表示方式有两种</p><ul><li>二维数组表示（邻接矩阵）；</li><li>链表表示（邻接表）。</li></ul><h2 id="邻接矩阵"><a href="#邻接矩阵" class="headerlink" title="邻接矩阵"></a>邻接矩阵</h2><p>邻接矩阵是表示图形中顶点之间相邻关系的矩阵， 对于 n 个顶点的图而言， 矩阵是的 row 和 col 表示的是 1….n个点<br><img src="/images/2020/08/20200807104708.png" alt></p><h2 id="邻接表"><a href="#邻接表" class="headerlink" title="邻接表"></a>邻接表</h2><ul><li>邻接矩阵需要为每个顶点都分配 n 个边的空间， 其实有很多边都是不存在,会造成空间的一定损失.</li><li>邻接表的实现只关心存在的边， 不关心不存在的边。 因此没有空间浪费， 邻接表由数组+链表组成</li><li>举例说明<br><img src="/images/2020/08/20200807104745.png" alt></li></ul><h1 id="图的代码实现"><a href="#图的代码实现" class="headerlink" title="图的代码实现"></a>图的代码实现</h1><h2 id="创建图"><a href="#创建图" class="headerlink" title="创建图"></a>创建图</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.graph;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Graph</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; vertexList;   <span class="comment">// 存储顶点集合</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][] edges;  <span class="comment">// 存储图对应的邻接矩阵</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> numOfEdges; <span class="comment">// 表示边的数目</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/////////////////////////</span></span><br><span class="line">        <span class="comment">// 创建图</span></span><br><span class="line">        <span class="comment">/////////////////////////</span></span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">5</span>;  <span class="comment">// 顶点个数</span></span><br><span class="line">        String Vertexs[] = &#123;<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>, <span class="string">"E"</span>&#125;;</span><br><span class="line">        <span class="comment">// 创建图对象</span></span><br><span class="line">        Graph graph = <span class="keyword">new</span> Graph(n);</span><br><span class="line">        <span class="comment">// 循环添加顶点</span></span><br><span class="line">        <span class="keyword">for</span> (String vertex : Vertexs) &#123;</span><br><span class="line">            graph.insertVertex(vertex);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加边</span></span><br><span class="line">        graph.insertEdge(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        graph.insertEdge(<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">        graph.insertEdge(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">        graph.insertEdge(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">        graph.insertEdge(<span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 显示邻接矩阵</span></span><br><span class="line">        graph.showGraph();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Graph</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 初始化矩阵和vertexList</span></span><br><span class="line">        edges = <span class="keyword">new</span> <span class="keyword">int</span>[n][n];</span><br><span class="line">        vertexList = <span class="keyword">new</span> ArrayList&lt;String&gt;(n);</span><br><span class="line">        numOfEdges = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line"><span class="comment">//创建图</span></span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入顶点</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> vertex 顶点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertVertex</span><span class="params">(String vertex)</span> </span>&#123;</span><br><span class="line">        vertexList.add(vertex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加边</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v1     表示第一个顶点的下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v2     表示第二个顶点的下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> weight 权重</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertEdge</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2, <span class="keyword">int</span> weight)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 因为是无向图,所以两个方向都要添加</span></span><br><span class="line">        edges[v1][v2] = weight;</span><br><span class="line">        edges[v2][v1] = weight;</span><br><span class="line">        numOfEdges++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line"><span class="comment">// 图中常用方法</span></span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到结点的个数</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumOfVertex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> vertexList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到边的数目</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumOfEdges</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> numOfEdges;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回下标为i对应的数据 0-&gt;"A" 1-&gt;"B" 2-&gt;"C"</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> i 下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValueByIndex</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> vertexList.get(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回v1和v2的权值</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWeight</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> edges[v1][v2];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示图对应的矩阵</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showGraph</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] link : edges) &#123;</span><br><span class="line">            System.out.println(Arrays.toString(link));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="深度优先搜索-DFS"><a href="#深度优先搜索-DFS" class="headerlink" title="深度优先搜索(DFS)"></a>深度优先搜索(DFS)</h2><h3 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h3><p>深度优先搜索算法有如下规则：</p><blockquote><p>  规则1：如果可能，访问一个邻接的未访问顶点，标记它，并将它放入栈中。<br>  规则2：当不能执行规则 1 时，如果栈不为空，就从栈中弹出一个顶点。<br>  规则3：如果不能执行规则 1 和规则 2 时，就完成了整个搜索过程。</p></blockquote><p><img src="/images/2020/08/20200807105020.png" alt></p><p>　　对于上图，应用深度优先搜索如下：假设选取 A 顶点为起始点，并且按照字母优先顺序进行访问，那么应用规则 1 ，接下来访问顶点 B，然后标记它，并将它放入栈中；再次应用规则 1，接下来访问顶点 F，再次应用规则 1，访问顶点 H。我们这时候发现，没有 H 顶点的邻接点了，这时候应用规则 2，从栈中弹出 H，这时候回到了顶点 F，但是我们发现 F 也除了 H 也没有与之邻接且未访问的顶点了，那么再弹出 F，这时候回到顶点 B，同理规则 1 应用不了，应用规则 2，弹出 B，这时候栈中只有顶点 A了，然后 A 还有未访问的邻接点，所有接下来访问顶点 C，但是 C又是这条线的终点，所以从栈中弹出它，再次回到 A，接着访问 D,G,I，最后也回到了 A，然后访问 E，但是最后又回到了顶点 A，这时候我们发现 A没有未访问的邻接点了，所以也把它弹出栈。现在栈中已无顶点，于是应用规则 3，完成了整个搜索过程。<br>　　深度优先搜索在于能够找到与某一顶点邻接且没有访问过的顶点。这里以邻接矩阵为例，找到顶点所在的行，从第一列开始向后寻找值为1的列；列号是邻接顶点的号码，检查这个顶点是否未访问过，如果是这样，那么这就是要访问的下一个顶点，如果该行没有顶点既等于1（邻接）且又是未访问的，那么与指定点相邻接的顶点就全部访问过了。</p><h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.graph;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Graph</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; vertexList;   <span class="comment">// 存储顶点集合</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][] edges;  <span class="comment">// 存储图对应的邻接矩阵</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> numOfEdges; <span class="comment">// 表示边的数目</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span>[] isVisited;    <span class="comment">// 保存已经访问过的结点</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/////////////////////////</span></span><br><span class="line">        <span class="comment">// 创建图</span></span><br><span class="line">        <span class="comment">/////////////////////////</span></span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">5</span>;  <span class="comment">// 顶点个数</span></span><br><span class="line">        String Vertexs[] = &#123;<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>, <span class="string">"E"</span>&#125;;</span><br><span class="line">        <span class="comment">// 创建图对象</span></span><br><span class="line">        Graph graph = <span class="keyword">new</span> Graph(n);</span><br><span class="line">        <span class="comment">// 循环添加顶点</span></span><br><span class="line">        <span class="keyword">for</span> (String vertex : Vertexs) &#123;</span><br><span class="line">            graph.insertVertex(vertex);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加边</span></span><br><span class="line">        graph.insertEdge(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        graph.insertEdge(<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">        graph.insertEdge(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">        graph.insertEdge(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">        graph.insertEdge(<span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 显示邻接矩阵</span></span><br><span class="line">        graph.showGraph();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/////////////////////////</span></span><br><span class="line">        <span class="comment">// 深度遍历</span></span><br><span class="line">        <span class="comment">/////////////////////////</span></span><br><span class="line">        System.out.println(<span class="string">"深度遍历"</span>);</span><br><span class="line">        graph.dfs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Graph</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 初始化矩阵和vertexList</span></span><br><span class="line">        edges = <span class="keyword">new</span> <span class="keyword">int</span>[n][n];</span><br><span class="line">        vertexList = <span class="keyword">new</span> ArrayList&lt;String&gt;(n);</span><br><span class="line">        numOfEdges = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        isVisited = <span class="keyword">new</span> <span class="keyword">boolean</span>[n];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line"><span class="comment">//深度优先遍历</span></span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到第一个邻接结点的下标</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 邻接矩阵的行的下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果存在就返回对应的下标，否则返回-1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFirstNeighbor</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; vertexList.size(); j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (edges[index][j] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据前一个邻接结点的下标来获取下一个邻接结点</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v1 邻接矩阵的行的下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v2 邻接矩阵的列(上一个被访问的矩阵的列的下标)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNextNeighbor</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = v2 + <span class="number">1</span>; j &lt; vertexList.size(); j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (edges[v1][j] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 深度优先遍历算法</span></span><br><span class="line"><span class="comment">     * ==&gt; 规则1：如果可能，访问一个邻接的未访问顶点，标记它，并将它放入栈中。</span></span><br><span class="line"><span class="comment">     * ==&gt; 规则2：当不能执行规则 1 时，如果栈不为空，就从栈中弹出一个顶点。</span></span><br><span class="line"><span class="comment">     * ==&gt; 规则3：如果不能执行规则 1 和规则 2 时，就完成了整个搜索过程。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isVisited 是否访问过</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> i 邻接矩阵的行的下标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">boolean</span>[] isVisited, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 0. 访问顶点</span></span><br><span class="line">        <span class="comment">// ==&gt; 首先我们访问该结点 =&gt; 这里表现为输出</span></span><br><span class="line">        System.out.print(getValueByIndex(i) + <span class="string">"-&gt;"</span>);</span><br><span class="line">        <span class="comment">// ==&gt; 将结点设置为已经访问</span></span><br><span class="line">        isVisited[i] = <span class="keyword">true</span>;</span><br><span class="line">        <span class="comment">// 1. 访问一个邻接的未访问顶点，标记它，并将它放入栈中</span></span><br><span class="line">        <span class="comment">// ==&gt; 查找结点i的第一个邻接结点w</span></span><br><span class="line">        <span class="keyword">int</span> firstNeighbor = getFirstNeighbor(i);</span><br><span class="line">        <span class="keyword">while</span> (firstNeighbor != -<span class="number">1</span>) &#123;   <span class="comment">// 不等于-1,说明找到邻接结点</span></span><br><span class="line">            <span class="comment">// ==&gt; 判断这个邻接结点是否访问过</span></span><br><span class="line">            <span class="keyword">if</span> (!isVisited[firstNeighbor]) &#123;    </span><br><span class="line">                <span class="comment">// ==&gt; 如果没有访问过,则以当前这个邻接结点开始,继续寻找下一个邻接结点</span></span><br><span class="line">                <span class="comment">// ==&gt; 也就是进行深度优先遍历</span></span><br><span class="line">                dfs(isVisited, firstNeighbor);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ==&gt; 如果firstNeighbor结点已经被访问过</span></span><br><span class="line">            <span class="comment">// ==&gt; 访问下一个邻接的未访问顶点</span></span><br><span class="line">            firstNeighbor = getNextNeighbor(i, firstNeighbor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对dfs进行一个重载,遍历我们所有的结点,并进行dfs</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 遍历所有的结点,进行dfs[回溯]</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getNumOfVertex(); i++) &#123;</span><br><span class="line">            <span class="comment">// 只有未被访问过才需要进行深度优先遍历</span></span><br><span class="line">            <span class="keyword">if</span> (!isVisited[i]) &#123;</span><br><span class="line">                dfs(isVisited, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line"><span class="comment">//创建图</span></span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入顶点</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> vertex 顶点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertVertex</span><span class="params">(String vertex)</span> </span>&#123;</span><br><span class="line">        vertexList.add(vertex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加边</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v1     表示第一个顶点的下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v2     表示第二个顶点的下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> weight 权重</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertEdge</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2, <span class="keyword">int</span> weight)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 因为是无向图,所以两个方向都要添加</span></span><br><span class="line">        edges[v1][v2] = weight;</span><br><span class="line">        edges[v2][v1] = weight;</span><br><span class="line">        numOfEdges++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line"><span class="comment">// 图中常用方法</span></span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到结点的个数</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumOfVertex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> vertexList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到边的数目</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumOfEdges</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> numOfEdges;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回下标为i对应的数据 0-&gt;"A" 1-&gt;"B" 2-&gt;"C"</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> i 下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValueByIndex</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> vertexList.get(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回v1和v2的权值</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWeight</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> edges[v1][v2];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示图对应的矩阵</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showGraph</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] link : edges) &#123;</span><br><span class="line">            System.out.println(Arrays.toString(link));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="广度优先搜索-BFS"><a href="#广度优先搜索-BFS" class="headerlink" title="广度优先搜索(BFS)"></a>广度优先搜索(BFS)</h2><p>　　深度优先搜索要尽可能的远离起始点，而广度优先搜索则要尽可能的靠近起始点，它首先访问起始顶点的所有邻接点，然后再访问较远的区域，这种搜索不能用栈实现，而是用队列实现。</p><h3 id="规则-1"><a href="#规则-1" class="headerlink" title="规则"></a>规则</h3><blockquote><p>  规则1：访问下一个未访问的邻接点（如果存在），这个顶点必须是当前顶点的邻接点，标记它，并把它插入到队列中。<br>  规则2：如果已经没有未访问的邻接点而不能执行规则 1 时，那么从队列列头取出一个顶点（如果存在），并使其成为当前顶点。<br>  规则3：如果因为队列为空而不能执行规则 2，则搜索结束。</p></blockquote><p><img src="/images/2020/08/20200807105020.png" alt></p><p>　　对于上面的图，应用广度优先搜索：以A为起始点，首先访问所有与 A 相邻的顶点，并在访问的同时将其插入队列中，现在已经访问了 A,B,C,D和E。这时队列（从头到尾）包含 BCDE，已经没有未访问的且与顶点 A 邻接的顶点了，所以从队列中取出B，寻找与B邻接的顶点，这时找到F，所以把F插入到队列中。已经没有未访问且与B邻接的顶点了，所以从队列列头取出C，它没有未访问的邻接点。因此取出 D 并访问 G，D也没有未访问的邻接点了，所以取出E，现在队列中有 FG，在取出 F，访问 H，然后取出 G，访问 I，现在队列中有 HI，当取出他们时，发现没有其它为访问的顶点了，这时队列为空，搜索结束。</p><h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.graph;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Graph</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList&lt;String&gt; vertexList;   <span class="comment">// 存储顶点集合</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][] edges;  <span class="comment">// 存储图对应的邻接矩阵</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> numOfEdges; <span class="comment">// 表示边的数目</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span>[] isVisited;    <span class="comment">// 保存已经访问过的结点</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/////////////////////////</span></span><br><span class="line">        <span class="comment">// 创建图</span></span><br><span class="line">        <span class="comment">/////////////////////////</span></span><br><span class="line">        <span class="keyword">int</span> n = <span class="number">5</span>;  <span class="comment">// 顶点个数</span></span><br><span class="line">        String Vertexs[] = &#123;<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>, <span class="string">"E"</span>&#125;;</span><br><span class="line">        <span class="comment">// 创建图对象</span></span><br><span class="line">        Graph graph = <span class="keyword">new</span> Graph(n);</span><br><span class="line">        <span class="comment">// 循环添加顶点</span></span><br><span class="line">        <span class="keyword">for</span> (String vertex : Vertexs) &#123;</span><br><span class="line">            graph.insertVertex(vertex);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 添加边</span></span><br><span class="line">        graph.insertEdge(<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        graph.insertEdge(<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">        graph.insertEdge(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br><span class="line">        graph.insertEdge(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">        graph.insertEdge(<span class="number">1</span>, <span class="number">4</span>, <span class="number">1</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 显示邻接矩阵</span></span><br><span class="line">        graph.showGraph();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/////////////////////////</span></span><br><span class="line">        <span class="comment">// 广度优先遍历</span></span><br><span class="line">        <span class="comment">/////////////////////////</span></span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">"广度优先遍历"</span>);</span><br><span class="line">        graph.bfs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造器</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Graph</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 初始化矩阵和vertexList</span></span><br><span class="line">        edges = <span class="keyword">new</span> <span class="keyword">int</span>[n][n];</span><br><span class="line">        vertexList = <span class="keyword">new</span> ArrayList&lt;String&gt;(n);</span><br><span class="line">        numOfEdges = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        isVisited = <span class="keyword">new</span> <span class="keyword">boolean</span>[n];</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line"><span class="comment">//广度优先遍历</span></span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">bfs</span><span class="params">(<span class="keyword">boolean</span>[] isVisited, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> u; <span class="comment">// 表示队列的头结点对应下标</span></span><br><span class="line">        <span class="keyword">int</span> w; <span class="comment">// 邻接结点 w</span></span><br><span class="line">        <span class="comment">// 队列， 记录结点访问的顺序</span></span><br><span class="line">        LinkedList queue = <span class="keyword">new</span> LinkedList();</span><br><span class="line">        <span class="comment">// 访问结点， 输出结点信息</span></span><br><span class="line">        System.out.print(getValueByIndex(i) + <span class="string">"=&gt;"</span>);</span><br><span class="line">        <span class="comment">// 标记为已访问</span></span><br><span class="line">        isVisited[i] = <span class="keyword">true</span>;</span><br><span class="line">        <span class="comment">// 将结点加入队列</span></span><br><span class="line">        queue.addLast(i);</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">// 取出队列的头结点下标</span></span><br><span class="line">            u = (Integer) queue.removeFirst();</span><br><span class="line">            <span class="comment">// 得到第一个邻接结点的下标 w</span></span><br><span class="line">            w = getFirstNeighbor(u);</span><br><span class="line">            <span class="keyword">while</span> (w != -<span class="number">1</span>) &#123;<span class="comment">// 找到</span></span><br><span class="line">                <span class="comment">// 是否访问过</span></span><br><span class="line">                <span class="keyword">if</span> (!isVisited[w]) &#123;</span><br><span class="line">                    System.out.print(getValueByIndex(w) + <span class="string">"=&gt;"</span>);</span><br><span class="line">                    <span class="comment">// 标记已经访问</span></span><br><span class="line">                    isVisited[w] = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="comment">// 入队</span></span><br><span class="line">                    queue.addLast(w);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 以 u 为前驱点， 找 w 后面的下一个邻结点</span></span><br><span class="line">                w = getNextNeighbor(u, w); <span class="comment">// 体现出我们的广度优先</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 遍历所有结点,都进行广度优先搜索</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getNumOfVertex(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!isVisited[i]) &#123;</span><br><span class="line">                bfs(isVisited, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line"><span class="comment">//创建图</span></span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 插入顶点</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> vertex 顶点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertVertex</span><span class="params">(String vertex)</span> </span>&#123;</span><br><span class="line">        vertexList.add(vertex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加边</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v1     表示第一个顶点的下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v2     表示第二个顶点的下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> weight 权重</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertEdge</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2, <span class="keyword">int</span> weight)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 因为是无向图,所以两个方向都要添加</span></span><br><span class="line">        edges[v1][v2] = weight;</span><br><span class="line">        edges[v2][v1] = weight;</span><br><span class="line">        numOfEdges++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line"><span class="comment">// 图中常用方法</span></span><br><span class="line"><span class="comment">/////////////////////////////</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到结点的个数</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumOfVertex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> vertexList.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到边的数目</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumOfEdges</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> numOfEdges;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回下标为i对应的数据 0-&gt;"A" 1-&gt;"B" 2-&gt;"C"</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> i 下标</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValueByIndex</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> vertexList.get(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回v1和v2的权值</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> v2</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWeight</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> edges[v1][v2];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示图对应的矩阵</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showGraph</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span>[] link : edges) &#123;</span><br><span class="line">            System.out.println(Arrays.toString(link));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.cnblogs.com/jlutiger/p/10791979.html" target="_blank" rel="noopener">算法|深度优先搜索（DFS）与广度优先搜索（BFS）的Java实现 </a></li><li><a href="https://blog.csdn.net/u013761665/article/details/47319659" target="_blank" rel="noopener">Java实现图的深度和广度优先遍历算法</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>多路查找树</title>
      <link href="/2020/05/06/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%91/"/>
      <url>/2020/05/06/%E5%A4%9A%E8%B7%AF%E6%9F%A5%E6%89%BE%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<h1 id="B-树的引出"><a href="#B-树的引出" class="headerlink" title="B 树的引出"></a>B 树的引出</h1><h2 id="二叉树的问题分析"><a href="#二叉树的问题分析" class="headerlink" title="二叉树的问题分析"></a>二叉树的问题分析</h2><p>二叉树的操作效率较高，但是也存在问题,请看下面的二叉树<br><img src="/images/2020/08/20200806152143.png" alt></p><ul><li>二叉树需要加载到内存的，如果二叉树的节点少，没有什么问题，但是如果二叉树的节点很多(比如 1 亿)，就存在如下问题:<ul><li>问题 1：在构建二叉树时，需要多次进行 i/o 操作(海量数据存在数据库或文件中)，节点海量，构建二叉树时，速度有影响</li><li>问题 2：节点海量，也会造成二叉树的高度很大，会降低操作速度</li></ul></li></ul><h2 id="多叉树"><a href="#多叉树" class="headerlink" title="多叉树"></a>多叉树</h2><ul><li>在二叉树中，每个节点有数据项，最多有两个子节点。如果允许每个节点可以有更多的数据项和更多的子节点，就是多叉树（multiway tree）</li><li>后面我们讲解的 2-3 树， 2-3-4 树就是多叉树，多叉树通过重新组织节点，减少树的高度，能对二叉树进行优化。</li><li>举例说明(下面 2-3 树就是一颗多叉树)<br><img src="/images/2020/08/20200806203405.png" alt></li><li>2-节点<br><img src="/images/2020/08/20200806203517.png" alt></li><li>3-节点<br><img src="/images/2020/08/20200806203530.png" alt></li></ul><h2 id="B-树的基本介绍"><a href="#B-树的基本介绍" class="headerlink" title="B 树的基本介绍"></a>B 树的基本介绍</h2><p>B 树通过重新组织节点，降低树的高度，并且减少 i/o 读写次数来提升效率。<br><img src="/images/2020/08/20200806203609.png" alt></p><ul><li>如图 B 树通过重新组织节点，降低了树的高度.</li><li>文件系统及数据库系统的设计者利用了磁盘预读原理，将一个节点的大小设为等于一个页(页得大小通常为 4k)，这样每个节点只需要一次 I/O 就可以完全载入</li><li>将树的度 M 设置为 1024，在 600 亿个元素中最多只需要 4 次 I/O 操作就可以读取到想要的元素, B 树(B+)广泛应用于文件存储系统以及数据库系统中</li></ul><h1 id="2-3-树"><a href="#2-3-树" class="headerlink" title="2-3 树"></a>2-3 树</h1><p>2-3 树是最简单的 B 树结构,具有如下特点:</p><ol><li>2-3 树的所有叶子节点都在同一层.(只要是 B 树都满足这个条件)</li><li>有两个子节点的节点叫二节点，二节点要么没有子节点，要么有两个子节点.</li><li>有三个子节点的节点叫三节点，三节点要么没有子节点，要么有三个子节点.</li><li>2-3 树是由二节点和三节点构成的树</li></ol><h2 id="2-3-树应用案例"><a href="#2-3-树应用案例" class="headerlink" title="2-3 树应用案例"></a>2-3 树应用案例</h2><p>将数列{16, 24, 12, 32, 14, 26, 34, 10, 8, 28, 38, 20}构建成 2-3 树，并保证数据插入的大小顺序。 (演示一下构建 2-3树的过程.)<br><img src="/images/2020/08/20200806204046.png" alt></p><p>插入规则:</p><ol><li>2-3 树的所有叶子节点都在同一层.(只要是 B 树都满足这个条件)</li><li>有两个子节点的节点叫二节点，二节点要么没有子节点，要么有两个子节点.</li><li>有三个子节点的节点叫三节点，三节点要么没有子节点，要么有三个子节点</li><li>当按照规则插入一个数到某个节点时，不能满足上面三个要求，就需要拆，先向上拆，如果上层满，则拆本层，拆后仍然需要满足上面 3 个条件。</li><li>对于三节点的子树的值大小仍然遵守(BST 二叉排序树)的规则</li></ol><h1 id="其它说明"><a href="#其它说明" class="headerlink" title="其它说明"></a>其它说明</h1><p>除了 2-3 树，还有 2-34-树等，概念和 23-树类似，也是一种 B 树。如图<br><img src="/images/2020/08/20200806204217.png" alt></p><h1 id="B-树、-B-树和-B-树"><a href="#B-树、-B-树和-B-树" class="headerlink" title="B 树、 B+树和 B*树"></a>B 树、 B+树和 B*树</h1><h2 id="B-树的介绍"><a href="#B-树的介绍" class="headerlink" title="B 树的介绍"></a>B 树的介绍</h2><ul><li><code>B-tree</code>树即 B 树，B 即 Balanced，平衡的意思。有人把 B-tree 翻译成<code>B-</code>树，容易让人产生误解。会以为 B-树是一种树，而 B 树又是另一种树。实际上， B-tree 就是指的 B 树。</li><li>前面已经介绍了 2-3 树和 2-3-4 树，他们就是 B 树(英语： B-tree 也写成 B-树)，这里我们再做一个说明，我们在学习 Mysql 时，经常听到说某种类型的索引是基于 B 树或者 B+树的，如图:<br><img src="/images/2020/08/20200806204452.png" alt>对上图的说明:</li></ul><ol><li>B 树的阶：节点的最多子节点个数。比如 2-3 树的阶是 3， 2-3-4 树的阶是 4</li><li>B 树的搜索，从根结点开始，对结点内的关键字（有序）序列进行二分查找，如果命中则结束，否则进入查询关键字所属范围的儿子结点；重复，直到所对应的儿子指针为空，或已经是叶子结点</li><li>关键字集合分布在整颗树中,即叶子节点和非叶子节点都存放数据.</li><li>搜索有可能在非叶子结点结束</li><li>其搜索性能等价于在关键字全集内做一次二分查找</li></ol><h2 id="B-树的介绍-1"><a href="#B-树的介绍-1" class="headerlink" title="B+树的介绍"></a>B+树的介绍</h2><p>B+树是 B 树的变体，也是一种多路搜索树。<br><img src="/images/2020/08/20200806205312.png" alt></p><p>对上图的说明:</p><ol><li>B+树的搜索与 B 树也基本相同，区别是 B+树只有达到叶子结点才命中（B 树可以在非叶子结点命中），其性能也等价于在关键字全集做一次二分查找</li><li>所有关键字都出现在叶子结点的链表中（即数据只能在叶子节点【也叫稠密索引】），且链表中的关键字(数据)恰好是有序的。</li><li>不可能在非叶子结点命中</li><li>非叶子结点相当于是叶子结点的索引（稀疏索引），叶子结点相当于是存储（关键字）数据的数据层</li><li>更适合文件索引系统</li><li>B 树和 B+树各有自己的应用场景，不能说 B+树完全比 B 树好，反之亦然.</li></ol><h3 id="稀疏索引与稠密索引说明"><a href="#稀疏索引与稠密索引说明" class="headerlink" title="稀疏索引与稠密索引说明"></a>稀疏索引与稠密索引说明</h3><ol><li>稠密索引<br>定义：它是由键值和指针(指向记录本身地址)组成的一系列存储块，该存储块的键值与文件的逻辑顺序一致</li></ol><p>特性：每个存储块的每一个键对应的指针都指向每个数据块每一条记录，当要查找指定键K时，采用二分查找即可找到键K对应的记录，复杂度为log2n。</p><ol start="2"><li>稀疏索引<br>定义：它是由键值和指针(指向记录本身地址)组成的一系列存储块，该存储块的键值与文件的逻辑顺序单调性一致。</li></ol><p>特性：每个存储块的每一个键对应的指针都指向每个数据块的第一条记录，当要查找指定建K时，先采用二分查找找到&lt;=K的键S，如果S=K，则命中记录，如果S&lt;K，则顺序查找=K的键，复杂度大于log2n，小于n。</p><p>比较：</p><ul><li>稀疏索引占用的索引存储空间比较小，但是查找时间较长；</li><li>稠密索引查找时间较短，索引存储空间较大。</li></ul><h2 id="B-树的介绍-2"><a href="#B-树的介绍-2" class="headerlink" title="B*树的介绍"></a>B*树的介绍</h2><p>B*树是 B+树的变体，在 B+树的非根和非叶子结点再增加指向兄弟的指针<br><img src="/images/2020/08/20200806205452.png" alt></p><p>B*树的说明:</p><ol><li>B<em>树定义了非叶子结点关键字个数至少为(2/3)</em>M，即块的最低使用率为 2/3，而 B+树的块的最低使用率为的1/2。</li><li>从第 1 个特点我们可以看出， B*树分配新结点的概率比 B+树要低，空间使用率更高</li></ol><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.cnblogs.com/lihao7/p/9259740.html" target="_blank" rel="noopener">稀疏索引与稠密索引</a></li><li><a href="https://riteme.site/blog/2016-3-12/2-3-tree-and-red-black-tree.html" target="_blank" rel="noopener">2-3树与红黑树</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>红黑树的插入和删除与Java实现</title>
      <link href="/2020/05/06/%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E6%8F%92%E5%85%A5%E5%92%8C%E5%88%A0%E9%99%A4%E4%B8%8EJava%E5%AE%9E%E7%8E%B0/"/>
      <url>/2020/05/06/%E7%BA%A2%E9%BB%91%E6%A0%91%E7%9A%84%E6%8F%92%E5%85%A5%E5%92%8C%E5%88%A0%E9%99%A4%E4%B8%8EJava%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>普通的二叉查找树在极端情况下可退化成链表，此时的增删查效率都会比较低下。<br><img src="/images/2020/08/20200806115816.png" alt></p><p>为了避免这种情况，就出现了一些自平衡的查找树，比如 AVL，红黑树等。这些自平衡的查找树通过定义一些性质，将任意节点的左右子树高度差控制在规定范围内，以达到平衡状态。</p><h1 id="什么是红黑树"><a href="#什么是红黑树" class="headerlink" title="什么是红黑树"></a>什么是红黑树</h1><ul><li>红黑树本质上是一种二叉查找树，但它在二叉查找树的基础上额外添加了一个标记（颜色），同时具有一定的规则。</li><li>这些规则使红黑树保证了一种平衡，插入、删除、查找的最坏时间复杂度都为 O(logn)。</li><li>它的统计性能要好于平衡二叉树（AVL树），因此，红黑树在很多地方都有应用。比如在 Java 集合框架中，很多部分(HashMap, TreeMap, TreeSet 等)都有红黑树的应用，这些集合均提供了很好的性能。</li></ul><h2 id="红黑树的-5-个特性"><a href="#红黑树的-5-个特性" class="headerlink" title="红黑树的 5 个特性"></a>红黑树的 5 个特性</h2><p><img src="/images/2020/08/20200805204359.png" alt></p><ol><li>每个节点要么是红色，要么是黑色；</li><li>根节点永远是黑色的；</li><li>所有的叶子节点都是是黑色的（注意这里说叶子节点其实是上图中的 NIL 节点）；</li><li>每个红色节点的两个子节点一定都是黑色；（从每个叶子到根的所有路径上不能有两个连续的红色节点,黑色结点是可以连续的）</li><li>从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点（简称黑高）</li></ol><p>注意：</p><ul><li>性质 3 中指定红黑树的每个叶子节点都是空节点，而且并叶子节点都是黑色。但 Java 实现的红黑树将使用 null 来代表空节点，因此遍历红黑树时将看不到黑色的叶子节点，反而看到每个叶子节点都是红色的。</li><li>性质 4 的意思是：从每个根到节点的路径上不会有两个连续的红色节点，但黑色节点是可以连续的。因此若给定黑色节点的个数 N，最短路径的情况是连续的 N 个黑色，树的高度为 N - 1;最长路径的情况为节点红黑相间，树的高度为 2(N - 1) 。</li><li>性质 5 是成为红黑树最主要的条件，后序的插入、删除操作都是为了遵守这个规定。</li></ul><p>红黑树并不是标准平衡二叉树，它以性质 5 作为一种平衡方法，使自己的性能得到了提升。</p><h1 id="红黑树的左旋右旋"><a href="#红黑树的左旋右旋" class="headerlink" title="红黑树的左旋右旋"></a>红黑树的左旋右旋</h1><p>具体在<a href="/2020/05/06/平衡二叉树/">平衡二叉树的基本介绍与Java实现</a>有具体说明,不再赘述</p><h2 id="左旋"><a href="#左旋" class="headerlink" title="左旋"></a>左旋</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateLeft</span><span class="params">(Entry p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Entry r = p.right; </span><br><span class="line">        p.right = r.left;</span><br><span class="line">        <span class="keyword">if</span> (r.left != <span class="keyword">null</span>)         </span><br><span class="line">            r.left.parent = p;</span><br><span class="line">        r.parent = p.parent;</span><br><span class="line">        <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>)</span><br><span class="line">            root = r;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.left == p)</span><br><span class="line">            p.parent.left = r;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            p.parent.right = r;</span><br><span class="line">        r.left = p; </span><br><span class="line">        p.parent = r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="右旋"><a href="#右旋" class="headerlink" title="右旋"></a>右旋</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateRight</span><span class="params">(Entry p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Entry l = p.left;</span><br><span class="line">        p.left = l.right;</span><br><span class="line">        <span class="keyword">if</span> (l.right != <span class="keyword">null</span>) l.right.parent = p;</span><br><span class="line">        l.parent = p.parent;</span><br><span class="line">        <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>)</span><br><span class="line">            root = l;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.right == p)</span><br><span class="line">            p.parent.right = l;</span><br><span class="line">        <span class="keyword">else</span> p.parent.left = l;</span><br><span class="line">        l.right = p;</span><br><span class="line">        p.parent = l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="红黑树的平衡插入"><a href="#红黑树的平衡插入" class="headerlink" title="红黑树的平衡插入"></a>红黑树的平衡插入</h1><h2 id="要插入的结点是红色还是黑色"><a href="#要插入的结点是红色还是黑色" class="headerlink" title="要插入的结点是红色还是黑色?"></a>要插入的结点是红色还是黑色?</h2><ul><li>要插入的结点是红色</li><li>如果插入的节点是黑色，那么这个节点所在路径比其他路径多出一个黑色节点，这个调整起来会比较麻烦（参考红黑树的删除操作，就知道为啥多一个或少一个黑色节点时，调整起来这么麻烦了）。</li><li>如果插入的节点是红色，此时所有路径上的黑色节点数量不变，仅可能会出现两个连续的红色节点的情况。这种情况下，通过变色和旋转进行调整即可，比之前的简单多了。</li></ul><h2 id="将染红的结点插入后的调整有-2-种情况"><a href="#将染红的结点插入后的调整有-2-种情况" class="headerlink" title="将染红的结点插入后的调整有 2 种情况"></a>将染红的结点插入后的调整有 2 种情况</h2><h3 id="情况1-父亲节点和叔叔节点都是红色"><a href="#情况1-父亲节点和叔叔节点都是红色" class="headerlink" title="情况1.父亲节点和叔叔节点都是红色"></a>情况1.父亲节点和叔叔节点都是红色</h3><p><img src="/images/2020/08/20200806113402.png" alt></p><ul><li>假设插入的结点是 N,看图可知,此时父结点 P 和叔叔结点 U 都是红色,爷爷结点 G 一定是黑色</li><li>由性质4可知,红色结点不能连续,所以图中的情况需要调整</li><li>调整:只需要将不管 N 是 P 的左孩子还是右孩子，只要同时把 P 和 U 染成黑色，G 染成红色即可,此时经过 G 的路径上的黑色节点数量不变，性质5仍然满足。</li><li>需要注意的是 G 被染成红色后，可能会和它的父节点形成连续的红色节点，此时需要递归向上调整。</li></ul><p>简记: 叔叔结点为红色,则<code>变色</code></p><h3 id="情况2-父亲节点为红色，叔叔节点为黑色-N-在父亲节点-P-的左孩子位置"><a href="#情况2-父亲节点为红色，叔叔节点为黑色-N-在父亲节点-P-的左孩子位置" class="headerlink" title="情况2.父亲节点为红色，叔叔节点为黑色(N 在父亲节点 P 的左孩子位置)"></a>情况2.父亲节点为红色，叔叔节点为黑色(N 在父亲节点 P 的左孩子位置)</h3><p><img src="/images/2020/08/20200806114109.png" alt></p><ul><li>假设插入的是节点 N，由图可知,这时父亲节点 P 是红色，叔叔节点 U 是黑色，爷爷节点 G 一定是黑色</li><li>红色节点的孩子不能是红色，但是直接把父亲节点 P 涂成黑色也不行，这条路径多了个黑色节点。</li><li>可以使用右旋，通过把 爷爷节点 G 右旋，P 变成了这个子树的根节点，G 变成了 P 的右子树。</li><li>右旋后 G 跑到了右子树上，这时把 P 变成黑的，多了一个黑节点，再把 G 变成红的，就平衡了</li><li>此时性质4,红色结点不能有红色子结点得到满足</li><li>且没有破坏原本的黑高,原本的黑高从左边看是1,右边看是2,调整后左边的黑高仍旧是1,右边的黑高仍旧是2</li></ul><p>简记: 叔叔结点为黑色,N 在父结点 P 的左孩子,则<code>右旋 =&gt; 变色</code></p><h3 id="情况3-父亲节点为红色，叔叔节点为黑色-N-在父亲节点-P-的右孩子位置"><a href="#情况3-父亲节点为红色，叔叔节点为黑色-N-在父亲节点-P-的右孩子位置" class="headerlink" title="情况3.父亲节点为红色，叔叔节点为黑色(N 在父亲节点 P 的右孩子位置)"></a>情况3.父亲节点为红色，叔叔节点为黑色(N 在父亲节点 P 的右孩子位置)</h3><p>上面讲的是插入节点 N 在父亲节点 P 的左孩子位置，如果 N 是 P 的右孩子，就需要多进行一次左旋，把情况化解成上述情况。<br><img src="/images/2020/08/20200806114444.png" alt></p><p>简记: 叔叔结点为黑色,N 在父结点 P 的右孩子,则<code>左旋 =&gt; 右旋 =&gt; 变色</code></p><h3 id="插入总结"><a href="#插入总结" class="headerlink" title="插入总结"></a>插入总结</h3><p>三种情况的区别在于叔叔节点的颜色，如果叔叔节点为红色，直接变色即可。如果叔叔节点为黑色，则需要选选择，再交换颜色。当把这三种情况的图画在一起就区别就比较容易观察了，如下图<br><img src="/images/2020/08/20200806114858.png" alt></p><h2 id="验证-Java-中的-TreeMap-源码"><a href="#验证-Java-中的-TreeMap-源码" class="headerlink" title="验证: Java 中的 TreeMap 源码"></a>验证: Java 中的 TreeMap 源码</h2><p>下面是 TreeMap 在插入后进行调整的代码，可以看出来跟我们分析的一致。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixAfterInsertion</span><span class="params">(Entry x)</span> </span>&#123;</span><br><span class="line">    x.color = RED;  <span class="comment">//直接染成红色，少点麻烦</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里分析的都是父亲节点为红色的情况，不是红色就不用调整了</span></span><br><span class="line">    <span class="keyword">while</span> (x != <span class="keyword">null</span> &amp;&amp; x != root &amp;&amp; x.parent.color == RED) &#123;</span><br><span class="line">        <span class="keyword">if</span> (parentOf(x) == leftOf(parentOf(parentOf(x)))) &#123; <span class="comment">// 插入节点 x 的父亲节点位于左孩子    </span></span><br><span class="line">            Entry y = rightOf(parentOf(parentOf(x)));  <span class="comment">// y 是 x 的叔叔节点</span></span><br><span class="line">            <span class="keyword">if</span> (colorOf(y) == RED) &#123;    <span class="comment">//如果 y 也是红色，只要把父亲节点和 y 都变成黑色，爷爷节点变成红的，就 Ok 了</span></span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(y, BLACK);</span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                x = parentOf(parentOf(x));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;    <span class="comment">//如果叔叔节点 y 不是红色，就需要右旋，让父亲节点变成根节点，爷爷节点去右子树去，然后把父亲节点变成黑色、爷爷节点变成红色</span></span><br><span class="line">                    <span class="comment">//特殊情况：x 是父亲节点的右孩子，需要对父亲节点进行左旋，把 x 移动到左子树</span></span><br><span class="line">                <span class="keyword">if</span> (x == rightOf(parentOf(x))) &#123;</span><br><span class="line">                    x = parentOf(x);</span><br><span class="line">                    rotateLeft(x);</span><br><span class="line">                &#125;</span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                rotateRight(parentOf(parentOf(x)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;    <span class="comment">//和上面对称的操作</span></span><br><span class="line">            Entry y = leftOf(parentOf(parentOf(x)));</span><br><span class="line">            <span class="keyword">if</span> (colorOf(y) == RED) &#123;</span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(y, BLACK);</span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                x = parentOf(parentOf(x));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (x == leftOf(parentOf(x))) &#123;</span><br><span class="line">                    x = parentOf(x);</span><br><span class="line">                    rotateRight(x);</span><br><span class="line">                &#125;</span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                rotateLeft(parentOf(parentOf(x)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    root.color = BLACK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="红黑树的平衡删除"><a href="#红黑树的平衡删除" class="headerlink" title="红黑树的平衡删除"></a>红黑树的平衡删除</h1><p>红黑树的删除也是分两步</p><ol><li>二叉查找树的删除(<a href="/2020/05/05/二叉排序树的基本介绍与Java实现/#二叉排序树的删除">查看:二叉排序树的删除</a>)</li><li>结构调整</li></ol><h2 id="如何进行调整"><a href="#如何进行调整" class="headerlink" title="如何进行调整"></a>如何进行调整</h2><ul><li>删除修复操作是针对删除黑色节点才有的</li><li>当黑色节点被删除后会让整个树不符合RBTree的定义的第四条(第四条:每个叶子到根的所有路径上不能有两个连续的红色节点)。</li><li>需要做的处理是从兄弟节点上借调黑色的节点过来，如果兄弟节点没有黑节点可以借调的话，就只能往上追溯，将每一级的黑节点数减去一个，使得整棵树符合红黑树的定义</li></ul><h3 id="总体思想"><a href="#总体思想" class="headerlink" title="总体思想"></a>总体思想</h3><ul><li>删除操作的总体思想是从兄弟节点借调黑色节点使树保持局部的平衡</li><li>如果局部的平衡达到了，就看整体的树是否是平衡的，如果不平衡就接着向上追溯调整</li></ul><h3 id="删除修复操作分为四种情况-删除黑节点后-："><a href="#删除修复操作分为四种情况-删除黑节点后-：" class="headerlink" title="删除修复操作分为四种情况(删除黑节点后)："></a>删除修复操作分为四种情况(删除黑节点后)：</h3><ol><li>待删除的节点的兄弟节点是红色的节点。</li><li>待删除的节点的兄弟节点是黑色的节点，且兄弟节点的子节点都是黑色的。</li><li>待调整的节点的兄弟节点是黑色的节点，且兄弟节点的左子节点是红色的，右节点是黑色的(兄弟节点在右边)，如果兄弟节点在左边的话，就是兄弟节点的右子节点是红色的，左节点是黑色的。</li><li>待调整的节点的兄弟节点是黑色的节点，且右子节点是是红色的(兄弟节点在右边)，如果兄弟节点在左边，则就是对应的就是左节点是红色的。</li></ol><h4 id="case1-待删除的节点的兄弟节点是红色的节点"><a href="#case1-待删除的节点的兄弟节点是红色的节点" class="headerlink" title="case1:待删除的节点的兄弟节点是红色的节点"></a>case1:待删除的节点的兄弟节点是红色的节点</h4><ul><li>由于兄弟节点是红色节点的时候，无法借调黑节点，所以需要将兄弟节点提升到父节点，由于兄弟节点是红色的，根据RBTree的定义，兄弟节点的子节点是黑色的，就可以从它的子节点借调了。</li><li>case 1这样转换之后就会变成后面的case 2，case 3，或者case 4进行处理了。</li><li>上升操作需要对C做一个左旋操作(如果是镜像结构的树只需要做对应的右旋操作即可)</li><li>之所以要做case 1操作是因为兄弟节点是红色的，无法借到一个黑节点来填补删除的黑节点。<br><img src="/images/2020/08/20200806200208.png" alt></li></ul><h4 id="case2-待删除的节点的兄弟节点是黑色的节点，且兄弟节点的子节点都是黑色的"><a href="#case2-待删除的节点的兄弟节点是黑色的节点，且兄弟节点的子节点都是黑色的" class="headerlink" title="case2:待删除的节点的兄弟节点是黑色的节点，且兄弟节点的子节点都是黑色的"></a>case2:待删除的节点的兄弟节点是黑色的节点，且兄弟节点的子节点都是黑色的</h4><ul><li>case 2的删除操作是由于兄弟节点可以消除一个黑色节点，因为兄弟节点和兄弟节点的子节点都是黑色的，所以可以将兄弟节点变红，这样就可以保证树的局部的颜色符合定义了。这个时候需要将父节点A变成新的节点，继续向上调整，直到整颗树的颜色符合RBTree的定义为止。</li><li>case 2这种情况下之所以要将兄弟节点变红，是因为如果把兄弟节点借调过来，会导致兄弟的结构不符合RBTree的定义，这样的情况下只能是将兄弟节点也变成红色来达到颜色的平衡。当将兄弟节点也变红之后，达到了局部的平衡了，但是对于祖父节点来说是不符合定义4的。这样就需要回溯到父节点，接着进行修复操作。<br><img src="/images/2020/08/20200806200428.png" alt></li></ul><h4 id="case3-待调整的节点的兄弟节点是黑色的节点，且兄弟节点的左子节点是红色的，右节点是黑色的"><a href="#case3-待调整的节点的兄弟节点是黑色的节点，且兄弟节点的左子节点是红色的，右节点是黑色的" class="headerlink" title="case3:待调整的节点的兄弟节点是黑色的节点，且兄弟节点的左子节点是红色的，右节点是黑色的"></a>case3:待调整的节点的兄弟节点是黑色的节点，且兄弟节点的左子节点是红色的，右节点是黑色的</h4><ul><li>case 3的删除操作是一个中间步骤，它的目的是将左边的红色节点借调过来，这样就可以转换成case 4状态了，在case 4状态下可以将D，E节点都阶段过来，通过将两个节点变成黑色来保证红黑树的整体平衡。</li><li>之所以说case-3是一个中间状态，是因为根据红黑树的定义来说，下图并不是平衡的，他是通过case 2操作完后向上回溯出现的状态。之所以会出现case 3和后面的case 4的情况，是因为可以通过借用侄子节点的红色，变成黑色来符合红黑树定义4.<br><img src="/images/2020/08/20200806200529.png" alt></li></ul><h4 id="case4-待调整的节点的兄弟节点是黑色的节点，且右子节点是是红色的"><a href="#case4-待调整的节点的兄弟节点是黑色的节点，且右子节点是是红色的" class="headerlink" title="case4:待调整的节点的兄弟节点是黑色的节点，且右子节点是是红色的"></a>case4:待调整的节点的兄弟节点是黑色的节点，且右子节点是是红色的</h4><ul><li>Case 4的操作是真正的节点借调操作，通过将兄弟节点以及兄弟节点的右节点借调过来，并将兄弟节点的右子节点变成红色来达到借调两个黑节点的目的，这样的话，整棵树还是符合RBTree的定义的。</li><li>Case 4这种情况的发生只有在待删除的节点的兄弟节点为黑，且子节点不全部为黑，才有可能借调到两个节点来做黑节点使用，从而保持整棵树都符合红黑树的定义。<br><img src="/images/2020/08/20200806200623.png" alt></li></ul><h2 id="删除后调整的全部逻辑流程图"><a href="#删除后调整的全部逻辑流程图" class="headerlink" title="删除后调整的全部逻辑流程图"></a>删除后调整的全部逻辑流程图</h2><p>红黑树的删除操作是最复杂的操作，复杂的地方就在于当删除了黑色节点的时候，如何从兄弟节点去借调节点，以保证树的颜色符合定义。由于红色的兄弟节点是没法借调出黑节点的，这样只能通过选择操作让他上升到父节点，而由于它是红节点，所以它的子节点就是黑的，可以借调。</p><p>对于兄弟节点是黑色节点的可以分成3种情况来处理，当所以的兄弟节点的子节点都是黑色节点时，可以直接将兄弟节点变红，这样局部的红黑树颜色是符合定义的。但是整颗树不一定是符合红黑树定义的，需要往上追溯继续调整。</p><p>对于兄弟节点的子节点为左红右黑或者 (全部为红，右红左黑)这两种情况，可以先将前面的情况通过选择转换为后一种情况，在后一种情况下，因为兄弟节点为黑，兄弟节点的右节点为红，可以借调出两个节点出来做黑节点，这样就可以保证删除了黑节点，整棵树还是符合红黑树的定义的，因为黑色节点的个数没有改变。</p><p>红黑树的删除操作是遇到删除的节点为红色，或者追溯调整到了root节点，这时删除的修复操作完毕。<br><img src="/images/2020/08/20200806115817.png" alt></p><h2 id="java-中-TreeMap-的源码"><a href="#java-中-TreeMap-的源码" class="headerlink" title="java 中 TreeMap 的源码"></a>java 中 TreeMap 的源码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixAfterDeletion</span><span class="params">(Entry x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (x != root &amp;&amp; colorOf(x) == BLACK) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == leftOf(parentOf(x))) &#123;</span><br><span class="line">            Entry sib = rightOf(parentOf(x));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//左旋，把黑色节点移到左边一个</span></span><br><span class="line">            <span class="keyword">if</span> (colorOf(sib) == RED) &#123;</span><br><span class="line">                setColor(sib, BLACK);</span><br><span class="line">                setColor(parentOf(x), RED);</span><br><span class="line">                rotateLeft(parentOf(x));</span><br><span class="line">                sib = rightOf(parentOf(x));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (colorOf(leftOf(sib))  == BLACK &amp;&amp;</span><br><span class="line">                colorOf(rightOf(sib)) == BLACK) &#123;</span><br><span class="line">                setColor(sib, RED);</span><br><span class="line">                x = parentOf(x);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (colorOf(rightOf(sib)) == BLACK) &#123;</span><br><span class="line">                    setColor(leftOf(sib), BLACK);</span><br><span class="line">                    setColor(sib, RED);</span><br><span class="line">                    rotateRight(sib);</span><br><span class="line">                    sib = rightOf(parentOf(x));</span><br><span class="line">                &#125;</span><br><span class="line">                setColor(sib, colorOf(parentOf(x)));</span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(rightOf(sib), BLACK);</span><br><span class="line">                rotateLeft(parentOf(x));</span><br><span class="line">                x = root;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">//处理的节点在 右边，相同逻辑，只不过旋转的方向相反</span></span><br><span class="line">            Entry sib = leftOf(parentOf(x));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (colorOf(sib) == RED) &#123;</span><br><span class="line">                setColor(sib, BLACK);</span><br><span class="line">                setColor(parentOf(x), RED);</span><br><span class="line">                rotateRight(parentOf(x));</span><br><span class="line">                sib = leftOf(parentOf(x));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (colorOf(rightOf(sib)) == BLACK &amp;&amp;</span><br><span class="line">                colorOf(leftOf(sib)) == BLACK) &#123;</span><br><span class="line">                setColor(sib, RED);</span><br><span class="line">                x = parentOf(x);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (colorOf(leftOf(sib)) == BLACK) &#123;</span><br><span class="line">                    setColor(rightOf(sib), BLACK);</span><br><span class="line">                    setColor(sib, RED);</span><br><span class="line">                    rotateLeft(sib);</span><br><span class="line">                    sib = leftOf(parentOf(x));</span><br><span class="line">                &#125;</span><br><span class="line">                setColor(sib, colorOf(parentOf(x)));</span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(leftOf(sib), BLACK);</span><br><span class="line">                rotateRight(parentOf(x));</span><br><span class="line">                x = root;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setColor(x, BLACK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="红黑树的Java实现"><a href="#红黑树的Java实现" class="headerlink" title="红黑树的Java实现"></a>红黑树的Java实现</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RBTreeNode</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T value;<span class="comment">//node value</span></span><br><span class="line">    <span class="keyword">private</span> RBTreeNode&lt;T&gt; left;<span class="comment">//left child pointer</span></span><br><span class="line">    <span class="keyword">private</span> RBTreeNode&lt;T&gt; right;<span class="comment">//right child pointer</span></span><br><span class="line">    <span class="keyword">private</span> RBTreeNode&lt;T&gt; parent;<span class="comment">//parent pointer</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> red;<span class="comment">//color is red or not red</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RBTreeNode</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RBTreeNode</span><span class="params">(T value)</span></span>&#123;<span class="keyword">this</span>.value=value;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RBTreeNode</span><span class="params">(T value,<span class="keyword">boolean</span> isRed)</span></span>&#123;<span class="keyword">this</span>.value=value;<span class="keyword">this</span>.red = isRed;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setValue</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTreeNode&lt;T&gt; <span class="title">getLeft</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setLeft</span><span class="params">(RBTreeNode&lt;T&gt; left)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.left = left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTreeNode&lt;T&gt; <span class="title">getRight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> right;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setRight</span><span class="params">(RBTreeNode&lt;T&gt; right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTreeNode&lt;T&gt; <span class="title">getParent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setParent</span><span class="params">(RBTreeNode&lt;T&gt; parent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.parent = parent;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isRed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> red;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isBlack</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !red;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * is leaf node</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isLeaf</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> left==<span class="keyword">null</span> &amp;&amp; right==<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setRed</span><span class="params">(<span class="keyword">boolean</span> red)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.red = red;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">makeRed</span><span class="params">()</span></span>&#123;</span><br><span class="line">        red=<span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">makeBlack</span><span class="params">()</span></span>&#123;</span><br><span class="line">        red=<span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RBTree</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RBTreeNode&lt;T&gt; root;</span><br><span class="line">    <span class="comment">//node number</span></span><br><span class="line">    <span class="keyword">private</span> java.util.concurrent.atomic.AtomicLong size = </span><br><span class="line">                    <span class="keyword">new</span> java.util.concurrent.atomic.AtomicLong(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//in overwrite mode,all node's value can not  has same    value</span></span><br><span class="line">    <span class="comment">//in non-overwrite mode,node can have same value, suggest don't use non-overwrite mode.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> overrideMode=<span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RBTree</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.root = <span class="keyword">new</span> RBTreeNode&lt;T&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RBTree</span><span class="params">(<span class="keyword">boolean</span> overrideMode)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>();</span><br><span class="line">        <span class="keyword">this</span>.overrideMode=overrideMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOverrideMode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> overrideMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOverrideMode</span><span class="params">(<span class="keyword">boolean</span> overrideMode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.overrideMode = overrideMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * number of tree number</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get the root node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RBTreeNode&lt;T&gt; <span class="title">getRoot</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root.getLeft();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add value to a new node,if this value exist in this tree,</span></span><br><span class="line"><span class="comment">     * if value exist,it will return the exist value.otherwise return null</span></span><br><span class="line"><span class="comment">     * if override mode is true,if value exist in the tree,</span></span><br><span class="line"><span class="comment">     * it will override the old value in the tree</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">addNode</span><span class="params">(T value)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; t = <span class="keyword">new</span> RBTreeNode&lt;T&gt;(value);</span><br><span class="line">        <span class="keyword">return</span> addNode(t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find the value by give value(include key,key used for search,</span></span><br><span class="line"><span class="comment">     * other field is not used,<span class="doctag">@see</span> compare method).if this value not exist return null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">find</span><span class="params">(T value)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; dataRoot = getRoot();</span><br><span class="line">        <span class="keyword">while</span>(dataRoot!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> cmp = dataRoot.getValue().compareTo(value);</span><br><span class="line">            <span class="keyword">if</span>(cmp&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                dataRoot = dataRoot.getRight();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cmp&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                dataRoot = dataRoot.getLeft();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> dataRoot.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove the node by give value,if this value not exists in tree return null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value include search key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the value contain in the removed node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">remove</span><span class="params">(T value)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; dataRoot = getRoot();</span><br><span class="line">        RBTreeNode&lt;T&gt; parent = root;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(dataRoot!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> cmp = dataRoot.getValue().compareTo(value);</span><br><span class="line">            <span class="keyword">if</span>(cmp&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                parent = dataRoot;</span><br><span class="line">                dataRoot = dataRoot.getRight();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cmp&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                parent = dataRoot;</span><br><span class="line">                dataRoot = dataRoot.getLeft();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(dataRoot.getRight()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    RBTreeNode&lt;T&gt; min = removeMin(dataRoot.getRight());</span><br><span class="line">                    <span class="comment">//x used for fix color balance</span></span><br><span class="line">                    RBTreeNode&lt;T&gt; x = min.getRight()==<span class="keyword">null</span> ? min.getParent() : min.getRight();</span><br><span class="line">                    <span class="keyword">boolean</span> isParent = min.getRight()==<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">                    min.setLeft(dataRoot.getLeft());</span><br><span class="line">                    setParent(dataRoot.getLeft(),min);</span><br><span class="line">                    <span class="keyword">if</span>(parent.getLeft()==dataRoot)&#123;</span><br><span class="line">                        parent.setLeft(min);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        parent.setRight(min);</span><br><span class="line">                    &#125;</span><br><span class="line">                    setParent(min,parent);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">boolean</span> curMinIsBlack = min.isBlack();</span><br><span class="line">                    <span class="comment">//inherit dataRoot's color</span></span><br><span class="line">                    min.setRed(dataRoot.isRed());</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(min!=dataRoot.getRight())&#123;</span><br><span class="line">                        min.setRight(dataRoot.getRight());</span><br><span class="line">                        setParent(dataRoot.getRight(),min);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//remove a black node,need fix color</span></span><br><span class="line">                    <span class="keyword">if</span>(curMinIsBlack)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(min!=dataRoot.getRight())&#123;</span><br><span class="line">                            fixRemove(x,isParent);</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(min.getRight()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                            fixRemove(min.getRight(),<span class="keyword">false</span>);</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            fixRemove(min,<span class="keyword">true</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    setParent(dataRoot.getLeft(),parent);</span><br><span class="line">                    <span class="keyword">if</span>(parent.getLeft()==dataRoot)&#123;</span><br><span class="line">                        parent.setLeft(dataRoot.getLeft());</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        parent.setRight(dataRoot.getLeft());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//current node is black and tree is not empty</span></span><br><span class="line">                    <span class="keyword">if</span>(dataRoot.isBlack() &amp;&amp; !(root.getLeft()==<span class="keyword">null</span>))&#123;</span><br><span class="line">                        RBTreeNode&lt;T&gt; x = dataRoot.getLeft()==<span class="keyword">null</span> </span><br><span class="line">                                            ? parent :dataRoot.getLeft();</span><br><span class="line">                        <span class="keyword">boolean</span> isParent = dataRoot.getLeft()==<span class="keyword">null</span>;</span><br><span class="line">                        fixRemove(x,isParent);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                setParent(dataRoot,<span class="keyword">null</span>);</span><br><span class="line">                dataRoot.setLeft(<span class="keyword">null</span>);</span><br><span class="line">                dataRoot.setRight(<span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">if</span>(getRoot()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    getRoot().setRed(<span class="keyword">false</span>);</span><br><span class="line">                    getRoot().setParent(<span class="keyword">null</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                size.decrementAndGet();</span><br><span class="line">                <span class="keyword">return</span> dataRoot.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * fix remove action</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isParent</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixRemove</span><span class="params">(RBTreeNode&lt;T&gt; node,<span class="keyword">boolean</span> isParent)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; cur = isParent ? <span class="keyword">null</span> : node;</span><br><span class="line">        <span class="keyword">boolean</span> isRed = isParent ? <span class="keyword">false</span> : node.isRed();</span><br><span class="line">        RBTreeNode&lt;T&gt; parent = isParent ? node : node.getParent();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(!isRed &amp;&amp; !isRoot(cur))&#123;</span><br><span class="line">            RBTreeNode&lt;T&gt; sibling = getSibling(cur,parent);</span><br><span class="line">            <span class="comment">//sibling is not null,due to before remove tree color is balance</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//if cur is a left node</span></span><br><span class="line">            <span class="keyword">boolean</span> isLeft = parent.getRight()==sibling;</span><br><span class="line">            <span class="keyword">if</span>(sibling.isRed() &amp;&amp; !isLeft)&#123;<span class="comment">//case 1</span></span><br><span class="line">                <span class="comment">//cur in right</span></span><br><span class="line">                parent.makeRed();</span><br><span class="line">                sibling.makeBlack();</span><br><span class="line">                rotateRight(parent);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sibling.isRed() &amp;&amp; isLeft)&#123;</span><br><span class="line">                <span class="comment">//cur in left</span></span><br><span class="line">                parent.makeRed();</span><br><span class="line">                sibling.makeBlack();</span><br><span class="line">                rotateLeft(parent);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(isBlack(sibling.getLeft()) &amp;&amp; isBlack(sibling.getRight()))&#123;<span class="comment">//case 2</span></span><br><span class="line">                sibling.makeRed();</span><br><span class="line">                cur = parent;</span><br><span class="line">                isRed = cur.isRed();</span><br><span class="line">                parent=parent.getParent();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(isLeft &amp;&amp; !isBlack(sibling.getLeft()) </span><br><span class="line">                                    &amp;&amp; isBlack(sibling.getRight()))&#123;<span class="comment">//case 3</span></span><br><span class="line">                sibling.makeRed();</span><br><span class="line">                sibling.getLeft().makeBlack();</span><br><span class="line">                rotateRight(sibling);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!isLeft &amp;&amp; !isBlack(sibling.getRight()) </span><br><span class="line">                                            &amp;&amp; isBlack(sibling.getLeft()) )&#123;</span><br><span class="line">                sibling.makeRed();</span><br><span class="line">                sibling.getRight().makeBlack();</span><br><span class="line">                rotateLeft(sibling);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(isLeft &amp;&amp; !isBlack(sibling.getRight()))&#123;<span class="comment">//case 4</span></span><br><span class="line">                sibling.setRed(parent.isRed());</span><br><span class="line">                parent.makeBlack();</span><br><span class="line">                sibling.getRight().makeBlack();</span><br><span class="line">                rotateLeft(parent);</span><br><span class="line">                cur=getRoot();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!isLeft &amp;&amp; !isBlack(sibling.getLeft()))&#123;</span><br><span class="line">                sibling.setRed(parent.isRed());</span><br><span class="line">                parent.makeBlack();</span><br><span class="line">                sibling.getLeft().makeBlack();</span><br><span class="line">                rotateRight(parent);</span><br><span class="line">                cur=getRoot();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(isRed)&#123;</span><br><span class="line">            cur.makeBlack();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(getRoot()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            getRoot().setRed(<span class="keyword">false</span>);</span><br><span class="line">            getRoot().setParent(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//get sibling node</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RBTreeNode&lt;T&gt; <span class="title">getSibling</span><span class="params">(RBTreeNode&lt;T&gt; node,RBTreeNode&lt;T&gt; parent)</span></span>&#123;</span><br><span class="line">        parent = node==<span class="keyword">null</span> ? parent : node.getParent();</span><br><span class="line">        <span class="keyword">if</span>(node==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> parent.getLeft()==<span class="keyword">null</span> ? parent.getRight() : parent.getLeft();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(node==parent.getLeft())&#123;</span><br><span class="line">            <span class="keyword">return</span> parent.getRight();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> parent.getLeft();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isBlack</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> node==<span class="keyword">null</span> || node.isBlack();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isRoot</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root.getLeft() == node &amp;&amp; node.getParent()==<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find the successor node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node current node's right node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RBTreeNode&lt;T&gt; <span class="title">removeMin</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        <span class="comment">//find the min node</span></span><br><span class="line">        RBTreeNode&lt;T&gt; parent = node;</span><br><span class="line">        <span class="keyword">while</span>(node!=<span class="keyword">null</span> &amp;&amp; node.getLeft()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            parent = node;</span><br><span class="line">            node = node.getLeft();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//remove min node</span></span><br><span class="line">        <span class="keyword">if</span>(parent==node)&#123;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        parent.setLeft(node.getRight());</span><br><span class="line">        setParent(node.getRight(),parent);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//don't remove right pointer,it is used for fixed color balance</span></span><br><span class="line">        <span class="comment">//node.setRight(null);</span></span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> T <span class="title">addNode</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        node.setLeft(<span class="keyword">null</span>);</span><br><span class="line">        node.setRight(<span class="keyword">null</span>);</span><br><span class="line">        node.setRed(<span class="keyword">true</span>);</span><br><span class="line">        setParent(node,<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span>(root.getLeft()==<span class="keyword">null</span>)&#123;</span><br><span class="line">            root.setLeft(node);</span><br><span class="line">            <span class="comment">//root node is black</span></span><br><span class="line">            node.setRed(<span class="keyword">false</span>);</span><br><span class="line">            size.incrementAndGet();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            RBTreeNode&lt;T&gt; x = findParentNode(node);</span><br><span class="line">            <span class="keyword">int</span> cmp = x.getValue().compareTo(node.getValue());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.overrideMode &amp;&amp; cmp==<span class="number">0</span>)&#123;</span><br><span class="line">                T v = x.getValue();</span><br><span class="line">                x.setValue(node.getValue());</span><br><span class="line">                <span class="keyword">return</span> v;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cmp==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//value exists,ignore this node</span></span><br><span class="line">                <span class="keyword">return</span> x.getValue();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            setParent(node,x);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(cmp&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                x.setLeft(node);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                x.setRight(node);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixInsert(node);</span><br><span class="line">            size.incrementAndGet();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find the parent node to hold node x,if parent value equals x.value return parent.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RBTreeNode&lt;T&gt; <span class="title">findParentNode</span><span class="params">(RBTreeNode&lt;T&gt; x)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; dataRoot = getRoot();</span><br><span class="line">        RBTreeNode&lt;T&gt; child = dataRoot;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(child!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> cmp = child.getValue().compareTo(x.getValue());</span><br><span class="line">            <span class="keyword">if</span>(cmp==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> child;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(cmp&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                dataRoot = child;</span><br><span class="line">                child = child.getLeft();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cmp&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                dataRoot = child;</span><br><span class="line">                child = child.getRight();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dataRoot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * red black tree insert fix.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixInsert</span><span class="params">(RBTreeNode&lt;T&gt; x)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; parent = x.getParent();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(parent!=<span class="keyword">null</span> &amp;&amp; parent.isRed())&#123;</span><br><span class="line">            RBTreeNode&lt;T&gt; uncle = getUncle(x);</span><br><span class="line">            <span class="keyword">if</span>(uncle==<span class="keyword">null</span>)&#123;<span class="comment">//need to rotate</span></span><br><span class="line">                RBTreeNode&lt;T&gt; ancestor = parent.getParent();</span><br><span class="line">                <span class="comment">//ancestor is not null due to before before add,tree color is balance</span></span><br><span class="line">                <span class="keyword">if</span>(parent == ancestor.getLeft())&#123;</span><br><span class="line">                    <span class="keyword">boolean</span> isRight = x == parent.getRight();</span><br><span class="line">                    <span class="keyword">if</span>(isRight)&#123;</span><br><span class="line">                        rotateLeft(parent);</span><br><span class="line">                    &#125;</span><br><span class="line">                    rotateRight(ancestor);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(isRight)&#123;</span><br><span class="line">                        x.setRed(<span class="keyword">false</span>);</span><br><span class="line">                        parent=<span class="keyword">null</span>;<span class="comment">//end loop</span></span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        parent.setRed(<span class="keyword">false</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    ancestor.setRed(<span class="keyword">true</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">boolean</span> isLeft = x == parent.getLeft();</span><br><span class="line">                    <span class="keyword">if</span>(isLeft)&#123;</span><br><span class="line">                        rotateRight(parent);</span><br><span class="line">                    &#125;</span><br><span class="line">                    rotateLeft(ancestor);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(isLeft)&#123;</span><br><span class="line">                        x.setRed(<span class="keyword">false</span>);</span><br><span class="line">                        parent=<span class="keyword">null</span>;<span class="comment">//end loop</span></span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        parent.setRed(<span class="keyword">false</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    ancestor.setRed(<span class="keyword">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;<span class="comment">//uncle is red</span></span><br><span class="line">                parent.setRed(<span class="keyword">false</span>);</span><br><span class="line">                uncle.setRed(<span class="keyword">false</span>);</span><br><span class="line">                parent.getParent().setRed(<span class="keyword">true</span>);</span><br><span class="line">                x=parent.getParent();</span><br><span class="line">                parent = x.getParent();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        getRoot().makeBlack();</span><br><span class="line">        getRoot().setParent(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get uncle node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RBTreeNode&lt;T&gt; <span class="title">getUncle</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; parent = node.getParent();</span><br><span class="line">        RBTreeNode&lt;T&gt; ancestor = parent.getParent();</span><br><span class="line">        <span class="keyword">if</span>(ancestor==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(parent == ancestor.getLeft())&#123;</span><br><span class="line">            <span class="keyword">return</span> ancestor.getRight();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ancestor.getLeft();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateLeft</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; right = node.getRight();</span><br><span class="line">        <span class="keyword">if</span>(right==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> java.lang.IllegalStateException(<span class="string">"right node is null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        RBTreeNode&lt;T&gt; parent = node.getParent();</span><br><span class="line">        node.setRight(right.getLeft());</span><br><span class="line">        setParent(right.getLeft(),node);</span><br><span class="line"></span><br><span class="line">        right.setLeft(node);</span><br><span class="line">        setParent(node,right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(parent==<span class="keyword">null</span>)&#123;<span class="comment">//node pointer to root</span></span><br><span class="line">            <span class="comment">//right  raise to root node</span></span><br><span class="line">            root.setLeft(right);</span><br><span class="line">            setParent(right,<span class="keyword">null</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(parent.getLeft()==node)&#123;</span><br><span class="line">                parent.setLeft(right);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                parent.setRight(right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//right.setParent(parent);</span></span><br><span class="line">            setParent(right,parent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateRight</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; left = node.getLeft();</span><br><span class="line">        <span class="keyword">if</span>(left==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> java.lang.IllegalStateException(<span class="string">"left node is null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        RBTreeNode&lt;T&gt; parent = node.getParent();</span><br><span class="line">        node.setLeft(left.getRight());</span><br><span class="line">        setParent(left.getRight(),node);</span><br><span class="line"></span><br><span class="line">        left.setRight(node);</span><br><span class="line">        setParent(node,left);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(parent==<span class="keyword">null</span>)&#123;</span><br><span class="line">            root.setLeft(left);</span><br><span class="line">            setParent(left,<span class="keyword">null</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(parent.getLeft()==node)&#123;</span><br><span class="line">                parent.setLeft(left);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                parent.setRight(left);</span><br><span class="line">            &#125;</span><br><span class="line">            setParent(left,parent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setParent</span><span class="params">(RBTreeNode&lt;T&gt; node,RBTreeNode&lt;T&gt; parent)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            node.setParent(parent);</span><br><span class="line">            <span class="keyword">if</span>(parent==root)&#123;</span><br><span class="line">                node.setParent(<span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * debug method,it used print the given node and its children nodes,</span></span><br><span class="line"><span class="comment">     * every layer output in one line</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> root</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printTree</span><span class="params">(RBTreeNode&lt;T&gt; root)</span></span>&#123;</span><br><span class="line">        java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt; queue =<span class="keyword">new</span> java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt;();</span><br><span class="line">        java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt; queue2 =<span class="keyword">new</span> java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">boolean</span> firstQueue = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty() || !queue2.isEmpty())&#123;</span><br><span class="line">            java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt; q = firstQueue ? queue : queue2;</span><br><span class="line">            RBTreeNode&lt;T&gt; n = q.poll();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(n!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                String pos = n.getParent()==<span class="keyword">null</span> ? <span class="string">""</span> : ( n == n.getParent().getLeft() </span><br><span class="line">                                                                        ? <span class="string">" LE"</span> : <span class="string">" RI"</span>);</span><br><span class="line">                String pstr = n.getParent()==<span class="keyword">null</span> ? <span class="string">""</span> : n.getParent().toString();</span><br><span class="line">                String cstr = n.isRed()?<span class="string">"R"</span>:<span class="string">"B"</span>;</span><br><span class="line">                cstr = n.getParent()==<span class="keyword">null</span> ? cstr : cstr+<span class="string">" "</span>;</span><br><span class="line">                System.out.print(n+<span class="string">"("</span>+(cstr)+pstr+(pos)+<span class="string">")"</span>+<span class="string">"\t"</span>);</span><br><span class="line">                <span class="keyword">if</span>(n.getLeft()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    (firstQueue ? queue2 : queue).add(n.getLeft());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(n.getRight()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    (firstQueue ? queue2 : queue).add(n.getRight());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println();</span><br><span class="line">                firstQueue = !firstQueue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RBTree&lt;String&gt; bst = <span class="keyword">new</span> RBTree&lt;String&gt;();</span><br><span class="line">        bst.addNode(<span class="string">"d"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"d"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"c"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"c"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"b"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"f"</span>);</span><br><span class="line"></span><br><span class="line">        bst.addNode(<span class="string">"a"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"e"</span>);</span><br><span class="line"></span><br><span class="line">        bst.addNode(<span class="string">"g"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"h"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        bst.remove(<span class="string">"c"</span>);</span><br><span class="line"></span><br><span class="line">        bst.printTree(bst.getRoot());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码调试的时候，printTree输出格式如下:<br>d(B)<br>b(B d LE) g(R d RI)<br>a(R b LE) e(B g LE) h(B g RI)<br>f(R e RI)</p><p>括号左边表示元素的内容。括号内的第一个元素表示颜色，B表示black，R表示red；第二个元素表示父元素的值；第三个元素表示左右，LE表示在父元素的左边。RI表示在父元素的右边。</p><p>第一个元素d是root节点，由于它没有父节点，所以括号内只有一个元素。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>作为平衡二叉查找树里面众多的实现之一，红黑树无疑是最简洁、实现最为简单的。红黑树通过引入颜色的概念，通过颜色这个约束条件的使用来保持树的高度平衡。作为平衡二叉查找树，旋转是一个必不可少的操作。通过旋转可以降低树的高度，在红黑树里面还可以转换颜色。</p><p>红黑树里面的插入和删除的操作比较难理解，这时要注意记住一点：操作之前红黑树是平衡的，颜色是符合定义的。在操作的时候就需要向兄弟节点、父节点、侄子节点借调和互换颜色，要达到这个目的，就需要不断的进行旋转。所以红黑树的插入删除操作需要不停的旋转，一旦借调了别的节点，删除和插入的节点就会达到局部的平衡（局部符合红黑树的定义），但是被借调的节点就不会平衡了，这时就需要以被借调的节点为起点继续进行调整，直到整棵树都是平衡的。在整个修复的过程中，插入具体的分为3种情况，删除分为4种情况。</p><p>整个红黑树的查找，插入和删除都是O(logN)的，原因就是整个红黑树的高度是logN，查找从根到叶，走过的路径是树的高度，删除和插入操作是从叶到根的，所以经过的路径都是logN。</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://juejin.im/entry/6844903454767317005#%E9%BB%91%E8%89%B2%E9%AB%98%E5%BA%A6" target="_blank" rel="noopener">面试旧敌之红黑树（直白介绍深入理解）</a></li><li><a href="https://segmentfault.com/a/1190000012728513" target="_blank" rel="noopener">红黑树详细分析，看了都说好</a></li><li><a href="https://zhuanlan.zhihu.com/p/24367771" target="_blank" rel="noopener">红黑树深入剖析及Java实现</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>平衡二叉树的基本介绍与Java实现</title>
      <link href="/2020/05/06/%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E4%B8%8EJava%E5%AE%9E%E7%8E%B0/"/>
      <url>/2020/05/06/%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E4%B8%8EJava%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h1><ol><li>平衡二叉树也叫平衡二叉搜索树（Self-balancing binary search tree）又被称为 AVL 树，可以保证查询效率较高。</li><li>具有以下特点：它是一棵空树或它的左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树。</li><li>平衡二叉树的常用实现方法有红黑树、AVL、替罪羊树、Treap、伸展树等。</li><li>举例说明,看看下面哪些 AVL 树,为什么?<br><img src="/images/2020/08/20200805161236.png" alt></li></ol><h1 id="单旋转"><a href="#单旋转" class="headerlink" title="单旋转"></a>单旋转</h1><h2 id="左旋转"><a href="#左旋转" class="headerlink" title="左旋转"></a>左旋转</h2><ol><li>要求: 给你一个数列， 创建出对应的平衡二叉树.数列 {4, 3, 6, 5, 7, 8}</li><li>思路分析(示意图)<br><img src="/images/2020/08/20200805181750.png" alt></li><li>代码实现<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 左旋转</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">leftRotate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建新的结点， 以当前根结点的值</span></span><br><span class="line">    Node newNode = <span class="keyword">new</span> Node(value);</span><br><span class="line">    <span class="comment">// 把新的结点的左子树设置成当前结点的左子树</span></span><br><span class="line">    newNode.left = left;</span><br><span class="line">    <span class="comment">// 把新的结点的右子树设置成带你过去结点的右子树的左子树</span></span><br><span class="line">    newNode.right = right.left;</span><br><span class="line">    <span class="comment">// 把当前结点的值替换成右子结点的值</span></span><br><span class="line">    value = right.value;</span><br><span class="line">    <span class="comment">// 把当前结点的右子树设置成当前结点右子树的右子树</span></span><br><span class="line">    right = right.right;</span><br><span class="line">    <span class="comment">// 把当前结点的左子树(左子结点)设置成新的结点</span></span><br><span class="line">    left = newNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="右旋转"><a href="#右旋转" class="headerlink" title="右旋转"></a>右旋转</h2><ol><li>要求: 给你一个数列， 创建出对应的平衡二叉树.数列 {10, 12, 8, 9, 7, 6}</li><li>思路分析(示意图)<br><img src="/images/2020/08/20200805182242.png" alt></li><li>代码实现<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 右旋转</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rightRotate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Node newNode = <span class="keyword">new</span> Node(value);</span><br><span class="line">    newNode.right = right;</span><br><span class="line">    newNode.left = left.right;</span><br><span class="line">    value = left.value;</span><br><span class="line">    left = left.left;</span><br><span class="line">    right = newNode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="双旋转"><a href="#双旋转" class="headerlink" title="双旋转"></a>双旋转</h1><p>前面的两个数列， 进行单旋转(即一次旋转)就可以将非平衡二叉树转成平衡二叉树,但是在某些情况下， 单旋转不能完成平衡二叉树的转换。 比如数列</p><ul><li>int[] arr = { 10, 11, 7, 6, 8, 9 }; 运行原来的代码可以看到， 并没有转成 AVL 树.</li><li>int[] arr = {2,1,6,5,7,3}; // 运行原来的代码可以看到， 并没有转成 AVL 树</li></ul><h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p><img src="/images/2020/08/20200805182914.png" alt></p><h2 id="解决思路分析"><a href="#解决思路分析" class="headerlink" title="解决思路分析"></a>解决思路分析</h2><ol><li>当符合右旋转的条件时</li><li>如果它的左子树的右子树高度大于它的左子树的高度</li><li>先对当前这个结点的左子树进行左旋转</li><li>在对当前结点进行右旋转的操作即可</li></ol><h2 id="代码实现-AVL-树的汇总代码-完整代码"><a href="#代码实现-AVL-树的汇总代码-完整代码" class="headerlink" title="代码实现[AVL 树的汇总代码(完整代码)]"></a>代码实现[AVL 树的汇总代码(完整代码)]</h2><ol><li><p>结点</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree.avltree;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 二叉排序树结点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line">    Node left;</span><br><span class="line">    Node right;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Node [value="</span> + value + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///旋转///////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 左旋转</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">leftRotate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建新的结点， 以当前根结点的值</span></span><br><span class="line">        Node newNode = <span class="keyword">new</span> Node(value);</span><br><span class="line">        <span class="comment">// 把新的结点的左子树设置成当前结点的左子树</span></span><br><span class="line">        newNode.left = left;</span><br><span class="line">        <span class="comment">// 把新的结点的右子树设置成带你过去结点的右子树的左子树</span></span><br><span class="line">        newNode.right = right.left;</span><br><span class="line">        <span class="comment">// 把当前结点的值替换成右子结点的值</span></span><br><span class="line">        value = right.value;</span><br><span class="line">        <span class="comment">// 把当前结点的右子树设置成当前结点右子树的右子树</span></span><br><span class="line">        right = right.right;</span><br><span class="line">        <span class="comment">// 把当前结点的左子树(左子结点)设置成新的结点</span></span><br><span class="line">        left = newNode;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 右旋转</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rightRotate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Node newNode = <span class="keyword">new</span> Node(value);</span><br><span class="line">        newNode.right = right;</span><br><span class="line">        newNode.left = left.right;</span><br><span class="line">        value = left.value;</span><br><span class="line">        left = left.left;</span><br><span class="line">        right = newNode;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回左子树的高度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">leftHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (left == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left.height();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回右子树的高度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rightHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (right == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> right.height();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回以该结点为根结点的树的高度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">height</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(left == <span class="keyword">null</span> ? <span class="number">0</span> : left.height(), right == <span class="keyword">null</span> ? <span class="number">0</span> : right.height()) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///删除结点////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找要删除的结点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 希望删除的结点的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  如果找到则返回该结点,否则返回null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">search</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">this</span>.value) &#123;  <span class="comment">// 找到该结点</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value &lt; <span class="keyword">this</span>.value) &#123;    <span class="comment">// 如果查找的值小于当前结点,则向左子树递归查找</span></span><br><span class="line">            <span class="comment">// 如果左子结点为空</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.left.search(value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;    <span class="comment">// 如果查找的值不小于当前结点,向右子树递归查找</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.right.search(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找要删除结点的父结点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 要找到的结点的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回的是要删除的结点的父结点,如果没有就返回null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">searchParent</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 如果当前结点就是要删除的结点的父结点,就返回</span></span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">this</span>.left != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.left.value == value) || (<span class="keyword">this</span>.right != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.right.value == value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果查找的值小于当前结点,并且当前结点的左子结点不为空</span></span><br><span class="line">            <span class="keyword">if</span> (value &lt; <span class="keyword">this</span>.value &amp;&amp; <span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.left.searchParent(value);   <span class="comment">// 向左子树递归查找</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value &gt;= <span class="keyword">this</span>.value &amp;&amp; <span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.right.searchParent(value);  <span class="comment">// 向右子树递归查找</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;    <span class="comment">//没有找到父结点</span></span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///添加结点////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加结点方法 递归的形式添加结点,注意需要满足二叉排序树的要求</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node 要添加的结点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断传入结点的值和当前子树的根结点的值的关系</span></span><br><span class="line">        <span class="keyword">if</span> (node.value &lt; <span class="keyword">this</span>.value) &#123;</span><br><span class="line">            <span class="comment">// 如果当前结点左子树结点为null</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.left = node;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 递归向左子树添加</span></span><br><span class="line">                <span class="keyword">this</span>.left.add(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 添加的结点的值大于当前结点的值</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.right = node;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 递归向右子树添加</span></span><br><span class="line">                <span class="keyword">this</span>.right.add(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">///////////////////////////////////////////////</span></span><br><span class="line">        <span class="comment">///旋转////////////////////////////////////////</span></span><br><span class="line">        <span class="comment">//////////////////////////////////////////////</span></span><br><span class="line">     </span><br><span class="line">        <span class="comment">// 当添加完一个结点后， 如果: (右子树的高度-左子树的高度) &gt; 1 , 左旋转</span></span><br><span class="line">        <span class="keyword">if</span> (rightHeight() - leftHeight() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果它的右子树的左子树的高度大于它的右子树的右子树的高度</span></span><br><span class="line">            <span class="keyword">if</span> (right != <span class="keyword">null</span> &amp;&amp; right.leftHeight() &gt; right.rightHeight()) &#123;</span><br><span class="line">                <span class="comment">// 先对右子结点进行右旋转</span></span><br><span class="line">                right.rightRotate();</span><br><span class="line">                <span class="comment">// 然后在对当前结点进行左旋转</span></span><br><span class="line">                leftRotate(); <span class="comment">// 左旋转..</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 直接进行左旋转即可</span></span><br><span class="line">                leftRotate();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">// 必须要!!!</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 当添加完一个结点后， 如果 (左子树的高度 - 右子树的高度) &gt; 1, 右旋转</span></span><br><span class="line">        <span class="keyword">if</span> (leftHeight() - rightHeight() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果它的左子树的右子树高度大于它的左子树的高度</span></span><br><span class="line">            <span class="keyword">if</span> (left != <span class="keyword">null</span> &amp;&amp; left.rightHeight() &gt; left.leftHeight()) &#123;</span><br><span class="line">                <span class="comment">// 先对当前结点的左结点(左子树)-&gt;左旋转</span></span><br><span class="line">                left.leftRotate();</span><br><span class="line">                <span class="comment">// 再对当前结点进行右旋转</span></span><br><span class="line">                rightRotate();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 直接进行右旋转即可</span></span><br><span class="line">                rightRotate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中序遍历</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.left.infixOrder();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.right.infixOrder();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>AVLTree</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree.avltree;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 二叉排序树</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AVLTree</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">getRoot</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///添加结点////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加结点的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node 要添加的结点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            root = node;    <span class="comment">// 如果root为空则直接让root指向node</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            root.add(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///删除结点////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找要删除的结点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">search</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> root.search(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找父结点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">searchParent</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> root.searchParent(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1. 返回的以node为根结点的二叉排序树的最小结点的值</span></span><br><span class="line"><span class="comment">     * 2. 删除node为根结点的二叉排序树的最小结点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node 传入的结点(当作二叉排序树的根结点)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回以node为根结点的二叉排序树的最小结点的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除结点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delNode</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 需求先去找到要删除的结点 targetNode</span></span><br><span class="line">            Node targetNode = search(value);</span><br><span class="line">            <span class="comment">// 如果没有找到要删除的结点</span></span><br><span class="line">            <span class="keyword">if</span> (targetNode == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果当我们发现当前这棵二叉排序树只有一个结点</span></span><br><span class="line">            <span class="keyword">if</span> (root.left == <span class="keyword">null</span> &amp;&amp; root.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">                root = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. 去找 targetNode 的父结点</span></span><br><span class="line">            Node parent = searchParent(value);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. 判断要删除的结点的类型</span></span><br><span class="line">            <span class="comment">// ==&gt; 3.1 要删除的结点有0棵子树(即叶子结点)</span></span><br><span class="line">            <span class="comment">// ==&gt; ==&gt; 基本思路:找到targetNode,删除</span></span><br><span class="line">            <span class="keyword">if</span> (targetNode.left == <span class="keyword">null</span> &amp;&amp; targetNode.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 判断 targetNode 是父结点的左子结点还是右子结点</span></span><br><span class="line">                <span class="keyword">if</span> (parent.left != <span class="keyword">null</span> &amp;&amp; parent.left.value == value) &#123;    <span class="comment">// 是左子结点</span></span><br><span class="line">                    parent.left = <span class="keyword">null</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parent.right != <span class="keyword">null</span> &amp;&amp; parent.right.value == value) &#123;   <span class="comment">// 是右子结点</span></span><br><span class="line">                    parent.right = <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (targetNode.left != <span class="keyword">null</span> &amp;&amp; targetNode != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// ==&gt; 3.2 要删除的结点有2棵子树</span></span><br><span class="line">                <span class="comment">// ==&gt; ==&gt; 基本思路:targetNode要删除,删除后用targetNode的右子树的最小值进行填充</span></span><br><span class="line">                Node target = targetNode.right;</span><br><span class="line">                <span class="comment">// 循环查找左子结点,就会找到最小值</span></span><br><span class="line">                <span class="keyword">while</span> (target.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    target = target.left;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 这时target就指向了最小结点</span></span><br><span class="line">                <span class="comment">// 删除这个最小结点</span></span><br><span class="line">                delNode(target.value);</span><br><span class="line">                targetNode.value = target.value;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// ==&gt; 3.3 要删除的结点有1棵子树 </span></span><br><span class="line">                <span class="comment">// ==&gt; ==&gt; 基本思路:因为只有一棵子树,所以用子树填充删除的结点的位置</span></span><br><span class="line">                <span class="keyword">if</span> (targetNode.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 如果要删除的结点有左子结点</span></span><br><span class="line">                    <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// 如果 targetNode 是parent的左子结点</span></span><br><span class="line">                        <span class="keyword">if</span> (parent.left.value == value) &#123;</span><br><span class="line">                            parent.left = targetNode.left;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123; <span class="comment">// targetNode 是 parent 的右子结点</span></span><br><span class="line">                            parent.right = targetNode.left;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        root = targetNode.left;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;    <span class="comment">// 如果删除的结点有右子结点</span></span><br><span class="line">                    <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// 如果 targetNode 是 parent 的左子结点</span></span><br><span class="line">                        <span class="keyword">if</span> (parent.left.value == value) &#123;</span><br><span class="line">                            parent.left = targetNode.right;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;    <span class="comment">// 如果targetNode是parent右子结点</span></span><br><span class="line">                            parent.right = targetNode.right;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        root = targetNode.right;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中序遍历</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="keyword">null</span>) &#123;</span><br><span class="line">            root.infixOrder();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"二叉排序树为空,不能遍历"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree.avltree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AVLTreeTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// int[] arr = &#123;4,3,6,5,7,8&#125;;</span></span><br><span class="line">        <span class="comment">// int[] arr = &#123; 10, 12, 8, 9, 7, 6 &#125;;</span></span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123; <span class="number">10</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">9</span> &#125;;</span><br><span class="line">        <span class="comment">// 创建一个 AVLTree 对象</span></span><br><span class="line">        AVLTree avlTree = <span class="keyword">new</span> AVLTree();</span><br><span class="line">        <span class="comment">// 添加结点</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            avlTree.add(<span class="keyword">new</span> Node(arr[i]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 遍历</span></span><br><span class="line">        System.out.println(<span class="string">"中序遍历"</span>);</span><br><span class="line">        avlTree.infixOrder();</span><br><span class="line">        System.out.println(<span class="string">"在平衡处理~~"</span>);</span><br><span class="line">        System.out.println(<span class="string">"树的高度="</span> + avlTree.getRoot().height()); <span class="comment">// 3</span></span><br><span class="line">        System.out.println(<span class="string">"树的左子树高度="</span> + avlTree.getRoot().leftHeight()); <span class="comment">// 2</span></span><br><span class="line">        System.out.println(<span class="string">"树的右子树高度="</span> + avlTree.getRoot().rightHeight()); <span class="comment">// 2</span></span><br><span class="line">        System.out.println(<span class="string">"当前的根结点="</span> + avlTree.getRoot());<span class="comment">// 8</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>二叉排序树的基本介绍与Java实现</title>
      <link href="/2020/05/05/%E4%BA%8C%E5%8F%89%E6%8E%92%E5%BA%8F%E6%A0%91%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E4%B8%8EJava%E5%AE%9E%E7%8E%B0/"/>
      <url>/2020/05/05/%E4%BA%8C%E5%8F%89%E6%8E%92%E5%BA%8F%E6%A0%91%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E4%B8%8EJava%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="先看一个需求"><a href="#先看一个需求" class="headerlink" title="先看一个需求"></a>先看一个需求</h1><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>给你一个数列 (7, 3, 10, 12, 5, 1, 9)， 要求能够高效的完成对数据的查询和添加</p><h2 id="解决方案分析"><a href="#解决方案分析" class="headerlink" title="解决方案分析"></a>解决方案分析</h2><ol><li><p>使用数组<br>数组未排序， 优点： 直接在数组尾添加， 速度快。 缺点： 查找速度慢.<br>数组排序， 优点： 可以使用二分查找， 查找速度快， 缺点： 为了保证数组有序， 在添加新数据时， 找到插入位<br>置后， 后面的数据需整体移动， 速度慢。</p></li><li><p>使用链式存储-链表<br>不管链表是否有序， 查找速度都慢， 添加数据速度比数组快， 不需要数据整体移动。</p></li><li><p>使用二叉排序树</p></li></ol><h1 id="二叉排序树介绍"><a href="#二叉排序树介绍" class="headerlink" title="二叉排序树介绍"></a>二叉排序树介绍</h1><ul><li>二叉排序树： BST: (Binary Sort(Search) Tree), 对于二叉排序树的任何一个非叶子节点， 要求左子节点的值比当前节点的值小， 右子节点的值比当前节点的值大。</li><li>特别说明： 如果有相同的值， 可以将该节点放在左子节点或右子节点</li><li>比如针对前面的数据 (7, 3, 10, 12, 5, 1, 9) ， 对应的二叉排序树为：<br><img src="/images/2020/08/20200805083922.png" alt></li></ul><h1 id="二叉排序树创建和遍历"><a href="#二叉排序树创建和遍历" class="headerlink" title="二叉排序树创建和遍历"></a>二叉排序树创建和遍历</h1><p>一个数组创建成对应的二叉排序树， 并使用中序遍历二叉排序树， 比如: 数组为 Array(7, 3, 10, 12, 5, 1, 9) ， 创建成对应的二叉排序树为:<br><img src="/images/2020/08/20200805084311.png" alt></p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="创建结点"><a href="#创建结点" class="headerlink" title="创建结点"></a>创建结点</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree.binarysorttree;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 二叉排序树结点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line">    Node left;</span><br><span class="line">    Node right;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Node [value="</span> + value + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加结点方法 递归的形式添加结点,注意需要满足二叉排序树的要求</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node 要添加的结点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断传入结点的值和当前子树的根结点的值的关系</span></span><br><span class="line">        <span class="keyword">if</span> (node.value &lt; <span class="keyword">this</span>.value) &#123;</span><br><span class="line">            <span class="comment">// 如果当前结点左子树结点为null</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.left = node;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 递归向左子树添加</span></span><br><span class="line">                <span class="keyword">this</span>.left.add(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 添加的结点的值大于当前结点的值</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.right = node;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 递归向右子树添加</span></span><br><span class="line">                <span class="keyword">this</span>.right.add(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中序遍历</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.left.infixOrder();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.right.infixOrder();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="二叉排序树–创建和遍历"><a href="#二叉排序树–创建和遍历" class="headerlink" title="二叉排序树–创建和遍历"></a>二叉排序树–创建和遍历</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree.binarysorttree;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 二叉排序树</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinarySortTree</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加结点的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node 要添加的结点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            root = node;    <span class="comment">// 如果root为空则直接让root指向node</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            root.add(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中序遍历</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="keyword">null</span>) &#123;</span><br><span class="line">            root.infixOrder();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"二叉排序树为空,不能遍历"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree.binarysorttree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinarySortTreeTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">7</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">9</span>&#125;;</span><br><span class="line">        BinarySortTree binarySortTree = <span class="keyword">new</span> BinarySortTree();</span><br><span class="line">        <span class="comment">// 循环添加结点到二叉树</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            binarySortTree.add(<span class="keyword">new</span> Node(arr[i]));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 中序遍历二叉排序树</span></span><br><span class="line">        System.out.println(<span class="string">"中序遍历二叉排序树"</span>);</span><br><span class="line">        binarySortTree.infixOrder();    <span class="comment">// 1,3,5,7,9,10,12</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="二叉排序树的删除"><a href="#二叉排序树的删除" class="headerlink" title="二叉排序树的删除"></a>二叉排序树的删除</h1><h2 id="操作的思路分析"><a href="#操作的思路分析" class="headerlink" title="操作的思路分析"></a>操作的思路分析</h2><h3 id="分三种情况考虑"><a href="#分三种情况考虑" class="headerlink" title="分三种情况考虑"></a>分三种情况考虑</h3><ul><li>要删除结点的子结点有0棵子树(即叶子结点)(比如： 2, 5, 9, 12)</li><li>要删除结点的子结点有1棵子树(比如： 1)</li><li>要删除结点的子结点有2棵子树(比如： 7, 3， 10 )</li></ul><h3 id="对删除结点的各种情况思路分析"><a href="#对删除结点的各种情况思路分析" class="headerlink" title="对删除结点的各种情况思路分析"></a>对删除结点的各种情况思路分析</h3><ol><li><p>要删除结点的子结点有0棵子树(即叶子结点)(比如： 2, 5, 9, 12)</p><ol><li>需求先去找到要删除的结点 targetNode</li><li>找到 targetNode 的 父结点 parent</li><li>确定 targetNode 是 parent 的左子结点还是右子结点</li><li>根据前面的情况来对应删除<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">==&gt; 左子结点 parent.left = null</span><br><span class="line">==&gt; 右子结点 parent.right = null</span><br></pre></td></tr></table></figure></li></ol></li><li><p>删除只有一颗子树的节点 比如 1</p><ol><li><p>需求先去找到要删除的结点 targetNode</p></li><li><p>找到 targetNode 的 父结点 parent</p></li><li><p>确定 targetNode 的子结点是左子结点还是右子结点</p></li><li><p>targetNode 是 parent 的左子结点还是右子结点</p></li><li><p>如果 targetNode 有左子结点</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">==&gt; 5. 1 如果 targetNode 是 parent 的左子结点</span><br><span class="line">        parent.left = targetNode.left;</span><br><span class="line">==&gt; 5.2 如果 targetNode 是 parent 的右子结点</span><br><span class="line">        parent.right = targetNode.left;</span><br></pre></td></tr></table></figure></li><li><p>如果 targetNode 有右子结点</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">==&gt; 6.1 如果 targetNode 是 parent 的左子结点</span><br><span class="line">        parent.left = targetNode.right;</span><br><span class="line">==&gt; 6.2 如果 targetNode 是 parent 的右子结点</span><br><span class="line">        parent.right = targetNode.right</span><br></pre></td></tr></table></figure></li></ol></li><li><p>删除有两颗子树的节点. (比如： 7, 3， 10 )</p><ol><li>需求先去找到要删除的结点 targetNode</li><li>找到 targetNode 的 父结点 parent</li><li>从 targetNode 的右子树找到最小的结点(也可以是左子树找最大的结点)</li><li>用一个临时变量， 将最小结点的值保存 temp = 11</li><li>删除该最小结点</li><li>targetNode.value = temp</li></ol></li></ol><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ul><li>要删除的节点正好是叶子节点，直接删除就 OK 了；</li><li>只有左孩子或者右孩子，直接把这个孩子上移放到要删除的位置就好了；</li><li>有两个孩子，就需要选一个合适的孩子节点作为新的根节点，该节点称为 继承节点。</li></ul><h2 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="结点–添加删除结点需要的方法"><a href="#结点–添加删除结点需要的方法" class="headerlink" title="结点–添加删除结点需要的方法"></a>结点–添加删除结点需要的方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree.binarysorttree;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 二叉排序树结点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value;</span><br><span class="line">    Node left;</span><br><span class="line">    Node right;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Node [value="</span> + value + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///删除结点////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找要删除的结点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 希望删除的结点的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  如果找到则返回该结点,否则返回null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">search</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">this</span>.value) &#123;  <span class="comment">// 找到该结点</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value &lt; <span class="keyword">this</span>.value) &#123;    <span class="comment">// 如果查找的值小于当前结点,则向左子树递归查找</span></span><br><span class="line">            <span class="comment">// 如果左子结点为空</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.left.search(value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;    <span class="comment">// 如果查找的值不小于当前结点,向右子树递归查找</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.right.search(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找要删除结点的父结点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 要找到的结点的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回的是要删除的结点的父结点,如果没有就返回null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">searchParent</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 如果当前结点就是要删除的结点的父结点,就返回</span></span><br><span class="line">        <span class="keyword">if</span> ((<span class="keyword">this</span>.left != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.left.value == value) || (<span class="keyword">this</span>.right != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.right.value == value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果查找的值小于当前结点,并且当前结点的左子结点不为空</span></span><br><span class="line">            <span class="keyword">if</span> (value &lt; <span class="keyword">this</span>.value &amp;&amp; <span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.left.searchParent(value);   <span class="comment">// 向左子树递归查找</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value &gt;= <span class="keyword">this</span>.value &amp;&amp; <span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.right.searchParent(value);  <span class="comment">// 向右子树递归查找</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;    <span class="comment">//没有找到父结点</span></span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///添加结点////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加结点方法 递归的形式添加结点,注意需要满足二叉排序树的要求</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node 要添加的结点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断传入结点的值和当前子树的根结点的值的关系</span></span><br><span class="line">        <span class="keyword">if</span> (node.value &lt; <span class="keyword">this</span>.value) &#123;</span><br><span class="line">            <span class="comment">// 如果当前结点左子树结点为null</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.left = node;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 递归向左子树添加</span></span><br><span class="line">                <span class="keyword">this</span>.left.add(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 添加的结点的值大于当前结点的值</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.right = node;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 递归向右子树添加</span></span><br><span class="line">                <span class="keyword">this</span>.right.add(node);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中序遍历</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.left.infixOrder();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.right.infixOrder();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="二叉排序树–添加删除方法"><a href="#二叉排序树–添加删除方法" class="headerlink" title="二叉排序树–添加删除方法"></a>二叉排序树–添加删除方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree.binarysorttree;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 二叉排序树</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinarySortTree</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///添加结点////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加结点的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node 要添加的结点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            root = node;    <span class="comment">// 如果root为空则直接让root指向node</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            root.add(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///删除结点////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找要删除的结点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">search</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">             <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> root.search(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查找父结点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">searchParent</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> root.searchParent(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1. 返回的以node为根结点的二叉排序树的最小结点的值</span></span><br><span class="line"><span class="comment">     * 2. 删除node为根结点的二叉排序树的最小结点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node 传入的结点(当作二叉排序树的根结点)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回以node为根结点的二叉排序树的最小结点的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除结点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delNode</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 需求先去找到要删除的结点 targetNode</span></span><br><span class="line">            Node targetNode = search(value);</span><br><span class="line">            <span class="comment">// 如果没有找到要删除的结点</span></span><br><span class="line">            <span class="keyword">if</span> (targetNode == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果当我们发现当前这棵二叉排序树只有一个结点</span></span><br><span class="line">            <span class="keyword">if</span> (root.left == <span class="keyword">null</span> &amp;&amp; root.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">                root = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. 去找 targetNode 的父结点</span></span><br><span class="line">            Node parent = searchParent(value);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. 判断要删除的结点的类型</span></span><br><span class="line">            <span class="comment">// ==&gt; 3.1 要删除的结点有0棵子树(即叶子结点)</span></span><br><span class="line">            <span class="comment">// ==&gt; ==&gt; 基本思路:找到targetNode,删除</span></span><br><span class="line">            <span class="keyword">if</span> (targetNode.left == <span class="keyword">null</span> &amp;&amp; targetNode.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 判断 targetNode 是父结点的左子结点还是右子结点</span></span><br><span class="line">                <span class="keyword">if</span> (parent.left != <span class="keyword">null</span> &amp;&amp; parent.left.value == value) &#123;    <span class="comment">// 是左子结点</span></span><br><span class="line">                    parent.left = <span class="keyword">null</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parent.right != <span class="keyword">null</span> &amp;&amp; parent.right.value == value) &#123;   <span class="comment">// 是右子结点</span></span><br><span class="line">                    parent.right = <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (targetNode.left != <span class="keyword">null</span> &amp;&amp; targetNode != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// ==&gt; 3.2 要删除的结点有2棵子树</span></span><br><span class="line">                <span class="comment">// ==&gt; ==&gt; 基本思路:targetNode要删除,删除后用targetNode的右子树的最小值进行填充</span></span><br><span class="line">                Node target = targetNode.right;</span><br><span class="line">                <span class="comment">// 循环查找左子结点,就会找到最小值</span></span><br><span class="line">                <span class="keyword">while</span> (target.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    target = target.left;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 这时target就指向了最小结点</span></span><br><span class="line">                <span class="comment">// 删除这个最小结点</span></span><br><span class="line">                delNode(target.value);</span><br><span class="line">                targetNode.value = target.value;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// ==&gt; 3.3 要删除的结点有1棵子树 </span></span><br><span class="line">                <span class="comment">// ==&gt; ==&gt; 基本思路:因为只有一棵子树,所以用子树填充删除的结点的位置</span></span><br><span class="line">                <span class="keyword">if</span> (targetNode.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 如果要删除的结点有左子结点</span></span><br><span class="line">                    <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// 如果 targetNode 是parent的左子结点</span></span><br><span class="line">                        <span class="keyword">if</span> (parent.left.value == value) &#123;</span><br><span class="line">                            parent.left = targetNode.left;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123; <span class="comment">// targetNode 是 parent 的右子结点</span></span><br><span class="line">                            parent.right = targetNode.left;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        root = targetNode.left;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;    <span class="comment">// 如果删除的结点有右子结点</span></span><br><span class="line">                    <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// 如果 targetNode 是 parent 的左子结点</span></span><br><span class="line">                        <span class="keyword">if</span> (parent.left.value == value) &#123;</span><br><span class="line">                            parent.left = targetNode.right;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;    <span class="comment">// 如果targetNode是parent右子结点</span></span><br><span class="line">                            parent.right = targetNode.right;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        root = targetNode.right;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 中序遍历</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root != <span class="keyword">null</span>) &#123;</span><br><span class="line">            root.infixOrder();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"二叉排序树为空,不能遍历"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree.binarysorttree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinarySortTreeTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = &#123;<span class="number">7</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">2</span>&#125;;</span><br><span class="line">        BinarySortTree binarySortTree = <span class="keyword">new</span> BinarySortTree();</span><br><span class="line">        <span class="comment">// 循环添加结点到二叉树</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            binarySortTree.add(<span class="keyword">new</span> Node(arr[i]));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 中序遍历二叉排序树</span></span><br><span class="line">        System.out.println(<span class="string">"中序遍历二叉排序树"</span>);</span><br><span class="line">        binarySortTree.infixOrder();    <span class="comment">// 1,3,5,7,9,10,12</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试一下删除结点</span></span><br><span class="line"><span class="comment">//      binarySortTree.delNode(2);</span></span><br><span class="line">        binarySortTree.delNode(<span class="number">10</span>);</span><br><span class="line">        System.out.println(<span class="string">"删除结点后"</span>);</span><br><span class="line">        binarySortTree.infixOrder();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>赫夫曼编码与解码</title>
      <link href="/2020/05/05/%E8%B5%AB%E5%A4%AB%E6%9B%BC%E7%BC%96%E7%A0%81/"/>
      <url>/2020/05/05/%E8%B5%AB%E5%A4%AB%E6%9B%BC%E7%BC%96%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h1><ol><li>赫夫曼编码也翻译为 哈夫曼编码(Huffman Coding)， 又称霍夫曼编码， 是一种编码方式, 属于一种程序算法</li><li>赫夫曼编码是赫哈夫曼树在电讯通信中的经典的应用之一。</li><li>赫夫曼编码广泛地用于数据文件压缩。 其压缩率通常在 20%～90%之间</li><li>赫夫曼码是可变字长编码(VLC)的一种。 Huffman 于 1952 年提出一种编码方法， 称之为最佳编码</li></ol><h1 id="通信领域中信息的处理方式"><a href="#通信领域中信息的处理方式" class="headerlink" title="通信领域中信息的处理方式"></a>通信领域中信息的处理方式</h1><h2 id="1-定长编码"><a href="#1-定长编码" class="headerlink" title="1-定长编码"></a>1-定长编码</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p><img src="/images/2020/07/20200730021.png" alt></p><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>没有进行压缩</p><h2 id="2-变长编码"><a href="#2-变长编码" class="headerlink" title="2-变长编码"></a>2-变长编码</h2><h3 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h3><p><img src="/images/2020/07/20200730022.png" alt></p><h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h3><blockquote><p>  前缀编码：设计长短不等的编码，必须是任一字符的编码都不是另一个字符编码的前缀，这种编码称为前缀编码</p></blockquote><p>变长编码的编码长短不等,却无法保证任一字符的编码都不是另一个字符编码的前缀,也就是说变长编码不是前缀编码,这就会导致我们使用码表翻译编码时,并不能翻译出唯一结果的字符</p><h2 id="3-赫夫曼编码"><a href="#3-赫夫曼编码" class="headerlink" title="3-赫夫曼编码"></a>3-赫夫曼编码</h2><h3 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h3><ol><li>传输的字符串:<code>i like like like java do you like a java</code></li><li><code>d:1 y:1 u:1 j:2 v:2 o:2 l:4 k:4 e:4 i:5 a:5 :9</code> // 各个字符对应的个数</li><li>按照上面字符出现的次数构建一颗赫夫曼树, 次数作为权值<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">构成赫夫曼树的步骤：</span><br><span class="line">1) 从小到大进行排序,将每一个数据，每个数据都是一个节点，每个节点可以看成是一颗最简单的二叉树</span><br><span class="line">2) 取出根节点权值最小的两颗二叉树</span><br><span class="line">3) 组成一颗新的二叉树,该新的二叉树的根节点的权值是前面两颗二叉树根节点权值的和</span><br><span class="line">4) 再将这颗新的二叉树，以根节点的权值大小 再次排序，不断重复 1-2-3-4 的步骤，直到数列中，所有的数据都被处理，就得到一颗赫夫曼树</span><br></pre></td></tr></table></figure></li></ol><p><img src="/images/2020/07/20200730023.png" alt></p><ol start="4"><li><p>根据赫夫曼树， 给各个字符,规定编码 (前缀编码)， 向左的路径为 0 向右的路径为 1 ， 编码<br>如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">o: 1000 u: 10010 d: 100110 y: 100111 i: 101 </span><br><span class="line">a : 110 k: 1110 e: 1111 j: 0000 v: 0001</span><br><span class="line">l: 001  (空格): 01</span><br></pre></td></tr></table></figure></li><li><p>按照上面的赫夫曼编码， 我们的”i like like like java do you like a java” 字符串对应的编码为 (注意这里我们使用的无损压缩)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 通过赫夫曼编码处理 长度为 133</span><br><span class="line">1010100110111101111010011011110111101001101111011110100001100001110011001111000011001111000100100100110111101111011100100001100001110</span><br></pre></td></tr></table></figure></li><li><p>长度为：133</p><ul><li>原来长度是 359 , 压缩了 <code>(359-133) / 359 = 62.9%</code></li><li>此编码满足前缀编码, 即字符的编码都不能是其他字符编码的前缀。不会造成匹配的多义性</li><li>赫夫曼编码是无损处理方案</li></ul></li></ol><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>注意, 这个赫夫曼树根据排序方法不同，也可能不太一样，这样对应的赫夫曼编码也不完全一样，但是 wpl 是一样的，都是最小的,后生成的赫夫曼编码的长度是一样，比如: 如果我们让每次生成的新的二叉树总是排在权值相同的二叉树的最后一个，则生成的二叉树为:<br><img src="/images/2020/07/20200730024.png" alt></p><h1 id="数据压缩-编码-代码实现-利用赫夫曼树"><a href="#数据压缩-编码-代码实现-利用赫夫曼树" class="headerlink" title="数据压缩(编码)代码实现(利用赫夫曼树)"></a>数据压缩(编码)代码实现(利用赫夫曼树)</h1><ol><li><p>结点</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree.huffmancode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建结点类 </span></span><br><span class="line"><span class="comment"> * =&gt; 为了让 Node 对象持续排序 Collections 集合排序 </span></span><br><span class="line"><span class="comment"> * =&gt; 让 Node 实现 Comparable 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Node</span>&gt; </span>&#123;</span><br><span class="line">    Byte data; <span class="comment">// 存放数据</span></span><br><span class="line">    <span class="keyword">int</span> weight; <span class="comment">// 结点权值,表示字符出现的次数</span></span><br><span class="line">    Node left; <span class="comment">// 指向左子结点</span></span><br><span class="line">    Node right; <span class="comment">// 指向右子结点</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(Byte data, <span class="keyword">int</span> weight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">this</span>.weight = weight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前序遍历自身的子树</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.left.preOrder();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.right.preOrder();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Node [data = "</span> + data + <span class="string">" weight="</span> + weight + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Node o)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 表示从小到大排序</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.weight - o.weight;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>赫夫曼编码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree.huffmancode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 我们已经生成了 赫夫曼树, 下面我们继续完成任务</span></span><br><span class="line"><span class="comment"> * 1) 生成赫夫曼树对应的赫夫曼编码 , 如下表:</span></span><br><span class="line"><span class="comment"> * =01 a=100 d=11000 u=11001 e=1110 v=11011 i=101 y=11010 j=0010 k=1111 l=000 o=0011</span></span><br><span class="line"><span class="comment"> * 2) 使用赫夫曼编码来生成赫夫曼编码数据 ,即按照上面的赫夫曼编码， 将"i like like like java do you like a java"</span></span><br><span class="line"><span class="comment"> * 字符串生成对应的编码数据, 形式如下.</span></span><br><span class="line"><span class="comment"> * 10101000101111111100100010111111110010001011111111001001010011011100011100000110111010001111001010</span></span><br><span class="line"><span class="comment"> * 00101111111100110001001010011011100</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HuffmanCode</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String content = <span class="string">"i like like like java do you like a java"</span>;</span><br><span class="line">        <span class="comment">// 将所有字符转成ASCII码</span></span><br><span class="line">        <span class="keyword">byte</span>[] contentBytes = content.getBytes();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> b : contentBytes) &#123;</span><br><span class="line">            System.out.print(b + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">"========================="</span>);</span><br><span class="line">        System.out.println(contentBytes.length); <span class="comment">// 40 byte[]</span></span><br><span class="line">        System.out.println(<span class="string">"========================="</span>);</span><br><span class="line">        <span class="comment">// contentBytes里保存的ASCII码如下</span></span><br><span class="line">        <span class="comment">// 105 32 108 105 107 101 32 108 105 107 101 32 108 105 107 101 32 106 97 </span></span><br><span class="line">        <span class="comment">// 118 97 32 100 111 32 121 111 117 32 108 105 107 101 32 97 32 106 97 118 97 </span></span><br><span class="line">        <span class="keyword">byte</span>[] huffmanCodesBytes = huffmanZip(contentBytes);</span><br><span class="line">        System.out.println(<span class="string">"压缩后的结果是:"</span> + Arrays.toString(huffmanCodesBytes));</span><br><span class="line">        System.out.println(<span class="string">"压缩后的长度是:"</span> + huffmanCodesBytes.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 赫夫曼压缩</span></span><br><span class="line"><span class="comment">     * =&gt; 将分步骤的所有方法封装起来，便于我们的调用.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes 原始的字符串对应的字节数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是经过赫夫曼编码处理后的字节数组(压缩后的数组)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] huffmanZip(<span class="keyword">byte</span>[] bytes) &#123;</span><br><span class="line">        List&lt;Node&gt; nodes = getNodes(bytes);</span><br><span class="line">        <span class="comment">// 根据 nodes (里面所有的数字)创建的赫夫曼树</span></span><br><span class="line">        Node huffmanTreeRoot = createHuffmanTree(nodes);</span><br><span class="line">        <span class="comment">// 对应的赫夫曼编码(根据赫夫曼树)</span></span><br><span class="line">        Map&lt;Byte, String&gt; huffmanCodes = getCodes(huffmanTreeRoot);</span><br><span class="line">        <span class="comment">// 根据生成的赫夫曼编码， 压缩得到压缩后的赫夫曼编码字节数组</span></span><br><span class="line">        <span class="keyword">byte</span>[] huffmanCodeBytes = zip(bytes, huffmanCodes);</span><br><span class="line">        <span class="keyword">return</span> huffmanCodeBytes;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 四.将经过赫夫曼树编码过后的编码,按每8位一分割变成一个字符数组</span></span><br><span class="line"><span class="comment">     * 举例：</span></span><br><span class="line"><span class="comment">     * =&gt; String content = "i like like like java do you like a java"; ==&gt; byte[] contentBytes = content.getBytes(); </span></span><br><span class="line"><span class="comment">     * =&gt; 返回的是字符串 "1010100010111111110010001011111111001000101111111100100101001101110001110000011011101000111100101000</span></span><br><span class="line"><span class="comment">     *         101111111100110001001010011011100"</span></span><br><span class="line"><span class="comment">     * =&gt; 对应的 byte[] huffmanCodeBytes,即 8 位对应一个 byte,放入到 huffmanCodeBytes huffmanCodeBytes[0] =</span></span><br><span class="line"><span class="comment">     *         10101000(补码) </span></span><br><span class="line"><span class="comment">     * =&gt; byte huffmanCodeBytes[1] = -88</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes        这时原始的字符串对应的 byte[]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> huffmanCodes 生成的赫夫曼编码 map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回赫夫曼编码处理后的 byte[] </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] zip(<span class="keyword">byte</span>[] bytes, Map&lt;Byte, String&gt; huffmanCodes) &#123;</span><br><span class="line">        <span class="comment">// 利用 huffmanCodes 将 bytes 转成 赫夫曼编码对应的字符串</span></span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="comment">// 遍历 bytes 数组</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> b : bytes) &#123;</span><br><span class="line">            stringBuilder.append(huffmanCodes.get(b));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"测试 stringBuilder~~~="</span> + stringBuilder.toString());</span><br><span class="line">        <span class="comment">// 将 "1010100010111111110..." 转成 byte[]</span></span><br><span class="line">        <span class="comment">// 统计返回 byte[] huffmanCodeBytes 长度</span></span><br><span class="line"><span class="comment">//      int len;</span></span><br><span class="line"><span class="comment">//      if (stringBuilder.length() % 8 == 0) &#123;</span></span><br><span class="line"><span class="comment">//          len = stringBuilder.length() / 8;</span></span><br><span class="line"><span class="comment">//      &#125; else &#123;</span></span><br><span class="line"><span class="comment">//          len = stringBuilder.length() / 8 + 1;</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line">        <span class="keyword">int</span> len = (stringBuilder.length() + <span class="number">7</span>) / <span class="number">8</span>;</span><br><span class="line">        <span class="comment">// 创建 存储压缩后的 byte 数组</span></span><br><span class="line">        <span class="keyword">byte</span>[] huffmanCodeBytes = <span class="keyword">new</span> <span class="keyword">byte</span>[len];</span><br><span class="line">        <span class="comment">// 记录是第几个 byte</span></span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 因为是每 8 位对应一个byte,所以步长 +8</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; stringBuilder.length(); i += <span class="number">8</span>) &#123;</span><br><span class="line">            String strByte;</span><br><span class="line">            <span class="keyword">if</span> (i + <span class="number">8</span> &gt; stringBuilder.length()) &#123; <span class="comment">// 不够 8 位</span></span><br><span class="line">                strByte = stringBuilder.substring(i);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                strByte = stringBuilder.substring(i, i + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 将 strByte 转成一个 byte,放入到 huffmanCodeBytes</span></span><br><span class="line">            <span class="comment">// 用二进制进行解析</span></span><br><span class="line">            <span class="comment">// 推导 10101000(补码) =&gt; 10101000(补码) - 1 =&gt; 10100111(反码) =&gt; 11011000(原码) = -88(十进制)</span></span><br><span class="line">            huffmanCodeBytes[index] = (<span class="keyword">byte</span>) Integer.parseInt(strByte, <span class="number">2</span>);</span><br><span class="line">            index++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> huffmanCodeBytes;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 三.为了调用方便，我们重载 getCodes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> root</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Byte, String&gt; <span class="title">getCodes</span><span class="params">(Node root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 处理 root 的左子树</span></span><br><span class="line">        getCodes(root.left, <span class="string">"0"</span>, <span class="keyword">new</span> StringBuilder());</span><br><span class="line">        <span class="comment">// 处理 root 的右子树</span></span><br><span class="line">        getCodes(root.right, <span class="string">"1"</span>, <span class="keyword">new</span> StringBuilder());</span><br><span class="line">        <span class="keyword">return</span> huffmanCodes;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将赫夫曼编码表存放在 Map&lt;Byte,String&gt; 形式</span></span><br><span class="line"><span class="comment">     * 生成的赫夫曼编码表 &#123;32=01, 97=100, 100=11000, 117=11001, 101=1110,118=11011, 105=101,121=11010,106=0010,107=1111,108=000,111=0011&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> Map&lt;Byte, String&gt; huffmanCodes = <span class="keyword">new</span> HashMap&lt;Byte, String&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 三.将传入的 node 结点的所有叶子结点的赫夫曼编码得到，并放入到 huffmanCodes 集合</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node          传入结点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code          路径： 左子结点是 0, 右子结点 1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stringBuilder 用于拼接路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getCodes</span><span class="params">(Node node, String code, StringBuilder stringBuilder)</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder(stringBuilder);</span><br><span class="line">        sb.append(code);</span><br><span class="line">        <span class="keyword">if</span> (node != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 判断当前结点是否是叶子结点</span></span><br><span class="line">            <span class="comment">// 如果不是叶子结点,则说明该结点有左右子结点</span></span><br><span class="line">            <span class="keyword">if</span> (node.data == <span class="keyword">null</span>) &#123;    <span class="comment">// 非叶子结点</span></span><br><span class="line">                <span class="comment">// 向左递归</span></span><br><span class="line">                getCodes(node.left, <span class="string">"0"</span>, sb);</span><br><span class="line">                <span class="comment">// 向右递归</span></span><br><span class="line">                getCodes(node.right, <span class="string">"1"</span>, sb);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 是叶子结点</span></span><br><span class="line">                <span class="comment">// 说明不需要继续递归</span></span><br><span class="line">                <span class="comment">// 只需要将当前的递归得到的sb值保存就行</span></span><br><span class="line">                huffmanCodes.put(node.data, sb.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 二.创建赫夫曼树 =&gt; 可以通过 List 创建对应的赫夫曼树</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nodes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Node <span class="title">createHuffmanTree</span><span class="params">(List&lt;Node&gt; nodes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (nodes.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 排序, 从小到大</span></span><br><span class="line">            Collections.sort(nodes);</span><br><span class="line">            <span class="comment">// 取出第一颗最小的二叉树</span></span><br><span class="line">            Node leftNode = nodes.get(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">// 取出第二颗最小的二叉树</span></span><br><span class="line">            Node rightNode = nodes.get(<span class="number">1</span>);</span><br><span class="line">            <span class="comment">// 创建一颗新的二叉树,它的根节点 没有 data, 只有权值</span></span><br><span class="line">            Node parent = <span class="keyword">new</span> Node(<span class="keyword">null</span>, leftNode.weight + rightNode.weight);</span><br><span class="line">            parent.left = leftNode;</span><br><span class="line">            parent.right = rightNode;</span><br><span class="line">            <span class="comment">// 将已经处理的两颗二叉树从 nodes 删除</span></span><br><span class="line">            nodes.remove(leftNode);</span><br><span class="line">            nodes.remove(rightNode);</span><br><span class="line">            <span class="comment">// 将新的二叉树， 加入到 nodes</span></span><br><span class="line">            nodes.add(parent);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// nodes 最后的结点， 就是赫夫曼树的根结点</span></span><br><span class="line">        <span class="keyword">return</span> nodes.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一.将字符串的每个字符转成对应的ASCII码数组,并记录获取权重</span></span><br><span class="line"><span class="comment">     * 105 32 108 105 107 101 32 108 105 107 101 32 108 105 107 101 32 106 97 118</span></span><br><span class="line"><span class="comment">     *  97 32 100 111 32 121 111 117 32 108 105 107 101 32 97 32 106 97 118 97 </span></span><br><span class="line"><span class="comment">     * 变成如下形式</span></span><br><span class="line"><span class="comment">     *  [Node[date = 97 ,weight = 5], Node[date = 32,weight = 9]......]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes 接受字节数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回的就是List形式 [Node[date = 97 ,weight = 5], Node[date = 32,weight = 9]......]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;Node&gt; <span class="title">getNodes</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1 创建一个 ArrayList</span></span><br><span class="line">        ArrayList&lt;Node&gt; nodes = <span class="keyword">new</span> ArrayList&lt;Node&gt;();</span><br><span class="line">        <span class="comment">// 遍历 bytes , 统计 每一个 byte 出现的次数-&gt;map[key,value]</span></span><br><span class="line">        Map&lt;Byte, Integer&gt; counts = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> b : bytes) &#123;</span><br><span class="line">            Integer count = counts.get(b);</span><br><span class="line">            <span class="keyword">if</span> (count == <span class="keyword">null</span>) &#123; <span class="comment">// Map 还没有这个字符数据,第一次</span></span><br><span class="line">                counts.put(b, <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                counts.put(b, count + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 把每一个键值对转成一个 Node 对象， 并加入到 nodes 集合</span></span><br><span class="line">        <span class="comment">// 遍历 map</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Byte, Integer&gt; entry : counts.entrySet()) &#123;</span><br><span class="line">            nodes.add(<span class="keyword">new</span> Node(entry.getKey(), entry.getValue()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nodes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="赫夫曼解压缩-解码-代码实现"><a href="#赫夫曼解压缩-解码-代码实现" class="headerlink" title="赫夫曼解压缩(解码)代码实现"></a>赫夫曼解压缩(解码)代码实现</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree.huffmancode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 我们已经生成了 赫夫曼树, 下面我们继续完成任务</span></span><br><span class="line"><span class="comment"> * 1) 生成赫夫曼树对应的赫夫曼编码 , 如下表:</span></span><br><span class="line"><span class="comment"> * =01 a=100 d=11000 u=11001 e=1110 v=11011 i=101 y=11010 j=0010 k=1111 l=000 o=0011</span></span><br><span class="line"><span class="comment"> * 2) 使用赫夫曼编码来生成赫夫曼编码数据 ,即按照上面的赫夫曼编码， 将"i like like like java do you like a java"</span></span><br><span class="line"><span class="comment"> * 字符串生成对应的编码数据, 形式如下.</span></span><br><span class="line"><span class="comment"> * 10101000101111111100100010111111110010001011111111001001010011011100011100000110111010001111001010</span></span><br><span class="line"><span class="comment"> * 00101111111100110001001010011011100</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HuffmanCode</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String content = <span class="string">"i like like like java do you like a java"</span>;</span><br><span class="line">        <span class="comment">// 将所有字符转成ASCII码</span></span><br><span class="line">        <span class="keyword">byte</span>[] contentBytes = content.getBytes();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> b : contentBytes) &#123;</span><br><span class="line">            System.out.print(b + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(<span class="string">"========================="</span>);</span><br><span class="line">        System.out.println(contentBytes.length); <span class="comment">// 40 byte[]</span></span><br><span class="line">        System.out.println(<span class="string">"========================="</span>);</span><br><span class="line">        <span class="comment">// contentBytes里保存的ASCII码如下</span></span><br><span class="line">        <span class="comment">// 105 32 108 105 107 101 32 108 105 107 101 32 108 105 107 101 32 106 97 </span></span><br><span class="line">        <span class="comment">// 118 97 32 100 111 32 121 111 117 32 108 105 107 101 32 97 32 106 97 118 97 </span></span><br><span class="line">        <span class="keyword">byte</span>[] huffmanCodesBytes = huffmanZip(contentBytes);</span><br><span class="line">        System.out.println(<span class="string">"压缩后的结果是:"</span> + Arrays.toString(huffmanCodesBytes));</span><br><span class="line">        System.out.println(<span class="string">"压缩后的长度是:"</span> + huffmanCodesBytes.length);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"======================="</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] sourceBytes = decode(huffmanCodes, huffmanCodesBytes);</span><br><span class="line">        System.out.println(<span class="string">"原来的字符串="</span> + <span class="keyword">new</span> String(sourceBytes));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">/////赫夫曼解压缩//////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 赫夫曼解压缩</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> huffmanCodes 赫夫曼编码表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> huffmanBytes 字符串对应的byte数组信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] decode(Map&lt;Byte, String&gt; huffmanCodes, <span class="keyword">byte</span>[] huffmanBytes) &#123;</span><br><span class="line">        <span class="comment">// 1. 先得到 huffmanBytes 对应的二进制的字符串 ， 形式 1010100010111...</span></span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="comment">// 将 byte 数组转成二进制的字符串</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; huffmanBytes.length; i++) &#123;</span><br><span class="line">            <span class="keyword">byte</span> b = huffmanBytes[i];</span><br><span class="line">            <span class="comment">// 判断是不是最后一个字节</span></span><br><span class="line">            <span class="keyword">boolean</span> flag = (i == huffmanBytes.length - <span class="number">1</span>);</span><br><span class="line">            stringBuilder.append(byteToBitString(!flag, b));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// System.out.println(stringBuilder.toString());</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把字符串按照指定的赫夫曼编码进行</span></span><br><span class="line">        <span class="comment">// 对赫夫曼编码表进行反向(和编码相反)，因为反向查询a-&gt;100 100-&gt;a</span></span><br><span class="line">        Map&lt;String, Byte&gt; map = <span class="keyword">new</span> HashMap&lt;String, Byte&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Byte, String&gt; entry : huffmanCodes.entrySet()) &#123;</span><br><span class="line">            map.put(entry.getValue(), entry.getKey());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建集合,用以存放byte</span></span><br><span class="line">        List&lt;Byte&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">// i 可以理解成就是索引,扫描stringBuilder</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; stringBuilder.length(); ) &#123;</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">1</span>;  <span class="comment">//小的计数器</span></span><br><span class="line">            <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">            Byte b = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">while</span> (flag) &#123;</span><br><span class="line">                <span class="comment">// 递增的取出key</span></span><br><span class="line">                String key = stringBuilder.substring(i, i + count); <span class="comment">// i不动,让count移动,指定匹配到一个字符</span></span><br><span class="line">                b = map.get(key);</span><br><span class="line">                <span class="keyword">if</span> (b == <span class="keyword">null</span>) &#123;    <span class="comment">// 说明没有匹配到</span></span><br><span class="line">                    count++;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 匹配到</span></span><br><span class="line">                    flag = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(b);</span><br><span class="line">            i += count; <span class="comment">//i 直接移动到count</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 当for循环结束后,我们list中就存放了所有字符"i like like like java do you like a java"</span></span><br><span class="line">        <span class="comment">// 把list中的数据放入到byte[] 并返回</span></span><br><span class="line">        <span class="keyword">byte</span> b[] = <span class="keyword">new</span> <span class="keyword">byte</span>[list.size()];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; b.length; i++) &#123;</span><br><span class="line">            b[i]= list.get(i); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 将一个 byte 转成一个8位二进制的字符串</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> b 传入的 byte</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> flag 标志是否需要补高位如果是 true，表示需要补高位，如果是 false 表示不补, 如果是最后一个字节， 无需补高位</span></span><br><span class="line"><span class="comment">    *             为什么需要补高位?</span></span><br><span class="line"><span class="comment">    *               =&gt; 因为我们是8位二进制进行编码,那么我们解码解出来也需要是8位的二进制数</span></span><br><span class="line"><span class="comment">    *               =&gt; 但是Integer.toBinaryString(temp),如果是高位全部是0的话就不会输出</span></span><br><span class="line"><span class="comment">    *               =&gt; 比如 10 这个数,通过Integer.toBinaryString(10)获取二进制码,只会显示 1010</span></span><br><span class="line"><span class="comment">    *               =&gt; =&gt; 所以正数需要补高位</span></span><br><span class="line"><span class="comment">    *               =&gt; =&gt; 负数不需要补高位,因为负数的符号位是1,所以不会被省略</span></span><br><span class="line"><span class="comment">    *               =&gt; =&gt; 最后一个字节， 无需补高位,因为最后一个字节本身就可能无法满足8位</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> 是该 b 对应的二进制的字符串（注意是按补码返回）</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">byteToBitString</span><span class="params">(<span class="keyword">boolean</span> flag, <span class="keyword">byte</span> b)</span> </span>&#123;</span><br><span class="line"><span class="comment">//      int a= 10;</span></span><br><span class="line"><span class="comment">//      for (int i=0; i &lt; 32; i++) &#123;  // 整数有32位,所以要做32次循环</span></span><br><span class="line"><span class="comment">//          // 0x80000000 表示最高位为1的数字</span></span><br><span class="line"><span class="comment">//          int t = (a &amp; 0x80000000 &gt;&gt;&gt; i) &gt;&gt;&gt; (31 - i);</span></span><br><span class="line"><span class="comment">//          System.out.print(t);</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line"><span class="comment">//      // 使用变量保存b</span></span><br><span class="line">        <span class="keyword">int</span> temp = b;   <span class="comment">// 将b转成int</span></span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            temp |= <span class="number">256</span>;    <span class="comment">//按位或256 : 1 0000 0000 | 0000 0001 =&gt; 1 0000 0001</span></span><br><span class="line">        &#125;</span><br><span class="line">        String str = Integer.toBinaryString(temp);  <span class="comment">// 返回的是temp对应的二进制的补码</span></span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            <span class="keyword">return</span> str.substring(str.length() - <span class="number">8</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">/////赫夫曼压缩////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 赫夫曼压缩</span></span><br><span class="line"><span class="comment">     * =&gt; 将分步骤的所有方法封装起来，便于我们的调用.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes 原始的字符串对应的字节数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是经过赫夫曼编码处理后的字节数组(压缩后的数组)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] huffmanZip(<span class="keyword">byte</span>[] bytes) &#123;</span><br><span class="line">        List&lt;Node&gt; nodes = getNodes(bytes);</span><br><span class="line">        <span class="comment">// 根据 nodes (里面所有的数字)创建的赫夫曼树</span></span><br><span class="line">        Node huffmanTreeRoot = createHuffmanTree(nodes);</span><br><span class="line">        <span class="comment">// 对应的赫夫曼编码(根据赫夫曼树)</span></span><br><span class="line">        Map&lt;Byte, String&gt; huffmanCodes = getCodes(huffmanTreeRoot);</span><br><span class="line">        <span class="comment">// 根据生成的赫夫曼编码， 压缩得到压缩后的赫夫曼编码字节数组</span></span><br><span class="line">        <span class="keyword">byte</span>[] huffmanCodeBytes = zip(bytes, huffmanCodes);</span><br><span class="line">        <span class="keyword">return</span> huffmanCodeBytes;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将经过赫夫曼树编码过后的编码,按每8位一分割变成一个字符数组</span></span><br><span class="line"><span class="comment">     * 举例：</span></span><br><span class="line"><span class="comment">     * =&gt; String content = "i like like like java do you like a java"; ==&gt; byte[] contentBytes = content.getBytes(); </span></span><br><span class="line"><span class="comment">     * =&gt; 返回的是字符串 "1010100010111111110010001011111111001000101111111100100101001101110001110000011011101000111100101000</span></span><br><span class="line"><span class="comment">     *         101111111100110001001010011011100"</span></span><br><span class="line"><span class="comment">     * =&gt; 对应的 byte[] huffmanCodeBytes,即 8 位对应一个 byte,放入到 huffmanCodeBytes huffmanCodeBytes[0] =</span></span><br><span class="line"><span class="comment">     *         10101000(补码) </span></span><br><span class="line"><span class="comment">     * =&gt; byte huffmanCodeBytes[1] = -88</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes        这时原始的字符串对应的 byte[]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> huffmanCodes 生成的赫夫曼编码 map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回赫夫曼编码处理后的 byte[] </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] zip(<span class="keyword">byte</span>[] bytes, Map&lt;Byte, String&gt; huffmanCodes) &#123;</span><br><span class="line">        <span class="comment">// 利用 huffmanCodes 将 bytes 转成 赫夫曼编码对应的字符串</span></span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="comment">// 遍历 bytes 数组</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> b : bytes) &#123;</span><br><span class="line">            stringBuilder.append(huffmanCodes.get(b));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"测试 stringBuilder~~~="</span> + stringBuilder.toString());</span><br><span class="line">        <span class="comment">// 将 "1010100010111111110..." 转成 byte[]</span></span><br><span class="line">        <span class="comment">// 统计返回 byte[] huffmanCodeBytes 长度</span></span><br><span class="line"><span class="comment">//      int len;</span></span><br><span class="line"><span class="comment">//      if (stringBuilder.length() % 8 == 0) &#123;</span></span><br><span class="line"><span class="comment">//          len = stringBuilder.length() / 8;</span></span><br><span class="line"><span class="comment">//      &#125; else &#123;</span></span><br><span class="line"><span class="comment">//          len = stringBuilder.length() / 8 + 1;</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line">        <span class="keyword">int</span> len = (stringBuilder.length() + <span class="number">7</span>) / <span class="number">8</span>;</span><br><span class="line">        <span class="comment">// 创建 存储压缩后的 byte 数组</span></span><br><span class="line">        <span class="keyword">byte</span>[] huffmanCodeBytes = <span class="keyword">new</span> <span class="keyword">byte</span>[len];</span><br><span class="line">        <span class="comment">// 记录是第几个 byte</span></span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 因为是每 8 位对应一个byte,所以步长 +8</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; stringBuilder.length(); i += <span class="number">8</span>) &#123;</span><br><span class="line">            String strByte;</span><br><span class="line">            <span class="keyword">if</span> (i + <span class="number">8</span> &gt; stringBuilder.length()) &#123; <span class="comment">// 不够 8 位</span></span><br><span class="line">                strByte = stringBuilder.substring(i);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                strByte = stringBuilder.substring(i, i + <span class="number">8</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 将 strByte 转成一个 byte,放入到 huffmanCodeBytes</span></span><br><span class="line">            <span class="comment">// 用二进制进行解析</span></span><br><span class="line">            <span class="comment">// 推导 10101000(补码) =&gt; 10101000(补码) - 1 =&gt; 10100111(反码) =&gt; 11011000(原码) = -88(十进制)</span></span><br><span class="line">            huffmanCodeBytes[index] = (<span class="keyword">byte</span>) Integer.parseInt(strByte, <span class="number">2</span>);</span><br><span class="line">            index++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> huffmanCodeBytes;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为了调用方便，我们重载 getCodes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> root</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Byte, String&gt; <span class="title">getCodes</span><span class="params">(Node root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 处理 root 的左子树</span></span><br><span class="line">        getCodes(root.left, <span class="string">"0"</span>, <span class="keyword">new</span> StringBuilder());</span><br><span class="line">        <span class="comment">// 处理 root 的右子树</span></span><br><span class="line">        getCodes(root.right, <span class="string">"1"</span>, <span class="keyword">new</span> StringBuilder());</span><br><span class="line">        <span class="keyword">return</span> huffmanCodes;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将赫夫曼编码表存放在 Map&lt;Byte,String&gt; 形式</span></span><br><span class="line"><span class="comment">     * 生成的赫夫曼编码表 &#123;32=01, 97=100, 100=11000, 117=11001, 101=1110,118=11011, 105=101,121=11010,106=0010,107=1111,108=000,111=0011&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> Map&lt;Byte, String&gt; huffmanCodes = <span class="keyword">new</span> HashMap&lt;Byte, String&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能： 将传入的 node 结点的所有叶子结点的赫夫曼编码得到， 并放入到 huffmanCodes 集合</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node          传入结点</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code          路径： 左子结点是 0, 右子结点 1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stringBuilder 用于拼接路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getCodes</span><span class="params">(Node node, String code, StringBuilder stringBuilder)</span> </span>&#123;</span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder(stringBuilder);</span><br><span class="line">        sb.append(code);</span><br><span class="line">        <span class="keyword">if</span> (node != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 判断当前结点是否是叶子结点</span></span><br><span class="line">            <span class="comment">// 如果不是叶子结点,则说明该结点有左右子结点</span></span><br><span class="line">            <span class="keyword">if</span> (node.data == <span class="keyword">null</span>) &#123;    <span class="comment">// 非叶子结点</span></span><br><span class="line">                <span class="comment">// 向左递归</span></span><br><span class="line">                getCodes(node.left, <span class="string">"0"</span>, sb);</span><br><span class="line">                <span class="comment">// 向右递归</span></span><br><span class="line">                getCodes(node.right, <span class="string">"1"</span>, sb);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 是叶子结点</span></span><br><span class="line">                <span class="comment">// 说明不需要继续递归</span></span><br><span class="line">                <span class="comment">// 只需要将当前的递归得到的sb值保存就行</span></span><br><span class="line">                huffmanCodes.put(node.data, sb.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将字符串对应的字符数组</span></span><br><span class="line"><span class="comment">     * 105 32 108 105 107 101 32 108 105 107 101 32 108 105 107 101 32 106 97 118</span></span><br><span class="line"><span class="comment">     *  97 32 100 111 32 121 111 117 32 108 105 107 101 32 97 32 106 97 118 97 </span></span><br><span class="line"><span class="comment">     * 变成如下形式</span></span><br><span class="line"><span class="comment">     *  [Node[date = 97 ,weight = 5], Node[date = 32,weight = 9]......]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes 接受字节数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回的就是List形式 [Node[date = 97 ,weight = 5], Node[date = 32,weight = 9]......]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;Node&gt; <span class="title">getNodes</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1 创建一个 ArrayList</span></span><br><span class="line">        ArrayList&lt;Node&gt; nodes = <span class="keyword">new</span> ArrayList&lt;Node&gt;();</span><br><span class="line">        <span class="comment">// 遍历 bytes , 统计 每一个 byte 出现的次数-&gt;map[key,value]</span></span><br><span class="line">        Map&lt;Byte, Integer&gt; counts = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">byte</span> b : bytes) &#123;</span><br><span class="line">            Integer count = counts.get(b);</span><br><span class="line">            <span class="keyword">if</span> (count == <span class="keyword">null</span>) &#123; <span class="comment">// Map 还没有这个字符数据,第一次</span></span><br><span class="line">                counts.put(b, <span class="number">1</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                counts.put(b, count + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 把每一个键值对转成一个 Node 对象， 并加入到 nodes 集合</span></span><br><span class="line">        <span class="comment">// 遍历 map</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Byte, Integer&gt; entry : counts.entrySet()) &#123;</span><br><span class="line">            nodes.add(<span class="keyword">new</span> Node(entry.getKey(), entry.getValue()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nodes;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建赫夫曼树 =&gt; 可以通过 List 创建对应的赫夫曼树</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nodes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Node <span class="title">createHuffmanTree</span><span class="params">(List&lt;Node&gt; nodes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (nodes.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 排序, 从小到大</span></span><br><span class="line">            Collections.sort(nodes);</span><br><span class="line">            <span class="comment">// 取出第一颗最小的二叉树</span></span><br><span class="line">            Node leftNode = nodes.get(<span class="number">0</span>);</span><br><span class="line">            <span class="comment">// 取出第二颗最小的二叉树</span></span><br><span class="line">            Node rightNode = nodes.get(<span class="number">1</span>);</span><br><span class="line">            <span class="comment">// 创建一颗新的二叉树,它的根节点 没有 data, 只有权值</span></span><br><span class="line">            Node parent = <span class="keyword">new</span> Node(<span class="keyword">null</span>, leftNode.weight + rightNode.weight);</span><br><span class="line">            parent.left = leftNode;</span><br><span class="line">            parent.right = rightNode;</span><br><span class="line">            <span class="comment">// 将已经处理的两颗二叉树从 nodes 删除</span></span><br><span class="line">            nodes.remove(leftNode);</span><br><span class="line">            nodes.remove(rightNode);</span><br><span class="line">            <span class="comment">// 将新的二叉树， 加入到 nodes</span></span><br><span class="line">            nodes.add(parent);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// nodes 最后的结点， 就是赫夫曼树的根结点</span></span><br><span class="line">        <span class="keyword">return</span> nodes.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>赫夫曼树(最优二叉树)与赫夫曼树的JAVA实现</title>
      <link href="/2020/05/03/%E8%B5%AB%E5%A4%AB%E6%9B%BC%E6%A0%91(%E6%9C%80%E4%BC%98%E4%BA%8C%E5%8F%89%E6%A0%91)%E4%B8%8E%E8%B5%AB%E5%A4%AB%E6%9B%BC%E6%A0%91%E7%9A%84JAVA%E5%AE%9E%E7%8E%B0/"/>
      <url>/2020/05/03/%E8%B5%AB%E5%A4%AB%E6%9B%BC%E6%A0%91(%E6%9C%80%E4%BC%98%E4%BA%8C%E5%8F%89%E6%A0%91)%E4%B8%8E%E8%B5%AB%E5%A4%AB%E6%9B%BC%E6%A0%91%E7%9A%84JAVA%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h1><ol><li>路径和路径长度：在一棵树中，从一个结点往下可以达到的孩子或孙子结点之间的通路，称为路径。通路中分支的数目称为路径长度。若规定根结点的层数为 1，则从根结点到第 L 层结点的路径长度为 L-1</li><li>结点的权及带权路径长度：若将树中结点赋给一个有着某种含义的数值，则这个数值称为该结点的权。结点的带权路径长度为：从根结点到该结点之间的路径长度与该结点的权的乘积</li><li>树的带权路径长度： 树的带权路径长度规定为所有叶子结点的带权路径长度之和， 记为<code>WPL(weighted pathlength)</code></li></ol><h1 id="什么是赫夫曼树"><a href="#什么是赫夫曼树" class="headerlink" title="什么是赫夫曼树"></a>什么是赫夫曼树</h1><ol><li>定义:给定 n 个权值作为 n 个叶子结点，构造一棵二叉树，若该树的带权路径长度(wpl)达到最小，称这样的二叉树为最优二叉树，也称为哈夫曼树(Huffman Tree),还有的书翻译为霍夫曼树 ==&gt; <strong>WPL 最小的就是赫夫曼树</strong>。</li><li>赫夫曼树是带权路径长度最短的树，权值较大的结点离根较近(权值越大的结点离根结点越近的二叉树才是最优二叉树)</li><li>下面第二图是赫夫曼树<br><img src="/images/2020/07/20200730013.png" alt></li></ol><h1 id="赫夫曼树创建思路图解"><a href="#赫夫曼树创建思路图解" class="headerlink" title="赫夫曼树创建思路图解"></a>赫夫曼树创建思路图解</h1><p>给你一个数列 {13, 7, 8, 3, 29, 6, 1}，要求转成一颗赫夫曼树</p><h2 id="构成赫夫曼树的步骤"><a href="#构成赫夫曼树的步骤" class="headerlink" title="构成赫夫曼树的步骤"></a>构成赫夫曼树的步骤</h2><ol><li>从小到大进行排序, 将每一个数据，每个数据都是一个节点，每个节点可以看成是一颗最简单的二叉树</li><li>取出根节点权值最小的两颗二叉树</li><li>组成一颗新的二叉树, 该新的二叉树的根节点的权值是前面两颗二叉树根节点权值的和</li><li>再将这颗新的二叉树， 以根节点的权值大小再次排序， 不断重复 1-2-3-4 的步骤，直到数列中，所有的数据都被处理，就得到一颗赫夫曼树</li></ol><h2 id="构成赫夫曼树的图解"><a href="#构成赫夫曼树的图解" class="headerlink" title="构成赫夫曼树的图解"></a>构成赫夫曼树的图解</h2><ul><li>将<code>{13, 7, 8, 3, 29, 6, 1}</code>排序变成<code>{1, 3, 6, 7, 8, 13, 29}</code></li><li>取出根结点权值最小的两棵二叉树 ==&gt; <code>1,3</code></li><li>组成一棵新的二叉树,根结点的权值是前面两棵二叉树的根结点权值的和 ==&gt; 即<code>1 + 3 = 4</code><br><img src="/images/2020/07/20200730015.png" alt></li><li>经过上一步,数列变成<code>{4, 6, 7, 8, 13, 29}</code></li><li>取出根结点权值最小的两棵二叉树 ==&gt; <code>4, 6</code></li><li>组成一棵新的二叉树,根结点的权值是前面两棵二叉树的根结点权值的和 ==&gt; 即<code>4 + 6 = 10</code><br><img src="/images/2020/07/20200730016.png" alt></li><li>经过上一步,数列变成<code>{10, 7, 8, 13, 29}</code>,排序后变成<code>{7, 8, 10, 13, 29}</code></li><li>取出根结点权值最小的两棵二叉树 ==&gt; <code>7, 8</code></li><li>组成一棵新的二叉树,根结点的权值是前面两棵二叉树的根结点权值的和 ==&gt; 即<code>7 + 8 = 15</code><br><img src="/images/2020/07/20200730017.png" alt></li><li>经过上一步,数列变成<code>{15, 10, 13, 29}</code>,排序后变成<code>{10, 13, 15, 29}</code></li><li>取出根结点权值最小的两棵二叉树 ==&gt; <code>10, 13</code></li><li>组成一棵新的二叉树,根结点的权值是前面两棵二叉树的根结点权值的和 ==&gt; 即<code>10 + 13 = 23</code><br><img src="/images/2020/07/20200730018.png" alt></li><li>经过上一步,数列变成<code>{23, 15, 29}</code>,排序后变成<code>{15, 23, 29}</code></li><li>取出根结点权值最小的两棵二叉树 ==&gt; <code>15, 23</code></li><li>组成一棵新的二叉树,根结点的权值是前面两棵二叉树的根结点权值的和 ==&gt; 即<code>15 + 23 = 38</code><br><img src="/images/2020/07/20200730019.png" alt></li><li>经过上一步,数列变成<code>{38, 29}</code>,排序后变成<code>{29, 38}</code></li><li>取出根结点权值最小的两棵二叉树 ==&gt; <code>29, 38</code></li><li>组成一棵新的二叉树,根结点的权值是前面两棵二叉树的根结点权值的和 ==&gt; 即<code>29 + 38 = 67</code><br><img src="/images/2020/07/20200730020.png" alt></li></ul><h1 id="实现上述赫夫曼树"><a href="#实现上述赫夫曼树" class="headerlink" title="实现上述赫夫曼树"></a>实现上述赫夫曼树</h1><ol><li><p>创建结点类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建结点类 </span></span><br><span class="line"><span class="comment"> * =&gt; 为了让 Node 对象持续排序 Collections 集合排序 </span></span><br><span class="line"><span class="comment"> * =&gt; 让 Node 实现 Comparable 接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Node</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> value; <span class="comment">// 结点权值</span></span><br><span class="line">    Node left; <span class="comment">// 指向左子结点</span></span><br><span class="line">    Node right; <span class="comment">// 指向右子结点</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前序遍历自身的子树</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.left.preOrder();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.right.preOrder();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Node [value="</span> + value + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Node o)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 表示从小到大排序</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value - o.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>实现赫夫曼树</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HuffmanTree</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> arr[] = &#123; <span class="number">13</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">29</span>, <span class="number">6</span>, <span class="number">1</span> &#125;;</span><br><span class="line">        Node root = createHuffmanTree(arr);</span><br><span class="line">        root.preOrder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一棵赫夫曼树</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int[] arr  要创建的数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回赫夫曼树的根结点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title">createHuffmanTree</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 第一步为了操作方便</span></span><br><span class="line">        <span class="comment">// 1. 遍历 arr 数组</span></span><br><span class="line">        <span class="comment">// 2. 将 arr 的每个元素构成成一个 Node</span></span><br><span class="line">        <span class="comment">// 3. 将 Node 放入到 ArrayList 中</span></span><br><span class="line">        List&lt;Node&gt; nodes = <span class="keyword">new</span> ArrayList&lt;Node&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> value : arr) &#123;</span><br><span class="line">            Node node = <span class="keyword">new</span> Node(value);</span><br><span class="line">            nodes.add(node);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 构成赫夫曼树的步骤</span></span><br><span class="line">        <span class="comment">// =&gt; 从小到大进行排序, 将每一个数据，每个数据都是一个节点，每个节点可以看成是一颗最简单的二叉树</span></span><br><span class="line">        <span class="comment">// =&gt; 取出根节点权值最小的两颗二叉树</span></span><br><span class="line">        <span class="comment">// =&gt; 组成一颗新的二叉树, 该新的二叉树的根节点的权值是前面两颗二叉树根节点权值的和</span></span><br><span class="line">        <span class="comment">// =&gt; 再将这颗新的二叉树， 以根节点的权值大小再次排序， 不断重复 1-2-3-4 的步骤，直到数列中，所有的数据都被处理，就得到一颗赫夫曼树</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (nodes.size() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// (0) 从小到大进行排序</span></span><br><span class="line">            Collections.sort(nodes);    </span><br><span class="line">            <span class="comment">// (1) 取出权值最小的结点（二叉树）</span></span><br><span class="line">            Node leftNode = nodes.get(<span class="number">0</span>);   <span class="comment">// 取出根节点权值最小的两颗二叉树</span></span><br><span class="line">            <span class="comment">// (2) 取出权值第二小的结点（二叉树）</span></span><br><span class="line">            Node rightNode = nodes.get(<span class="number">1</span>);</span><br><span class="line">            <span class="comment">// (3) 构建一颗新的二叉树</span></span><br><span class="line">            Node parentNode = <span class="keyword">new</span> Node(leftNode.value + rightNode.value);</span><br><span class="line">            parentNode.left = leftNode;</span><br><span class="line">            parentNode.right = rightNode;</span><br><span class="line">            <span class="comment">// (4) 从 ArrayList 删除处理过的二叉树</span></span><br><span class="line">            nodes.remove(leftNode);</span><br><span class="line">            nodes.remove(rightNode);</span><br><span class="line">            <span class="comment">// (5) 将 parent 加入到 nodes</span></span><br><span class="line">            nodes.add(parentNode);</span><br><span class="line">            <span class="comment">// (0) 从小到大进行排序</span></span><br><span class="line">            <span class="comment">// ... 循环</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回赫夫曼树的根结点</span></span><br><span class="line">        <span class="keyword">return</span> nodes.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>堆的基本介绍与堆排序的Java实现</title>
      <link href="/2020/05/03/%E5%A0%86%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%A0%86%E6%8E%92%E5%BA%8F%E7%9A%84Java%E5%AE%9E%E7%8E%B0/"/>
      <url>/2020/05/03/%E5%A0%86%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%A0%86%E6%8E%92%E5%BA%8F%E7%9A%84Java%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://juejin.im/post/5f19b8875188252e382a6e16#heading-2" target="_blank" rel="noopener">什么是堆？看这一篇就够了！</a></p><h1 id="堆的基本介绍"><a href="#堆的基本介绍" class="headerlink" title="堆的基本介绍"></a>堆的基本介绍</h1><ul><li><p>堆是一颗完全二叉树</p><ul><li>每个结点的值都大于或等于其左右孩子结点的值，称为大顶堆, 注意 : 没有要求结点的左孩子的值和右孩子的值的大小关系。</li><li>每个结点的值都小于或等于其左右孩子结点的值，称为小顶堆</li></ul></li><li><p>从堆的特点可知，下图中，1，2 是大顶堆，3 是小顶堆， 4 不是堆（不是完全二叉树）<br><img src="/images/2020/07/20200730001.png" alt></p></li></ul><h1 id="插入堆元素"><a href="#插入堆元素" class="headerlink" title="插入堆元素"></a>插入堆元素</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入一个元素时，将其插入堆的尾部，让后向上冒泡</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapInsert</span><span class="params">(<span class="keyword">int</span>[] arr,<span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (index!=<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> parent=(index-<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (arr[parent]&lt;arr[index])</span><br><span class="line">            swap(arr,index,parent);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        index=parent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="堆化"><a href="#堆化" class="headerlink" title="堆化"></a>堆化</h1><p>往堆中插入元素后（如下图示），我们需要继续满足堆的特性，所以需要不断调整元素的位置直到满足堆的特点为止（堆中节点的值都大于等于（或小于等于）其子节点的值）,我们把这种调整元素以让其满足堆特点的过程称为堆化（heapify）,<strong>建堆的时间复杂度：O(n)</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Heap</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] arr;       <span class="comment">// 堆是完全二叉树，底层用数组存储</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> capacity;    <span class="comment">// 堆中能存储的最大元素数量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;          <span class="comment">// 当前堆中元素数量</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Heap</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</span><br><span class="line">        capacity = count;</span><br><span class="line">        arr = <span class="keyword">new</span> <span class="keyword">int</span>[capacity+<span class="number">1</span>];</span><br><span class="line">        n = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &gt;= capacity) &#123;</span><br><span class="line">            <span class="comment">// 超过堆大小了，不能再插入元素</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        n++;</span><br><span class="line">        <span class="comment">// 先将元素插入到队尾中</span></span><br><span class="line">        arr[n] = value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> i = n;</span><br><span class="line">        <span class="comment">// 由于我们构建的是一个大顶堆，所以需要不断调整以让其满足大顶堆的条件</span></span><br><span class="line">        <span class="keyword">while</span> (i/<span class="number">2</span> &gt; <span class="number">0</span> &amp;&amp; arr[i] &gt; arr[i/<span class="number">2</span>]) &#123;</span><br><span class="line">            swap(arr, i, i/<span class="number">2</span>);</span><br><span class="line">            i = i / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="删除堆元素"><a href="#删除堆元素" class="headerlink" title="删除堆元素"></a>删除堆元素</h1><h2 id="删除堆元素会遇到数组空洞问题"><a href="#删除堆元素会遇到数组空洞问题" class="headerlink" title="删除堆元素会遇到数组空洞问题"></a>删除堆元素会遇到数组空洞问题</h2><p>假设我们要操作的堆是大顶堆，则删除堆顶元素后，要找到原堆中第二大的元素以填补堆顶元素，而第二大的元素无疑是在根节点的左右子节点上，假设是左节点，则用左节点填补堆顶元素之后，左节点空了，此时需要从左节点的左右节点中找到两者的较大值填补左节点…，不断迭代此过程，直到调整完毕，调整过程如下图示：<br><img src="/images/2020/07/20200730002.png" alt><br>如上图所示，在最终调整后的堆中，出现了数组空洞，对应的数组如下<br><img src="/images/2020/07/20200730003.png" alt></p><h2 id="如何解决数组空洞问题"><a href="#如何解决数组空洞问题" class="headerlink" title="如何解决数组空洞问题"></a>如何解决数组空洞问题</h2><p>我们可以用最后一个元素覆盖堆顶元素，然后再自上而下地调整堆，让其满足大顶堆的要求，这样即可解决数组空洞的问题。<br><img src="/images/2020/07/20200731001.png" alt></p><h2 id="删除堆元素的代码实现"><a href="#删除堆元素的代码实现" class="headerlink" title="删除堆元素的代码实现"></a>删除堆元素的代码实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 移除堆顶元素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeTopElement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 堆中如果没有元素，也就是不存在移除堆顶元素的情况了</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> count = n;</span><br><span class="line">    arr[<span class="number">1</span>] = arr[count];</span><br><span class="line">    --count;</span><br><span class="line">    heapify(<span class="number">1</span>, count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自上而下堆化以满足大顶堆的条件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">heapify</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> maxValueIndex = index;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">2</span> * index &lt;= n &amp;&amp; arr[index] &lt; arr[<span class="number">2</span> * index]) &#123;</span><br><span class="line">            <span class="comment">// 左节点比其父节点大</span></span><br><span class="line">            maxValueIndex = <span class="number">2</span> * index;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">2</span> * index + <span class="number">1</span> &lt;= n &amp;&amp; arr[maxValueIndex] &lt; arr[<span class="number">2</span> * index + <span class="number">1</span>]) &#123;</span><br><span class="line">            <span class="comment">// 右节点比左节点或父节点大</span></span><br><span class="line">            maxValueIndex = <span class="number">2</span> * index + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (maxValueIndex == index) &#123;</span><br><span class="line">            <span class="comment">// 说明当前节点值为最大值，无需再往下迭代了</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(arr, index, maxValueIndex);</span><br><span class="line">        index = maxValueIndex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 交换数组第 i 和第 j 个元素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = arr[i];</span><br><span class="line">    arr[i] = arr[j];</span><br><span class="line">    arr[j] = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="删除堆元素的时间复杂度"><a href="#删除堆元素的时间复杂度" class="headerlink" title="删除堆元素的时间复杂度"></a>删除堆元素的时间复杂度</h2><p>时间复杂度和插入堆中元素一样，也是树的高度，所以为 O(logn)。</p><h1 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h1><ul><li>堆排序是利用堆这种数据结构而设计的一种排序算法，堆排序是一种选择排序，它的最坏，最好，平均时间复杂度均为 O(nlogn)，它也是不稳定排序。</li></ul><h2 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h2><ol><li>将无序序列构建成一个堆，根据升序降序需求选择大顶堆或小顶堆;</li><li>将堆顶元素与末尾元素交换，将最大元素”沉”到数组末端;</li><li>重新调整结构，使其满足堆定义，然后继续交换堆顶元素与当前末尾元素，反复执行调整+交换步骤，直到整个序列有序</li></ol><h2 id="图解"><a href="#图解" class="headerlink" title="图解"></a>图解</h2><p><strong>步骤一</strong>:构造初始堆。将给定无序序列构造成一个大顶堆（一般升序采用大顶堆，降序采用小顶堆)。原始的数组 [4, 6, 8, 5, 9]</p><ol><li>假设给定无序序列结构如下<br><img src="/images/2020/07/20200730004.png" alt></li><li>此时我们从最后一个非叶子结点开始（叶结点自然不用调整，最后一个非叶子结点arr.length/2-1=5/2-1=1，也就是下面的 6 结点），从左至右，从下至上进行调整<br><img src="/images/2020/07/20200730005.png" alt></li><li>找到第二个非叶节点 4，由于[4,9,8]中 9 元素最大，4 和 9 交换<br><img src="/images/2020/07/20200730006.png" alt></li><li>这时，交换导致了子根[4,5,6]结构混乱，继续调整，[4,5,6]中 6 最大，交换 4 和 6<br><img src="/images/2020/07/20200730007.png" alt></li><li>此时，我们就将一个无序序列构造成了一个大顶堆</li></ol><p><strong>步骤二</strong>:将堆顶元素与末尾元素进行交换，使末尾元素最大。然后继续调整堆，再将堆顶元素与末尾元素交换，得到第二大元素。如此反复进行交换、重建、交换。</p><ol><li>将堆顶元素 9 和末尾元素 4 进行交换<br><img src="/images/2020/07/20200730008.png" alt></li><li>重新调整结构，使其继续满足堆定义<br><img src="/images/2020/07/20200730009.png" alt></li><li>再将堆顶元素 8 与末尾元素 5 进行交换，得到第二大元素 8<br><img src="/images/2020/07/20200730010.png" alt></li><li>后续过程，继续进行调整，交换，如此反复进行，最终使得整个序列有序<br><img src="/images/2020/07/20200730011.png" alt></li></ol><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="方式一-使用递归实现"><a href="#方式一-使用递归实现" class="headerlink" title="方式一:使用递归实现"></a>方式一:使用递归实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapSort</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] arr;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HeapSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.arr = arr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 堆排序的主要入口方法，共两步。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 第一步：将数组堆化</span></span><br><span class="line">        <span class="comment">// 从最后一个分支结点(非叶子结点)开始</span></span><br><span class="line">        <span class="comment">// beginIndex = (arr.length / 2)- 1</span></span><br><span class="line">        <span class="comment">// 叶子节点可以看作已符合堆要求的节点，根节点就是它自己且自己以下值为最大。</span></span><br><span class="line">        <span class="keyword">int</span> len = arr.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> beginIndex = (arr.length &gt;&gt; <span class="number">1</span>) - <span class="number">1</span>; <span class="comment">// ==&gt; (arr.length / 2)- 1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = beginIndex; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            maxHeapify(i, len);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 第二步：对堆化数据排序</span></span><br><span class="line">        <span class="comment">// 每次都是移出最顶层的根节点A[0]，与最尾部节点位置调换，同时遍历长度 - 1</span></span><br><span class="line">        <span class="comment">// 然后从新整理被换到根节点的末尾元素，使其符合堆的特性</span></span><br><span class="line">        <span class="comment">// 直至未排序的堆长度为 0</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = len; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">            swap(<span class="number">0</span>, i);</span><br><span class="line">            maxHeapify(<span class="number">0</span>, i - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 调整索引为 index 处的数据，使其符合堆的特性。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 需要堆化处理的数据的索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> len   未排序的堆（数组）的长度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">maxHeapify</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> li = (index &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>; <span class="comment">// 左子节点索引 ==&gt; (index * 2) + 1</span></span><br><span class="line">        <span class="keyword">int</span> ri = li + <span class="number">1</span>; <span class="comment">// 右子节点索引</span></span><br><span class="line">        <span class="keyword">int</span> cMax = li; <span class="comment">// 假设树的最大值的索引为左子节点</span></span><br><span class="line">        <span class="keyword">if</span> (li &gt; len) &#123; <span class="comment">// 左子节点索引超出计算范围，直接返回。</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ri &lt;= len &amp;&amp; arr[ri] &gt; arr[li]) &#123; <span class="comment">// 先判断右子结点是否大于左子结点</span></span><br><span class="line">            cMax = ri;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (arr[cMax] &gt; arr[index]) &#123; <span class="comment">// 在判断左右子结点的最大值是否大于父结点</span></span><br><span class="line">            swap(cMax, index); <span class="comment">// 如果父节点被子节点调换，</span></span><br><span class="line">            maxHeapify(cMax, len); <span class="comment">// 则需要继续判断换下后的父节点是否符合堆的特性。</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> temp = arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试用例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123; <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span> &#125;;</span><br><span class="line">        <span class="keyword">new</span> HeapSort(arr).sort();</span><br><span class="line">        System.out.println(Arrays.toString(arr));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方式二-使用循环实现"><a href="#方式二-使用循环实现" class="headerlink" title="方式二:使用循环实现"></a>方式二:使用循环实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapSort2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"堆排序!!"</span>);</span><br><span class="line">        <span class="keyword">int</span> arr[] = &#123; <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">1</span> &#125;;</span><br><span class="line">        <span class="comment">// 将无序序列构建成一个堆， 根据升序降序需求选择大顶堆或小顶堆</span></span><br><span class="line">        <span class="comment">// 这里构建大顶堆</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = arr.length / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            adjustHeap(arr, i, arr.length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 将堆顶元素与末尾元素交换， 将最大元素"沉"到数组末端;</span></span><br><span class="line">        <span class="comment">// 2. 排除数组末尾已经排序的数,对剩余的数构建一个大顶堆</span></span><br><span class="line">        <span class="comment">// 3. 然后继续交换堆顶元素与当前末尾元素</span></span><br><span class="line">        <span class="comment">// 4. 反复执行调整+交换步骤， 直到整个序列有序</span></span><br><span class="line">        <span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = arr.length - <span class="number">1</span>; j &gt; <span class="number">0</span>; j--) &#123;</span><br><span class="line">            <span class="comment">//将堆顶元素与末尾元素交换， 将最大元素"沉"到数组末端;</span></span><br><span class="line">            temp = arr[j];</span><br><span class="line">            arr[j] = arr[<span class="number">0</span>];</span><br><span class="line">            arr[<span class="number">0</span>] = temp;</span><br><span class="line">            <span class="comment">// 排除数组末尾已经排序的数,对剩余的数构建一个大顶堆</span></span><br><span class="line">            adjustHeap(arr, <span class="number">0</span>, j);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"数组="</span> + Arrays.toString(arr));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将一个二叉树(数组),调整成一个大顶堆 ==&gt; 将以i为父结点的树调整为大顶堆</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arr    待调整的数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> i      表示非叶子结点在数组中的索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 表示对多少个元素继续调整,length是在逐渐减少</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">adjustHeap</span><span class="params">(<span class="keyword">int</span> arr[], <span class="keyword">int</span> i, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> temp = arr[i]; <span class="comment">// 先取出当前元素的值,保存在临时变量</span></span><br><span class="line">        <span class="comment">// 开始调整</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = i * <span class="number">2</span> + <span class="number">1</span>; k &lt; length; k = k * <span class="number">2</span> + <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 比较左子结点与右子结点哪个大</span></span><br><span class="line">            <span class="keyword">if</span> (k + <span class="number">1</span> &lt; length &amp;&amp; arr[k] &lt; arr[k + <span class="number">1</span>]) &#123; <span class="comment">// 说明左子结点的值小于右子结点的值</span></span><br><span class="line">                k++; <span class="comment">// 将k指向右子结点</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 比较左右子结点中较大的数与父结点中的数哪个大</span></span><br><span class="line">            <span class="keyword">if</span> (arr[k] &gt; temp) &#123;</span><br><span class="line">                arr[i] = arr[k]; <span class="comment">// 左右子结点中较大的数与父结点的数进行交换</span></span><br><span class="line">                <span class="comment">// 将k赋值给i是为了下一轮for循环中,i指向左右结点中被替换的那一个</span></span><br><span class="line">                <span class="comment">// 而k在下一轮for循环中,指向i所指向结点的左子结点</span></span><br><span class="line">                i = k;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当for循环结束后,我们已经将i为父结点的树的最大值,放在了最顶</span></span><br><span class="line">        arr[i] = temp; <span class="comment">// 将temp值放到调整后的位置</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现线索化二叉树与线索化二叉树的遍历</title>
      <link href="/2020/05/03/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%B4%A2%E5%8C%96%E4%BA%8C%E5%8F%89%E6%A0%91%E4%B8%8E%E7%BA%BF%E7%B4%A2%E5%8C%96%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86/"/>
      <url>/2020/05/03/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E7%BA%BF%E7%B4%A2%E5%8C%96%E4%BA%8C%E5%8F%89%E6%A0%91%E4%B8%8E%E7%BA%BF%E7%B4%A2%E5%8C%96%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是二叉树线索化"><a href="#什么是二叉树线索化" class="headerlink" title="什么是二叉树线索化"></a>什么是二叉树线索化</h1><ul><li>线索化的实质就是将二叉链表中的空指针改为指向前驱或后继的线索。</li><li>由于前驱和后继信息只有在遍历该二叉树时才能得到，所以，线索化的过程就是在遍历的过程中修改空指针的过程</li></ul><h1 id="为什么要对二叉树线索化"><a href="#为什么要对二叉树线索化" class="headerlink" title="为什么要对二叉树线索化"></a>为什么要对二叉树线索化</h1><ul><li>二叉树是一种非线性结构，遍历二叉树几乎都是通过递归或者用栈辅助实现非递归的遍历。</li><li>用二叉树作为存储结构时，取到一个节点，只能获取节点的左孩子和右孩子，不能直接得到节点的任一遍历序列的前驱或者后继。</li><li>为了保存这种在遍历中需要的信息，我们利用二叉树中指向左右子树的空指针来存放节点的前驱和后继信息</li></ul><h1 id="线索二叉树基本介绍"><a href="#线索二叉树基本介绍" class="headerlink" title="线索二叉树基本介绍"></a>线索二叉树基本介绍</h1><ol><li>n 个结点的二叉链表中含有 <code>n+1</code>个空指针域。利用二叉链表中的空指针域，存放指向该结点在某种遍历次序下的前驱和后继结点的指针（这种附加的指针称为”线索”）<ul><li>n+1 ==&gt;【公式 <code>2n-(n-1)=n+1</code> ==&gt; 总共n个节点,所以有2n个指针,除了第一个节点,其余每个节点需要占用一个指针,所以是(n-1)】  </li></ul></li><li>这种加上了线索的二叉链表称为线索链表，相应的二叉树称为线索二叉树(Threaded BinaryTree)。根据线索性质的不同，线索二叉树可分为前序线索二叉树、中序线索二叉树和后序线索二叉树三种</li><li>一个结点的前一个结点，称为前驱结点</li><li>一个结点的后一个结点，称为后继结点</li></ol><h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><p>应用案例说明：将下面的二叉树，进行中序线索二叉树。<br><img src="/images/2020/07/20200714055.png" alt><br>中序遍历的结果：{8, 3, 10, 1, 14, 6},所以3的前驱结点为8,后继结点为10,其余同理<br><img src="/images/2020/07/20200714054.png" alt></p><p>当然,当二叉树线索化后，Node 结点的 属性 left 和 right 就有有如下情况:</p><ol><li>left 有可能指向的是左子树，也有可能指向前驱节点.</li><li>right 有可能指向的是右子树，也有可能指向后继节点.</li></ol><h2 id="中序遍历的方式实现线索化二叉树"><a href="#中序遍历的方式实现线索化二叉树" class="headerlink" title="中序遍历的方式实现线索化二叉树"></a>中序遍历的方式实现线索化二叉树</h2><ol><li><p>英雄结点</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这里HeroNode2中的2没有任何意义</span></span><br><span class="line"><span class="comment"> * 纯粹是代码多了,又没实际意义,名字很难取</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroNode2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> no;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> HeroNode2 left; <span class="comment">// 默认null</span></span><br><span class="line">    <span class="keyword">private</span> HeroNode2 right;    <span class="comment">// 默认null</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 说明</span></span><br><span class="line">    <span class="comment">// 1. 如果leftType == 0 表示指向的是左子树,如果1则表示指向的是前驱结点</span></span><br><span class="line">    <span class="comment">// 2. 如果rightType == 0 表示指向的是右子树,如果1则表示指向的是后继结点</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> leftType;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> rightType;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HeroNode2</span><span class="params">(<span class="keyword">int</span> no, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.no = no;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"HeroNode[no=]"</span> + no + <span class="string">", name="</span> + name + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>二叉树线索化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义ThreadedBinaryTree实现了线索化功能的二叉树</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadedBinaryTree</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> HeroNode2 root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为了实现线索化,需要创建一个指针,指向当前结点的前驱结点</span></span><br><span class="line">    <span class="comment">// 在递归进行线索化时,pre总是保留前一个结点</span></span><br><span class="line">    <span class="keyword">private</span> HeroNode2 pre = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重载threadNodes方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">threadedNodes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.threadedNodes(root);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 编写对二叉树进行中序线索化的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">threadedNodes</span><span class="params">(HeroNode2 node)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 如果node==null,不能线索化</span></span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 先线索化左子树</span></span><br><span class="line">        threadedNodes(node.getLeft());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 线索化当前结点(重点)</span></span><br><span class="line">        <span class="comment">// 先处理当前结点的前驱结点</span></span><br><span class="line">        <span class="keyword">if</span> (node.getLeft() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 让当前结点的左指针指向前驱结点</span></span><br><span class="line">            node.setLeft(pre);</span><br><span class="line">            <span class="comment">// 修改当前结点的左指针的类型</span></span><br><span class="line">            node.setLeftType(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 处理后继结点</span></span><br><span class="line">        <span class="comment">// ==&gt; 处理当前结点的后继结点是前一结点的指针指向当前结点时才进行处理</span></span><br><span class="line">        <span class="comment">// ==&gt; 因为如果直接处理"node.getRight() == null"</span></span><br><span class="line">        <span class="comment">// ==&gt; 那么无法知道node.setRight(?)要填什么</span></span><br><span class="line">        <span class="keyword">if</span> (pre != <span class="keyword">null</span> &amp;&amp; pre.getRight() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 让前驱结点的右指针指向当前结点</span></span><br><span class="line">            pre.setRight(node);</span><br><span class="line">            <span class="comment">// 修改前驱结点的右指针类型</span></span><br><span class="line">            pre.setRightType(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// !!!每处理一个结点后,让当前结点是下一个结点的前驱结点</span></span><br><span class="line">        pre = node;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 再线索化右子树</span></span><br><span class="line">        threadedNodes(node.getRight());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadedBinaryTreeTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//测试一把中序线索二叉树的功能</span></span><br><span class="line">        HeroNode2 root = <span class="keyword">new</span> HeroNode2(<span class="number">1</span>, <span class="string">"tom"</span>);</span><br><span class="line">        HeroNode2 node2 = <span class="keyword">new</span> HeroNode2(<span class="number">3</span>, <span class="string">"jack"</span>);</span><br><span class="line">        HeroNode2 node3 = <span class="keyword">new</span> HeroNode2(<span class="number">6</span>, <span class="string">"smith"</span>);</span><br><span class="line">        HeroNode2 node4 = <span class="keyword">new</span> HeroNode2(<span class="number">8</span>, <span class="string">"mary"</span>);</span><br><span class="line">        HeroNode2 node5 = <span class="keyword">new</span> HeroNode2(<span class="number">10</span>, <span class="string">"king"</span>);</span><br><span class="line">        HeroNode2 node6 = <span class="keyword">new</span> HeroNode2(<span class="number">14</span>, <span class="string">"dim"</span>);</span><br><span class="line">        <span class="comment">//二叉树， 后面我们要递归创建, 现在简单处理使用手动创建</span></span><br><span class="line">        root.setLeft(node2);</span><br><span class="line">        root.setRight(node3);</span><br><span class="line">        node2.setLeft(node4);</span><br><span class="line">        node2.setRight(node5);</span><br><span class="line">        node3.setLeft(node6);</span><br><span class="line">        <span class="comment">//测试中序线索化</span></span><br><span class="line">        ThreadedBinaryTree threadedBinaryTree = <span class="keyword">new</span> ThreadedBinaryTree();</span><br><span class="line">        threadedBinaryTree.setRoot(root);</span><br><span class="line">        threadedBinaryTree.threadedNodes();</span><br><span class="line">        <span class="comment">//测试: 以 10 号节点测试</span></span><br><span class="line">        HeroNode2 leftNode = node5.getLeft();</span><br><span class="line">        HeroNode2 rightNode = node5.getRight();</span><br><span class="line">        System.out.println(<span class="string">"10 号结点的前驱结点是 ="</span> + leftNode); <span class="comment">//3</span></span><br><span class="line">        System.out.println(<span class="string">"10 号结点的后继结点是="</span> + rightNode); <span class="comment">//1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="线索化二叉树的中序遍历"><a href="#线索化二叉树的中序遍历" class="headerlink" title="线索化二叉树的中序遍历"></a>线索化二叉树的中序遍历</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ul><li>说明： 对前面的中序线索化的二叉树， 进行遍历</li><li>分析： 因为线索化后，各个结点指向有变化，因此原来的遍历方式不能使用，这时需要使用新的方式遍历线索化二叉树，各个节点<strong>可以通过线型方式遍历，因此无需使用递归方式</strong>，这样也提高了遍历的效率。遍历的次序应当和中序遍历保持一致。</li></ul><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><ol><li><p>英雄结点 ==&gt; 和前面相同</p></li><li><p>遍历线索化二叉树 ==&gt; 看threadedList()函数,其余和前面一样</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义ThreadedBinaryTree实现了线索化功能的二叉树</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadedBinaryTree</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> HeroNode2 root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为了实现线索化,需要创建一个指针,指向当前结点的前驱结点</span></span><br><span class="line">    <span class="comment">// 在递归进行线索化时,pre总是保留前一个结点</span></span><br><span class="line">    <span class="keyword">private</span> HeroNode2 pre = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重载threadNodes方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">threadedNodes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.threadedNodes(root);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 编写对二叉树进行中序线索化的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">threadedNodes</span><span class="params">(HeroNode2 node)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 如果node==null,不能线索化</span></span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 先线索化左子树</span></span><br><span class="line">        threadedNodes(node.getLeft());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 线索化当前结点(重点)</span></span><br><span class="line">        <span class="comment">// 先处理当前结点的前驱结点</span></span><br><span class="line">        <span class="keyword">if</span> (node.getLeft() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 让当前结点的左指针指向前驱结点</span></span><br><span class="line">            node.setLeft(pre);</span><br><span class="line">            <span class="comment">// 修改当前结点的左指针的类型</span></span><br><span class="line">            node.setLeftType(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 处理后继结点</span></span><br><span class="line">        <span class="comment">// ==&gt; 处理当前结点的后继结点是前一结点的指针指向当前结点时才进行处理</span></span><br><span class="line">        <span class="comment">// ==&gt; 因为如果直接处理"node.getRight() == null",那么无法知道node.setRight(?)要填什么</span></span><br><span class="line">        <span class="keyword">if</span> (pre != <span class="keyword">null</span> &amp;&amp; pre.getRight() == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 让前驱结点的右指针指向当前结点</span></span><br><span class="line">            pre.setRight(node);</span><br><span class="line">            <span class="comment">// 修改前驱结点的右指针类型</span></span><br><span class="line">            pre.setRightType(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// !!!每处理一个结点后,让当前结点是下一个结点的前驱结点</span></span><br><span class="line">        pre = node;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 再线索化右子树</span></span><br><span class="line">        threadedNodes(node.getRight());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *   中序遍历线索化二叉树</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">threadedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 定义一个变量,存储当前遍历的结点,从root开始</span></span><br><span class="line">        HeroNode2 node = root;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 说明</span></span><br><span class="line">        <span class="comment">// 1. 如果leftType == 0 表示指向的是左子树,如果1则表示指向的是前驱结点</span></span><br><span class="line">        <span class="comment">// 2. 如果rightType == 0 表示指向的是右子树,如果1则表示指向的是后继结点</span></span><br><span class="line">        <span class="keyword">while</span> (node != <span class="keyword">null</span>) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 1. 找到起始结点</span></span><br><span class="line">            <span class="comment">// ==&gt; 有左子树,则向左边寻找</span></span><br><span class="line">            <span class="keyword">while</span>(node.getLeftType() == <span class="number">0</span>) &#123;</span><br><span class="line">                node = node.getLeft();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ==&gt; 打印起始结点</span></span><br><span class="line">            System.out.println(node);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. 判断是否有后继结点</span></span><br><span class="line">            <span class="comment">// ==&gt; 2.1 有后继结点则一直输出</span></span><br><span class="line">            <span class="keyword">while</span>(node.getRightType() == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// 获取到当前结点的后继结点并打印</span></span><br><span class="line">                node = node.getRight();</span><br><span class="line">                System.out.println(node);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ==&gt; 2.2 无后继结点表示线索断了</span></span><br><span class="line">            <span class="comment">// ==&gt; 但我们观察可以发现,每当线索断了,对于中序遍历,都是右子树还没遍历</span></span><br><span class="line">            <span class="comment">// ==&gt; 那么,我们将当前结点替换成右子结点进行上述相同的操作</span></span><br><span class="line">            <span class="comment">// ==&gt; ==&gt; 找到起始结点</span></span><br><span class="line">            <span class="comment">// ==&gt; ==&gt; 顺着线索(后继结点)摸下去</span></span><br><span class="line">            <span class="comment">// ==&gt; 这样就能将线索接起来</span></span><br><span class="line">            node = node.getRight();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadedBinaryTreeTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//测试一把中序线索二叉树的功能</span></span><br><span class="line">        HeroNode2 root = <span class="keyword">new</span> HeroNode2(<span class="number">1</span>, <span class="string">"tom"</span>);</span><br><span class="line">        HeroNode2 node2 = <span class="keyword">new</span> HeroNode2(<span class="number">3</span>, <span class="string">"jack"</span>);</span><br><span class="line">        HeroNode2 node3 = <span class="keyword">new</span> HeroNode2(<span class="number">6</span>, <span class="string">"smith"</span>);</span><br><span class="line">        HeroNode2 node4 = <span class="keyword">new</span> HeroNode2(<span class="number">8</span>, <span class="string">"mary"</span>);</span><br><span class="line">        HeroNode2 node5 = <span class="keyword">new</span> HeroNode2(<span class="number">10</span>, <span class="string">"king"</span>);</span><br><span class="line">        HeroNode2 node6 = <span class="keyword">new</span> HeroNode2(<span class="number">14</span>, <span class="string">"dim"</span>);</span><br><span class="line">        <span class="comment">//二叉树， 后面我们要递归创建, 现在简单处理使用手动创建</span></span><br><span class="line">        root.setLeft(node2);</span><br><span class="line">        root.setRight(node3);</span><br><span class="line">        node2.setLeft(node4);</span><br><span class="line">        node2.setRight(node5);</span><br><span class="line">        node3.setLeft(node6);</span><br><span class="line">        <span class="comment">//测试中序线索化</span></span><br><span class="line">        ThreadedBinaryTree threadedBinaryTree = <span class="keyword">new</span> ThreadedBinaryTree();</span><br><span class="line">        threadedBinaryTree.setRoot(root);</span><br><span class="line">        threadedBinaryTree.threadedNodes();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//测试: 以 10 号节点测试</span></span><br><span class="line"><span class="comment">//      HeroNode2 leftNode = node5.getLeft();</span></span><br><span class="line"><span class="comment">//      HeroNode2 rightNode = node5.getRight();</span></span><br><span class="line"><span class="comment">//      System.out.println("10 号结点的前驱结点是 =" + leftNode); //3</span></span><br><span class="line"><span class="comment">//      System.out.println("10 号结点的后继结点是=" + rightNode); //1</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试遍历</span></span><br><span class="line">        threadedBinaryTree.threadedList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现顺序存储二叉树</title>
      <link href="/2020/05/03/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%A1%BA%E5%BA%8F%E5%AD%98%E5%82%A8%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
      <url>/2020/05/03/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%A1%BA%E5%BA%8F%E5%AD%98%E5%82%A8%E4%BA%8C%E5%8F%89%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<h1 id="基本说明"><a href="#基本说明" class="headerlink" title="基本说明"></a>基本说明</h1><ul><li>二叉树的顺序存储，就是用一组连续的存储单元存放二叉树中的结点</li><li>从数据存储上看,数据存储方式和树的存储方式可以相互转换,即<strong>数组可以转换成树,树也可以转换成数组</strong></li></ul><h1 id="存储方式"><a href="#存储方式" class="headerlink" title="存储方式"></a>存储方式</h1><p>用编号的方法从树根起，自上层至下层，每层自左至右地给所有结点编号</p><h2 id="好用在哪"><a href="#好用在哪" class="headerlink" title="好用在哪"></a>好用在哪</h2><p>完全二叉树和满二叉树采用顺序存储比较合适, 树中结点的序号可以唯一地反映出结点之间的逻辑关系，这样既能够最大可能地节省存储空间，又可以利用数组元素的下标值确定结点在二叉树中的位置，以及结点之间的关系<br><img src="/images/2020/05/20200502001.png" alt></p><h2 id="不好用在哪"><a href="#不好用在哪" class="headerlink" title="不好用在哪"></a>不好用在哪</h2><p>对于一般的二叉树，如果仍按从上至下和从左到右的顺序将树中的结点顺序存储在一维数组中，则数组元素下标之间的关系不能够反映二叉树中结点之间的逻辑关系,只有增添一些并不存在的空结点，使之成为一棵完全二叉树的形式，然后再用一维数组顺序存储,这种存储对于需增加许多空结点才能将一棵二叉树改造成为一棵完全二叉树的存储时，会造成空间的大量浪费<br><img src="/images/2020/07/20200729003.png" alt><br><img src="/images/2020/07/20200729004.png" alt></p><h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol><li>现有一数组为<code>arr:[1, 2, 3, 4, 5, 6]</code></li><li>将这个数组看成一个顺序存储的二叉树,对这个二叉树以前序遍历,中序遍历,后序遍历的方式完成结点的遍历</li></ol><h2 id="前序中序后序遍历的区别"><a href="#前序中序后序遍历的区别" class="headerlink" title="前序中序后序遍历的区别"></a>前序中序后序遍历的区别</h2><ul><li>前序遍历:先输出父结点,再遍历左子树和右子树</li><li>中序遍历:先遍历左子树,再输出父结点,再遍历右子树</li><li>后序遍历:先遍历左子树,再遍历右子树,最后输出父结点<br>小结:看输出父结点的顺序,就确定前序,中序还是后序</li></ul><h2 id="顺序存储二叉树的特点"><a href="#顺序存储二叉树的特点" class="headerlink" title="顺序存储二叉树的特点"></a>顺序存储二叉树的特点</h2><ol><li>顺序二叉树通常只考虑完全二叉树</li><li>第n个元素的左子结点<code>2*n + 1</code></li><li>第n个元素的右子结点<code>2*n + 2</code></li><li>第n个元素的父结点为<code>(n - 1) / 2</code></li><li><code>n</code>表示二叉树的第n个元素(按0开始编号)</li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 需求:给你一个数组&#123;1,2,3,4,5,6,7&#125;,要求以二叉树前序遍历的方式进行道历。前序遍历的结果应当为1,2,4,5,3,6,7</span></span><br><span class="line"><span class="comment"> * 1)顺序存储通常只考虑完全二叉树</span></span><br><span class="line"><span class="comment"> * 2)第n个元素的左子节点为2*n+1</span></span><br><span class="line"><span class="comment"> * 3)第n个元素的右子节点为2*n+2</span></span><br><span class="line"><span class="comment"> * 4)第n个元素的父节点为(n-1)12</span></span><br><span class="line"><span class="comment"> * 5)n:表示二叉树中的第几个元素(按0开始编号如图所示)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrBinaryTree</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] arr;<span class="comment">//存储数据节点的数组</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrBinaryTree</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.arr = arr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 重载前序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.preOrder(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 重载中序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.inOrder(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 重载后序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.postOrder(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编写一个方法,完成顺序存储二叉树的前序遍历</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index 数组的下标</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 如果数组为空,或者arr.length=0</span></span><br><span class="line"><span class="keyword">if</span> (arr == <span class="keyword">null</span> || arr.length == <span class="number">0</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"数组为空,不能进行二叉树的前序遍历"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出当前这个元素</span></span><br><span class="line">System.out.println(arr[index]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向左递归遍历</span></span><br><span class="line"><span class="keyword">if</span> (index * <span class="number">2</span> + <span class="number">1</span> &lt; arr.length) &#123;</span><br><span class="line"><span class="keyword">this</span>.preOrder(<span class="number">2</span>*index + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 向右递归遍历</span></span><br><span class="line"><span class="keyword">if</span> (index * <span class="number">2</span> + <span class="number">2</span> &lt; arr.length) &#123;</span><br><span class="line"><span class="keyword">this</span>.preOrder(<span class="number">2</span>*index + <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编写一个方法,完成顺序存储二叉树的中序遍历</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index 数组的下标</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inOrder</span> <span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 如果数组为空,或者arr.length=0</span></span><br><span class="line"><span class="keyword">if</span> (arr == <span class="keyword">null</span> || arr.length == <span class="number">0</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"数组为空,不能进行二叉树的中序遍历"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历左子树</span></span><br><span class="line"><span class="keyword">if</span> (index * <span class="number">2</span> + <span class="number">1</span> &lt; arr.length) &#123;</span><br><span class="line"><span class="keyword">this</span>.inOrder(<span class="number">2</span> * index + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(arr[index]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历右子树</span></span><br><span class="line"><span class="keyword">if</span> (index * <span class="number">2</span> + <span class="number">2</span> &lt; arr.length) &#123;</span><br><span class="line"><span class="keyword">this</span>.inOrder(<span class="number">2</span> * index + <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 编写一个方法,完成顺序存储二叉树的后序遍历</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index 数组的下标</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 如果数组为空,或者arr.length=0</span></span><br><span class="line"><span class="keyword">if</span> (arr == <span class="keyword">null</span> || arr.length == <span class="number">0</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"数组为空,不能进行二叉树的中序遍历"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历左子树</span></span><br><span class="line"><span class="keyword">if</span> (index * <span class="number">2</span> + <span class="number">1</span> &lt; arr.length) &#123;</span><br><span class="line"><span class="keyword">this</span>.postOrder(index * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 遍历右子树</span></span><br><span class="line"><span class="keyword">if</span> (index * <span class="number">2</span> + <span class="number">2</span> &lt; arr.length) &#123;</span><br><span class="line"><span class="keyword">this</span>.postOrder(index * <span class="number">2</span> + <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(arr[index]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrBinaryTreeTest</span> </span>&#123;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span>[] arr = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>&#125;;</span><br><span class="line">ArrBinaryTree arrBinaryTree = <span class="keyword">new</span> ArrBinaryTree(arr);</span><br><span class="line">System.out.println(<span class="string">"====前序遍历===="</span>);</span><br><span class="line">arrBinaryTree.preOrder();</span><br><span class="line">System.out.println(<span class="string">"====中序遍历===="</span>);</span><br><span class="line">arrBinaryTree.inOrder();</span><br><span class="line">System.out.println(<span class="string">"====后序遍历===="</span>);</span><br><span class="line">arrBinaryTree.postOrder();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://blog.csdn.net/zycxnanwang/article/details/52644280" target="_blank" rel="noopener">顺序存储二叉树</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装流程图工具Dia</title>
      <link href="/2020/04/29/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B%E5%9B%BE%E5%B7%A5%E5%85%B7Dia/"/>
      <url>/2020/04/29/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B%E5%9B%BE%E5%B7%A5%E5%85%B7Dia/</url>
      
        <content type="html"><![CDATA[<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.cnblogs.com/yibeimingyue/p/11843963.html" target="_blank" rel="noopener">ubuntu安装dia</a><br><a href="https://www.jianshu.com/p/9a7d736126d1" target="_blank" rel="noopener">完美解决Dia无法输入中文的问题</a><br><a href="https://jlice.top/p/7k91v/" target="_blank" rel="noopener">解决Dia在Linux上的输入法问题</a></p><h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><p>跨平台流程工具Dia。</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ol><li><p>打开终端(快捷键：ctrl+alt+t)</p></li><li><p>输入命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install dia</span><br></pre></td></tr></table></figure></li><li><p>输入<code>y</code>，等待，安装完成。</p></li></ol><h1 id="卸载此工具："><a href="#卸载此工具：" class="headerlink" title="卸载此工具："></a>卸载此工具：</h1><ol><li><p>输入命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get autoremove dia.</span><br></pre></td></tr></table></figure></li><li><p>输入<code>y</code>，等待，卸载完成。</p></li></ol><h1 id="问题-无法输入中文"><a href="#问题-无法输入中文" class="headerlink" title="问题:无法输入中文"></a>问题:无法输入中文</h1><h2 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h2><p>假入无法输入中文，修改一个选项：</p><ol><li>随便画一个图</li><li>右键</li><li>选择<code>Input Methods</code></li><li>点击<code>x input method</code><br><img src="/images/2020/04/20200429001.png" alt></li></ol><p>此时有可能发现还是无法使用中文输入，原因可能是因为打开.dia文件的时候，直接右键打开了。所以，此时应该在命令行输入：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dia</span><br></pre></td></tr></table></figure><p>打开dia软件之后，再打开所要打开的.dia文件。</p><h2 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h2><p>上述方案就是每次打开都必须设置一次,接下去我们要跳过这一个步骤</p><h3 id="从桌面文件直接打开"><a href="#从桌面文件直接打开" class="headerlink" title="从桌面文件直接打开"></a>从桌面文件直接打开</h3><p>修改<code>/usr/share/applications/dia.desktop</code>文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">把Exec=dia %F 改为Exec=env GTK_IM_MODULE=xim dia %F</span><br></pre></td></tr></table></figure><p>这个设置解决了从启动栏的快捷方式中启动Dia后，输入中文的问题。</p><h3 id="从终端打开"><a href="#从终端打开" class="headerlink" title="从终端打开"></a>从终端打开</h3><ul><li>启动命令dia 前边增加<code>env GTK_IM_MODULE=xim</code>，即用<code>env GTK_IM_MODULE=xim dia</code>来启动Dia</li><li>为了避免每次启动都要输入这么一长串，我们设置别名alias，<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">执行命令`alias dia=&quot;env GTK_IM_MODULE=xim dia&quot;`，以后再启动Dia时还是使用dia就可以了。</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>二叉树的相关概念及在Java中实现二叉树的遍历、查找和删除</title>
      <link href="/2020/04/27/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%9C%A8Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86%E6%9F%A5%E6%89%BE%E5%92%8C%E5%88%A0%E9%99%A4/"/>
      <url>/2020/04/27/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5%E5%8F%8A%E5%9C%A8Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86%E6%9F%A5%E6%89%BE%E5%92%8C%E5%88%A0%E9%99%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="为什么需要树这种数据结构"><a href="#为什么需要树这种数据结构" class="headerlink" title="为什么需要树这种数据结构"></a>为什么需要树这种数据结构</h1><h2 id="数组存储方式的分析"><a href="#数组存储方式的分析" class="headerlink" title="数组存储方式的分析"></a>数组存储方式的分析</h2><ul><li>优点:通过下标方式访问元素,速度快.对于有序数组,还可以使用二分查找提高检索速度</li><li>缺点:如果要检索具体某个值,或者按一定顺序插入值,则会整体移动,效率低</li></ul><h2 id="链式存储方式的分析"><a href="#链式存储方式的分析" class="headerlink" title="链式存储方式的分析"></a>链式存储方式的分析</h2><ul><li>优点:在一定程度上对数组存储方式有优化,插入一个数值节点只需要将插入节点链接到链表中即可,删除效率也很好</li><li>缺点:在进行检索时,效率仍然较低,检索某个值时,需要从头节点开始遍历</li></ul><h2 id="树存储方式分析"><a href="#树存储方式分析" class="headerlink" title="树存储方式分析"></a>树存储方式分析</h2><p>能提高数据存储,读取的效率,比如利用二叉树排序(Binary Sort Tree),既可以保证数据的检索速度,同时可以保证数据的插入,删除,修改的速度</p><h1 id="树的常用术语"><a href="#树的常用术语" class="headerlink" title="树的常用术语"></a>树的常用术语</h1><ol><li>空树:不包含任何结点的二叉树</li><li>单点树:只包含一个结点的二叉树</li><li>父结点</li><li>子结点</li><li>边:父结点到子结点的连线</li><li>祖先/子孙关系</li><li>兄弟结点:父结点相同的两个结点互为兄弟结点</li><li>树叶结点(叶子结点):对于二叉树,两棵子树都为空的结点(没有子结点的结点)</li><li>分支结点:树中除了树叶以外的结点</li><li>路径:从祖先结点找到该结点的路线(从一个结点到其子结点有一条长度为1的路径,每个结点到自身有一条长度为0的路径)</li><li>度数:一个结点的子结点个数称为该结点的度数</li><li>层(规定二叉树根的层数为0) &lt;==&gt; 貌似也有规定为1的情况</li><li>树的高度(也称深度):最大层数,也是树里最长路径的长度</li><li>森林(多棵子树构成森林)</li></ol><h1 id="二叉树的概念"><a href="#二叉树的概念" class="headerlink" title="二叉树的概念"></a>二叉树的概念</h1><ol><li>树有很多种，每个结点最多只有两个子结点的一种形式称为二叉树</li><li>二叉树的子结点分为左结点和右结点</li><li>示意图<br><img src="/images/2020/04/20200427001.png" alt></li></ol><h2 id="满二叉树"><a href="#满二叉树" class="headerlink" title="满二叉树"></a>满二叉树</h2><ul><li>定义: 所有分支结点的度数为2</li><li>==&gt; 这个定义出自【机械工业出版社《数据结构与算法（Python语言描述）》–北京大学 裘宗燕著】一书第179页</li></ul><p><strong>注意</strong></p><ol><li><p>国内定义：一个二叉树，如果每一个层的结点数都达到最大值，则这个二叉树就是满二叉树。 也就是说，如果一个二叉树的层数为<code>k</code> ，且结点总数是<code>(2^(k+1)) -1</code>，则它就是满二叉树。<br><img src="/images/2020/07/20200727012.png" alt><br><code>(2^(k+1)) -1</code>可由等比数列前n项和公式得到<br><img src="/images/2020/07/20200729001.png" alt><br>网上经常看到公式是<code>(2^k) -1</code>,是因为将根结点算作第一层,本质上没区别</p></li><li><p>国外定义：满二叉树的结点要么是叶子结点，度为0，要么是分支结点,度为2，不存在度为1的结点。<br><img src="/images/2020/07/20200727011.png" alt></p></li></ol><h2 id="扩充二叉树"><a href="#扩充二叉树" class="headerlink" title="扩充二叉树"></a>扩充二叉树</h2><p>将一个二叉树扩充成一个满二叉树,此时这个满二叉树即为扩充二叉树</p><ul><li>原树的结点称为内部结点</li><li>新增的结点称为外部结点</li></ul><p><strong>注意</strong>:空树的扩充二叉树为空树</p><h2 id="完全二叉树"><a href="#完全二叉树" class="headerlink" title="完全二叉树"></a>完全二叉树</h2><p>树的高度为h,第0层到第h-1层的结点都满(即:对于所有0 &lt;= i &lt;= h-1,第i层有2^i个结点),最后一层在最左边连续排列,空位都在右边<br><img src="/images/2020/07/20200729002.png" alt></p><h1 id="二叉树遍历的说明"><a href="#二叉树遍历的说明" class="headerlink" title="二叉树遍历的说明"></a>二叉树遍历的说明</h1><p>使用前序,中序和后序对二叉树进行遍历</p><ol><li>前序遍历:先输出父结点,再遍历左子树和右子树</li><li>中序遍历:先遍历左子树,再输出父结点,在遍历右子树</li><li>后序遍历:先遍历左子树,再遍历右子树,最后输出父结点</li></ol><p>小结:看输出父结点的顺序,就确定前序,中序还是后序</p><h2 id="遍历如下二叉树"><a href="#遍历如下二叉树" class="headerlink" title="遍历如下二叉树"></a>遍历如下二叉树</h2><p><img src="/images/2020/04/20200428001.png" alt></p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><ol><li><p>英雄对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroNode</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> no;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> HeroNode left;<span class="comment">// 默认null</span></span><br><span class="line"><span class="keyword">private</span> HeroNode right;<span class="comment">// 默认null</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HeroNode</span><span class="params">(<span class="keyword">int</span> no, String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.no = no;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"HeroNode[no=]"</span> + no + <span class="string">", name="</span> + name + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="keyword">this</span>);<span class="comment">// 先输出父结点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归向左子树前序遍历</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.left.preOrder();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归向右子树谦虚遍历</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.right.preOrder();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 递归向左子树中序遍历</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.left.infixOrder();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出父结点</span></span><br><span class="line">System.out.println(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归向右子树中序遍历</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.right.infixOrder();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.left.postOrder();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.right.postOrder();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>二叉树</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryTree</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> HeroNode root;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.root != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.root.preOrder();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"二叉树为空,无法遍历"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">infixOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.root != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.root.infixOrder();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"二叉树为空,无法遍历"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.root != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.root.postOrder();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"二叉树为空,无法遍历"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryTreeTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 先创建一棵二叉树</span></span><br><span class="line">BinaryTree binaryTree = <span class="keyword">new</span> BinaryTree();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建需要的结点</span></span><br><span class="line">HeroNode heroNode1 = <span class="keyword">new</span> HeroNode(<span class="number">1</span>, <span class="string">"宋江"</span>);</span><br><span class="line">HeroNode heroNode2 = <span class="keyword">new</span> HeroNode(<span class="number">2</span>, <span class="string">"卢俊义"</span>);</span><br><span class="line">HeroNode heroNode3 = <span class="keyword">new</span> HeroNode(<span class="number">3</span>, <span class="string">"吴用"</span>);</span><br><span class="line">HeroNode heroNode4 = <span class="keyword">new</span> HeroNode(<span class="number">4</span>, <span class="string">"林冲"</span>);</span><br><span class="line">HeroNode heroNode5 = <span class="keyword">new</span> HeroNode(<span class="number">5</span>, <span class="string">"关胜"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在我们先手动创建二叉树</span></span><br><span class="line">heroNode1.setLeft(heroNode2);</span><br><span class="line">heroNode1.setRight(heroNode3);</span><br><span class="line">heroNode3.setRight(heroNode4);</span><br><span class="line">heroNode3.setLeft(heroNode5);</span><br><span class="line"></span><br><span class="line">binaryTree.setRoot(heroNode1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line">System.out.println(<span class="string">"前序遍历"</span>);</span><br><span class="line">binaryTree.preOrder();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"中序遍历"</span>);</span><br><span class="line">binaryTree.infixOrder();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"后序遍历"</span>);</span><br><span class="line">binaryTree.postOrder();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="二叉树查找指定结点"><a href="#二叉树查找指定结点" class="headerlink" title="二叉树查找指定结点"></a>二叉树查找指定结点</h1><h2 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h2><ol><li>编写前序查找,中序查找,后序查找的方法</li><li>并分别使用三种查找方式,查找”关胜”的结点</li></ol><h2 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h2><h3 id="前序查找思路"><a href="#前序查找思路" class="headerlink" title="前序查找思路"></a>前序查找思路</h3><ol><li>先判断当前结点是否等于要查找的</li><li>如果相等,则返回当前结点</li><li>如果不等,则判断当前结点的左子结点是否为空,如果不为空,则递归前序查找</li><li>如果左递归前序查找能找到结点,则返回,否则继续判断当前结点的右子结点是否为空,如果不空,则继续向右递归前序查找<br><img src="/images/2020/04/20200430002.png" alt></li></ol><h3 id="中序查找思路"><a href="#中序查找思路" class="headerlink" title="中序查找思路"></a>中序查找思路</h3><ol><li>判断当前结点的左子结点是否为空,如果不为空,则递归中序查找</li><li>如果找到,则返回,如果没有找到,就和当前结点比较,如果是则返回当前结点,否则继续进行右递归中序查找</li><li>如果右递归中序查找能找到,就返回,否则返回null<br><img src="/images/2020/04/20200429005.png" alt></li></ol><h3 id="后序查找思路"><a href="#后序查找思路" class="headerlink" title="后序查找思路"></a>后序查找思路</h3><ol><li>判断当前结点的左子结点是否为空,如果不为空,则递归后序查找</li><li>如果找到,则返回,如果没有找到,就判断当前结点的右子结点是否为空,如果不为空,则右递归进行后续查找,如果找到,就返回</li><li>和当前结点进行比较,如果是则返回,否则返回null<br><img src="/images/2020/04/20200430001.png" alt></li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><ol><li><p>英雄对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.nullValue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroNode</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> no;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> HeroNode left;<span class="comment">// 默认null</span></span><br><span class="line"><span class="keyword">private</span> HeroNode right;<span class="comment">// 默认null</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HeroNode</span><span class="params">(<span class="keyword">int</span> no, String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.no = no;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"HeroNode[no=]"</span> + no + <span class="string">", name="</span> + name + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前序遍历查找</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> no 查找的序号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果找到就返回该结点,如果没有找到返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HeroNode <span class="title">preOrderSearch</span><span class="params">(<span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"进入前序遍历"</span>);</span><br><span class="line"><span class="comment">// 比较当前节点是不是</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.no == no) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断当前结点的左子结点是否为空,如果不为空,则递归前序查找</span></span><br><span class="line"><span class="comment">// 如果左递归前序查找能找到结点,则返回</span></span><br><span class="line">HeroNode resNode = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">resNode = <span class="keyword">this</span>.left.preOrderSearch(no);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (resNode != <span class="keyword">null</span>) &#123;<span class="comment">// 说明左子树找到</span></span><br><span class="line"><span class="keyword">return</span> resNode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">resNode = <span class="keyword">this</span>.right.preOrderSearch(no);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> resNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中序遍历查找</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> no 查找的序号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果找到就返回该结点,如果没有找到返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HeroNode <span class="title">infixOrderSearch</span><span class="params">(<span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 判断当前结点的左子结点是否为空,如果不为空,则递归中序查找</span></span><br><span class="line">HeroNode resNode = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">resNode = <span class="keyword">this</span>.left.infixOrderSearch(no);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (resNode != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> resNode;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"进入中序查找"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果找到,则返回,如果没有找到,就和当前结点比较,如果是则返回当前结点</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.no == no) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 否则继续进行右递归的中序查找</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">resNode = <span class="keyword">this</span>.right.infixOrderSearch(no);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> resNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后序遍历查找</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> no 查找的序号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果找到就返回该结点,如果没有找到返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HeroNode <span class="title">postOrderSearch</span><span class="params">(<span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 判断当前结点的左子结点是否为空,如果不为空,则递归后序查找</span></span><br><span class="line">HeroNode resNode = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">resNode = <span class="keyword">this</span>.left.postOrderSearch(no);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (resNode != <span class="keyword">null</span>) &#123;<span class="comment">// 说明在左子树找到</span></span><br><span class="line"><span class="keyword">return</span> resNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果左子树没有找到,则向右子树递归进行后序遍历查找</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">resNode = <span class="keyword">this</span>.right.postOrderSearch(no);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (resNode != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> resNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"进入后序查找"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果左右子树都没有找到,就比较当前结点是不是</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.no == no) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> resNode;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>二叉树</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryTree</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> HeroNode root;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前序遍历查找</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> no 查找的序号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果找到就返回该结点,如果没有找到返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HeroNode <span class="title">preOrderSearch</span><span class="params">(<span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (root != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> root.preOrderSearch(no);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中序遍历查找</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> no 查找的序号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果找到就返回该结点,如果没有找到返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HeroNode <span class="title">infixOrderSearch</span><span class="params">(<span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (root != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> root.infixOrderSearch(no);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后序遍历查找</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> no 查找的序号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果找到就返回该结点,如果没有找到返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HeroNode <span class="title">postOrderSearch</span><span class="params">(<span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (root != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> root.postOrderSearch(no);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryTreeTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试查找</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">searchTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 先创建一棵二叉树</span></span><br><span class="line">BinaryTree binaryTree = <span class="keyword">new</span> BinaryTree();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建需要的结点</span></span><br><span class="line">HeroNode heroNode1 = <span class="keyword">new</span> HeroNode(<span class="number">1</span>, <span class="string">"宋江"</span>);</span><br><span class="line">HeroNode heroNode2 = <span class="keyword">new</span> HeroNode(<span class="number">2</span>, <span class="string">"卢俊义"</span>);</span><br><span class="line">HeroNode heroNode3 = <span class="keyword">new</span> HeroNode(<span class="number">3</span>, <span class="string">"吴用"</span>);</span><br><span class="line">HeroNode heroNode4 = <span class="keyword">new</span> HeroNode(<span class="number">4</span>, <span class="string">"林冲"</span>);</span><br><span class="line">HeroNode heroNode5 = <span class="keyword">new</span> HeroNode(<span class="number">5</span>, <span class="string">"关胜"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在我们先手动创建二叉树</span></span><br><span class="line">heroNode1.setLeft(heroNode2);</span><br><span class="line">heroNode1.setRight(heroNode3);</span><br><span class="line">heroNode3.setRight(heroNode4);</span><br><span class="line">heroNode3.setLeft(heroNode5);</span><br><span class="line"></span><br><span class="line">binaryTree.setRoot(heroNode1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line">System.out.println(<span class="string">"前序遍历查找"</span>);</span><br><span class="line">HeroNode resNode = binaryTree.preOrderSearch(<span class="number">5</span>);</span><br><span class="line"><span class="keyword">if</span> (resNode != <span class="keyword">null</span>) &#123;</span><br><span class="line">System.out.printf(<span class="string">"找到了,信息为 no = %d name = %s"</span>, resNode.getNo(), resNode.getName());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"没有找到"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//System.out.println("中序遍历查找");</span></span><br><span class="line"><span class="comment">//resNode = binaryTree.infixOrderSearch(5);</span></span><br><span class="line"><span class="comment">//if (resNode != null) &#123;</span></span><br><span class="line"><span class="comment">//System.out.printf("找到了,信息为 no = %d name = %s", resNode.getNo(), resNode.getName());</span></span><br><span class="line"><span class="comment">//&#125; else &#123;</span></span><br><span class="line"><span class="comment">//System.out.println("没有找到");</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//System.out.println("后序遍历查找");</span></span><br><span class="line"><span class="comment">//resNode = binaryTree.postOrderSearch(5);</span></span><br><span class="line"><span class="comment">//if (resNode != null) &#123;</span></span><br><span class="line"><span class="comment">//System.out.printf("找到了,信息为 no = %d name = %s", resNode.getNo(), resNode.getName());</span></span><br><span class="line"><span class="comment">//&#125; else &#123;</span></span><br><span class="line"><span class="comment">//System.out.println("没有找到");</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="二叉树删除指定结点"><a href="#二叉树删除指定结点" class="headerlink" title="二叉树删除指定结点"></a>二叉树删除指定结点</h1><h2 id="要求-1"><a href="#要求-1" class="headerlink" title="要求"></a>要求</h2><ol><li>如果删除的结点是叶子结点,则删除该结点</li><li>如果删除的结点是非叶子结点,则删除该子树(注意这里,先从最简单的开始)</li></ol><h2 id="思路分析-1"><a href="#思路分析-1" class="headerlink" title="思路分析"></a>思路分析</h2><h3 id="首先处理"><a href="#首先处理" class="headerlink" title="首先处理"></a>首先处理</h3><p>考虑树是否是空树,如果只有一个root结点,则等价于将二叉树置空</p><h3 id="接下去进行下面步骤"><a href="#接下去进行下面步骤" class="headerlink" title="接下去进行下面步骤"></a>接下去进行下面步骤</h3><ol><li>因为我们的二叉树是单向的,所以我们是判断当前结点的子结点是否需要删除结点,而不能去判断当前这个结点是不是需要删除</li><li>如果当前结点的左子结点不为空,并且左子结点就是要删除的结点,就将this.left = null;并且返回(结束递归删除)</li><li>如果当前结点的右子结点不为空,并且右子结点就是要删除的结点,就将this.right = null;并且就返回(结束递归删除)</li><li>如果第2和第3步没有删除结点,那么我们就需要向左子树进行递归删除</li><li>如果第4步也没有删除结点,则应当向右子树进行递归删除</li></ol><h2 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h2><ol><li><p>英雄对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.nullValue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroNode</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> no;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> HeroNode left;<span class="comment">// 默认null</span></span><br><span class="line"><span class="keyword">private</span> HeroNode right;<span class="comment">// 默认null</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HeroNode</span><span class="params">(<span class="keyword">int</span> no, String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.no = no;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"HeroNode[no=]"</span> + no + <span class="string">", name="</span> + name + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="keyword">this</span>);<span class="comment">// 先输出父结点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归向左子树前序遍历</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.left.preOrder();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归向右子树谦虚遍历</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.right.preOrder();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 递归删除结点</span></span><br><span class="line"><span class="comment"> * -&gt; 如果删除的结点是叶子结点,则删除该结点</span></span><br><span class="line"><span class="comment"> * -&gt; 如果删除的结点是非叶子结点,则删除该子树(注意这里,先从最简单的开始)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> no 需要删除的序号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delNode</span><span class="params">(<span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.left.no == no) &#123;</span><br><span class="line"><span class="keyword">this</span>.left = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.right.no == no) &#123;</span><br><span class="line"><span class="keyword">this</span>.right = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.left != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.left.delNode(no);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.right != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.right.delNode(no);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>二叉树删除功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.nullValue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryTree</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> HeroNode root;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">preOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.root != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>.root.preOrder();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"二叉树为空,无法遍历"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除结点</span></span><br><span class="line"><span class="comment"> * -&gt; 如果删除的结点是叶子结点,则删除该结点</span></span><br><span class="line"><span class="comment"> * -&gt; 如果删除的结点是非叶子结点,则删除该子树(注意这里,先从最简单的开始)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> no 需要删除的序号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delNode</span><span class="params">(<span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (root != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="comment">// 如果只有一个root结点,这里立即判断root是不是就是要删除结点</span></span><br><span class="line"><span class="keyword">if</span> (root.getNo() == no) &#123;</span><br><span class="line">root = <span class="keyword">null</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 递归删除</span></span><br><span class="line">root.delNode(no);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"空树,不能删除"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.tree;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryTreeTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试删除</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delSearch</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 先创建一棵二叉树</span></span><br><span class="line">BinaryTree binaryTree = <span class="keyword">new</span> BinaryTree();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建需要的结点</span></span><br><span class="line">HeroNode heroNode1 = <span class="keyword">new</span> HeroNode(<span class="number">1</span>, <span class="string">"宋江"</span>);</span><br><span class="line">HeroNode heroNode2 = <span class="keyword">new</span> HeroNode(<span class="number">2</span>, <span class="string">"卢俊义"</span>);</span><br><span class="line">HeroNode heroNode3 = <span class="keyword">new</span> HeroNode(<span class="number">3</span>, <span class="string">"吴用"</span>);</span><br><span class="line">HeroNode heroNode4 = <span class="keyword">new</span> HeroNode(<span class="number">4</span>, <span class="string">"林冲"</span>);</span><br><span class="line">HeroNode heroNode5 = <span class="keyword">new</span> HeroNode(<span class="number">5</span>, <span class="string">"关胜"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在我们先手动创建二叉树</span></span><br><span class="line">heroNode1.setLeft(heroNode2);</span><br><span class="line">heroNode1.setRight(heroNode3);</span><br><span class="line">heroNode3.setRight(heroNode4);</span><br><span class="line">heroNode3.setLeft(heroNode5);</span><br><span class="line"></span><br><span class="line">binaryTree.setRoot(heroNode1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line">System.out.println(<span class="string">"删除前,遍历"</span>);</span><br><span class="line">binaryTree.preOrder();</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> no = <span class="number">5</span>;</span><br><span class="line">System.out.printf(<span class="string">"删除结点 no = %d"</span>, no);</span><br><span class="line">binaryTree.delNode(no);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"删除后,遍历"</span>);</span><br><span class="line">binaryTree.preOrder();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="更改删除规则"><a href="#更改删除规则" class="headerlink" title="更改删除规则"></a>更改删除规则</h2><p>如果要删除的结点是非叶子结点,现在我们不希望将该非叶子结点为根结点的子树删除,需要执行规则</p><ol><li>如果该非叶子结点A只有一个子结点B,则子结点B替代结点A</li><li>如果该非叶子结点A有左子结点B和右子结点C,则让左子结点B替代结点A</li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现哈希表</title>
      <link href="/2020/04/27/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%93%88%E5%B8%8C%E8%A1%A8/"/>
      <url>/2020/04/27/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%93%88%E5%B8%8C%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="哈希表的基本介绍"><a href="#哈希表的基本介绍" class="headerlink" title="哈希表的基本介绍"></a>哈希表的基本介绍</h1><p>散列表(Hash Table,也叫哈希表),是根据关键码值(Key Value)而直接进行访问的数据结构.也就是说,它通过把关键码值映射到表中一个位置来访问记录,以加快查找的速度.</p><ul><li>这个映射函数叫做散列函数</li><li>存放记录的数组叫做散列表</li></ul><h1 id="一个问题"><a href="#一个问题" class="headerlink" title="一个问题"></a>一个问题</h1><p>有一个公司,当有新的员工来报道时,要求将该员工的信息加入(id, 性别, 年龄 …),当输入该员工的id时,要求找到该员工的所有信息.</p><ol><li>不使用数据库,速度越快越好 -&gt; 哈希表</li><li>添加时,保证按照id从低到高插入</li><li>使用链表来实现哈希表,该链表不带表头(即:链表第一个节点就存放雇员信息)</li></ol><h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><ol><li><p>雇员对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.hash;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 雇员对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> Employee next;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Employee</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.id = id;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 为了显示方便,重写toString</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Employee[id="</span> + id + <span class="string">" name="</span> + name + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>雇员构成的链表</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.hash;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 雇员链表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeLinkedList</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Employee head;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加到雇员链表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employee 雇员</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Employee employee)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 添加第一个雇员</span></span><br><span class="line"><span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">head = employee;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果不是第一个雇员,则使用一个辅助指针,帮助定位到最后</span></span><br><span class="line">Employee currentEmployee = head;</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (currentEmployee.getNext() == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">currentEmployee = currentEmployee.getNext();</span><br><span class="line">&#125;</span><br><span class="line">currentEmployee.setNext(employee);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 遍历链表的雇员信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> no 第几条链表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">list</span><span class="params">(<span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"第 "</span> + (no + <span class="number">1</span>) + <span class="string">" 链表为空"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.print(<span class="string">"第 "</span> + (no + <span class="number">1</span>) + <span class="string">" 链表的信息为"</span>);</span><br><span class="line"><span class="comment">// 因为头节点不能动,所以需要辅助指针</span></span><br><span class="line">Employee currentEmployee = head;</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="comment">// 判断是否已经到链表最后</span></span><br><span class="line"><span class="keyword">if</span> (currentEmployee == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">System.out.printf(<span class="string">"=&gt;id=%d name=%s\t"</span>, currentEmployee.getId(), currentEmployee.getName());</span><br><span class="line">currentEmployee = currentEmployee.getNext();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据id查找雇员</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id 雇员id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 如果找到就返回雇员,如果没有找到,就返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">findEmployeeById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 判断链表是否为空</span></span><br><span class="line"><span class="keyword">if</span> (head == <span class="keyword">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"链表为空"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 辅助指针</span></span><br><span class="line">Employee currentEmployee = head;</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (currentEmployee.getId() == id) &#123;<span class="comment">// 找到</span></span><br><span class="line"><span class="keyword">break</span>;<span class="comment">// 此时currentEmployee就指向要查找的雇员</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 退出</span></span><br><span class="line"><span class="keyword">if</span> (currentEmployee.getNext() == <span class="keyword">null</span>) &#123;<span class="comment">// 说明遍历当前链表没有找到该雇员</span></span><br><span class="line">currentEmployee = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">currentEmployee = currentEmployee.getNext();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> currentEmployee;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>雇员链表构成的雇员哈希表</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.hash;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 雇员哈希表</span></span><br><span class="line"><span class="comment"> * -&gt; 管理多条链表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeHashTable</span> </span>&#123;</span><br><span class="line"><span class="comment">// 数组中每个元素都是EmployeeLinkedList链表</span></span><br><span class="line"><span class="keyword">private</span> EmployeeLinkedList[] employeeLinkedListArray;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表示有多少条链表</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">EmployeeHashTable</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.size = size;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化employeeLinkedListArray</span></span><br><span class="line">employeeLinkedListArray = <span class="keyword">new</span> EmployeeLinkedList[size];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">employeeLinkedListArray[i] = <span class="keyword">new</span> EmployeeLinkedList();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加雇员</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> employee 雇员</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Employee employee)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 根据雇员的id,计算雇员应该添加到哪条链表</span></span><br><span class="line"><span class="keyword">int</span> employeeLinkedListNo = hashFunction(employee.getId());</span><br><span class="line"><span class="comment">// 将雇员添加到对应的链表中</span></span><br><span class="line">employeeLinkedListArray[employeeLinkedListNo].add(employee);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 遍历所有链表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">employeeLinkedListArray[i].list(i);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据输入的id,查找雇员</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findEmployeeById</span> <span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 使用散列函数确定需要在哪条链表上进行查找</span></span><br><span class="line"><span class="keyword">int</span> employeeLinkedListNo = hashFunction(id);</span><br><span class="line">Employee employee = employeeLinkedListArray[employeeLinkedListNo].findEmployeeById(id);</span><br><span class="line"><span class="keyword">if</span> (employee != <span class="keyword">null</span>) &#123;<span class="comment">// 找到</span></span><br><span class="line">System.out.printf(<span class="string">"在第%d条链表中找到 雇员id=%d\n"</span>, (employeeLinkedListNo + <span class="number">1</span>), id);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.println(<span class="string">"在哈希表中,没有找到该雇员~"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 散列函数,使用一个简单取模法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashFunction</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> id % size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>调试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.hash;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeHashTableTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 创建哈希表</span></span><br><span class="line">EmployeeHashTable employeeHashTable = <span class="keyword">new</span> EmployeeHashTable(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写一个简单的菜单</span></span><br><span class="line">String key = <span class="string">""</span>;</span><br><span class="line">Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"add:  添加雇员"</span>);</span><br><span class="line">System.out.println(<span class="string">"list: 显示雇员"</span>);</span><br><span class="line">System.out.println(<span class="string">"find: 查找雇员"</span>);</span><br><span class="line">System.out.println(<span class="string">"exit: 退出系统"</span>);</span><br><span class="line"></span><br><span class="line">key = scanner.next();</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (key) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"add"</span>:</span><br><span class="line">System.out.println(<span class="string">"输入id"</span>);</span><br><span class="line"><span class="keyword">int</span> id = scanner.nextInt();</span><br><span class="line">System.out.println(<span class="string">"输入名字"</span>);</span><br><span class="line">String name = scanner.next();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建雇员</span></span><br><span class="line">Employee employee = <span class="keyword">new</span> Employee(id, name);</span><br><span class="line">employeeHashTable.add(employee);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"list"</span>:</span><br><span class="line">employeeHashTable.list();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"find"</span>:</span><br><span class="line">System.out.println(<span class="string">"请输入要查找的id"</span>);</span><br><span class="line">id = scanner.nextInt();</span><br><span class="line">employeeHashTable.findEmployeeById(id);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"exit"</span>:</span><br><span class="line">scanner.close();</span><br><span class="line">System.exit(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现基数排序</title>
      <link href="/2020/04/25/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%95%B0%E6%8E%92%E5%BA%8F/"/>
      <url>/2020/04/25/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%95%B0%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="基数排序-桶排序-介绍"><a href="#基数排序-桶排序-介绍" class="headerlink" title="基数排序(桶排序)介绍"></a>基数排序(桶排序)介绍</h1><ol><li>基数排序(radix sort)属于”分配式排序(distribution sort)”,又称”桶子法(bucket sort或bin sort)”,顾名思义,它是通过键值的各个位的值,将要排序的元素分配至某些”桶”中,达到排序的作用</li><li>基数排序法属于稳定的排序,基数排序法是效率高的稳定性排序法</li><li>基数排序(Radix Sort)是桶排序的扩展</li><li>基数排序是1887年赫夫曼何乐礼发明的.它是这样实现的:将整数按位分割成不同的数字,然后按每个位数分别比较</li></ol><h1 id="基数排序基本思想"><a href="#基数排序基本思想" class="headerlink" title="基数排序基本思想"></a>基数排序基本思想</h1><p>将所有待比较数值统一为同样的数位长度,数位较短的数前面补零.然后,从最低位开始,依次进行一次排序.这样从最低位排序一直到最高位排序完成以后,数列就变成一个有序序列</p><ol><li><p>按照个位数字的值,放入对应的桶中,比如278的个位是8,则放入8这个桶,其他同理,排序完成之后,重新组成一组,桶中有多个数据时,按照先进先出原则取出来<br><img src="/images/2020/04/20200426001.png" alt></p></li><li><p>接下去排十位数,比如930的十位数是3,就放入3这个桶,其他同理,排序完成之后,重新组成一组,桶中有多个数据时,按照先进先出原则取出来<br><img src="/images/2020/04/20200426002.png" alt></p></li><li><p>接下去排百位数,比如505的百位数是5,就放入5这个桶,其他同理,排序完成之后,重新组成一组,桶中有多个数据时,按照先进先出原则取出来<br><img src="/images/2020/04/20200426003.png" alt></p></li></ol><h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><h2 id="手动实现上述逻辑"><a href="#手动实现上述逻辑" class="headerlink" title="手动实现上述逻辑"></a>手动实现上述逻辑</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RadixSort</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">radixSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1.得到数组中最大的数的位数</span></span><br><span class="line"><span class="keyword">int</span> max = arr[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (arr[i] &gt; max) &#123;</span><br><span class="line">max = arr[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 得到最大的数是几位数</span></span><br><span class="line"><span class="keyword">int</span> maxLength = (max + <span class="string">""</span>).length();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.定义一个二维数组,表示10个桶,每个桶就是一个一维数组</span></span><br><span class="line"><span class="comment">// 说明</span></span><br><span class="line"><span class="comment">// -&gt; 二维数组包含10个一维数组</span></span><br><span class="line"><span class="comment">// -&gt; 为了防止在放入数的时候,数据溢出,则每个一维数组(桶),大小定为arr.length</span></span><br><span class="line"><span class="comment">// -&gt; 基数排序是使用空间换时间的经典算法</span></span><br><span class="line"><span class="keyword">int</span>[][] bucket = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>][arr.length];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为了记录每个桶中,实际存放了多少个数据,我们定义一个一维数组来记录各个桶的每次放入数据个数</span></span><br><span class="line"><span class="comment">// bucketElementCounts[0],记录的就是bucket[0]桶的放入数据个数</span></span><br><span class="line"><span class="keyword">int</span>[] bucketElementCounts = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一轮</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line"><span class="comment">// 取出每个元素的个位的值</span></span><br><span class="line"><span class="keyword">int</span> digitOfElement = arr[j] / <span class="number">1</span> % <span class="number">10</span>;</span><br><span class="line"><span class="comment">// 放入对应的桶中</span></span><br><span class="line">bucket[digitOfElement][bucketElementCounts[digitOfElement]] = arr[j];</span><br><span class="line">bucketElementCounts[digitOfElement]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按照这个桶的顺序(一维数组的下标依次取出数据,放入原来数组)</span></span><br><span class="line"><span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 遍历每一桶,并将桶中的数据放入到原数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; bucketElementCounts.length; k++) &#123;</span><br><span class="line"><span class="comment">// 如果桶中有数据,我们才放入到原数组</span></span><br><span class="line"><span class="keyword">if</span> (bucketElementCounts[k]!= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// 循环该桶即第k个桶(即第k个一维数组),放入</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; bucketElementCounts[k]; l++) &#123;</span><br><span class="line"><span class="comment">// 取出元素放入到arr</span></span><br><span class="line">arr[index++] = bucket[k][l];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第i+1轮处理后,需要将每个bucketElementCounts[k]=0!!!!</span></span><br><span class="line">bucketElementCounts[k] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"第一轮,对个位的排序处理arr = "</span> + Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二轮</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line"><span class="comment">// 取出每个元素的个位的值</span></span><br><span class="line"><span class="keyword">int</span> digitOfElement = arr[j] / <span class="number">10</span> % <span class="number">10</span>;</span><br><span class="line"><span class="comment">// 放入对应的桶中</span></span><br><span class="line">bucket[digitOfElement][bucketElementCounts[digitOfElement]] = arr[j];</span><br><span class="line">bucketElementCounts[digitOfElement]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按照这个桶的顺序(一维数组的下标依次取出数据,放入原来数组)</span></span><br><span class="line">index = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 遍历每一桶,并将桶中的数据放入到原数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; bucketElementCounts.length; k++) &#123;</span><br><span class="line"><span class="comment">// 如果桶中有数据,我们才放入到原数组</span></span><br><span class="line"><span class="keyword">if</span> (bucketElementCounts[k]!= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// 循环该桶即第k个桶(即第k个一维数组),放入</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; bucketElementCounts[k]; l++) &#123;</span><br><span class="line"><span class="comment">// 取出元素放入到arr</span></span><br><span class="line">arr[index++] = bucket[k][l];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第i+1轮处理后,需要将每个bucketElementCounts[k]=0!!!!</span></span><br><span class="line">bucketElementCounts[k] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"第二轮,对个位的排序处理arr = "</span> + Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三轮</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line"><span class="comment">// 取出每个元素的个位的值</span></span><br><span class="line"><span class="keyword">int</span> digitOfElement = arr[j] / <span class="number">100</span> % <span class="number">10</span>;</span><br><span class="line"><span class="comment">// 放入对应的桶中</span></span><br><span class="line">bucket[digitOfElement][bucketElementCounts[digitOfElement]] = arr[j];</span><br><span class="line">bucketElementCounts[digitOfElement]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按照这个桶的顺序(一维数组的下标依次取出数据,放入原来数组)</span></span><br><span class="line">index = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 遍历每一桶,并将桶中的数据放入到原数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; bucketElementCounts.length; k++) &#123;</span><br><span class="line"><span class="comment">// 如果桶中有数据,我们才放入到原数组</span></span><br><span class="line"><span class="keyword">if</span> (bucketElementCounts[k]!= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// 循环该桶即第k个桶(即第k个一维数组),放入</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; bucketElementCounts[k]; l++) &#123;</span><br><span class="line"><span class="comment">// 取出元素放入到arr</span></span><br><span class="line">arr[index++] = bucket[k][l];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第i+1轮处理后,需要将每个bucketElementCounts[k]=0!!!!</span></span><br><span class="line">bucketElementCounts[k] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"第三轮,对个位的排序处理arr = "</span> + Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="添加循环"><a href="#添加循环" class="headerlink" title="添加循环"></a>添加循环</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RadixSort</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">radixSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1.得到数组中最大的数的位数</span></span><br><span class="line"><span class="keyword">int</span> max = arr[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (arr[i] &gt; max) &#123;</span><br><span class="line">max = arr[i];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 得到最大的数是几位数</span></span><br><span class="line"><span class="keyword">int</span> maxLength = (max + <span class="string">""</span>).length();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.定义一个二维数组,表示10个桶,每个桶就是一个一维数组</span></span><br><span class="line"><span class="comment">// 说明</span></span><br><span class="line"><span class="comment">// -&gt; 二维数组包含10个一维数组</span></span><br><span class="line"><span class="comment">// -&gt; 为了防止在放入数的时候,数据溢出,则每个一维数组(桶),大小定为arr.length</span></span><br><span class="line"><span class="comment">// -&gt; 基数排序是使用空间换时间的经典算法</span></span><br><span class="line"><span class="keyword">int</span>[][] bucket = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>][arr.length];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为了记录每个桶中,实际存放了多少个数据,我们定义一个一维数组来记录各个桶的每次放入数据个数</span></span><br><span class="line"><span class="comment">// bucketElementCounts[0],记录的就是bucket[0]桶的放入数据个数</span></span><br><span class="line"><span class="keyword">int</span>[] bucketElementCounts = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一轮</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, n = <span class="number">1</span>; i &lt; maxLength; i++, n *= <span class="number">10</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line"><span class="comment">// 取出每个元素的个位的值</span></span><br><span class="line"><span class="keyword">int</span> digitOfElement = arr[j] / n % <span class="number">10</span>;</span><br><span class="line"><span class="comment">// 放入对应的桶中</span></span><br><span class="line">bucket[digitOfElement][bucketElementCounts[digitOfElement]] = arr[j];</span><br><span class="line">bucketElementCounts[digitOfElement]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 按照这个桶的顺序(一维数组的下标依次取出数据,放入原来数组)</span></span><br><span class="line"><span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="comment">// 遍历每一桶,并将桶中的数据放入到原数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; bucketElementCounts.length; k++) &#123;</span><br><span class="line"><span class="comment">// 如果桶中有数据,我们才放入到原数组</span></span><br><span class="line"><span class="keyword">if</span> (bucketElementCounts[k] != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// 循环该桶即第k个桶(即第k个一维数组),放入</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; bucketElementCounts[k]; l++) &#123;</span><br><span class="line"><span class="comment">// 取出元素放入到arr</span></span><br><span class="line">arr[index++] = bucket[k][l];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第i+1轮处理后,需要将每个bucketElementCounts[k]=0!!!!</span></span><br><span class="line">bucketElementCounts[k] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">            System.out.println(<span class="string">"第"</span> + (i + <span class="number">1</span>) + <span class="string">"轮,对个位的排序处理arr = "</span> + Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RadixSortTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> arr[] = &#123;<span class="number">53</span>, <span class="number">3</span>, <span class="number">542</span>, <span class="number">748</span>, <span class="number">14</span>, <span class="number">214</span>&#125;;</span><br><span class="line">RadixSort radixSort = <span class="keyword">new</span> RadixSort();</span><br><span class="line">radixSort.radixSort(arr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="基数排序说明"><a href="#基数排序说明" class="headerlink" title="基数排序说明"></a>基数排序说明</h1><ol><li>基数排序是对传统桶排序的扩展,速度很快</li><li>基数排序是经典的空间换时间的方式,占内存很大,当对海量数据排序时,容易造成OutOfMemoryError</li><li>基数排序是稳定的(假定在待排序的记录序列中,存在多个具有相同的关键字的记录,若经过排序,这些记录的相对次序保持不变,即在原序列中,r[i]=r[j],且r[i]在r[j]之前,而在排序后的序列中,r[i]仍在r[j]之前,则称这种排序算法是稳定的,否则称为不稳定的)</li><li>有负数的数组,我们不用基数排序来进行排序,入股要支持负数,参考<a href="https://code.i-harness.com/zh-CN/q/e98fa9" target="_blank" rel="noopener">https://code.i-harness.com/zh-CN/q/e98fa9</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现归并排序</title>
      <link href="/2020/04/24/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/"/>
      <url>/2020/04/24/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="归并排序介绍"><a href="#归并排序介绍" class="headerlink" title="归并排序介绍"></a>归并排序介绍</h1><p>归并排序(MERGE-SORT)是利用归并思想实现的排序方法,该算法采用经典的分治(divide-and-conquer)策略(分治法将问题分(divide)成一些小的问题,然后递归求解,而治(conquer)阶段则将分的阶段得到的各答案”修补”在一起,即分而治之)</p><h1 id="归并排序思想图示"><a href="#归并排序思想图示" class="headerlink" title="归并排序思想图示"></a>归并排序思想图示</h1><p><img src="/images/2020/04/20200424002.png" alt></p><h2 id="具体的治阶段"><a href="#具体的治阶段" class="headerlink" title="具体的治阶段"></a>具体的治阶段</h2><p>我们将两个已经有序的自序列合并成一个有序序列,比如上图中的最后一次合并,我们将[4,5,7,8]和[1,2,3,6]两个已经有序的子序列,合并最终序列[1,2,3,4,5,6,7,8],以下是实现步骤<br><img src="/images/2020/04/20200424004.png" alt><br><img src="/images/2020/04/20200424005.png" alt></p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><ol><li><p>归并排序代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MergeSort</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> arr[] = &#123;<span class="number">8</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">2</span>&#125;;</span><br><span class="line"><span class="keyword">int</span>[] temp = <span class="keyword">new</span> <span class="keyword">int</span>[arr.length];</span><br><span class="line">mergeSort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>, temp);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> left, <span class="keyword">int</span> right, <span class="keyword">int</span>[] temp)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (left &lt; right) &#123;</span><br><span class="line"><span class="comment">// 递归这里实现规模减少</span></span><br><span class="line"><span class="keyword">int</span> mid = (left + right) / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向左递归分解</span></span><br><span class="line">mergeSort(arr, left, mid, temp);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向右递归分解</span></span><br><span class="line">mergeSort(arr, mid + <span class="number">1</span>, right, temp);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 合并</span></span><br><span class="line">merge(arr, left, mid, right, temp);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将逻辑上两个待合并的数组合并为一个数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr 排序的原始数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> left 有序序列的最左边索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> mid 中间索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> right 右边索引</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> temp 做中转的数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> left, <span class="keyword">int</span> mid, <span class="keyword">int</span> right, <span class="keyword">int</span>[] temp)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> i = left;<span class="comment">// 初始化i,左边有序序列的初始索引</span></span><br><span class="line"><span class="keyword">int</span> j = mid + <span class="number">1</span>;<span class="comment">// 初始化j,右边有序序列的初始索引</span></span><br><span class="line"><span class="keyword">int</span> t = <span class="number">0</span>;<span class="comment">// 执行temp数组的当前索引</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// (一)</span></span><br><span class="line"><span class="comment">// 先把左右两边(有序)的数组按照规则填充到temp数组</span></span><br><span class="line"><span class="comment">// 直到左右两边的有序序列中有一边处理完毕为止</span></span><br><span class="line"><span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= right) &#123;</span><br><span class="line"><span class="comment">// 如果左边的有序序列的当前元素小于等于右边有序序列的当前元素</span></span><br><span class="line"><span class="comment">// 即将左边的当前元素填充到 temp 数组</span></span><br><span class="line"><span class="keyword">if</span> (arr[i] &lt;= arr[j]) &#123;</span><br><span class="line"><span class="comment">//temp[t] = arr[i];</span></span><br><span class="line"><span class="comment">//t++;</span></span><br><span class="line"><span class="comment">//i++;</span></span><br><span class="line">temp[t++] = arr[i++];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;<span class="comment">// 反之,则将右边有序序列的当前元素填充到temp数组</span></span><br><span class="line">temp[t++] = arr[j++];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (二)</span></span><br><span class="line"><span class="comment">// 把剩余数据的一边的数据依次填充到temp</span></span><br><span class="line"><span class="keyword">while</span> (i &lt;= mid) &#123;<span class="comment">// 左边的有序序列还有剩余的元素,就全部填充到temp</span></span><br><span class="line">temp[t++] = arr[i++];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> (j &lt;= right) &#123;<span class="comment">// 右边的有序序列还有剩余的元素,就全部填充到temp</span></span><br><span class="line">temp[t++] = arr[j++];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (三)</span></span><br><span class="line"><span class="comment">// 将temp数组的元素拷贝到arr</span></span><br><span class="line"><span class="comment">// 注意,并不是每次都拷贝所有</span></span><br><span class="line">t = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> tempLeft = left;</span><br><span class="line"><span class="keyword">while</span> (tempLeft &lt;= right) &#123;</span><br><span class="line">arr[tempLeft++] = temp[t++];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>对照图解,代码的执行顺序如下<br><img src="/images/2020/04/20200424007.png" alt></p></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MergeSortTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">MergeSort mergeSort = <span class="keyword">new</span> MergeSort();</span><br><span class="line">mergeSort.sort();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现快速排序</title>
      <link href="/2020/04/23/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/"/>
      <url>/2020/04/23/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="快速排序算法介绍"><a href="#快速排序算法介绍" class="headerlink" title="快速排序算法介绍"></a>快速排序算法介绍</h1><p>快速排序算法(QuickSort)是对冒泡排序的一种改进</p><h2 id="基本思想是"><a href="#基本思想是" class="headerlink" title="基本思想是"></a>基本思想是</h2><ul><li>通过一趟排序将要排序的数据分割成独立的两部分,其中一部分的所有数据都比另外一部分的所有数据都要小</li><li>然后按照此方法对这两部分数据分别进行快速排序,这个排序过程可以递归进行,以此达到整个数据变成有序序列</li></ul><h1 id="快速排序图解"><a href="#快速排序图解" class="headerlink" title="快速排序图解"></a>快速排序图解</h1><p><img src="/images/2020/04/20200424001.png" alt></p><h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><ol><li><p>算法实现,这里以中间值为枢纽值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickSort</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 快速排序</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> arr 待排序数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> left 数组的最左边下标</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> right 数组的最右边下标</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 左下标</span></span><br><span class="line"><span class="keyword">int</span> l = left;</span><br><span class="line"><span class="comment">// 右下标</span></span><br><span class="line"><span class="keyword">int</span> r = right;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中轴值</span></span><br><span class="line"><span class="keyword">int</span> pivot = arr[(left + right) / <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> temp = <span class="number">0</span>;<span class="comment">// 临时变量,作为交换时使用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (l &lt; r) &#123;</span><br><span class="line"><span class="comment">// 当while退出时,此时l下标对应的值大于中轴值</span></span><br><span class="line"><span class="keyword">while</span> (arr[l] &lt; pivot) &#123;</span><br><span class="line">l += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当while退出时,此时r下标对应的值小于中轴值</span></span><br><span class="line"><span class="keyword">while</span> (arr[r] &gt; pivot ) &#123;</span><br><span class="line">r -= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果 l &gt;= r 说明pivot的左右两的值,已经按照左边全是小于等于pivot值,右边全部是大于等于pivot值</span></span><br><span class="line"><span class="keyword">if</span> (l &gt;= r) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 交换pivot两边的值</span></span><br><span class="line">temp = arr[l];</span><br><span class="line">arr[l] = arr[r];</span><br><span class="line">arr[r] = temp;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果交换完之后,发现 arr[l] == pivot 值</span></span><br><span class="line"><span class="comment">// 是因为前面写的代码中,当arr[l] == pivot的时候,r的规模并不会减少,即无法向循环的退出条件靠近</span></span><br><span class="line"><span class="keyword">if</span> (arr[l] == pivot) &#123;</span><br><span class="line">r--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 和上述同理</span></span><br><span class="line"><span class="comment">// 需要减小l的规模</span></span><br><span class="line"><span class="keyword">if</span> (arr[r] == pivot ) &#123;</span><br><span class="line">l++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果 l == r,则必须l++和r--,否则会出现栈溢出,即要向循环的退出条件靠近</span></span><br><span class="line"><span class="keyword">if</span> (l == r) &#123;</span><br><span class="line">l++;</span><br><span class="line">r--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向左递归</span></span><br><span class="line"><span class="keyword">if</span> (left &lt; r) &#123;</span><br><span class="line">quickSort(arr, left, r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向右递归</span></span><br><span class="line"><span class="keyword">if</span> (right &gt; l) &#123;</span><br><span class="line">quickSort(arr, l, right);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickSortTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//int[] arr = &#123;-9, 78, 0, 23, -567, 70, -1&#125;;</span></span><br><span class="line"><span class="keyword">int</span>[] arr = &#123;<span class="number">78</span>, <span class="number">23</span>, <span class="number">23</span>&#125;;</span><br><span class="line">QuickSort quickSort = <span class="keyword">new</span> QuickSort();</span><br><span class="line">quickSort.quickSort(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装番茄工作法软件gnome-Shell-Pomodoro</title>
      <link href="/2020/04/21/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E7%95%AA%E8%8C%84%E5%B7%A5%E4%BD%9C%E6%B3%95%E8%BD%AF%E4%BB%B6gnome-shell-pomodoro/"/>
      <url>/2020/04/21/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E7%95%AA%E8%8C%84%E5%B7%A5%E4%BD%9C%E6%B3%95%E8%BD%AF%E4%BB%B6gnome-shell-pomodoro/</url>
      
        <content type="html"><![CDATA[<h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><blockquote><p>  This GNOME app helps to manage time according to Pomodoro Technique. It intends to improve productivity and quality of work by reminding you to take short breaks.<br>  Pomodoro Technique is based on two principles:</p><ul><li>focusing on work for limited time, about half an hour,</li><li>clearing your mind during breaks.<br>This workflow can improve focus, physical health and mental agility depending on how you spend your breaks and how strictly you follow the routine.</li></ul></blockquote><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="最好去官网看"><a href="#最好去官网看" class="headerlink" title="最好去官网看"></a>最好去官网看</h2><ul><li>官网地址:<a href="https://gnomepomodoro.org/" target="_blank" rel="noopener">https://gnomepomodoro.org/</a></li><li><img src="/images/2020/04/20200421006.png" alt></li></ul><h2 id="Ubuntu18-04安装"><a href="#Ubuntu18-04安装" class="headerlink" title="Ubuntu18.04安装"></a>Ubuntu18.04安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gnome-shell-pomodoro</span><br></pre></td></tr></table></figure><h1 id="安装后软件运行效果图"><a href="#安装后软件运行效果图" class="headerlink" title="安装后软件运行效果图"></a>安装后软件运行效果图</h1><p><img src="/images/2020/04/20200421005.png" alt></p><p><img src="/images/2020/04/20200421008.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现希尔排序(插入排序的改良版)</title>
      <link href="/2020/04/21/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%B8%8C%E5%B0%94%E6%8E%92%E5%BA%8F(%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F%E7%9A%84%E6%94%B9%E8%89%AF%E7%89%88)/"/>
      <url>/2020/04/21/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%B8%8C%E5%B0%94%E6%8E%92%E5%BA%8F(%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F%E7%9A%84%E6%94%B9%E8%89%AF%E7%89%88)/</url>
      
        <content type="html"><![CDATA[<h1 id="希尔排序法介绍"><a href="#希尔排序法介绍" class="headerlink" title="希尔排序法介绍"></a>希尔排序法介绍</h1><ul><li>希尔排序是希尔(Donald Shell)与1959年提出的一种排序算法</li><li>希尔也是一种插入排序,是简单插入排序经过改进之后的一个更高效的版本,也称为缩小增量排序</li></ul><h1 id="希尔排序法的基本思想"><a href="#希尔排序法的基本思想" class="headerlink" title="希尔排序法的基本思想"></a>希尔排序法的基本思想</h1><ul><li>希尔排序是把记录按下标的一定增量分组,对每组使用直接插入排序算法排序</li><li>随着增量逐渐减少,每组包含的关键字越来越多,当增量减至1时,整个文件恰被分成一组,算法便终止</li></ul><h1 id="希尔排序示意图"><a href="#希尔排序示意图" class="headerlink" title="希尔排序示意图"></a>希尔排序示意图</h1><h2 id="第一轮"><a href="#第一轮" class="headerlink" title="第一轮"></a>第一轮</h2><ol><li><p>首先它把较大的数据集合分割成若干个小组（逻辑上分组,分割长度为<code>arr.length/2</code>），然后对每一个小组分别进行插入排序</p><ul><li>由于分割成小组,插入排序所作用的数据量比较小（每一个小组）,所以插入的效率比较高</li><li>下面有颜色的是逻辑上的分组，并没有实际地进行分组操作，在数组中的位置还是原来的样子，只是将他们看成这么几个分组（逻辑上分组）<br><img src="/images/2020/04/20200421010.png" alt></li></ul></li><li><p>可以看出，它是按下标相隔距离为<code>arr.length/2 = 8/2 = 4</code>分的组，也就是说把下标相差4的分到一组</p><ul><li>比如这个例子中a[0]与a[4]是一组、a[1]与a[5]是一组…，</li><li><strong>这里的差值（距离）被称为增量</strong><br><img src="/images/2020/04/20200421011.png" alt></li></ul></li><li><p>每个分组进行插入排序后，各个分组就变成了有序的了（整体不一定有序）<br><img src="/images/2020/04/20200421012.png" alt><br>此时，整个数组变的部分有序了（有序程度可能不是很高）<br><img src="/images/2020/04/20200421013.png" alt></p></li></ol><h2 id="第二轮"><a href="#第二轮" class="headerlink" title="第二轮"></a>第二轮</h2><ol start="4"><li><p>然后缩小增量为上个增量的一半:<code>(arr.length/2)/2 = (8/2)/2 = 2</code>，继续划分分组，此时，每个分组元素个数多了，但是，数组变的部分有序了，插入排序效率同样比较高<br><img src="/images/2020/04/20200421014.png" alt></p></li><li><p>同理对每个分组进行排序（插入排序），使其每个分组各自有序<br><img src="/images/2020/04/20200421015.png" alt></p></li></ol><h2 id="第三轮"><a href="#第三轮" class="headerlink" title="第三轮"></a>第三轮</h2><ol start="6"><li><p>最后设置增量为上一个增量的一半：1，则整个数组被分为一组，此时，整个数组已经接近有序了，插入排序效率高<br><img src="/images/2020/04/20200421016.png" alt></p></li><li><p>同理，对这仅有的一组数据进行排序，排序完成</p></li></ol><h1 id="希尔排序代码实现"><a href="#希尔排序代码实现" class="headerlink" title="希尔排序代码实现"></a>希尔排序代码实现</h1><h2 id="对有序序列在插入时采用交换法"><a href="#对有序序列在插入时采用交换法" class="headerlink" title="对有序序列在插入时采用交换法"></a>对有序序列在插入时采用交换法</h2><p>效率差,可以忽略</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShellSort</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] arr = &#123;<span class="number">8</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 希尔排序之交换式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shellSortByExchangeType</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每轮的增量</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> gap = arr.length / <span class="number">2</span>; gap &gt; <span class="number">0</span>; gap /= <span class="number">2</span>) &#123;</span><br><span class="line"><span class="comment">// 将数组进行分组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = gap; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">// 遍历各组中所有的元素,步长gap</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = i - gap; j &gt;= <span class="number">0</span>; j -= gap) &#123;</span><br><span class="line"><span class="comment">// 如果当前元素大于加上步长后的那个元素,说明交换</span></span><br><span class="line"><span class="keyword">if</span> (arr[j] &gt; arr[j + gap]) &#123;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j + gap];</span><br><span class="line">arr[j + gap] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"希尔排序第"</span> + (++count) + <span class="string">"轮="</span> + Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="对有序序列在插入时采用移动法"><a href="#对有序序列在插入时采用移动法" class="headerlink" title="对有序序列在插入时采用移动法"></a>对有序序列在插入时采用移动法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShellSort</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] arr = &#123;<span class="number">8</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">shellSortByShiftType</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每轮的增量</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> gap = arr.length; gap &gt; <span class="number">0</span>; gap /= <span class="number">2</span>) &#123;</span><br><span class="line"><span class="comment">// 理解上说是分组,但代码中实际实现并不会"创造"分组,而是如下进行操作</span></span><br><span class="line"><span class="comment">// -&gt; 从增量长度开始遍历(即跳过每个分组的第一个数)</span></span><br><span class="line"><span class="comment">// -&gt; 比如数组: 1 2 4 3 5 7 8 6</span></span><br><span class="line"><span class="comment">// -&gt; 逻辑上分组: 1  4  5  8</span></span><br><span class="line"><span class="comment">// -&gt;             2  3  7  6</span></span><br><span class="line"><span class="comment">// -&gt; 那么从 4 开始遍历</span></span><br><span class="line"><span class="comment">// -&gt; -&gt; 比较 4 和 1,将较小的放前面,此时不需要改变</span></span><br><span class="line"><span class="comment">// -&gt; -&gt; 接下去比较 3 和 2,将较小的放前面,此时不需要改变</span></span><br><span class="line"><span class="comment">// -&gt; -&gt; -&gt; 接下去比较 5 和 4,将较小的放前面,此时不需要改变</span></span><br><span class="line"><span class="comment">// -&gt; -&gt; -&gt; 接下去比较 7 和 3,将较小的放前面,此时不需要改变</span></span><br><span class="line"><span class="comment">// -&gt; -&gt; -&gt; 接下去比较 8 和 5,将较小的放前面,此时不需要改变</span></span><br><span class="line"><span class="comment">// -&gt; -&gt; -&gt; 接下去比较 6 和 7,将较小的放前面,由于6比7小,所以交换位置</span></span><br><span class="line"><span class="comment">// -&gt; -&gt; -&gt; -&gt; -&gt; 由于交换了位置,所以,6还要继续和前面的数字3进行比较,将较小的放前面,此时不需要改变</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = gap; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="keyword">int</span> temp = arr[i];</span><br><span class="line"><span class="comment">// -&gt; 2. 当增量长度</span></span><br><span class="line"><span class="keyword">while</span> (i - gap &gt;= <span class="number">0</span> &amp;&amp; temp &lt; arr[i - gap]) &#123;</span><br><span class="line">arr[i] = arr[i - gap];</span><br><span class="line">i -= gap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当退出while之后,就给temp找到插入的位置</span></span><br><span class="line">arr[i] = temp;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"希尔排序第"</span> + (++count) + <span class="string">"轮="</span> + Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现插入排序</title>
      <link href="/2020/04/21/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/"/>
      <url>/2020/04/21/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E6%8F%92%E5%85%A5%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="插入排序法介绍"><a href="#插入排序法介绍" class="headerlink" title="插入排序法介绍"></a>插入排序法介绍</h1><ul><li>插入式排序属于内部排序法,是对于欲排序的元素以插入的方式寻找该元素的适当位置,以达到排序的目的</li><li>就像是抽扑克牌,从无序的牌堆中抽取牌,插入手上有序的牌组中<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">想象一下:</span><br><span class="line">==&gt; 扑克牌中的抓牌</span><br><span class="line">==&gt; 从牌堆(无序数组)中抽牌,插入到手牌上(有序数组)</span><br><span class="line">==&gt; 要插入的牌,按顺序和手牌进行比较</span><br><span class="line">==&gt; ==&gt; 1. 和手牌(最右边 - 0)的牌进行比较</span><br><span class="line">==&gt; ==&gt; ==&gt; 插入的牌较大,退出循环,然后将牌插入被比较牌的右边</span><br><span class="line">==&gt; ==&gt; ==&gt; 插入的牌较小,则将被比较的牌向右边移动一位</span><br><span class="line">==&gt; ==&gt; 2. 和手牌(最右边 - 1)的牌进行比较</span><br><span class="line">==&gt; ==&gt; ==&gt; 插入的牌较大,退出循环,然后将牌插入被比较牌的右边(前一次循环右移了一位,所以被插入牌右边永远有空位)</span><br><span class="line">==&gt; ==&gt; ==&gt; 插入的牌较小,则将被比较的牌向右边移动一位</span><br><span class="line">==&gt; ==&gt; 3. 和手牌(最右边 - 2)的牌进行比较</span><br><span class="line">==&gt; ==&gt; ==&gt; 插入的牌较大,退出循环,然后将牌插入被比较牌的右边(前一次循环右移了一位,所以被插入牌右边永远有空位)</span><br><span class="line">==&gt; ==&gt; ==&gt; 插入的牌较小,则将被比较的牌向右边移动一位</span><br></pre></td></tr></table></figure></li></ul><p><img src="/images/2020/07/20200729005.png" alt></p><h1 id="插入排序法思想"><a href="#插入排序法思想" class="headerlink" title="插入排序法思想"></a>插入排序法思想</h1><ol><li>把n个待排序的元素看成为一个有序表和一个无序表</li><li>开始时<strong>有序表中只包含一个元素</strong>,无序表中包含<strong>n-1个元素</strong></li><li>排序过程中每次从无序表中取出第一个元素,把它的排序码依次与有序表元素的排序码进行比较,将它插入到有序表中的适当位置,使之成为新的有序表</li></ol><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="手动实现代码"><a href="#手动实现代码" class="headerlink" title="手动实现代码"></a>手动实现代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InsertSort</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> arr[] = &#123;<span class="number">101</span>, <span class="number">34</span>, <span class="number">119</span>, <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 第一轮插入</span></span><br><span class="line"><span class="comment">// 定义待插入的数</span></span><br><span class="line"><span class="keyword">int</span> insertVal = arr[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">int</span> insertIndex = (<span class="number">1</span> - <span class="number">1</span>);<span class="comment">// 即arr[1]的前面这个数的下标</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 给 insertVal 找到插入的位置</span></span><br><span class="line"><span class="comment">// -&gt; insertIndex &gt;= 0 保证在给insertVal找插入位置,不越界</span></span><br><span class="line"><span class="comment">// -&gt; 将需要插入有序数组的数与有序数组中的每个数字进行比较</span></span><br><span class="line"><span class="keyword">while</span> (insertIndex &gt;= <span class="number">0</span> &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span><br><span class="line">arr[insertIndex + <span class="number">1</span>] = arr[insertIndex];</span><br><span class="line">insertIndex--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">arr[insertIndex + <span class="number">1</span>] = insertVal;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"第1轮插入"</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二轮插入</span></span><br><span class="line"><span class="comment">// 定义待插入的数</span></span><br><span class="line">insertVal = arr[<span class="number">2</span>];</span><br><span class="line">insertIndex = (<span class="number">2</span> - <span class="number">1</span>);<span class="comment">// 即arr[2]的前面这个数的下标</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 给 insertVal 找到插入的位置</span></span><br><span class="line"><span class="comment">// -&gt; insertIndex &gt;= 0 保证在给insertVal找插入位置,不越界</span></span><br><span class="line"><span class="comment">// -&gt; 将需要插入有序数组的数与有序数组中的每个数字进行比较</span></span><br><span class="line"><span class="keyword">while</span> (insertIndex &gt;= <span class="number">0</span> &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span><br><span class="line">arr[insertIndex + <span class="number">1</span>] = arr[insertIndex];</span><br><span class="line">insertIndex--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">arr[insertIndex + <span class="number">1</span>] = insertVal;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"第2轮插入"</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三轮插入</span></span><br><span class="line"><span class="comment">// 定义待插入的数</span></span><br><span class="line">insertVal = arr[<span class="number">3</span>];</span><br><span class="line">insertIndex = (<span class="number">3</span> - <span class="number">1</span>);<span class="comment">// 即arr[3]的前面这个数的下标</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 给 insertVal 找到插入的位置</span></span><br><span class="line"><span class="comment">// -&gt; insertIndex &gt;= 0 保证在给insertVal找插入位置,不越界</span></span><br><span class="line"><span class="comment">// -&gt; 将需要插入有序数组的数与有序数组中的每个数字进行比较</span></span><br><span class="line"><span class="keyword">while</span> (insertIndex &gt;= <span class="number">0</span> &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span><br><span class="line">arr[insertIndex + <span class="number">1</span>] = arr[insertIndex];</span><br><span class="line">insertIndex--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">arr[insertIndex + <span class="number">1</span>] = insertVal;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"第3轮插入"</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="代码手动部分改为循环"><a href="#代码手动部分改为循环" class="headerlink" title="代码手动部分改为循环"></a>代码手动部分改为循环</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InsertSort</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> arr[] = &#123;<span class="number">101</span>, <span class="number">34</span>, <span class="number">119</span>, <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line"><span class="comment">// 想象一下:</span></span><br><span class="line"><span class="comment">// ==&gt; 扑克牌中的抓牌</span></span><br><span class="line"><span class="comment">// ==&gt; 从牌堆(无序数组)中抽牌,插入到手牌上(有序数组)</span></span><br><span class="line"><span class="comment">// ==&gt; 要插入的牌,按顺序和手牌进行比较</span></span><br><span class="line"><span class="comment">// ==&gt; ==&gt; 1. 和手牌(最右边 - 0)的牌进行比较</span></span><br><span class="line"><span class="comment">// ==&gt; ==&gt; ==&gt; 插入的牌较大,退出循环,然后将牌插入被比较牌的右边</span></span><br><span class="line"><span class="comment">// ==&gt; ==&gt; ==&gt; 插入的牌较小,则将被比较的牌向右边移动一位</span></span><br><span class="line"><span class="comment">// ==&gt; ==&gt; 2. 和手牌(最右边 - 1)的牌进行比较</span></span><br><span class="line"><span class="comment">// ==&gt; ==&gt; ==&gt; 插入的牌较大,退出循环,然后将牌插入被比较牌的右边(前一次循环右移了一位,所以被插入牌右边永远有空位)</span></span><br><span class="line"><span class="comment">// ==&gt; ==&gt; ==&gt; 插入的牌较小,则将被比较的牌向右边移动一位</span></span><br><span class="line"><span class="comment">// ==&gt; ==&gt; 3. 和手牌(最右边 - 2)的牌进行比较</span></span><br><span class="line"><span class="comment">// ==&gt; ==&gt; ==&gt; 插入的牌较大,退出循环,然后将牌插入被比较牌的右边(前一次循环右移了一位,所以被插入牌右边永远有空位)</span></span><br><span class="line"><span class="comment">// ==&gt; ==&gt; ==&gt; 插入的牌较小,则将被比较的牌向右边移动一位</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> insertVal = arr[i];<span class="comment">// 要插入的牌</span></span><br><span class="line"><span class="keyword">int</span> insertIndex = (i - <span class="number">1</span>);<span class="comment">// 手牌数组的最大长度</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 给 insertVal(要插入的牌) 找到插入的位置</span></span><br><span class="line"><span class="comment">// ==&gt; insertIndex &gt;= 0 保证在给insertVal找插入位置,不越界</span></span><br><span class="line"><span class="comment">// ==&gt; 将需要插入有序数组的数与有序数组中的每个数字进行比较</span></span><br><span class="line"><span class="comment">// ==&gt; insertVal &lt; arr[insertIndex] 判断要插入的牌比手牌上哪一张牌小</span></span><br><span class="line"><span class="keyword">while</span> (insertIndex &gt;= <span class="number">0</span> &amp;&amp; insertVal &lt; arr[insertIndex]) &#123;</span><br><span class="line"><span class="comment">// 插入的牌较小,则将被比较的牌向右边移动一位,当前位置被空出来</span></span><br><span class="line">arr[insertIndex + <span class="number">1</span>] = arr[insertIndex];</span><br><span class="line">insertIndex--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 插入的牌较大,退出循环,然后将牌插入被比较牌的右边(前一次循环右移了一位,所以被插入牌右边永远有空位)</span></span><br><span class="line">arr[insertIndex + <span class="number">1</span>] = insertVal;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"第"</span> + i + <span class="string">"轮插入"</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现选择排序</title>
      <link href="/2020/04/20/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/"/>
      <url>/2020/04/20/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%80%89%E6%8B%A9%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h1><p>选择排序也属于内部排序法,是从欲排序的数据中,按指定的规则选出某一元素,再依规定交换位置后达到排序的目的</p><h1 id="选择排序的思想"><a href="#选择排序的思想" class="headerlink" title="选择排序的思想"></a>选择排序的思想</h1><h2 id="原始的数组"><a href="#原始的数组" class="headerlink" title="原始的数组"></a>原始的数组</h2><p>101, 34, 119, 1</p><h2 id="第一轮排序"><a href="#第一轮排序" class="headerlink" title="第一轮排序"></a>第一轮排序</h2><p>对于数组<code>101, 34, 119, 1</code>来说,假定第一个元素101为最小,即设定min=101</p><ol><li>用101与34比较,因为<code>101 不小于 34</code>,所以最小值为34,即min=34</li><li>用34与119比较,因为<code>34 小于 119</code>,继续</li><li>用34与1比较,因为<code>34 不小于 1</code>,所以最小值为1,即min=1</li><li>将数组的第一位与最小值所在位置进行交换,所以得到数组<code>1, 34, 119, 101</code></li></ol><h2 id="第二轮排序"><a href="#第二轮排序" class="headerlink" title="第二轮排序"></a>第二轮排序</h2><p>对于数组<code>1, 34, 119, 101</code>来说,假定第二个元素34为最小,即设定min=34</p><ol><li>用34与119比较,因为<code>34 小于 119</code>,继续</li><li>用34与101比较,因为<code>34 小于 101</code>,继续</li><li>将数组的第二位与最小值所在位置进行交换(这一轮不交换),所以得到数组<code>1, 34, 119, 101</code></li></ol><h2 id="第三轮排序"><a href="#第三轮排序" class="headerlink" title="第三轮排序"></a>第三轮排序</h2><p>对于数组<code>1, 34, 119, 101</code>来说,假定第三个元素119为最小,即设定min=119</p><ol><li>用119与101比较,因为<code>119 不小于 101</code>,所以最小值为101,即min=101</li><li>将数组的第三位与最小值所在位置进行交换,所以得到数组<code>1, 34, 101, 119</code></li></ol><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ol><li>选择排序一共需要进行<code>数组大小 - 1</code>轮排序</li><li>每一轮排序,又是一个循环<ul><li>第n轮则假定数组中第n位置的这个数是最小的数</li><li>然后和n后的每个数进行比较,如果发现当前数更小的数,就重新确定最小数,并得到下标</li><li>当遍历到数组最后的时,就得到第n轮时的最小数和下标</li><li>交换,第n轮就将当前的最小值与数组中的第n个数交换</li></ul></li></ol><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="代码具体演示上述过程"><a href="#代码具体演示上述过程" class="headerlink" title="代码具体演示上述过程"></a>代码具体演示上述过程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectSort</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> arr[] = &#123;<span class="number">101</span>, <span class="number">34</span>, <span class="number">119</span>, <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用选择排序将数组从小到大进行排序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 第一轮排序</span></span><br><span class="line"><span class="comment">// 假定最小值与最小值的下标</span></span><br><span class="line"><span class="keyword">int</span> minIndex = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> min = arr[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找到数组中最小的数</span></span><br><span class="line"><span class="comment">// 从最小数的后一个数开始比较</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span> + <span class="number">1</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (min &gt; arr[j]) &#123;</span><br><span class="line">min = arr[j];</span><br><span class="line">minIndex = j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一轮排序,所以将最小值,与第一位数字交换</span></span><br><span class="line"><span class="keyword">if</span> (minIndex != <span class="number">0</span>) &#123;</span><br><span class="line">arr[minIndex] = arr[<span class="number">0</span>];</span><br><span class="line">arr[<span class="number">0</span>] = min;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"第一轮后~~"</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二轮排序</span></span><br><span class="line"><span class="comment">// 由于数组中的第一个数已经排好了,接下去是在剩下的数据中找到最小的数</span></span><br><span class="line"><span class="comment">// 假定最小值是数字中的第二个数字</span></span><br><span class="line">minIndex = <span class="number">1</span>;</span><br><span class="line">min = arr[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找到数组中最小的数</span></span><br><span class="line"><span class="comment">// 从最小数的后一个数开始比较</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span> + <span class="number">1</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (min &gt; arr[j]) &#123;</span><br><span class="line">min = arr[j];</span><br><span class="line">minIndex = j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二轮排序,所以将最小值,与第二位数字交换</span></span><br><span class="line"><span class="keyword">if</span> (minIndex != <span class="number">0</span>) &#123;</span><br><span class="line">arr[minIndex] = arr[<span class="number">1</span>];</span><br><span class="line">arr[<span class="number">1</span>] = min;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"第二轮后~~"</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三轮排序</span></span><br><span class="line"><span class="comment">// 由于数组中的第一个数和第二个数已经排好了,接下去是在剩下的数据中找到最小的数</span></span><br><span class="line"><span class="comment">// 假定最小值是数字中的第三个数字</span></span><br><span class="line">minIndex = <span class="number">2</span>;</span><br><span class="line">min = arr[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找到数组中最小的数</span></span><br><span class="line"><span class="comment">// 从最小数的后一个数开始比较</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">2</span> + <span class="number">1</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (min &gt; arr[j]) &#123;</span><br><span class="line">min = arr[j];</span><br><span class="line">minIndex = j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三轮排序,所以将最小值,与第三位数字交换</span></span><br><span class="line"><span class="keyword">if</span> (minIndex != <span class="number">0</span>) &#123;</span><br><span class="line">arr[minIndex] = arr[<span class="number">2</span>];</span><br><span class="line">arr[<span class="number">2</span>] = min;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"第三轮后~~"</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="手动部分用循环表示"><a href="#手动部分用循环表示" class="headerlink" title="手动部分用循环表示"></a>手动部分用循环表示</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectSort</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> arr[] = &#123;<span class="number">101</span>, <span class="number">34</span>, <span class="number">119</span>, <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用选择排序将数组从小到大进行排序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line"><span class="comment">// 第一轮排序</span></span><br><span class="line"><span class="comment">// 假定最小值与最小值的下标</span></span><br><span class="line"><span class="keyword">int</span> minIndex = i;</span><br><span class="line"><span class="keyword">int</span> min = arr[i];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找到数组中最小的数</span></span><br><span class="line"><span class="comment">// 从最小数的后一个数开始比较</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; arr.length; j++) &#123;</span><br><span class="line"><span class="keyword">if</span> (min &gt; arr[j]) &#123;</span><br><span class="line">min = arr[j];</span><br><span class="line">minIndex = j;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第一轮排序,所以将最小值,与第一位数字交换</span></span><br><span class="line"><span class="keyword">if</span> (minIndex != <span class="number">0</span>) &#123;</span><br><span class="line">arr[minIndex] = arr[i];</span><br><span class="line">arr[i] = min;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"第"</span> + i + <span class="string">"轮后~~"</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现冒泡排序</title>
      <link href="/2020/04/16/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/"/>
      <url>/2020/04/16/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="冒泡排序思路"><a href="#冒泡排序思路" class="headerlink" title="冒泡排序思路"></a>冒泡排序思路</h1><p>通过对<code>待排序序列</code>从前向后(从下标较小的元素开始),<strong>依次比较相邻元素的值,若发现逆序则交换</strong>,使较大的元素逐渐从前移向后部,就像水底下的气泡一样逐渐向上冒</p><h1 id="冒泡排序-未优化"><a href="#冒泡排序-未优化" class="headerlink" title="冒泡排序(未优化)"></a>冒泡排序(未优化)</h1><h2 id="手动冒泡排序"><a href="#手动冒泡排序" class="headerlink" title="手动冒泡排序"></a>手动冒泡排序</h2><p>待排序序列: 3, 9, -1, 10, 20</p><p>第一趟排序</p><ul><li>3, 9, -1, 10, 20 ==&gt; 比较3和9</li><li>3, 9, -1, 10, 20 ==&gt; 比较9和-1,逆序所以交换 ==&gt; 3, -1, 9, 10, 20</li><li>3, -1, 9, 10, 20 ==&gt; 比较9和10</li><li>3, -1, 9, 10, <strong>20</strong> ==&gt; 比较10和20,第一趟结束后,序列的最后一个(此时为20)为最大元素</li></ul><p>第二趟排序</p><ul><li>3, -1, 9, 10, 20 ==&gt; 比较3和-1,逆序所以交换 ==&gt; -1, 3, 9, 10, 20 </li><li>-1, 3, 9, 10, 20    // …</li><li>-1, 3, 9, <strong>10, 20</strong>    // 比较9和10,第二趟结束后,序列的倒数第二个(此时为10)为倒数第二大元素</li></ul><p>第三趟排序</p><ul><li>-1, 3, 9, 10, 20</li><li>-1, 3, 9, 10, 20</li><li>-1, 3, <strong>9, 10, 20</strong>    // 比较3和9,第三趟结束后,9是倒数第三大元素</li></ul><p>第四趟排序</p><ul><li>-1, <strong>3, 9, 10, 20</strong>    // 比较-1和3,第四趟结束,全部排好了</li></ul><p>总结</p><ol><li>一共进行<code>(数组大小 - 1)</code>次大的循环</li><li>每一趟排序的次数在逐渐减少</li></ol><h2 id="用代码演示一下演变过程"><a href="#用代码演示一下演变过程" class="headerlink" title="用代码演示一下演变过程"></a>用代码演示一下演变过程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BubbleSort</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> arr[] = &#123;<span class="number">3</span>, <span class="number">9</span>, -<span class="number">1</span>, <span class="number">10</span>, <span class="number">20</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为了容易理解,演示一下冒泡排序的演变过程</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> temp;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第1趟排序后的数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arr.length - <span class="number">1</span> - <span class="number">0</span>; j++) &#123;</span><br><span class="line"><span class="comment">// 如果前面数比后面数大,则交换</span></span><br><span class="line"><span class="keyword">if</span> (arr[j] &gt; arr[j+<span class="number">1</span>] ) &#123;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"第1趟排序后的数组"</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第2趟排序后的数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arr.length - <span class="number">1</span> - <span class="number">1</span>; j++) &#123;</span><br><span class="line"><span class="comment">// 如果前面数比后面数大,则交换</span></span><br><span class="line"><span class="keyword">if</span> (arr[j] &gt; arr[j+<span class="number">1</span>] ) &#123;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"第2趟排序后的数组"</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第3趟排序后的数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arr.length - <span class="number">1</span> - <span class="number">2</span>; j++) &#123;</span><br><span class="line"><span class="comment">// 如果前面数比后面数大,则交换</span></span><br><span class="line"><span class="keyword">if</span> (arr[j] &gt; arr[j+<span class="number">1</span>] ) &#123;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"第3趟排序后的数组"</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第4趟排序后的数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arr.length - <span class="number">1</span> - <span class="number">3</span>; j++) &#123;</span><br><span class="line"><span class="comment">// 如果前面数比后面数大,则交换</span></span><br><span class="line"><span class="keyword">if</span> (arr[j] &gt; arr[j+<span class="number">1</span>] ) &#123;</span><br><span class="line">temp = arr[j];</span><br><span class="line">arr[j] = arr[j+<span class="number">1</span>];</span><br><span class="line">arr[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"第4趟排序后的数组"</span>);</span><br><span class="line">System.out.println(Arrays.toString(arr));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="实现冒泡排序-未优化"><a href="#实现冒泡排序-未优化" class="headerlink" title="实现冒泡排序(未优化)"></a>实现冒泡排序(未优化)</h2><ol><li><p>实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BubbleSort</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> needSortArray[] = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为了容易理解,演示一下冒泡排序的演变过程</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BubbleSort</span><span class="params">(<span class="keyword">int</span>[] needSortArray)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.needSortArray = needSortArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> temp;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"================排序前数组================"</span>);</span><br><span class="line">System.out.println(Arrays.toString(needSortArray));</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; needSortArray.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line"><span class="comment">// 第i趟排序后的数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; needSortArray.length - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line"><span class="comment">// 如果前面数比后面数大,则交换</span></span><br><span class="line"><span class="keyword">if</span> (needSortArray[j] &gt; needSortArray[j+<span class="number">1</span>] ) &#123;</span><br><span class="line">temp = needSortArray[j];</span><br><span class="line">needSortArray[j] = needSortArray[j+<span class="number">1</span>];</span><br><span class="line">needSortArray[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//System.out.println("第" + (i + 1) + "趟排序后的数组");</span></span><br><span class="line"><span class="comment">//System.out.println(Arrays.toString(needSortArray));</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"================排序后数组================"</span>);</span><br><span class="line">System.out.println(Arrays.toString(needSortArray));</span><br><span class="line">System.out.println(<span class="string">"========================================"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BubbleSortTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> arr[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">arr[i] = (<span class="keyword">int</span>) (Math.random()*<span class="number">800000</span>);<span class="comment">// 生成一个[0,800000)的数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BubbleSort bubbleSort = <span class="keyword">new</span> BubbleSort(arr);</span><br><span class="line">bubbleSort.sort();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="优化上述代码"><a href="#优化上述代码" class="headerlink" title="优化上述代码"></a>优化上述代码</h1><p>因为排序的过程中,各元素不断接近自己的位置,<strong>如果一趟比较下来没有进行过交换,就说明序列有序</strong>,因此可以在排序过程中设置一个flag判断元素是否进行过交换.从而减少不必要的比较</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BubbleSort</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> needSortArray[] = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为了容易理解,演示一下冒泡排序的演变过程</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BubbleSort</span><span class="params">(<span class="keyword">int</span>[] needSortArray)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.needSortArray = needSortArray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> temp = <span class="number">0</span>;<span class="comment">// 临时变量</span></span><br><span class="line"><span class="keyword">boolean</span> flag = <span class="keyword">false</span>;<span class="comment">// 标识变量,表示是否进行过交换</span></span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"================排序前数组================"</span>);</span><br><span class="line">System.out.println(Arrays.toString(needSortArray));</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; needSortArray.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line"><span class="comment">// 第i趟排序后的数组</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; needSortArray.length - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line"><span class="comment">// 如果前面数比后面数大,则交换</span></span><br><span class="line"><span class="keyword">if</span> (needSortArray[j] &gt; needSortArray[j+<span class="number">1</span>] ) &#123;</span><br><span class="line"></span><br><span class="line">flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">temp = needSortArray[j];</span><br><span class="line">needSortArray[j] = needSortArray[j+<span class="number">1</span>];</span><br><span class="line">needSortArray[j+<span class="number">1</span>] = temp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//System.out.println("第" + (i + 1) + "趟排序后的数组");</span></span><br><span class="line"><span class="comment">//System.out.println(Arrays.toString(needSortArray));</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!flag) &#123;<span class="comment">// 在一趟排序中,一次交换都没有发生过</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">flag = <span class="keyword">false</span>;<span class="comment">// 重置flag!!!,进行下次判断</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"================排序后数组================"</span>);</span><br><span class="line">System.out.println(Arrays.toString(needSortArray));</span><br><span class="line">System.out.println(<span class="string">"========================================"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>排序算法的与分类</title>
      <link href="/2020/04/16/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E7%9A%84%E4%B8%8E%E5%88%86%E7%B1%BB/"/>
      <url>/2020/04/16/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E7%9A%84%E4%B8%8E%E5%88%86%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="排序算法的介绍"><a href="#排序算法的介绍" class="headerlink" title="排序算法的介绍"></a>排序算法的介绍</h1><p>排序也称排序算法(Sort Algorithm),排序是将一组数据,依指定的顺序进行排列的过程</p><h1 id="排序的分类："><a href="#排序的分类：" class="headerlink" title="排序的分类："></a>排序的分类：</h1><ol><li>内部排序: 指将需要处理的所有数据都加载到内部存储器(内存)中进行排序。</li><li>外部排序法：数据量过大，无法全部加载到内存中，需要借助外部存储(文件等)进行排序。</li><li>常见的排序算法分类如下:<br><img src="/images/2020/04/20200415001.png" alt></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>尾递归</title>
      <link href="/2020/04/15/%E5%B0%BE%E9%80%92%E5%BD%92/"/>
      <url>/2020/04/15/%E5%B0%BE%E9%80%92%E5%BD%92/</url>
      
        <content type="html"><![CDATA[<h1 id="要说尾递归先理解尾调用"><a href="#要说尾递归先理解尾调用" class="headerlink" title="要说尾递归先理解尾调用"></a>要说尾递归先理解尾调用</h1><h2 id="尾调用定义"><a href="#尾调用定义" class="headerlink" title="尾调用定义"></a>尾调用定义</h2><blockquote><p>   来自<a href="https://zh.wikipedia.org/wiki/%E5%B0%BE%E8%B0%83%E7%94%A8" target="_blank" rel="noopener">尾调用维基百科</a>    在计算机学里，尾调用是指一个函数里的最后一个动作是返回一个函数的调用结果的情形，即最后一步新调用的返回值直接被当前函数的返回结果</p></blockquote><h3 id="代码形式上表现为"><a href="#代码形式上表现为" class="headerlink" title="代码形式上表现为"></a>代码形式上表现为</h3><p>一个函数执行的最后是调用另一个函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//仅举例,没有使用特定语言的语法</span><br><span class="line">function f(x) &#123;</span><br><span class="line">    a(x);</span><br><span class="line">    b(x);</span><br><span class="line">    return g(x);    //函数执行的最后调用另一个函数</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="核心理解"><a href="#核心理解" class="headerlink" title="核心理解"></a>核心理解</h3><p>就是看一个函数在调用另一个函数得时候，<strong>本身是否可以被“释放”</strong></p><h1 id="判断-下列那种调用时尾调用"><a href="#判断-下列那种调用时尾调用" class="headerlink" title="判断:下列那种调用时尾调用"></a>判断:下列那种调用时尾调用</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 情况一</span><br><span class="line">function f(x)</span><br><span class="line">&#123;</span><br><span class="line">    int a = g(x);</span><br><span class="line">    return a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 情况二</span><br><span class="line">function f(x)</span><br><span class="line">&#123;</span><br><span class="line">    return 3+g(x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 情况三</span><br><span class="line">function f(x)</span><br><span class="line">&#123;</span><br><span class="line">    if (x &gt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        return g(x);</span><br><span class="line">    &#125;</span><br><span class="line">    return r(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>答案</strong></p><ul><li>情况一是调用函数g(x)之后，还有别的操作，所以不属于尾调用，即使语义一样，因为要得到a得结果，需要等待g(x)函数，所以f(x)无法释放。</li><li>情况二在调用后也有别的操作，所以不属于尾调用，同理f(x)也是无法释放，即使写在同一行。</li><li>情况三中，不管x取什么值，最后一步操作都是函数调用，所以属于尾调用。</li></ul><h1 id="尾调用有什么好处"><a href="#尾调用有什么好处" class="headerlink" title="尾调用有什么好处"></a>尾调用有什么好处</h1><h2 id="先看普通调用的过程"><a href="#先看普通调用的过程" class="headerlink" title="先看普通调用的过程"></a>先看普通调用的过程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//用如下三个函数举例</span><br><span class="line">function f(x)</span><br><span class="line">&#123;</span><br><span class="line">    res = g(x);</span><br><span class="line">    return res+1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function g(x)</span><br><span class="line">&#123;</span><br><span class="line">    res = r(x);</span><br><span class="line">    return res + 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function r(x)</span><br><span class="line">&#123;</span><br><span class="line">    res = x + 1;</span><br><span class="line">    return res + 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/2020/04/20200414005.png" alt></p><p><strong>文字描述</strong><br>函数调用</p><ol><li>调用f(x)，在内存形成一个<code>调用记录</code>，又称<code>调用帧（call frame）</code>，保存调用位置和内部变量等信息。</li><li>函数f(x)内调用函数g(x)，那么在f(x)的调用帧上方会形成一个g(x)的调用帧</li><li>函数g(x)内部还调用函数r(x)，所以在g(x)的调用帧上方会形成一个r(x)的调用帧</li><li>函数r(x)调用结束，将结果返回给g(x)，同时函数r(x)结束并“消失”</li><li>同理，g(x)调用结束并“消失”</li><li>最后到f(x)，结束并消失（图中没有体现）<br>上述调用过程中，所有的调用帧会在一个<code>调用栈（call stack）</code>中</li></ol><blockquote><p>   <strong>上述过程维基百科中的描述</strong>    在程序运行时，计算机会为应用程序分配一定的内存空间；应用程序则会自行分配所获得的内存空间，其中一部分被用于记录程序中正在调用的各个函数的运行情况，这就是函数的调用栈。常规的函数调用总是会在调用栈最上层添加一个新的堆栈帧（stack frame，也翻译为“栈帧”或简称为“帧”），这个过程被称作“入栈”或“压栈”（意即把新的帧压在栈顶）。</p></blockquote><h2 id="上述调用过程中有什么风险"><a href="#上述调用过程中有什么风险" class="headerlink" title="上述调用过程中有什么风险"></a>上述调用过程中有什么风险</h2><p>如下图，当函数的<strong>调用层数非常多时</strong>，调用栈会消耗不少内存，甚至会<strong>撑爆内存空间（栈溢出）</strong>，造成程序严重卡顿或意外崩溃。</p><p><img src="/images/2020/04/20200414006.png" alt></p><h2 id="尾调用解决上述风险"><a href="#尾调用解决上述风险" class="headerlink" title="尾调用解决上述风险"></a>尾调用解决上述风险</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//这是一个尾调用</span><br><span class="line">function f() &#123;</span><br><span class="line">  m = 1;</span><br><span class="line">  n = 2;</span><br><span class="line">  return g(m + n);</span><br><span class="line">&#125;</span><br><span class="line">f();</span><br><span class="line"></span><br><span class="line">// 等同于</span><br><span class="line">function f() &#123;</span><br><span class="line">  return g(3);</span><br><span class="line">&#125;</span><br><span class="line">f();</span><br><span class="line"></span><br><span class="line">// 等同于</span><br><span class="line">g(3);</span><br></pre></td></tr></table></figure><p>上述代码,我们可以看到，我们调用g之后，和f就没有任何关系了，函数f就结束了，所以执行到最后一步，完全可以删除 f() 的调用记录，只保留 g(3) 的调用记录，</p><p><strong>尾调用的意义</strong><br>如果所有函数都是尾调用，那么完全可以做到每次执行时，调用帧为一，这将大大节省内存</p><h1 id="什么是尾递归"><a href="#什么是尾递归" class="headerlink" title="什么是尾递归"></a>什么是尾递归</h1><p>尾递归 = 尾调用 + 递归</p><ul><li>递归：函数调用自身，称为递归</li><li>尾调用：函数最后是调用另一个函数<br>所以，尾递归可以总结为：一个函数在其内部最后一步调用其自身<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用python举例</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tailrecsum</span><span class="params">(x, running_total=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> running_total</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment">#tailrecsum函数得最后一步是调用另一个函数，其中这个“另一个函数”是其自身</span></span><br><span class="line">        <span class="keyword">return</span> tailrecsum(x - <span class="number">1</span>, running_total + x)</span><br></pre></td></tr></table></figure></li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://zh.wikipedia.org/wiki/%E5%B0%BE%E8%B0%83%E7%94%A8" target="_blank" rel="noopener">尾调用</a><br><a href="http://www.ruanyifeng.com/blog/2015/04/tail-call.html" target="_blank" rel="noopener">尾调用优化</a><br><a href="http://raganwald.com/2015/02/07/tail-calls-defult-arguments-recycling.html" target="_blank" rel="noopener">Tail Calls, Default Arguments, and Excessive Recycling in ES-6</a><br><a href="https://blog.csdn.net/longintchar/article/details/78998081" target="_blank" rel="noopener">什么是尾调用</a><br><a href="http://www.voidcn.com/article/p-qdsabmbw-xk.html" target="_blank" rel="noopener">漫谈递归：从斐波那契开始了解尾递归</a></p>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现递归</title>
      <link href="/2020/04/15/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%80%92%E5%BD%92/"/>
      <url>/2020/04/15/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%80%92%E5%BD%92/</url>
      
        <content type="html"><![CDATA[<h1 id="递归的概念"><a href="#递归的概念" class="headerlink" title="递归的概念"></a>递归的概念</h1><ul><li>简单的说,递归就是方法自己调用自己,每次调用时传入不同的变量</li></ul><h1 id="递归的好处"><a href="#递归的好处" class="headerlink" title="递归的好处"></a>递归的好处</h1><ul><li>递归有助于编程者解决复杂的问题,同时可以让代码变得简洁</li></ul><h1 id="递归调用规则"><a href="#递归调用规则" class="headerlink" title="递归调用规则"></a>递归调用规则</h1><ol><li>当程序执行到一个方法时,就会开辟一个独立的空间(栈)</li><li>每个空间的数据(局部变量),是独立的</li></ol><p><img src="/images/2020/04/20200414004.png" alt></p><p>代码演示</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.young.recursion;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RecursionTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// test(10);</span></span><br><span class="line">        <span class="keyword">int</span> factorial = factorial(<span class="number">3</span>);</span><br><span class="line">        System.out.println(factorial);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//打印问题</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            test(n - <span class="number">1</span>);</span><br><span class="line">        &#125;<span class="comment">//else &#123;</span></span><br><span class="line">        System.out.println(<span class="string">"n="</span> + n);</span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//阶乘问题</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">factorial</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> factorial(n - <span class="number">1</span>) * n;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="递归能解决什么样的问题"><a href="#递归能解决什么样的问题" class="headerlink" title="递归能解决什么样的问题"></a>递归能解决什么样的问题</h1><ol><li><p>各种数学问题</p><ul><li>八皇后问题</li><li>汉诺塔</li><li>阶乘问题</li><li>迷宫问题</li><li>球和篮子的问题(google变成大赛)</li></ul></li><li><p>各种算法中也会使用到递归</p><ul><li>快排</li><li>归并排序</li><li>二分查找</li><li>分治算法</li></ul></li><li><p>将用栈解决的问题,用递归代码会比较简洁</p></li></ol><h1 id="递归需要遵守的重要规则"><a href="#递归需要遵守的重要规则" class="headerlink" title="递归需要遵守的重要规则"></a>递归需要遵守的重要规则</h1><ol><li>执行一个方法时,就创建一个新的受保护的独立空间(栈空间)</li><li>方法的局部变量是独立的,不会相互影响</li><li>如果方法中使用的是引用类型变量(比如数组),就会共享该引用类型的数据</li><li>递归必须向退出递归的条件逼近,否则就是无限递归,会出现<code>StackOverflowError</code>错误</li><li>当一个方法执行完毕,或者遇到return,就会返回,遵守谁调用就将结果返回给谁,同时当方法执行完毕或者返回时,该方法也就执行完毕</li></ol><h1 id="迷宫问题"><a href="#迷宫问题" class="headerlink" title="迷宫问题"></a>迷宫问题</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MiGong</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//先创建一个二维数组，模拟迷宫地图</span></span><br><span class="line"><span class="keyword">int</span>[][] map = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">8</span>][<span class="number">7</span>];</span><br><span class="line"><span class="comment">//使用1表示墙</span></span><br><span class="line"><span class="comment">//上下全部置为1</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">map[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">map[<span class="number">7</span>][i] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//左右全部置为1</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">map[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">map[i][<span class="number">6</span>] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置挡板, 1表示</span></span><br><span class="line">map[<span class="number">3</span>][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">map[<span class="number">3</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出地图</span></span><br><span class="line">System.out.println(<span class="string">"地图的情况"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">7</span>; j++) &#123;</span><br><span class="line">System.out.print(map[i][j] + <span class="string">" "</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用递归回溯给小球找路</span></span><br><span class="line">        setWay(map, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出新的地图,小球走过,并标识过的递归</span></span><br><span class="line">        System.out.println(<span class="string">"小球走过,并标识过地图的情况"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">7</span>; j++) &#123;</span><br><span class="line">                System.out.print(map[i][j] + <span class="string">" "</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    //使用递归回溯来给小球找路</span></span><br><span class="line"><span class="comment">    //说明</span></span><br><span class="line"><span class="comment">    //1. map表示地图</span></span><br><span class="line"><span class="comment">    //2. i,j 表示从地图的哪个位置开始出发(1,1)</span></span><br><span class="line"><span class="comment">    //3. 如果小球能到map[6][5]位置，则说明通路找到. .</span></span><br><span class="line"><span class="comment">    //4. 约定:当map[i][j] 为0表示该点没有走过当为1表示墙; 2表示通路可以走; 3表示该点已经走过，但是走不通</span></span><br><span class="line"><span class="comment">    //5. 在走迷宫时，需要确定-个策略(方法)：下-&gt;右-&gt;上-&gt;左 ，如果该点走不通，再回溯</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map 表示地图</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> i 从哪个位置开始找</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> j 从哪个位置开始找</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 如果找到通路,就返回true, 否则返回false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">setWay</span><span class="params">(<span class="keyword">int</span>[][] map, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//小球的位置是(6,5) 对应数组则是map[6][5]</span></span><br><span class="line">        <span class="keyword">if</span>(map[<span class="number">6</span>][<span class="number">5</span>] == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="comment">//到map[6][5]位置,说明球已找到</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//判断到地图map[i][j]是0，则代表这个点还没有走过</span></span><br><span class="line">            <span class="keyword">if</span> (map[i][j] == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//假设这个点是可以走通的，然后按照策略：下一&gt;右-&gt;上-&gt;左走</span></span><br><span class="line">                map[i][j] = <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">if</span> (setWay(map, i + <span class="number">1</span>, j)) &#123;<span class="comment">//向下走</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (setWay(map, i, j + <span class="number">1</span>)) &#123; <span class="comment">//向右走</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (setWay(map, <span class="number">1</span> - <span class="number">1</span>, j)) &#123; <span class="comment">//向上</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (setWay(map, i, j - <span class="number">1</span>)) &#123; <span class="comment">//向左走</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//说明该点是走不通，已经走过，是死路</span></span><br><span class="line">                    map[i][j] =<span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//如果map[i][j] != 0 ,可能是1, 2, 3</span></span><br><span class="line">                <span class="comment">//当为1表示墙; 2表示通路可以走; 3表示该点已经走过</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="八皇后问题"><a href="#八皇后问题" class="headerlink" title="八皇后问题"></a>八皇后问题</h1><h2 id="问题介绍"><a href="#问题介绍" class="headerlink" title="问题介绍"></a>问题介绍</h2><p>八皇后问题，是一个古老而著名的问题，是回溯算法的典型案例。该问题是国际西洋棋棋手马克斯·贝瑟尔于1848年提出：在8×8格的国际象棋上摆放八个皇后，使其不能互相攻击，即任意两个皇后都不能处于同一行、同一列或同一斜线上，问有多少种摆法。</p><h2 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h2><ol><li>第一个皇后先放第一行第一列</li><li>第二个皇后放在第二行第一列,然后判断是否OK,如果不OK,继续放在第二列,第三列,依次把所有列都放完,找到一个合适</li><li>继续放第三个皇后,还是第一列,第二列…,知道第八个皇后也能放在一个不冲突的位置,算是找到了一个正确解</li><li>当得到一个正确解时,在栈回退到上一个栈时,就会开始回溯,即将第一个皇后,放到第一列的所有正确解全部得到</li><li>然后回头继续第一个皇后放第二列,后面继续循环执行1,2,3,4的步骤</li></ol><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WolfQueen</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一共有多少个皇后（此时设置为8皇后在8X8棋盘，可以修改此值来设置N皇后问题）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> max = <span class="number">8</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 该数组保存结果，第一个皇后摆在array[0]列，第二个摆在array[1]列</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[max];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> WolfQueen().check(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * n代表当前是第几个皇后</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> n</span></span><br><span class="line"><span class="comment">     * 皇后n在array[n]列</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">check</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//终止条件是最后一行已经摆完，由于每摆一步都会校验是否有冲突，所以只要最后一行摆完，说明已经得到了一个正确解</span></span><br><span class="line">        <span class="keyword">if</span> (n == max) &#123;</span><br><span class="line">            print();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//从第一列开始放值，然后判断是否和本行本列本斜线有冲突，如果OK，就进入下一行的逻辑</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; max; i++) &#123;</span><br><span class="line">            array[n] = i;</span><br><span class="line">            <span class="keyword">if</span> (judge(n)) &#123;</span><br><span class="line">                check(n + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 判断我们放置的第n个皇后是否和前面已经摆放的皇后有冲突</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> n 表示第n个皇后</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">judge</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="comment">// array[i] == array[n]</span></span><br><span class="line">            <span class="comment">// -&gt; 判断第n个皇后和前面的皇后是否在同一列</span></span><br><span class="line">            <span class="comment">// Math.abs(n - i) == Math.abs(array[n] - array[i]</span></span><br><span class="line">            <span class="comment">// -&gt; 判断第n个皇后和前面的皇后是否在同一斜线</span></span><br><span class="line">            <span class="comment">// -&gt; 这是一个一次函数</span></span><br><span class="line">            <span class="comment">// -&gt; 总共数据就只有7个,所以只需满足|y1 - y2| == |x1 - x2|就能保证是一条斜线了</span></span><br><span class="line">            <span class="keyword">if</span> (array[i] == array[n] || Math.abs(n - i) == Math.abs(array[n] - array[i])) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">            System.out.print(array[i] + <span class="number">1</span> + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装kchmviewer用以打开chm文件</title>
      <link href="/2020/04/09/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85kchmviewer%E7%94%A8%E4%BB%A5%E6%89%93%E5%BC%80chm%E6%96%87%E4%BB%B6/"/>
      <url>/2020/04/09/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85kchmviewer%E7%94%A8%E4%BB%A5%E6%89%93%E5%BC%80chm%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="软件名称"><a href="#软件名称" class="headerlink" title="软件名称"></a>软件名称</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KchmViewer</span><br></pre></td></tr></table></figure><h1 id="软件介绍"><a href="#软件介绍" class="headerlink" title="软件介绍"></a>软件介绍</h1><blockquote><p>  <a href="http://www.ulduzsoft.com/linux/kchmviewer/" target="_blank" rel="noopener">http://www.ulduzsoft.com/linux/kchmviewer/</a></p></blockquote><blockquote><p>  Kchmviewer is a <strong>free</strong>, open-source CHM (aka MS HTML help) and EPUB viewer written in C++ for Unix, Mac and Windows systems. Unlike most existing CHM viewers for Unix, it uses Trolltech Qt widget library, and could optionally be compiled for better KDE integration. It does not require KDE, but may be compiled with KDE widget support. Since version 5.0 it uses the Webkit API to show the content.<br>  <strong>The main advantage of kchmviewer is the best support for non-English languages</strong>. Unlike other viewers, kchmviewer in most cases is able to correctly detect the chm file encoding and show it. It correctly shows the index and table of context in Russian, Spanish, Romanian, Korean, Chinese and Arabic help files, and with new search engine is able to search in any chm file no matter what language it is written.<br>  kchmviewer is written by George Yunaev, and is licensed under <strong>GNU General Public License version 3</strong>. It uses chmlib to handle the CHM files, and some ideas from xchm.</p></blockquote><h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><p>用以打开<code>.chm</code>文件</p><h1 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install kchmviewer</span><br></pre></td></tr></table></figure><h1 id="出现乱码如何处理"><a href="#出现乱码如何处理" class="headerlink" title="出现乱码如何处理"></a>出现乱码如何处理</h1><p><img src="/images/2020/04/20200409001.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中栈的「前缀」「中缀」「后缀」表达式</title>
      <link href="/2020/04/03/Java%E4%B8%AD%E6%A0%88%E7%9A%84%E3%80%8C%E5%89%8D%E7%BC%80%E3%80%8D%E3%80%8C%E4%B8%AD%E7%BC%80%E3%80%8D%E3%80%8C%E5%90%8E%E7%BC%80%E3%80%8D%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/2020/04/03/Java%E4%B8%AD%E6%A0%88%E7%9A%84%E3%80%8C%E5%89%8D%E7%BC%80%E3%80%8D%E3%80%8C%E4%B8%AD%E7%BC%80%E3%80%8D%E3%80%8C%E5%90%8E%E7%BC%80%E3%80%8D%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="前缀表达式-波兰表达式"><a href="#前缀表达式-波兰表达式" class="headerlink" title="前缀表达式(波兰表达式)"></a>前缀表达式(波兰表达式)</h1><h2 id="什么是前缀表达式"><a href="#什么是前缀表达式" class="headerlink" title="什么是前缀表达式"></a>什么是前缀表达式</h2><ol><li>前缀表达式又称之为波兰式,前缀表达式的运算符位于操作数之前</li><li>举例说明:<code>(3+4)*5-6</code>对应的前缀表达式就是<code>- * + 3 4 5 6</code></li></ol><h2 id="前缀表达式的计算机求值"><a href="#前缀表达式的计算机求值" class="headerlink" title="前缀表达式的计算机求值"></a>前缀表达式的计算机求值</h2><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ol><li>从右至左扫描表达式</li><li>遇到数字时,将数字压入堆栈</li><li>遇到运算符时,弹出栈顶的两个数,用运算符对它们做相应的计算(栈顶元素和次栈顶元素),并将结果入栈</li><li>重复上述过程,直到表达式最左端</li><li>最后运算得出的值即为表达式的结果</li></ol><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><p>举例说明:<code>(3+4)*5-6</code>对应的前缀表达式就是<code>- * + 3 4 5 6</code>,针对前缀表达式求值步骤如下:</p><ol><li>从右至左扫描</li><li>遇到数字<code>6,5,4,3</code>,将数字压入栈</li><li>遇到<code>+</code>运算符,因此弹出3和4(3为栈顶元素,4为次栈顶元素),计算出3+4的值,得7,再将7入栈</li><li>接下来,是<code>*</code>运算符,因此弹出7和5,计算出<code>7*5=35</code>,将35入栈</li><li>最后是<code>-</code>运算符,计算出<code>35-6</code>的值,即29,由此得出最终结果</li></ol><h1 id="中缀表达式"><a href="#中缀表达式" class="headerlink" title="中缀表达式"></a>中缀表达式</h1><h2 id="什么是中缀表达式"><a href="#什么是中缀表达式" class="headerlink" title="什么是中缀表达式"></a>什么是中缀表达式</h2><ol><li>中缀表达式就是常见的运算表达式,如<code>(3+4)*5-6</code></li><li>中缀表达式的求值是我们人最熟悉的,但是对计算机来说却不好操作(如下案例),因此,在计算结果时,往往会将中缀表达式转成其他表达式来操作(一般转成后缀表达式)</li></ol><h2 id="使用栈-中缀表达式-来实现综合计算器"><a href="#使用栈-中缀表达式-来实现综合计算器" class="headerlink" title="使用栈(中缀表达式)来实现综合计算器"></a>使用栈(中缀表达式)来实现综合计算器</h2><p>计算:<code>7*2*2-5+1-5+3-3</code></p><h3 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h3><p><img src="/images/2020/04/20200402003.png" alt></p><ul><li>通过一个index来遍历我们的表达式</li><li>如果我们发现是一个数字,就直接入数栈</li><li>如果发现扫描到一个符号,就分如下情况<ul><li>如果当前符号栈为空,就直接入栈</li><li>如果当前符号栈有符号,就进行比较<ul><li>如果当前的操作符号优先级小于或者等于栈中的操作符,就需要从数栈中pop出两个数,从符号栈中pop出一个符号,进行运算,将得到的结果入数栈.然后将当前的操作符入符号栈</li><li>如果当前的操作符的优先级大于栈中的操作符,就直接入符号栈</li></ul></li></ul></li><li>当表达式扫描完毕,就顺序的从数栈和符号栈中pop出相应的数和符号,并运行</li><li>最后在数栈中只有一个数字,就是表达式的结果</li></ul><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="用数组模拟栈"><a href="#用数组模拟栈" class="headerlink" title="用数组模拟栈"></a>用数组模拟栈</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayStack</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxSize;<span class="comment">// 栈的大小</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] stack;<span class="comment">// 模拟栈用数组</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> top = -<span class="number">1</span>;<span class="comment">// top表示栈顶,初始化为-1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayStack</span><span class="params">(<span class="keyword">int</span> maxSize)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.maxSize = maxSize;</span><br><span class="line">stack = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="keyword">this</span>.maxSize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 栈满</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFull</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> top == maxSize - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 栈空</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> top == -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 入栈</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 先判断栈是否已满</span></span><br><span class="line"><span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">System.out.println(<span class="string">"栈满"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">top++;</span><br><span class="line">stack[top] = value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 出栈</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 先判断栈是否为空</span></span><br><span class="line"><span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"栈空"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取此时栈顶的值</span></span><br><span class="line"><span class="keyword">int</span> value = stack[top];</span><br><span class="line"><span class="comment">// 将栈顶的值置为默认</span></span><br><span class="line">stack[top] = <span class="number">0</span>;</span><br><span class="line">top--;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示栈</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">System.out.println(<span class="string">"栈空"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 需要从栈顶开始遍历</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = top; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">System.out.printf(<span class="string">"stack[%d]=%d\n"</span>, i, stack[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查看当前栈顶的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">peek</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> stack[top];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="计算器类"><a href="#计算器类" class="headerlink" title="计算器类"></a>计算器类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line"><span class="comment">// String expression = "5-3+3";</span></span><br><span class="line"><span class="keyword">private</span> String expression = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Calculator</span><span class="params">(String expression)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.expression = expression;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进行计算</span></span><br><span class="line"><span class="comment"> * 思路</span></span><br><span class="line"><span class="comment"> * 1.通过一个index来遍历我们的表达式</span></span><br><span class="line"><span class="comment"> * 2.如果我们发现是一个数字,就直接入数栈</span></span><br><span class="line"><span class="comment"> * 3.如果发现扫描到一个符号,就分如下情况</span></span><br><span class="line"><span class="comment"> * -&gt; 3.1 如果当前符号栈为空,就直接入栈</span></span><br><span class="line"><span class="comment"> * -&gt; 3.2 如果当前符号栈有符号,就进行比较</span></span><br><span class="line"><span class="comment"> * -&gt; -&gt; 3.3 如果当前的操作符号优先级小于或者等于栈中的操作符,就需要从数栈中pop出两个数,</span></span><br><span class="line"><span class="comment"> * -&gt; -&gt;  从符号栈中pop出一个符号,进行运算,将得到的结果入数栈.然后将当前的操作符入符号栈</span></span><br><span class="line"><span class="comment"> * -&gt; -&gt; 3.4 如果当前的操作符的优先级大于栈中的操作符,就直接入符号栈</span></span><br><span class="line"><span class="comment"> * 4.当表达式扫描完毕,就顺序的从数栈和符号栈中pop出相应的数和符号,并运行</span></span><br><span class="line"><span class="comment"> * 5.最后在数栈中只有一个数字,就是表达式的结果</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建两个栈,数栈和符号栈</span></span><br><span class="line">ArrayStack numStack = <span class="keyword">new</span> ArrayStack(<span class="number">10</span>);</span><br><span class="line">ArrayStack operStack = <span class="keyword">new</span> ArrayStack(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义需要的相关变量</span></span><br><span class="line"><span class="keyword">int</span> index = <span class="number">0</span>;<span class="comment">// 用于扫描</span></span><br><span class="line"><span class="keyword">int</span> num1 = <span class="number">0</span>; <span class="comment">// 先出栈的数</span></span><br><span class="line"><span class="keyword">int</span> num2 = <span class="number">0</span>;<span class="comment">// 后出栈的数</span></span><br><span class="line"><span class="keyword">int</span> oper = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> ch = <span class="string">' '</span>;<span class="comment">//将每次扫描的到的char保存到ch</span></span><br><span class="line"></span><br><span class="line">String keepNum = <span class="string">""</span>;<span class="comment">//用于拼接多位数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 扫描数字和符号进行入栈</span></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="comment">// 1.通过一个index来遍历我们的表达式</span></span><br><span class="line">ch = expression.substring(index, index+<span class="number">1</span>).charAt(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是数字还是字符</span></span><br><span class="line"><span class="comment">// 2.如果我们发现是一个数字,就直接入数栈</span></span><br><span class="line"><span class="comment">// 3.如果发现扫描到一个符号,就分如下情况</span></span><br><span class="line"><span class="keyword">if</span> (isOper(ch)) &#123;</span><br><span class="line"><span class="comment">// 3.1 如果当前符号栈为空,就直接入栈</span></span><br><span class="line"><span class="comment">// 3.2 如果当前符号栈有符号,就进行比较</span></span><br><span class="line"><span class="keyword">if</span> (operStack.isEmpty()) &#123;</span><br><span class="line">operStack.push(ch);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 3.3 如果当前的操作符号优先级小于或者等于栈中的操作符,</span></span><br><span class="line"><span class="comment">//   就需要从数栈中pop出两个数,从符号栈中pop出一个符号,进行运算,</span></span><br><span class="line"><span class="comment">//   将得到的结果入数栈.然后将当前的操作符入符号栈</span></span><br><span class="line"><span class="comment">// 3.4 如果当前的操作符的优先级大于栈中的操作符,就直接入符号栈</span></span><br><span class="line"><span class="keyword">if</span> (priority(ch) &lt;= priority(operStack.peek())) &#123;</span><br><span class="line">num1 = numStack.pop();</span><br><span class="line">num2 = numStack.pop();</span><br><span class="line">oper = operStack.pop();</span><br><span class="line"></span><br><span class="line">res = cal(num1, num2, oper);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把运算结果入数栈</span></span><br><span class="line">numStack.push(res);</span><br><span class="line"><span class="comment">// 然后将当前的操作符号入符号栈</span></span><br><span class="line">operStack.push(ch);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">operStack.push(ch);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 如果是数,则直接入栈</span></span><br><span class="line"><span class="comment">// -&gt; 这里需要处理数字是不是多位数</span></span><br><span class="line"><span class="comment">// 思路:</span></span><br><span class="line"><span class="comment">// -&gt; 1.当处理多位数时,不能当前字符是数就立即入栈,因为它后一位也可能是数字</span></span><br><span class="line"><span class="comment">// -&gt; 2.在处理数时,需要向expression的表达式的index后再看一位,如果是数就进行扫描,如果是符号才入栈</span></span><br><span class="line"><span class="comment">// -&gt; 3.因此,我们需要定义一个变量字符串,用于拼接</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理多位数</span></span><br><span class="line">keepNum += ch;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果ch已经是expression的最后一位,就直接入栈</span></span><br><span class="line"><span class="keyword">if</span> (index == expression.length() - <span class="number">1</span>) &#123;</span><br><span class="line">numStack.push(Integer.parseInt(keepNum));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 判断下一个字符是不是数字,如果是数字,就继续扫描,如果是运算符,则入栈</span></span><br><span class="line"><span class="keyword">if</span> (isOper(expression.substring(index+<span class="number">1</span>, index+<span class="number">2</span>).charAt(<span class="number">0</span>))) &#123;</span><br><span class="line">numStack.push(Integer.parseInt(keepNum));</span><br><span class="line"><span class="comment">// keepNum要记得清空</span></span><br><span class="line">keepNum = <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 让index + 1, 并判断是否扫描到expression最后</span></span><br><span class="line">index++;</span><br><span class="line"><span class="keyword">if</span> (index &gt;= expression.length()) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.当表达式扫描完毕,就顺序的从数栈和符号栈中pop出相应的数和符号,并运行</span></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="comment">// 如果符号栈为空,则计算到最后的结果,数栈中只有一个数字</span></span><br><span class="line"><span class="keyword">if</span> (operStack.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">num1 = numStack.pop();</span><br><span class="line">num2 = numStack.pop();</span><br><span class="line">oper = operStack.pop();</span><br><span class="line">res = cal(num1, num2, oper);</span><br><span class="line">numStack.push(res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5.最后在数栈中只有一个数字,就是表达式的结果</span></span><br><span class="line"><span class="keyword">int</span> calRes = numStack.pop();</span><br><span class="line">System.out.printf(<span class="string">"表达式%s = %d"</span>, expression, calRes);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断是不是一个运算符</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> val</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isOper</span><span class="params">(<span class="keyword">char</span> val)</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> val == <span class="string">'+'</span> || val == <span class="string">'-'</span> || val == <span class="string">'*'</span> || val == <span class="string">'/'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> num1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> num2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> oper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2, <span class="keyword">int</span> oper)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>; <span class="comment">// 用于存放计算结果</span></span><br><span class="line"><span class="keyword">switch</span> (oper) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'+'</span>:</span><br><span class="line">res = num1 + num2;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">'-'</span>:</span><br><span class="line">res = num2 - num1; <span class="comment">// 注意参数的顺序</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">'*'</span>:</span><br><span class="line">res = num2 * num1;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="string">'/'</span>:</span><br><span class="line">res = num2 / num1;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回运算符的优先级</span></span><br><span class="line"><span class="comment"> * -&gt; 暂时只考虑四则运算(+,-,*,/)</span></span><br><span class="line"><span class="comment"> * -&gt; 这里使用数字表示优先级</span></span><br><span class="line"><span class="comment"> * -&gt; 数字越大,则优先级越高</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> oper</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">priority</span><span class="params">(<span class="keyword">int</span> oper)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (oper == <span class="string">'*'</span> || oper == <span class="string">'/'</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (oper == <span class="string">'+'</span> || oper == <span class="string">'-'</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayStackTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算表达式的值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCalculator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">String expression = <span class="string">"5-3*3"</span>;</span><br><span class="line">Calculator calculator = <span class="keyword">new</span> Calculator(expression);</span><br><span class="line">calculator.calResult();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="后缀表达式"><a href="#后缀表达式" class="headerlink" title="后缀表达式"></a>后缀表达式</h1><h2 id="什么是后缀表达式"><a href="#什么是后缀表达式" class="headerlink" title="什么是后缀表达式"></a>什么是后缀表达式</h2><ol><li>后缀表达式又称之为逆波兰表达式,与前缀表达式相似,只是运算符位于操作数之后</li><li>后缀表达式举例说明:<code>(3+4)*5-6</code>对应的后缀表达式就是<code>3 4 + 5 * 6 -</code></li></ol><p>再比如</p><table><thead><tr><th>正常的表达式</th><th>逆波兰表达式</th></tr></thead><tbody><tr><td>a + b</td><td>a b +</td></tr><tr><td>a + (b - c)</td><td>a b c - +</td></tr><tr><td>a + (b - c) * d</td><td>a b c - d * +</td></tr><tr><td>a + d * (b - c)</td><td>a d b c - * +</td></tr><tr><td>a = 1 + 3</td><td>a 1 3 + =</td></tr></tbody></table><h2 id="后缀表达式的计算机求值"><a href="#后缀表达式的计算机求值" class="headerlink" title="后缀表达式的计算机求值"></a>后缀表达式的计算机求值</h2><h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><ol><li>从左至右扫描表达式</li><li>遇到数字时,将数字压入栈顶</li><li>遇到运算符时,弹出栈顶的两个数,用运算符对它们做相应的运算(次栈顶元素和栈顶元素),并将结果入栈</li><li>重复上述过程直到表达式最右端</li><li>最后运算得出的值即为表达式的结果</li></ol><h3 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h3><p>例如:<code>(3+4)*5-6</code>对应的后缀表达式就是<code>3 4 + 5 * 6 -</code>,针对后缀表达式求值步骤如下:</p><ol><li>从左至右扫描,将3和4压入堆栈</li><li>遇到<code>+</code>运算符,因此弹出4和3(4为栈顶元素,3为次栈顶元素),计算出3+4的值,得7,再将7入栈</li><li>将5入栈</li><li>接下来是<code>*</code>运算符,因此弹出5和7,计算出<code>7*5=35</code>,将35入栈</li><li>将6入栈</li><li>最后是<code>-</code>运算符,计算出35-6的值,即29,由此得出最终结果</li></ol><h2 id="实现逆波兰计算器"><a href="#实现逆波兰计算器" class="headerlink" title="实现逆波兰计算器"></a>实现逆波兰计算器</h2><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>实现一个逆波兰计算器,要求完成如下任务</p><ul><li>输入一个逆波兰表达式(后缀表达式),使用Java的栈(Stack),计算结果.<ul><li>这里<strong>暂时输入的是逆波兰表达式</strong></li><li>后面会说明如何用中缀表达式转后缀表达式</li></ul></li><li>支持小括号和多位整数<ul><li>这里主要为了说明数据结构,因此计算器进行简化,只支持整数的计算</li></ul></li></ul><h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><ol><li><p>实现逆波兰表达式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PolandNotation</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String suffixExpression;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">PolandNotation</span><span class="params">(String suffixExpression)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.suffixExpression = suffixExpression;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 先定义一个逆波兰表达式</span></span><br><span class="line"><span class="comment">// (3+4)*5-6 =&gt; 3 4 + 5 * 6 -</span></span><br><span class="line"><span class="comment">// 为了说明方便,逆波兰表达式的数字和符号使用空格隔开</span></span><br><span class="line"><span class="comment">//String suffixExpression = "3 4 + 5 * 6 - ";</span></span><br><span class="line">List&lt;String&gt; suffixList = getListString(suffixExpression);</span><br><span class="line"><span class="keyword">int</span> res = calculate(suffixList);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"计算的结果是 = "</span> + res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将一个逆波兰表达式字符串进行分割后,依次将数据和运算符放入 ArrayList 中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> suffixExpression</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getListString</span><span class="params">(String suffixExpression)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 将 suffixExpression 分割</span></span><br><span class="line">String[] split = suffixExpression.split(<span class="string">" "</span>);</span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"><span class="keyword">for</span> (String element : split) &#123;</span><br><span class="line">list.add(element);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成对逆波兰表达式的运算</span></span><br><span class="line"><span class="comment"> * 思路</span></span><br><span class="line"><span class="comment"> * 例如:(3+4)*5-6对应的后缀表达式就是3 4 + 5 * 6 -,针对后缀表达式求值步骤如下:</span></span><br><span class="line"><span class="comment"> * 1. 从左至右扫描,将3和4压入堆栈</span></span><br><span class="line"><span class="comment"> * 2. 遇到+运算符,因此弹出4和3(4为栈顶元素,3为次栈顶元素),计算出3+4的值,得7,再将7入栈</span></span><br><span class="line"><span class="comment"> * 3. 将5入栈</span></span><br><span class="line"><span class="comment"> * 4. 接下来是*运算符,因此弹出5和7,计算出7*5=35,将35入栈</span></span><br><span class="line"><span class="comment"> * 5. 将6入栈</span></span><br><span class="line"><span class="comment"> * 6. 最后是-运算符,计算出35-6的值,即29,由此得出最终结果</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> suffixlist</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculate</span><span class="params">(List&lt;String&gt; suffixList)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 创建一个栈(这里只需要一个栈)</span></span><br><span class="line">Stack&lt;String&gt; stack = <span class="keyword">new</span> Stack&lt;String&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历 suffixList</span></span><br><span class="line"><span class="comment">// 即 -&gt; 1.从左至右扫描</span></span><br><span class="line"><span class="keyword">for</span> (String item : suffixList) &#123;</span><br><span class="line"><span class="comment">// 这里使用正则表达式来取出数</span></span><br><span class="line"><span class="comment">// 即 -&gt; 1. 将 3 4 压入栈</span></span><br><span class="line"><span class="keyword">if</span> (item.matches(<span class="string">"\\d+"</span>)) &#123;<span class="comment">// 匹配的是多位数</span></span><br><span class="line"><span class="comment">// 入栈</span></span><br><span class="line">stack.push(item);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;<span class="comment">// 2.遇到+运算符...</span></span><br><span class="line"><span class="keyword">int</span> stackTopElement = Integer.parseInt(stack.pop());<span class="comment">// 栈顶元素</span></span><br><span class="line"><span class="keyword">int</span> stackNextTopElement = Integer.parseInt(stack.pop());<span class="comment">// 次栈顶元素</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (item.equals(<span class="string">"+"</span>)) &#123;</span><br><span class="line">res = stackTopElement + stackNextTopElement;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">"-"</span>)) &#123;</span><br><span class="line">res = stackNextTopElement - stackTopElement;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">"*"</span>)) &#123;</span><br><span class="line">res = stackTopElement * stackNextTopElement;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">"/"</span>)) &#123;</span><br><span class="line">res = stackNextTopElement / stackTopElement;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2.计算出3+4的值,得7,在将7入栈</span></span><br><span class="line">stack.push(<span class="string">""</span> + res);<span class="comment">// 这里需要将数字转换成字符串</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最后留在stack中的数据是运算结果</span></span><br><span class="line"><span class="keyword">return</span> Integer.parseInt(stack.pop());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PolandNotationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCalResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">String suffixExpression = <span class="string">"3 4 + 5 * 6 - "</span>;</span><br><span class="line">PolandNotation polandNotation = <span class="keyword">new</span> PolandNotation(suffixExpression);</span><br><span class="line">polandNotation.calResult();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="中缀表达式转后缀表达式"><a href="#中缀表达式转后缀表达式" class="headerlink" title="中缀表达式转后缀表达式"></a>中缀表达式转后缀表达式</h1><p>从上述代码中可以看出,后缀表达式适合计算式进行计算,但是人却不太容易写出来,尤其是在表达式很长的情况下,因此,在开发中,我们需要将中缀表达式转成后缀表达式</p><h2 id="中缀表达式转后缀表达式的思路"><a href="#中缀表达式转后缀表达式的思路" class="headerlink" title="中缀表达式转后缀表达式的思路"></a>中缀表达式转后缀表达式的思路</h2><ol><li>初始化两个栈:运算符栈s1和储存中间结果的栈s2</li><li>从左至右扫描中缀表达式</li><li>遇到操作数(数字)时,将其压入s2</li><li>遇到运算符时,比较其与s1栈顶运算符的优先级<ol><li>如果s1为空,或栈顶运算符为左括号”(“,则直接将此运算符入栈</li><li>否则,若优先级比栈顶运算符的高,将运算符压入s1</li><li>否则,将s1栈顶的运算符弹出并压入到s2中,再次转到步骤4与s1中新的栈顶运算符相比较</li></ol></li><li>遇到括号时<ol><li>如果是左括号”(“,则直接压入s1</li><li>如果是右括号”)”,则依次弹出s1栈顶的运算符,并压入s2,直到遇到左括号为止,此时将这一对括号丢弃</li></ol></li><li>重复步骤2至5,知道表达式的最右边</li><li>将s1中剩余的运算符依次弹出并压入s2</li><li>依次弹出s2中的元素并输出,结果的逆序即为中缀表达式对应的后缀表达式</li></ol><h2 id="举例说明"><a href="#举例说明" class="headerlink" title="举例说明"></a>举例说明</h2><p>将中缀表达式<code>1+((2+3)*4)-5</code>转换为后缀表达式,结果为<code>1 2 3 + 4 * + 5 -</code>,过程如下:</p><table><thead><tr><th>扫描到的元素</th><th>s2(栈底-&gt;栈顶)</th><th>s1(栈底-&gt;栈顶)</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>空</td><td>数字,直接入s2栈</td></tr><tr><td>+</td><td>1</td><td>+</td><td>s1为空,运算符直接入s1栈</td></tr><tr><td>(</td><td>1</td><td>+ (</td><td>左括号,直接入s1栈</td></tr><tr><td>(</td><td>1</td><td>+ ( (</td><td>左括号,直接入s1栈</td></tr><tr><td>2</td><td>1 2</td><td>+ ( (</td><td>数字,直接入s2栈</td></tr><tr><td>+</td><td>1 2</td><td>+ ( ( +</td><td>s1栈顶为左括号,运算符直接入栈</td></tr><tr><td>3</td><td>1 2 3</td><td>+ ( ( +</td><td>数字</td></tr><tr><td>)</td><td>1 2 3 +</td><td>+ (</td><td>右括号,弹出运算符直至遇到左括号</td></tr><tr><td>*</td><td>1 2 3 +</td><td>+ ( *</td><td>s1栈顶元素为左括号,运算符直接入栈</td></tr><tr><td>4</td><td>1 2 3 + 4</td><td>+ ( *</td><td>数字</td></tr><tr><td>)</td><td>1 2 3 + 4 *</td><td>+</td><td>右括号,弹出运算符直至遇到左括号</td></tr><tr><td>-</td><td>1 2 3 + 4 * +</td><td>-</td><td>-与+优先级相同,因此弹出+,在压入-</td></tr><tr><td>5</td><td>1 2 3 + 5 * + 5</td><td>-</td><td>数字</td></tr><tr><td>到达最右端</td><td>1 2 3 + 5 * + 5 -</td><td>空</td><td>s1中剩余的运算符</td></tr></tbody></table><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><ol><li><p>上述思路实现代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PolandNotation</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String infixExpression;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 获取输入的中缀表达式,并放入List中</span></span><br><span class="line">List&lt;String&gt; infixExpressionList = convertInfixExpressionToList(infixExpression);</span><br><span class="line">System.out.println(<span class="string">"中缀表达式对应的 List = "</span> + infixExpressionList);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将中缀表达式转成后缀表达式</span></span><br><span class="line">List&lt;String&gt; suffixExpressionList = parseSuffixExpreesionList(infixExpressionList);</span><br><span class="line">System.out.println(<span class="string">"后缀表达式对应的 List = "</span> + suffixExpressionList);</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> res = calculate(suffixExpressionList);</span><br><span class="line">System.out.printf(<span class="string">"expression=%d"</span>, res);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将中缀表达式转成对应的List</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">convertInfixExpressionToList</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 定义一个List,存放中缀表达式</span></span><br><span class="line">List&lt;String&gt; ls = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;<span class="comment">// 这是一个指针,用于遍历中缀表达式字符串</span></span><br><span class="line">String str;<span class="comment">// 对多位数的拼接</span></span><br><span class="line"><span class="keyword">char</span> c;<span class="comment">// 每遍历到一个字符,就放入到c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line"><span class="comment">// 如果c是一个非数字,就加入到ls</span></span><br><span class="line"><span class="keyword">if</span> ((c = s.charAt(i)) &lt; <span class="number">48</span> || (c = s.charAt(i)) &gt; <span class="number">57</span>) &#123;</span><br><span class="line">ls.add(<span class="string">""</span> + c);</span><br><span class="line">i++;<span class="comment">// i需要后移</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;<span class="comment">// 如果是一个数字,就需要考虑这个数字是否是多位数</span></span><br><span class="line">str = <span class="string">""</span>;<span class="comment">// 先将str置为""'0'[48]-&gt;'9'[57]</span></span><br><span class="line"><span class="keyword">while</span> (i &lt; s.length() &amp;&amp; (c = s.charAt(i)) &gt;= <span class="number">48</span> &amp;&amp; (c = s.charAt(i)) &lt;= <span class="number">57</span>) &#123;</span><br><span class="line">str += c;<span class="comment">// 拼接</span></span><br><span class="line">i++;</span><br><span class="line">&#125;</span><br><span class="line">ls.add(str);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">while</span> (i &lt; s.length());</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ls;<span class="comment">// 返回</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将得到的中缀表达式对应的List转成后缀表达式对应的List</span></span><br><span class="line"><span class="comment"> * 思路</span></span><br><span class="line"><span class="comment"> * 1.初始化两个栈:运算符栈s1和储存中间结果的栈s2</span></span><br><span class="line"><span class="comment"> * 2.从左至右扫描中缀表达式</span></span><br><span class="line"><span class="comment"> * 3.遇到操作数(数字)时,将其压入s2</span></span><br><span class="line"><span class="comment"> * 4.遇到运算符时,比较其与s1栈顶运算符的优先级</span></span><br><span class="line"><span class="comment"> * -&gt; -&gt; 4.1 如果s1为空,或栈顶运算符为左括号”(“,则直接将此运算符入栈</span></span><br><span class="line"><span class="comment"> * -&gt; -&gt; 4.2 否则,若优先级比栈顶运算符的高,将运算符压入s1</span></span><br><span class="line"><span class="comment"> * -&gt; -&gt; 4.3 否则,将s1栈顶的运算符弹出并压入到s2中,再次转到步骤4与s1中新的栈顶运算符相比较</span></span><br><span class="line"><span class="comment"> * 5.遇到括号时</span></span><br><span class="line"><span class="comment"> * -&gt; -&gt; 5.1 如果是左括号”(“,则直接压入s1</span></span><br><span class="line"><span class="comment"> * -&gt; -&gt; 5.2 如果是右括号”)”,则依次弹出s1栈顶的运算符,并压入s2,直到遇到左括号为止,此时将这一对括号丢弃</span></span><br><span class="line"><span class="comment"> * 6.重复步骤2至5,知道表达式的最右边</span></span><br><span class="line"><span class="comment"> * 7.将s1中剩余的运算符依次弹出并压入s2</span></span><br><span class="line"><span class="comment"> * 8.依次弹出s2中的元素并输出,结果的逆序即为中缀表达式对应的后缀表达式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ls</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">parseSuffixExpreesionList</span><span class="params">(List&lt;String&gt; ls)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1.初始化两个栈:运算符栈s1和储存中间结果的栈s2</span></span><br><span class="line">Stack&lt;String&gt; s1 = <span class="keyword">new</span> Stack&lt;String&gt;();<span class="comment">// 符号栈</span></span><br><span class="line"><span class="comment">// -&gt; 理论上需要定义两个栈</span></span><br><span class="line"><span class="comment">// -&gt; 因为s2这个栈在整个转换过程中,没有pop操作,而且后面我们还需要逆序输出</span></span><br><span class="line"><span class="comment">// -&gt; 所以,我们这里不用Stack&lt;String&gt; s2,而是直接使用 List&lt;String&gt; s2</span></span><br><span class="line"><span class="comment">// -&gt; 即,不使用 Stack&lt;String&gt; s2 = new Stack&lt;String&gt;();</span></span><br><span class="line">ArrayList&lt;String&gt; s2 = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.从左至右扫描中缀表达式</span></span><br><span class="line"><span class="keyword">for</span> (String item : ls) &#123;</span><br><span class="line"><span class="comment">// 3.遇到操作数(数字)时,将其压入s2</span></span><br><span class="line"><span class="keyword">if</span> (item.matches(<span class="string">"\\d+"</span>)) &#123;</span><br><span class="line">s2.add(item);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">"("</span>)) &#123;</span><br><span class="line"><span class="comment">// 5.1 如果是左括号”(“,则直接压入s1</span></span><br><span class="line">s1.push(item);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">")"</span>)) &#123;</span><br><span class="line"><span class="comment">//5.2 如果是右括号”)”,则依次弹出s1栈顶的运算符,并压入s2,直到遇到左括号为止,此时将这一对括号丢弃</span></span><br><span class="line"><span class="keyword">while</span> (!s1.peek().equals(<span class="string">"("</span>)) &#123;</span><br><span class="line">s2.add(s1.pop());</span><br><span class="line">&#125;</span><br><span class="line">s1.pop();<span class="comment">// 弹出"(",消除小括号</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 4.遇到运算符时,比较其与s1栈顶运算符的优先级</span></span><br><span class="line"><span class="comment">// 4.3 当item的优先级小于等于s1栈顶运算符,将s1栈顶的运算符弹出并加入到s2中,在次转到4与s1中新的栈顶运算符相比较</span></span><br><span class="line"><span class="keyword">while</span> (s1.size() != <span class="number">0</span> &amp;&amp; operatorPrecedence(s1.peek()) &gt;= operatorPrecedence(item)) &#123;</span><br><span class="line">s2.add(s1.pop());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.1 如果s1为空,或栈顶运算符为左括号”(“,则直接将此运算符入栈</span></span><br><span class="line"><span class="comment">// 4.2 否则,若优先级比栈顶运算符的高,将运算符压入s1</span></span><br><span class="line">s1.push(item);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7.将s1中剩余的运算符依次弹出并压入s2</span></span><br><span class="line"><span class="keyword">while</span> (s1.size() != <span class="number">0</span>) &#123;</span><br><span class="line">s2.add(s1.pop());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意因为是存放到List,因此按顺序输出就是对应的后缀表达式对应的List</span></span><br><span class="line"><span class="keyword">return</span> s2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将一个逆波兰表达式字符串进行分割后,依次将数据和运算符放入 ArrayList 中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> suffixExpression</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getListString</span><span class="params">(String suffixExpression)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 将 suffixExpression 分割</span></span><br><span class="line">String[] split = suffixExpression.split(<span class="string">" "</span>);</span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"><span class="keyword">for</span> (String element : split) &#123;</span><br><span class="line">list.add(element);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 完成对逆波兰表达式的运算</span></span><br><span class="line"><span class="comment"> * 思路</span></span><br><span class="line"><span class="comment"> * 例如:(3+4)*5-6对应的后缀表达式就是3 4 + 5 * 6 -,针对后缀表达式求值步骤如下:</span></span><br><span class="line"><span class="comment"> * 1. 从左至右扫描,将3和4压入堆栈</span></span><br><span class="line"><span class="comment"> * 2. 遇到+运算符,因此弹出4和3(4为栈顶元素,3为次栈顶元素),计算出3+4的值,得7,再将7入栈</span></span><br><span class="line"><span class="comment"> * 3. 将5入栈</span></span><br><span class="line"><span class="comment"> * 4. 接下来是*运算符,因此弹出5和7,计算出7*5=35,将35入栈</span></span><br><span class="line"><span class="comment"> * 5. 将6入栈</span></span><br><span class="line"><span class="comment"> * 6. 最后是-运算符,计算出35-6的值,即29,由此得出最终结果</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> suffixlist</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculate</span><span class="params">(List&lt;String&gt; suffixList)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 创建一个栈(这里只需要一个栈)</span></span><br><span class="line">Stack&lt;String&gt; stack = <span class="keyword">new</span> Stack&lt;String&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历 suffixList</span></span><br><span class="line"><span class="comment">// 即 -&gt; 1.从左至右扫描</span></span><br><span class="line"><span class="keyword">for</span> (String item : suffixList) &#123;</span><br><span class="line"><span class="comment">// 这里使用正则表达式来取出数</span></span><br><span class="line"><span class="comment">// 即 -&gt; 1. 将 3 4 压入栈</span></span><br><span class="line"><span class="keyword">if</span> (item.matches(<span class="string">"\\d+"</span>)) &#123;<span class="comment">// 匹配的是多位数</span></span><br><span class="line"><span class="comment">// 入栈</span></span><br><span class="line">stack.push(item);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;<span class="comment">// 2.遇到+运算符...</span></span><br><span class="line"><span class="keyword">int</span> stackTopElement = Integer.parseInt(stack.pop());<span class="comment">// 栈顶元素</span></span><br><span class="line"><span class="keyword">int</span> stackNextTopElement = Integer.parseInt(stack.pop());<span class="comment">// 次栈顶元素</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (item.equals(<span class="string">"+"</span>)) &#123;</span><br><span class="line">res = stackTopElement + stackNextTopElement;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">"-"</span>)) &#123;</span><br><span class="line">res = stackNextTopElement - stackTopElement;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">"*"</span>)) &#123;</span><br><span class="line">res = stackTopElement * stackNextTopElement;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (item.equals(<span class="string">"/"</span>)) &#123;</span><br><span class="line">res = stackNextTopElement / stackTopElement;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2.计算出3+4的值,得7,在将7入栈</span></span><br><span class="line">stack.push(<span class="string">""</span> + res);<span class="comment">// 这里需要将数字转换成字符串</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 最后留在stack中的数据是运算结果</span></span><br><span class="line"><span class="keyword">return</span> Integer.parseInt(stack.pop());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回运算符号的优先级</span></span><br><span class="line"><span class="comment"> * -&gt; 优先级用数字表示</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> operation</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">operatorPrecedence</span><span class="params">(String operation)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">switch</span> (operation) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"+"</span>:</span><br><span class="line">result = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"-"</span>:</span><br><span class="line">result = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"*"</span>:</span><br><span class="line">result = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"/"</span>:</span><br><span class="line">result = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">System.out.println(<span class="string">"不存在该运算符"</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PolandNotationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCalResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">String infixExpression = <span class="string">"1+((2+3)*4)-5"</span>;</span><br><span class="line">PolandNotation polandNotation = <span class="keyword">new</span> PolandNotation();</span><br><span class="line">polandNotation.setInfixExpression(infixExpression);</span><br><span class="line">polandNotation.calResult();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现栈</title>
      <link href="/2020/04/03/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E6%A0%88/"/>
      <url>/2020/04/03/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E6%A0%88/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是栈"><a href="#什么是栈" class="headerlink" title="什么是栈"></a>什么是栈</h1><ol><li>栈的英文是stack</li><li>栈是<code>先入后出(FILO-First In Last Out)</code>的有序列表</li><li>栈是限制线性表中元素的插入和删除只能在线性表的同一端进行的一种特殊线性表</li><li>允许插入和删除的一端为变化的一端,称为<code>栈顶(Top)</code>,另一端为固定的一端,称之为<code>栈底(Bottom)</code></li><li>根据栈的定义可知,最先放入栈中元素在栈底,最后放入的元素在栈顶,而删除元素刚好相反,最后放入的元素最先删除,最先放入的元素最后删除<br><img src="/images/2020/04/20200402002.png" alt></li></ol><h1 id="栈的应用场景"><a href="#栈的应用场景" class="headerlink" title="栈的应用场景"></a>栈的应用场景</h1><ol><li>子程序的调用:在跳往子程序前,会先将下个指令的地址存到堆栈中,知道子程序执行完后再将地址取出,以回到原来的程序中</li><li>处理递归调用:和子程序的调用类似,只是除了存储下一个指令的地址外,也将参数,区域变量等数据存入堆栈中</li><li>表达式的转换[中缀表达式转后缀表达式]与求值</li><li>二叉树的遍历</li><li>图形的深度优化(depth - first)搜索法</li></ol><h1 id="用数组模拟栈"><a href="#用数组模拟栈" class="headerlink" title="用数组模拟栈"></a>用数组模拟栈</h1><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ul><li>定义一个数组stack</li><li>定义一个top来表示栈顶,初始化为-1</li><li>入栈的操作:当有数据加入到栈时,top++,同时stack[top] = data;</li><li>出栈的操作:先<ul><li>先获得栈顶的数据 value = stack[top]</li><li>将top向下移动<code>top--</code></li><li>返回栈顶数据 return value</li></ul></li></ul><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat.Value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayStack</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxSize;<span class="comment">// 栈的大小</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] stack;<span class="comment">// 模拟栈用数组</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> top = -<span class="number">1</span>;<span class="comment">// top表示栈顶,初始化为-1</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayStack</span><span class="params">(<span class="keyword">int</span> maxSize)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.maxSize = maxSize;</span><br><span class="line">stack = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="keyword">this</span>.maxSize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 栈满</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFull</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> top == maxSize - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 栈空</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> top == -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 入栈</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 先判断栈是否已满</span></span><br><span class="line"><span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">System.out.println(<span class="string">"栈满"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">top++;</span><br><span class="line">stack[top] = value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 出栈</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 先判断栈是否为空</span></span><br><span class="line"><span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"栈空"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> value = stack[top];</span><br><span class="line">top--;</span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示栈</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">System.out.println(<span class="string">"栈空"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 需要从栈顶开始遍历</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = top; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">System.out.printf(<span class="string">"stack[%d]=%d\n"</span>, i, stack[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayStackTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ArrayStack stack = <span class="keyword">new</span> ArrayStack(<span class="number">4</span>);</span><br><span class="line">String key = <span class="string">""</span>;</span><br><span class="line"><span class="keyword">boolean</span> loop = <span class="keyword">true</span>;</span><br><span class="line">Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line"><span class="keyword">while</span> (loop) &#123;</span><br><span class="line">System.out.println(<span class="string">"show:表示显示栈"</span>);</span><br><span class="line">System.out.println(<span class="string">"exit:退出程序"</span>);</span><br><span class="line">System.out.println(<span class="string">"push:入栈"</span>);</span><br><span class="line">System.out.println(<span class="string">"pop:出栈"</span>);</span><br><span class="line">System.out.println(<span class="string">"请输入你的选择"</span>);</span><br><span class="line"></span><br><span class="line">key = scanner.next();</span><br><span class="line"><span class="keyword">switch</span> (key) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"show"</span>:</span><br><span class="line">stack.list();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"push"</span>:</span><br><span class="line">System.out.println(<span class="string">"请输入一个数"</span>);</span><br><span class="line"><span class="keyword">int</span> value = scanner.nextInt();</span><br><span class="line">stack.push(value);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"pop"</span>:</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">int</span> res = stack.pop();</span><br><span class="line">System.out.printf(<span class="string">"出栈的数据%d\n"</span>, res);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">System.out.println(e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">"exit"</span>:</span><br><span class="line">scanner.close();</span><br><span class="line">loop = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"程序退出~~"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现链表之用环形链表解决约瑟夫问题</title>
      <link href="/2020/04/02/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%93%BE%E8%A1%A8%E4%B9%8B%E7%94%A8%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8%E8%A7%A3%E5%86%B3%E7%BA%A6%E7%91%9F%E5%A4%AB%E9%97%AE%E9%A2%98/"/>
      <url>/2020/04/02/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%93%BE%E8%A1%A8%E4%B9%8B%E7%94%A8%E7%8E%AF%E5%BD%A2%E9%93%BE%E8%A1%A8%E8%A7%A3%E5%86%B3%E7%BA%A6%E7%91%9F%E5%A4%AB%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="循环链表"><a href="#循环链表" class="headerlink" title="循环链表"></a>循环链表</h1><blockquote><p>  参考维基百科:<a href="https://zh.wikipedia.org/wiki/%E5%BE%AA%E7%8E%AF%E9%93%BE%E8%A1%A8" target="_blank" rel="noopener">循环链表</a></p></blockquote><blockquote><p>  循环链表是一种链式存储结构，它的最后一个结点指向头结点，形成一个环。因此，从循环链表中的任何一个结点出发都能找到任何其他结点。循环链表的操作和单链表的操作基本一致，差别仅仅在于算法中的循环条件有所不同。</p></blockquote><h1 id="约瑟夫问题"><a href="#约瑟夫问题" class="headerlink" title="约瑟夫问题"></a>约瑟夫问题</h1><ol><li>设编号为1,2,3,…,n的n个人围坐一圈</li><li>约定编号为k(1&lt;=k&lt;=n)的人从1开始报数数到m的那个人出列</li><li>然后出列的人的下一个人又从1开始报数,数到m的哪个人出列</li><li>然后出列的人的下一个人又从1开始报数,数到m的哪个人出列…</li><li>直到所有人都出列为止</li></ol><h1 id="使用单向环形链表解决约瑟夫问题"><a href="#使用单向环形链表解决约瑟夫问题" class="headerlink" title="使用单向环形链表解决约瑟夫问题"></a>使用单向环形链表解决约瑟夫问题</h1><h2 id="创建单向环形列表"><a href="#创建单向环形列表" class="headerlink" title="创建单向环形列表"></a>创建单向环形列表</h2><h3 id="1-第一个节点构成环形链表"><a href="#1-第一个节点构成环形链表" class="headerlink" title="1.  第一个节点构成环形链表"></a>1.  第一个节点构成环形链表</h3><p><img src="/images/2020/04/20200401001.png" alt></p><ol><li>当前只有一个节点,所以需要指定一下first指针,而first指针就指向第一个节点</li><li>当前只有一个节点,所以尾指针也是指向第一个节点</li><li>当前只有一个节点,为了要构成环,所以当前节点的下一个节点指向当前节点</li></ol><h3 id="2-向上述一个节点的环形链表添加节点"><a href="#2-向上述一个节点的环形链表添加节点" class="headerlink" title="2.  向上述一个节点的环形链表添加节点"></a>2.  向上述一个节点的环形链表添加节点</h3><ol><li>因为要在链表的最后增加节点,所以只需要添加在尾指针(last指针)后(即设置last.next = newNode)</li><li>而要构成环形链表,最新添加的节点需要指向第一个节点(即,newNode.next = first)</li><li>尾指针指向最后一个节点(last = newNode)</li></ol><h2 id="出列"><a href="#出列" class="headerlink" title="出列"></a>出列</h2><ul><li>思路:</li><li>-&gt; 1.需要有一个first指针指向环形链表的第一个节点</li><li>-&gt; 2.需要创建一个last指针指向环形链表的最后一个节点</li><li>-&gt; 3.由于是从第k个节点开始数数,则first和last指针先移动(k - 1)次,此时first指向第k个节点</li><li>-&gt; 4.报数为m,则first和last指针同时移动 m-1次(因为自己要先数,此时为1)</li><li>-&gt; 5.移动后first指向的节点就是需要移除的节点</li><li>-&gt; 6.移除节点</li><li>-&gt; -&gt; first = first.next</li><li>-&gt; -&gt; last.next = first</li><li>-&gt; 7.要移除的节点没有被任何引用,会被回收</li></ul><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="小孩对象-节点对象"><a href="#小孩对象-节点对象" class="headerlink" title="小孩对象(节点对象)"></a>小孩对象(节点对象)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.linkedlist.circlesinglelinkedlist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Boy</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> no;<span class="comment">//标号</span></span><br><span class="line"><span class="keyword">private</span> Boy next;<span class="comment">//指向下一个节点,默认为null</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Boy</span><span class="params">(<span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.no = no;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="单向环形链表解决约瑟夫问题"><a href="#单向环形链表解决约瑟夫问题" class="headerlink" title="单向环形链表解决约瑟夫问题"></a>单向环形链表解决约瑟夫问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.linkedlist.circlesinglelinkedlist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleSingleLinkedList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个first节点,当前没有编号</span></span><br><span class="line"><span class="keyword">private</span> Boy first = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加小孩节点,构成一个环形的链表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> nums</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBoy</span><span class="params">(<span class="keyword">int</span> nums)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (nums &lt; <span class="number">1</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"nums的值不正确"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 辅助指针,帮助构建环形链表</span></span><br><span class="line"><span class="comment">// 这个指针是一个尾指针</span></span><br><span class="line">Boy last = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用for来创建我们的环形链表</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nums; i++) &#123;</span><br><span class="line"><span class="comment">// 根据编号,创建小孩节点</span></span><br><span class="line">Boy boy = <span class="keyword">new</span> Boy(i);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (i == <span class="number">1</span>) &#123;<span class="comment">// 第一个节点比较特殊</span></span><br><span class="line"><span class="comment">// 第一个节点构成环形链表</span></span><br><span class="line"><span class="comment">// 1.目前只有一个节点,所以需要指定一下first</span></span><br><span class="line">first = boy;</span><br><span class="line"><span class="comment">// 2.目前只有一个节点,所以尾指针也是指向boy</span></span><br><span class="line">last = boy;</span><br><span class="line"><span class="comment">// 3.目前只有一个节点,要构成环,所以当前节点指向当前节点</span></span><br><span class="line">first.setNext(first);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 非第一个节点构成环形链表</span></span><br><span class="line"><span class="comment">// 1.因为要在链表的最后增加节点,所以只需要添加在尾指针后</span></span><br><span class="line">last.setNext(boy);</span><br><span class="line"><span class="comment">// 2.而要构成环形链表,最新添加的节点需要指向第一个节点</span></span><br><span class="line">boy.setNext(first);</span><br><span class="line"><span class="comment">// 3.尾指针指向最后一个节点(最新添加的节点)</span></span><br><span class="line">last = boy;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 遍历当前的环形链表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showBoy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 判断当前是否为空</span></span><br><span class="line"><span class="keyword">if</span> (first == <span class="keyword">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"没有任何小孩~"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 因为first不能动,所以我们用一个辅助指针</span></span><br><span class="line">Boy temp = first;</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">System.out.printf(<span class="string">"小孩编号 %d \n"</span>, temp.getNo());</span><br><span class="line"><span class="keyword">if</span> (temp.getNext() == first) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.getNext();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户的输入,计算出小孩出圈的顺序</span></span><br><span class="line"><span class="comment"> * 思路:</span></span><br><span class="line"><span class="comment"> * -&gt; 1.需要有一个first指针指向环形链表的第一个节点</span></span><br><span class="line"><span class="comment"> * -&gt; 2.需要创建一个last指针指向环形链表的最后一个节点</span></span><br><span class="line"><span class="comment"> * -&gt; 3.由于是从第k个节点开始数数,则first和last指针先移动(k - 1)次,此时first指向第k个节点</span></span><br><span class="line"><span class="comment"> * -&gt; 4.报数为m,则first和last指针同时移动 m-1次(因为自己要先数,此时为1)</span></span><br><span class="line"><span class="comment"> * -&gt; 5.移动后first指向的节点就是需要移除的节点</span></span><br><span class="line"><span class="comment"> * -&gt; 6.移除节点</span></span><br><span class="line"><span class="comment"> * -&gt; -&gt; first = first.next</span></span><br><span class="line"><span class="comment"> * -&gt; -&gt; last.next = first</span></span><br><span class="line"><span class="comment"> * -&gt; 7.要移除的节点没有被任何引用,会被回收</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> startNo 表示从第几个节点开始数数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> countNum 表示数几下</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> nums 表示最初有多少小孩在圈中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countBoy</span><span class="params">(<span class="keyword">int</span> startNo, <span class="keyword">int</span> countNum, <span class="keyword">int</span> nums)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 先对数据进行校验</span></span><br><span class="line"><span class="keyword">if</span> (first == <span class="keyword">null</span> || startNo &lt; <span class="number">1</span> || startNo &gt; nums) &#123;</span><br><span class="line">System.out.println(<span class="string">"参数输入有误,请重新输入"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">Boy last = first;</span><br><span class="line"><span class="comment">// 1.将first和last指向链表的第一个节点和最后一个节点</span></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (last.getNext() == first) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">last = last.getNext();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将first指针指向 startNo</span></span><br><span class="line"><span class="comment">// 也就是说 first 和 last 要移动 startNo - 1 次</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; startNo - <span class="number">1</span>; i++) &#123;</span><br><span class="line">first = first.getNext();</span><br><span class="line">last = last.getNext();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (last == first) &#123;<span class="comment">// 说明环形链表中只有一个节点</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 报数,第countNum删除</span></span><br><span class="line"><span class="comment">// 即first和last指针同时移动(countNum - 1)次</span></span><br><span class="line"><span class="comment">// 也就是移动后,first会指向需要删除的节点</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; countNum - <span class="number">1</span>; i++) &#123;</span><br><span class="line">first = first.getNext();</span><br><span class="line">last = last.getNext();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 移除节点</span></span><br><span class="line">System.out.printf(<span class="string">"删除第%d个节点\n"</span>,first.getNo());</span><br><span class="line">first = first.getNext();</span><br><span class="line">last.setNext(first);</span><br><span class="line">&#125;</span><br><span class="line">System.out.printf(<span class="string">"最后还在环形链表中的节点编号为%d\n"</span>, first.getNo());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.linkedlist.circlesinglelinkedlist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleSingleLinkedListTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">CircleSingleLinkedList circleSingleLinkedList = <span class="keyword">new</span> CircleSingleLinkedList();</span><br><span class="line">circleSingleLinkedList.addBoy(<span class="number">5</span>);</span><br><span class="line">circleSingleLinkedList.showBoy();</span><br><span class="line"></span><br><span class="line">circleSingleLinkedList.countBoy(<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现链表之双向链表</title>
      <link href="/2020/04/01/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%93%BE%E8%A1%A8%E4%B9%8B%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8/"/>
      <url>/2020/04/01/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%93%BE%E8%A1%A8%E4%B9%8B%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="单链表存在什么缺点"><a href="#单链表存在什么缺点" class="headerlink" title="单链表存在什么缺点"></a>单链表存在什么缺点</h1><ul><li>单链表查找的方向只能是一个方向</li><li>单链表不能自我删除,需要靠辅助节点</li></ul><h1 id="双向链表"><a href="#双向链表" class="headerlink" title="双向链表"></a>双向链表</h1><blockquote><p>  双向链表，又称为双链表，是链表的一种，它的每个数据结点中都有两个指针，分别指向直接后继和直接前驱。所以，从双向链表中的任意一个结点开始，都可以很方便地访问它的前驱结点和后继结点。</p></blockquote><ul><li>双向链表可以向前或向后查找</li><li>双向链表可以自我删除</li></ul><h1 id="实现双向链表"><a href="#实现双向链表" class="headerlink" title="实现双向链表"></a>实现双向链表</h1><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><h3 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h3><p>和单链表一样,只是可以向前,也可以向后</p><h3 id="添加-默认添加到双链表最后"><a href="#添加-默认添加到双链表最后" class="headerlink" title="添加(默认添加到双链表最后)"></a>添加(默认添加到双链表最后)</h3><ol><li>先找到双向链表的最后节点</li><li>temp.next = newNode</li><li>newNode.pre = temp;</li></ol><h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><p>思路和单链表一样</p><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><ol><li>因为是双向链表,因此,我们可以实现自我删除某个节点</li><li>直接找到要删除的这个节点,比如temp</li><li>temp.pre.next = temp.next</li><li>temp.next.pre = temp.pre</li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.linkedlist.doublylinkedlist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.linkedlist.singlylinkedlist.HeroNode;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.linkedlist.singlylinkedlist.SingleLinkedList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoubleLinkedListTest</span> </span>&#123;</span><br><span class="line"><span class="comment">// 被测试类</span></span><br><span class="line"><span class="keyword">private</span> SingleLinkedList doubleLinkedList;</span><br><span class="line"></span><br><span class="line"><span class="comment">// "英雄"数组</span></span><br><span class="line"><span class="keyword">private</span> HeroNode[] heros;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 初始化被测试类</span></span><br><span class="line">doubleLinkedList = <span class="keyword">new</span> SingleLinkedList();</span><br><span class="line"></span><br><span class="line">heros = <span class="keyword">new</span> HeroNode[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">heros[<span class="number">0</span>] = <span class="keyword">new</span> HeroNode(<span class="number">1</span>, <span class="string">"宋江"</span>, <span class="string">"及时雨"</span>);</span><br><span class="line">heros[<span class="number">1</span>] = <span class="keyword">new</span> HeroNode(<span class="number">2</span>, <span class="string">"卢俊义"</span>, <span class="string">"玉麒麟"</span>);</span><br><span class="line">heros[<span class="number">2</span>] = <span class="keyword">new</span> HeroNode(<span class="number">3</span>, <span class="string">"吴用"</span>, <span class="string">"智多星"</span>);</span><br><span class="line">heros[<span class="number">3</span>] = <span class="keyword">new</span> HeroNode(<span class="number">4</span>, <span class="string">"林冲"</span>, <span class="string">"豹子头"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 加入节点</span></span><br><span class="line">doubleLinkedList.addNode(heros[<span class="number">0</span>]);</span><br><span class="line">doubleLinkedList.addNode(heros[<span class="number">1</span>]);</span><br><span class="line">doubleLinkedList.addNode(heros[<span class="number">2</span>]);</span><br><span class="line">doubleLinkedList.addNode(heros[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示链表</span></span><br><span class="line">doubleLinkedList.list();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 加入节点</span></span><br><span class="line">doubleLinkedList.addNode(heros[<span class="number">0</span>]);</span><br><span class="line">doubleLinkedList.addNode(heros[<span class="number">1</span>]);</span><br><span class="line">doubleLinkedList.addNode(heros[<span class="number">2</span>]);</span><br><span class="line">doubleLinkedList.addNode(heros[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">HeroNode heroNode = <span class="keyword">new</span> HeroNode(<span class="number">4</span>, <span class="string">"公孙胜"</span>, <span class="string">"入云龙"</span>);</span><br><span class="line">doubleLinkedList.updateNode(heroNode);</span><br><span class="line">System.out.println(<span class="string">"修改后的链表情况"</span>);</span><br><span class="line">doubleLinkedList.list();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDel</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 加入节点</span></span><br><span class="line">doubleLinkedList.addNode(heros[<span class="number">0</span>]);</span><br><span class="line">doubleLinkedList.addNode(heros[<span class="number">1</span>]);</span><br><span class="line">doubleLinkedList.addNode(heros[<span class="number">2</span>]);</span><br><span class="line">doubleLinkedList.addNode(heros[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">doubleLinkedList.deleteNode(<span class="number">3</span>);</span><br><span class="line">System.out.println(<span class="string">"删除后的链表情况"</span>);</span><br><span class="line">doubleLinkedList.list();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现链表之单链表</title>
      <link href="/2020/03/28/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%93%BE%E8%A1%A8%E4%B9%8B%E5%8D%95%E9%93%BE%E8%A1%A8/"/>
      <url>/2020/03/28/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%93%BE%E8%A1%A8%E4%B9%8B%E5%8D%95%E9%93%BE%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="链表-LinkedList-介绍"><a href="#链表-LinkedList-介绍" class="headerlink" title="链表(LinkedList)介绍"></a>链表(LinkedList)介绍</h1><ol><li>链表是有序列表,但是它在内存中的存储如下<br><img src="/images/2020/03/20200328001.png" alt></li><li>链表是以节点方式来存储,是链式存储</li><li>每个节点包含<code>data</code>域,保存具体的数据;<code>next</code>域,指向下一个节点</li><li>如上图,链表中的各个节点不一定是连续存储</li><li>链表分为<code>带头节点的链表</code>和<code>没有带头节点</code>的链表,根据实际的需求来确定</li><li>单链表(带头节点)的逻辑结构图如下<br><img src="/images/2020/03/20200328002.png" alt></li></ol><h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><p>使用带head头的单链表,实现对水浒英雄任务的增删改查</p><h3 id="英雄类"><a href="#英雄类" class="headerlink" title="英雄类"></a>英雄类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.linkedlist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeroNode</span> </span>&#123;</span><br><span class="line"><span class="comment">// 英雄编号</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> no;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 英雄名字</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="comment">// 英雄称号</span></span><br><span class="line"><span class="keyword">private</span> String nickname;</span><br><span class="line"><span class="comment">// 指向下一个结点</span></span><br><span class="line"><span class="keyword">private</span> HeroNode next;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HeroNode</span><span class="params">(<span class="keyword">int</span> no, String name, String nickname)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.no = no;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line"><span class="keyword">this</span>.nickname = nickname;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 为了显示方便,重写toString</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"HeroNode [no="</span> + no + <span class="string">", name="</span> + name + <span class="string">", nickname="</span></span><br><span class="line">+ nickname + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="水浒英雄排行榜的单链表实现"><a href="#水浒英雄排行榜的单链表实现" class="headerlink" title="水浒英雄排行榜的单链表实现"></a>水浒英雄排行榜的单链表实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.linkedlist;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleLinkedList</span> </span>&#123;</span><br><span class="line"><span class="comment">// 先初始化一个头节点,头节点不要动,不存放具体的数据</span></span><br><span class="line"><span class="keyword">private</span> HeroNode head = <span class="keyword">new</span> HeroNode(<span class="number">0</span>, <span class="string">""</span>, <span class="string">""</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加节点到单向链表(当然这肯定是添加到末尾了)</span></span><br><span class="line"><span class="comment"> * 思路:</span></span><br><span class="line"><span class="comment"> * 当不考虑编号顺序时</span></span><br><span class="line"><span class="comment"> * -&gt;1.找到当前链表的最后节点</span></span><br><span class="line"><span class="comment"> * -&gt;2.将最后这个节点的next指向新的节点</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> heroNode</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addNode</span> <span class="params">(HeroNode heroNode)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 因为head节点不能动,因此我们需要一个辅助遍历temmp</span></span><br><span class="line"><span class="comment">// 不能直接使用head</span></span><br><span class="line">HeroNode temp = head;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 要在链表最后插入,所以首先要找到链表的最后</span></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="comment">// 当next为null时,则表示没有下一个</span></span><br><span class="line"><span class="keyword">if</span> (temp.getNext() == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 如果没有找到最后,将temp后移</span></span><br><span class="line">temp = temp.getNext();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当退出while循环时,temp就指向了链表的最后</span></span><br><span class="line">temp.setNext(heroNode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据英雄排名,将英雄插入到指定位置</span></span><br><span class="line"><span class="comment"> * -&gt; 这里的指定位置有"英雄的序号决定"</span></span><br><span class="line"><span class="comment"> * -&gt; 如果链表中已经存在这个英雄了(序号存在),则显示添加失败</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> heroNode</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addNodeByOrder</span><span class="params">(HeroNode heroNode)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 头节点不能动,所以我们仍然通过一个辅助指针(变量)来帮助我们找到添加的位置</span></span><br><span class="line">HeroNode temp = head;</span><br><span class="line"><span class="keyword">boolean</span> flag = <span class="keyword">false</span>;<span class="comment">// 用于标志添加的编号是否存在,默认为false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (temp.getNext() == <span class="keyword">null</span>) &#123;<span class="comment">// 说明temp已经在链表的最后了</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 因为单链表,所以我们需要找的是位于"添加位置的前一个节点",否则插入不了</span></span><br><span class="line"><span class="comment">// -&gt;当前节点指向的下一个节点的编号比当前节点大,说明找到了</span></span><br><span class="line"><span class="comment">// -&gt; 此时的temp就是"添加位置的前一个节点"</span></span><br><span class="line"><span class="keyword">if</span> (temp.getNext().getNo() &gt; heroNode.getNo()) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (temp.getNext().getNo() == heroNode.getNo()) &#123;<span class="comment">// 说明希望添加的heroNode的编号已经存在</span></span><br><span class="line">flag = <span class="keyword">true</span>;<span class="comment">// 说明编号已经存在</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">temp = temp.getNext();<span class="comment">// 后移,遍历当前链表</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (flag) &#123;</span><br><span class="line">System.out.printf(<span class="string">"准备插入的英雄编号 %d 已经存在了,不能加入\n"</span>, heroNode.getNo());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (temp.getNext() == <span class="keyword">null</span>) &#123;<span class="comment">// 说明temp已经在链表的最后了</span></span><br><span class="line">temp.setNext(heroNode);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// 将temp的指向交给heroNode的指向</span></span><br><span class="line">heroNode.setNext(temp.getNext());</span><br><span class="line"><span class="comment">// 而temp应指向heroNode</span></span><br><span class="line">temp.setNext(heroNode);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 修改节点信息</span></span><br><span class="line"><span class="comment"> * -&gt; 根据编号来修改</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> heroNode</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateNode</span><span class="params">(HeroNode heroNode)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 判断是否为空</span></span><br><span class="line"><span class="comment">// -&gt; 即头节点之后没有任何节点</span></span><br><span class="line"><span class="keyword">if</span> (head.getNext() == <span class="keyword">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"链表为空"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据节点编号,找到需要修改的节点</span></span><br><span class="line">HeroNode temp = head.getNext();</span><br><span class="line"><span class="keyword">boolean</span> flag = <span class="keyword">false</span>;<span class="comment">// 表示是否找到该节点</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.找到节点</span></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (temp == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;<span class="comment">// 已经遍历完链表</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 找到</span></span><br><span class="line"><span class="keyword">if</span> (temp.getNo() == heroNode.getNo()) &#123;</span><br><span class="line">flag = <span class="keyword">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">temp = temp.getNext();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.修改节点</span></span><br><span class="line"><span class="keyword">if</span> (flag) &#123;<span class="comment">// 找到</span></span><br><span class="line">temp.setName(heroNode.getName());</span><br><span class="line">temp.setNickname(heroNode.getNickname());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;<span class="comment">// 没有找到</span></span><br><span class="line">System.out.printf(<span class="string">"没有找到编号%d的节点,不能修改\n"</span>, heroNode.getNo());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除节点</span></span><br><span class="line"><span class="comment"> * -&gt; 根据英雄编号删除英雄</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> number 英雄编号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteNode</span><span class="params">(<span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">HeroNode temp = head;</span><br><span class="line"><span class="keyword">boolean</span> flag = <span class="keyword">false</span>;<span class="comment">// 标志是否找到待删除节点</span></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (temp.getNext() == <span class="keyword">null</span>) &#123;<span class="comment">// 已经在链表的最后了</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (temp.getNext().getNo() == number) &#123;</span><br><span class="line"><span class="comment">// 找到待删除节点的前一个节点</span></span><br><span class="line">flag = <span class="keyword">true</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">temp = temp.getNext();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (flag) &#123;<span class="comment">//有找到要删除节点的前一个节点,可以删除</span></span><br><span class="line"><span class="comment">// 只需要将要删除节点的前一个节点的指针指向要删除节点的后一个节点</span></span><br><span class="line">temp.setNext(temp.getNext().getNext());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">System.out.printf(<span class="string">"要删除的%d节点不存在\n"</span>, number);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示链表[遍历]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">list</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 判断链表是否为空</span></span><br><span class="line"><span class="keyword">if</span> (head.getNext() == <span class="keyword">null</span>) &#123;</span><br><span class="line">System.out.println(<span class="string">"链表为空"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 因为是头节点,不能动,因此需要一个辅助变量来遍历</span></span><br><span class="line">HeroNode temp = head.getNext();</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="comment">// 判断是否到链表最后</span></span><br><span class="line"><span class="keyword">if</span> (temp == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出节点信息</span></span><br><span class="line">System.out.println(temp);</span><br><span class="line"><span class="comment">// 将temp后移</span></span><br><span class="line">temp = temp.getNext();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.linkedlist;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleLinkedListTest</span> </span>&#123;</span><br><span class="line"><span class="comment">// 被测试类</span></span><br><span class="line"><span class="keyword">private</span> SingleLinkedList singleLinkedList;</span><br><span class="line"></span><br><span class="line"><span class="comment">// "英雄"数组</span></span><br><span class="line"><span class="keyword">private</span> HeroNode[] heros;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 初始化被测试类</span></span><br><span class="line">singleLinkedList = <span class="keyword">new</span> SingleLinkedList();</span><br><span class="line"></span><br><span class="line">heros = <span class="keyword">new</span> HeroNode[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">heros[<span class="number">0</span>] = <span class="keyword">new</span> HeroNode(<span class="number">1</span>, <span class="string">"宋江"</span>, <span class="string">"及时雨"</span>);</span><br><span class="line">heros[<span class="number">1</span>] = <span class="keyword">new</span> HeroNode(<span class="number">2</span>, <span class="string">"卢俊义"</span>, <span class="string">"玉麒麟"</span>);</span><br><span class="line">heros[<span class="number">2</span>] = <span class="keyword">new</span> HeroNode(<span class="number">3</span>, <span class="string">"吴用"</span>, <span class="string">"智多星"</span>);</span><br><span class="line">heros[<span class="number">3</span>] = <span class="keyword">new</span> HeroNode(<span class="number">4</span>, <span class="string">"林冲"</span>, <span class="string">"豹子头"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 向链表中添加节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 加入节点</span></span><br><span class="line">singleLinkedList.addNode(heros[<span class="number">0</span>]);</span><br><span class="line">singleLinkedList.addNode(heros[<span class="number">1</span>]);</span><br><span class="line">singleLinkedList.addNode(heros[<span class="number">2</span>]);</span><br><span class="line">singleLinkedList.addNode(heros[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示链表</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 向链表中插入节点</span></span><br><span class="line"><span class="comment"> * -&gt;会按照链表顺序插入</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddNodeByOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 加入节点</span></span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">1</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">0</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">3</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示链表</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 加入节点</span></span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">1</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">0</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">3</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">HeroNode heroNode = <span class="keyword">new</span> HeroNode(<span class="number">2</span>, <span class="string">"lujunyi"</span>, <span class="string">"yuqilin"</span>);</span><br><span class="line">singleLinkedList.updateNode(heroNode);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示链表</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 加入节点</span></span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">1</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">0</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">3</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">singleLinkedList.deleteNode(<span class="number">1</span>);</span><br><span class="line">singleLinkedList.deleteNode(<span class="number">4</span>);</span><br><span class="line">singleLinkedList.deleteNode(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示链表</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="一些常见的算法"><a href="#一些常见的算法" class="headerlink" title="一些常见的算法"></a>一些常见的算法</h1><p>代码是基于上述代码加的</p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="获取单链表有效节点个数-不计算头节点"><a href="#获取单链表有效节点个数-不计算头节点" class="headerlink" title="获取单链表有效节点个数(不计算头节点)"></a>获取单链表有效节点个数(不计算头节点)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleLinkedList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////////////////</span></span><br><span class="line"><span class="comment">///这里是上面出现的代码</span></span><br><span class="line"><span class="comment">//////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///获取单链表有效节点个数(不计算头节点)</span></span><br><span class="line"><span class="comment">///////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取单链表有效节点个数(不计算头节点)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getLength</span><span class="params">(HeroNode head)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (head.getNext() == <span class="keyword">null</span>) &#123;<span class="comment">// 空链表</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">HeroNode current = head.getNext();</span><br><span class="line"><span class="keyword">while</span> (current != <span class="keyword">null</span>) &#123;</span><br><span class="line">length++;</span><br><span class="line">current = current.getNext();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> length;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="查找单链表中倒数第k个节点"><a href="#查找单链表中倒数第k个节点" class="headerlink" title="查找单链表中倒数第k个节点"></a>查找单链表中倒数第k个节点</h3><h4 id="方法一-利用到上述获取单链表有效节点个数时写的函数"><a href="#方法一-利用到上述获取单链表有效节点个数时写的函数" class="headerlink" title="方法一:利用到上述获取单链表有效节点个数时写的函数"></a>方法一:利用到上述<code>获取单链表有效节点个数</code>时写的函数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleLinkedList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////////////////</span></span><br><span class="line"><span class="comment">///这里是上面出现的代码</span></span><br><span class="line"><span class="comment">//////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/////////////////////////////////////////</span></span><br><span class="line"><span class="comment">/// 查找单链表中的倒数第k个节点</span></span><br><span class="line"><span class="comment">/////////////////////////////////////////</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查找单链表中的倒数第k个节点</span></span><br><span class="line"><span class="comment"> * 思路</span></span><br><span class="line"><span class="comment"> * 1. 编写一个方法,接收head节点,同时接受一个index</span></span><br><span class="line"><span class="comment"> * 2. 其中,index表示的是倒数index节点</span></span><br><span class="line"><span class="comment"> * 3. 先把链表从头到尾遍历,得到链表的总长度 (我们已经有getLength)方法了</span></span><br><span class="line"><span class="comment"> * 4. 得到链表长度 size = getLength(...) 之后,我们从链表的第一个开始遍历到第 size - index 个,就是我们想要的节点</span></span><br><span class="line"><span class="comment"> * 5. 如果找到了,则返回该节点,否则返回null</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HeroNode <span class="title">findLastIndexNode1</span><span class="params">(HeroNode heroNode, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 单链表为空</span></span><br><span class="line"><span class="keyword">if</span> (heroNode.getNext() == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取链表长度(取出头节点的链表节点个数)</span></span><br><span class="line"><span class="keyword">int</span> size = getLength(heroNode);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对index进行校验</span></span><br><span class="line"><span class="keyword">if</span> (index &lt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"索引"</span> + index + <span class="string">"不能是负数"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (index &gt; size) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义辅助变量,for循环定位到倒数的index</span></span><br><span class="line">HeroNode current = head.getNext();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链表最后一个是倒是第1个(即:要注意最后一个不是倒数第0个)</span></span><br><span class="line"><span class="comment">// -&gt; 假设链表长度size = 4</span></span><br><span class="line"><span class="comment">// -&gt; 要取出倒数第一个 index = 3</span></span><br><span class="line"><span class="comment">// -&gt; 那么 size - index = 4 - 1 = 3</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (size - index); i++) &#123;</span><br><span class="line">current = current.getNext();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> current;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="方法二-使用快慢指针"><a href="#方法二-使用快慢指针" class="headerlink" title="方法二:使用快慢指针"></a>方法二:使用<code>快慢指针</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleLinkedList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////////////////</span></span><br><span class="line"><span class="comment">///这里是上面出现的代码</span></span><br><span class="line"><span class="comment">//////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">///获取单链表有效节点个数(不计算头节点)</span></span><br><span class="line"><span class="comment">///////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查找单链表中的倒数第 index 个节点</span></span><br><span class="line"><span class="comment"> * -&gt; 使用快慢指针实现</span></span><br><span class="line"><span class="comment"> * 思路:</span></span><br><span class="line"><span class="comment"> * 1. 可以定义两个指针,第一个指针从链表的头指针开始遍历向前走 index-1 步,第二个指针保持不动;</span></span><br><span class="line"><span class="comment"> * 2. 从第 index 步开始,第二个指针也开始从链表的头指针开始遍历.</span></span><br><span class="line"><span class="comment"> * 3. 由于两个指针的距离保持在 index-1 ,当第一个指针到达链表的尾节点时候,第二个指针正好是倒数第 index 个节点.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HeroNode <span class="title">findLastIndexNode2</span><span class="params">(HeroNode heroNode, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 单链表为空</span></span><br><span class="line"><span class="keyword">if</span> (heroNode.getNext() == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对index进行校验</span></span><br><span class="line"><span class="keyword">if</span> (index &lt;= <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"索引"</span> + index + <span class="string">"不能是负数"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义辅助变量,for循环定位到倒数的index</span></span><br><span class="line">HeroNode currentFast = head.getNext();</span><br><span class="line">HeroNode currentSlow = head.getNext();</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (currentFast.getNext() != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (count &gt;= index - <span class="number">1</span>) &#123;<span class="comment">// 因为此时currentSlow已经是第一个节点了,所以是(index - 1)</span></span><br><span class="line">currentSlow = currentSlow.getNext();</span><br><span class="line">&#125;</span><br><span class="line">count++;</span><br><span class="line">currentFast = currentFast.getNext();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> currentSlow;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="单链表的反转"><a href="#单链表的反转" class="headerlink" title="单链表的反转"></a>单链表的反转</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleLinkedList</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////////////////</span></span><br><span class="line"><span class="comment">///这里是上面出现的代码</span></span><br><span class="line"><span class="comment">//////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">/// 单链表的反转</span></span><br><span class="line"><span class="comment">///////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单链表的反转</span></span><br><span class="line"><span class="comment"> * 思路:</span></span><br><span class="line"><span class="comment"> * -&gt; 先定义一个头节点 reverseHead = new HeroNode();</span></span><br><span class="line"><span class="comment"> * -&gt; 从头到尾遍历原来的链表,每遍历一个节点,就将其取出,并放在新的链表reverseHead的最前端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> head</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reversetList</span><span class="params">(HeroNode head)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 如果当前链表为空,或者只有一个节点,无需反转,直接返回</span></span><br><span class="line"><span class="keyword">if</span> (head.getNext() == <span class="keyword">null</span> || head.getNext().getNext() == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 现在是有头链表,所以我们需要一个头</span></span><br><span class="line">HeroNode reversetHead = <span class="keyword">new</span> HeroNode(<span class="number">0</span>, <span class="string">""</span>, <span class="string">""</span>);</span><br><span class="line"><span class="comment">// 当前节点</span></span><br><span class="line">HeroNode current = head.getNext();</span><br><span class="line">HeroNode currentNext = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">while</span> (current != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="comment">// 获取旧链表当前节点的下一个节点的指针</span></span><br><span class="line">currentNext = current.getNext();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理"当前节点"</span></span><br><span class="line"><span class="comment">// -&gt; 由于当前节点要插入新链表的"头节点"和"第一节点"之间</span></span><br><span class="line"><span class="comment">// -&gt; 所以"当前节点"应指向"第一节点",如下</span></span><br><span class="line">current.setNext(reversetHead.getNext());</span><br><span class="line"><span class="comment">// -&gt; 此时 current 是 "当前节点" -&gt; "第一节点" ... 这样的状态</span></span><br><span class="line"><span class="comment">// -&gt; 故只需要将"头节点"的下一个节点指向"当前节点"就行</span></span><br><span class="line">reversetHead.setNext(current);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 由于是对current进行遍历,故指针应是 旧链表 的下一个节点</span></span><br><span class="line">current = currentNext;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 最后将 head 指向新链表的第一个节点</span></span><br><span class="line">head.setNext(reversetHead.getNext());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleLinkedListTest</span> </span>&#123;</span><br><span class="line"><span class="comment">// 被测试类</span></span><br><span class="line"><span class="keyword">private</span> SingleLinkedList singleLinkedList;</span><br><span class="line"></span><br><span class="line"><span class="comment">// "英雄"数组</span></span><br><span class="line"><span class="keyword">private</span> HeroNode[] heros;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 初始化被测试类</span></span><br><span class="line">singleLinkedList = <span class="keyword">new</span> SingleLinkedList();</span><br><span class="line"></span><br><span class="line">heros = <span class="keyword">new</span> HeroNode[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">heros[<span class="number">0</span>] = <span class="keyword">new</span> HeroNode(<span class="number">1</span>, <span class="string">"宋江"</span>, <span class="string">"及时雨"</span>);</span><br><span class="line">heros[<span class="number">1</span>] = <span class="keyword">new</span> HeroNode(<span class="number">2</span>, <span class="string">"卢俊义"</span>, <span class="string">"玉麒麟"</span>);</span><br><span class="line">heros[<span class="number">2</span>] = <span class="keyword">new</span> HeroNode(<span class="number">3</span>, <span class="string">"吴用"</span>, <span class="string">"智多星"</span>);</span><br><span class="line">heros[<span class="number">3</span>] = <span class="keyword">new</span> HeroNode(<span class="number">4</span>, <span class="string">"林冲"</span>, <span class="string">"豹子头"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////</span></span><br><span class="line"><span class="comment">////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 上面的其他代码 ///</span></span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////////////////</span></span><br><span class="line"><span class="comment">////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试获取链表长度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetLength</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 加入节点</span></span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">1</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">0</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">3</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示链表</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示长度</span></span><br><span class="line"><span class="keyword">int</span> length = singleLinkedList.getLength(singleLinkedList.getHead());</span><br><span class="line">System.out.printf(<span class="string">"链表长度为%d"</span>, length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取到链表倒数第 index 个节点,方案一</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindLastIndexNode1</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 加入节点</span></span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">1</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">0</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">3</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示链表</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line">HeroNode head = singleLinkedList.getHead();</span><br><span class="line">HeroNode findLastIndexNode = singleLinkedList.findLastIndexNode1(head, <span class="number">1</span>);</span><br><span class="line">System.out.println(findLastIndexNode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取到链表倒数第 index 个节点,方案二</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFildLastIndexNode2</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 加入节点</span></span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">1</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">0</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">3</span>]);</span><br><span class="line">singleLinkedList.addNodeByOrder(heros[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示链表</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line">HeroNode head = singleLinkedList.getHead();</span><br><span class="line">HeroNode findLastIndexNode = singleLinkedList.findLastIndexNode2(head, <span class="number">4</span>);</span><br><span class="line">System.out.println(findLastIndexNode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 链表反转</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testReversetList</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 加入节点</span></span><br><span class="line">singleLinkedList.addNode(heros[<span class="number">3</span>]);</span><br><span class="line">singleLinkedList.addNode(heros[<span class="number">1</span>]);</span><br><span class="line">singleLinkedList.addNode(heros[<span class="number">2</span>]);</span><br><span class="line">singleLinkedList.addNode(heros[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 显示链表</span></span><br><span class="line">singleLinkedList.list();</span><br><span class="line"></span><br><span class="line">HeroNode head = singleLinkedList.getHead();</span><br><span class="line">singleLinkedList.reversetList(head);</span><br><span class="line"></span><br><span class="line">singleLinkedList.list();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="问题-合并两个有序的单链表-合并后仍然有序"><a href="#问题-合并两个有序的单链表-合并后仍然有序" class="headerlink" title="问题:合并两个有序的单链表,合并后仍然有序"></a>问题:合并两个有序的单链表,合并后仍然有序</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 合并两个有序的单链表,合并后仍然有序</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMergeLinkedList</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">HeroNode[] heros1 = <span class="keyword">new</span> HeroNode[<span class="number">4</span>];</span><br><span class="line">heros1[<span class="number">0</span>] = <span class="keyword">new</span> HeroNode(<span class="number">1</span>, <span class="string">"宋江"</span>, <span class="string">"及时雨"</span>);</span><br><span class="line">heros1[<span class="number">1</span>] = <span class="keyword">new</span> HeroNode(<span class="number">2</span>, <span class="string">"卢俊义"</span>, <span class="string">"玉麒麟"</span>);</span><br><span class="line">heros1[<span class="number">2</span>] = <span class="keyword">new</span> HeroNode(<span class="number">3</span>, <span class="string">"吴用"</span>, <span class="string">"智多星"</span>);</span><br><span class="line">heros1[<span class="number">3</span>] = <span class="keyword">new</span> HeroNode(<span class="number">4</span>, <span class="string">"林冲"</span>, <span class="string">"豹子头"</span>);</span><br><span class="line">SingleLinkedList singleLinkedList1 = <span class="keyword">new</span> SingleLinkedList();</span><br><span class="line">singleLinkedList1.addNodeByOrder(heros1[<span class="number">0</span>]);</span><br><span class="line">singleLinkedList1.addNodeByOrder(heros1[<span class="number">1</span>]);</span><br><span class="line">singleLinkedList1.addNodeByOrder(heros1[<span class="number">2</span>]);</span><br><span class="line">singleLinkedList1.addNodeByOrder(heros1[<span class="number">3</span>]);</span><br><span class="line">singleLinkedList1.list();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HeroNode[] heros2 = <span class="keyword">new</span> HeroNode[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">heros2[<span class="number">0</span>] = <span class="keyword">new</span> HeroNode(<span class="number">1</span>, <span class="string">"刘备"</span>, <span class="string">"玄德"</span>);</span><br><span class="line">heros2[<span class="number">1</span>] = <span class="keyword">new</span> HeroNode(<span class="number">2</span>, <span class="string">"关羽"</span>, <span class="string">"云长"</span>);</span><br><span class="line">heros2[<span class="number">2</span>] = <span class="keyword">new</span> HeroNode(<span class="number">3</span>, <span class="string">"张飞"</span>, <span class="string">"翼德"</span>);</span><br><span class="line">heros2[<span class="number">3</span>] = <span class="keyword">new</span> HeroNode(<span class="number">4</span>, <span class="string">"赵云"</span>, <span class="string">"子龙"</span>);</span><br><span class="line">SingleLinkedList singleLinkedList2 = <span class="keyword">new</span> SingleLinkedList();</span><br><span class="line">singleLinkedList2.addNodeByOrder(heros2[<span class="number">0</span>]);</span><br><span class="line">singleLinkedList2.addNodeByOrder(heros2[<span class="number">1</span>]);</span><br><span class="line">singleLinkedList2.addNodeByOrder(heros2[<span class="number">2</span>]);</span><br><span class="line">singleLinkedList2.addNodeByOrder(heros2[<span class="number">3</span>]);</span><br><span class="line">singleLinkedList2.list();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 合并两个有序的单链表,合并后仍然有序</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">HeroNode headFirst = singleLinkedList1.getHead();</span><br><span class="line">HeroNode headSecond = singleLinkedList2.getHead();</span><br><span class="line"><span class="keyword">if</span> (headFirst.getNext() == <span class="keyword">null</span>) &#123;</span><br><span class="line">singleLinkedList1.list();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (headSecond.getNext() == <span class="keyword">null</span>) &#123;</span><br><span class="line">singleLinkedList2.list();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">HeroNode currentFirst = headFirst.getNext();</span><br><span class="line">HeroNode currentSecond = headSecond.getNext();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 链表</span></span><br><span class="line"><span class="comment">// 链表的头节点</span></span><br><span class="line">HeroNode mergeListHead = <span class="keyword">new</span> HeroNode(<span class="number">0</span>, <span class="string">""</span>, <span class="string">""</span>);</span><br><span class="line">HeroNode currentMerge = mergeListHead;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (currentFirst != <span class="keyword">null</span> &amp;&amp; currentSecond != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (currentFirst.getNo() &lt;= currentSecond.getNo()) &#123;</span><br><span class="line">currentMerge.setNext(currentFirst);</span><br><span class="line">currentFirst = currentFirst.getNext();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">currentMerge.setNext(currentSecond);</span><br><span class="line">currentSecond = currentSecond.getNext();</span><br><span class="line">&#125;</span><br><span class="line">currentMerge = currentMerge.getNext();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (currentFirst != <span class="keyword">null</span>) &#123;</span><br><span class="line">currentMerge.setNext(currentFirst);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (currentSecond != <span class="keyword">null</span>) &#123;</span><br><span class="line">currentMerge.setNext(currentSecond);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印合并后的链表</span></span><br><span class="line">HeroNode temp = mergeListHead.getNext();</span><br><span class="line">System.out.println(<span class="string">"===============打印合并后的链表========================="</span>);</span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="comment">// 判断是否到链表最后</span></span><br><span class="line"><span class="keyword">if</span> (temp == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出节点信息</span></span><br><span class="line">System.out.println(temp);</span><br><span class="line"><span class="comment">// 将temp后移</span></span><br><span class="line">temp = temp.getNext();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"===================================================="</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中实现队列</title>
      <link href="/2020/03/27/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/"/>
      <url>/2020/03/27/Java%E4%B8%AD%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是队列"><a href="#什么是队列" class="headerlink" title="什么是队列"></a>什么是队列</h1><ol><li>队列是一个有序列表,可以用数组或是链表来实现</li><li>遵循先入先出的原则</li></ol><h1 id="数组模拟队列思路"><a href="#数组模拟队列思路" class="headerlink" title="数组模拟队列思路"></a>数组模拟队列思路</h1><h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ul><li>队列本身是有序列表,若使用数组的结构来存储队列中的数据,则队列数组的声明如下</li><li>因为队列的输入,输出是分别从数组的最前和最后来处理的,因此需要两个变量<code>front</code>和<code>rear</code>分别记录队列前后端的下标,front会随着数据输出而改变,而rear则是随着数据输入而改变<br><img src="/images/2020/03/20200327001.png" alt></li><li>当我们将数据存入队列是称为<code>addQueue</code>,addQueue的处理需要有如下步骤<ul><li>将尾指针往后移,即<code>rear + 1</code></li><li>若尾指针<code>rear</code>小于队列的最大下标<code>maxSize - 1</code>,则将数据存入rear所指的数组元素中,否则无法存入数据</li></ul></li><li>队列空<code>front == rear</code></li><li>队列满<code>rear == maxSize - 1</code></li></ul><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><ol><li><p>队列代码的实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayQueue</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxSize;<span class="comment">// 表示数组的最大容量</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> front;<span class="comment">// 队列头</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> rear;<span class="comment">// 队列尾</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] arr;<span class="comment">// 该数组用于模拟队列,存放数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 构造器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> maxSize 队列长度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayQueue</span><span class="params">(<span class="keyword">int</span> maxSize)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 指定队列长度</span></span><br><span class="line"><span class="keyword">this</span>.maxSize = maxSize;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化</span></span><br><span class="line">arr = <span class="keyword">new</span> <span class="keyword">int</span>[maxSize];</span><br><span class="line">front = -<span class="number">1</span>;<span class="comment">// 指向队列头部,分析出 front 是指向队列头的前一个位置</span></span><br><span class="line">rear = -<span class="number">1</span>;<span class="comment">// 指向队列尾部,是队列最后一个数据</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断队列是否已满</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFull</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> rear == maxSize - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断队列是否为空</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> rear == front;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加数据到队列(入队列)</span></span><br><span class="line"><span class="comment"> * -&gt;这里的代码只是掩饰用,实际的生产中,这里改成泛型实用性高</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> n 需要加入队列中的数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addQueue</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">System.out.println(<span class="string">"队列满,不能加入数据~"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rear++;<span class="comment">//让rear后移</span></span><br><span class="line">arr[rear] = n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取队列中的数据(出队列)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 队列空的时候,要抛异常</span></span><br><span class="line"><span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"队列空,不能取数据"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">front++;<span class="comment">// front后移</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> arr[front];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示队列中的所有数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">System.out.println(<span class="string">"队列空,没有数据~"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">System.out.printf(<span class="string">"arr[%d]=%d\n"</span>,i, arr[i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示队列的头数据,注意不是取出数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">headQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"队列空,没有数据"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> arr[front + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.After;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayQueueTest</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> ArrayQueue arrayQueue;</span><br><span class="line"><span class="keyword">private</span> Scanner scanner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 创建一个队列</span></span><br><span class="line">arrayQueue = <span class="keyword">new</span> ArrayQueue(<span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">char</span> key = <span class="string">' '</span>;<span class="comment">//接受用户输入</span></span><br><span class="line">scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line"><span class="keyword">boolean</span> loop = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出一个菜单</span></span><br><span class="line"><span class="keyword">while</span> (loop) &#123;</span><br><span class="line">System.out.println(<span class="string">"============================"</span>);</span><br><span class="line">System.out.println(<span class="string">"s(show):显示队列"</span>);</span><br><span class="line">System.out.println(<span class="string">"e(exit):退出程序"</span>);</span><br><span class="line">System.out.println(<span class="string">"a(add):添加数据到队列"</span>);</span><br><span class="line">System.out.println(<span class="string">"g(get):从队列取出数据"</span>);</span><br><span class="line"></span><br><span class="line">key = scanner.next().charAt(<span class="number">0</span>);<span class="comment">//接收第一个字符</span></span><br><span class="line"><span class="keyword">switch</span> (key) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'s'</span>:</span><br><span class="line">arrayQueue.showQueue();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'e'</span>:</span><br><span class="line">scanner.close();</span><br><span class="line">loop = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'a'</span>:</span><br><span class="line">System.out.println(<span class="string">"输入一个数字"</span>);</span><br><span class="line"><span class="keyword">int</span> value = scanner.nextInt();</span><br><span class="line">arrayQueue.addQueue(value);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'g'</span>:</span><br><span class="line">System.out.println(<span class="string">"-----------------------------"</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">int</span> res = arrayQueue.getQueue();</span><br><span class="line">System.out.printf(<span class="string">"取出的数据是%d\n"</span>, res);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">System.out.println(e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@After</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOut</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (scanner != <span class="keyword">null</span>) &#123;</span><br><span class="line">scanner.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h2><ul><li>目前数组使用一次就不能用了</li></ul><h2 id="如何优化"><a href="#如何优化" class="headerlink" title="如何优化"></a>如何优化</h2><ul><li>将这个数组改造成<code>环形的队列</code></li></ul><h1 id="数组模拟环形队列"><a href="#数组模拟环形队列" class="headerlink" title="数组模拟环形队列"></a>数组模拟环形队列</h1><p>前面代码在使用过程中发现,这个数组只能使用一次,无法充分利用数组,为此,思路是将数组看成是一个环形的</p><h2 id="分析说明"><a href="#分析说明" class="headerlink" title="分析说明"></a>分析说明</h2><p>对前面代码进行如下改造</p><ol><li>front变量的含义做一个调整:front指向队列的第一个元素,初始值为0</li><li>rear变量的含义也做调整:rear指向队列的最后一个元素,初始值为0</li><li>数组中空出一个空间不存放队列的数据(有其他用途)</li></ol><p>那么此时</p><ol><li>队列满条件:<code>(rear+1)%maxSize == front</code><br><img src="/images/2020/03/20200327003.png" alt></li><li>队列空条件:<code>rear == front</code></li><li>数据入队列,rear位置向前移动1,由于是环形队列,移动完后的rear指向的位置为:<code>(rear+1)%maxSize</code></li><li>数据出队列,front位置向前移动1,由于是环形队列,移动完后的front指向的位置为:<code>(front+1)%maxSize</code></li><li>队列中有效个数:<code>(rear+maxSize-front)%maxSize</code> (这里要加maxSize是因为rear-front有可能为负数,加上数组长度就能保证是正的)</li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><ol><li><p>环形队列实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.queue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用数组构建环形队列</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleArrayQueue</span> </span>&#123;</span><br><span class="line"><span class="comment">// 数组的最大容量</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxSize;</span><br><span class="line"><span class="comment">// 指向队列第一个元素</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> front;</span><br><span class="line"><span class="comment">// 指向队列尾</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> rear;</span><br><span class="line"><span class="comment">// 该数组用以模拟队列,存放数据</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] arr;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CircleArrayQueue</span><span class="params">(<span class="keyword">int</span> maxSize)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.maxSize = maxSize;</span><br><span class="line">arr = <span class="keyword">new</span> <span class="keyword">int</span>[maxSize];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断队列是否满</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFull</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> (rear + <span class="number">1</span>) % maxSize == front;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断队列是否为空</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> rear == front;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将数据添加到队列</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> n</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addQueue</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 判断队列是否已满</span></span><br><span class="line"><span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">System.out.println(<span class="string">"队列已满,不能加入输入~"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">arr[rear] = n;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 rear 后移一位,由于是环形队列,所以要取模</span></span><br><span class="line">rear = (rear + <span class="number">1</span>) % maxSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从队列中取数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 判断队列是否为空</span></span><br><span class="line"><span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"队列为空"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取数据,front设定上就是第一个数据的位置</span></span><br><span class="line"><span class="keyword">int</span> value = arr[front];</span><br><span class="line"><span class="comment">// 第一个数据取出后,front要向后移动一位</span></span><br><span class="line"><span class="comment">// 由于是环形,所以需要</span></span><br><span class="line">front = (front + <span class="number">1</span>) % maxSize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显示队列中所有数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 遍历</span></span><br><span class="line"><span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">System.out.println(<span class="string">"队列中没有数据"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = front; i &lt; front + size(); i++) &#123;</span><br><span class="line">System.out.printf(<span class="string">"arr[%d]=%d\n"</span>, i%maxSize, arr[i%maxSize]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算数组中元素个数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> (rear + maxSize - front) % maxSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleArrayQueueTest</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> CircleArrayQueue circleArrayQueue;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">circleArrayQueue = <span class="keyword">new</span> CircleArrayQueue(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">char</span> key = <span class="string">' '</span>;<span class="comment">//接受用户输入</span></span><br><span class="line">Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line"><span class="keyword">boolean</span> loop = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出一个菜单</span></span><br><span class="line"><span class="keyword">while</span> (loop) &#123;</span><br><span class="line">System.out.println(<span class="string">"============================"</span>);</span><br><span class="line">System.out.println(<span class="string">"s(show):显示队列"</span>);</span><br><span class="line">System.out.println(<span class="string">"e(exit):退出程序"</span>);</span><br><span class="line">System.out.println(<span class="string">"a(add):添加数据到队列"</span>);</span><br><span class="line">System.out.println(<span class="string">"g(get):从队列取出数据"</span>);</span><br><span class="line"></span><br><span class="line">key = scanner.next().charAt(<span class="number">0</span>);<span class="comment">//接收第一个字符</span></span><br><span class="line"><span class="keyword">switch</span> (key) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'s'</span>:</span><br><span class="line">circleArrayQueue.showQueue();</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'e'</span>:</span><br><span class="line">scanner.close();</span><br><span class="line">loop = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'a'</span>:</span><br><span class="line">System.out.println(<span class="string">"输入一个数字"</span>);</span><br><span class="line"><span class="keyword">int</span> value = scanner.nextInt();</span><br><span class="line">circleArrayQueue.addQueue(value);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="string">'g'</span>:</span><br><span class="line">System.out.println(<span class="string">"-----------------------------"</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">int</span> res = circleArrayQueue.getQueue();</span><br><span class="line">System.out.printf(<span class="string">"取出的数据是%d\n"</span>, res);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">System.out.println(e.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构与算法(Java实现) </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装防火墙管理的图形界面Gufw</title>
      <link href="/2020/03/26/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E9%98%B2%E7%81%AB%E5%A2%99%E7%AE%A1%E7%90%86%E7%9A%84%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2Gufw/"/>
      <url>/2020/03/26/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E9%98%B2%E7%81%AB%E5%A2%99%E7%AE%A1%E7%90%86%E7%9A%84%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2Gufw/</url>
      
        <content type="html"><![CDATA[<h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><blockquote><p>  Gufw 为您提供了一种简单直观的方式来管理 Linux 防火墙。 它支持常见的任务，例如允许和拦截预先配置的、常用的 p2p 端口或单独的端口，以及许多别的规则。</p></blockquote><h1 id="软件界面"><a href="#软件界面" class="headerlink" title="软件界面"></a>软件界面</h1><p><img src="/images/2020/03/20200325013.png" alt></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>Ubuntu软件里有<br><img src="/images/2020/03/20200325012.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装全局搜索软件Synapse</title>
      <link href="/2020/03/26/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E5%85%A8%E5%B1%80%E6%90%9C%E7%B4%A2%E8%BD%AF%E4%BB%B6Synapse/"/>
      <url>/2020/03/26/Ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E5%85%A8%E5%B1%80%E6%90%9C%E7%B4%A2%E8%BD%AF%E4%BB%B6Synapse/</url>
      
        <content type="html"><![CDATA[<h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><blockquote><ul><li>Synapse is a graphical launcher enabling you to start applications and also to quickly find and access relevant documents and files (by making use of the Zeitgeist engine).</li><li>Synapse是一个图形启动器，使您可以启动应用程序，也可以快速查找和访问相关文档和文件（通过使用Zeitgeist引擎）。</li></ul></blockquote><h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="/images/2020/03/20200325008.png" alt></p><p>搜索你想要的</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>Ubuntu软件里有<br><img src="/images/2020/03/20200325010.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中KeePass使用快捷键自动输入用户名密码无效</title>
      <link href="/2020/03/24/Ubuntu%E4%B8%ADKeePass%E6%97%A0%E6%B3%95%E8%87%AA%E5%8A%A8%E8%BE%93%E5%85%A5/"/>
      <url>/2020/03/24/Ubuntu%E4%B8%ADKeePass%E6%97%A0%E6%B3%95%E8%87%AA%E5%8A%A8%E8%BE%93%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><ol><li>按自动键入快捷键<code>ctrl + v</code></li><li>出现<code>the xdotool utility/package is required for auto-type install this package and try again</code>错误<br>即,keepass无法自动键入用户名和密码</li></ol><h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><h3 id="首先安装xdotool软件包"><a href="#首先安装xdotool软件包" class="headerlink" title="首先安装xdotool软件包"></a>首先安装xdotool软件包</h3><p>在Debian / Ubuntu / etc上只需运行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get安装xdotool</span><br></pre></td></tr></table></figure><h3 id="接下来找出系统中安装了keepass2可执行文件的位置"><a href="#接下来找出系统中安装了keepass2可执行文件的位置" class="headerlink" title="接下来找出系统中安装了keepass2可执行文件的位置"></a>接下来找出系统中安装了keepass2可执行文件的位置</h3><p>最简单的方法是运行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">which keepass2</span><br></pre></td></tr></table></figure><p>在我的系统上，这将返回<code>/usr/bin/keepass2</code>。该文件实际上不是程序本身，而是引导程序的脚本。因此，找出真正的可执行文件在哪里运行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/bin/keepass2</span><br></pre></td></tr></table></figure><p>在我的系统上，这返回</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">exec /usr/bin/cli/usr /lib/keepass2/KeePass.exe &quot;$@&quot;</span><br></pre></td></tr></table></figure><p>因此，程序本身实际上位于<code>/usr/lib/keepass2/KeePass.exe</code></p><h3 id="创建自定义键盘快捷键"><a href="#创建自定义键盘快捷键" class="headerlink" title="创建自定义键盘快捷键"></a>创建自定义键盘快捷键</h3><p>根据您所运行的发行版，此过程将有所不同，但通常在“键盘”设置下。对于命令，输入以下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mono /usr/lib/keepass2/KeePass.exe --auto-type</span><br></pre></td></tr></table></figure><p>现在，只要键入快捷键(通常是<code>ctrl + v</code>)，KeePass会自动键入配置的用户名和密码</p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu修改时区</title>
      <link href="/2020/03/21/Ubuntu%E4%BF%AE%E6%94%B9%E6%97%B6%E5%8C%BA/"/>
      <url>/2020/03/21/Ubuntu%E4%BF%AE%E6%94%B9%E6%97%B6%E5%8C%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="查看当前系统时间"><a href="#查看当前系统时间" class="headerlink" title="查看当前系统时间"></a>查看当前系统时间</h1><p><img src="/images/2020/03/20200321001.png" alt></p><h1 id="修改时区"><a href="#修改时区" class="headerlink" title="修改时区"></a>修改时区</h1><p>原来在东京,是东九区,现在要使用东八区的时间,可以如下更改<br><img src="/images/2020/03/20200321002.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法的复杂度</title>
      <link href="/2020/03/21/%E7%AE%97%E6%B3%95%E7%9A%84%E5%A4%8D%E6%9D%82%E5%BA%A6/"/>
      <url>/2020/03/21/%E7%AE%97%E6%B3%95%E7%9A%84%E5%A4%8D%E6%9D%82%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<h1 id="度量一个程序-算法-执行时间的两种方法"><a href="#度量一个程序-算法-执行时间的两种方法" class="headerlink" title="度量一个程序(算法)执行时间的两种方法"></a>度量一个程序(算法)执行时间的两种方法</h1><h2 id="事后统计的方法"><a href="#事后统计的方法" class="headerlink" title="事后统计的方法"></a>事后统计的方法</h2><p>这种方法可行,但是有两个问题</p><ol><li>要想对设计的算法的运行性能进行评测,需要实际运行该程序</li><li>所得时间的统计量依赖于计算机硬件,软件等环境因素</li></ol><h2 id="事前估算的方法"><a href="#事前估算的方法" class="headerlink" title="事前估算的方法"></a>事前估算的方法</h2><p>通过某个算法的时间复杂度来判断哪个算法更优</p><h1 id="时间频度"><a href="#时间频度" class="headerlink" title="时间频度"></a>时间频度</h1><ul><li>时间频度:一个算法花费时间与算法中语句的执行次数成正比例,哪个算法中语句执行次数多,它花费时间就多</li><li><strong>一个算法中的语句执行次数称为语句频度或时间频度</strong>,记为T(n)</li></ul><h1 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h1><h2 id="什么是时间复杂度"><a href="#什么是时间复杂度" class="headerlink" title="什么是时间复杂度"></a>什么是时间复杂度</h2><ol><li>一般情况下,算法中的基本操作语句的重复执行次数是问题规模n的某个函数,用T(n)表示,若某个辅助函数f(n),使得当n趋于无穷大时,T(n)/f(n)的极限值为不等于零的常数,则称f(n)是T(n)的同数量级函数.记作<code>T(n)=O(f(n))</code>,称为O(f(n))为算法的渐进时间复杂度,简称时间复杂度</li><li>T(n)不同,但时间复杂度可能相同<ul><li>如:T(n)=n^2+7n+6与T(n)=3n^2+2n+2它们的T(n)不同,但时间复杂度相同,都为O(n^2)</li></ul></li></ol><h2 id="计算时间复杂度的方法"><a href="#计算时间复杂度的方法" class="headerlink" title="计算时间复杂度的方法"></a>计算时间复杂度的方法</h2><p>计算时间复杂度的方法</p><ul><li>用常数<code>1</code>代替运行时间中所有加法常数<code>T(n)=n^2+7n+6 =&gt; T(n)=n^2+7n+1</code></li><li>修改后的运行次数函数中,只保留最高阶项<code>T(n)=n^2+7n+1 =&gt; T(n)=n^2</code></li><li>去除最高项的系数<code>T(n)=n^2 =&gt; T(n)=n^2</code></li></ul><h1 id="常见的时间复杂度"><a href="#常见的时间复杂度" class="headerlink" title="常见的时间复杂度"></a>常见的时间复杂度</h1><ol><li>常数阶O(1)</li><li>对数阶O(log2(n))</li><li>线性阶O(n)</li><li>线性对数阶O(nlog2(n))</li><li>平方阶O(n^2)</li><li>立方阶O(n^3)</li><li>k 次方阶O(n^k)</li><li>指数阶O(2^n)</li></ol><h2 id="常见的时间复杂度对应的图"><a href="#常见的时间复杂度对应的图" class="headerlink" title="常见的时间复杂度对应的图"></a>常见的时间复杂度对应的图</h2><p><img src="/images/2020/04/20200415002.png" alt></p><p>说明</p><ol><li>常见的算法时间复杂度由小到大一次为:<code>O(1) &lt; O(log2(n)) &lt; O(n) &lt; O(nlog2(n)) &lt; O(n^2) &lt; O(n^3) &lt; O(n^k) &lt; O(2^n)</code></li><li>随着问题规模n的不断增大,上述时间复杂度不断增大,算法的执行效率越低</li></ol><h2 id="常见时间复杂度说明"><a href="#常见时间复杂度说明" class="headerlink" title="常见时间复杂度说明"></a>常见时间复杂度说明</h2><h3 id="常数阶O-1"><a href="#常数阶O-1" class="headerlink" title="常数阶O(1)"></a>常数阶O(1)</h3><p>无论代码执行多少行,只要是没有循环等复杂结构,那这个代码的时间复杂度都是O(1)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> j = <span class="number">2</span>;</span><br><span class="line">++i;</span><br><span class="line">j++;</span><br><span class="line"><span class="keyword">int</span> m = i + j;</span><br></pre></td></tr></table></figure><h3 id="对数阶O-log2-n"><a href="#对数阶O-log2-n" class="headerlink" title="对数阶O(log2(n))"></a>对数阶O(log2(n))</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span> (i &lt; n) &#123;</span><br><span class="line">    i = i * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在while循环里面,每次都将i乘以2,乘完之后,i距离n就越来越近.假设循环x次之后,i就大于2了,此时这个循环就退出了,也就是说2的x次方等于n,那么<code>x=log2(n)</code>也就是说当循环<code>log2(n)</code>次以后,这个代码就结束了.因此这个代码的时间复杂度为O(log2(n))</p><h3 id="线性阶O-n"><a href="#线性阶O-n" class="headerlink" title="线性阶O(n)"></a>线性阶O(n)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">    j = i;</span><br><span class="line">    j++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段代码,for循环里面的代码会执行n遍,因此它消耗的时间是随着n的变化而变化的,因此这类代码都可以用O(n)来表示它的时间复杂度</p><h3 id="线性对数阶O-nlogN"><a href="#线性对数阶O-nlogN" class="headerlink" title="线性对数阶O(nlogN)"></a>线性对数阶O(nlogN)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (m=<span class="number">1</span>; m&lt;n; m++) &#123;</span><br><span class="line">    i = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; n) &#123;</span><br><span class="line">        i = i * <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将时间复杂度为O(log2(n))的代码循环n遍的花,它的时间复杂度就是<code>n*O(log2(n))</code>,也就是O(nlog2(n))</p><h3 id="平方阶"><a href="#平方阶" class="headerlink" title="平方阶"></a>平方阶</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (x = <span class="number">1</span>; i &lt;= n, i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        j = i;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>如果把O(n)的代码循环以便,它的时间复杂度就是O(n^2)</li><li>如果将其中一层循环的n改成m,那么它的时间复杂度就变成了<code>O(m*n)</code></li></ul><h2 id="平均时间复杂度和最坏时间复杂度"><a href="#平均时间复杂度和最坏时间复杂度" class="headerlink" title="平均时间复杂度和最坏时间复杂度"></a>平均时间复杂度和最坏时间复杂度</h2><ol><li>平均时间复杂度指所有可能的输入实例均以等概率出现的情况下,该算法的运行时间</li><li>最坏情况下的时间复杂度称最坏时间复杂度,<strong>一般讨论的时间复杂度均是最坏情况下的时间复杂度</strong>,这样做原因是:最坏情况下的时间复杂度是算法在任何输入实例上运行时间的界限,这就保证了算法的运行时间不会比最坏情况更长</li><li>平均时间复杂度和最坏时间复杂度是否一致,和算法有关:<br><img src="/images/2020/04/20200426004.png" alt><br>表中涉及的相关术语解释</li></ol><ul><li>稳定:如果a原本在b前面,而a=b,排序之后a仍然在b前面</li><li>不稳定:如果a原本在b的前面,而a=b,排序之后,a可能会出现在b的后面</li><li>内排序:所有排序操作都是在内存中完成</li><li>外排序:由于数据太大,因此把数据放在磁盘中,而排序通过磁盘和内存的数据传输才能进行</li><li>时间复杂度:一个算法执行所耗费的时间</li><li>空间复杂度:运行完一个程序所需内存的大小</li><li>n:数据规模</li><li>k:”桶”的个数</li><li>In-palce:不占用额外内存</li><li>Out-place:占用额外内存</li></ul><h1 id="空间复杂度"><a href="#空间复杂度" class="headerlink" title="空间复杂度"></a>空间复杂度</h1><ol><li>类似于时间复杂度,一个算法的空间复杂度(<code>Space Complexity</code>)定义为该算法所耗费的存储空间,它也是问题规模n的函数</li><li>空间复杂度是对一个算法在运行时中临时占用存储空间大小的量度.有的算法需要占用的临时工作单元数与解决的问题的规模n有关,它随着n的增大而增大,当n较大时,将占用较多的存储单元,例如快速排序和规并排序算法,基数排序就属于这种情况</li><li>在做算法分析时,主要讨论的是时间复杂度.从用户体验上看,更看重的程序执行的速度.一些缓存产品(redis,memcache)和算法(基数排序)本质就是<strong>用空间换时间</strong></li></ol>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>企业家思想进化与全球格局</title>
      <link href="/2020/03/20/notes_%E4%BC%81%E4%B8%9A%E5%AE%B6%E6%80%9D%E6%83%B3%E8%BF%9B%E5%8C%96%E4%B8%8E%E5%85%A8%E7%90%83%E6%A0%BC%E5%B1%80/"/>
      <url>/2020/03/20/notes_%E4%BC%81%E4%B8%9A%E5%AE%B6%E6%80%9D%E6%83%B3%E8%BF%9B%E5%8C%96%E4%B8%8E%E5%85%A8%E7%90%83%E6%A0%BC%E5%B1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="视频地址"><a href="#视频地址" class="headerlink" title="视频地址"></a>视频地址</h1><p><a href="https://www.bilibili.com/video/av97442520?t=248" target="_blank" rel="noopener">https://www.bilibili.com/video/av97442520?t=248</a></p><h1 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h1><p>基本判断:百年未有之大变局</p><p>四个角度</p><h2 id="新的国际格局正在形成"><a href="#新的国际格局正在形成" class="headerlink" title="新的国际格局正在形成"></a>新的国际格局正在形成</h2><p>国际格局从西方主导转向东西方平衡,国际格局指的是国家间的力量对比</p><h2 id="新的现代化模式得到承认"><a href="#新的现代化模式得到承认" class="headerlink" title="新的现代化模式得到承认"></a>新的现代化模式得到承认</h2><ul><li>荷兰模式</li><li>英国模式(英美模式)</li><li>德国模式</li><li>瑞典模式</li><li>中国模式(新)</li></ul><h2 id="新的工业革命正在到来"><a href="#新的工业革命正在到来" class="headerlink" title="新的工业革命正在到来"></a>新的工业革命正在到来</h2><ul><li>第四次工业革命中美竞争,且中国的赢面大</li></ul><h2 id="新的全球问题正在出现"><a href="#新的全球问题正在出现" class="headerlink" title="新的全球问题正在出现"></a>新的全球问题正在出现</h2><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>四大新都与中国有关,中国是主要变量.第四次工业革命是中国最伟大的机遇</p>]]></content>
      
      
      <categories>
          
          <category> 视频笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 视频笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>中西方文化差异的渊源</title>
      <link href="/2020/03/12/notes_%E4%B8%AD%E8%A5%BF%E6%96%B9%E6%96%87%E5%8C%96%E5%B7%AE%E5%BC%82%E7%9A%84%E6%B8%8A%E6%BA%90/"/>
      <url>/2020/03/12/notes_%E4%B8%AD%E8%A5%BF%E6%96%B9%E6%96%87%E5%8C%96%E5%B7%AE%E5%BC%82%E7%9A%84%E6%B8%8A%E6%BA%90/</url>
      
        <content type="html"><![CDATA[<h1 id="视频地址"><a href="#视频地址" class="headerlink" title="视频地址"></a>视频地址</h1><p><a href="https://www.bilibili.com/video/av77285058?p=1" target="_blank" rel="noopener">【王德峰】中西方文化差异的渊源</a></p><h1 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h1><ul><li><p>柏拉图理念论</p><ul><li>世界可以被改造</li><li>历史进步论</li></ul></li><li><p>如来说:世界 绝非世界 名世界</p></li><li><p>缘起性空</p><ul><li>复性工夫</li></ul></li><li><p>大学之道,在明明德,在亲民,在止于致善</p></li><li><p>本心会起念,起妄念就会有烦恼</p></li><li><p>应无所住而生其心</p><ul><li>住 就是相</li><li>相是存在</li><li>善相,净相也不应住</li></ul></li><li><p>无烦恼就无所谓智慧,没有烦恼要智慧干嘛</p></li><li><p>天道在人民生活中,众生的烦恼就是天道之体现</p></li><li><p>不要害怕烦恼,烦恼即修行</p></li><li><p>西方</p><ul><li>第一等级 理性</li><li>第二等级 意志</li><li>第三等级 情感</li></ul></li><li><p>中国</p><ul><li>《诗》三百，一言以蔽之，曰‘思无邪’</li></ul></li><li><p>反者道之动</p><ul><li>你要得到什么事物,必须从这个事物的反面开始</li></ul></li><li><p>你要比较长久的保持一个事物,必须让这个事物保持它的对立面</p><ul><li>困难是我们的恩人,敌人是我们的老师</li><li>一路顺风顺水则马上要灭亡</li></ul></li><li><p>五伦</p><ul><li>君仁臣义</li><li>父慈子孝</li><li>夫妻有别(夫妻共命运,但夫妻有区别,各司其职)</li><li>长幼有序</li><li>朋友有信</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 视频笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 视频笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入理解浮点数与浮点数的精度问题</title>
      <link href="/2020/03/10/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E6%B5%AE%E7%82%B9%E6%95%B0%E4%B8%8E%E6%B5%AE%E7%82%B9%E6%95%B0%E7%9A%84%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/"/>
      <url>/2020/03/10/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E6%B5%AE%E7%82%B9%E6%95%B0%E4%B8%8E%E6%B5%AE%E7%82%B9%E6%95%B0%E7%9A%84%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://zh.wikipedia.org/wiki/%E5%96%AE%E7%B2%BE%E5%BA%A6%E6%B5%AE%E9%BB%9E%E6%95%B8" target="_blank" rel="noopener">单精度浮点数</a></li><li><a href="https://blog.csdn.net/dreamer2020/article/details/24158303" target="_blank" rel="noopener">深入理解浮点数有效位</a></li></ul><h1 id="为什么会有精度问题"><a href="#为什么会有精度问题" class="headerlink" title="为什么会有精度问题"></a>为什么会有精度问题</h1><ol><li>在数学中,与浮点数对应的是小数</li><li>数学上区间[0,1]之间的小数有无穷多个</li><li>计算机中,32位浮点数最多可以表示2^32个数</li></ol><p>所以,计算机是不可能描述得尽的,必然会有一些近似,一些精度所示</p><h1 id="计算机中如何表示浮点数"><a href="#计算机中如何表示浮点数" class="headerlink" title="计算机中如何表示浮点数"></a>计算机中如何表示浮点数</h1><h2 id="浮点数的格式"><a href="#浮点数的格式" class="headerlink" title="浮点数的格式"></a>浮点数的格式</h2><p>当前，计算机中浮点数采用的是IEEE 754标准。浮点数分为单精度浮点数(32位)和双精度浮点数(64位)。浮点数的基本格式如下：<br><img src="/images/2020/03/20200309019.png" alt></p><p>各部分含义如下：</p><ul><li>sign：符号位，0表示正，1表示负</li><li>exponent：阶码，浮点数的幂次。一般采用移码表示。</li><li>fraction：浮点数的小数部分</li></ul><h2 id="二进制的浮点数转十进制"><a href="#二进制的浮点数转十进制" class="headerlink" title="二进制的浮点数转十进制"></a>二进制的浮点数转十进制</h2><p>上述格式描述的浮点数的十进制值为<code>value = (-1)^S * (1.fraction) * 2^(exponent - 偏差)</code></p><ul><li><code>(-1)^S</code>表示符号</li><li><code>1.fraction</code>是二进制的小数<ul><li>由于除0外的所有小数都可以写成1.fractionX2^E的形式，因而，在表示浮点数时，省略掉了前面的整数部分1</li></ul></li><li><code>2^(exponent - 偏差)</code>表示幂次，类似于二进制的科学计数法<ul><li>单精度情况下<code>2^(exponent - 127)</code></li><li>双精度情况下<code>2^(exponent - 1023)</code></li><li><code>exponent - 127</code>或者<code>exponent - 1023</code>是因为指数有正有负,单精度情况下,阶码有8位,即表示(2^8 - 1)个数,正数负数对半分,就是减去127(双精度同理)</li></ul></li></ul><h2 id="非规范化小数"><a href="#非规范化小数" class="headerlink" title="非规范化小数"></a>非规范化小数</h2><p>上面描述的是规格化的浮点数，如果<code>浮点数的阶码部分全0或者全1，则表示非规格化的浮点数</code>。</p><ul><li>阶码不是全0或全1，规格化浮点数。</li><li>阶码全0：表示<code>0.fraction * 2^ (1-127)</code>次。注意，此时指数部分是1-127.这一类表示了接近0的小数部分。</li><li>阶码全1：如果小数部分全0，表示正负无穷大。如果出现1，表示不是一个数<code>NaN</code>。</li></ul><h2 id="举例说明"><a href="#举例说明" class="headerlink" title="举例说明"></a>举例说明</h2><p><img src="/images/2020/03/20200309020.png" alt></p><h1 id="浮点数的精度"><a href="#浮点数的精度" class="headerlink" title="浮点数的精度"></a>浮点数的精度</h1><p>通过上面的介绍可以发现，浮点数的精度取决于二进制小数部分的精度。对于单精度浮点数，小数部分有23位，对应十进制小数见下表</p><table><thead><tr><th>二进制小数</th><th>十进制小数</th></tr></thead><tbody><tr><td>2^-23</td><td>0.00000011920928955078125</td></tr><tr><td>2^-22</td><td>0.0000002384185791015625</td></tr><tr><td>2^-21</td><td>0.000000476837158203125</td></tr><tr><td>2^-20</td><td>0.00000095367431640625</td></tr><tr><td>2^-19</td><td>0.0000019073486328125</td></tr><tr><td>2^-18</td><td>0.000003814697265625</td></tr></tbody></table><ul><li>由于是规格化的浮点数，所以小数部分都要加上1，可以知道，单精度浮点数的小数部分最小是1.00000011920928955078125，其次是1.0000002384185791015625，注意到这两个小数之间的间隔</li><li>那么,要表示1.0000001和1.0000002之间的小数，则单精度浮点数无能为力，1.0000001已经是23位小数部分描述的最小值了</li><li>通过这样的分析可以发现，23位只能描述到小数点后第7位，即1.0000001，1.0000002，1.0000004，1.0000009对应了二进制的小数值，其他要通过上面几个的组合来表示</li><li>事实上，如果考虑保留前7位,而第8位的四舍五入，1.0000004，1.0000009本身的表示也是不准确的。</li><li>类似的分析，双精度浮点数能准确表示到小数点后第15位，第16位部分准确</li></ul><h1 id="一个整数用float来存储时保存的精度有多少"><a href="#一个整数用float来存储时保存的精度有多少" class="headerlink" title="一个整数用float来存储时保存的精度有多少"></a>一个整数用float来存储时保存的精度有多少</h1><p>思路:</p><ul><li>将整数转化为二进制科学计数法形式，然后再对应到规格化浮点数中</li><li>在处理小数部分时，多余的数位即为损失的精度</li></ul><p>结论</p><ul><li>一般来说，无论是整数或者小数，用float表示时，从左边第一个非0的数字算起，从高到低的7位是准确的。此后的数位是不能保证精确的。</li><li>相应的，从1到0x1FFFFFFFFFFFFF(53位全1，18014398509481983)均可以准确用double来表示。其他整数，只有在转化为double时小数部分不超过52位才可以精确表示。否则，会有一定的精度损失。无论整数或者小数，用double表示时，从左边第一个非0的数字起，从高到低的16位是准确的，此后的数位不一定精确。</li></ul><h1 id="浮点数分布"><a href="#浮点数分布" class="headerlink" title="浮点数分布"></a>浮点数分布</h1><p>通过上面的分析可以发现，尽管浮点数表示的范围很广，但由于精度损失的存在，加上幂次的放大作用，一个浮点数实际上是表示了周围的一个有理数区间。如果将浮点数绘制到一个数轴上，直观上看，靠近0的部分，浮点数出现较密集。越靠近无穷大，浮点数分布越稀疏，一个浮点值代表了周围一片数据。如下图所示。从这个意义上来说，浮点数不宜直接比较相等，它们是代表了一个数据范围。实际应用中，如果要使用浮点数计算，一定要考虑精度问题。在满足精度要求的前提下，计算结果才是有效的。<br><img src="/images/2020/03/20200309021.png" alt><br>在计算精度要求情形下，例如商业计算等，应该避免使用浮点数，严格采取高精度计算。</p>]]></content>
      
      
      <categories>
          
          <category> 计算机组成原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机组成原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>原码反码与补码</title>
      <link href="/2020/03/09/%E5%8E%9F%E7%A0%81%E5%8F%8D%E7%A0%81%E4%B8%8E%E8%A1%A5%E7%A0%81/"/>
      <url>/2020/03/09/%E5%8E%9F%E7%A0%81%E5%8F%8D%E7%A0%81%E4%B8%8E%E8%A1%A5%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1 id="正数补码"><a href="#正数补码" class="headerlink" title="正数补码"></a>正数补码</h1><ul><li>和原码相同</li></ul><h1 id="负数补码"><a href="#负数补码" class="headerlink" title="负数补码"></a>负数补码</h1><ul><li><p>原码<br>第一位为符号位(0为正数,1为负数)</p></li><li><p>反码<br>符号位不动,原码取反</p></li><li><p>负数补码<br>符号位不动,反码加1</p></li><li><p>十进制数字用原码,反码,补码表示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 十进制</span><br><span class="line">5</span><br><span class="line">// 二进制</span><br><span class="line">0000 0101</span><br><span class="line"></span><br><span class="line">----------------------------</span><br><span class="line"></span><br><span class="line">// 十进制</span><br><span class="line">-6</span><br><span class="line">// 二进制</span><br><span class="line">原码:1000 0110</span><br><span class="line">反码:1111 1001</span><br><span class="line">补码:1111 1010</span><br><span class="line"></span><br><span class="line">---------------------------</span><br><span class="line"></span><br><span class="line">// 十进制</span><br><span class="line">-1</span><br><span class="line">// 二进制</span><br><span class="line">原码:1000 0001</span><br><span class="line">反码:1111 1110</span><br><span class="line">补码:1111 1111</span><br></pre></td></tr></table></figure></li><li><p>打印整数的二进制表示</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里打印6的二进制数</span></span><br><span class="line"><span class="keyword">int</span> a = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;  <span class="comment">// 整数有32位,所以要做32次循环</span></span><br><span class="line">    <span class="comment">// 0x80000000 表示最高位为1的数字</span></span><br><span class="line">    <span class="keyword">int</span> t = (a &amp; <span class="number">0x80000000</span> &gt;&gt;&gt; i) &gt;&gt;&gt; (<span class="number">31</span> - i);</span><br><span class="line">    System.out.print(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">说明:</span><br><span class="line">+   <span class="number">0x80000000</span>是数的十六进制表示，转成二进制表示为<span class="number">10000000000000000000000000000000</span></span><br><span class="line">+   运算的优先级，移位运算高于逻辑运算，&gt;&gt;&gt; 高于 &amp;</span><br><span class="line">+   位逻辑与运算 <span class="number">1</span>&amp;<span class="number">1</span> = <span class="number">1</span> ，<span class="number">0</span>&amp;<span class="number">1</span> = <span class="number">0</span></span><br><span class="line">+   &gt;&gt;&gt;无符号右移，移出部分舍弃，左边位补<span class="number">0</span>；</span><br><span class="line">+   &gt;&gt;有符号、&gt;&gt;&gt;无符号看的就是二进制的符号位，无符号:就不管符号位，右移只填充<span class="number">0</span>；有符号，就是符号位是啥，我就填充啥</span><br></pre></td></tr></table></figure></li></ul><h1 id="无符号右移和无符号右移"><a href="#无符号右移和无符号右移" class="headerlink" title="无符号右移和无符号右移"></a>无符号右移和无符号右移</h1><p><code>&gt;&gt;</code>有符号、<code>&gt;&gt;&gt;</code>无符号看的就是二进制的符号位</p><ul><li>无符号:就不管符号位，右移只填充0</li><li>有符号:就是符号位是啥，我就填充啥</li></ul><h1 id="为什么要用补码"><a href="#为什么要用补码" class="headerlink" title="为什么要用补码"></a>为什么要用补码</h1><ol><li>为了统一<code>+0</code>和<code>-0</code></li><li>为了将减法转换成加法</li></ol><p><strong>1.统一<code>+0</code>和<code>-0</code></strong></p><ul><li><p>用原码表示0,则0会出现两个数字</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line"></span><br><span class="line">原码正数0:0000 0000</span><br><span class="line">原码负数0:1000 0000</span><br></pre></td></tr></table></figure></li><li><p>用补码表示,则不管是<code>+0</code>还是<code>-0</code>,表现是唯一的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// +0的补码</span><br><span class="line">补码:0000 0000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// -0的补码</span><br><span class="line">原码:1000 0000</span><br><span class="line">反码:1111 1111</span><br><span class="line">补码:0000 0000</span><br></pre></td></tr></table></figure></li></ul><p><strong>2.使用补码计算加法,可以不用考虑符号位(符号位参与运算),直接加就行</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-6 + 5</span><br><span class="line"></span><br><span class="line"> 1111 1010</span><br><span class="line">+0000 0101</span><br><span class="line">=1111 1111</span><br><span class="line"></span><br><span class="line">-----------------------</span><br><span class="line"></span><br><span class="line">-4 + 5</span><br><span class="line"></span><br><span class="line"> 1111 1100</span><br><span class="line">+0000 0101</span><br><span class="line">=0000 0001</span><br><span class="line"></span><br><span class="line">------------------------</span><br><span class="line"></span><br><span class="line">-3 + 5</span><br><span class="line"> 1111 1101</span><br><span class="line">+0000 0101</span><br><span class="line">=0000 0010</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 计算机组成原理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 计算机组成原理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git合并分支</title>
      <link href="/2020/03/02/Git%E5%90%88%E5%B9%B6%E5%88%86%E6%94%AF/"/>
      <url>/2020/03/02/Git%E5%90%88%E5%B9%B6%E5%88%86%E6%94%AF/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  预备知识</p><ol><li><a href="/2020/02/23/Git底层逻辑/">Git底层逻辑</a></li><li><a href="/2020/03/01/Git之三路合并/">Git之三路合并(3-Way Merge)</a></li></ol></blockquote><h1 id="Git-Merge"><a href="#Git-Merge" class="headerlink" title="Git Merge"></a>Git Merge</h1><h2 id="当前分支图"><a href="#当前分支图" class="headerlink" title="当前分支图"></a>当前分支图</h2><p><img src="/images/2020/03/20200301011.png" alt></p><h2 id="进行合并"><a href="#进行合并" class="headerlink" title="进行合并"></a>进行合并</h2><ol><li><p>执行如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#   在master分支执行</span><br><span class="line">git merge bugFix</span><br></pre></td></tr></table></figure></li><li><p>上述命令要将<code>bugFix</code>分支合并到<code>master</code>分支,首先要查找共同祖先,即找到C0</p></li><li><p>根据三路合并的说明,说明这个C0提交的地位是三路合并中的<code>Base</code></p></li><li><p>对<code>&lt;C0，C1，C4&gt;</code>进行三路合并,合并完之后会有新文件产生(不管是增加内容还是减少内容)</p></li><li><p>此时对文件构建<code>Blob</code>,<code>Tree Object</code>,<code>Commit Object</code></p></li><li><p>这样就得到一个包含更改的新提交</p></li></ol><h2 id="合并完之后的分支图"><a href="#合并完之后的分支图" class="headerlink" title="合并完之后的分支图"></a>合并完之后的分支图</h2><p><img src="/images/2020/03/20200301012.png" alt></p><h1 id="Git-Cheery-Pick"><a href="#Git-Cheery-Pick" class="headerlink" title="Git Cheery-Pick"></a>Git Cheery-Pick</h1><p>cherry-pick 和它的名称一样，精心挑选，挑选一个我们需要的 commit 进行操作。它可以用于将在其他分支上的 commit 修改，移植到当前的分支。</p><h2 id="当前分支图-1"><a href="#当前分支图-1" class="headerlink" title="当前分支图"></a>当前分支图</h2><p><img src="/images/2020/03/20200301013.png" alt></p><h2 id="进行合并-1"><a href="#进行合并-1" class="headerlink" title="进行合并"></a>进行合并</h2><ol><li><p>执行如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git cherry-pick &lt;C4&gt;</span><br></pre></td></tr></table></figure></li><li><p>计算C4引入的更改：C4-C2</p></li><li><p>应用更改：C3 +（C4-C2）</p></li><li><p>创建一个包含更改的新提交。</p></li></ol><p>实际上是（C2，C3，C4）的三向合并,这里C2的地位是<code>Base</code></p><h2 id="合并完之后的分支图-1"><a href="#合并完之后的分支图-1" class="headerlink" title="合并完之后的分支图"></a>合并完之后的分支图</h2><p><img src="/images/2020/03/20200301014.png" alt></p><h1 id="Git-Rebas"><a href="#Git-Rebas" class="headerlink" title="Git Rebas"></a>Git Rebas</h1><h2 id="当前分支图-2"><a href="#当前分支图-2" class="headerlink" title="当前分支图"></a>当前分支图</h2><p><img src="/images/2020/03/20200301015.png" alt></p><h2 id="进行合并-2"><a href="#进行合并-2" class="headerlink" title="进行合并"></a>进行合并</h2><ol><li><p>执行如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase master</span><br></pre></td></tr></table></figure></li><li><p>寻找共同祖先</p></li><li><p>确定要选择的提交：C2，C4</p></li><li><p>前换到master分支<br><img src="/images/2020/03/20200301016.png" alt></p></li><li><p>cherry-pick C2<br><img src="/images/2020/03/20200301017.png" alt></p></li><li><p>cherry-pick C4<br><img src="/images/2020/03/20200301018.png" alt></p></li></ol><h2 id="合并完之后的分支图-2"><a href="#合并完之后的分支图-2" class="headerlink" title="合并完之后的分支图"></a>合并完之后的分支图</h2><p>就是上图</p><h2 id="Merge和Rebase比较"><a href="#Merge和Rebase比较" class="headerlink" title="Merge和Rebase比较"></a>Merge和Rebase比较</h2><h3 id="Merge"><a href="#Merge" class="headerlink" title="Merge"></a>Merge</h3><ul><li>提交历史被保留</li><li>生成一个额外的提交</li><li>历史不是线性的</li></ul><h3 id="Rebase"><a href="#Rebase" class="headerlink" title="Rebase"></a>Rebase</h3><ul><li>提交历史被重写</li><li>没有额外的提交</li><li>历史是线性的</li></ul><h2 id="Rebase需要注意"><a href="#Rebase需要注意" class="headerlink" title="Rebase需要注意"></a>Rebase需要注意</h2><p>不要Rebase公共分支</p><h1 id="最后强调一下"><a href="#最后强调一下" class="headerlink" title="最后强调一下"></a>最后强调一下</h1><p>可能看这篇文章的人,并不会看预备知识的文章,所以在这里强调一下<strong>3-way Merge 不等于 Diff-Apply</strong></p><p><img src="/images/2020/03/20200301019.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ git diff bugFix~ bugFix &gt; x.patch</span><br><span class="line"></span><br><span class="line">$ cat x.patch</span><br><span class="line">diff --git a/x.txt b/x.txt</span><br><span class="line">index 8026076..5a49123 100644</span><br><span class="line">--- a/x.txt</span><br><span class="line">+++ b/x.txt</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> Base Line</span><br><span class="line">+Line below</span><br><span class="line"></span><br><span class="line">$ git apply x.patch</span><br><span class="line">error: patch failed: x.txt:1</span><br><span class="line">error: x.txt: patch does not apply</span><br><span class="line"></span><br><span class="line">$ git cherry-pick bugFix</span><br><span class="line">[master a25402c] bugFix: modified</span><br><span class="line"> Date: Wed Jul 26 12:17:28 2017 +0800</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git之三路合并(3-Way Merge)</title>
      <link href="/2020/03/01/Git%E4%B9%8B%E4%B8%89%E8%B7%AF%E5%90%88%E5%B9%B6/"/>
      <url>/2020/03/01/Git%E4%B9%8B%E4%B8%89%E8%B7%AF%E5%90%88%E5%B9%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="三路合并-3-way-merge"><a href="#三路合并-3-way-merge" class="headerlink" title="三路合并(3-way merge)"></a>三路合并(<code>3-way merge</code>)</h1><p>其实我也不知道正统是不是这样翻译,看英文单词,这个不重要,重要的是三路合并的想法,接下去对三路合并进行简要说明</p><h2 id="首先先弄清楚Diff的时候发生了什么"><a href="#首先先弄清楚Diff的时候发生了什么" class="headerlink" title="首先先弄清楚Diff的时候发生了什么"></a>首先先弄清楚<code>Diff</code>的时候发生了什么</h2><ol><li><p>要比较的字符串如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#   字符串一</span><br><span class="line">a b c d f g h j q z</span><br><span class="line"></span><br><span class="line">#   字符串二</span><br><span class="line">a b c d e f g i j k r x y z</span><br></pre></td></tr></table></figure></li><li><p>查找最长的公共子序列(<a href="https://zh.wikipedia.org/wiki/%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%AD%90%E5%BA%8F%E5%88%97" target="_blank" rel="noopener">维基百科:LCS(最长公共子序列)</a>)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#   使用肉眼观察,明显最长公共子序列是如下字符串(计算机中如何找出来不再此次讨论范围)</span><br><span class="line">a b c d e f g i j k r x y z</span><br></pre></td></tr></table></figure></li><li><p>将字符串一对齐到最长的公共子序列(LCS)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a b c d   f g h j q       z</span><br><span class="line">a b c d e f g i j k r x y z</span><br></pre></td></tr></table></figure></li><li><p>可以得到字符串一与最长公共子序列的不同</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e  h i  q  k r x y</span><br><span class="line">+  - +  -  + + + +</span><br></pre></td></tr></table></figure></li></ol><h2 id="其次说说二路合并-2-way-merge"><a href="#其次说说二路合并-2-way-merge" class="headerlink" title="其次说说二路合并(2-way merge)"></a>其次说说二路合并(2-way merge)</h2><ul><li><p>现在有如下两个文件,其中”你”和”我”的文件中,第37行有冲突<br><img src="/images/2020/03/20200301004.png" alt></p></li><li><p>为了将”你”和”我”的文件进行合并,需要回答如下问题</p><ul><li>上述两个文件中,如何知道到底是谁修改了第37行？</li><li>“你”还是”我”?</li><li>亦或是”你”和”我”都进行修改了?</li></ul></li><li><p>如何解决上述问题?</p><ul><li>“你”和”我”都必须记住所有更改</li><li>所有差异都应手动解决。</li></ul></li></ul><h2 id="最后说明什么是三路合并-3-way-merge"><a href="#最后说明什么是三路合并-3-way-merge" class="headerlink" title="最后说明什么是三路合并(3-way merge)"></a>最后说明什么是三路合并(3-way merge)</h2><h3 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h3><p>在二路合并中的说明中,我们知道,有两件事需要解决,但事实上,记住所有的更改和所有差异都手动解决是非常繁琐的,如果文件非常多,甚至是不可能的,为了解决这两个”不可能”,设计了如下的三路合并</p><ul><li><p>现有如下三个文件<code>Base</code>,<code>Yours</code>,<code>Mine</code><br><img src="/images/2020/03/20200301005.png" alt></p></li><li><p>对三个文件互相比较(一般情况下,是一行一行进行比较),按<strong>如下规则</strong>进行合并</p><ul><li>在3个文件中都相同:<ul><li>不变  -&gt;  说明<code>Yours</code>和<code>Mine</code>都没有进行修改</li></ul></li><li>在2个文件中相同,第3个文件不相同:<ul><li>输出与Base不同的内容  -&gt;  和Base不同,说明这个文件进行了修改,在上图中,应是<code>Yours</code>进行了修改</li><li>丢弃与Base相同的那个  -&gt;  和Base相同,说明这个文件没有进行修改,在上图中,应是<code>Mine</code>,也就是这个文件比较旧</li></ul></li><li>在3个文件中都不同<ul><li>冲突  -&gt; 说明需要合并的两个文件都比Base文件”新”,而两个文件又正好改到同一行,此时,计算机肯定是没有办法判断的,就要手动进行解决</li></ul></li></ul></li><li><p>依照上述规则,我们试着合并下述文件<br><img src="/images/2020/03/20200301006.png" alt><br>一般情况下,我们是一行一行进行比较</p></li></ul><ol><li><p>比较37行,将<code>Yours</code>,<code>Mine</code>与<code>Base</code>进行比较,发现是<code>在2个文件中相同,第3个文件不相同</code>,所以合并之后的文件中的第37行应是<code>print(“hello”)</code></p></li><li><p>比较50行,由于在三个文件文件中都不同,说明<code>Yours</code>和<code>Mine</code>都进行了修改,这时候计算机无法判断,就有冲突(conflict),这时候需要手动解决</p></li><li><p>比较75行,由于<code>Yours</code>和<code>Base</code>相同而<code>Mine</code>和<code>Base</code>不同,<code>在2个文件中相同,第3个文件不相同</code>,所以第75行应是<code>print(“end”)</code></p></li><li><p>这样我们就能得到如下的合并之后的文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">37: print(“bye”)</span><br><span class="line"></span><br><span class="line">&lt;&lt;&lt;&lt;Yours</span><br><span class="line">50: for i in 0..10</span><br><span class="line">====</span><br><span class="line">50: for i in 0..20</span><br><span class="line">&gt;&gt;&gt;&gt;Mine</span><br><span class="line"></span><br><span class="line">75: print(“end”)</span><br></pre></td></tr></table></figure></li><li><p>最后再将冲突解决,合并就完成了</p></li></ol><h3 id="再次强调一下规则"><a href="#再次强调一下规则" class="headerlink" title="再次强调一下规则"></a>再次强调一下规则</h3><ul><li>对三个文件进行比较(一般情况下,是一行一行进行比较),按<strong>如下规则</strong>进行合并<ul><li>在3个文件中都相同:<ul><li>不变  -&gt;  说明<code>Yours</code>和<code>Mine</code>都没有进行修改</li></ul></li><li>在2个文件中相同,第3个文件不相同:<ul><li>输出与Base不同的内容  -&gt;  和Base不同,说明这个文件进行了修改,在上图中,应是<code>Yours</code>进行了修改</li><li>丢弃与Base相同的那个  -&gt;  和Base相同,说明这个文件没有进行修改,在上图中,应是<code>Mine</code>,也就是这个文件比较旧</li></ul></li><li>在3个文件中都不同<ul><li>冲突  -&gt; 说明需要合并的两个文件都比Base文件”新”,而两个文件又正好改到同一行,此时,计算机肯定是没有办法判断的,就要手动进行解决</li></ul></li></ul></li></ul><h2 id="在深入一点-我们该如何对三个文件进行比较"><a href="#在深入一点-我们该如何对三个文件进行比较" class="headerlink" title="在深入一点,我们该如何对三个文件进行比较"></a>在深入一点,我们该如何对三个文件进行比较</h2><p>前面说明的过程中,对文件进行比较的时候都是使用肉眼进行比较,那么具体算法上又是如何进行比较的呢?这里为了说明,就简单一点,三个文件中的每行都只有一个数字</p><ol start="0"><li><p>参考这里:<a href="https://www.cis.upenn.edu/~bcpierce/papers/diff3-short.pdf" target="_blank" rel="noopener">diff3-short</a></p></li><li><p>按照行,我们可以为每个文件创建一个多维向量如下,</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X: [1, 4, 5, 2, 4, 6]</span><br><span class="line">B: [1, 2, 3, 4, 5, 6]</span><br><span class="line">Y: [1, 2, 4, 5, 3, 6]</span><br></pre></td></tr></table></figure></li><li><p>计算差异</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">X: [1, 4, 5, 2, 3,       6]</span><br><span class="line">B: [1,       2, 3, 4, 5, 6]</span><br><span class="line"></span><br><span class="line">B: [1, 2, 3, 4, 5,    6]</span><br><span class="line">Y: [1, 2,    4, 5, 3, 6]</span><br></pre></td></tr></table></figure></li><li><p>以B为标准,可以得到如下矩阵<br><img src="/images/2020/03/20200301007.png" alt></p></li><li><p>输出差异</p></li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>上述过程就是所谓的<code>三路合并</code></p><ul><li>三路合并中比二路合并中多出了一个Base文件,这个文件的作用就是为了解决上述的<code>&quot;你&quot;和&quot;我&quot;都必须记住所有更改</code>的问题</li><li>而对于<code>所有差异都应手动解决</code>问题,我们可以通过与Base文件进行比较,最后将手动解决的行压缩到冲突这种情况,其他都能自动解决</li></ul>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Excel冻结窗格以锁定行和列</title>
      <link href="/2020/02/29/Excel%E5%86%BB%E7%BB%93%E7%AA%97%E6%A0%BC%E4%BB%A5%E9%94%81%E5%AE%9A%E8%A1%8C%E5%92%8C%E5%88%97/"/>
      <url>/2020/02/29/Excel%E5%86%BB%E7%BB%93%E7%AA%97%E6%A0%BC%E4%BB%A5%E9%94%81%E5%AE%9A%E8%A1%8C%E5%92%8C%E5%88%97/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  若要使工作表的某一区域在滚动到工作表的另一区域时仍保持可见，请转到“视图”选项卡，在此选项卡中，可以“冻结窗格”，将特定的行和列锁定到位</p></blockquote><h1 id="冻结行或列"><a href="#冻结行或列" class="headerlink" title="冻结行或列"></a>冻结行或列</h1><h2 id="冻结首列"><a href="#冻结首列" class="headerlink" title="冻结首列"></a>冻结首列</h2><p>选择“视图” -&gt; “冻结窗格” -&gt; “冻结首列”</p><h2 id="冻结前两列"><a href="#冻结前两列" class="headerlink" title="冻结前两列"></a>冻结前两列</h2><ol><li>选择第三列。</li><li>选择“视图” -&gt; “冻结窗格” &gt; “冻结窗格”。</li></ol><h2 id="冻结列和行"><a href="#冻结列和行" class="headerlink" title="冻结列和行"></a>冻结列和行</h2><ol><li>选择在滚动时要保持其可见的行下方和列右侧的单元格。</li><li>选择“视图” -&gt; “冻结窗格” -&gt; “冻结窗格”。</li></ol><h2 id="取消冻结行或列"><a href="#取消冻结行或列" class="headerlink" title="取消冻结行或列"></a>取消冻结行或列</h2><p>单击“视图”选项卡 -&gt; “窗口” -&gt; “取消冻结窗格”。</p>]]></content>
      
      
      <categories>
          
          <category> Excel </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Excel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中点击外部应用的链接后跳转到Chrome却无法打开应用的问题</title>
      <link href="/2020/02/28/Ubuntu%E4%B8%AD%E7%82%B9%E5%87%BB%E5%A4%96%E9%83%A8%E5%BA%94%E7%94%A8%E7%9A%84%E9%93%BE%E6%8E%A5%E5%90%8E%E8%B7%B3%E8%BD%AC%E5%88%B0Chrome%E5%8D%B4%E6%97%A0%E6%B3%95%E6%89%93%E5%BC%80%E5%BA%94%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2020/02/28/Ubuntu%E4%B8%AD%E7%82%B9%E5%87%BB%E5%A4%96%E9%83%A8%E5%BA%94%E7%94%A8%E7%9A%84%E9%93%BE%E6%8E%A5%E5%90%8E%E8%B7%B3%E8%BD%AC%E5%88%B0Chrome%E5%8D%B4%E6%97%A0%E6%B3%95%E6%89%93%E5%BC%80%E5%BA%94%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://askubuntu.com/questions/689449/external-links-are-opened-as-blank-tabs-in-new-browser-window-in-chrome" target="_blank" rel="noopener">External links are opened as blank tabs in new browser window in Chrome</a></p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>As unfulvio said, the issue is with <code>google-chrome.desktop</code>, and it is missing the <code>%U</code> argument .</p><p>Open file: $HOME/.local/share/applications/google-chrome.desktop</p><p>Find the line:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exec=/opt/google/chrome/chrome</span><br></pre></td></tr></table></figure><p>Add a space and <code>%U</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exec=/opt/google/chrome/chrome %U</span><br></pre></td></tr></table></figure><p>Then save the file.</p><h2 id="翻译过来就是"><a href="#翻译过来就是" class="headerlink" title="翻译过来就是"></a>翻译过来就是</h2><ol><li><p>打开文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim $HOME/.local/share/applications/google-chrome.desktop</span><br></pre></td></tr></table></figure></li><li><p>找到如下行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exec=/opt/google/chrome/chrome</span><br></pre></td></tr></table></figure></li><li><p>在该行后面添加一个空格和<code>%U</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exec=/opt/google/chrome/chrome %U</span><br></pre></td></tr></table></figure></li></ol><p><img src="/images/2020/02/20200227001.png" alt></p><ol start="4"><li>保存文件即可</li></ol>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git底层逻辑</title>
      <link href="/2020/02/23/Git%E5%BA%95%E5%B1%82%E9%80%BB%E8%BE%91/"/>
      <url>/2020/02/23/Git%E5%BA%95%E5%B1%82%E9%80%BB%E8%BE%91/</url>
      
        <content type="html"><![CDATA[<h1 id="两种存储文件的方式"><a href="#两种存储文件的方式" class="headerlink" title="两种存储文件的方式"></a>两种存储文件的方式</h1><h2 id="直接拷贝存储一份新的-快照"><a href="#直接拷贝存储一份新的-快照" class="headerlink" title="直接拷贝存储一份新的(快照)"></a>直接拷贝存储一份新的(快照)</h2><p>直接拷贝的方式,类似如下的命令方式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#1</span><br><span class="line">cp test.txt ~/backup/test-v1.txt</span><br><span class="line"></span><br><span class="line">#2</span><br><span class="line">cp test.txt ~/backup/test-v2.txt</span><br><span class="line"></span><br><span class="line">#3</span><br><span class="line">cp test.txt ~/backup/test-v3.txt</span><br></pre></td></tr></table></figure><p>这是Git的存储方式</p><h2 id="更小的存储空间"><a href="#更小的存储空间" class="headerlink" title="更小的存储空间"></a>更小的存储空间</h2><p>增量存储的方式,类似如下的命令方式操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#1</span><br><span class="line">cp test.txt .../test-initial.txt</span><br><span class="line"></span><br><span class="line">#2</span><br><span class="line">diff text.txt .../test-initial.txt &gt; .../test-delta-v2.txt</span><br><span class="line"></span><br><span class="line">#3</span><br><span class="line">diff text.txt .../test-delta-v2.txt &gt; .../test-delta-v3.txt</span><br></pre></td></tr></table></figure><p>这是SVN的存储方式</p><h1 id="如何给存储中的每一个文件命名"><a href="#如何给存储中的每一个文件命名" class="headerlink" title="如何给存储中的每一个文件命名"></a>如何给存储中的每一个文件命名</h1><ol><li>使用时间戳命名的方式</li><li>使用版本号方式</li><li>使用hash值的方式</li></ol><h2 id="使用时间戳命名的方式有什么好处"><a href="#使用时间戳命名的方式有什么好处" class="headerlink" title="使用时间戳命名的方式有什么好处"></a>使用时间戳命名的方式有什么好处</h2><ul><li>易于推理的修改</li><li>容易产生名字</li><li>旧版本难以引用</li><li>分布式系统中可能会发生冲突</li></ul><p>类似如下的命令操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cp test.txt test.txt-$(date +%s%N)</span><br><span class="line"></span><br><span class="line">$ cp test.txt test.txt-1500621805384048282</span><br><span class="line">$ cp test.txt test.txt-1500622605384048291</span><br><span class="line">$ cp test.txt-1500622605384048291 test.txt</span><br><span class="line">$ cp test.txt text.txt-1500622905384049812</span><br></pre></td></tr></table></figure><h2 id="使用版本号的方式"><a href="#使用版本号的方式" class="headerlink" title="使用版本号的方式"></a>使用版本号的方式</h2><ul><li>旧版本易于引用</li><li>需要维护一个全局计数器以生成新名称</li><li>难以避免分布式系统中的冲突</li></ul><p>类似如下的命令操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cp test.txt test.txt-v1</span><br><span class="line">$ cp test.txt test.txt-v2</span><br><span class="line">$ cp test.txt-v2 test.txt</span><br><span class="line">$ cp test.txt text.txt-v4</span><br></pre></td></tr></table></figure><p>这也是SVN的文件命名方式</p><h2 id="使用hash值的方式"><a href="#使用hash值的方式" class="headerlink" title="使用hash值的方式"></a>使用hash值的方式</h2><ul><li>分布式系统的Hash</li><li>在分布式系统中一致</li><li>易于生成名称（SHA-1）</li><li>很难参考旧版本</li><li>文件名被丢弃(原始文件名找不到)</li></ul><p>类似如下的命令操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ cat test.txt | git hash-object --stdin</span><br><span class="line">d670460b4b4aece5915caf5c68d12f560a9fe3e4</span><br><span class="line"></span><br><span class="line">$ cp test.txt ~/.git/object/d6/70460b4b4aece5915caf5c68d12f560a9fe3e4</span><br></pre></td></tr></table></figure><p>这是Git的文件的命名方式</p><h1 id="具体看看Git中如何进行构造和标识"><a href="#具体看看Git中如何进行构造和标识" class="headerlink" title="具体看看Git中如何进行构造和标识"></a>具体看看Git中如何进行构造和标识</h1><h2 id="引入名词Blob"><a href="#引入名词Blob" class="headerlink" title="引入名词Blob"></a>引入名词Blob</h2><h3 id="Blob的定义"><a href="#Blob的定义" class="headerlink" title="Blob的定义"></a>Blob的定义</h3><ul><li><p>Blob的定义:文件名为<strong>内容的SHA-1值</strong>的文件,具体来说,如下图,<br><img src="/images/2020/02/20200225001.png" alt></p></li><li><p>更具体一点来说,应该是如下图,<code>文件名 == SHA-1 ( zip (类型 + 内容长度 + \0 + 内容 ) )</code></p></li></ul><h3 id="Blob的文件类型"><a href="#Blob的文件类型" class="headerlink" title="Blob的文件类型"></a>Blob的文件类型</h3><ul><li><p>我们看一下Header里面有什么东西,如下图,其中<code>type</code>用以表示该Blob文件的类型,这样就能区分下文将要说明的<code>Tree Object</code>,<code>Commit Object</code>等<img src="/images/2020/02/20200225004.png" alt></p></li><li><p>git中如何查看Blob文件的类型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file commit HEAD</span><br><span class="line">tree 414408a42cf018b7205f6ea8e1ccafd31ef3cd7a</span><br><span class="line">parent 064a052c9ccf06f6a347b7a06f3e8d2496e11a65</span><br><span class="line">author zhang_ji &lt;zhang_ji@worksap.co.jp&gt; 1500537698 +0800</span><br><span class="line">committer zhang_ji &lt;zhang_ji@worksap.co.jp&gt; 1500537698 +0800</span><br><span class="line"></span><br><span class="line">update POM version. refs #300039</span><br><span class="line"></span><br><span class="line">from 17.06.hr-SNAPSHOT to 17.07.recruiting-SNAPSHOT</span><br><span class="line"></span><br><span class="line">$ git cat-file -t 414408</span><br><span class="line">tree</span><br><span class="line"></span><br><span class="line">$ git cat-file -t 064a05</span><br><span class="line">commit</span><br></pre></td></tr></table></figure></li></ul><h3 id="Blob文件的内容是什么"><a href="#Blob文件的内容是什么" class="headerlink" title="Blob文件的内容是什么"></a>Blob文件的内容是什么</h3><ul><li>下文会说明:<a href="/2020/02/23/Git底层逻辑/#Blob文件的内容">Blob文件的内容</a></li></ul><h3 id="Blob文件在哪里可以找到"><a href="#Blob文件在哪里可以找到" class="headerlink" title="Blob文件在哪里可以找到"></a>Blob文件在哪里可以找到</h3><ul><li>Blob文件可以在<code>.git/objects</code>下找到<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects</span><br><span class="line">.git/objects</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">.git/objects/info</span><br><span class="line">.git/objects/pack</span><br></pre></td></tr></table></figure></li></ul><p>想知道目录的具体作用参考这里:<a href="https://git-scm.com/book/zh/v2/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-Git-%E5%AF%B9%E8%B1%A1" target="_blank" rel="noopener">10.2 Git 内部原理 - Git 对象</a></p><h2 id="用Blob标识文件"><a href="#用Blob标识文件" class="headerlink" title="用Blob标识文件"></a>用Blob标识文件</h2><p>每个Git管理的文件,在.git录下,都有一个文件与之对应,而这个与之对应的文件称为Blob,同时这个与之对应的文件的文件名为内容的SHA-1值</p><p>现在我们已经知道Git如何标识被跟踪的每个文件,接下去说明如何构造目录结构</p><h2 id="构造目录结构"><a href="#构造目录结构" class="headerlink" title="构造目录结构"></a>构造目录结构</h2><h3 id="引入名词Tree"><a href="#引入名词Tree" class="headerlink" title="引入名词Tree"></a>引入名词<code>Tree</code></h3><p>树对象:首先是一个Blob文件,比上述Blob多出来的是该文件里有内容,其中内容的每一行是一个”孩子”的信息</p><h3 id="用树对象标识文件"><a href="#用树对象标识文件" class="headerlink" title="用树对象标识文件"></a>用树对象标识文件</h3><p><img src="/images/2020/02/20200225002.png" alt></p><p>Git中可以使用如下命令进行查看,上述图片即如下查看结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-tree HEAD</span><br><span class="line">100644 blob 125c07f222601136b7b6291002e3a9f59ee99bfe    .gitignore</span><br><span class="line">100644 blob 8fc149a7e3053c2b7adeb94e5bdd68bad7d48331    README.md</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391    batch.release</span><br><span class="line">040000 tree 6714dd5129fa87f9bf55d9f7944a8764cf6424b1    hue-hr-recruiting-batch</span><br><span class="line">040000 tree 8150ff62850cf4d154876c2c498954d029fa5bf6    hue-hr-recruiting-biz</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>可以看到,tree对象是一个文件,并且文件的文件名是SHA-1值,接下去我们在看看tree对象</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git ls-tree 6714dd5129fa87f9bf55d9f7944a8764cf6424b1</span><br><span class="line">100644 blob f4f5a0b2397e2afa2e285507d2af6014015c6b35    pom.xml</span><br><span class="line">040000 tree bebf8118906f2a08c3c2f1ab54f5e9b657f03451    src</span><br></pre></td></tr></table></figure><p>可以看到,tree对象表示目录,而tree对象的内容的每一行表示被标识目录里的每一个文件所对应的Blob文件的SHA-1值</p><h2 id="其他元信息"><a href="#其他元信息" class="headerlink" title="其他元信息"></a>其他元信息</h2><p>我们已经知道如何标识文件,也已经知道如何构造目录信息,也就是说我们已经有办法构造一个快照了,那么当我们commit一个快照的时候</p><ul><li>这个快照和前一个快照如何建立联系?</li><li>commit的时候写的日志信息又该怎么表示?</li><li>什么时候提交的?<br>等等这些信息又该如何处理</li></ul><h3 id="引入名词commit"><a href="#引入名词commit" class="headerlink" title="引入名词commit"></a>引入名词<code>commit</code></h3><p>Commit Object：Blob包含提交的元信息,也就是说,一个commit对象也是一个Blob文件,而这个Blob文件的内容包含的是提交的元信息</p><h3 id="说明一下commit文件"><a href="#说明一下commit文件" class="headerlink" title="说明一下commit文件"></a>说明一下commit文件</h3><p>git中可以如下进行查看某一commit的元信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file commit HEAD</span><br><span class="line">tree 414408a42cf018b7205f6ea8e1ccafd31ef3cd7a   -&gt; 当前目录的树对象</span><br><span class="line">parent 064a052c9ccf06f6a347b7a06f3e8d2496e11a65     -&gt; 当前commit的前一个commit的SHA-1值</span><br><span class="line">author zhang_ji &lt;zhang_ji@worksap.co.jp&gt; 1500537698 +0800   -&gt; 作者与时间戳</span><br><span class="line">committer zhang_ji &lt;zhang_ji@worksap.co.jp&gt; 1500537698 +0800    -&gt; 提交者与时间戳(一般来说作者与提交者是同一个人,但万事总有例外,即作者是一个账户,提交的时候切换账户的)</span><br><span class="line"></span><br><span class="line">update POM version. refs #300039 from 17.06.hr-SNAPSHOT to 17.07.recruiting-SNAPSHOT    -&gt; 日志信息</span><br></pre></td></tr></table></figure><p>其中parent就可以画出类似如下的版本图<br><img src="/images/2020/02/20200225003.png" alt></p><h2 id="Blob文件的内容"><a href="#Blob文件的内容" class="headerlink" title="Blob文件的内容"></a>Blob文件的内容</h2><p>依据Blob文件的类型的不同而不同</p><ul><li>当类型是最基本的Blob时,内容是<code>zip(header + 被管理文件的内容)</code>(这里的zip是前面图中(<a href="/2020/02/23/Git底层逻辑/#Blob的文件类型">Blob的文件类型</a>)的<code>Compress with zlib</code>)</li><li>当类型是tree时,内容是header + 孩子的SHA-1值</li><li>当类型是commit时,内容是header + 其他元信息</li></ul><h1 id="Git引用-Git-References"><a href="#Git引用-Git-References" class="headerlink" title="Git引用(Git References)"></a>Git引用(Git References)</h1><h2 id="为什么需要Git引用"><a href="#为什么需要Git引用" class="headerlink" title="为什么需要Git引用"></a>为什么需要Git引用</h2><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>在我们上述的讨论中,我们知道</p><ol><li>当一个项目中的所有文件被git管理之后,项目中每一个文件(文件增删改都算一个新文件)都会在<code>.git</code>目录下创建一个对应的Blob</li><li>项目中文件的目录结构我们使用<code>Tree Object</code>进行记录</li><li>其他日志信息,commit信息(例如:commit的前一个commit)等,我们使用<code>Commit Object</code>进行记录,通过<code>Commit Object</code>的记录,我们能够一步一步进行回溯</li><li>那么,就只剩最后一个问题:为了能遍历那段历史从而找到所有相关对象，我们必须记住最后一个提交的SHA-1值</li><li>也就是说,最终问题为:<strong>我们要如何记住最后一个Commit的SHA-1值</strong></li></ol><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>用一个文件来保存SHA-1值,并给文件起一个简单的名字,然后用这个名字指针来替代原始的SHA-1值</p><h2 id="什么是Git引用"><a href="#什么是Git引用" class="headerlink" title="什么是Git引用"></a>什么是Git引用</h2><p>上述解决方案,可以知道我们需要如下东西</p><ul><li>一个文件，文件内容是包含一个指向Blob的SHA-1密钥</li></ul><p>那么,这个东西,我们称之为Git引用,可以在<code>.git/refs</code>下找到</p><h2 id="在git中具体有哪些是”引用”"><a href="#在git中具体有哪些是”引用”" class="headerlink" title="在git中具体有哪些是”引用”"></a>在git中具体有哪些是”引用”</h2><p>因为引用是放在<code>.git/refs</code>目录下的,我们看看<code>.git/refs</code>下有什么东西</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/refs</span><br><span class="line">.git/refs</span><br><span class="line">.git/refs/heads</span><br><span class="line">.git/refs/heads/master</span><br><span class="line">.git/refs/tags</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>顺便查看一下这些文件里有什么</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/heads/master</span><br><span class="line">5b474b21cebf1385bfe8f3d1470c5d89c7c964b5        # SHA-1值,即指向Blob文件</span><br></pre></td></tr></table></figure><p>总结一下,从上述目录底下和定义可以知道,以下这些都应是<code>Git References</code></p><ul><li>Branches</li><li>Tags</li><li>Remotes</li><li>the HEAD<br>更具体可以看这:<a href="https://git-scm.com/book/zh/v2/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-Git-%E5%BC%95%E7%94%A8" target="_blank" rel="noopener">Git 内部原理 - Git 引用</a></li></ul><h1 id="进行一次commit-来说明上述概念"><a href="#进行一次commit-来说明上述概念" class="headerlink" title="进行一次commit,来说明上述概念"></a>进行一次commit,来说明上述概念</h1><p><img src="/images/2020/03/20200301002.png" alt></p><ol><li>现在我们有一个引用<code>.git/refs/heads/master</code>,这个文件内指向的Blob文件是<code>a7d59c...</code>,而<code>a7d59c...</code>是一个commit</li><li><code>a7d59c</code>commit文件内包含了本次提交的树的根节点信息,指向<code>36055</code>这个Blob文件(树对象)</li><li><code>36055</code>树对象文件内容有两个SHA-1值,一个代表<code>e9c055</code>树对象,一个指向<code>e84556</code>Blob文件</li><li><code>e9c055</code>树对象文件内容也有两个SHA-1值,分别指向<code>1f4824</code>Blob文件和<code>eaa5fa</code>Blob文件</li></ol><hr><ol start="5"><li><strong>修改b.txt</strong>文件</li><li>这时,由于<code>b.txt</code>的文件内容发生了变化,那么<code>b.txt</code>就是一个新文件了,此时这个新文件有一个与之对应的新的Blob文件<code>7e0616</code></li><li>由于出现新文件,那么要重新构建树对象,此时创建一个新的树对象文件,文件名为<code>9fee6e</code>,文件内容为<code>7e0616</code>和<code>eaa5fa</code>(由于a.txt文件没有修改,所以对于a.txt还是指向原来的Blob文件)</li><li>接着在往上,自然仍需要重新构建树对象,此时创建一个新的树对象文件,文件名为<code>a0714d</code>,文件内容为<code>9fee6a</code>和<code>e84556</code>(因为README文件没有修改,所以仍指向原Blob文件)</li><li>将这个树对象已经全部构建完成了,需要提交commit了,这个新的commit<code>5b474b</code>的tree值就是<code>a0714d</code>,parent值就是<code>a7d59c</code>,日志信息为”update b.txt”</li><li>最后,将<code>.git/refs/heads/master</code>文件的值改为<code>5b47b</code>,则提交完成</li></ol>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式之前瞻断言与后瞻断言</title>
      <link href="/2020/01/24/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B9%8B%E5%89%8D%E7%9E%BB%E6%96%AD%E8%A8%80%E4%B8%8E%E5%90%8E%E7%9E%BB%E6%96%AD%E8%A8%80/"/>
      <url>/2020/01/24/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B9%8B%E5%89%8D%E7%9E%BB%E6%96%AD%E8%A8%80%E4%B8%8E%E5%90%8E%E7%9E%BB%E6%96%AD%E8%A8%80/</url>
      
        <content type="html"><![CDATA[<p>有时候我们需要匹配后面跟着特定模式的一段模式。比如，我们要从 1 turkey costs 30€ 这段字符中匹配价格数值。</p><p>我们需要获取 € 符号前面的数值（假设价格是整数）。</p><p>那就是前瞻断言要做的事情。</p><h1 id="前瞻断言"><a href="#前瞻断言" class="headerlink" title="前瞻断言"></a>前瞻断言</h1><h2 id="前瞻肯定断言"><a href="#前瞻肯定断言" class="headerlink" title="前瞻肯定断言"></a>前瞻肯定断言</h2><ul><li>语法为：<code>x(?=y)</code>，它表示 <strong>“匹配 x, 仅在后面是 y 的情况”</strong></li></ul><p>那么对于一个后面跟着 € 的整数金额，它的正则表达式应该为：\d+(?=€)。</p><ul><li>举例<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">"1 turkey costs 30€"</span>;</span><br><span class="line"></span><br><span class="line">alert(str.match(<span class="regexp">/\d+(?=€)/</span>)); <span class="comment">// 30 （正确地跳过了单个的数字 1）</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="前瞻否定断言"><a href="#前瞻否定断言" class="headerlink" title="前瞻否定断言"></a>前瞻否定断言</h2><ul><li>语法为：<code>x(?!y)</code>，意思是 <strong>“查找 x, 但是仅在不被 y 跟随的情况下匹配成功”</strong></li></ul><p>那么当我们想要一个不被 € 跟着的数值时，它的正则表达式应该为：\d+(?!€)。</p><ul><li>举例<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">"2 turkeys cost 60€"</span>;</span><br><span class="line"></span><br><span class="line">alert( str.match(<span class="regexp">/\d+(?!€)/</span>) ); <span class="comment">// 2（正确地跳过了价格）</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="后瞻断言"><a href="#后瞻断言" class="headerlink" title="后瞻断言"></a>后瞻断言</h1><ol><li>前瞻断言允许添加一个“后面要跟着什么”的条件判断。</li><li>后瞻断言也是类似的，只不过它是在相反的方向上进行条件判断。也就是说，它只允许匹配前面有特定字符串的模式。</li></ol><h2 id="后瞻肯定断言"><a href="#后瞻肯定断言" class="headerlink" title="后瞻肯定断言"></a>后瞻肯定断言</h2><ul><li>语法为:后瞻肯定断言：<code>(?&lt;=y)x</code>, 意思是：<strong>匹配 x, 仅在前面是 y 的情况</strong></li><li>举例<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">"1 turkey costs $30"</span>;</span><br><span class="line"></span><br><span class="line">alert( str.match(<span class="regexp">/(?&lt;=\$)\d+/</span>) ); <span class="comment">// 30 （跳过了单个的数字 1）&gt;)))</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="后瞻否定断言"><a href="#后瞻否定断言" class="headerlink" title="后瞻否定断言"></a>后瞻否定断言</h2><ul><li>语法为：后瞻否定断言：<code>(?&lt;!y)x</code>, 意思是：<strong>匹配 x, 仅在前面不是 y 的情况</strong></li><li>举例<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">"2 turkeys cost $60"</span>;</span><br><span class="line"></span><br><span class="line">alert( str.match(<span class="regexp">/(?&lt;!\$)\d+/</span>) ); <span class="comment">// 2 (跳过了价格)</span></span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> 正则表达式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 正则表达式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Yarn运行机制</title>
      <link href="/2019/12/13/Yarn%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E6%B5%81%E7%A8%8B%E5%9B%BE/"/>
      <url>/2019/12/13/Yarn%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%E6%B5%81%E7%A8%8B%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="Yarn运行机制"><a href="#Yarn运行机制" class="headerlink" title="Yarn运行机制"></a>Yarn运行机制</h1><h2 id="Yarn运行机制流程图"><a href="#Yarn运行机制流程图" class="headerlink" title="Yarn运行机制流程图"></a>Yarn运行机制流程图</h2><p><img src="/images/2020/07/20200701001.png" alt></p><h2 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h2><h3 id="作业提交"><a href="#作业提交" class="headerlink" title="作业提交"></a>作业提交</h3><ul><li>Client调用job.waitForCompletion方法，向整个集群提交MapReduce作业。</li><li>Client向RM申请一个作业id。</li><li>RM给Client返回该job资源的提交路径(hdfs://…/.staging/)和作业application_id。</li><li>Client在该路径提交jar包、切片信息和配置文件。</li><li>Client提交完资源后，向RM申请运行MrAppMaster。</li></ul><h3 id="作业初始化"><a href="#作业初始化" class="headerlink" title="作业初始化"></a>作业初始化</h3><ul><li>当RM收到Client的请求后，将该job添加到资源调度器中，将job初始化成task。</li><li>某一个空闲的NM领取到该Job。</li><li>在该NM中创建Container，并产生MRAppmaster(一个job创建一个)，它管理该job。</li><li>下载之前Client提交的资源到本地。</li></ul><h3 id="任务分配"><a href="#任务分配" class="headerlink" title="任务分配"></a>任务分配</h3><ul><li>MRAppMaster向RM申请运行多个MapTask任务资源。</li><li>RM将运行MapTask任务分配给另外两个NodeManager，另外两个NodeManager分别领取任务并创建容器。</li></ul><h3 id="任务执行"><a href="#任务执行" class="headerlink" title="任务执行"></a>任务执行</h3><ul><li>MR向两个接收到任务的NodeManager发送程序启动脚本，这两个NodeManager分别启动MapTask，MapTask对数据分区排序。</li><li>MrAppMaster等待所有MapTask运行完毕后，向RM申请容器，运行ReduceTask。</li><li>ReduceTask向MapTask获取相应分区的数据。</li><li>程序运行完毕后，MR会向RM申请注销自己。</li></ul><h1 id="一些细节"><a href="#一些细节" class="headerlink" title="一些细节"></a>一些细节</h1><h2 id="4大组件"><a href="#4大组件" class="headerlink" title="4大组件"></a>4大组件</h2><ul><li>ResourceManager：总的老大：处理客户端请求，监控NodeManager，启动或监控ApplicationMaster，资源的分配与调度</li><li>NodeManager：单个节点的老大：管理单个节点的资源，处理来自ResourceManager、ApplicationMaster的命令</li><li>ApplicationMaster：单个job的老大：负责数据切分，为应用程序申请资源并分配内部的任务，任务的监控与容错</li><li>Container：资源抽象：如内存、cpu、磁盘、网络等</li></ul><h2 id="3种资源调度器"><a href="#3种资源调度器" class="headerlink" title="3种资源调度器"></a>3种资源调度器</h2><ul><li>FIFO：先进先出</li><li>Capacity Scheduler：多FIFO队列，会对同一用户提交资源进行限定，会把任务分配给更闲的队列。</li><li>Fair Scheduler：多队列，按缺额排序，缺额大者优先执行</li></ul><h2 id="任务推测执行机制"><a href="#任务推测执行机制" class="headerlink" title="任务推测执行机制"></a>任务推测执行机制</h2><ul><li>问题：系统中有99%的Map任务都完成了，只有少数几个Map老是进度很慢，完不成。</li><li>办法：为拖后腿任务启动一个备份任务，同时运行。谁先运行完，则采用谁的结果。</li><li>前提：每个Task只能有一个备份任务，当前Job已完成的Task必须不小于0.05（5%）。</li><li>不适用：任务间存在严重的负载倾斜；特殊任务，比如任务向数据库中写数据。</li></ul><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://juejin.im/post/5d6d0d356fb9a06b2a20596f" target="_blank" rel="noopener">hadoop-Yarn流程解析</a></p>]]></content>
      
      
      <categories>
          
          <category> BigData </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BigData </tag>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hadoop运行模式</title>
      <link href="/2019/12/13/Hadoop%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/12/13/Hadoop%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="本地运行模式"><a href="#本地运行模式" class="headerlink" title="本地运行模式"></a>本地运行模式</h1><h2 id="官方grep案例"><a href="#官方grep案例" class="headerlink" title="官方grep案例"></a>官方grep案例</h2><ol start="0"><li><p>官方地址:<a href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/SingleCluster.html" target="_blank" rel="noopener">Hadoop: Setting up a Single Node Cluster</a></p></li><li><p>在hadoop文件夹下创建一个input文件夹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir input</span><br></pre></td></tr></table></figure></li><li><p>复制配置文件目录作为输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp etc/hadoop/*.xml input</span><br></pre></td></tr></table></figure></li><li><p>查找并显示给定正则表达式的每个匹配项,输出到给定的输出目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bin/hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.9.2.jar grep input output &apos;dfs[a-z.]+&apos;</span><br></pre></td></tr></table></figure></li><li><p>展示输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat output/*</span><br></pre></td></tr></table></figure></li></ol><h1 id="伪分布式运行模式"><a href="#伪分布式运行模式" class="headerlink" title="伪分布式运行模式"></a>伪分布式运行模式</h1><h2 id="启动HDFS并运行MapReduce程序"><a href="#启动HDFS并运行MapReduce程序" class="headerlink" title="启动HDFS并运行MapReduce程序"></a>启动HDFS并运行MapReduce程序</h2><h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ol><li>配置集群</li><li>启动并测试集群的增,删,查</li><li>执行WordCount案例</li></ol><h3 id="执行步骤"><a href="#执行步骤" class="headerlink" title="执行步骤"></a>执行步骤</h3><ol><li><p>配置<code>hadoop-env.sh</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ echo $&#123;JAVA_HOME&#125;</span><br><span class="line"></span><br><span class="line">$ vim etc/hadoop/hadoop-env.sh</span><br><span class="line">修改JAVA_HOME路径</span><br><span class="line">export JAVA_HOME=/your/java/path</span><br></pre></td></tr></table></figure></li><li><p>配置<code>etc/hadoop/core-site.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定HDFS中NameNode的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 指定HadHoop运行时产生文件的存储目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>/opt/hadoop-2.9.2/data/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置<code>etc/hadoop/hdfs-site.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 指定HDFS副本的数量 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Hadoop虽然是多副本,但单一节点之多存储一份副本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>启动</p><ul><li><p>格式化NameNode(第一次启动时格式化,以后就不要总格式化)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ bin/hdfs namenode -format</span><br></pre></td></tr></table></figure></li><li><p>启动NameNode</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sbin/hadoop-daemon.sh start namenode</span><br><span class="line">$ jps</span><br></pre></td></tr></table></figure></li><li><p>启动DataNode</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sbin/hadoop-daemon.sh start datanode</span><br><span class="line">$ jps</span><br></pre></td></tr></table></figure></li></ul></li><li><p>web端查看HDFS文件系统<a href="http://localhost:50070/dfshealth.html#tab-overview" target="_blank" rel="noopener">http://localhost:50070/dfshealth.html#tab-overview</a><br><img src="/images/2020/05/20200507001.png" alt></p></li><li><p>查看产生的Log日志</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cd /opt/hadoop-2.9.2/logs</span><br></pre></td></tr></table></figure></li><li><p>思考:为什么不能一直格式化NameNode,格式化NameNOde要注意什么</p><ul><li>格式化只能在启动之前格式化</li><li>格式化NameNOde,会产生新的集群id,导致NameNode和DataNode的集群id不一致,集群找不到已往数据.所以,格式NameNode时,一定要删除data数据和log日志,然后再格式化NameNode<ul><li>也就是如下两个clusterID会不一样(这里是一样的)<br><img src="/images/2020/05/20200508006.png" alt></li></ul></li><li><a href="https://blog.csdn.net/yu0_zhang0/article/details/78841623" target="_blank" rel="noopener">Hadoop多次格式化出现 WARN hdfs.DataStreamer: DataStreamer Excep</a></li></ul></li></ol><h2 id="启动YARN并运行MapReduce程序"><a href="#启动YARN并运行MapReduce程序" class="headerlink" title="启动YARN并运行MapReduce程序"></a>启动YARN并运行MapReduce程序</h2><ol><li>配置<code>etc/hadoop/yarn-env.sh</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">配置JAVA_HOME</span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/java-8-oracle</span><br></pre></td></tr></table></figure></li></ol><p><img src="/images/2020/05/20200507002.png" alt></p><ol start="2"><li><p>配置<code>etc/hadoop/yarn-site.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Reducer获取数据的方式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 指定YARN的ResourceManager的地址 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.env-whitelist<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;value&gt;localhost&lt;/value&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置<code>mapred-env.sh</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">配置JAVA_HOME</span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/java-8-oracle</span><br></pre></td></tr></table></figure></li></ol><p><img src="/images/2020/05/20200507003.png" alt></p><ol start="4"><li><p>配置<code>etc/hadoop/mapred-site.xml</code></p><ul><li><p>如果没有这个文件,则拷贝mapred-site.xml.template并重命名为mapred-site.xml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp mapred-site.xml.template mapred-site.xml</span><br></pre></td></tr></table></figure></li><li><p>配置<code>mapred-site.xml</code>文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.application.classpath<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;value&gt;$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/*:$HADOOP_MAPRED_HOME/share/hadoop/mapreduce/lib/*&lt;/value&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>启动集群</p></li></ol><ul><li>启动前必须保证NameNode和DataNode已经启动<br><img src="/images/2020/05/20200507004.png" alt></li><li>启动ResourceManager<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sbin/yarn-daemon.sh start resourcemanager</span><br><span class="line"></span><br><span class="line">$ jps</span><br></pre></td></tr></table></figure></li></ul><p><img src="/images/2020/05/20200507005.png" alt></p><ul><li>启动NodeManager<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sbin/yarn-daemon.sh start nodemanager</span><br><span class="line"></span><br><span class="line">$ jps</span><br></pre></td></tr></table></figure></li></ul><p><img src="/images/2020/05/20200507006.png" alt></p><ol start="6"><li>集群操作</li></ol><ul><li>YARN的浏览器页面查看<a href="http://localhost:8088/cluster" target="_blank" rel="noopener">http://localhost:8088/cluster</a><br><img src="/images/2020/05/20200507007.png" alt></li><li>举例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -put input /</span><br><span class="line">hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-2.9.2.jar grep /input /output</span><br><span class="line">hadoop fs -cat /output/\*   &lt;- 这里*号转义是我自己终端的问题</span><br></pre></td></tr></table></figure></li></ul><p><img src="/images/2020/05/20200508004.png" alt></p><ul><li><a href="https://blog.csdn.net/hongxiao2016/article/details/88919176" target="_blank" rel="noopener">错误: 找不到或无法加载主类 org.apache.hadoop.mapreduce.v2.app.MRAppMaster</a></li></ul><h1 id="完全分布式运行模式"><a href="#完全分布式运行模式" class="headerlink" title="完全分布式运行模式"></a>完全分布式运行模式</h1>]]></content>
      
      
      <categories>
          
          <category> BigData </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BigData </tag>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hadoop核心问题</title>
      <link href="/2019/12/13/Hadoop%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98/"/>
      <url>/2019/12/13/Hadoop%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="Hadoop核心问题"><a href="#Hadoop核心问题" class="headerlink" title="Hadoop核心问题"></a>Hadoop核心问题</h1><p>海量数据</p><h1 id="数据量进制"><a href="#数据量进制" class="headerlink" title="数据量进制"></a>数据量进制</h1><ol><li>1bit = 1位</li><li>1byte = 8bit</li><li>1kb = 1024byte</li><li>1mb = 1024kb</li><li>1gb = 1024mb</li><li>1tb = 1024gb</li><li>1pb = 1024tb</li><li>1eb = 1024pb</li><li>1zb = 1024eb</li><li>1yb = 1024zb</li></ol><h1 id="海量数据的存储"><a href="#海量数据的存储" class="headerlink" title="海量数据的存储"></a>海量数据的存储</h1><h2 id="分割存放"><a href="#分割存放" class="headerlink" title="分割存放"></a>分割存放</h2><ol><li>由于海量数据，所以一台电脑肯定放不下，最简单的方式就是分开存放，这就涉及到<code>分布式</code></li><li>分布式 -&gt; dfs:distributed file system</li></ol><h2 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h2><p>mapreduce</p><ol><li>map -&gt; 映射</li><li>reduce -&gt; 化简</li></ol>]]></content>
      
      
      <categories>
          
          <category> BigData </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BigData </tag>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hadoop安装</title>
      <link href="/2019/12/12/Hadoop%E5%AE%89%E8%A3%85/"/>
      <url>/2019/12/12/Hadoop%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<h1 id="Hadoop三大发行版本"><a href="#Hadoop三大发行版本" class="headerlink" title="Hadoop三大发行版本"></a>Hadoop三大发行版本</h1><p>Hadoop三大发行版本:Apache,Cloudera,Hortonworks</p><ul><li>Apache:版本最原始(最基础)版本,对于入门学习最好</li><li>Cloudera:在大型互联网企业中用的较多</li><li>Hortonworks:文档较好</li></ul><h1 id="Hadoop的优势"><a href="#Hadoop的优势" class="headerlink" title="Hadoop的优势"></a>Hadoop的优势</h1><ol><li>高可靠性:Hadoop底层维护多个数据副本,所以即使Hadoop某个计算元素或存储故障,也不会导致数据的丢失</li><li>高扩展性:在集群间分配任务数据,可方便的扩展以千计的节点</li><li>高效性:在MapReduce的思想下,Hadoop是并行工作的,以加快任务处理速度</li><li>高容错性:能够将失败的任务重新分配</li></ol><h1 id="Hadoop1-x和Hadoop2-x区别"><a href="#Hadoop1-x和Hadoop2-x区别" class="headerlink" title="Hadoop1.x和Hadoop2.x区别"></a>Hadoop1.x和Hadoop2.x区别</h1><p><img src="/images/2020/05/20200506013.png" alt></p><h1 id="Hadoop组成"><a href="#Hadoop组成" class="headerlink" title="Hadoop组成"></a>Hadoop组成</h1><h2 id="HDFS架构概述"><a href="#HDFS架构概述" class="headerlink" title="HDFS架构概述"></a>HDFS架构概述</h2><ol><li>NameNode(nn):存储文件的元数据,如文件名,文件目录结构,文件属性(生成时间,副本数,文件权限),以及每个文件的块列表和块所在的DataNode等</li><li>DataNode(dn):在本地文件系统存储文件块数据,以及数据的校验和</li><li>Secondary NameNode(2nn):用来监控HDFS状态的辅助后台程序,每隔一段时间获取HDFS元数据的快照</li></ol><p><img src="/images/2020/05/20200506014.png" alt></p><h2 id="YARN架构概述"><a href="#YARN架构概述" class="headerlink" title="YARN架构概述"></a>YARN架构概述</h2><p>YARN调度内存和CPU,即调度的是算力资源<br><img src="/images/2020/05/20200506015.png" alt></p><h2 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h2><p>MapReduce将计算过程分为两个阶段:Map和Reduce</p><ol><li>Map阶段并行处理数据</li><li>Reduce阶段对Map结果进行汇总</li></ol><p><img src="/images/2020/05/20200506016.png" alt></p><h1 id="Hadoop安装"><a href="#Hadoop安装" class="headerlink" title="Hadoop安装"></a>Hadoop安装</h1><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>这是一个apache项目,自然在官网进行下载,下载方式很多,用命令wget也好,用curl也罢,这里主要说明要在哪里能找到Hadoop程序</p><ol><li><a href="http://apache.org/index.html" target="_blank" rel="noopener">http://apache.org/index.html</a><br><img src="/images/2020/02/20200208001.png" alt></li><li>找到Hadoop<br><img src="/images/2020/02/20200208002.png" alt></li><li>下载想要的版本的二进制文件<br><img src="/images/2020/02/20200208003.png" alt></li><li>点击下载<br><img src="/images/2020/02/20200208004.png" alt></li></ol><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装很简单,解压就好,解压完后,目录下有如下文件<br><img src="/images/2020/02/20200208005.png" alt></p><h2 id="配置变量"><a href="#配置变量" class="headerlink" title="配置变量"></a>配置变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.  cd /etc/profile.d/</span><br><span class="line"></span><br><span class="line">2.  sudo vim jdk.sh</span><br><span class="line">3.  输入如下内容,并保存</span><br><span class="line">export J2SDKDIR=/usr/lib/jvm/java-8-oracle</span><br><span class="line">export J2REDIR=/usr/lib/jvm/java-8-oracle/jre</span><br><span class="line">export PATH=$PATH:/usr/lib/jvm/java-8-oracle/bin:/usr/lib/jvm/java-8-oracle/db/bin:/usr/lib/jvm/java-8-oracle/jre/bin</span><br><span class="line">export JAVA_HOME=/usr/lib/jvm/java-8-oracle</span><br><span class="line">export DERBY_HOME=/usr/lib/jvm/java-8-oracle/db</span><br><span class="line"></span><br><span class="line">4.  sudo vim hadoop.sh</span><br><span class="line">5.  输入如下内容并保存</span><br><span class="line">export HADOOP_HOME=/opt/hadoop-2.9.2</span><br><span class="line">export PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin</span><br><span class="line"></span><br><span class="line">6.  source /etc/export</span><br></pre></td></tr></table></figure><h2 id="测试安装"><a href="#测试安装" class="headerlink" title="测试安装"></a>测试安装</h2><p>hadoop version</p><p><img src="/images/2020/05/20200506018.png" alt></p><h2 id="Hadoop的目录结构"><a href="#Hadoop的目录结构" class="headerlink" title="Hadoop的目录结构"></a>Hadoop的目录结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">hadoop-2.9.2</span><br><span class="line">├── bin</span><br><span class="line">│   ├── container-executor</span><br><span class="line">│   ├── hadoop</span><br><span class="line">│   ├── hadoop.cmd</span><br><span class="line">│   ├── hdfs</span><br><span class="line">│   ├── hdfs.cmd</span><br><span class="line">│   ├── mapred</span><br><span class="line">│   ├── mapred.cmd</span><br><span class="line">│   ├── rcc</span><br><span class="line">│   ├── test-container-executor</span><br><span class="line">│   ├── yarn</span><br><span class="line">│   └── yarn.cmd</span><br><span class="line">├── etc</span><br><span class="line">│   └── hadoop</span><br><span class="line">│       ├── capacity-scheduler.xml</span><br><span class="line">│       ├── configuration.xsl</span><br><span class="line">│       ├── container-executor.cfg</span><br><span class="line">│       ├── core-site.xml</span><br><span class="line">│       ├── hadoop-env.cmd</span><br><span class="line">│       ├── hadoop-env.sh</span><br><span class="line">│       ├── hadoop-metrics2.properties</span><br><span class="line">│       ├── hadoop-metrics.properties</span><br><span class="line">│       ├── hadoop-policy.xml</span><br><span class="line">│       ├── hdfs-site.xml</span><br><span class="line">│       ├── httpfs-env.sh</span><br><span class="line">│       ├── httpfs-log4j.properties</span><br><span class="line">│       ├── httpfs-signature.secret</span><br><span class="line">│       ├── httpfs-site.xml</span><br><span class="line">│       ├── kms-acls.xml</span><br><span class="line">│       ├── kms-env.sh</span><br><span class="line">│       ├── kms-log4j.properties</span><br><span class="line">│       ├── kms-site.xml</span><br><span class="line">│       ├── log4j.properties</span><br><span class="line">│       ├── mapred-env.cmd</span><br><span class="line">│       ├── mapred-env.sh</span><br><span class="line">│       ├── mapred-queues.xml.template</span><br><span class="line">│       ├── mapred-site.xml.template</span><br><span class="line">│       ├── slaves</span><br><span class="line">│       ├── ssl-client.xml.example</span><br><span class="line">│       ├── ssl-server.xml.example</span><br><span class="line">│       ├── yarn-env.cmd</span><br><span class="line">│       ├── yarn-env.sh</span><br><span class="line">│       └── yarn-site.xml</span><br><span class="line">├── include</span><br><span class="line">│   ├── hdfs.h</span><br><span class="line">│   ├── Pipes.hh</span><br><span class="line">│   ├── SerialUtils.hh</span><br><span class="line">│   ├── StringUtils.hh</span><br><span class="line">│   └── TemplateFactory.hh</span><br><span class="line">├── lib</span><br><span class="line">│   └── native</span><br><span class="line">│       ├── examples</span><br><span class="line">│       ├── libhadoop.a</span><br><span class="line">│       ├── libhadooppipes.a</span><br><span class="line">│       ├── libhadoop.so -&gt; libhadoop.so.1.0.0</span><br><span class="line">│       ├── libhadoop.so.1.0.0</span><br><span class="line">│       ├── libhadooputils.a</span><br><span class="line">│       ├── libhdfs.a</span><br><span class="line">│       ├── libhdfs.so -&gt; libhdfs.so.0.0.0</span><br><span class="line">│       └── libhdfs.so.0.0.0</span><br><span class="line">├── libexec</span><br><span class="line">│   ├── hadoop-config.cmd</span><br><span class="line">│   ├── hadoop-config.sh</span><br><span class="line">│   ├── hdfs-config.cmd</span><br><span class="line">│   ├── hdfs-config.sh</span><br><span class="line">│   ├── httpfs-config.sh</span><br><span class="line">│   ├── kms-config.sh</span><br><span class="line">│   ├── mapred-config.cmd</span><br><span class="line">│   ├── mapred-config.sh</span><br><span class="line">│   ├── yarn-config.cmd</span><br><span class="line">│   └── yarn-config.sh</span><br><span class="line">├── LICENSE.txt</span><br><span class="line">├── NOTICE.txt</span><br><span class="line">├── README.txt</span><br><span class="line">├── sbin</span><br><span class="line">│   ├── distribute-exclude.sh</span><br><span class="line">│   ├── FederationStateStore</span><br><span class="line">│   │   ├── MySQL</span><br><span class="line">│   │   └── SQLServer</span><br><span class="line">│   ├── hadoop-daemon.sh</span><br><span class="line">│   ├── hadoop-daemons.sh</span><br><span class="line">│   ├── hdfs-config.cmd</span><br><span class="line">│   ├── hdfs-config.sh</span><br><span class="line">│   ├── httpfs.sh</span><br><span class="line">│   ├── kms.sh</span><br><span class="line">│   ├── mr-jobhistory-daemon.sh</span><br><span class="line">│   ├── refresh-namenodes.sh</span><br><span class="line">│   ├── slaves.sh</span><br><span class="line">│   ├── start-all.cmd</span><br><span class="line">│   ├── start-all.sh</span><br><span class="line">│   ├── start-balancer.sh</span><br><span class="line">│   ├── start-dfs.cmd</span><br><span class="line">│   ├── start-dfs.sh</span><br><span class="line">│   ├── start-secure-dns.sh</span><br><span class="line">│   ├── start-yarn.cmd</span><br><span class="line">│   ├── start-yarn.sh</span><br><span class="line">│   ├── stop-all.cmd</span><br><span class="line">│   ├── stop-all.sh</span><br><span class="line">│   ├── stop-balancer.sh</span><br><span class="line">│   ├── stop-dfs.cmd</span><br><span class="line">│   ├── stop-dfs.sh</span><br><span class="line">│   ├── stop-secure-dns.sh</span><br><span class="line">│   ├── stop-yarn.cmd</span><br><span class="line">│   ├── stop-yarn.sh</span><br><span class="line">│   ├── yarn-daemon.sh</span><br><span class="line">│   └── yarn-daemons.sh</span><br><span class="line">└── share</span><br><span class="line">    ├── doc</span><br><span class="line">    │   └── hadoop</span><br><span class="line">    └── hadoop</span><br><span class="line">        ├── common</span><br><span class="line">        ├── hdfs</span><br><span class="line">        ├── httpfs</span><br><span class="line">        ├── kms</span><br><span class="line">        ├── mapreduce</span><br><span class="line">        ├── tools</span><br><span class="line">        └── yarn</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> BigData </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BigData </tag>
            
            <tag> Hadoop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker简介</title>
      <link href="/2019/11/24/docker%E7%AE%80%E4%BB%8B/"/>
      <url>/2019/11/24/docker%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker为什么会出现"><a href="#Docker为什么会出现" class="headerlink" title="Docker为什么会出现"></a>Docker为什么会出现</h1><p>环境配置是异常麻烦的,换一台机器,就要重来一次,费事费力.<br>很多人想到,能不能从根本上解决这个问题 -&gt; 即软件可以带环境安装吗?<br>也就是说,安装的时候,把原始环境一模一样地复制过来.<br>开发人员利用docker可以消除协作编码时”在我机器上可正常工作”的问题</p><h1 id="Docker理念"><a href="#Docker理念" class="headerlink" title="Docker理念"></a>Docker理念</h1><p>Docker的主要目标是”Build, Ship and Run Any App, Anywhere”,也就是通过对应用组件的封装,分发,部署,运行等生命周期的管理,使用户的App及其运行环境能过做到<strong><code>一次封装,到处运行</code></strong></p><h1 id="Docker是什么"><a href="#Docker是什么" class="headerlink" title="Docker是什么"></a>Docker是什么</h1><p>Docker是基于Go语言实现的云开源项目.<br>解决了运行环境和配置问题软件容器,方便做持续集成并有助于整体发布的容器虚拟化技术</p><h1 id="一次封装-到处运行"><a href="#一次封装-到处运行" class="headerlink" title="一次封装,到处运行"></a>一次封装,到处运行</h1><h2 id="一次封装-到处运行的方式"><a href="#一次封装-到处运行的方式" class="headerlink" title="一次封装,到处运行的方式"></a>一次封装,到处运行的方式</h2><h3 id="传统的虚拟机方式"><a href="#传统的虚拟机方式" class="headerlink" title="传统的虚拟机方式"></a>传统的虚拟机方式</h3><p>虚拟机(virtual machine)就是带环境安装的一种解决方案</p><p>它可以在一种操作系统里面运行另一种操作系统,比如在windows系统里面运行linux系统.应用程序对此毫无感知,因为虚拟机看上去跟真实系统一模一样,而对于底层系统来说,虚拟机就是一个普通文件,不需要了就删掉,对其他部分毫无影响.这类虚拟机完美运行另一套系统,能够使应用程序,操作系统和硬件三者之间的逻辑不变.</p><p>虚拟机的缺点</p><ol><li>资源占用多</li><li>冗余步骤多</li><li>启动慢</li></ol><h3 id="容器方式"><a href="#容器方式" class="headerlink" title="容器方式"></a>容器方式</h3><p>由于前面虚拟机存在这些缺点,Linux发展出另一种虚拟化技术:Linux容器(Linux Containers, 缩写为LXC)</p><p>Linux容器不是模拟一个完整的操作系统,而是对进程进行隔离.有了容器,就可以将软件运行所需的所有资源打包到一个隔离的容器中.容器与虚拟机不同,不需要捆绑一整套操作系统,只需要软件工作所需的库资源和设置.系统因此而变得高效轻量并保证部署在任一环境中的软件都能始终如一的运行</p><p>比较了docker和传统虚拟化方式的不同之处:</p><ol><li>传统虚拟技术是虚拟出一套硬件后,在其上运行一个完成操作系统,在该系统上在运行所需应用进程;</li><li>而容器内的应用进程直接运行于宿主的内核,容器内没有自己的内核,而且也没有进程硬件虚拟.因此容器要比传统虚拟机更为轻便;</li><li>每个容器之间相互隔离,每个容器有自己的文件系统,容器之间进程不会相互影响,能区分计算资源.</li></ol><h2 id="一次构建-到处运行的好处"><a href="#一次构建-到处运行的好处" class="headerlink" title="一次构建,到处运行的好处"></a>一次构建,到处运行的好处</h2><ul><li>更快速的应用交付和部署</li><li>更便捷的升级和扩容器</li><li>更简单的系统运维</li><li>更高效的计算资源利用</li></ul>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jquery可输入也可选择的下拉框</title>
      <link href="/2019/11/16/Jquery%E5%8F%AF%E8%BE%93%E5%85%A5%E4%B9%9F%E5%8F%AF%E9%80%89%E6%8B%A9%E7%9A%84%E4%B8%8B%E6%8B%89%E6%A1%86/"/>
      <url>/2019/11/16/Jquery%E5%8F%AF%E8%BE%93%E5%85%A5%E4%B9%9F%E5%8F%AF%E9%80%89%E6%8B%A9%E7%9A%84%E4%B8%8B%E6%8B%89%E6%A1%86/</url>
      
        <content type="html"><![CDATA[<h1 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h1><p><a href="https://www.jianshu.com/p/97252c501e91" target="_blank" rel="noopener">可输入也可选择的下拉框(单选或输入)</a></p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>自定义下拉选择框<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">        *&#123;<span class="attribute">margin</span>:<span class="number">0</span>; <span class="attribute">padding</span>:<span class="number">0</span>;&#125;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">ul</span>,<span class="selector-tag">li</span>&#123;<span class="attribute">list-style</span>:none;&#125;</span></span><br><span class="line"><span class="css">        <span class="selector-pseudo">:focus</span>&#123;<span class="attribute">outline</span>: none;&#125;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">input</span><span class="selector-attr">[type=text]</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#ccc</span>;&#125;</span></span><br><span class="line"><span class="css">        <span class="selector-tag">input</span><span class="selector-attr">[type=text]</span><span class="selector-pseudo">:hover</span>,<span class="selector-tag">input</span><span class="selector-attr">[type=text]</span><span class="selector-pseudo">:focus</span>&#123;<span class="attribute">border-color</span>: <span class="number">#57bc80</span>; <span class="attribute">box-shadow</span>: none;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="comment">/* 上面的css是初始化css,底下的css才是效果代码 */</span></span></span><br><span class="line"><span class="css">        <span class="selector-tag">body</span>&#123;<span class="attribute">padding</span>:<span class="number">50px</span>; <span class="attribute">font-size</span>: <span class="number">12px</span>;&#125;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.my-select-box</span>&#123;<span class="attribute">position</span>: relative;&#125;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.my-select-box</span> <span class="selector-class">.my-select-input</span>&#123; <span class="attribute">height</span>: <span class="number">24px</span>; <span class="attribute">line-height</span>: <span class="number">24px</span>; <span class="attribute">padding</span>:<span class="number">0</span> <span class="number">5px</span>;</span></span><br><span class="line">            background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAICAYAAADJEc7MAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIGNIUk0AAG2YAABzjgAA4DIAAIM2AAB5CAAAxgwAADT6AAAgbL5TJ5gAAABGSURBVHjaYvz//z8DOYCJgUzA0tnZidPK8vJyRpw24pLEpwnuVHRFhDQxMDAwMPz//x+OOzo6/iPz8WFGuocqAAAA//8DAD/sORHYg7kaAAAAAElFTkSuQmCC) right center no-repeat;</span><br><span class="line"><span class="css">            <span class="selector-tag">padding-right</span><span class="selector-pseudo">:20px</span> !<span class="selector-tag">important</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">width</span><span class="selector-pseudo">:100</span>%;</span></span><br><span class="line">            box-sizing: border-box;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.my-select-box</span> <span class="selector-class">.my-select-list</span>&#123;<span class="attribute">position</span>:absolute; <span class="attribute">left</span>:<span class="number">0</span>; <span class="attribute">z-index</span>: <span class="number">101</span>; <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#ccc</span>; <span class="attribute">border-top</span>:none; <span class="attribute">max-height</span>: <span class="number">120px</span>; <span class="attribute">overflow-y</span>: auto; <span class="attribute">display</span>: none; <span class="attribute">background</span>: <span class="number">#fff</span>; <span class="attribute">width</span>:<span class="number">100%</span>; <span class="attribute">box-sizing</span>: border-box;&#125;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.my-select-box</span> <span class="selector-class">.my-select-list</span> <span class="selector-tag">li</span>&#123;<span class="attribute">height</span>: <span class="number">22px</span>; <span class="attribute">line-height</span>: <span class="number">22px</span>; <span class="attribute">padding</span>:<span class="number">0</span> <span class="number">3px</span>; <span class="attribute">cursor</span>:pointer; <span class="attribute">margin-bottom</span>: <span class="number">1px</span>&#125;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.my-select-box</span> <span class="selector-class">.my-select-list</span> <span class="selector-tag">li</span><span class="selector-class">.choosed</span>&#123;<span class="attribute">background</span>: <span class="number">#ccc</span>; <span class="attribute">color</span>:<span class="number">#fff</span>;&#125;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.my-select-box</span> <span class="selector-class">.my-select-list</span> <span class="selector-tag">li</span><span class="selector-pseudo">:hover</span>&#123;<span class="attribute">background</span>: <span class="number">#ccc</span>; <span class="attribute">color</span>:<span class="number">#fff</span>;&#125;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"my-select-box"</span> <span class="attr">style</span>=<span class="string">"width:300px;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"my-select-input"</span> <span class="attr">placeholder</span>=<span class="string">"可输入也可选择"</span> <span class="attr">maxlength</span>=<span class="string">"20"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"my-select-list"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"1"</span>&gt;</span>第一项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"2"</span>&gt;</span>第二项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"3"</span>&gt;</span>第三项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"4"</span>&gt;</span>第四项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"5"</span>&gt;</span>第5项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"6"</span>&gt;</span>第6项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"7"</span>&gt;</span>第7项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"8"</span>&gt;</span>第8项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"height: 30px"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"my-select-box"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"my-select-input"</span> <span class="attr">placeholder</span>=<span class="string">"可输入也可选择"</span> <span class="attr">maxlength</span>=<span class="string">"20"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"my-select-list"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"1"</span>&gt;</span>第一项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"2"</span>&gt;</span>第二项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"3"</span>&gt;</span>第三项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"4"</span>&gt;</span>第四项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"5"</span>&gt;</span>第5项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"6"</span>&gt;</span>第6项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"7"</span>&gt;</span>第7项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">data-value</span>=<span class="string">"8"</span>&gt;</span>第8项<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery-3.2.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">        ;(<span class="function"><span class="keyword">function</span><span class="params">($)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">            $.fn.MySelect=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> $box=$(<span class="keyword">this</span>);</span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">var</span> $input=$box.find(<span class="string">"input.my-select-input"</span>);  <span class="comment">//输入框</span></span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">var</span> $list=$input.next();                          <span class="comment">//ul装扮成下拉框</span></span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">var</span> inputHeight=$input.outerHeight();   <span class="comment">//计算input输入框的高度和宽度，方便定位ul和设置ul及包裹元素的宽度</span></span></span><br><span class="line"><span class="actionscript">                    $list.css(&#123;<span class="string">"top"</span>:(inputHeight)&#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">                    $input.focus(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;   <span class="comment">//输入框获得焦点后，显示下拉选择ul</span></span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> $nextUl=$(<span class="keyword">this</span>).next();</span></span><br><span class="line"><span class="actionscript">                        <span class="keyword">if</span>($nextUl.children().length&gt;<span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="javascript">                            $(<span class="keyword">this</span>).next().show();</span></span><br><span class="line">                        &#125;</span><br><span class="line"><span class="actionscript">                    &#125;).bind(<span class="string">'input propertychange'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;  <span class="comment">//绑定监测输入框的输入值更改</span></span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> $<span class="keyword">this</span>=$(<span class="keyword">this</span>);</span></span><br><span class="line"><span class="actionscript">                        $<span class="keyword">this</span>.attr(<span class="string">"data-id"</span>,<span class="string">""</span>);</span></span><br><span class="line"><span class="actionscript">                        <span class="keyword">var</span> curText=$<span class="keyword">this</span>.val();</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> $nextUl=$(<span class="keyword">this</span>).next();</span></span><br><span class="line"><span class="actionscript">                        <span class="keyword">if</span>($nextUl.children().length&gt;<span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="actionscript">                            $nextUl.find(<span class="string">"li"</span>).removeClass(<span class="string">"choosed"</span>);</span></span><br><span class="line"><span class="actionscript">                            $nextUl.find(<span class="string">"li"</span>).each(<span class="function"><span class="keyword">function</span><span class="params">(i,item)</span></span>&#123;</span></span><br><span class="line"><span class="javascript">                                <span class="keyword">var</span> txt=$(item).text();</span></span><br><span class="line"><span class="actionscript">                                <span class="keyword">if</span>(txt===curText)&#123;</span></span><br><span class="line"><span class="javascript">                                    <span class="keyword">var</span> v=$(item).attr(<span class="string">"data-value"</span>);</span></span><br><span class="line"><span class="actionscript">                                    $<span class="keyword">this</span>.attr(<span class="string">"data-id"</span>,v);</span></span><br><span class="line"><span class="javascript">                                    $(item).addClass(<span class="string">"choosed"</span>);</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">                    <span class="comment">//修改成如下事件绑定，为了给动态添加的li也可以产生点击效果</span></span></span><br><span class="line"><span class="actionscript">                    $list.off(<span class="string">'click'</span>, <span class="string">'li'</span>).on(<span class="string">'click'</span>, <span class="string">'li'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> $<span class="keyword">this</span> = $(<span class="keyword">this</span>);</span></span><br><span class="line"><span class="actionscript">                        <span class="keyword">var</span> value = $<span class="keyword">this</span>.attr(<span class="string">"data-value"</span>) || <span class="string">''</span>;</span></span><br><span class="line"><span class="actionscript">                        $input.val($<span class="keyword">this</span>.text()).attr(<span class="string">"data-id"</span>, value);</span></span><br><span class="line"><span class="actionscript">                        $<span class="keyword">this</span>.addClass(<span class="string">"choosed"</span>).siblings().removeClass(<span class="string">"choosed"</span>);</span></span><br><span class="line"><span class="actionscript">                        $<span class="keyword">this</span>.parent().hide();</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">                $(<span class="built_in">document</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;  <span class="comment">//点击.my-select-box范围外时隐藏ul下拉框</span></span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">var</span> target=e.target;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> $target=$(target);</span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">var</span> $parent=$target.closest(<span class="string">'.my-select-box'</span>);</span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">if</span>($parent.length&lt;<span class="number">1</span>)&#123;  <span class="comment">//说明不是.my-select-box范围内点击，将ul隐藏</span></span></span><br><span class="line"><span class="javascript">                        $(<span class="string">".my-select-list"</span>).hide();</span></span><br><span class="line"><span class="actionscript">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>($parent.length==<span class="number">1</span>)&#123;  <span class="comment">//如果存在多个my-select-box的情况，将其余的非这项以外的都隐藏</span></span></span><br><span class="line"><span class="actionscript">                        <span class="keyword">var</span> $ul=$parent.find(<span class="string">".my-select-list"</span>);</span></span><br><span class="line"><span class="actionscript">                        <span class="keyword">var</span> flag=$ul.is(<span class="string">":hidden"</span>);</span></span><br><span class="line"><span class="javascript">                        $(<span class="string">".my-select-list"</span>).hide();</span></span><br><span class="line"><span class="actionscript">                        <span class="keyword">if</span>(!flag) $ul.show();</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> <span class="keyword">this</span>;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)(jQuery);</span><br><span class="line"></span><br><span class="line"><span class="javascript">        $(<span class="string">".my-select-box"</span>).MySelect();</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><p><img src="/images/2019/11/20191115001.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Javascript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Jquery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java用jackson包实现json、对象、Map之间的转换</title>
      <link href="/2019/11/12/java%E7%94%A8jackson%E5%8C%85%E5%AE%9E%E7%8E%B0json%E3%80%81%E5%AF%B9%E8%B1%A1%E3%80%81Map%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2/"/>
      <url>/2019/11/12/java%E7%94%A8jackson%E5%8C%85%E5%AE%9E%E7%8E%B0json%E3%80%81%E5%AF%B9%E8%B1%A1%E3%80%81Map%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h2 id="将对象转换成json"><a href="#将对象转换成json" class="headerlink" title="将对象转换成json"></a>将对象转换成json</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper(); <span class="comment">//转换器 </span></span><br><span class="line">String jsonStr = mapper.writeValueAsString(user);</span><br></pre></td></tr></table></figure><h2 id="json转换成map"><a href="#json转换成map" class="headerlink" title="json转换成map"></a>json转换成map</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map m = mapper.readValue(json, Map.class);</span><br></pre></td></tr></table></figure><h2 id="map转json"><a href="#map转json" class="headerlink" title="map转json"></a>map转json</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String jsonStr = mapper.writeValueAsString(m);</span><br></pre></td></tr></table></figure><h2 id="json转java对象"><a href="#json转java对象" class="headerlink" title="json转java对象"></a>json转java对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User user = mapper.readValue(json, User.class);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Jackson </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringSecurity的CSRF问题Invalid CSRF Token Null Was Found on...</title>
      <link href="/2019/11/12/SpringSecurity%E7%9A%84CSRF%E9%97%AE%E9%A2%98Invalid-CSRF-Token-null-was-found-on/"/>
      <url>/2019/11/12/SpringSecurity%E7%9A%84CSRF%E9%97%AE%E9%A2%98Invalid-CSRF-Token-null-was-found-on/</url>
      
        <content type="html"><![CDATA[<h1 id="参考与引用"><a href="#参考与引用" class="headerlink" title="参考与引用"></a>参考与引用</h1><p><a href="https://www.cnblogs.com/yjmyzz/p/customize-CsrfFilter-to-ignore-certain-post-http-request.html" target="_blank" rel="noopener">Spring Security笔记：解决CsrfFilter与Rest服务Post方式的矛盾</a><br><a href="https://blog.csdn.net/icanactnow2/article/details/53515844" target="_blank" rel="noopener">security禁用csrf</a><br><a href="https://blog.csdn.net/u012373815/article/details/55047285" target="_blank" rel="noopener">spring security CSRF 问题 Invalid CSRF Token ‘null’ was found on ……</a></p><h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>pring security在集成spring boot的微服务框架后，实现了cas认证和权限控制。只要使用post进行请求都会有如下问题</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP Status 403－Invalid CSRF Token &apos;null&apos; was found on the request parameter &apos;_csrf&apos; or header &apos;X-CSRF-TOKEN&apos;.</span><br></pre></td></tr></table></figure><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>Spring Security 4.0之后，引入了CSRF，默认是开启。</p><h2 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h2><p>不得不说，CSRF和RESTful技术有冲突。CSRF默认支持的方法：</p><ul><li>GET</li><li>HEAD</li><li>TRACE</li><li>OPTIONS</li><li><strong>不支持POST</strong></li></ul><p>源码如下,POST方法被排除在外了,也就是说只有GET|HEAD|TRACE|OPTIONS这4类方法会被放行，其它Method的http请求，都要验证_csrf的token是否正确，而通常post方式调用rest服务时，又没有_csrf的token，所以校验失败。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultRequiresCsrfMatcher</span> <span class="keyword">implements</span> <span class="title">RequestMatcher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Pattern allowedMethods = Pattern.compile(<span class="string">"^(GET|HEAD|TRACE|OPTIONS)$"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* (non-Javadoc)</span></span><br><span class="line"><span class="comment">     * @see org.springframework.security.web.util.matcher.RequestMatcher#matches(javax.servlet.http.HttpServletRequest)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !allowedMethods.matcher(request.getMethod()).matches();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="什么是csrf"><a href="#什么是csrf" class="headerlink" title="什么是csrf"></a>什么是csrf</h2><p>科普一下，什么是csrf,这是一个web应用安全的问题，CSRF（Cross-site request forgery跨站请求伪造，也被称为“One Click Attack” 或者Session Riding，攻击方通过伪造用户请求访问受信任站点。</p><p>我们知道，客户端与服务端在基于http协议在交互的数据的时候，由于http协议本身是无状态协议，后来引进了cookie的 方式进行记录服务端和客户端的之间交互的状态和标记。cookie里面一般会放置服务端生成的session id（会话ID）用来识别客户端访问服务端过 程中的客户端的身份标记。</p><p>在跨域 (科普一下：同一个ip、同一个网络协议、同一个端口，三者都满足就是同一个域，否则就有跨域问题) 的情况下， session id可能会被恶意第三方劫持，此时劫持这个session id的第三方会根据这个session id向服务器发起请求，此时服务器收到这个请求会认为这是合法的请求，并返回根据请求完成相应的服务端更新。</p><h2 id="为什么允许get而不允许post"><a href="#为什么允许get而不允许post" class="headerlink" title="为什么允许get而不允许post"></a>为什么允许get而不允许post</h2><p>如果这个http请求是get方式发起的请求，意味着它只是访问服务器 的资源，仅仅只是查询，没有更新服务器的资源，所以对于这类请求，spring security的防御策略是允许的，</p><p>如果这个请求是通过post请求发起的， 那么spring security是默认拦截这类请求的，因为这类请求是带有更新服务器资源的危险操作，如果恶意第三方可以通过劫持session id来更新 服务器资源，那会造成服务器数据被非法的篡改，所以这类请求是会被Spring security拦截的，在默认的情况下，spring security是启用csrf 拦截功能的，这会造成，在跨域的情况下，post方式提交的请求都会被拦截无法被处理（包括合理的post请求），前端发起的post请求后端无法正常 处理，虽然保证了跨域的安全性，但影响了正常的使用，如果关闭csrf防护功能，虽然可以正常处理post请求，但是无法防范通过劫持session id的非法的post请求</p><h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><p>原因找到了：spring Security 3默认关闭csrf，Spring Security 4默认启动了csrf</p><h2 id="如果不采用csrf，可禁用security的csrf"><a href="#如果不采用csrf，可禁用security的csrf" class="headerlink" title="如果不采用csrf，可禁用security的csrf"></a>如果不采用csrf，可禁用security的csrf</h2><p>Java注解方式配置：</p><p>加上 .csrf().disable()即可。</p><p>修改前WebSecurityConfig.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">"/"</span>, <span class="string">"/home"</span>).permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            .formLogin()</span><br><span class="line">            .loginPage(<span class="string">"/login"</span>).permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            .logout().logoutUrl(<span class="string">"/logout"</span>)</span><br><span class="line">            .logoutSuccessUrl(<span class="string">"/hello"</span>)</span><br><span class="line">            .permitAll();</span><br><span class="line">    http.addFilterBefore(customizeFilterSecurityInterceptor, FilterSecurityInterceptor.class)</span><br><span class="line">            .csrf().disable();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="不关闭csrf防护功能的前提下spring-security要如何才能使用post"><a href="#不关闭csrf防护功能的前提下spring-security要如何才能使用post" class="headerlink" title="不关闭csrf防护功能的前提下spring security要如何才能使用post"></a>不关闭csrf防护功能的前提下spring security要如何才能使用post</h2><h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>自己弄一个Matcher,既然源码中不允许POST,我们就自定义一个,放行就好</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cnblogs.yjmyzz.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.util.matcher.RequestMatcher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CsrfSecurityRequestMatcher</span> <span class="keyword">implements</span> <span class="title">RequestMatcher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Pattern allowedMethods = Pattern</span><br><span class="line">            .compile(<span class="string">"^(GET|HEAD|TRACE|OPTIONS)$"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (execludeUrls != <span class="keyword">null</span> &amp;&amp; execludeUrls.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            String servletPath = request.getServletPath();</span><br><span class="line">            <span class="keyword">for</span> (String url : execludeUrls) &#123;</span><br><span class="line">                <span class="keyword">if</span> (servletPath.contains(url)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> !allowedMethods.matcher(request.getMethod()).matches();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要排除的url列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; execludeUrls;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getExecludeUrls</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> execludeUrls;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExecludeUrls</span><span class="params">(List&lt;String&gt; execludeUrls)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.execludeUrls = execludeUrls;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里添加了一个属性execludeUrls，允许人为排除哪些url。</p><p>然后在配置文件里，这样修改：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">http</span> <span class="attr">entry-point-ref</span>=<span class="string">"loginEntryPoint"</span> <span class="attr">use-expressions</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">     ...</span><br><span class="line">     <span class="tag">&lt;<span class="name">intercept-url</span> <span class="attr">pattern</span>=<span class="string">"/rest/**"</span> <span class="attr">access</span>=<span class="string">"permitAll"</span> /&gt;</span></span><br><span class="line">     ...</span><br><span class="line">     <span class="tag">&lt;<span class="name">csrf</span> <span class="attr">request-matcher-ref</span>=<span class="string">"csrfSecurityRequestMatcher"</span>/&gt;</span>        </span><br><span class="line"> <span class="tag">&lt;/<span class="name">http</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">beans:bean</span> <span class="attr">id</span>=<span class="string">"csrfSecurityRequestMatcher"</span> <span class="attr">class</span>=<span class="string">"com.cnblogs.yjmyzz.utils.CsrfSecurityRequestMatcher"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">beans:property</span> <span class="attr">name</span>=<span class="string">"execludeUrls"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">beans:list</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">beans:value</span>&gt;</span>/rest/<span class="tag">&lt;/<span class="name">beans:value</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">beans:list</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">beans:property</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">beans:bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p>spring security为了正确的区别合法的post请求，采用了token的机制。</p><p>在跨域的场景下，客户端访问服务端会首先发起get请求，这个get请求在到达服务端的时候，服务端的Spring security会有一个过滤 器 CsrfFilter去检查这个请求，如果这个request请求的http header里面的X-CSRF-COOKIE的token值为空的时候，服务端就好自动生成一个 token值放进这个X-CSRF-COOKIE值里面，客户端在get请求的header里面获取到这个值，如果客户端有表单提交的post请求，则要求客户端要 携带这个token值给服务端，在post请求的header里面设置_csrf属性的token值，提交的方式可以是ajax也可以是放在form里面设置hidden 属性的标签里面提交给服务端，服务端就会根据post请求里面携带的token值进行校验，如果跟服务端发送给合法客户端的token值是一样的，那么 这个post请求就可以受理和处理，如果不一样或者为空，就会被拦截。由于恶意第三方可以劫持session id，而很难获取token值，所以起到了安全的防护作用。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> Java细节 </tag>
            
            <tag> SpringSecurity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>大数据学习大纲</title>
      <link href="/2019/10/13/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0%E5%A4%A7%E7%BA%B2/"/>
      <url>/2019/10/13/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AD%A6%E4%B9%A0%E5%A4%A7%E7%BA%B2/</url>
      
        <content type="html"><![CDATA[<h1 id="大数据概念"><a href="#大数据概念" class="headerlink" title="大数据概念"></a>大数据概念</h1><p>大数据(Big Data):指无法在一定时间范围内用常规软件工具进行捕捉,管理和处理的数据集合,是需要新处理模式才能具有更强的决策力,洞察发现力和流程优化能力的海量,高增长率和多样化的信息资产</p><h1 id="主要解决"><a href="#主要解决" class="headerlink" title="主要解决"></a>主要解决</h1><p>海量数据的存储和海量数据的分析计算问题</p><h1 id="大数据特点"><a href="#大数据特点" class="headerlink" title="大数据特点"></a>大数据特点</h1><ol><li><p>Volume(大量)<br>截至目前,人类生产的所有印刷材料的数据量是200PB,而历史上全人类总共说过的话是5EB,当前,典型个人计算机硬盘容量为TB量级,而一些大企业的数据量已经接近EB量级</p></li><li><p>Velocity(高速)<br>这是大数据区分于传统数据挖掘的显著特征.根据IDC的”数字宇宙”的报告,预计到2020年,全球数据使用量将达到35.2ZB.在如此海量的数据面前,处理数据的效率就是企业的生命</p></li><li><p>Variety(多样)<br>这种类型的多样性也让数据分为结构化数据和非结构化数据.相对于以往便与存储的以数据库/文本为主的结构化数据,非结构化数据越来越多,包括网络日志,音频,视频,图片,地理位置信息等,这些多类型的数据对数据的处理能力提出了更高的要求</p></li><li><p>Value(价值低密度)<br>价值密度的高低与数据总量大小成反比.比如,在一天监控视频中,我们只关系其中的一分钟.如何快速对有价值数据”提纯”称为目前大数据背景下待解决的难题</p></li></ol><h1 id="大数据应用场景"><a href="#大数据应用场景" class="headerlink" title="大数据应用场景"></a>大数据应用场景</h1><ol><li>物流仓储:大数据分析系统助力商家精细化运营,提升销量,节约成本</li><li>零售:分析用户消费习惯,为用户购买商品提供方便,从而提高商品销量</li><li>旅游:深度结合大数据能力与旅游行业需求,共建旅游产业智慧管理,智慧服务和智慧营销的未来</li><li>商品广告推荐:给用户推荐可能喜欢的商品</li><li>保险:海量数据挖掘及风险预测,助力保险行业精准营销,提升精细化定价能力</li><li>金融:多维度体现用户特征,帮助金融机构推荐优质客户,防范欺诈风险</li><li>房产:大数据全面助力房地产行业,打造精准投策与营销,选出更何时的地,建造更合适的楼,卖给更合适的人</li><li>人工智能</li></ol><h1 id="大数据部门组织结构"><a href="#大数据部门组织结构" class="headerlink" title="大数据部门组织结构"></a>大数据部门组织结构</h1><p><img src="/images/2020/05/20200506012.png" alt></p><h1 id="大数据生态体系"><a href="#大数据生态体系" class="headerlink" title="大数据生态体系"></a>大数据生态体系</h1><h2 id="总体生态体系"><a href="#总体生态体系" class="headerlink" title="总体生态体系"></a>总体生态体系</h2><p><img src="/images/2019/10/20191012002.png" alt></p><h2 id="细化"><a href="#细化" class="headerlink" title="细化"></a>细化</h2><p><img src="/images/2020/05/20200506017.png" alt></p><h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><p>Linux</p><h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><h3 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h3><ul><li>java语法基础</li><li>java数据类型</li><li>java分支循环</li><li>oop</li><li>io</li><li>collection</li></ul>]]></content>
      
      
      <categories>
          
          <category> BigData </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BigData </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot的验证功能</title>
      <link href="/2019/10/03/SpringBoot%E7%9A%84%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD/"/>
      <url>/2019/10/03/SpringBoot%E7%9A%84%E9%AA%8C%E8%AF%81%E5%8A%9F%E8%83%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h1><h1 id="背景说明"><a href="#背景说明" class="headerlink" title="背景说明"></a>背景说明</h1><p>我们都知道,任何发送到服务器的数据都必须有验证,而对于验证,我们常会看见类似如下的代码<br><img src="/images/2019/10/20191003001.png" alt></p><ul><li>其实,这样的代码并没有什么不好的.而且有时候由于没有利用到框架的特性,这样的代码更利于实现业务.</li><li>但是,我碰到一件很闹心的事情,就是客户看代码了,且由于一知半解,指出没有利用SpringBoot的特性,直接打回来了.</li><li>被打回来的项目里面,表单里有近两百个输入选项,各种逻辑,并且页面转换的时候是不允许使用任何存储(数据库,session,cookie)</li><li>同时,这些输入项有很多业务前后相关</li></ul><p><strong>具体来说</strong></p><ul><li>需要A,B,C存在才验证B</li><li>验证需要快速失败,即参数A有验证甲乙丙三种,按顺序,甲失败了,乙就不继续验证了</li></ul><p>当然,好事来说,我经过这么折腾一次,整个验证都弄清楚了</p><h1 id="SpringBoot的验证Validation"><a href="#SpringBoot的验证Validation" class="headerlink" title="SpringBoot的验证Validation"></a>SpringBoot的验证Validation</h1><h2 id="Hibernate-Validator"><a href="#Hibernate-Validator" class="headerlink" title="Hibernate Validator"></a>Hibernate Validator</h2><p>文档地址:<a href="https://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/#preface" target="_blank" rel="noopener">https://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/#preface</a></p><h2 id="Spring-Validator"><a href="#Spring-Validator" class="headerlink" title="Spring Validator"></a>Spring Validator</h2><p>文档地址:<a href="https://docs.spring.io/spring/docs/5.0.5.RELEASE/spring-framework-reference/core.html#validation" target="_blank" rel="noopener">https://docs.spring.io/spring/docs/5.0.5.RELEASE/spring-framework-reference/core.html#validation</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot的快速入门</title>
      <link href="/2019/10/03/SpringBoot%E7%9A%84%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
      <url>/2019/10/03/SpringBoot%E7%9A%84%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<ul><li>Controller编写和测试</li><li>入门解析</li><li>工程的热部署</li><li>起步依赖</li><li>自动配置原理分析</li><li>配置文件的类型和作用</li><li>配置文件-yml文件的普通属性和对象属性</li><li>配置文件-yml文件的集合配置</li><li>通过@Value映射数据</li><li>通过@ConfigurationProperties映射数据</li><li>configuration-processor作用</li><li>集成Mybatis</li><li>集成Junit</li><li>集成SpringDataJPA</li><li>集成Redis</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flink运行架构总结</title>
      <link href="/2019/09/14/Flink%E8%BF%90%E8%A1%8C%E6%9E%B6%E6%9E%84%E6%80%BB%E7%BB%93/"/>
      <url>/2019/09/14/Flink%E8%BF%90%E8%A1%8C%E6%9E%B6%E6%9E%84%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="任务提交流程"><a href="#任务提交流程" class="headerlink" title="任务提交流程"></a>任务提交流程</h1><p><img src="/images/2019/09/20190903001.png" alt></p><h1 id="TaskManager-与-Slots"><a href="#TaskManager-与-Slots" class="headerlink" title="TaskManager 与 Slots"></a>TaskManager 与 Slots</h1><h2 id="task-slot是什么"><a href="#task-slot是什么" class="headerlink" title="task slot是什么"></a>task slot是什么</h2><ul><li>task slot表示内存资源且这个内存资源是TaskManager 拥有的内存资源的子集</li></ul><h2 id="TaskManager划分出task-slot的目的"><a href="#TaskManager划分出task-slot的目的" class="headerlink" title="TaskManager划分出task slot的目的"></a>TaskManager划分出task slot的目的</h2><ul><li>不需要跟来自其他 job 的 subtask 竞争被管理的内存(防止线程竞争内存资源,这里不会涉及到 CPU 的隔离)</li></ul><h2 id="一个-TaskManager-多个-slot-意味着"><a href="#一个-TaskManager-多个-slot-意味着" class="headerlink" title="一个 TaskManager 多个 slot 意味着"></a>一个 TaskManager 多个 slot 意味着</h2><p><img src="/images/2019/09/20190903002.png" alt></p><ul><li>一个TaskManager 能接收多少个task<ul><li>&lt;=&gt; task slot的数量</li><li>&lt;=&gt; TaskManager 将内存资源平均分成几份</li></ul></li><li>subtask 可以共享同一个 JVM<ul><li>==&gt; 将共享 TCP 连接（基于多路复用）和心跳消息</li><li>==&gt; 共享数据集和数据结构</li><li>==&gt; 减少了每个task 的负载</li></ul></li><li>防止线程竞争内存资源(这里不会涉及到 CPU 的隔离)</li><li><strong>最大并行度</strong>(并发执行能力)( ==&gt; 注意和并行度进行区分)<ul><li>最大并行度:即Task Slot的数量,是静态概念,指 TaskManager 具有的并发执行能力,用taskmanager.numberOfTaskSlots参数设置</li><li>并行度(parallelism): 是动态概念，即 TaskManager 运行程序时实际使用的并发能力,用parallelism.default参数设置</li><li>举例:假设一共有 3 个 TaskManager，每一个 TaskManager 中的分配 3 个TaskSlot，也就是每个 TaskManager 可以接收 3 个 task，一共 9 个 TaskSlot，如果我们设置 parallelism.default=1，即运行程序默认的并行度为 1，9 个 TaskSlot 只用了 1个，有 8 个空闲，因此，设置合适的并行度才能提高效率</li></ul></li></ul><h1 id="Dataflow"><a href="#Dataflow" class="headerlink" title="Dataflow"></a>Dataflow</h1><h2 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h2><ul><li>由 Source、Transformation、Sink 这三个核心组件组成<ul><li>&lt;=&gt; 输入(source operator) –stream–&gt; 转换(transformations operators) –stream–&gt; 输出(sink operator)<br><img src="/images/2019/09/20190903003.png" alt></li></ul></li><li>一个 stream 包含一个或多个 stream partition</li><li>一个 operator 包含一个或多个 operator subtask (<strong>operator subtasks 在不同的线程、不同的物理机或不同的容器中彼此互不依赖得执行</strong>)<img src="/images/2019/09/20190903004.png" alt></li></ul><h2 id="并行度"><a href="#并行度" class="headerlink" title="并行度"></a>并行度</h2><ul><li>一个特定 operator 的 subtask 的个数被称之为其 parallelism(并行度)</li><li>注意与最大并行度进行区分</li></ul><h2 id="如何执行"><a href="#如何执行" class="headerlink" title="如何执行"></a>如何执行</h2><ul><li><code>one-to-one</code>的operator形成链条(operator chains),即形成subTask链,一条链相当于一个完整的task,只在一个线程中运行<ul><li>类似Spark中的窄依赖</li><li>目的是减少线程之间的切换和基于缓存区的数据交换，在减少时延的同时提升吞吐量</li></ul></li><li><code>Redistributing</code>的operator运行一个线程<ul><li>类似Spark中的宽依赖</li></ul></li><li>一个操作链(设并行度是2) ==&gt; 将一个操作链划分成两部分 ==&gt; 对于每一个部分使用一个独立的task去运行(即一个独立的线程) ==&gt; 一个task处理的数据就是一个分区的数据<br><img src="/images/2019/09/20190903005.png" alt></li></ul><h1 id="任务调度流程"><a href="#任务调度流程" class="headerlink" title="任务调度流程"></a>任务调度流程</h1><p><img src="/images/2019/09/20190903006.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> BigData </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BigData </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中wps2019可以插入公式</title>
      <link href="/2019/09/12/Ubuntu%E4%B8%ADwps2019%E5%8F%AF%E4%BB%A5%E6%8F%92%E5%85%A5%E5%85%AC%E5%BC%8F/"/>
      <url>/2019/09/12/Ubuntu%E4%B8%ADwps2019%E5%8F%AF%E4%BB%A5%E6%8F%92%E5%85%A5%E5%85%AC%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址:"></a>下载地址:</h1><p><a href="https://linux.wps.cn/" target="_blank" rel="noopener">https://linux.wps.cn/</a></p><h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><blockquote><p>  伴随着这次新版本的发行，我们将在Linux平台首次引入新公式插入功能，便捷高效、灵活易用。针对文档中插入复杂公式的应用需求，该功能将帮助用户更加舒适地将复杂多变的公式内容精准地落实到文档当中。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot的环境搭建</title>
      <link href="/2019/09/04/SpringBoot%E7%9A%84%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
      <url>/2019/09/04/SpringBoot%E7%9A%84%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="创建maven项目"><a href="#创建maven项目" class="headerlink" title="创建maven项目"></a>创建maven项目</h1><p><img src="/images/springboot/20190903004.png" alt><br><img src="/images/springboot/20190903005.png" alt><br><img src="/images/springboot/20190903006.png" alt></p><p>项目创建完成后的结构图<br><img src="/images/springboot/20190903007.png" alt></p><h1 id="修改pom-xml文件"><a href="#修改pom-xml文件" class="headerlink" title="修改pom.xml文件"></a>修改pom.xml文件</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>boot<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- springboot 项目要继承起步依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- web功能的起步依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="创建示例代码"><a href="#创建示例代码" class="headerlink" title="创建示例代码"></a>创建示例代码</h1><p><img src="/images/springboot/20190903008.png" alt></p><p>图片中的代码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MySpringBootApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">SpringApplication.run(MySpringBootApplication.class);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要注意两个东西(暂时不用了解为什么)</p><ol><li>@SpringBootApplication</li><li>SpringApplication.run();</li></ol><h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><p><code>run as</code> -&gt; <code>spring boot app</code>可以看到如下结果</p><p><img src="/images/springboot/20190903009.png" alt></p><p>在浏览器访问可以看到已经访问成功(页面出现错误是现在什么页面都没有)<br><img src="/images/springboot/20190903010.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装iptux</title>
      <link href="/2019/08/19/ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85iptux/"/>
      <url>/2019/08/19/ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85iptux/</url>
      
        <content type="html"><![CDATA[<h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><p>ubuntu版的飞鸽传书</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>ubuntu软件中直接搜索安装</p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装桌面维基zim</title>
      <link href="/2019/08/19/ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E6%A1%8C%E9%9D%A2%E7%BB%B4%E5%9F%BAzim/"/>
      <url>/2019/08/19/ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85%E6%A1%8C%E9%9D%A2%E7%BB%B4%E5%9F%BAzim/</url>
      
        <content type="html"><![CDATA[<h1 id="zim是什么"><a href="#zim是什么" class="headerlink" title="zim是什么"></a>zim是什么</h1><p>Zim是一个图形文本编辑器，用于维护一组wiki页面。</p><h1 id="zim的作用"><a href="#zim的作用" class="headerlink" title="zim的作用"></a>zim的作用</h1><p>每个页面都可以包含指向其他页面的链接，简单的格式和图像。页面存储在文件夹结构中，就像在大纲中一样，并且可以具有附件。创建新页面就像链接到不存在的页面一样简单。所有数据都存储在具有wiki格式的纯文本文件中。各种插件提供附加功能，如任务列表管理器，公式编辑器，托盘图标和版本控制支持。</p><p>Zim可用于：</p><ul><li>保留笔记存档</li><li>保留每日或每周日记</li><li>在会议或讲座期间做笔记</li><li>组织任务列表</li><li>撰写博客条目和电子邮件</li><li>做头脑风暴</li></ul><h1 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h1><p><a href="https://zim-wiki.org/" target="_blank" rel="noopener">https://zim-wiki.org/</a></p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:jaap.karssenberg/zim</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install zim</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ubuntu中安装Openshot Video Editor</title>
      <link href="/2019/08/19/ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85openshot-video-editor/"/>
      <url>/2019/08/19/ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85openshot-video-editor/</url>
      
        <content type="html"><![CDATA[<h1 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h1><p>能够支持视频剪辑、实时预览、支持设置仅显示视频或音频、图片覆盖等</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>Ubuntu软件中直接搜索安装就行</p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8函数式接口和Consumer、Supplier、Predicate、Function说明</title>
      <link href="/2019/08/10/Java8%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3Consumer%E3%80%81Supplier%E3%80%81Predicate%E5%92%8CFunction%E8%AF%B4%E6%98%8E/"/>
      <url>/2019/08/10/Java8%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3Consumer%E3%80%81Supplier%E3%80%81Predicate%E5%92%8CFunction%E8%AF%B4%E6%98%8E/</url>
      
        <content type="html"><![CDATA[<h1 id="FunctionalInterface注解"><a href="#FunctionalInterface注解" class="headerlink" title="@FunctionalInterface注解"></a>@FunctionalInterface注解</h1><p>与@Override 注解的作用类似，Java 8中专门为函数式接口引入了一个新的注解：@FunctionalInterface 。该注解可用于一个接口的定义上,一旦使用该注解来定义接口，编译器将会强制检查该接口是否确实有且仅有一个抽象方法，否则将会报错。但是这个注解不是必须的，只要符合函数式接口的定义，那么这个接口就是函数式接口。</p><h1 id="自定义函数式接口"><a href="#自定义函数式接口" class="headerlink" title="自定义函数式接口"></a>自定义函数式接口</h1><p>按照下面的格式定义，你也能写出函数式接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line">修饰符 <span class="class"><span class="keyword">interface</span> 接口名称 </span>&#123;</span><br><span class="line">   返回值类型 方法名称(可选参数信息);</span><br><span class="line">   <span class="comment">// 其他非抽象方法内容</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>虽然@FunctionalInterface注解不是必须的，但是自定义函数式接口最好还是都加上，一是养成良好的编程习惯，二是防止他人修改，一看到这个注解就知道是函数式接口，避免他人往接口内添加抽象方法造成不必要的麻烦。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MyFunction</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(String s)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看上图是我自定义的一个函数式接口，那么这个接口的作用是什么呢？就是输出一串字符串，属于消费型接口，是模仿Consumer接口写的，只不过这个没有使用泛型，而是将参数具体类型化了，不知道Consumer没关系，下面会介绍到，其实java8中提供了很多常用的函数式接口，Consumer就是其中之一，一般情况下都不需要自己定义，直接使用就好了。那么怎么使用这个自定义的函数式接口呢？我们可以用函数式接口作为参数，调用时传递Lambda表达式。如果一个方法的参数是Lambda，那么这个参数的类型一定是函数式接口。例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFunctionTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String text = <span class="string">"试试自定义函数好使不"</span>;</span><br><span class="line">        printString(text, System.out::print);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printString</span><span class="params">(String text, MyFunction myFunction)</span> </span>&#123;</span><br><span class="line">        myFunction.print(text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行以后就会输出“试试自定义函数好使不”这句话，如果某天需求变了，我不想输出这句话了，想输出别的，那么直接替换text就好了。函数式编程是没有副作用的，最大的好处就是函数的内部是无状态的，既输入确定输出就确定。函数式编程还有更多好玩的套路，这就需要靠大家自己探索了。</p><h1 id="常用函数式接口"><a href="#常用函数式接口" class="headerlink" title="常用函数式接口"></a>常用函数式接口</h1><p>这几个接口都在 java.util.function </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Consumer&lt;T&gt;  消费型接口 消费对象</span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span></span>;</span><br><span class="line"></span><br><span class="line">Supplier&lt;T&gt;  供给型接口 生成对象</span><br><span class="line"> <span class="function">T <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">Predicate&lt;T&gt;  断言型接口 进行条件判断</span><br><span class="line"> <span class="function"><span class="keyword">boolean</span> <span class="title">test</span><span class="params">(T t)</span></span>;</span><br><span class="line"></span><br><span class="line">Function&lt;R,T&gt;  函数型接口 指定特定功能</span><br><span class="line"> <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</span><br></pre></td></tr></table></figure><p>那么，下面，我们从具体的应用场景来讲讲这个接口的用法！</p><h2 id="Consumer接口"><a href="#Consumer接口" class="headerlink" title="Consumer接口"></a>Consumer接口</h2><p>从字面意思上我们就可以看得出啦，consumer接口就是一个消费型的接口，通过传入参数，然后输出值，就是这么简单，Java8 的一些方法看起来很抽象，其实，只要你理解了就觉得很好用，并且非常的简单。<br>我们下面就先看一个例子，然后再来分析这个接口。</p><h3 id="Consumer实例"><a href="#Consumer实例" class="headerlink" title="Consumer实例"></a>Consumer实例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * consumer接口测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_Consumer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//① 使用consumer接口实现方法</span></span><br><span class="line">        Consumer&lt;String&gt; consumer = <span class="keyword">new</span> Consumer&lt;String&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                System.out.println(s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Stream&lt;String&gt; stream = Stream.of(<span class="string">"aaa"</span>, <span class="string">"bbb"</span>, <span class="string">"ddd"</span>, <span class="string">"ccc"</span>, <span class="string">"fff"</span>);</span><br><span class="line">        stream.forEach(consumer);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"********************"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//② 使用lambda表达式，forEach方法需要的就是一个Consumer接口</span></span><br><span class="line">        stream = Stream.of(<span class="string">"aaa"</span>, <span class="string">"bbb"</span>, <span class="string">"ddd"</span>, <span class="string">"ccc"</span>, <span class="string">"fff"</span>);</span><br><span class="line">        Consumer&lt;String&gt; consumer1 = (s) -&gt; System.out.println(s);<span class="comment">//lambda表达式返回的就是一个Consumer接口</span></span><br><span class="line">        stream.forEach(consumer1);</span><br><span class="line">        <span class="comment">//更直接的方式</span></span><br><span class="line">        <span class="comment">//stream.forEach((s) -&gt; System.out.println(s));</span></span><br><span class="line">        System.out.println(<span class="string">"********************"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//③ 使用方法引用，方法引用也是一个consumer</span></span><br><span class="line">        stream = Stream.of(<span class="string">"aaa"</span>, <span class="string">"bbb"</span>, <span class="string">"ddd"</span>, <span class="string">"ccc"</span>, <span class="string">"fff"</span>);</span><br><span class="line">        Consumer consumer2 = System.out::println;</span><br><span class="line">        stream.forEach(consumer);</span><br><span class="line">        <span class="comment">//更直接的方式</span></span><br><span class="line">        <span class="comment">//stream.forEach(System.out::println);</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>输出结果<br><img src="/images/2020/08/20200810112500.png" alt></p><h3 id="实例分析"><a href="#实例分析" class="headerlink" title="实例分析"></a>实例分析</h3><p>① consumer接口分析<br>在代码①中，我们直接创建 Consumer 接口，并且实现了一个名为 accept 的方法，这个方法就是这个接口的关键了。<br>我们看一下 accept  方法；这个方法传入一个参数，不返回值。当我们发现 forEach 需要一个 Consumer 类型的参数的时候，传入之后，就可以输出对应的值了。<br>② lambda 表达式作为 consumer</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Consumer&lt;String&gt; consumer1 = (s) -&gt; System.out.println(s);<span class="comment">//lambda表达式返回的就是一个Consumer接口</span></span><br></pre></td></tr></table></figure><p>在上面的代码中，我们使用下面的 lambda 表达式作为 Consumer。仔细的看一下你会发现，lambda 表达式返回值就是一个 Consumer；所以，你也就能够理解为什么 forEach 方法可以使用 lamdda 表达式作为参数了吧。<br>③ 方法引用作为 consumer</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Consumer consumer2 = System.out::println;</span><br></pre></td></tr></table></figure><p>在上面的代码中，我们用了一个方法引用的方式作为一个 Consumer ，同时也可以传给 forEach 方法。</p><h3 id="其他-Consumer-接口"><a href="#其他-Consumer-接口" class="headerlink" title="其他 Consumer 接口"></a>其他 Consumer 接口</h3><p>除了上面使用的 Consumer 接口，还可以使用下面这些 Consumer 接口。<br>IntConsumer、DoubleConsumer、LongConsumer、BiConsumer，使用方法和上面一样。</p><h3 id="Consumer-总结"><a href="#Consumer-总结" class="headerlink" title="Consumer 总结"></a>Consumer 总结</h3><p>看完上面的实例我们可以总结为几点。<br>① Consumer是一个接口，并且只要实现一个 accept 方法，就可以作为一个<strong>“消费者”</strong>输出信息。<br>② 其实，lambda 表达式、方法引用的返回值都是 Consumer 类型，所以，他们能够作为 forEach 方法的参数，并且输出一个值。</p><h2 id="Supplier-接口"><a href="#Supplier-接口" class="headerlink" title="Supplier 接口"></a>Supplier 接口</h2><p>Supplier 接口是一个供给型的接口，其实，说白了就是一个容器，可以用来存储数据，然后可以供其他方法使用的这么一个接口，是不是很明白了，如果还是不明白，看看下面的例子，一定彻底搞懂！</p><h3 id="Supplier实例"><a href="#Supplier实例" class="headerlink" title="Supplier实例"></a>Supplier实例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">**</span><br><span class="line">     * Supplier接口测试，supplier相当一个容器或者变量，可以存储值</span><br><span class="line">     */</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_Supplier</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//① 使用Supplier接口实现方法,只有一个get方法，无参数，返回一个值</span></span><br><span class="line">        Supplier&lt;Integer&gt; supplier = <span class="keyword">new</span> Supplier&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//返回一个随机值</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Random().nextInt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        System.out.println(supplier.get());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"********************"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//② 使用lambda表达式，</span></span><br><span class="line">        supplier = () -&gt; <span class="keyword">new</span> Random().nextInt();</span><br><span class="line">        System.out.println(supplier.get());</span><br><span class="line">        System.out.println(<span class="string">"********************"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//③ 使用方法引用</span></span><br><span class="line">        Supplier&lt;Double&gt; supplier2 = Math::random;</span><br><span class="line">        System.out.println(supplier2.get());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>输出结果<br><img src="/images/2020/08/20200810112639.png" alt></p><h3 id="实例分析-1"><a href="#实例分析-1" class="headerlink" title="实例分析"></a>实例分析</h3><p>① Supplier接口分析</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Supplier&lt;Integer&gt; supplier = <span class="keyword">new</span> Supplier&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//返回一个随机值</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Random().nextInt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure><p>看一下这段代码，我们通过创建一个 Supplier 对象，实现了一个 get 方法，这个方法无参数，返回一个值；所以，每次使用这个接口的时候都会返回一个值，并且保存在这个接口中，所以说是一个容器。</p><p>② lambda表达式作为 Supplier</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//② 使用lambda表达式，</span></span><br><span class="line">        supplier = () -&gt; <span class="keyword">new</span> Random().nextInt();</span><br><span class="line">        System.out.println(supplier.get());</span><br><span class="line">        System.out.println(<span class="string">"********************"</span>);</span><br></pre></td></tr></table></figure><p>上面的这段代码，我们使用 lambda 表达式返回一个 Supplier类型的接口，然后，我们调用 get 方法就可以获取这个值了。</p><p>③ 方法引用作为 Supplier</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//③ 使用方法引用</span></span><br><span class="line">        Supplier&lt;Double&gt; supplier2 = Math::random;</span><br><span class="line">        System.out.println(supplier2.get());</span><br></pre></td></tr></table></figure><h3 id="Supplier-实例2"><a href="#Supplier-实例2" class="headerlink" title="Supplier 实例2"></a>Supplier 实例2</h3><p>我们看完第一个实例之后，我们应该有一个了解了，下面再看一个。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Supplier接口测试2，使用需要Supplier的接口方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_Supplier2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Stream&lt;Integer&gt; stream = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">        <span class="comment">//返回一个optional对象</span></span><br><span class="line">        Optional&lt;Integer&gt; first = stream.filter(i -&gt; i &gt; <span class="number">4</span>)</span><br><span class="line">                .findFirst();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//optional对象有需要Supplier接口的方法</span></span><br><span class="line">        <span class="comment">//orElse，如果first中存在数，就返回这个数，如果不存在，就放回传入的数</span></span><br><span class="line">        System.out.println(first.orElse(<span class="number">1</span>));</span><br><span class="line">        System.out.println(first.orElse(<span class="number">7</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"********************"</span>);</span><br><span class="line"></span><br><span class="line">        Supplier&lt;Integer&gt; supplier = <span class="keyword">new</span> Supplier&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//返回一个随机值</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Random().nextInt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//orElseGet，如果first中存在数，就返回这个数，如果不存在，就返回supplier返回的值</span></span><br><span class="line">        System.out.println(first.orElseGet(supplier));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>输出结果<br><img src="/images/2020/08/20200810112758.png" alt></p><p>代码分析</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Integer&gt; first = stream.filter(i -&gt; i &gt; <span class="number">4</span>).findFirst();</span><br></pre></td></tr></table></figure><p>使用这个方法获取到一个 Optional 对象，然后，在 Optional 对象中有 orElse 方法 和 orElseGet 是需要一个 Supplier 接口的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//optional对象有需要Supplier接口的方法</span></span><br><span class="line">        <span class="comment">//orElse，如果first中存在数，就返回这个数，如果不存在，就放回传入的数</span></span><br><span class="line">        System.out.println(first.orElse(<span class="number">1</span>));</span><br><span class="line">        System.out.println(first.orElse(<span class="number">7</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"********************"</span>);</span><br><span class="line"></span><br><span class="line">        Supplier&lt;Integer&gt; supplier = <span class="keyword">new</span> Supplier&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//返回一个随机值</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Random().nextInt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//orElseGet，如果first中存在数，就返回这个数，如果不存在，就返回supplier返回的值</span></span><br><span class="line">        System.out.println(first.orElseGet(supplier));</span><br></pre></td></tr></table></figure><ul><li>orElse：如果first中存在数，就返回这个数，如果不存在，就放回传入的数</li><li>orElseGet：如果first中存在数，就返回这个数，如果不存在，就返回supplier返回的值</li></ul><h3 id="其他-Supplier-接口"><a href="#其他-Supplier-接口" class="headerlink" title="其他 Supplier 接口"></a>其他 Supplier 接口</h3><p>除了上面使用的 Supplier 接口，还可以使用下面这些 Supplier 接口。<br>IntSupplier 、DoubleSupplier 、LongSupplier 、BooleanSupplier，使用方法和上面一样。</p><h3 id="Supplier-总结"><a href="#Supplier-总结" class="headerlink" title="Supplier 总结"></a>Supplier 总结</h3><p>① Supplier 接口可以理解为一个容器，用于装数据的。<br>② Supplier 接口有一个 get 方法，可以返回值。</p><h2 id="Predicate-接口"><a href="#Predicate-接口" class="headerlink" title="Predicate 接口"></a>Predicate 接口</h2><p>Predicate 接口是一个断言型接口(谓词型接口)，其实，这个就是一个类似于 bool 类型的判断的接口，后面看看就明白了。</p><h3 id="Predicate-实例"><a href="#Predicate-实例" class="headerlink" title="Predicate 实例"></a>Predicate 实例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Predicate谓词测试，谓词其实就是一个判断的作用类似bool的作用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_Predicate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//① 使用Predicate接口实现方法,只有一个test方法，传入一个参数，返回一个bool值</span></span><br><span class="line">        Predicate&lt;Integer&gt; predicate = <span class="keyword">new</span> Predicate&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(Integer integer)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(integer &gt; <span class="number">5</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        System.out.println(predicate.test(<span class="number">6</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"********************"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//② 使用lambda表达式，</span></span><br><span class="line">        predicate = (t) -&gt; t &gt; <span class="number">5</span>;</span><br><span class="line">        System.out.println(predicate.test(<span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">"********************"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>输出结果<br><img src="/images/2020/08/20200810112936.png" alt></p><h3 id="实例分析-2"><a href="#实例分析-2" class="headerlink" title="实例分析"></a>实例分析</h3><p>① Predicate 接口分析</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//① 使用Predicate接口实现方法,只有一个test方法，传入一个参数，返回一个bool值</span></span><br><span class="line">        Predicate&lt;Integer&gt; predicate = <span class="keyword">new</span> Predicate&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(Integer integer)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(integer &gt; <span class="number">5</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure><p>这段代码中，创建了一个 Predicate 接口对象，其中，实现类 test 方法，需要传入一个参数，并且返回一个 bool 值，所以这个接口作用就是判断！</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(predicate.test(<span class="number">6</span>));</span><br></pre></td></tr></table></figure><p>再看，调用 test 方法，传入一个值，就会返回一个 bool 值。</p><p>② 使用lambda表达式作为 predicate</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//② 使用lambda表达式，</span></span><br><span class="line">        predicate = (t) -&gt; t &gt; <span class="number">5</span>;</span><br><span class="line">        System.out.println(predicate.test(<span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">"********************"</span>);</span><br></pre></td></tr></table></figure><p>lambda 表达式返回一个 Predicate 接口，然后调用 test 方法！</p><h3 id="Predicate-接口实例2"><a href="#Predicate-接口实例2" class="headerlink" title="Predicate 接口实例2"></a>Predicate 接口实例2</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Predicate谓词测试，Predicate作为接口使用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_Predicate2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//① 将Predicate作为filter接口，Predicate起到一个判断的作用</span></span><br><span class="line">        Predicate&lt;Integer&gt; predicate = <span class="keyword">new</span> Predicate&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(Integer integer)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(integer &gt; <span class="number">5</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Stream&lt;Integer&gt; stream = Stream.of(<span class="number">1</span>, <span class="number">23</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">56</span>, <span class="number">6</span>, <span class="number">6</span>);</span><br><span class="line">        List&lt;Integer&gt; list = stream.filter(predicate).collect(Collectors.toList());</span><br><span class="line">        list.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"********************"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>输出结果<br><img src="/images/2020/08/20200810113048.png" alt><br>这段代码，首先创建一个 Predicate 对象，然后实现 test 方法，在 test 方法中做一个判断：如果传入的参数大于 5 ，就返回 true，否则返回 false；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;Integer&gt; stream = Stream.of(<span class="number">1</span>, <span class="number">23</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">56</span>, <span class="number">6</span>, <span class="number">6</span>);</span><br><span class="line">        List&lt;Integer&gt; list = stream.filter(predicate).collect(Collectors.toList());</span><br><span class="line">        list.forEach(System.out::println);</span><br></pre></td></tr></table></figure><p>这段代码调用 Stream 的 filter 方法，filter 方法需要的参数就是 Predicate 接口，所以在这里只要大于 5 的数据就会输出。</p><h3 id="Predicate-接口总结"><a href="#Predicate-接口总结" class="headerlink" title="Predicate 接口总结"></a>Predicate 接口总结</h3><p>① Predicate 是一个谓词型接口，其实只是起到一个判断作用。<br>② Predicate 通过实现一个 test 方法做判断。</p><h2 id="Function-接口"><a href="#Function-接口" class="headerlink" title="Function 接口"></a>Function 接口</h2><p>Function 接口是一个功能型接口，它的一个作用就是转换作用，将输入数据转换成另一种形式的输出数据。</p><h3 id="Function-接口实例"><a href="#Function-接口实例" class="headerlink" title="Function 接口实例"></a>Function 接口实例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Function测试，function的作用是转换，将一个值转为另外一个值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_Function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//① 使用map方法，泛型的第一个参数是转换前的类型，第二个是转化后的类型</span></span><br><span class="line">        Function&lt;String, Integer&gt; function = <span class="keyword">new</span> Function&lt;String, Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">apply</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> s.length();<span class="comment">//获取每个字符串的长度，并且返回</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Stream&lt;String&gt; stream = Stream.of(<span class="string">"aaa"</span>, <span class="string">"bbbbb"</span>, <span class="string">"ccccccv"</span>);</span><br><span class="line">        Stream&lt;Integer&gt; stream1 = stream.map(function);</span><br><span class="line">        stream1.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"********************"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>输出结果<br><img src="/images/2020/08/20200810113145.png" alt></p><h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><p>① Function 接口分析</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//① 使用map方法，泛型的第一个参数是转换前的类型，第二个是转化后的类型</span></span><br><span class="line">        Function&lt;String, Integer&gt; function = <span class="keyword">new</span> Function&lt;String, Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">apply</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> s.length();<span class="comment">//获取每个字符串的长度，并且返回</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure><p>这段代码创建了一个 Function 接口对象，实现了一个 apply 方法，这个方法有一个输入参数和一个输出参数。其中，泛型的第一个参数是转换前的类型，第二个是转化后的类型。<br>在上面的代码中，就是获取字符串的长度，然后将每个字符串的长度作为返回值返回。<br>② 重要应用 map 方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Stream&lt;String&gt; stream = Stream.of(<span class="string">"aaa"</span>, <span class="string">"bbbbb"</span>, <span class="string">"ccccccv"</span>);</span><br><span class="line">       Stream&lt;Integer&gt; stream1 = stream.map(function);</span><br><span class="line">       stream1.forEach(System.out::println);</span><br></pre></td></tr></table></figure><p>在 Function 接口的重要应用不得不说 Stream 类的 map 方法了，map 方法传入一个 Function 接口，返回一个转换后的 Stream类。</p><h3 id="其他-Function-接口"><a href="#其他-Function-接口" class="headerlink" title="其他 Function 接口"></a>其他 Function 接口</h3><p>除了上面使用的 Function 接口，还可以使用下面这些 Function 接口。<br>IntFunction 、DoubleFunction 、LongFunction 、ToIntFunction 、ToDoubleFunction 、DoubleToIntFunction 等等，使用方法和上面一样。</p><h3 id="Function-接口总结"><a href="#Function-接口总结" class="headerlink" title="Function 接口总结"></a>Function 接口总结</h3><p>① Function 接口是一个功能型接口，是一个转换数据的作用。<br>② Function 接口实现 apply 方法来做转换。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>通过前面的介绍，已经对Consumer、Supplier、Predicate、Function这几个接口有详细的了解了，其实，这几个接口并不是很难，只是有点抽象，多加理解会发现很简单，并且特别好用！</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://juejin.im/post/6844903904837107720" target="_blank" rel="noopener">Java8之Consumer、Supplier、Predicate和Function攻略</a></li><li><a href="https://cloud.tencent.com/developer/article/1637128" target="_blank" rel="noopener">Java8-Lambda表达式-函数式接口</a></li><li><a href="https://juejin.im/post/6844903892166148110" target="_blank" rel="noopener">「Java8系列」神奇的函数式接口</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis配置文件详解</title>
      <link href="/2019/08/01/MyBatis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/"/>
      <url>/2019/08/01/MyBatis%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  <a href="http://www.mybatis.org/mybatis-3/zh/configuration.html#properties" target="_blank" rel="noopener"><em>参考:mybatis配置文件详解</em></a></p></blockquote><p>挑几个比较重要的说</p><h1 id="属性加载properties"><a href="#属性加载properties" class="headerlink" title="属性加载properties"></a>属性加载properties</h1><p>这些属性都是<code>可外部配置</code>且<code>可动态替换</code>的，既可以在典型的 Java 属性文件中配置，亦可通过 properties 元素的子元素来传递。例如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 先加载内部标签,后加载外部文件,名称一致时,外部会覆盖内部 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"org/mybatis/example/config.properties"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"dev_user"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"F2Fa3!33TYyg"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后其中的属性就可以在整个配置文件中被用来替换需要动态配置的属性值。比如:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个例子中的 username 和 password 将会由 properties 元素中设置的相应值来替换</p><h1 id="别名配置"><a href="#别名配置" class="headerlink" title="别名配置"></a>别名配置</h1><p>类型别名是为 Java 类型设置一个短的名字。 它只和 XML 配置有关，存在的意义仅在于用来减少类完全限定名的冗余</p><h2 id="单个别名定义"><a href="#单个别名定义" class="headerlink" title="单个别名定义"></a>单个别名定义</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Author"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Author"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Blog"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Blog"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>当这样配置时，Blog 可以用在任何使用 domain.blog.Blog 的地方。<br>具体在代码中的体现<br><img src="/images/20190731019.png" alt></p><h2 id="指定包名定义"><a href="#指定包名定义" class="headerlink" title="指定包名定义"></a>指定包名定义</h2><p>也可以指定一个包名，MyBatis 会在包名下面搜索需要的 Java Bean，比如：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"domain.blog"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure><p>具体在代码中的体现<br><img src="/images/20190731023.png" alt></p><h1 id="映射器"><a href="#映射器" class="headerlink" title="映射器"></a>映射器</h1><p>Mapper配置的几种方法：<br>第一种（常用）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">" "</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>resource指向的是相对于类路径下的目录<br>如：<code>&lt;mapper resource=&quot;sqlmap/User.xml&quot; /&gt;</code></p><p>第二种</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">" "</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>使用完全限定路径<br>如：<code>&lt;mapper url=&quot;file:///D:\workspace\mybatis1\config\sqlmap\User.xml&quot; /&gt;</code></p><p>第三种</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">" "</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>使用mapper接口类路径<br>如：<code>&lt;mapper class=&quot;cn.kang.mapper.UserMapper&quot;/&gt;</code><br>注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。</p><p>第四种（推荐）</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">""</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>注册指定包下的所有mapper接口<br>如：<code>&lt;package name=&quot;cn.kang.mapper&quot;/&gt;</code><br>注意：此种方法要求mapper接口名称和mapper映射文件名称相同，且放在同一个目录中。</p><p>使用示例：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"sqlmap/User.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"cn.kang.mapper"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis中的DAO包装</title>
      <link href="/2019/08/01/MyBatis%E4%B8%AD%E7%9A%84DAO%E5%8C%85%E8%A3%85/"/>
      <url>/2019/08/01/MyBatis%E4%B8%AD%E7%9A%84DAO%E5%8C%85%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<h1 id="传统的DAO包装"><a href="#传统的DAO包装" class="headerlink" title="传统的DAO包装"></a>传统的DAO包装</h1><h2 id="项目基本代码"><a href="#项目基本代码" class="headerlink" title="项目基本代码"></a>项目基本代码</h2><p><a href="/2019/08/01/MyBatis工程搭建与增删改查/#入门案例"><em>MyBatis工程搭建与增删改查</em></a></p><h2 id="实现传统的DAO包装"><a href="#实现传统的DAO包装" class="headerlink" title="实现传统的DAO包装"></a>实现传统的DAO包装</h2><p>项目文件基本结构<br><img src="/images/20190731017.png" alt></p><ol><li><p>UserDao.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.mybatis.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">//根据用户id查询用户信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    <span class="comment">//根据用户名称查找用户信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">    <span class="comment">//添加用户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>UserDaoImpl.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.CoreMatchers.nullValue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.mybatis.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.mybatis.utils.MyBatisUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        SqlSession sqlSession = MyBatisUtil.getSession();</span><br><span class="line">        User user = sqlSession.selectOne(<span class="string">"user.getUserById"</span>, id);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserByUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">    SqlSession sqlSession = MyBatisUtil.getSession();</span><br><span class="line">        List&lt;User&gt; list = sqlSession.selectList(<span class="string">"user.getUserByUsername"</span>,username);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    SqlSession sqlSession = MyBatisUtil.getSession();</span><br><span class="line">        sqlSession.insert(<span class="string">"user.insertUser"</span>, user);</span><br><span class="line">        sqlSession.commit();</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>UserDaoTest.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.mybatis.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.mybatis.dao.UserDaoImpl;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.mybatis.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        UserDao userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line">        User user = userDao.getUserById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserByUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        UserDao userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line">        List&lt;User&gt; list = userDao.getUserByUsername(<span class="string">"张"</span>);</span><br><span class="line">        <span class="keyword">for</span> (User user : list) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsertUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        UserDao userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUsername(<span class="string">"白鸽"</span>);</span><br><span class="line">        user.setSex(<span class="string">"2"</span>);</span><br><span class="line">        user.setAddress(<span class="string">"天津"</span>);</span><br><span class="line">        userDao.insertUser(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="动态代理DAO包装"><a href="#动态代理DAO包装" class="headerlink" title="动态代理DAO包装"></a>动态代理DAO包装</h1><h2 id="项目基本代码-1"><a href="#项目基本代码-1" class="headerlink" title="项目基本代码"></a>项目基本代码</h2><p><a href="/2019/08/01/MyBatis工程搭建与增删改查/#入门案例"><em>MyBatis工程搭建与增删改查</em></a></p><h2 id="实现动态代理DAO包装"><a href="#实现动态代理DAO包装" class="headerlink" title="实现动态代理DAO包装"></a>实现动态代理DAO包装</h2><p>动态代理只需使用接口，不需使用实现接口的实体类</p><ol><li><p>UserMapper.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.mybatis.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line"><span class="comment">// 根据用户id查询用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUserById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据用户名称查找用户信息</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加用户</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>UserMapper.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" </span></span><br><span class="line"><span class="meta">    "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- namespace 命名空间，用于隔离sql语句，后继有重要作用 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">      在动态代理中：</span></span><br><span class="line"><span class="comment">      1.命名空间的值必须是接口的全路径名 如：com.zjinc36.mybatis.mapper.UserMapper</span></span><br><span class="line"><span class="comment">      2.接口的方法名必须与sql id   一致。如select标签下的id属性必须与UserMapper接口的对应方法名一致</span></span><br><span class="line"><span class="comment">      3.接口的入参 必须与 sql parameterType的类型一致。</span></span><br><span class="line"><span class="comment">      4.接口的返回值必须与sql resultType的类型一致</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.zjinc36.mybatis.mapper.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">        在select标签中编写查询的SQL语句， 设置select标签的id属性为getUserById，id属性值必须是唯一的，不能够重复</span></span><br><span class="line"><span class="comment">        使用parameterType属性指明查询时使用的参数类型，resultType属性指明查询返回的结果集类型</span></span><br><span class="line"><span class="comment">        resultType="com.wuhaitao.mybatis.demo1.User"就表示将查询结果封装成一个User类的对象返回</span></span><br><span class="line"><span class="comment">        User类就是cst_customer表所对应的实体类</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"com.zjinc36.mybatis.pojo.User"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 查询语句这么写是因为，再查询时大量数据时可以节省很多时间 ，在参数上使用' #&#123;&#125;' 来表示 相当于JDBC的？号--&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            `user`.id,</span><br><span class="line">            `user`.username,</span><br><span class="line">            `user`.birthday,</span><br><span class="line">            `user`.sex,</span><br><span class="line">            `user`.address</span><br><span class="line">        FROM `user`</span><br><span class="line">        WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserByUsername"</span> <span class="attr">parameterType</span>=<span class="string">"string"</span> <span class="attr">resultType</span>=<span class="string">"com.zjinc36.mybatis.pojo.User"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 查询语句这么写是因为，再查询时大量数据时可以节省很多时间 ，在参数上使用' #&#123;&#125;' 来表示 相当于JDBC的？号--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- $&#123;&#125; 当参数类型为普通类型时 ，其值只能为value --&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">            `user`.id,</span><br><span class="line">            `user`.username,</span><br><span class="line">            `user`.birthday,</span><br><span class="line">            `user`.sex,</span><br><span class="line">            `user`.address</span><br><span class="line">        FROM `user`</span><br><span class="line">        <span class="comment">&lt;!-- WHERE username LIKE '%$&#123;value&#125;%' --&gt;</span></span><br><span class="line">        WHERE username LIKE '%$&#123;value&#125;%'</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 插入用户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"com.zjinc36.mybatis.pojo.User"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- keyProperty指User中的主键属性 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- resultTYype  主键数据类型 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- order  何时执行 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;selectKey keyProperty="id" resultType="int" order="AFTER"&gt;</span></span><br><span class="line"><span class="comment">            SELECT LAST_INSERT_ID()</span></span><br><span class="line"><span class="comment">        &lt;/selectKey&gt; --&gt;</span></span><br><span class="line">        INSERT INTO `user` (`username`,`birthday`, `sex`, `address`) VALUES (#&#123;username&#125;,#&#123;birthday&#125;, #&#123;sex&#125;, #&#123;address&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>SqlMapConfig.xml中将UserMapper.xml引入</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 加载映射文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"mybatis/UserMapper.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>测试UserMapperTest.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.mybatis.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.mybatis.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.mybatis.utils.MyBatisUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserMapperTest</span> </span>&#123;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">SqlSession sqlSession = MyBatisUtil.getSession();</span><br><span class="line"><span class="comment">// 获取接口的代理实现类，由getMapper()实现</span></span><br><span class="line">UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">User user = userMapper.getUserById(<span class="number">1</span>);</span><br><span class="line">System.out.println(user);</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserByUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">SqlSession sqlSession = MyBatisUtil.getSession();</span><br><span class="line">UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">List&lt;User&gt; list = userMapper.getUserByUsername(<span class="string">"白"</span>);</span><br><span class="line"><span class="keyword">for</span> (User user : list) &#123;</span><br><span class="line">System.out.println(user);</span><br><span class="line">&#125;</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsertUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">SqlSession sqlSession = MyBatisUtil.getSession();</span><br><span class="line">UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setUsername(<span class="string">"白灵涵"</span>);</span><br><span class="line">user.setSex(<span class="string">"2"</span>);</span><br><span class="line">user.setAddress(<span class="string">"河南"</span>);</span><br><span class="line">userMapper.insertUser(user);</span><br><span class="line">sqlSession.commit();</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis架构</title>
      <link href="/2019/08/01/MyBatis%E6%9E%B6%E6%9E%84/"/>
      <url>/2019/08/01/MyBatis%E6%9E%B6%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<p><img src="/images/20190731016.png" alt><br><img src="/images/20190731015.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis工程搭建与增删改查</title>
      <link href="/2019/08/01/MyBatis%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/"/>
      <url>/2019/08/01/MyBatis%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  基于maven创建工程</p></blockquote><h1 id="使用maven创建web工程"><a href="#使用maven创建web工程" class="headerlink" title="使用maven创建web工程"></a>使用maven创建web工程</h1><p><a href="/2019/07/31/eclipse创建maven工程/"><em>Eclipse创建maven工程</em></a></p><h1 id="引入MyBatis需要的依赖"><a href="#引入MyBatis需要的依赖" class="headerlink" title="引入MyBatis需要的依赖"></a>引入MyBatis需要的依赖</h1><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zjinc36<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>DemoMyBaits<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">encoding</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 属性配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 添加MyBatis依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-nop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.45<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h1><p><a href="https://blog.csdn.net/yuguiyang1990/article/details/8801158" target="_blank" rel="noopener"><em>参考:Maven学习（八）- 构建MyBatis项目</em></a></p><p>项目基本结构<br><img src="/images/20190731014.png" alt></p><h2 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h2><p>log4j.properties</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">### direct log messages to stdout ###</span><br><span class="line">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.Target=System.err</span><br><span class="line">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern=%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span><br><span class="line"></span><br><span class="line">### direct messages to file mylog.log ###</span><br><span class="line">log4j.appender.file=org.apache.log4j.FileAppender</span><br><span class="line">log4j.appender.file.File=/home/zjc/Log</span><br><span class="line">log4j.appender.file.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.file.layout.ConversionPattern=%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span><br><span class="line"></span><br><span class="line">### set log levels - for more verbose logging change &apos;info&apos; to &apos;debug&apos; ###</span><br><span class="line"></span><br><span class="line">log4j.rootLogger=info, stdout</span><br></pre></td></tr></table></figure><h2 id="建表语句"><a href="#建表语句" class="headerlink" title="建表语句"></a>建表语句</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="string">`user`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="literal">null</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line"><span class="string">`birthday`</span> <span class="built_in">date</span> <span class="keyword">default</span> <span class="literal">null</span>,</span><br><span class="line"><span class="string">`sex`</span> <span class="built_in">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="literal">null</span>,</span><br><span class="line"><span class="string">`address`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">default</span> <span class="literal">null</span>,</span><br><span class="line">primary <span class="keyword">key</span>(<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="string">`order`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="literal">null</span> AUTO_INCREMENT,</span><br><span class="line"><span class="string">`user_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line"><span class="string">`number`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">default</span> <span class="literal">null</span>,</span><br><span class="line"><span class="string">`createtime`</span> <span class="built_in">date</span> <span class="keyword">default</span> <span class="literal">null</span>,</span><br><span class="line"><span class="string">`note`</span> <span class="built_in">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="literal">null</span>,</span><br><span class="line">primary <span class="keyword">key</span>(<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8</span><br></pre></td></tr></table></figure><h2 id="表对应的类"><a href="#表对应的类" class="headerlink" title="表对应的类"></a>表对应的类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//User.java</span></span><br><span class="line"><span class="keyword">package</span> com.zjinc36.mybatis.pojo;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *`id` int(11) not null AUTO_INCREMENT,</span></span><br><span class="line"><span class="comment">`username` varchar(32) not null,</span></span><br><span class="line"><span class="comment">`birthday` date default null,</span></span><br><span class="line"><span class="comment">`sex` char(1) default null,</span></span><br><span class="line"><span class="comment">`address` varchar(256) default null,</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Long id;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String birthday;</span><br><span class="line"><span class="keyword">private</span> String sex;</span><br><span class="line"><span class="keyword">private</span> String address;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.username = username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> birthday;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(String birthday)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> sex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(String sex)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.sex = sex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> address;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.address = address;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"User [id="</span> + id + <span class="string">", username="</span> + username + <span class="string">", birthday="</span></span><br><span class="line">+ birthday + <span class="string">", sex="</span> + sex + <span class="string">", address="</span> + address + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">//Order.java</span><br><span class="line">package com.zjinc36.mybatis.pojo;</span><br><span class="line">/**</span><br><span class="line"> * </span><br><span class="line"> * @author zjc</span><br><span class="line"> *`id` int(11) not null AUTO_INCREMENT,</span><br><span class="line">`user_id` int(11) not null,</span><br><span class="line">`number` varchar(256) default null,</span><br><span class="line">`createtime` date default null,</span><br><span class="line">`note` char(1) default null,</span><br><span class="line"> */</span><br><span class="line">public class Order &#123;</span><br><span class="line">private Long id;</span><br><span class="line">private Long user_id;</span><br><span class="line">private String number;</span><br><span class="line">private String createtime;</span><br><span class="line">private String note;</span><br><span class="line">public Long getId() &#123;</span><br><span class="line">return id;</span><br><span class="line">&#125;</span><br><span class="line">public void setId(Long id) &#123;</span><br><span class="line">this.id = id;</span><br><span class="line">&#125;</span><br><span class="line">public Long getUser_id() &#123;</span><br><span class="line">return user_id;</span><br><span class="line">&#125;</span><br><span class="line">public void setUser_id(Long user_id) &#123;</span><br><span class="line">this.user_id = user_id;</span><br><span class="line">&#125;</span><br><span class="line">public String getNumber() &#123;</span><br><span class="line">return number;</span><br><span class="line">&#125;</span><br><span class="line">public void setNumber(String number) &#123;</span><br><span class="line">this.number = number;</span><br><span class="line">&#125;</span><br><span class="line">public String getCreatetime() &#123;</span><br><span class="line">return createtime;</span><br><span class="line">&#125;</span><br><span class="line">public void setCreatetime(String createtime) &#123;</span><br><span class="line">this.createtime = createtime;</span><br><span class="line">&#125;</span><br><span class="line">public String getNote() &#123;</span><br><span class="line">return note;</span><br><span class="line">&#125;</span><br><span class="line">public void setNote(String note) &#123;</span><br><span class="line">this.note = note;</span><br><span class="line">&#125;</span><br><span class="line">@Override</span><br><span class="line">public String toString() &#123;</span><br><span class="line">return &quot;Order [id=&quot; + id + &quot;, user_id=&quot; + user_id + &quot;, number=&quot; + number</span><br><span class="line">+ &quot;, createtime=&quot; + createtime + &quot;, note=&quot; + note + &quot;]&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="将表和对应类连接起来"><a href="#将表和对应类连接起来" class="headerlink" title="将表和对应类连接起来"></a>将表和对应类连接起来</h2><p>SqlMapConfig.xml<br>用以配置数据库连接池和加载映射文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 和spring整合后,environments将废除 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 可以配置多个连接池,主要用于开发环境和测试环境 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用jdbc事务管理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 数据库连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span></span></span><br><span class="line"><span class="tag"><span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span></span></span><br><span class="line"><span class="tag"><span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 加载映射文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"mybatis/user.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>映射文件,用以写查表语句,也就是指定用哪个SQL语句查哪个类</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 查询所有用户 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserById"</span> <span class="attr">resultType</span>=<span class="string">"com.zjinc36.mybatis.pojo.User"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">select * from user where id=#&#123;id2&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="调用查表语句"><a href="#调用查表语句" class="headerlink" title="调用查表语句"></a>调用查表语句</h2><p>需要一个SqlSessionFactory对象,用来连接数据库,并用以使用xml形式的查表语句</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.mybatis.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisUtil</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory factory = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initialFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">String resource = <span class="string">"SqlMapConfig.xml"</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">InputStream in = Resources.getResourceAsStream(resource);</span><br><span class="line">factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">getSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(factory == <span class="keyword">null</span>) &#123;</span><br><span class="line">initialFactory();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> factory.openSession();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体调用写在xml映射文件中的查表语句</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.mybatis.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.mybatis.utils.MyBatisUtil;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getUserById</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">SqlSession session = MyBatisUtil.getSession();</span><br><span class="line">User user = session.selectOne(<span class="string">"user.getUserById"</span>, <span class="number">1</span>);</span><br><span class="line">System.out.println(user);</span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.server.Demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDemo1</span> </span>&#123;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Demo1 demo1 = <span class="keyword">new</span> Demo1();</span><br><span class="line">demo1.getUserById();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="增删改查操作"><a href="#增删改查操作" class="headerlink" title="增删改查操作"></a>增删改查操作</h1><p><a href="https://blog.csdn.net/wanlong360599336/article/details/71172060" target="_blank" rel="noopener"><em>参考: mybatis系列一：mybatis实现增删改查</em></a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
            <tag> MyBatis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven的工程拆分与聚合</title>
      <link href="/2019/07/31/maven%E7%9A%84%E5%B7%A5%E7%A8%8B%E6%8B%86%E5%88%86%E4%B8%8E%E8%81%9A%E5%90%88/"/>
      <url>/2019/07/31/maven%E7%9A%84%E5%B7%A5%E7%A8%8B%E6%8B%86%E5%88%86%E4%B8%8E%E8%81%9A%E5%90%88/</url>
      
        <content type="html"><![CDATA[<h1 id="工程的拆分与聚合"><a href="#工程的拆分与聚合" class="headerlink" title="工程的拆分与聚合"></a>工程的拆分与聚合</h1><p>我们项目拆分成多个子模块之后,独立运行各个模块是无法完成软件项目的要求的,只有把它们整合起来,分工合作才能完成工作,因此需要父工程来管理各个自摸块,把它们聚合在一起</p><h1 id="继承的理解"><a href="#继承的理解" class="headerlink" title="继承的理解"></a>继承的理解</h1><p>类似java的类,都是为了消除重复,父类里有的方法和属性在子类中就不需要再定义和实现了,使用的时候直接调用父类就可以了<br>我们把工程拆分之后,有一个父工程,子工程要用到的依赖都可以在父工程的pom.xml先定义好,将来子工程开发的时候,就不需要再引坐标了</p><h1 id="具体拆分实例"><a href="#具体拆分实例" class="headerlink" title="具体拆分实例"></a>具体拆分实例</h1><p><a href="https://blog.csdn.net/Marvel__Dead/article/details/72601172" target="_blank" rel="noopener"><em>转载:通过maven对项目进行拆分、聚合</em></a></p><p>对现在已有maven ssh项目进行拆分，拆分思路：将dao层的代码已经配置文件全体提取出来到一个表现上独立的工程中。同样service、action拆分。</p><p>需要创建：</p><blockquote><ul><li>ssh-parent: 父工程</li><li>ssh-dao:（子模块）</li><li>ssh-service:（子模块）</li><li>ssh-web:（子模块）</li></ul></blockquote><p>拆分完成对拆分后的项目进行聚合，提出概念父工程</p><h2 id="创建父工程"><a href="#创建父工程" class="headerlink" title="创建父工程"></a>创建父工程</h2><ol><li><p>创建父工程<br><img src="/images/20190731002.png" alt><br>父项目用pom<br><img src="/images/20190731003.png" alt></p></li><li><p>创建好父工程目录结构<br><img src="/images/20190731004.png" alt><br>只有pom.xml，可以推断父工程不进行编码</p></li><li><p>父工程要做的事情：</p><blockquote><ul><li>项目需要的依赖的信息，在父工程中定义，子模块继承过来</li><li>将各个子模块聚合到一起</li></ul></blockquote></li><li><p>将创建父工程发布到本地仓库<br>如果不把父工程发布到本地仓库，那么，将来service、dao工程发布到本地仓库，会报错。因为它找不到依赖的父工程！！！</p></li></ol><h2 id="创建子模块ssh-dao"><a href="#创建子模块ssh-dao" class="headerlink" title="创建子模块ssh-dao"></a>创建子模块ssh-dao</h2><p>ssh-dao负责数据访问层：包含dao相关代码&amp;配置文件</p><p><img src="/images/20190731005.png" alt><br>子项目war(如果是web项目的话)和jar中选择<br><img src="/images/20190731006.png" alt></p><p>可以看到，Parent Project中GAV都有了信息，那是因为创建Maven Module时，是点在父工程上右键创建的。</p><p>将spring的配置文件拆分<br><img src="/images/20190731007.png" alt></p><p><strong>applicationContext-basic.xml</strong><br>项目基础的信息</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:jaxws</span>=<span class="string">"http://cxf.apache.org/jaxws"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:soap</span>=<span class="string">"http://cxf.apache.org/bindings/soap"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://cxf.apache.org/bindings/soap</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://cxf.apache.org/schemas/configuration/soap.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://cxf.apache.org/jaxws</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://cxf.apache.org/schemas/jaxws.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 加载属性文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:db.properties"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClass&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.jdbcUrl&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.user&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionFactory"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.LocalSessionFactoryBean"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocations"</span> <span class="attr">value</span>=<span class="string">"classpath:hibernate.cfg.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.HibernateTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- xml方式管理事务 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置通知：具体增强逻辑 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 匹配业务类中方法名称 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"save*"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"delete*"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"*"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置aop --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置切点：具体哪些方法要增强（真正被增强的方法）--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* cn.itcast.service.*.*(..))"</span> <span class="attr">id</span>=<span class="string">"cut"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置切面：将增强逻辑作用到切点  （通知+切入点） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"cut"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- xml方式管理事务 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 注解方式管理事务 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1、开启注解驱动 2、在service类上或者方法上使用注解@Transactional--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;tx:annotation-driven transaction-manager="transactionManager"/&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注解方式管理事务 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>applicationContext-dao.xml</strong><br>dao层bean对象</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:jaxws</span>=<span class="string">"http://cxf.apache.org/jaxws"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:soap</span>=<span class="string">"http://cxf.apache.org/bindings/soap"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://cxf.apache.org/bindings/soap</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://cxf.apache.org/schemas/configuration/soap.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://cxf.apache.org/jaxws</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://cxf.apache.org/schemas/jaxws.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置dao对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customerDao"</span> <span class="attr">class</span>=<span class="string">"cn.itcast.dao.impl.CustomerDaoImpl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="创建子模块ssh-service"><a href="#创建子模块ssh-service" class="headerlink" title="创建子模块ssh-service"></a>创建子模块ssh-service</h2><p><img src="/images/20190731008.png" alt><br>子项目war(如果是web项目的话)和jar中选择<br><img src="/images/20190731009.png" alt></p><p><strong>applicationContext-service.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:jaxws</span>=<span class="string">"http://cxf.apache.org/jaxws"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:soap</span>=<span class="string">"http://cxf.apache.org/bindings/soap"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://cxf.apache.org/bindings/soap</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://cxf.apache.org/schemas/configuration/soap.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://cxf.apache.org/jaxws</span></span></span><br><span class="line"><span class="tag"><span class="string">                        http://cxf.apache.org/schemas/jaxws.xsd"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置service对象 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customerService"</span> <span class="attr">class</span>=<span class="string">"cn.itcast.service.impl.CustomerServiceImpl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"customerDao"</span> <span class="attr">ref</span>=<span class="string">"customerDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>service层的pom.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>01_maven_parent-ssh<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ssh-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ssh-dao<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>将ssh-dao工程打包到本地仓库(打包用install)；<br>在service工程pom.xml文件添加ssh-dao的依赖</p><h2 id="创建子模块ssh-web：war"><a href="#创建子模块ssh-web：war" class="headerlink" title="创建子模块ssh-web：war"></a>创建子模块ssh-web：war</h2><p><img src="/images/20190731010.png" alt><br>子项目war(如果是web项目的话)和jar中选择</p><p>在ssh-web项目中添加service工程依赖。pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>01_maven_parent-ssh<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ssh-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.itcast<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ssh-service<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>web.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>01_maven_ssh<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置Struts核心过滤器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置监听器：默认加载WEB-INF/applicationContext.xml --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通过上下文参数指定spring配置文件路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath*:spring/applicationContext-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/images/20190731011.png" alt></p><h2 id="运行方式"><a href="#运行方式" class="headerlink" title="运行方式"></a>运行方式</h2><ol><li><p>Maven方式<br>方式1：运行父工程(tomcat:run)。父工程会自动将各个子模块聚合到一起。将ssh-web打war包发布到tomcat<br>方式2：直接运行web工程(tomcat:run)</p></li><li><p>其他方式<br>部署到tomcat</p></li></ol><h1 id="maven如何处理重复引用依赖"><a href="#maven如何处理重复引用依赖" class="headerlink" title="maven如何处理重复引用依赖"></a>maven如何处理重复引用依赖</h1><p><a href="https://blog.csdn.net/z1143709608/article/details/89974902" target="_blank" rel="noopener"><em>转载:maven的依赖原则</em></a></p><p>当一个项目中出现重复引用依赖jar包时，maven一般有如下三种原则处理jar</p><p>maven的依赖原则</p><h2 id="最短路径原则"><a href="#最短路径原则" class="headerlink" title="最短路径原则"></a>最短路径原则</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A -&gt; B -&gt; C -&gt; D(V1)</span><br><span class="line">F -&gt; G -&gt; D(V2)</span><br></pre></td></tr></table></figure><p>这个时候项目中就出现了两个版本的D，这时maven会采用最短路径原则，选择V2版本的D，因为V1版本的D是由A包间接依赖的，整个依赖路径长度为3，而V2版本的D是由F包间接依赖的，整个依赖路径长度为2。</p><h2 id="优先声明原则"><a href="#优先声明原则" class="headerlink" title="优先声明原则"></a>优先声明原则</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A -&gt; B -&gt; D(V1)</span><br><span class="line">F -&gt; G -&gt; D(V2)</span><br></pre></td></tr></table></figure><p>如果两个jar包版本路径深度相同，则使用优先声明的版本</p><h2 id="多次直引不同版本的jar时，使用最后声明的版本"><a href="#多次直引不同版本的jar时，使用最后声明的版本" class="headerlink" title="多次直引不同版本的jar时，使用最后声明的版本"></a>多次直引不同版本的jar时，使用最后声明的版本</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.17.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.20.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果再pom文件中，同时引用了如上两个版本，则会使用4.3.20.RELEASE版本</p><h1 id="依赖传递中的版本冲突问题"><a href="#依赖传递中的版本冲突问题" class="headerlink" title="依赖传递中的版本冲突问题"></a>依赖传递中的版本冲突问题</h1><p><a href="https://blog.csdn.net/qq_35568099/article/details/80433861" target="_blank" rel="noopener"><em>转载:Eclipse maven 解决jar包版本冲突</em></a></p><p>在使用maven进行项目依赖管理的时候，有时候会出现一种情况，多个不同的开源组件都依赖了另外一个组件，但是这个组件的版本却不一样，在maven依赖中就会看到两个版本不同的jar,通常我们可以根据实际情况排除其中一个,当然前提是这个版本没有太大的差异，兼容</p><h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><p>手工添加配置：在dependency标签里使用子标签exclusions，比如A组件使用了zookeeper 3.3.3的依赖包，B组件使用了zookeeper 3.3.6的依赖包，这时候我们要排除3.3.3这个版本可以这样做：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xxx<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>A<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p>通过eclipse的pom编辑工具：<br><img src="/images/20190731001.png" alt></p><p>另外也可以使用命令mvn project-info-reports:dependencies  查看项目依赖情况。</p><h1 id="依赖的传递范围-了解"><a href="#依赖的传递范围-了解" class="headerlink" title="依赖的传递范围(了解)"></a>依赖的传递范围(了解)</h1><p><img src="/images/20190731013.png" alt></p><h1 id="版本锁定"><a href="#版本锁定" class="headerlink" title="版本锁定"></a>版本锁定</h1><p>这样做的好处：统一管理项目的版本号，确保应用的各个项目的依赖和版本一致，才能保证测试的和发布的是相同的成果因此，在顶层pom中定义共同的依赖关系。同时可以避免在每个使用的子项目中都声明一个版本号，这样想升级或者切换到另一个版本时，只需要在父类容器里更新，不需要任何一个子项目的修改；如果某个子项目需要另外一个版本号时，只需要在dependencies中声明一个版本号即可。子类就会使用子类声明的版本号，不继承于父类版本号。</p><h2 id="方式一-使用dependencyManagement"><a href="#方式一-使用dependencyManagement" class="headerlink" title="方式一:使用dependencyManagement"></a>方式一:使用dependencyManagement</h2><p>版本锁定（指定项目中依赖的版本）:只是起到指定依赖版本的作用，并不会导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-bean<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>dependencyManagement其实只是一个管理jar的作用,是管理jar的版本,其他他的什么作用都没有,只是定义找到该jar的三维坐标,并不是真正的去执行下载的jar的功能.</p><p>有depencyManagement的时候,maven按如下规则寻找jar包依赖</p><ul><li>在dependencies中的依赖中如果没有声明jar的版本,就到dependenciesManage中去找,找到就使用,没有就报错</li><li>在dependencies中声明jar的版本,则使用该版本,不管在dependenciesManage中有没有声明jar的version,都以该jar的版本为主.</li></ul><p>版本锁定之后,子项目引入对应的jar包时,是没有版本号的<br>    因为,在我们项目顶层的POM文件中，我们会看到dependencyManagement元素。通过它元素来管理jar包的版本，让子项目中引用一个依赖而不用显示的列出版本号。Maven会沿着父子层次向上走，直到找到一个拥有dependencyManagement元素的项目，然后它就会使用在这个dependencyManagement元素中指定的版本号。</p><p>DepencyManagement应用场景</p><ul><li>当我们的项目模块很多的时候，我们使用Maven管理项目非常方便，帮助我们管理构建、文档、报告、依赖、scms、发布、分发的方法。可以方便的编译代码、进行依赖管理、管理二进制库等等。</li><li>由于我们的模块很多，所以我们又抽象了一层，抽出一个itoo-base-parent来管理子项目的公共的依赖。为了项目的正确运行，必须让所有的子项目使用依赖项的统一版本，必须确保应用的各个项目的依赖项和版本一致，才能保证测试的和发布的是相同的结果。</li></ul><p><strong>Dependencies</strong><br>相对于dependencyManagement，所有生命在dependencies里的依赖都会自动引入，并默认被所有的子项目继承</p><p>dependencies和dependencymanagement的区别</p><ol><li>dependencies即使在子项目中不写该依赖项，那么子项目仍然会从父项目中继承该依赖项（全部继承）</li><li>dependencyManagement里只是声明依赖，并不实现引入，因此子项目需要显示的声明需要用的依赖。如果不在子项目中声明依赖，是不会从父项目中继承下来的；只有在子项目中写了该依赖项，并且没有指定具体版本，才会从父项目中继承该项，并且version和scope都读取自父pom;另外如果子项目中指定了版本号，那么会使用子项目中指定的jar版本。</li></ol><h2 id="方式二-提取常量"><a href="#方式二-提取常量" class="headerlink" title="方式二:提取常量"></a>方式二:提取常量</h2><p>提取常量放入pom.xml的属性中</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.2.4.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">hibernate.version</span>&gt;</span>5.0.7.Final<span class="tag">&lt;/<span class="name">hibernate.version</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">struts.version</span>&gt;</span>2.3.24<span class="tag">&lt;/<span class="name">struts.verson</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><p>引入属性通过ognl表达式带入到依赖的版本中：例如${spring.version}</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Eclipse </tag>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vim中删除句尾的空白字符</title>
      <link href="/2019/07/31/vim%E4%B8%AD%E5%88%A0%E9%99%A4%E5%8F%A5%E5%B0%BE%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6/"/>
      <url>/2019/07/31/vim%E4%B8%AD%E5%88%A0%E9%99%A4%E5%8F%A5%E5%B0%BE%E7%9A%84%E7%A9%BA%E7%99%BD%E5%AD%97%E7%AC%A6/</url>
      
        <content type="html"><![CDATA[<h2 id="命令：-s-s-g"><a href="#命令：-s-s-g" class="headerlink" title="命令：%s/\s\+$//g"></a>命令：<code>%s/\s\+$//g</code></h2><p>可以删除行尾多余的空格和tab符号。</p><h2 id="命令：-s-g"><a href="#命令：-s-g" class="headerlink" title="命令：%s/ *$//g"></a>命令：<code>%s/ *$//g</code></h2><p><code>/</code>和<code>*</code>中间有空格，只能删除行尾空格，对于tab不能删除</p>]]></content>
      
      
      <categories>
          
          <category> vim </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eclipse创建maven工程</title>
      <link href="/2019/07/31/eclipse%E5%88%9B%E5%BB%BAmaven%E5%B7%A5%E7%A8%8B/"/>
      <url>/2019/07/31/eclipse%E5%88%9B%E5%BB%BAmaven%E5%B7%A5%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="创建一个maven工程"><a href="#创建一个maven工程" class="headerlink" title="创建一个maven工程"></a>创建一个maven工程</h1><p><img src="/images/20190730021.png" alt><br><img src="/images/20190730022.png" alt><br><img src="/images/20190730024.png" alt></p><h1 id="刚生成的工程就报错"><a href="#刚生成的工程就报错" class="headerlink" title="刚生成的工程就报错"></a>刚生成的工程就报错</h1><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>因为是web工程,webapp下缺少必要的目录和文件<br><img src="/images/20190730025.png" alt></p><p>缺少的文件如下<br><img src="/images/20190730030.png" alt></p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><ol><li><p>方式一,使用eclipse的直接生成<br><img src="/images/20190730028.png" alt></p></li><li><p>方式二,手动创建缺少的目录和文件</p></li></ol><h1 id="调整jdk版本"><a href="#调整jdk版本" class="headerlink" title="调整jdk版本"></a>调整jdk版本</h1><p>主要有两种方式</p><ol><li>调整pom.xml文件</li><li>调整setting.xml文件</li></ol><h2 id="调整pom-xml文件"><a href="#调整pom-xml文件" class="headerlink" title="调整pom.xml文件"></a>调整pom.xml文件</h2><p>调整pom.xml文件有两种方式</p><ol><li>使用eclipse界面操作修改pom.xml文件</li><li>直接修改pom.xml文件</li></ol><h3 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h3><p>使用eclipse界面操作修改pom.xml文件</p><ol><li><p><code>右键项目 -&gt; Maven -&gt; Add Plugin</code></p></li><li><p>出现如下窗口后,进行图中所示配置<br><img src="/images/20190730032.png" alt></p></li><li><p>此时打开pom.xml文件会发现如下内容<br><img src="/images/20190730033.png" alt></p></li><li><p>在pom.xml文件中增加如下内容</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>此时,pom.xml如下所示<br><img src="/images/20190730035.png" alt></p></li><li><p><code>右键项目 -&gt; Maven -&gt; Update Project</code></p></li></ol><h3 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h3><p>直接修改pom.xml文件<br>在maven的pom.xml中添加以下代码指定jdk版本</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>不要忘记,<code>右键项目 -&gt; Maven -&gt; Update Project</code></p><h2 id="调整setting-xml文件"><a href="#调整setting-xml文件" class="headerlink" title="调整setting.xml文件"></a>调整setting.xml文件</h2><p>在maven的安装目录找到settings.xml文件，在里面添加如下代码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.7<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure><p>设置完成后，<code>右键项目-&gt;maven-&gt;update project</code>,这样每次新建maven项目都默认为jdk1.7版本了</p><h1 id="创建Servlet项目"><a href="#创建Servlet项目" class="headerlink" title="创建Servlet项目"></a>创建Servlet项目</h1><p>主要用以说明如何引入依赖</p><h2 id="新增Servlet"><a href="#新增Servlet" class="headerlink" title="新增Servlet"></a>新增Servlet</h2><ol><li><code>src/main/java</code> -&gt; 右键 -&gt; new -&gt; servlet</li><li>键入如下内容,进行创建<br><img src="/images/20190730040.png" alt></li></ol><h2 id="增加示例代码"><a href="#增加示例代码" class="headerlink" title="增加示例代码"></a>增加示例代码</h2><ol><li><p>/helloworld/src/main/java/com/zjinc36/web/HelloServlet.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.web;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class HelloServlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Default constructor.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HelloServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"进入HelloServlet"</span>);</span><br><span class="line">request.getRequestDispatcher(<span class="string">"/index.jsp"</span>).forward(request, response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">doGet(request, response);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>/helloworld/src/main/webapp/index.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello,world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="增加依赖"><a href="#增加依赖" class="headerlink" title="增加依赖"></a>增加依赖</h1><p>上述示例用代码,现在没有引入jar包,肯定是一堆报错,接下去说明,如何修改maven的pom.xml文件来解决依赖问题<br>servlet项目需要增加两种依赖</p><ul><li>Servlet依赖</li><li>jsp依赖</li></ul><h2 id="增加Servlet依赖"><a href="#增加Servlet依赖" class="headerlink" title="增加Servlet依赖"></a>增加Servlet依赖</h2><p>有两种方式</p><ul><li>直接在pom.xml中增加dependencies</li><li>与eclipse紧密结合放方式</li></ul><h3 id="方式一-1"><a href="#方式一-1" class="headerlink" title="方式一"></a>方式一</h3><p>直接在pom.xml中增加dependencies</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zjinc36<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>helloworld<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mavenFirst<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>第一次建maven工程<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">encoding</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="方式二-1"><a href="#方式二-1" class="headerlink" title="方式二"></a>方式二</h3><p>与eclipse紧密结合放方式<br><img src="/images/20190730038.png" alt></p><h2 id="增加jsp依赖"><a href="#增加jsp依赖" class="headerlink" title="增加jsp依赖"></a>增加jsp依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="依赖的作用范围"><a href="#依赖的作用范围" class="headerlink" title="依赖的作用范围"></a>依赖的作用范围</h1><p>上述增加依赖时,需要指定scop来控制依赖的范围</p><table><thead><tr><th>依赖范围参数</th><th>参数说明</th></tr></thead><tbody><tr><td>test</td><td>范围指的是测试范围有效，在编译和打包时都不会使用这个依赖</td></tr><tr><td>compile</td><td><strong>默认值</strong>,范围指的是编译范围有效，在编译和打包时都会将依赖存储进去</td></tr><tr><td>provided</td><td>依赖：在编译和测试的过程有效，最后生成war包时不会加入</td></tr><tr><td>runtime</td><td>在运行的时候依赖，在编译的时候不依赖</td></tr></tbody></table><p><strong>为什么需要依赖作用范围</strong><br>例如上面配置的依赖,指定作用范围为provided,是因为servlet-api，tomcat等web服务器已经存在了，如果此时还是compile,那么就会出现重复打包,会引起冲突</p><h1 id="配置tomcat"><a href="#配置tomcat" class="headerlink" title="配置tomcat"></a>配置tomcat</h1><h2 id="方式一-2"><a href="#方式一-2" class="headerlink" title="方式一"></a>方式一</h2><p>原先配置方式<br><a href="/2019/06/25/Eclipse配置Tomcat/"><em>Eclipse配置Tomcat</em></a></p><h2 id="方式二-2"><a href="#方式二-2" class="headerlink" title="方式二"></a>方式二</h2><p>使用maven插件<br><a href="https://blog.csdn.net/j080624/article/details/67639259" target="_blank" rel="noopener"><em>Maven - 两种Tomcat插件的配置</em></a></p><p>Maven Tomcat插件现在主要有两个版本，tomcat-maven-plugin和tomcat7-maven-plugin，使用方式基本相同。</p><ul><li>tomcat-maven-plugin 插件官网：<a href="http://mojo.codehaus.org/tomcat-maven-plugin/plugin-info.html" target="_blank" rel="noopener"><em>http://mojo.codehaus.org/tomcat-maven-plugin/plugin-info.html</em></a></li><li>tomcat7-maven-plugin 插件官网：<a href="http://tomcat.apache.org/maven-plugin.html" target="_blank" rel="noopener"><em>http://tomcat.apache.org/maven-plugin.html</em></a></li></ul><p><strong>tomcat-maven-plugin 插件使用</strong><br>在pom.xml中加入下面代码：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">path</span>&gt;</span>/wp<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">port</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uriEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">uriEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8080/manager/html<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">server</span>&gt;</span>tomcat6<span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p>简要说明一下：</p><ul><li>path  是访问应用的路径</li><li>port 是tomcat 的端口号</li><li>uriEncoding  URL按UTF-8进行编码，这样就解决了中文参数乱码。</li><li>Server 指定tomcat名称。</li></ul><p>如果Eclipse 安装了Maven插件，选择pom.xml文件 -&gt; 击右键 -&gt; 选择 Run As -&gt; Maven build</p><p>如果是第一次运行，会弹出对话框,<code>在Goals框加加入以下命令: tomcat:run</code><br>这样Tomcat 插件就可以运行。</p><p><strong>下面介绍几个常用的Goal</strong></p><ul><li>tomcat:deploy   –部署一个web war包</li><li>tomcat:reload   –重新加载web war包</li><li>tomcat:start    –启动tomcat</li><li>tomcat:stop    –停止tomcat</li><li>tomcat:undeploy–停止一个war包</li><li>tomcat:run  启动嵌入式tomcat ，并运行当前项目</li></ul><p><strong>tomcat7-maven-plugin 插件使用</strong></p><p>在pom.xml中加入下面代码：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">port</span>&gt;</span>8080<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">server</span>&gt;</span>tomcat7<span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">goal</span>&gt;</span>run<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在这里要注意一下，该插件命名方式有些不同，比如启动tomcat ，对应的目标命令是: tomcat7:run ,同样，其它命令也是这样，需要更改为：tomcat7：&lt;插件执行点&gt;</p><ul><li>tomcat7:deploy  –部署一个web war包</li><li>tomcat7:reload  –重新加载web war包</li><li>tomcat7:start    –启动tomcat</li><li>tomcat7:stop    –停止tomcat</li><li>tomcat7:undeploy–停止一个war包</li><li>tomcat7:run 启动嵌入式tomcat ，并运行当前项目</li></ul><p>如果需要debug，就使用debug as 方式启动项目！</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Eclipse </tag>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eclipse配置maven</title>
      <link href="/2019/07/31/eclipse%E9%85%8D%E7%BD%AEmaven/"/>
      <url>/2019/07/31/eclipse%E9%85%8D%E7%BD%AEmaven/</url>
      
        <content type="html"><![CDATA[<h2 id="设定编码"><a href="#设定编码" class="headerlink" title="设定编码"></a>设定编码</h2><p>在<code>Windows -&gt; Preferences</code><br><img src="/images/20190730008.png" alt><br><img src="/images/20190730009.png" alt></p><h2 id="更改maven版本"><a href="#更改maven版本" class="headerlink" title="更改maven版本"></a>更改maven版本</h2><p>将eclipse中的maven版本变为自己使用的版本</p><p>在<code>Windows -&gt; Preferences</code></p><ol><li><p>将我们自己的maven版本添加进eclipse<br><img src="/images/20190730010.png" alt></p></li><li><p>添加完之后勾选我们自己的maven版本<br><img src="/images/20190730011.png" alt></p></li></ol><h2 id="添加maven的配置文件"><a href="#添加maven的配置文件" class="headerlink" title="添加maven的配置文件"></a>添加maven的配置文件</h2><p>在<code>Windows -&gt; Preferences</code><br><img src="/images/20190730012.png" alt></p><h2 id="maven的视图面板"><a href="#maven的视图面板" class="headerlink" title="maven的视图面板"></a>maven的视图面板</h2><ol><li><p>打开<code>windows -&gt; Show View -&gt; other</code><br><img src="/images/20190730017.png" alt></p></li><li><p>点击确定后可以看到<br><img src="/images/20190730019.png" alt></p></li><li><p><strong>如果想在本地同步一份,可以在<code>Local Respository -&gt; 右键 -&gt; Rebuild Index</code></strong></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Eclipse </tag>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven的常用命令和生命周期</title>
      <link href="/2019/07/30/maven%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
      <url>/2019/07/30/maven%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%92%8C%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="maven的常用命令"><a href="#maven的常用命令" class="headerlink" title="maven的常用命令"></a>maven的常用命令</h1><h2 id="clean"><a href="#clean" class="headerlink" title="clean"></a>clean</h2><p>clean是maven工程的清理命令,执行clean会删除target目录及其目录下所有内容<br><img src="/images/20190730003.png" alt></p><h2 id="compile"><a href="#compile" class="headerlink" title="compile"></a>compile</h2><p>compile是maven工程的编译命令,作用是将src/main/java下的java源文件编译为class文件并输出到target下的classes目录下<br><img src="/images/20190730002.png" alt></p><h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><p>test是maven工程的测试命令,mvn test会执行src/test/java下的单元测试类<br><img src="/images/20190730004.png" alt></p><h2 id="package"><a href="#package" class="headerlink" title="package"></a>package</h2><p>package是maven工程的打包命令,对于java工程执行package打包成jar包,对于web工程打包成war包<br><img src="/images/20190730005.png" alt></p><h2 id="install"><a href="#install" class="headerlink" title="install"></a>install</h2><p>install是maven工程的安装命令,执行install将maven打成jar包或war包发布到本地仓库<br><img src="/images/20190730006.png" alt></p><p>查看打包情况<br><img src="/images/20190730007.png" alt></p><h1 id="maven的声明周期"><a href="#maven的声明周期" class="headerlink" title="maven的声明周期"></a>maven的声明周期</h1><p>maven对项目的构建过程分为三套独立的生命周期,请注意,这里说的是”三套”,而且是”相互独立”,这三套声明周期分别是:</p><ol><li>Clean Lifecycle:在进行真正的构建之前,进行一些清理工作</li><li>Default Lifecycle:构建的核心部分,编译,测试,打包,部署等</li><li>Site Lifecycle:生成项目报告,站点,发布站点</li></ol><p>每一个阶段都有一个对应的命令,且有响应的插件来支持命令的运行</p><p>从上面命令结果可以看出,当运行后面的命令时,前面的操作过程也都会执行,也就是说<strong>属于同一个指令周期里的指令,当后面的命令执行时,前面的命令也会执行</strong></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven的目录结构规范</title>
      <link href="/2019/07/30/maven%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E8%A7%84%E8%8C%83/"/>
      <url>/2019/07/30/maven%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E8%A7%84%E8%8C%83/</url>
      
        <content type="html"><![CDATA[<p>具有公共目录布局允许用户熟悉Maven项目从一个到另一个。</p><h2 id="标准的目录结构"><a href="#标准的目录结构" class="headerlink" title="标准的目录结构"></a>标准的目录结构</h2><p>maven定义了一个标准的目录结构</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- src</span><br><span class="line">  - main</span><br><span class="line">    - java</span><br><span class="line">    - resources</span><br><span class="line">    - webapp</span><br><span class="line">  - test</span><br><span class="line">    - java</span><br><span class="line">    - resources</span><br><span class="line">- target</span><br></pre></td></tr></table></figure><ul><li>src 目录是源代码和测试代码的根目录。</li><li>main 目录是与源代码相关的根目录到应用程序本身，而不是测试代码。</li><li>test 目录包含测试源代码。</li></ul><p>main和test下的 java 目录包含Java代码的应用程序本身是在main和用于测试的Java代码。</p><ul><li>resources 目录包含您项目所需的资源。</li><li>target 目录由Maven创建。它包含所有编译的类，JAR文件等。</li></ul><p>当执行 mvn clean 命令时，Maven将清除目标目录。</p><ul><li>webapp 目录包含Java Web应用程序，如果项目是Web应用程序。</li><li>webapp 目录是Web应用程序的根目录。webapp目录包含 WEB-INF 目录。</li></ul><p>如果按照目录结构，你不需要指定你的源代码的目录，测试代码，资源文件等。</p><h2 id="具体每个目录的作用"><a href="#具体每个目录的作用" class="headerlink" title="具体每个目录的作用"></a>具体每个目录的作用</h2><table><thead><tr><th>目录</th><th>商店</th></tr></thead><tbody><tr><td>src/main/java</td><td>应用程序/库源</td></tr><tr><td>src/main/resources</td><td>应用程序/库资源</td></tr><tr><td>src/main/config</td><td>配置文件</td></tr><tr><td>src/main/scripts</td><td>应用程序/库脚本</td></tr><tr><td>src/main/webapp</td><td>应用程序/库脚本…</td></tr><tr><td>src/test/java</td><td>测试源</td></tr><tr><td>src/test/resources</td><td>测试资源</td></tr><tr><td>src/assembly</td><td>汇编描述符</td></tr><tr><td>src/site</td><td>Site</td></tr><tr><td>target</td><td>The target directory is used to store all output of the build.</td></tr><tr><td>LICENSE.txt</td><td>项目许可证</td></tr><tr><td>NOTICE.txt</td><td>通知和归因</td></tr><tr><td>README.txt</td><td>项目的自述</td></tr></tbody></table><p>在项目根目录的顶部有pom.xml文件和任何属性，maven.xml。<br>另外，还有文本文件用户在接收时立即读取来源:README.txt，LICENSE.txt等。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven配置本地仓库</title>
      <link href="/2019/07/30/maven%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93/"/>
      <url>/2019/07/30/maven%E9%85%8D%E7%BD%AE%E6%9C%AC%E5%9C%B0%E4%BB%93%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h1 id="下载jar包规则"><a href="#下载jar包规则" class="headerlink" title="下载jar包规则"></a>下载jar包规则</h1><p>本地仓库是远程仓库的一个缓冲和子集，当你构建Maven项目的时候</p><ol><li>首先会从本地仓库查找资源</li><li>如果没有，那么Maven会从远程仓库(可能是私服,没有私服就是中央仓库了)下载到你本地仓库,这样在你下次使用的时候就不需要从远程下载了</li><li>如果你所需要的jar包版本在本地仓库没有，而且也不存在于远程仓库，Maven在构建的时候会报错，这种情况可能是有些jar包的新版本没有在Maven仓库中及时更新。</li></ol><h1 id="配置本地仓库"><a href="#配置本地仓库" class="headerlink" title="配置本地仓库"></a>配置本地仓库</h1><p><img src="/images/20190730001.png" alt></p><h2 id="默认仓库的存储位置"><a href="#默认仓库的存储位置" class="headerlink" title="默认仓库的存储位置"></a>默认仓库的存储位置</h2><p>Maven缺省的本地仓库路径为<code>${user.home}/.m2/repository</code></p><h2 id="自定义修改仓库的存储位置"><a href="#自定义修改仓库的存储位置" class="headerlink" title="自定义修改仓库的存储位置"></a>自定义修改仓库的存储位置</h2><p>可改变默认的 .m2 目录下的默认本地存储库文件夹<br>具体就是修改如下的Xml代码 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;localRepository&gt;自己仓库的存放目录&lt;/localRepository&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven的安装</title>
      <link href="/2019/07/30/maven%E7%9A%84%E5%AE%89%E8%A3%85/"/>
      <url>/2019/07/30/maven%E7%9A%84%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<ol><li><p>去官网下载<a href="https://maven.apache.org/download.cgi" target="_blank" rel="noopener"><em>https://maven.apache.org/download.cgi</em></a></p></li><li><p>移动到自己指定的位置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv apache-maven-3.5.3-bin.tar.gz /usr/local/</span><br></pre></td></tr></table></figure></li><li><p>解压</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -zxvf apache-maven-3.5.3-bin.tar.gz</span><br><span class="line">sudo rm -rf apache-maven-3.5.3-bin.tar.gz</span><br><span class="line"></span><br><span class="line">解压之后的文件夹名字为：apache-maven-3.5.3</span><br></pre></td></tr></table></figure></li><li><p>修改全局配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/profile</span><br><span class="line"></span><br><span class="line">添加如下配置</span><br><span class="line">export M2_HOME=/usr/local/apache-maven-3.5.3</span><br><span class="line">export PATH=$&#123;M2_HOME&#125;/bin:$PATH</span><br></pre></td></tr></table></figure></li><li><p>使修改的配置立刻生效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure></li><li><p>检查是否安装成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -v</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中安装fzf</title>
      <link href="/2019/07/29/ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85fzf/"/>
      <url>/2019/07/29/ubuntu%E4%B8%AD%E5%AE%89%E8%A3%85fzf/</url>
      
        <content type="html"><![CDATA[<h2 id="安装fzf"><a href="#安装fzf" class="headerlink" title="安装fzf"></a>安装fzf</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>Fzf是一款小巧，超快，通用，跨平台的命令行模糊查找器</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf</span><br><span class="line">$ cd ~/.fzf/</span><br><span class="line">$ ./install</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ol><li><p>核心命令 FZF_DEFAULT_COMMAND<br>对于使用 fzf 来查找文件的情况，fzf 其实底层是调用的 Unix 系统 find 命令，如果你觉得 find 不好用也可以使用其它查找文件的命令行工具「我使用 fd」。注意：对原始命令添加一些参数应该在这个环境变量里面添加<br>比如说我们一般都会查找文件 -type f，通常会忽略一些文件夹/目录 –exclude=…，下面是我的变量值：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> FZF_DEFAULT_COMMAND=<span class="string">"fd --exclude=&#123;.git,.idea,.vscode,.sass-cache,node_modules,build&#125; --type f"</span></span><br></pre></td></tr></table></figure></li><li><p>界面展示 FZF_DEFAULT_OPTS<br>界面展示这些参数在 fzf –help 中都有，按需配置即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> FZF_DEFAULT_OPTS=<span class="string">"--height 40% --layout=reverse --preview '(highlight -O ansi &#123;&#125; || cat &#123;&#125;) 2&gt; /dev/null | head -500'"</span></span><br></pre></td></tr></table></figure></li></ol><p><code>--preview</code>表示在右侧显示文件的预览界面，语法高亮的设置使用了<a href="http://www.andre-simon.de/doku/highlight/en/install.php" target="_blank" rel="noopener">highlight</a>,如果 highlight 失败则使用最常见的 cat 命令来查看文件内容</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="在Bash和Zsh中使用模糊完成"><a href="#在Bash和Zsh中使用模糊完成" class="headerlink" title="在Bash和Zsh中使用模糊完成"></a>在Bash和Zsh中使用模糊完成</h4><p>要触发文件和目录的模糊完成，请将**字符添加为触发序列</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ cat **&lt;Tab&gt;</span><br><span class="line">$ unset **&lt;Tab&gt;</span><br><span class="line">$ unalias **&lt;Tab&gt;</span><br><span class="line">$ export **&lt;Tab&gt;</span><br><span class="line">$ kill -9 &lt;Tab&gt;</span><br></pre></td></tr></table></figure><h4 id="启用fzf作为Vim插件"><a href="#启用fzf作为Vim插件" class="headerlink" title="启用fzf作为Vim插件"></a>启用fzf作为Vim插件</h4><p>第一步:在.vimrc文件添加<code>set rtp+=~/.fzf</code>,这个指向的是fzf命令文件所在位置<br>第二步:进入bundles中添加<code>Bundle &#39;junegunn/fzf.vim&#39;</code>,主要是为了获得更多的命令支持,不然上一步完成已经可以使用<code>:FZF</code>命令进行使用了<br>第三步:使用fzf插件<a href="https://segmentfault.com/a/1190000016186540" target="_blank" rel="noopener">https://segmentfault.com/a/1190000016186540</a></p><h5 id="vim中使用fzf插件-写几个比较重要的"><a href="#vim中使用fzf插件-写几个比较重要的" class="headerlink" title="vim中使用fzf插件,写几个比较重要的"></a>vim中使用fzf插件,写几个比较重要的</h5><table><thead><tr><th>命令</th><th>作用</th><th>备注</th></tr></thead><tbody><tr><td>Files 路径</td><td>FZF一样的作用，它会列出所有文件，选中后vim会打开选中的文件</td><td>无</td></tr><tr><td>Buffers</td><td>用于在存在于buffer中的文件间切换</td><td>无</td></tr><tr><td>Lines <keyword></keyword></td><td>用于在存在于buffer里的文件中寻找含有某个关键词的行</td><td>无</td></tr><tr><td>BLines <keyword></keyword></td><td>在当前buffer里查找</td><td>无</td></tr><tr><td>Rg <keyword></keyword></td><td>会调用ripgrep来递归搜索当前目录</td><td>无</td></tr></tbody></table><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://keelii.com/2018/08/12/fuzzy-finder-full-guide/" target="_blank" rel="noopener"><em>Fuzzy finder(fzf+vim) 使用全指南</em></a></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vim中显示markdown结构大纲</title>
      <link href="/2019/07/29/vim%E4%B8%AD%E6%98%BE%E7%A4%BAmarkdown%E7%BB%93%E6%9E%84%E5%A4%A7%E7%BA%B2/"/>
      <url>/2019/07/29/vim%E4%B8%AD%E6%98%BE%E7%A4%BAmarkdown%E7%BB%93%E6%9E%84%E5%A4%A7%E7%BA%B2/</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>可能许多人都知道利用 ctags 工具和 tagbar 插件可以在 vim 中显示侧边栏，列出代码文件的结构、类和函数等。实际上在写 markdown 文本时，如果也能在 tagbar 中显示文本大纲，那么显然可以帮助我们理清写作思路，也能快速定位到相关的段落进行修改。<br>实际上，因为 markdown 文件是高度结构化的，所以很容易就能让 ctags 识别 markdown 的文本结构，从而为我们提取出大纲。在 github 上已经有人分享了这一工具：markdown2ctags</p><h1 id="需要的工具"><a href="#需要的工具" class="headerlink" title="需要的工具"></a>需要的工具</h1><h2 id="Excuberant-Ctags"><a href="#Excuberant-Ctags" class="headerlink" title="Excuberant Ctags"></a>Excuberant Ctags</h2><ol><li>作用<br>该工具通过提取关键字等方式，为不同语言生成 index 目录文件。这些 index 文件可以被用来索引大纲并实现快速跳转。</li><li>安装<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install exuberant-ctags</span><br></pre></td></tr></table></figure></li></ol><h2 id="easytags"><a href="#easytags" class="headerlink" title="easytags"></a>easytags</h2><ol><li>作用<br>自动在保存时更新ctag索引文件,虽然本身能够生成索引文件，但是每次都要手动去生成、更新，比较麻烦。安装 easytags 插件之后可以自动在保存时更新 ctags 索引文件，非常方便。</li><li>安装<br>使用vim的插件管理器,(我还是用旧版本的Bundle,新版本的改成Plugin就好),在vim的配置文件中加入如下语句<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot; vim-misc插件是easytags的依赖,作者自己搞的</span><br><span class="line">Bundle &apos;xolox/vim-misc&apos;</span><br><span class="line">Bundle &apos;xolox/vim-easytags&apos;</span><br></pre></td></tr></table></figure></li></ol><h2 id="tagbar"><a href="#tagbar" class="headerlink" title="tagbar"></a>tagbar</h2><ol><li>作用<br>tagbar 也是一款 vim 插件，安装之后能够利用 ctags 索引文件，在窗口的右侧生成一个侧边窗口，显示文本的结构，默认使用 来打开/关闭该窗口。</li><li>安装<br>这个一般都有安装</li></ol><h2 id="markdown2ctags"><a href="#markdown2ctags" class="headerlink" title="markdown2ctags"></a>markdown2ctags</h2><ol><li><p>作用<br>该工具可以用来为 markdown 生成 ctags 可以识别的索引文件</p></li><li><p>安装</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Bundle &apos;jszakmeister/markdown2ctags&apos;</span><br></pre></td></tr></table></figure></li><li><p>配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&quot; Add support for markdown files in tagbar.</span><br><span class="line">let g:tagbar_type_markdown = &#123;</span><br><span class="line">    \ &apos;ctagstype&apos;: &apos;markdown&apos;,</span><br><span class="line">    \ &apos;ctagsbin&apos; : &apos;/path/to/markdown2ctags.py&apos;,</span><br><span class="line">    \ &apos;ctagsargs&apos; : &apos;-f - --sort=yes --sro=»&apos;,</span><br><span class="line">    \ &apos;kinds&apos; : [</span><br><span class="line">        \ &apos;s:sections&apos;,</span><br><span class="line">        \ &apos;i:images&apos;</span><br><span class="line">    \ ],</span><br><span class="line">    \ &apos;sro&apos; : &apos;»&apos;,</span><br><span class="line">    \ &apos;kind2scope&apos; : &#123;</span><br><span class="line">        \ &apos;s&apos; : &apos;section&apos;,</span><br><span class="line">    \ &#125;,</span><br><span class="line">    \ &apos;sort&apos;: 0,</span><br><span class="line">\ &#125;</span><br></pre></td></tr></table></figure></li></ol><p>需要在 .vimrc 中加入上述所展示的一段代码<br>需要特别注意的是</p><ul><li>‘ctagstype’: ‘markdown’,</li><li>‘ctagsbin’ : ‘/path/to/markdown2ctags.py’,<br>这两个地方需要和你的 vim 所识别的 markdown 格式匹配,检测自己的 vim 所识别的 markdown 文本的格式的方式是在 vim 中输入 :set filetype? ，所显示的 filetype= 后面的内容如果不是markdown</li></ul><h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><p><img src="/images/20190729001.png" alt></p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://github.com/jszakmeister/markdown2ctags" target="_blank" rel="noopener"><em>https://github.com/jszakmeister/markdown2ctags</em></a></li><li><a href="https://github.com/xolox/vim-misc" target="_blank" rel="noopener"><em>https://github.com/xolox/vim-misc</em></a></li><li><a href="https://github.com/xolox/vim-easytags" target="_blank" rel="noopener"><em>https://github.com/xolox/vim-easytags</em></a></li><li><a href="https://blog.yongli1992.com/2015/08/14/vim-markdown-outline/" target="_blank" rel="noopener"><em>在 vim 中显示 markdown 结构大纲</em></a></li></ul>]]></content>
      
      
      <categories>
          
          <category> vim </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSH整合方式</title>
      <link href="/2019/07/28/SSH%E6%95%B4%E5%90%88%E6%96%B9%E5%BC%8F/"/>
      <url>/2019/07/28/SSH%E6%95%B4%E5%90%88%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>Spring整合web项目,有可能是Servlet作为web层.如果是servlet作为web层,必须使用工厂获得业务层类,但是如果使用Struts2,Struts2里面有一个插件,可以简化web层代码</p><h1 id="引入jar包"><a href="#引入jar包" class="headerlink" title="引入jar包"></a>引入jar包</h1><h2 id="Struts2的jar包"><a href="#Struts2的jar包" class="headerlink" title="Struts2的jar包"></a>Struts2的jar包</h2><ul><li><code>struts-2.3.37\apps\struts2-blank\WEB-INF\lib\*.jar</code>        – Struts2需要的所有jar包<br>其他需要了解的包</li><li><code>struts2-spring-plugin-2.3.37.jar</code>                          – Struts2整合Spring的插件包</li><li><code>struts2-convention-plugin-2.3.37.jar</code>                      – Struts2注解开发包</li><li><code>struts2-json-plugin-2.3.37.jar</code>                            – Struts2整合AJAX的开发包<br><img src="/images/20190728001.png" alt></li></ul><h2 id="Hibernate的jar包"><a href="#Hibernate的jar包" class="headerlink" title="Hibernate的jar包"></a>Hibernate的jar包</h2><p>Hibernate的开发必须的包</p><ul><li><code>hibernate-release-5.0.7.Final\lib\required\*.jar</code>          – Hibernate框架需要的jar包<br>日志记录</li><li>`log4j-1.2.16.jar``</li><li><code>slf4j-api-1.6.1.jar</code>                                       – 日志接口</li><li><code>slf4j-log4j12-1.7.2.jar</code>                                   – 日志实现</li></ul><p><img src="/images/20190728002.png" alt></p><p>Mysql驱动</p><ul><li><code>mysql-connector-java-5.1.7-bin.jar</code>                        – MySQL的驱动包</li></ul><p>使用c3p0</p><ul><li><code>c3p0-0.9.5.3.jar</code><br><img src="/images/20190728003.png" alt></li></ul><p><strong>注意:Struts2和Hibernate都引入了<code>javassist</code>这个jar包,需要删除一个</strong></p><h2 id="Spring的jar包"><a href="#Spring的jar包" class="headerlink" title="Spring的jar包"></a>Spring的jar包</h2><ul><li>IOC核心包<br><img src="/images/20190728004.png" alt></li><li>AOP核心包<br><img src="/images/20190728005.png" alt></li><li>JDBC模板和事务核心包<br><img src="/images/20190728006.png" alt></li><li>Spring整合web开发<br><img src="/images/20190728007.png" alt></li><li>Spring整合Hibernate核心包<br><img src="/images/20190728008.png" alt></li><li>Spring整合JUnit测试包<br><img src="/images/20190728009.png" alt></li><li>Spring整合Struts2核心包</li></ul><h1 id="引入映射文件"><a href="#引入映射文件" class="headerlink" title="引入映射文件"></a>引入映射文件</h1><h2 id="Struts2的配置文件"><a href="#Struts2的配置文件" class="headerlink" title="Struts2的配置文件"></a>Struts2的配置文件</h2><ol><li>在web.xml中配置spring与struts的相关代码</li></ol><p><strong>配置struts2核心过滤器</strong><br>这里定义为拦截所有</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 配置核心过滤器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>配置spring的监听器</strong><br>当服务启动时，就会先加载spring的配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置Spring框架整合WEB的监听器 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>配置默认加载路径</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 监听器默认加载Web-INF文件下，需要配置参数来加载指定文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>总结：web.xml全部代码为</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">display-name</span>&gt;</span>SSHDemo<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Struts2的核心过滤器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置Spring框架整合WEB的监听器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 监听器默认加载Web-INF文件下，需要配置参数来加载指定文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>struts2.xml<br>用以配置哪个url访问到哪个action<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CTYPE struts PUBLIC</span><br><span class="line">    "-//Apache Software Foundation//DTD Struts Configuration 2.1//EN"</span><br><span class="line">    "http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="Hibernate的配置文件"><a href="#Hibernate的配置文件" class="headerlink" title="Hibernate的配置文件"></a>Hibernate的配置文件</h2><ol><li>hibernate.cfg.xml</li></ol><p><strong>注意:要记得删除那个与线程绑定的session</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 必须配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://192.168.174.130:3306/SSH<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 可选配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 配置C3P0的连接池 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"connection.provider_class"</span>&gt;</span>org.hibernate.connection.C3P0ConnectionProvider<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 不能配置绑定当前的线程的操作 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 映射配置文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zjinc36/domain/Customer.hbm.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>映射文件</li></ol><h2 id="Spring的配置文件"><a href="#Spring的配置文件" class="headerlink" title="Spring的配置文件"></a>Spring的配置文件</h2><ol><li><p>web.xml<br>在上面的web.xml中已经配置了</p></li><li><p>applicationContext.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>日志文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">### direct log messages to stdout ###</span><br><span class="line">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.Target=System.err</span><br><span class="line">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern=%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span><br><span class="line"></span><br><span class="line">### direct messages to file mylog.log ###</span><br><span class="line">log4j.appender.file=org.apache.log4j.FileAppender</span><br><span class="line">log4j.appender.file.File=c\:mylog.log</span><br><span class="line">log4j.appender.file.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.file.layout.ConversionPattern=%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span><br><span class="line"></span><br><span class="line">### set log levels - for more verbose logging change 'info' to 'debug' ###</span><br><span class="line"></span><br><span class="line">log4j.rootLogger=info, stdout</span><br></pre></td></tr></table></figure></li></ol><h1 id="相关说明用代码"><a href="#相关说明用代码" class="headerlink" title="相关说明用代码"></a>相关说明用代码</h1><ol><li><p>表语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="string">`cst_customer`</span> (</span><br><span class="line"><span class="string">`cust_id`</span> <span class="built_in">BIGINT</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'客户编号(主键)'</span>,</span><br><span class="line"><span class="string">`cust_name`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户名称(公司名称)'</span>,</span><br><span class="line"><span class="string">`cust_source`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户信息来源'</span>,</span><br><span class="line"><span class="string">`cust_industry`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户所属行业'</span>,</span><br><span class="line"><span class="string">`cust_level`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户级别'</span>,</span><br><span class="line"><span class="string">`cust_phone`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'固定电话'</span>,</span><br><span class="line"><span class="string">`cust_mobile`</span> <span class="built_in">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'移动电话'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span>(<span class="string">`cust_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br></pre></td></tr></table></figure></li><li><p>配置dao层</p></li></ol><p><strong>定义接口</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer customer)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>定义实现类</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerDaoImpl</span>  <span class="keyword">implements</span> <span class="title">CustomerDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>定义业务层接口和实现类</li></ol><p><strong>定义接口</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ssh.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.domain.Customer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户管理的业务接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer customer)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>定义实现类</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ssh.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.service.CustomerService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户管理的业务实现类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>定义Customer对象</li></ol><p><strong>定义对象</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ssh.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Long cust_id;</span><br><span class="line"><span class="keyword">private</span> String cust_name;</span><br><span class="line"><span class="keyword">private</span> Long cust_user_id;</span><br><span class="line"><span class="keyword">private</span> Long cust_create_id;</span><br><span class="line"><span class="keyword">private</span> String cust_source;</span><br><span class="line"><span class="keyword">private</span> String cust_industry;</span><br><span class="line"><span class="keyword">private</span> String cust_level;</span><br><span class="line"><span class="keyword">private</span> String cust_linkman;</span><br><span class="line"><span class="keyword">private</span> String cust_phone;</span><br><span class="line"><span class="keyword">private</span> String cust_mobile;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getCust_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_id</span><span class="params">(Long cust_id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_id = cust_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_name</span><span class="params">(String cust_name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_name = cust_name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getCust_user_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_user_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_user_id</span><span class="params">(Long cust_user_id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_user_id = cust_user_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getCust_create_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_create_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_create_id</span><span class="params">(Long cust_create_id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_create_id = cust_create_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_source</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_source;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_source</span><span class="params">(String cust_source)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_source = cust_source;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_industry</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_industry;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_industry</span><span class="params">(String cust_industry)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_industry = cust_industry;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_level</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_level;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_level</span><span class="params">(String cust_level)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_level = cust_level;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_linkman</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_linkman;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_linkman</span><span class="params">(String cust_linkman)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_linkman = cust_linkman;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_phone</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_phone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_phone</span><span class="params">(String cust_phone)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_phone = cust_phone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_mobile</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_mobile;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_mobile</span><span class="params">(String cust_mobile)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_mobile = cust_mobile;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Customer [cust_id="</span> + cust_id + <span class="string">", cust_name="</span> + cust_name</span><br><span class="line">+ <span class="string">", cust_user_id="</span> + cust_user_id + <span class="string">", cust_create_id="</span></span><br><span class="line">+ cust_create_id + <span class="string">", cust_source="</span> + cust_source</span><br><span class="line">+ <span class="string">", cust_industry="</span> + cust_industry + <span class="string">", cust_level="</span></span><br><span class="line">+ cust_level + <span class="string">", cust_linkman="</span> + cust_linkman</span><br><span class="line">+ <span class="string">", cust_phone="</span> + cust_phone + <span class="string">", cust_mobile="</span> + cust_mobile</span><br><span class="line">+ <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>定义映射文件Customer.hbm.xml</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zjinc36.ssh.domain.Customer"</span> <span class="attr">table</span>=<span class="string">"cst_customer"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cust_id"</span> <span class="attr">column</span>=<span class="string">"cust_id"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_name"</span> <span class="attr">column</span>=<span class="string">"cust_name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_user_id"</span> <span class="attr">column</span>=<span class="string">"cust_user_id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_create_id"</span> <span class="attr">column</span>=<span class="string">"cust_create_id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_source"</span> <span class="attr">column</span>=<span class="string">"cust_source"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_industry"</span> <span class="attr">column</span>=<span class="string">"cust_industry"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_level"</span> <span class="attr">column</span>=<span class="string">"cust_level"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_linkman"</span> <span class="attr">column</span>=<span class="string">"cust_linkman"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_phone"</span> <span class="attr">column</span>=<span class="string">"cust_phone"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_mobile"</span> <span class="attr">column</span>=<span class="string">"cust_mobile"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="spring整合struts2"><a href="#spring整合struts2" class="headerlink" title="spring整合struts2"></a>spring整合struts2</h1><h2 id="方式一-Action由Struts2框架创建"><a href="#方式一-Action由Struts2框架创建" class="headerlink" title="方式一:Action由Struts2框架创建"></a>方式一:Action由Struts2框架创建</h2><p>这里先初略的定义持久层交给heibernate，业务层交个struts2，创建实例交给spring</p><h3 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h3><ol><li><a href="/2019/07/29/SSH整合方式/#定义web界面"><em>客户端访问url进行数据提交,所以需要一个html页面</em></a></li><li><a href="/2019/07/29/SSH整合方式/#在web-xml中配置spring与struts的相关代码"><em>配置web.xml,对url进行拦截</em></a></li><li><a href="/2019/07/29/SSH整合方式/#配置struts-xml"><em>在struts2.xml配置映射关系,对拦截下来的url进行解析,映射到对应的action</em></a></li><li><a href="/2019/07/29/SSH整合方式/#配置applicationContext-xml"><em>5,6,8三层为了解偶,并不会在代码中显示调用依赖,这时候就需要配置applicationContext.xml,进行依赖注入</em></a></li><li><a href="/2019/07/29/SSH整合方式/#编写action"><em>编写action的相关代码,将请求所带的数据交给Service层(业务层)</em></a></li><li><a href="/2019/07/29/SSH整合方式/#编写持久层"><em>编写Service层(业务层)的相关代码,使得数据符合业务,然后将数据交给Dao层(持久层)</em></a></li><li><a href="/2019/07/29/SSH整合方式/#hibernate-cfg-xml"><em>在写持久层之前,需要配置Hibernate.xml,告诉持久层与数据库建立关系</em></a></li><li><a href="/2019/07/29/SSH整合方式/#编写业务层"><em>编写Dao层(持久层)的相关代码,将数据保存到数据库</em></a></li></ol><h3 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h3><ol><li><p>定义web界面<br>定义一个保存客户的界面,利用form表单进行数据的提交,根据域名可知，这里利用的是struts2的通配符方式进行访问</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FORM</span> <span class="attr">id</span>=<span class="string">form1</span> <span class="attr">name</span>=<span class="string">form1</span></span></span><br><span class="line"><span class="tag">        <span class="attr">action</span>=<span class="string">"$&#123;pageContext.request.contextPath &#125;/customer_add.action"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">method</span>=<span class="string">post</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--table部分省略--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">FORM</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置struts.xml<br>在struts.xml中配置接受请求，根据action名和方法跳转指定的action，执行指定的方法</p><blockquote><ul><li>因为导入的struts2-spring-plugin-2.3.24.jar 包自带一个配置文件 struts-plugin.xml ，该配置文件中有如下代码</li><li><code>&lt;constant name=&quot;struts.objectFactory&quot; value=&quot;spring&quot; /&gt;</code>开启一个常量，如果该常量开启，那么下面的常量就可以使用</li><li>struts.objectFactory.spring.autoWire = name，该常量是可以让Action的类来自动装配Bean对象</li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 该属性指定需要Struts 2处理的请求后缀，该属性的默认值是action，即所有匹配*.action的请求都由Struts 2处理。</span></span><br><span class="line"><span class="comment">如果用户需要指定多个请求后缀，则多个后缀之间以英文逗号（，）隔开。 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.action.extension"</span> <span class="attr">value</span>=<span class="string">"action"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Struts2为了管理Action的配置,通过包进行管理 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Struts2的包 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name:包名,可以随便写,但是要唯一 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"customer"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Action --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name和访问的路径要一致 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- class是包名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"customer_*"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"com.zjinc36.ssh.web.action.CustomerAction"</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置applicationContext.xml<br>在spring的applicationContext.xml中配置相对应的bean以及事务,这里利用spring中IOC(控制反转)的特性，将创建实例的任务交给spring框架管理</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">xmlns:context=<span class="string">"http://www.springframework.org/schema/context"</span></span><br><span class="line">xmlns:aop=<span class="string">"http://www.springframework.org/schema/aop"</span></span><br><span class="line">xmlns:tx=<span class="string">"http://www.springframework.org/schema/tx"</span></span><br><span class="line">xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans </span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/aop/spring-aop.xsd</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/tx </span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;bean id=<span class="string">"customerService"</span></span><br><span class="line"><span class="class"><span class="keyword">class</span></span>=<span class="string">"com.zjinc36.ssh.service.impl.CustomerServiceImpl"</span>&gt;</span><br><span class="line">&lt;property name="customerDao" ref="customerDao"&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean id=<span class="string">"customerDao"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.zjinc36.ssh.dao.Impl.CustomerDaoImpl"</span>&gt;</span><br><span class="line">&lt;property name=<span class="string">"hibernateTemplate"</span> ref=<span class="string">"hibernateTemplate"</span> /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean id=<span class="string">"hibernateTemplate"</span></span><br><span class="line"><span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.orm.hibernate5.HibernateTemplate"</span>&gt;</span><br><span class="line">&lt;!-- 注入sessionFactory --&gt;</span><br><span class="line">&lt;property name=<span class="string">"sessionFactory"</span> /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></li><li><p>编写action<br>编写action相关代码,这里通过struts2的模板类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ssh.web.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.WebApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.support.WebApplicationContextUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ModelDriven;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.service.CustomerService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> <span class="keyword">implements</span> <span class="title">ModelDriven</span>&lt;<span class="title">Customer</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//不要忘记手动new</span></span><br><span class="line">    <span class="keyword">private</span> Customer customer=<span class="keyword">new</span> Customer();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">getModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//提供service成员属性，提供set方法</span></span><br><span class="line">    <span class="keyword">private</span> CustomerService customerService;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomerService</span><span class="params">(CustomerService customerService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.customerService = customerService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存客户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"WEB层，保存客户"</span>);</span><br><span class="line">        <span class="comment">//方式一：创建web的工厂（action由struts2创建）</span></span><br><span class="line">        WebApplicationContext context=WebApplicationContextUtils.getWebApplicationContext(ServletActionContext.getServletContext());</span><br><span class="line">        CustomerService cs=(CustomerService) context.getBean(<span class="string">"customerService"</span>);</span><br><span class="line">        <span class="comment">//调用方法</span></span><br><span class="line">        cs.save(customer);</span><br><span class="line">        <span class="keyword">return</span> NONE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写持久层<br>编写持久层实现类相关代码,这里利用hibernate提供的模板类，内部封转了session，从而可以调用session中的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ssh.dao.Impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.hibernate3.HibernateTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.dao.CustomerDao;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.domain.Customer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerDaoImpl</span> <span class="keyword">implements</span> <span class="title">CustomerDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将数据保存到数据库中(调用模板类(hibernate提供，内部封装了session))</span></span><br><span class="line">    <span class="keyword">private</span> HibernateTemplate hibernateTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHibernateTemplate</span><span class="params">(HibernateTemplate hibernateTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.hibernateTemplate = hibernateTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存客户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"持久层：保存客户"</span>);</span><br><span class="line">        hibernateTemplate.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编写业务层<br>编写业务层实现类相关代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ssh.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.dao.CustomerDao;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.service.CustomerService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户管理的业务实现类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CustomerDao customerDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomerDao</span><span class="params">(CustomerDao customerDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.customerDao = customerDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//用来保存客户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"业务层，保存客户"</span>);</span><br><span class="line">        customerDao.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="推荐-方式二：action由spring框架管理"><a href="#推荐-方式二：action由spring框架管理" class="headerlink" title="(推荐)方式二：action由spring框架管理"></a>(推荐)方式二：action由spring框架管理</h2><p>需要引入插件包<code>struts2-spring-plugin-2.3.37.jar</code> – Struts2整合Spring的插件包</p><h3 id="基本思路-1"><a href="#基本思路-1" class="headerlink" title="基本思路"></a>基本思路</h3><ol><li><a href="/2019/07/29/SSH整合方式/#定义web界面"><em>客户端访问url进行数据提交,所以需要一个html页面</em></a></li><li><a href="/2019/07/29/SSH整合方式/#在web-xml中配置spring与struts的相关代码"><em>配置web.xml,对url进行拦截</em></a></li><li><a href="/2019/07/29/SSH整合方式/#配置struts2-xml和applicationContext-xml"><em><strong>(有变化)解析url -&gt; applicationContext.xml中的bean -&gt; Action</strong></em></a></li><li><a href="/2019/07/29/SSH整合方式/#配置applicationContext-xml"><em>5,6,8三层为了解偶,并不会在代码中显示调用依赖,这时候就需要配置applicationContext.xml,进行依赖注入</em></a></li><li><a href="/2019/07/29/SSH整合方式/#编写action"><em>编写action的相关代码,将请求所带的数据交给Service层(业务层)</em></a></li><li><a href="/2019/07/29/SSH整合方式/#编写持久层"><em>编写Service层(业务层)的相关代码,使得数据符合业务,然后将数据交给Dao层(持久层)</em></a></li><li><a href="/2019/07/29/SSH整合方式/#hibernate-cfg-xml"><em>在写持久层之前,需要配置Hibernate.xml,告诉持久层与数据库建立关系</em></a></li><li><a href="/2019/07/29/SSH整合方式/#编写业务层"><em>编写Dao层(持久层)的相关代码,将数据保存到数据库</em></a></li></ol><h3 id="具体操作-1"><a href="#具体操作-1" class="headerlink" title="具体操作"></a>具体操作</h3><ol><li>配置struts2.xml和applicationContext.xml<br>配置struts2.xml和applicationContext.xml,对拦截下来的url进行解析,映射到对应的Action<br>原本在Struts2.xml写映射的时候,是直接映射到Action,但是现在不是<blockquote><ul><li>原本:解析url –&gt; Action</li><li>现在:解析url –&gt; applicationContext.xml中的bean –&gt; Action</li></ul></blockquote></li></ol><p><strong>注意</strong></p><blockquote><ul><li>Spring框架默认生成CustomerAction是单例的，而Struts2框架是多例的。所以需要配置 scope=”prototype”,如果使用单例,所有保存的值会在同一个值栈,会出现问题的</li><li>此时没有struts2的自动装配，在action需要手动配置customerService属性，并在action类中生成set方法</li></ul></blockquote><p><strong>applicationContext.xml中的bean -&gt; Action</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置客户模块 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 强调：配置的Aciton,必须是多列的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customerAction"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.ssh.web.action.CustomerAction"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--注意：struts管理action时，基于其中有个struts-plugin的jar包，其中更改了一个</span></span><br><span class="line"><span class="comment">        常量struts.objectFactory.spring.autoWire = name将其打开了，可以自动装配，只需要提供set方法</span></span><br><span class="line"><span class="comment">        但是此时action由spring管理，自动装配失效，所以需要手动进行配置注入</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 也就是需要手动注入业务层(service) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"customerService"</span> <span class="attr">ref</span>=<span class="string">"customerService"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>url-&gt;applicationContext.xml</strong><br>struts.xml需要做修改</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置包结构 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"crm"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置客户的Action --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  方式一：aciton由struts2框架管理,将url直接映射到Action --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;action name="customer_*" class="com.zjinc36.ssh.web.action.CustomerAction" method="&#123;1&#125;"/&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 方式二：action由spring管理，class标签上只需要编写srping配置bean的ID值既可以--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 将url映射到applicationContext.xml中的bean --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"customer_*"</span> <span class="attr">class</span>=<span class="string">"customerAction"</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="Spring整合Hibernate-配置事务"><a href="#Spring整合Hibernate-配置事务" class="headerlink" title="Spring整合Hibernate(配置事务)"></a>Spring整合Hibernate(配置事务)</h1><h2 id="方式一-带有hibernate-cfg-xml的配置文件"><a href="#方式一-带有hibernate-cfg-xml的配置文件" class="headerlink" title="方式一:带有hibernate.cfg.xml的配置文件"></a>方式一:带有hibernate.cfg.xml的配置文件</h2><p>在原生的hibernate中，hibernate.cfg.xml都是由hibernate框架管理，其配置文件能生成sessionFactory,持久层加载此配置文件获取sessionFactory，从而创建工厂生成session，进行数据的增删改成，此时其配置文件应该交给spring管理，充分利用spring的IOC特性<br>Spring框架提供了一个HibernateDaoSupport的工具类，以后DAO都可以继承该类!在引入hibernate核心配置文件之前，得让dao层继承一个父类HibernateDaoSupport，此父类内部封装了事务模板<br><img src="/images/20190729002.png" alt></p><h3 id="基本思路-2"><a href="#基本思路-2" class="headerlink" title="基本思路"></a>基本思路</h3><p>在Dao层整合持久化操作,Hibernate的<code>持久化类=Java类+映射文件</code>(<a href="/2019/07/07/Hibernate持久化类的编写规则/#什么是持久化类"><em>详见:什么是持久化类</em></a>),核心为<code>数据库的连接配置</code>和<a href="/2019/07/04/Hibernate的API/#SessionFactory">SessionFactory对象</a></p><ol><li>spring管理hibernate.cfg.xml文件</li><li>spring将sessionFactory注入到Dao</li><li>修改持久层实现类,让其继承工具类<code>Hibernatedaosupport</code>,可以简化非常多的操作</li></ol><p>使用注解配置事务,需要两步</p><ol start="4"><li>配置平台事务管理器(<a href="/2019/07/28/Spring的事务管理/#常见的事务管理器"><em>详见:常见事务管理器</em></a>),这里使用Hibernate的事务管理器</li><li>开启事务注解(<a href="/2019/07/28/Spring的事务管理/#开启注解事务支持"><em>详见:开启事务注解</em></a>)</li><li>修改业务层,开启事务注解@Transactional(<a href="/2019/07/28/Spring的事务管理/#使用注解配置事务"><em>详见:注解事务</em></a>),当然也可以使用xml配置(<a href="/2019/07/28/Spring的事务管理/#XML配置事务"><em>详见:xml配置事务</em></a>)</li></ol><h3 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h3><ol><li><p>Spring管理Hibernate.cfg.xml文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 编写bean,名称都是固定的，由spring提供，用来加载hibernate.cfg.xml的配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionFactory"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.LocalSessionFactoryBean"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置路径：当启动服务器时 ，该对象就会被创建，从而加载hibernate.cfg.xml文件，从而生成sessionFactory对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span></span></span><br><span class="line"><span class="tag"><span class="attr">value</span>=<span class="string">"classpath:hibernate.cfg.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>Spring将sessionFactory注入到Dao</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 以后，Dao都需要继承HibernateDaoSupport，注入sessionFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customerDao"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"com.zjinc36.ssh.dao.Impl.CustomerDaoImpl"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;property name="hibernateTemplate" ref="hibernateTemplate" /&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>修改持久层实现类,让其继承工具类<code>HibernateDaoSupport</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ssh.dao.Impl;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import org.springframework.orm.hibernate3.HibernateTemplate;</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.hibernate3.support.HibernateDaoSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.dao.CustomerDao;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.domain.Customer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerDaoImpl</span> <span class="keyword">extends</span> <span class="title">HibernateDaoSupport</span> <span class="keyword">implements</span> <span class="title">CustomerDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    //将数据保存到数据库中(调用模板类(hibernate提供，内部封装了session))</span></span><br><span class="line"><span class="comment">//    private HibernateTemplate hibernateTemplate;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    public void setHibernateTemplate(HibernateTemplate hibernateTemplate) &#123;</span></span><br><span class="line"><span class="comment">//        this.hibernateTemplate = hibernateTemplate;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存客户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"持久层：保存客户"</span>);</span><br><span class="line"><span class="comment">//        hibernateTemplate.save(customer);</span></span><br><span class="line"><span class="comment">//本来应该是sessionFactory.save()操作的,但是sessionFactory被spring管理注入后,这样就可以了</span></span><br><span class="line">        <span class="keyword">this</span>.getHibernateTemplate().save(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>配置平台事务管理器</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 先配置平台事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.HibernateTransactionManager"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注入事务，session能够管理事务，工厂能够创建session --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>开启事务注解</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启事务的注解 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span> /&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>修改业务层,开启事务注解@Transactional</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ssh.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.transaction.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.dao.CustomerDao;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.ssh.service.CustomerService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户管理的业务实现类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CustomerDao customerDao;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomerDao</span><span class="params">(CustomerDao customerDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.customerDao = customerDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//用来保存客户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"业务层，保存客户"</span>);</span><br><span class="line">        customerDao.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p><strong>applicationcontext.xml全部代码如下</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customerService"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"com.zjinc36.ssh.service.impl.CustomerServiceImpl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"customerDao"</span> <span class="attr">ref</span>=<span class="string">"customerDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 以后，Dao都需要继承HibernateDaoSupport，注入sessionFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customerDao"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"com.zjinc36.ssh.dao.Impl.CustomerDaoImpl"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;property name="hibernateTemplate" ref="hibernateTemplate" /&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">&lt;bean id="hibernateTemplate"</span></span><br><span class="line"><span class="comment">class="org.springframework.orm.hibernate5.HibernateTemplate"&gt;</span></span><br><span class="line"><span class="comment">注入sessionFactory</span></span><br><span class="line"><span class="comment">&lt;property name="sessionFactory" /&gt;</span></span><br><span class="line"><span class="comment">&lt;/bean&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 编写bean,名称都是固定的，由spring提供，用来加载hibernate.cfg.xml的配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionFactory"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.LocalSessionFactoryBean"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置路径：当启动服务器时 ，该对象就会被创建，从而加载hibernate.cfg.xml文件，从而生成sessionFactory对象 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span></span></span><br><span class="line"><span class="tag"><span class="attr">value</span>=<span class="string">"classpath:hibernate.cfg.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 先配置平台事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.HibernateTransactionManager"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注入事务，session能够管理事务，工厂能够创建session --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 开启事务的注解 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span></span></span><br><span class="line"><span class="tag"><span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="方式二-不带有hibernate-cfg-xml的配置文件"><a href="#方式二-不带有hibernate-cfg-xml的配置文件" class="headerlink" title="方式二:不带有hibernate.cfg.xml的配置文件"></a>方式二:不带有hibernate.cfg.xml的配置文件</h2><p>不带有hibernate.cfg.xml文件,不代表配置可以省,所以这些配置都是需要的,只是从hibernate.cfg.xml文件转移到了appllicatiionContext.xml文件中了</p><h3 id="基本思路-3"><a href="#基本思路-3" class="headerlink" title="基本思路"></a>基本思路</h3><p>基本思路和方式一差不多<br>在Dao层整合持久化操作,Hibernate的持久化类=Java类+映射文件(详见:什么是持久化类),核心为数据库的连接配置和SessionFactory对象</p><ol><li><del>spring管理hibernate.cfg.xml文件</del> spring中配置hibernate.cfg.xml文件中配置的内容<blockquote><p>  这里准备删除hibernate的核心配置文件，在删除之前，需要将其配置文件中的相关内容配置到spring的applicatioinContext.xml文件中<br>  hibernate.cfg.xml文件的内容如下</p><ul><li>数据库连接基本参数（4大参数）</li><li>Hibernate相关的属性</li><li>连接池</li><li>映射文件</li></ul></blockquote></li><li>spring将sessionFactory注入到Dao</li><li>修改持久层实现类,让其继承工具类Hibernatedaosupport,可以简化非常多的操作</li></ol><p>使用注解配置事务,需要两步</p><ol><li>配置平台事务管理器(详见:常见事务管理器),这里使用Hibernate的事务管理器</li><li>开启事务注解(详见:开启事务注解)</li><li>修改业务层,开启事务注解@Transactional(详见:注解事务),当然也可以使用xml配置(详见:xml配置事务)</li></ol><h3 id="具体实现-1"><a href="#具体实现-1" class="headerlink" title="具体实现"></a>具体实现</h3><p>修改spring中配置hibernate.cfg.xml文件中配置的内容<br><strong>引入连接池</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 先配置C3p0的连接池 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://192.168.174.130:3306/SSH"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>在sessionFactory引入位置增加其他参数</strong></p><p>修改对应的sessionFactory,因为已经没有了hibernate.cfg.xml的配置文件，所以需要修改该配置，注入连接池<br>引入对象映射文件：因为已经没有了hibernate.cfg.xml的配置文件，不会扫描到该配置文件，需要注入</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 编写bean,名称都是固定的，由spring提供，用来加载hibernate.cfg.xml的配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionFactory"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.LocalSessionFactoryBean"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置路径：当启动服务器时 ，该对象就会被创建，从而加载hibernate.cfg.xml文件，从而生成sessionFactory对象 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这里原本需要引入hibernate.cfg.xml,但此时不引入就需要配置 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;property name="configLocation" value="classpath:hibernate.cfg.xml"</span></span><br><span class="line"><span class="comment">/&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--先加载连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 加载方言，加载可选项 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernateProperties"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入映射的配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mappingResources"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/com/zjinc36/ssh/domain/Customer.hbm.xml<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>现在applicationContxxt.xml文件全部内容如下</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 先配置C3p0的连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcUrl"</span></span></span><br><span class="line"><span class="tag"><span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/hibernate"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customerService"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"com.zjinc36.ssh.service.impl.CustomerServiceImpl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"customerDao"</span> <span class="attr">ref</span>=<span class="string">"customerDao"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 以后，Dao都需要继承HibernateDaoSupport，注入sessionFactory --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"customerDao"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"com.zjinc36.ssh.dao.Impl.CustomerDaoImpl"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;property name="hibernateTemplate" ref="hibernateTemplate" /&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &lt;bean id="hibernateTemplate" class="org.springframework.orm.hibernate5.HibernateTemplate"&gt; </span></span><br><span class="line"><span class="comment">注入sessionFactory &lt;property name="sessionFactory" /&gt; &lt;/bean&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 编写bean,名称都是固定的，由spring提供，用来加载hibernate.cfg.xml的配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sessionFactory"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.LocalSessionFactoryBean"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置路径：当启动服务器时 ，该对象就会被创建，从而加载hibernate.cfg.xml文件，从而生成sessionFactory对象 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这里原本需要引入hibernate.cfg.xml,但此时不引入就需要配置 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- &lt;property name="configLocation" value="classpath:hibernate.cfg.xml" </span></span><br><span class="line"><span class="comment">/&gt; --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--先加载连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 加载方言，加载可选项 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernateProperties"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入映射的配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mappingResources"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/com/zjinc36/ssh/domain/Customer.hbm.xml<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 先配置平台事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate5.HibernateTransactionManager"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注入事务，session能够管理事务，工厂能够创建session --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 开启事务的注解 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span></span></span><br><span class="line"><span class="tag"><span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此时可以安心的删除hibernate.cfg.xml文件了<br>这样SSH整合完毕</p><h1 id="Hibernate模板常用方法"><a href="#Hibernate模板常用方法" class="headerlink" title="Hibernate模板常用方法"></a>Hibernate模板常用方法</h1><h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><ol><li><p>持久层</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.hibernate5.HibernateTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.hibernate5.support.HibernateDaoSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.domain.Customer;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 持久层</span></span><br><span class="line"><span class="comment"> * 继承HibernateDaoSupport，内部封装了HibernateTemplat</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerDaoImpl</span> <span class="keyword">extends</span> <span class="title">HibernateDaoSupport</span> <span class="keyword">implements</span> <span class="title">CustomerDao</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">this</span>.getHibernateTemplate().update(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>业务层</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zinc36.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.dao.CustomerDao;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.domain.Customer;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户的业务层</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title">CustomerService</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CustomerDao customerDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomerDao</span><span class="params">(CustomerDao customerDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.customerDao = customerDao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        customerDao.update(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.service.CustomerService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试Hiberante模板类的简单方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name=<span class="string">"customerService"</span>)</span><br><span class="line">    <span class="keyword">private</span> CustomerService customerService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试插入</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Customer customer=<span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setCust_id(<span class="number">1L</span>);</span><br><span class="line">        customer.setCust_name(<span class="string">"测试"</span>);</span><br><span class="line">        customerService.update(customer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="指定查询、查询所有、离线查询代码"><a href="#指定查询、查询所有、离线查询代码" class="headerlink" title="指定查询、查询所有、离线查询代码"></a>指定查询、查询所有、离线查询代码</h2><ol><li><p>持久层</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.DetachedCriteria;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.hibernate5.HibernateTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.orm.hibernate5.support.HibernateDaoSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.domain.Customer;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 持久层</span></span><br><span class="line"><span class="comment"> * 继承HibernateDaoSupport，内部封装了HibernateTemplate</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerDaoImpl</span> <span class="keyword">extends</span> <span class="title">HibernateDaoSupport</span> <span class="keyword">implements</span> <span class="title">CustomerDao</span> </span>&#123;</span><br><span class="line">    <span class="comment">//将数据保存到数据库中(调用模板类(hibernate提供，内部封装了session))</span></span><br><span class="line">    <span class="comment">/*private HibernateTemplate hibernateTemplate;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    public void setHibernateTemplate(HibernateTemplate hibernateTemplate) &#123;</span></span><br><span class="line"><span class="comment">        this.hibernateTemplate = hibernateTemplate;</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存客户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"持久层：保存客户"</span>);</span><br><span class="line">        <span class="keyword">this</span>.getHibernateTemplate().save(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">this</span>.getHibernateTemplate().update(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过主键查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">getById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getHibernateTemplate().get(Customer.class, id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String sql=<span class="string">"from Customer"</span>;</span><br><span class="line">        List&lt;Customer&gt; list=(List&lt;Customer&gt;) <span class="keyword">this</span>.getHibernateTemplate().find(sql);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * QBC离线查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">findAllByQBC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DetachedCriteria criteria=DetachedCriteria.forClass(Customer.class);</span><br><span class="line">        List&lt;Customer&gt; list=(List&lt;Customer&gt;) <span class="keyword">this</span>.getHibernateTemplate().findByCriteria(criteria);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>业务层</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.dao.CustomerDao;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.domain.Customer;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户的业务层</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title">CustomerService</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CustomerDao customerDao;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomerDao</span><span class="params">(CustomerDao customerDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.customerDao = customerDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用来保存客户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"业务层，保存客户"</span>);</span><br><span class="line">        customerDao.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        customerDao.update(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">getById</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> customerDao.getById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerDao.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">findAllByQBC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> customerDao.findAllByQBC();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>测试类<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.service.CustomerService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试Hiberante模板类的简单方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name=<span class="string">"customerService"</span>)</span><br><span class="line">    <span class="keyword">private</span> CustomerService customerService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试插入</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Customer customer=<span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setCust_id(<span class="number">1L</span>);</span><br><span class="line">        customer.setCust_name(<span class="string">"测试"</span>);</span><br><span class="line">        customerService.update(customer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试查询指定的客户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Customer customer=customerService.getById(<span class="number">2L</span>);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有的客户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Customer&gt; list=customerService.findAll();</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * QBC(离线查询)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;Customer&gt; list=customerService.findAllByQBC();</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="关于SSH延迟加载问题"><a href="#关于SSH延迟加载问题" class="headerlink" title="关于SSH延迟加载问题"></a>关于SSH延迟加载问题</h1><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>使用延迟加载的时候，再WEB层查询对象的时候程序会抛出异常！</p><ul><li>原因是延迟加载还没有发生SQL语句，在业务层session对象就已经销毁了，所以查询到的JavaBean对象已经变成了托管态对象！</li><li>注意：一定要先删除javassist-3.11.0.GA.jar包（jar包冲突了）</li></ul><h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>Spring框架提供了一个过滤器，让session对象在WEB层就创建，在WEB层销毁。只需要配置该过滤器即可</p><ul><li>但是：要注意需要在struts2的核心过滤器之前进行，spring监听器之后配置</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 解决延迟加载的问题 --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>OpenSessionInViewFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.orm.hibernate5.support.OpenSessionInViewFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>OpenSessionInViewFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="演示延迟加载"><a href="#演示延迟加载" class="headerlink" title="演示延迟加载"></a>演示延迟加载</h2><ol><li><p>持久层：调用load方法，此方法时延迟加载的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 延迟加载</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">loadById</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getHibernateTemplate().load(Customer.class, id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>业务层</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">loadById</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> customerDao.loadById(id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li><li><p>测试类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run5</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Customer customer=customerService.loadById(<span class="number">2L</span>);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.cnblogs.com/cailijia52o/p/8724710.html" target="_blank" rel="noopener"><em>Spring+Hibernate+Struts(SSH)框架整合</em></a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> Struts2 </tag>
            
            <tag> Hibernate </tag>
            
            <tag> SSH </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中的闭包</title>
      <link href="/2019/07/28/Java%E4%B8%AD%E7%9A%84%E9%97%AD%E5%8C%85/"/>
      <url>/2019/07/28/Java%E4%B8%AD%E7%9A%84%E9%97%AD%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote><p>   本文作者为: SylvanasSun.转载请务必将下面这段话置于文章开头处(保留超链接).<br>   本文转发自SylvanasSun Blog,原文链接: <a href="https://sylvanassun.github.io/2017/07/30/2017-07-30-JavaClosure/" target="_blank" rel="noopener">https://sylvanassun.github.io/2017/07/30/2017-07-30-JavaClosure/</a></p></blockquote><blockquote><p>  <a href="https://coolshell.cn/articles/5265.html" target="_blank" rel="noopener">C++11 中值得关注的几大变化（详解）评论区6#</a></p></blockquote><h1 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h1><p>定义一个闭包的要点如下:</p><ul><li>一个依赖于外部环境的自由变量的函数.</li><li>这个函数能够访问外部环境的自由变量.</li></ul><p>也就是说,外部环境持有内部函数所依赖的自由变量,由此对内部函数形成了闭包.</p><h1 id="自由变量"><a href="#自由变量" class="headerlink" title="自由变量"></a>自由变量</h1><p>那么什么是自由变量呢?自由变量就是在函数自身作用域之外的变量,<strong>一个函数<code>f(x)=x+yf(x)=x+y</code>,其中y就是自由变量</strong>,它并不是这个函数自身的自变量,而是通过外部环境提供的.</p><p>下面以JavaScript的一个闭包为例:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Add</span>(<span class="params">y</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于内部函数<code>function(x)</code>来说,<code>y</code>就是自由变量.而<code>y</code>是函数<code>Add(y)</code>内的参数,所以<code>Add(y)</code>对内部函数<code>function(x)</code>形成了一个闭包.</p><p>这个闭包将自由变量y与内部函数绑定在了一起,也就是说,当Add(y)函数执行完毕后,它不会随着函数调用结束后被回收(不能在栈上分配空间).</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> add_function = Add(<span class="number">5</span>); <span class="comment">// 这时y=5,并且与返回的内部函数绑定在了一起</span></span><br><span class="line"><span class="keyword">var</span> result = add_function(<span class="number">10</span>); <span class="comment">// x=10,返回最终的结果 10 + 5 = 15</span></span><br></pre></td></tr></table></figure><h1 id="Java中的闭包"><a href="#Java中的闭包" class="headerlink" title="Java中的闭包"></a>Java中的闭包</h1><p>Java与JavaScript又或者其他支持闭包的语言不同,它是一个基于类的面向对象语言,也就是说一个方法所用到的自由变量永远都来自于其所在类的实例的.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> y = <span class="number">5</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    retrun x + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样一个方法add(x)拥有一个参数x与一个自由变量y,它的返回值也依赖于这个自由变量y.add(x)想要正常工作的话,就必须依赖于AddUtils类的一个实例,不然它无法知道自由变量y的值是多少,也就是自由变量未与add(x)进行绑定.</p><p>严格上来说,add(x)中的自由变量应该为this,这是因为y也是通过this关键字来访问的.</p><p>所以说,在Java中闭包其实无处不在,只不过我们难以发现而已.但面向对象的语言一般都不把类叫成闭包,这是一种习惯.</p><p>Java中的内部类就是一种典型的闭包结构.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> y = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>内部类通过一个指向外部类的引用来访问外部环境中的自由变量,由此形成了一个闭包.</p><h1 id="匿名内部类"><a href="#匿名内部类" class="headerlink" title="匿名内部类"></a>匿名内部类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> interface <span class="title">AnonInner</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> AnonInner <span class="title">getAnonInner</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> y = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> AnonInner() &#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> x + y;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>getAnonInner(x)方法返回了一个匿名内部类AnonInner,匿名内部类不能显式地声明构造函数,也不能对构造函数传参,且返回的是一个AnonInner接口,但它的add()方法实现中用到了两个自由变量(x与y),也就是说外部方法getAnonInner(x)对这个匿名内部类构成了闭包.</p><p>但我们发现自由变量都被加上了final修饰符,这是因为Java对闭包支持的不完整导致的.</p><p>对于自由变量的捕获策略有以下两种:</p><ul><li>capture-by-value: 只需要在创建闭包的地方把捕获的值拷贝一份到对象里即可.Java的匿名内部类和Java 8新的lambda表达式都是这样实现的.</li><li>capture-by-reference: 把被捕获的局部变量“提升”（hoist）到对象里.C#的匿名函数(匿名委托/lambda表达式)就是这样实现的.</li></ul><p>Java只实现了capture-by-value,但又没有对外说明这一点,为了以后能进一步扩展成支持capture-by-reference留后路,所以干脆就不允许向被捕获的变量赋值,所以这些自由变量需要强制加上final修饰符(在Jdk8中似乎已经没有这种强制限制了).</p><h1 id="那么究竟什么是闭包"><a href="#那么究竟什么是闭包" class="headerlink" title="那么究竟什么是闭包"></a>那么究竟什么是闭包</h1><p>闭包不是私有,闭的意思不是”封闭内部状态”,而是”封闭外部状态”<br>一个函数如何能封闭状态呢?当外部状态的scope失效的时候,还有一份留在内部状态里面</p><p><a href="https://coolshell.cn/articles/5265.html" target="_blank" rel="noopener">C++11 中值得关注的几大变化（详解）评论区6#</a><br><img src="/images/2020/06/20200609020.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java细节 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java匿名内部类访问外部变量，为何需被标志为final</title>
      <link href="/2019/07/28/Java%E5%8C%BF%E5%90%8D%E5%86%85%E9%83%A8%E7%B1%BB%E8%AE%BF%E9%97%AE%E5%A4%96%E9%83%A8%E5%8F%98%E9%87%8F%EF%BC%8C%E4%B8%BA%E4%BD%95%E9%9C%80%E8%A2%AB%E6%A0%87%E5%BF%97%E4%B8%BAfinal/"/>
      <url>/2019/07/28/Java%E5%8C%BF%E5%90%8D%E5%86%85%E9%83%A8%E7%B1%BB%E8%AE%BF%E9%97%AE%E5%A4%96%E9%83%A8%E5%8F%98%E9%87%8F%EF%BC%8C%E4%B8%BA%E4%BD%95%E9%9C%80%E8%A2%AB%E6%A0%87%E5%BF%97%E4%B8%BAfinal/</url>
      
        <content type="html"><![CDATA[<h1 id="final关键字有什么用"><a href="#final关键字有什么用" class="headerlink" title="final关键字有什么用"></a>final关键字有什么用</h1><p>对于Java语言中的final使用，大家应该很熟悉:</p><ol><li>可以修饰类，表示不可继承；</li><li>可以修饰方法，表示不可被子类重写；</li><li>可以修饰变量，表示不可以被二次赋值</li></ol><h1 id="Java匿名内部类访问外部变量，为何需被标志为final？这跟上述三个特性有关系吗？"><a href="#Java匿名内部类访问外部变量，为何需被标志为final？这跟上述三个特性有关系吗？" class="headerlink" title="Java匿名内部类访问外部变量，为何需被标志为final？这跟上述三个特性有关系吗？"></a>Java匿名内部类访问外部变量，为何需被标志为final？这跟上述三个特性有关系吗？</h1><h2 id="问题的提出"><a href="#问题的提出" class="headerlink" title="问题的提出"></a>问题的提出</h2><p>例如有如下代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在方法中使用匿名内部类</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initListener</span><span class="params">(Button btn )</span></span>&#123;</span><br><span class="line"><span class="comment">//必须标记为final</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> name = <span class="string">"zhangsan"</span>;</span><br><span class="line"></span><br><span class="line">btn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">btn.setText(name); <span class="comment">//动态改变按钮的文字</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>为何name变量需被标志为final？</strong>这深层次的原因是什么？为什么有这样一个让人摸不着头脑的规定？</p><h2 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h2><p><a href="/2019/07/28/Java中的闭包/"><em>Java中的闭包</em></a></p><ul><li>匿名内部类在方法里面,也就是说,内部类和外部方法形成一个闭包,也就是说内部类能够访问外部方法的变量</li><li><strong>由于匿名内部类的生命周期有可能比外部的方法要长,所以有可能出现外部变量访问不到的情况</strong></li><li>解决这个问题很简单,就是将外部方法的变量复制一份给匿名内部类,这样即使外部方法”死了”,内部类还是能拿到变量</li><li>这样会产生新的问题,那就是当我们在内部类修改了外部变量的值时,由于内部类修改的是”复制品”,就会造成和外部变量不一致的情况</li><li>那怎么办?<strong>不让改就好了</strong>,所以外部变量要使用final关键字,告诉内部类这个变量是不允许改的</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java细节 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的事务管理</title>
      <link href="/2019/07/28/Spring%E7%9A%84%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86/"/>
      <url>/2019/07/28/Spring%E7%9A%84%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><h2 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h2><p>事务指的是逻辑上的一组操作,组成这组操作的各个逻辑单元,要么全部成功,要么全部失败</p><h2 id="事务特性"><a href="#事务特性" class="headerlink" title="事务特性"></a>事务特性</h2><ul><li>原子性:代表事务不可分割</li><li>一致性:代表事务执行的前后,数据的完整性保持一致</li><li>隔离性:代表一个事务执行的过程中,不应该收到其他事务的干扰</li><li>持久性:代表事务执行完成后,数据就持久到数据库中<br>如果不考虑隔离性,引发安全问题</li></ul><h2 id="读问题"><a href="#读问题" class="headerlink" title="读问题"></a>读问题</h2><p>脏读:一个事务读到另一个事务未提交的数据<br>不可重复读:一个事务读到另一个事务已经提交的update数据,导致在前一个事务多次查询结果不一致<br>虚读:一个事务读到另一个事务已经提交的insert数据,导致在前一个事务多次查询结果不一致</p><h2 id="写问题-了解"><a href="#写问题-了解" class="headerlink" title="写问题(了解)"></a>写问题(了解)</h2><p>引发两类丢失更新</p><p>读问题的解决</p><ul><li>Read uncommitted:以上读问题都会发生</li><li>Read committed:解决脏读,但是不可重复读和虚度有可能发生(Oracle用这种)</li><li>Repeatable read:解决脏读和不可重复读,但是虚读有可能发生(MySQL用这种)</li><li>Serializable:解决所有问题,但是效率低</li></ul><h1 id="Spring的事务管理的API"><a href="#Spring的事务管理的API" class="headerlink" title="Spring的事务管理的API"></a>Spring的事务管理的API</h1><p>Spring 框架中,最重要的事务管理的 API 有三个：<code>TransactionDefinition</code>、<code>PlatformTransactionManager</code> 和 <code>TransactionStatus</code><br>所谓事务管理,实质上就是按照给定的事务规则来执行提交或者回滚操作.其中</p><ul><li>“给定的事务规则”是用 TransactionDefinition 表示的</li><li>“按照……来执行提交或者回滚操作”是用 PlatformTransactionManager 表示的</li><li>TransactionStatus 可以看作代表事务本身.<h2 id="PlatformTransactionManager-平台事物管理器"><a href="#PlatformTransactionManager-平台事物管理器" class="headerlink" title="PlatformTransactionManager:平台事物管理器"></a>PlatformTransactionManager:平台事物管理器</h2>平台事务管理器:接口,是Spring用于管理事务的真正对象</li><li>DataSourceTransactionManager:底层使用JDBC管理事务</li><li>HibernateTransactionManager:底层使用Hibernate管理事务</li></ul><h2 id="TransactionDefinition-事务定义信息"><a href="#TransactionDefinition-事务定义信息" class="headerlink" title="TransactionDefinition:事务定义信息"></a>TransactionDefinition:事务定义信息</h2><p>事务定义:用于定义事务的相关信息,隔离级别,超时信息,传播行为,是否只读</p><h2 id="TransactionStatus-事务的状态"><a href="#TransactionStatus-事务的状态" class="headerlink" title="TransactionStatus:事务的状态"></a>TransactionStatus:事务的状态</h2><p>Spring进行事务管理的时候,首先<code>平台事务管理器</code>根据事务<code>定义信息</code>进行事务的管理,在事物管理过程中,产生各种状态,将这些状态的信息记录到<code>事务状态</code>中</p><h1 id="搭建Spring的事务管理的环境"><a href="#搭建Spring的事务管理的环境" class="headerlink" title="搭建Spring的事务管理的环境"></a>搭建Spring的事务管理的环境</h1><p>主要有以下两个步骤</p><ul><li>配置连接池和JDBC的模板</li><li>在DAO注入jdbc的模板</li></ul><p>具体实现一次</p><ol><li><p>创建Service的接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.transaction;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转账接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(String from, String to, Double money)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建Service的实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(AccountDao accountDao)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * from:转出帐号</span></span><br><span class="line"><span class="comment"> * to:转入帐号</span></span><br><span class="line"><span class="comment"> * money:金额</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(String from, String to, Double money)</span> </span>&#123;</span><br><span class="line">accountDao.outMoney(from, money);</span><br><span class="line">accountDao.inMoney(to, money);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建DAO的接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.transaction;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转账的Dao接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">outMoney</span><span class="params">(String from, Double money)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inMoney</span><span class="params">(String to, Double money)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建DAO的实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.support.JdbcDaoSupport;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转账的Dao的实现类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">extends</span> <span class="title">JdbcDaoSupport</span> <span class="keyword">implements</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line"><span class="comment">//在不继承JdbcDaoSupport的前提下,是需要写如下代码用以注入Jdbc的</span></span><br><span class="line"><span class="comment">//但是继承之后就不需要了,因为在继承类中就已经有如下代码了</span></span><br><span class="line"><span class="comment">// 还可以继续简化,继承这个类后,在appllicationContext.xml文件中,只需要配置一个连接池就行</span></span><br><span class="line"><span class="comment">//因为继承类中连注入的步骤都已经有了</span></span><br><span class="line"><span class="comment">//private JdbcTemplate jdbcTemplate;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//public void setJdbcTemplate(JdbcTemplate jdbcTemplate) &#123;</span></span><br><span class="line"><span class="comment">//this.jdbcTemplate = jdbcTemplate;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在DAO中编写扣钱和加钱的方法</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">outMoney</span><span class="params">(String from, Double money)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.getJdbcTemplate().update(<span class="string">"update account set money = money - ? where name = ?"</span>, money, from);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inMoney</span><span class="params">(String to, Double money)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.getJdbcTemplate().update(<span class="string">"update account set money = money + ? where name = ?"</span>, money, to);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>配置Service和DAO:交给Spring管理</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 引入属性文件 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 第一种方式通过一个Bean标签引入的(很少使用) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span> <span class="attr">value</span>=<span class="string">"classpath:jdbc.properties"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Spring的内置连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourcePool"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 属性注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span></span></span><br><span class="line"><span class="tag"><span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClass&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSourcePool"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置Service --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.transaction.AccountServiceImpl"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在AccountServiceImpl中注入accountDao --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置DAO --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDao"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.transaction.AccountDaoImpl"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 向DAO中注入jdbc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">ref</span>=<span class="string">"jdbcTemplate"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>测试整个环境是否打通</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试转账的环境</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTransf</span> </span>&#123;</span><br><span class="line"><span class="meta">@Resource</span>(name=<span class="string">"accountService"</span>)</span><br><span class="line"><span class="keyword">private</span> AccountService accountService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">accountService.transfer(<span class="string">"Lucy"</span>, <span class="string">"lisi"</span>, <span class="number">100</span>d);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="Spring的事务管理"><a href="#Spring的事务管理" class="headerlink" title="Spring的事务管理"></a>Spring的事务管理</h1><p>上述搭建的环境中,转账过程没有进行事务管理,以下提供两种方式进行事务管理</p><h2 id="常见的事务管理器"><a href="#常见的事务管理器" class="headerlink" title="常见的事务管理器"></a>常见的事务管理器</h2><p><a href="https://blog.csdn.net/Ditto_zhou/article/details/81060975#h5o-7" target="_blank" rel="noopener"><em>Spring的事务管理(一) Spring事务管理的实现，事务的属性(隔离级别，传播行为，只读)</em></a><br><a href="http://www.belonk.com/c/spring_transaction_manager.html" target="_blank" rel="noopener"><em>Spring事务管理二：Spring事务管理器</em></a><br>常见事务管理器有如下几种</p><ul><li>Jdbc事务<br>如果应用程序中直接使用JDBC来进行持久化，DataSourceTransactionManager会为你处理事务边界。</li></ul><p>为了使用DataSourceTransactionManager，你需要使用如下的XML将其装配到应用程序的上下文定义中：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>DataSourceTransactionManager是通过调用Connection来管理事务，通过调用Connection的commit方法提交事务，rollback方法回滚事务</p><ul><li>Hiberante事务</li></ul><p>Hibernate持久化策略，利用HibernateTransactionManager进行事务管理。对于Hibernate3，需要在Spring上下文定义中添加如下的<bean>声明：</bean></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate3.HibernateTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>sessionFactory属性需要装配一个Hibernate的session工厂，HibernateTransactionManager的实现细节是它将事务管理的职</p><p>责委托给org.hibernate.Transaction对象，而后者是从Hibernate Session中获取到的。</p><p>当事务成功完成时，HibernateTransactionManager将会调用Transaction对象的commit()方法，反之，将会调用rollback()方法。</p><ul><li>JPA事务</li></ul><p>Hibernate多年来一直是事实上的Java持久化标准，但是现在Java持久化API作为真正的Java持久化标准进入大家的视野。</p><p>如果你计划使用JPA的话，那你需要使用Spring的JpaTransactionManager来处理事务。你需要在Spring中这样配置JpaTransactionManager：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.JpaTransactionManager"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>JpaTransactionManager只需要装配一个JPA实体管理工厂（javax.persistence.EntityManagerFactory接口的任意实现）。</p><p>JpaTransactionManager将与由工厂所产生的JPA EntityManager合作来构建事务。</p><ul><li>Java原生API事务</li></ul><p>如果你没有使用以上所述的事务管理，或者是跨越了多个事务管理源（比如两个或者是多个不同的数据源），你就</p><p>需要使用JtaTransactionManager：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.jta.JtaTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionManagerName"</span> <span class="attr">value</span>=<span class="string">"java:/TransactionManager"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>JtaTransactionManager将事务管理的责任委托给javax.transaction.UserTransaction</p><p>和javax.transaction.TransactionManager对象，其中事务成功完成通过UserTransaction.commit()方法提交，事务</p><p>失败通过UserTransaction.rollback()方法回滚。</p><h2 id="方式一-编程式事务-需要手动编写代码"><a href="#方式一-编程式事务-需要手动编写代码" class="headerlink" title="方式一:编程式事务(需要手动编写代码)"></a>方式一:编程式事务(需要手动编写代码)</h2><p><a href="http://www.belonk.com/c/spring_programmatic_transaction.html" target="_blank" rel="noopener"><em>Spring事务管理三：编程式事务</em></a></p><h3 id="配置平台事务管理器"><a href="#配置平台事务管理器" class="headerlink" title="配置平台事务管理器"></a>配置平台事务管理器</h3><p><a href="/2019/07/28/Spring的事务管理/#常见的事务管理器"><em>常见的事务管理器</em></a></p><h3 id="配置事务管理的模板类"><a href="#配置事务管理的模板类" class="headerlink" title="配置事务管理的模板类"></a>配置事务管理的模板类</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.support.TransactionTemplate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionManager"</span> <span class="attr">ref</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="在业务层注入事务管理的模板"><a href="#在业务层注入事务管理的模板" class="headerlink" title="在业务层注入事务管理的模板"></a>在业务层注入事务管理的模板</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置Service --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"com.zjinc36.transaction.AccountServiceImpl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 注入事务管理的模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionTemplate"</span> <span class="attr">ref</span>=<span class="string">"transactionTemplate"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="编写事务管理的代码"><a href="#编写事务管理的代码" class="headerlink" title="编写事务管理的代码"></a>编写事务管理的代码</h3><p>在AccountServiceImpl.java文件,为transfer函数添加事务</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * from:转出帐号 to:转入帐号 money:金额</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(String from, String to, Double money)</span> </span>&#123;</span><br><span class="line">transactionTemplate.execute(<span class="keyword">new</span> TransactionCallbackWithoutResult() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doInTransactionWithoutResult</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">TransactionStatus transactionStatus)</span> </span>&#123;</span><br><span class="line">accountDao.outMoney(from, money);</span><br><span class="line">accountDao.inMoney(to, money);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="方式二-声明式事务"><a href="#方式二-声明式事务" class="headerlink" title="方式二:声明式事务"></a>方式二:声明式事务</h2><p><a href="http://www.belonk.com/c/spring_declarative_transaction.html" target="_blank" rel="noopener"><em>Spring事务管理四：声明式事务</em></a></p><h3 id="事务属性"><a href="#事务属性" class="headerlink" title="事务属性"></a>事务属性</h3><p>在定义事务之前，需要了解一些事务的参数，包括传播机制、隔离级别、是否只读、事务超时等，还包括回滚规则定义等参数。</p><h4 id="事务的传播行为"><a href="#事务的传播行为" class="headerlink" title="事务的传播行为"></a><strong>事务的传播行为</strong></h4><p>如果遇到了特别复杂的业务逻辑,有可能会出现业务之间的方法相互调用<br>我们一般将事务建立在业务层,那么当业务复杂的时候,代码层面上会出现A代码创建了事务,B代码也创建了事务,同时B代码中调用A的代码,这样就会出现事务”嵌套”在一起,而不是一个业务逻辑就一个事务.<br><strong>事务的传播的行为主要用来解决业务层方法相互调用的问题</strong></p><table><thead><tr><th>传播行为</th><th>解释</th><th>备注</th></tr></thead><tbody><tr><td><strong>PROPAGATION_REQUIRED</strong></td><td>如果存在一个事务,则支持当前事务.如果没有事务则开启事务</td><td>Spring中默认的传播行为,前三个用以保证多个操作在同一个事务中</td></tr><tr><td>PROPAGATION_SUPPORTS</td><td>如果存在一个事务,则支持当前事务.如果没有事务,则非事务的执行</td><td></td></tr><tr><td>PROPAGATION_MANDATORY</td><td>如果已经存在一个事务,则支持当前事务.如果没有一个活动的事务,则抛出异常</td><td></td></tr><tr><td><strong>PROPAGATION_REQUIREDS_NEW</strong></td><td>总是开启一个新的事务.如果一个事务已经存在,则将这个存在的事务挂起,并创建一个新的事务,只包含自身操作.如果没有事物,创建一个只包含自身的事务</td><td>用以保证多个操作不在同一个事务中,在批处理,信用卡还款处理,给每一个卡创建一个独立的事务,不会因为一个处理失败,全部失败</td></tr><tr><td>PROPAGATION_NOT_SUPPORTED</td><td>总是非事务的执行,并挂起任何存在的事务</td><td></td></tr><tr><td>PROPAGATION_NEVER</td><td>总是非事务的执行,如果已经存在一个事务,则抛出异常</td><td></td></tr><tr><td><strong>PROPAGATION_NESTED</strong></td><td>如果一个活动的事务存在,则运行在一个嵌套的事务中；如果没有活动事务,则按照PROPAGATION_REQUIRED属性执行(开启一个新的事务)</td><td>嵌套事务,如果A中有事务,按照A的事务执行,执行完成后,设置一个保存点,然后执行B中的操作.如果没有异常,则执行通过,如果有异常,可以选择回滚到初始位置,也可以回滚到保存点</td></tr></tbody></table><h4 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a><strong>隔离级别</strong></h4><p>隔离级别(isolation level)：定义了其他并发事务对当前事务的影响程度，或者说是当前事务对事务数据的自私程度。</p><p>在了解隔离级别定义之前，首先需要了解事务并发带来的问题，包括如下几个方面：</p><ul><li>第一类丢失更新：两个事务更新相同数据，如果第一个事务提交，另一个事务回滚，第一个事务的更新会被回滚。</li><li>脏读(dirty reads)：第二个事务查询到第一个事务未提交的更新数据，第二个事务根据该数据执行，但第一个事务回滚，第二个事务操作脏数据。</li><li>幻读(phantom read)：一个事务查询到了另一个事务已经提交的新数据，导致多次查询数据不一致。</li><li>不可重复读(nonrepeatable read)：一个事务查询到另一个事务已经修改的数据，导致多次查询数据不一致。</li><li>第二类丢失更新：多个事务同时读取相同数据，并完成各自的事务提交，导致最后一个事务提交会覆盖前面所有事务对数据的改变。</li></ul><p>理想情况下，事务是完全隔离的，从而防止上述问题产生，但是这样通常会涉及数据库锁定(锁表、行)数据，造成性能问题。通常，并不是所有应用都需要完全的隔离事务。事务隔离级别提供了事务隔离上的灵活性，从而让开发人员进行灵活的取舍。Spring提供了5中事务隔离级别：</p><table><thead><tr><th>隔离级别</th><th>含义</th></tr></thead><tbody><tr><td>DEFAULT</td><td>使用后端数据库默认的隔离级别(spring中的的选择项)</td></tr><tr><td>READ_UNCOMMITED</td><td>允许你读取还未提交的改变了的数据。可能导致脏、幻、不可重复读</td></tr><tr><td>READ_COMMITTED</td><td>允许在并发事务已经提交后读取。可防止脏读，但幻读和不可重复读仍可发生</td></tr><tr><td>REPEATABLE_READ</td><td>对相同字段的多次读取是一致的，除非数据被事务本身改变。可防止脏、不可重复读，但幻读仍可能发生。</td></tr><tr><td>SERIALIZABLE</td><td>完全服从ACID的隔离级别，确保不发生脏、幻、不可重复读。这在所有的隔离级别中是最慢的，它是典型的通过完全锁定在事务中涉及的数据表来完成的。</td></tr></tbody></table><p>这5中隔离级别中，READ_UNCOMMITED是最高效的但也是隔离程度最低的；而SERIALIZABLE则是效率最低但是隔离程度最高的。<br>Spring的这5中隔离级别在枚举类Isolation中进行了定义，其中最终也是调用的TransactionDefinition接口中的常量定义。</p><h4 id="是否只读"><a href="#是否只读" class="headerlink" title="是否只读"></a><strong>是否只读</strong></h4><p>如果事务只对后端数据进行读操作，那么如果将事务设置为只读事务，可以利用后端数据库优化措施进行适当优化。</p><p>只读事务”并不是一个强制选项，它只是一个“暗示”，提示数据库驱动程序和数据库系统，这个事务并不包含更改数据的操作，那么JDBC驱动程序和数据库就有可能根据这种情况对该事务进行一些特定的优化，比方说不安排相应的数据库锁，以减轻事务对数据库的压力，毕竟事务也是要消耗数据库的资源的。但是你非要在“只读事务”里面修改数据，也并非不可以，只不过对于数据一致性的保护不像“读写事务”那样保险而已。</p><p>因此，“只读事务”仅仅是一个性能优化的推荐配置而已，并非强制你要这样做不可。</p><p>只读事务实在开启事务时有数据库实施的，所以只对具备启动新事务的传播机制有效，如REQUIRED、REQUIRES_NEW、NESTED。</p><h4 id="超时时间"><a href="#超时时间" class="headerlink" title="超时时间"></a><strong>超时时间</strong></h4><p>超时时间定义了当事务执行时间超过一定时间后自动回滚。</p><p>超时机制会在事务开启时启动，所以只对具备启动新事务的传播机制有效，如REQUIRED、REQUIRES_NEW、NESTED。</p><h4 id="回滚规则"><a href="#回滚规则" class="headerlink" title="回滚规则"></a><strong>回滚规则</strong></h4><p>回滚规则定义了事务在遇到什么异常进行回滚、什么异常不进行回滚。默认情况下，事务在遇到运行时异常(RuntimeException)才会回滚，但是我们可以在Spring中进行定义来改变其默认行为。Spring在xml文件配置事务时提供了rollback-for和no-rollback-for参数，来指定回滚和不会滚的异常名称，该名称对应的类为Throwable的子类。</p><p>我们总体了解了事务的各个属性以及对事务的影响，接下来，我们看看在Spring中如何进行声明式事务配置。</p><h3 id="XML配置事务"><a href="#XML配置事务" class="headerlink" title="XML配置事务"></a>XML配置事务</h3><p>基于<a href="/2019/07/28/Spring的事务管理/#搭建Spring的事务管理的环境"><em>基本代码环境</em></a>进行修改</p><h4 id="配置命名空间"><a href="#配置命名空间" class="headerlink" title="配置命名空间"></a>配置命名空间</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="创建事务的规则"><a href="#创建事务的规则" class="headerlink" title="创建事务的规则"></a>创建事务的规则</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- JDBC事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 声明式事务配置 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- proxy-target-class属性值决定是基于接口的还是基于类的代理被创建。首先说明下proxy-target-class="true"和proxy-target-class="false"的区别，为true则是基于类的代理将起作用（需要cglib库），为false或者省略这个属性，则标准的JDK 基于接口的代理将起作用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span></span></span><br><span class="line"><span class="tag"><span class="attr">expression</span>=<span class="string">"execution(* com.zjinc36.transaction.AccountServiceImpl.*(..))"</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"pointcut1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 通用事务通知 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"transfer*"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"query*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"list*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"do*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"Exception"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"save*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"Exception"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"insert*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"Exception"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"Exception"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"delete*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"Exception"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如上所示，在定义通知(tx:advice)时需要依赖事务管理器。</p><p>tx:method的name属性定义了受事务控制的方法名称，可以使用通配符“*”来进行模糊匹配；read-only标识了该方法的事务是否是只读事务；propagation定义事务的传播机制；rollback-for定义那些异常进行回滚；另外还有timeout、no-rollback-for、isolation等属性配置，分别对应事务的超时时间、不会滚异常、隔离级别等。</p><p>aop:config标签进行了aop相关的配置，aop:advisor引用了通知，并定义了事务作用的切点，其采用AspectJ的切入点表达式。关于AOP的配置这里不再赘述</p><h3 id="使用注解配置事务"><a href="#使用注解配置事务" class="headerlink" title="使用注解配置事务"></a>使用注解配置事务</h3><p>除了XML进行声明式事务配置外，还可以采用@Transactional注解来进行事务配置，该注解定义如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Transactional &#123;</span><br><span class="line"></span><br><span class="line"><span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">    <span class="comment">// 事务传播机制</span></span><br><span class="line"><span class="function">Propagation <span class="title">propagation</span><span class="params">()</span> <span class="keyword">default</span> Propagation.REQUIRED</span>;</span><br><span class="line">    <span class="comment">// 事务的隔离级别</span></span><br><span class="line"><span class="function">Isolation <span class="title">isolation</span><span class="params">()</span> <span class="keyword">default</span> Isolation.DEFAULT</span>;</span><br><span class="line">    <span class="comment">// 事务超时时间</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">timeout</span><span class="params">()</span> <span class="keyword">default</span> TransactionDefinition.TIMEOUT_DEFAULT</span>;</span><br><span class="line">    <span class="comment">// 事务是否只读</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">readOnly</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">    <span class="comment">// 定义使事务回滚的异常类</span></span><br><span class="line">Class&lt;? extends Throwable&gt;[] rollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    <span class="comment">// 定义使事务回滚的异常类名称</span></span><br><span class="line">String[] rollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    <span class="comment">// 定义不使异常回滚的异常类</span></span><br><span class="line">Class&lt;? extends Throwable&gt;[] noRollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    <span class="comment">// 定义不使异常回滚的异常类名称</span></span><br><span class="line">String[] noRollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="配置事务管理器"><a href="#配置事务管理器" class="headerlink" title="配置事务管理器"></a>配置事务管理器</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--JDBC事务管理器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="开启注解事务支持"><a href="#开启注解事务支持" class="headerlink" title="开启注解事务支持"></a>开启注解事务支持</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>这个配置告诉Spring，检查所管理的配置了@Transactional注解的bean，并为它们添加事务通知</p><h4 id="在代码中使用注解"><a href="#在代码中使用注解" class="headerlink" title="在代码中使用注解"></a>在代码中使用注解</h4><p>@Transactional注解可以用于类和方法上，用于类上表示事务定义应用于该类的所有方法，用于方法则表示单独定义该方法的事务控制属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法受事务控制，而且抛出RuntimeException，事务回滚，无法插入数据</span></span><br><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tryInsert</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">    <span class="comment">// 模拟抛出异常，事务回滚</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"hahaha"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法不受事务控制，可以正常插入数据</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tryInsert</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">    <span class="comment">// 模拟抛出异常，事务回滚</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"hahaha"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法受事务控制，但是抛出的是Exception，默认不会滚，可以正常插入数据</span></span><br><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tryInsert</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">    <span class="comment">// 模拟抛出异常，事务回滚</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"hahaha"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用于类上：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.SUPPORTS, readOnly = <span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>告诉Spring，UserServiceImpl这个bean下的所有方法都可以支持事务，传播机制为SUPPORTS，默认都是只读事务。当然，如果方法上定义了事务，会采用方法的事务设置，遵循就近原则</p><p>在查找事务相关问题时，将Spring日志级别设定为DEBUG，就可以清楚的看到事务相关的日志信息，便于调试问题</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>可以从传播机制、隔离级别、是否只读、事务超时、回滚规则等方面来描述事务。Spring提供了xml和注解两者事务声明方式：</p><p>采用xml：需要使用tx命名空间，好处是在xml中完成事务定义，代码中不需要做任何事务相关的编码；但是，事务控制的方法名称需要遵循一定的规则，一遍Spring能够匹配到并为其加入事务通知。</p><p>采用注解：xml仅需一行配置，其他的事务控制都可以通过编码加上注解实现，而且对方法名称没有要求；如果整个应用不需要事务控制，取消xml配置即可。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的JDBC的模板的使用</title>
      <link href="/2019/07/22/Spring%E7%9A%84JDBC%E7%9A%84%E6%A8%A1%E6%9D%BF%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2019/07/22/Spring%E7%9A%84JDBC%E7%9A%84%E6%A8%A1%E6%9D%BF%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h1><p>引入jar包</p><ul><li>引入基本开发包</li><li>数据库驱动</li><li>Spring的JDBC模板的jar包<br><img src="/images/20190721003.png" alt></li></ul><h1 id="入门程序"><a href="#入门程序" class="headerlink" title="入门程序"></a>入门程序</h1><p>此时连接池直接出现在代码中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.jdbc.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.DriverManagerDataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JDBC模板的使用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo1</span> </span>&#123;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jdbc模板的使用类似与DButils</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 创建连接池</span></span><br><span class="line">DriverManagerDataSource dataSource = <span class="keyword">new</span> DriverManagerDataSource();</span><br><span class="line">dataSource.setDriverClassName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">dataSource.setUrl(<span class="string">"jdbc:mysql:///spring_jdbc"</span>);</span><br><span class="line">dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">dataSource.setPassword(<span class="string">"root"</span>);</span><br><span class="line"><span class="comment">// 创建jdbc模板</span></span><br><span class="line">JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">jdbcTemplate.update(<span class="string">"insert into account values(null, ?, ?)"</span>, <span class="string">"zhangsan"</span>, <span class="number">10000</span>d);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="将连接池和模板交给Spring管理"><a href="#将连接池和模板交给Spring管理" class="headerlink" title="将连接池和模板交给Spring管理"></a>将连接池和模板交给Spring管理</h1><p>本质上就是将配置信息提取到xml文件中</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置Spring的内置连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"dataSourcePool"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 属性注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///spring_jdbc"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSourcePool"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.jdbc.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo2</span> </span>&#123;</span><br><span class="line"><span class="meta">@Resource</span>(name=<span class="string">"jdbcTemplate"</span>)</span><br><span class="line"><span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">jdbcTemplate.update(<span class="string">"insert into account value(null, ?, ?)"</span>, <span class="string">"lisi"</span>, <span class="number">1000</span>d);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="配置不同的连接池"><a href="#配置不同的连接池" class="headerlink" title="配置不同的连接池"></a>配置不同的连接池</h1><h2 id="Spring内置的连接池"><a href="#Spring内置的连接池" class="headerlink" title="Spring内置的连接池"></a>Spring内置的连接池</h2><p>上面的代码就是用这种方式</p><ol><li>applicationContext.xml<br>org.springframework.jdbc.datasource.DriverManagerDataSource<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"dataSourcePool"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 属性注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///spring_jdbc"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="DHCP连接池"><a href="#DHCP连接池" class="headerlink" title="DHCP连接池"></a>DHCP连接池</h2><ol><li>jar包<br><img src="/images/20190721005.png" alt></li><li>applicationContext.xml<br>org.apache.commons.dbcp.BasicDataSource<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"dataSourcePool"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 属性注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///spring_jdbc"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="c3p0连接池"><a href="#c3p0连接池" class="headerlink" title="c3p0连接池"></a>c3p0连接池</h2><ol><li>jar包<br><img src="/images/20190721006.png" alt></li><li>applicationContext.xml<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"dataSourcePool"</span> <span class="attr">class</span>=<span class="string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 属性注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql:///spring_jdbc"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="将详细配置从xml中提取到外部配置文件中"><a href="#将详细配置从xml中提取到外部配置文件中" class="headerlink" title="将详细配置从xml中提取到外部配置文件中"></a>将详细配置从xml中提取到外部配置文件中</h1><p><a href="https://blog.csdn.net/totally123/article/details/79671304" target="_blank" rel="noopener"><em>Spring引入外部properties文件</em></a></p><h2 id="定义一个属性文件"><a href="#定义一个属性文件" class="headerlink" title="定义一个属性文件"></a>定义一个属性文件</h2><p>jdbc.properties</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driverClass=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql:<span class="comment">///spring_jdbc</span></span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=root</span><br></pre></td></tr></table></figure><h2 id="applicationContext-xml文件中引入属性文件"><a href="#applicationContext-xml文件中引入属性文件" class="headerlink" title="applicationContext.xml文件中引入属性文件"></a>applicationContext.xml文件中引入属性文件</h2><ol><li><p>第一种方式,通过bean标签引入</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span> <span class="attr">value</span>=<span class="string">"classpath:jdbc.properties"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>第二种方式,使用context标签</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"classpath:jdbc.properties"</span> /&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="此时applicationContext-xml应该怎么写"><a href="#此时applicationContext-xml应该怎么写" class="headerlink" title="此时applicationContext.xml应该怎么写"></a>此时applicationContext.xml应该怎么写</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 引入属性文件 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 第一种方式通过一个Bean标签引入的(很少使用) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span> <span class="attr">value</span>=<span class="string">"classpath:jdbc.properties"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Spring的内置连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourcePool"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 属性注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span></span></span><br><span class="line"><span class="tag"><span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClass&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSourcePool"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="模板的CURD操作"><a href="#模板的CURD操作" class="headerlink" title="模板的CURD操作"></a>模板的CURD操作</h1><p><a href="https://blog.csdn.net/alan_liuyue/article/details/88247828" target="_blank" rel="noopener"><em>spring的JdbcTemplate模板类的常用操作</em></a></p><h2 id="增删改操作"><a href="#增删改操作" class="headerlink" title="增删改操作"></a>增删改操作</h2><p><a href="https://blog.csdn.net/chensanwa/article/details/79168244" target="_blank" rel="noopener"><em>Spring入门之JdbcTemplate【一】增加、删除、修改数据库表数据</em></a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.jdbc.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo2</span> </span>&#123;</span><br><span class="line"><span class="meta">@Resource</span>(name = <span class="string">"jdbcTemplate"</span>)</span><br><span class="line"><span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 保存操作</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">jdbcTemplate.update(<span class="string">"insert into account value(null, ?, ?)"</span>, <span class="string">"lisi"</span>,</span><br><span class="line"><span class="number">1000</span>d);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除操作</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 调用jdbcTemplate对象的方法实现删除操作</span></span><br><span class="line">String sql = <span class="string">"DELETE FROM account WHERE name=?"</span>;</span><br><span class="line"><span class="keyword">int</span> rows = jdbcTemplate.update(sql, <span class="string">"Lucy"</span>);</span><br><span class="line">System.out.println(rows);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改操作</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 调用jdbcTemplate对象的方法实现修改操作</span></span><br><span class="line">String sql = <span class="string">"update account set name=? where id=?"</span>;</span><br><span class="line"><span class="keyword">int</span> rows = jdbcTemplate.update(sql, <span class="string">"Lucy"</span>, <span class="number">1</span>);</span><br><span class="line">System.out.println(rows);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="查操作"><a href="#查操作" class="headerlink" title="查操作"></a>查操作</h2><p><a href="https://blog.csdn.net/chensanwa/article/details/79168245" target="_blank" rel="noopener"><em>Spring入门之JdbcTemplate【二】查询数据库表数据</em></a></p><h3 id="将查询数据封装进对象"><a href="#将查询数据封装进对象" class="headerlink" title="将查询数据封装进对象"></a>将查询数据封装进对象</h3><ol><li><p>创建对象(将数据封装进对象)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ckage com.zjinc36.jdbc.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> Double money;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Double <span class="title">getMoney</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> money;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMoney</span><span class="params">(Double money)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.money = money;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Account [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">", money="</span> + money</span><br><span class="line">+ <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>自己写类实现接口,自己做数据封装</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.jdbc.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.RowMapper;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyRowMapper</span> <span class="keyword">implements</span> <span class="title">RowMapper</span>&lt;<span class="title">Account</span>&gt; </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Account <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">Account account = <span class="keyword">new</span> Account();</span><br><span class="line">account.setId(rs.getInt(<span class="string">"id"</span>));</span><br><span class="line">account.setName(rs.getString(<span class="string">"name"</span>));</span><br><span class="line">account.setMoney(rs.getDouble(<span class="string">"money"</span>));</span><br><span class="line"><span class="keyword">return</span> account;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>取出数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.jdbc.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo2</span> </span>&#123;</span><br><span class="line"><span class="meta">@Resource</span>(name = <span class="string">"jdbcTemplate"</span>)</span><br><span class="line"><span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询返回对象</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testObject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Account account = jdbcTemplate.queryForObject(</span><br><span class="line"><span class="string">"select * from account where id=?"</span>, <span class="keyword">new</span> MyRowMapper(), <span class="number">2</span>);</span><br><span class="line">System.out.println(account);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="查询表中有多少条记录"><a href="#查询表中有多少条记录" class="headerlink" title="查询表中有多少条记录"></a>查询表中有多少条记录</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.jdbc.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo2</span> </span>&#123;</span><br><span class="line"><span class="meta">@Resource</span>(name = <span class="string">"jdbcTemplate"</span>)</span><br><span class="line"><span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询表中有多少条记录</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 调用方法得到记录数</span></span><br><span class="line">String sql = <span class="string">"select count(*) from account"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用jdbcTemplate方法得到记录</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * queryForObject(String sql,Class&lt;T&gt; requiredType) 第一个参数：sql语句</span></span><br><span class="line"><span class="comment"> * 第二个参数：返回类型的class</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">int</span> count = jdbcTemplate.queryForObject(sql, Integer.class);</span><br><span class="line">System.out.println(count);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="查询所有对象list集合"><a href="#查询所有对象list集合" class="headerlink" title="查询所有对象list集合"></a>查询所有对象list集合</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.jdbc.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcDemo2</span> </span>&#123;</span><br><span class="line"><span class="meta">@Resource</span>(name = <span class="string">"jdbcTemplate"</span>)</span><br><span class="line"><span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询所有对象list集合</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 写SQL语句，根据username查询</span></span><br><span class="line">String sql = <span class="string">"select * from account"</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * query(String sql,RowMapper&lt;T&gt; rowMapper,Object ... args) 第一个参数：SQL语句</span></span><br><span class="line"><span class="comment"> * 第二个参数：RowMapper接口，自己写类实现数据封装 第三个参数：可变参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 调用jdbcTemplate的query()方法</span></span><br><span class="line">List&lt;Account&gt; list = jdbcTemplate.query(sql, <span class="keyword">new</span> MyRowMapper());</span><br><span class="line">System.out.println(list);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的AOP根据参数名称获取参数的值</title>
      <link href="/2019/07/21/Spring%E7%9A%84aop%E6%A0%B9%E6%8D%AE%E5%8F%82%E6%95%B0%E5%90%8D%E7%A7%B0%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%E7%9A%84%E5%80%BC/"/>
      <url>/2019/07/21/Spring%E7%9A%84aop%E6%A0%B9%E6%8D%AE%E5%8F%82%E6%95%B0%E5%90%8D%E7%A7%B0%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%E7%9A%84%E5%80%BC/</url>
      
        <content type="html"><![CDATA[<h1 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h1><p><a href="https://blog.csdn.net/qq_30038111/article/details/94406589" target="_blank" rel="noopener">Spring Aop根据参数名称获取参数的值（JoinPoint根据参数名获取参数的值）</a></p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.ArrayUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.controller包及子包下的所有类的所有方法使用aop</span></span><br><span class="line"><span class="comment">     * 2.RoomController下的list方法不使用aop</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(value = <span class="string">"execution(* com.open.controller..*.*(..)) &amp;&amp; !execution(* com.open.controller.RoomController.list(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sdkAuth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 案例：通过aop控制公共参数的校验</span></span><br><span class="line"><span class="comment">     * 1.针对下面的接口，使用<span class="doctag">@RequestParam</span>注解，不管是get/post请求，都是有效的</span></span><br><span class="line"><span class="comment">     * 2.HttpServletRequest#getParameter，调用接口时的参数为appId=xxx或者groupAppId=xxx，使用getParameter("appId");都可以获取到，但getParameter("groupAppId")只可以获取到groupAppId=xxx</span></span><br><span class="line"><span class="comment">     * 3.在通知中，是针对方法列表中的参数名，而非注解指定的参数名</span></span><br><span class="line"><span class="comment">     * public Object list(String accessToken, <span class="doctag">@RequestParam</span>("appId") String groupAppId, String subGroupAppId) &#123;&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"sdkAuth()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">doAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        MethodSignature methodSignature = (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        String[] parameterNames = methodSignature.getParameterNames();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取accessToken的下表</span></span><br><span class="line">        <span class="keyword">int</span> accessTokenIndex = ArrayUtils.indexOf(parameterNames, <span class="string">"accessToken"</span>);</span><br><span class="line">        <span class="comment">// 获取groupAppId的下标</span></span><br><span class="line">        <span class="keyword">int</span> groupAppIdIndex = ArrayUtils.indexOf(parameterNames, <span class="string">"groupAppId"</span>);</span><br><span class="line">        <span class="comment">// 获取subGroupAppId的下标</span></span><br><span class="line">        <span class="keyword">int</span> subGroupAppIdIndex = ArrayUtils.indexOf(parameterNames, <span class="string">"subGroupAppId"</span>);</span><br><span class="line">        <span class="keyword">if</span> (accessTokenIndex == -<span class="number">1</span> || groupAppIdIndex == -<span class="number">1</span> || subGroupAppIdIndex == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"error"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 方法参数的值，返回的数组按照方法定义的顺序，对于null值的，在debug时，不会显示null的数组下表，例如：</span></span><br><span class="line"><span class="comment">         * public Object list(String accessToken, <span class="doctag">@RequestParam</span>("appId") String groupAppId, String subGroupAppId) &#123;&#125;</span></span><br><span class="line"><span class="comment">         * 传参：accessToken=xxx&amp;subGroupAppId=xxx</span></span><br><span class="line"><span class="comment">         * Object[] args = joinPoint.getArgs();获取的值，在debug时</span></span><br><span class="line"><span class="comment">         *      args[0] = xxx</span></span><br><span class="line"><span class="comment">         *      args[2] = xxx</span></span><br><span class="line"><span class="comment">         * 对于args[1]，虽然debug时没有显示这个变量，但实际上它是存在的，值为null</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        String accessToken = String.valueOf(args[accessTokenIndex]);</span><br><span class="line">        String groupAppId = String.valueOf(args[groupAppIdIndex]);</span><br><span class="line">        String subGroupAppId = String.valueOf(args[subGroupAppIdIndex]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equals(accessToken, <span class="string">"null"</span>) || StringUtils.equals(groupAppId, <span class="string">"null"</span>) || StringUtils.equals(subGroupAppId, <span class="string">"null"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"error"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> joinPoint.proceed();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring使用注解方式实现AOP</title>
      <link href="/2019/07/21/Spring%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0AOP/"/>
      <url>/2019/07/21/Spring%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0AOP/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/yerenyuan_pku/article/details/52865330" target="_blank" rel="noopener"><em>参考:使用Spring的注解方式实现AOP入门</em></a><br><a href="https://blog.csdn.net/yerenyuan_pku/article/details/52879669" target="_blank" rel="noopener"><em>参考:使用Spring的注解方式实现AOP的细节</em></a></p><h1 id="需要引入的包"><a href="#需要引入的包" class="headerlink" title="需要引入的包"></a>需要引入的包</h1><p>首先在Eclipse中新建一个普通的Java Project，名称为springAOP。为了使用Spring的注解方式进行面向切面编程，需要在springAOP项目中加入与AOP相关的jar包，spring aop需要额外的jar包有：</p><ul><li>com.springsource.org.aopalliance-1.0.0.jar</li><li>com.springsource.org.aspectj.weaver-1.6.8.RELEASE.jar</li><li>spring-aop-4.2.5.RELEASE.jar</li><li>spring-aspects-4.2.5.RELEASE.jar</li></ul><p>这样，springAOP项目共须jar包如下：<br><img src="/images/20190721002.png" alt><br>要进行AOP编程，我们接着要在Spring的配置文件——beans.xml中引入aop命名空间：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop-4.2.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Spring提供了两种切面声明方式，实际工作中我们可以选用其中一种：</p><ul><li>基于XML配置方式声明切面。</li><li>基于注解方式声明切面。<br>本文选用第二种方式进行面向切面编程，即基于Spring注解的方式声明切面</li></ul><h1 id="使用注解的方式实现AOP案例"><a href="#使用注解的方式实现AOP案例" class="headerlink" title="使用注解的方式实现AOP案例"></a>使用注解的方式实现AOP案例</h1><ol><li><p>我们在src目录下新建一个it.cast.service包，并在该包下创建PersonService接口，其代码为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(String name)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String name, Integer id)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPersonName</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>紧接着在src目录下新建一个it.cast.service.impl包，并在该包下创建PersonService接口的实现类——PersonServiceBean.java，其代码为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonServiceImpl</span> <span class="keyword">implements</span> <span class="title">PersonService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"我是save()方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String name, Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"我是update()方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPersonName</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"我是getPersonName()方法"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"xxx"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>然后，我们就要在cn.itcast.service包下创建一个切面类——MyInterceptor.java，下面我们来按照以下步骤将其写出来。</p></li></ol><p><strong>首先用@Aspect注解声明整个类是一个切面</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>其次用@Pointcut注解声明一个切入点</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Aspect</span><br><span class="line">public class MyInterceptor &#123;</span><br><span class="line">    @Pointcut(&quot;execution (* cn.itcast.service.impl.PersonServiceImpl.*(..))&quot;)</span><br><span class="line">    private void anyMethod() &#123;&#125; // 声明一个切入点，anyMethod为切入点名称</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>然后,我们可利用方法签名来编写切入点表达式</strong><br>最典型的切入点表达式是根据方法的签名来匹配各种方法</p><blockquote><p>  <code>execution (* cn.itcast.service.impl.PersonServiceImpl.*(..))</code>：匹配PersonServiceImpl类中声明的所有方法。第一个*代表任意修饰符及任意返回值类型，第二个*代表任意方法，..匹配任意数量任意类型的参数，若目标类与该切面在同一个包中，可以省略包名。<br>  <code>execution public * cn.itcast.service.impl.PersonServiceImpl.*(..)</code>：匹配PersonServiceImpl类中的所有公有方法。<br>  <code>execution public double cn.itcast.service.impl.PersonServiceImpl.*(..)</code>：匹配PersonServiceImpl类中返回值类型为double类型的所有公有方法。<br>  <code>execution public double cn.itcast.service.impl.PersonServiceImpl.*(double, ..)</code>：匹配PersonServiceImpl类中第一个参数为double类型，后面不管有无参数的所有公有方法，并且该方法的返回值类型为double类型。<br>  <code>execution public double cn.itcast.service.impl.PersonServiceImpl.*(double, double)</code>：匹配PersonServiceImpl类中参数类型为double，double类型的，并且返回值类型也为double类型的所有公有方法。</p></blockquote><p><strong>接着声明前置通知方法</strong><br>前置通知方法在目标方法开始之前执行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution (* cn.itcast.service.impl.PersonServiceImpl.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">anyMethod</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// 声明一个切入点，anyMethod为切入点名称</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声明该方法是一个前置通知：在目标方法开始之前执行</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"前置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：若是将一个类声明为一个切面，那么需要把该类放到IOC容器管理。</p><ol start="4"><li><p>接下来，我们理应要修改Spring的配置文件——beans.xml了，将其改为：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context-4.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/aop/spring-aop-4.2.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myInterceptor"</span> <span class="attr">class</span>=<span class="string">"cn.itcast.service.MyInterceptor"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"personService"</span> <span class="attr">class</span>=<span class="string">" cn.itcast.service.impl.PersonServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>最后，在src目录下新建一个junit.test包，并在该包中新建一个单元测试类——SpringAOPTest.java，其代码为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringAOPTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">interceptorTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationContext cxt = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"beans.xml"</span>);</span><br><span class="line">        PersonService personService = (PersonService) cxt.getBean(<span class="string">"personService"</span>);</span><br><span class="line">        personService.save(<span class="string">"xxx"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="如何使用各种通知"><a href="#如何使用各种通知" class="headerlink" title="如何使用各种通知"></a>如何使用各种通知</h1><p>前面我们已经入门使用Spring的注解方式实现AOP了，现在我们再来学习使用Spring的注解方式实现AOP的一些细节。<br>本文是来讲解使用Spring的注解方式实现AOP的一些细节，其实说白了就是学习如何使用各种通知而已，例如前置通知、后置通知、异常通知、最终通知、环绕通知等，之前我们已经学习了前置通知，现在就来学习剩余的通知。</p><h2 id="后置通知"><a href="#后置通知" class="headerlink" title="后置通知"></a>后置通知</h2><p>我们先来看后置通知，此时须将MyInterceptor类的代码修改为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> li ayun</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution (* cn.itcast.service.impl.PersonServiceImpl.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">anyMethod</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// 声明一个切入点，anyMethod为切入点名称</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声明该方法是一个前置通知：在目标方法开始之前执行</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"前置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"后置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="最终通知"><a href="#最终通知" class="headerlink" title="最终通知"></a>最终通知</h2><p>我们再来看最终通知，此时须将MyInterceptor类的代码修改为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> li ayun</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution (* cn.itcast.service.impl.PersonServiceImpl.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">anyMethod</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// 声明一个切入点，anyMethod为切入点名称</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声明该方法是一个前置通知：在目标方法开始之前执行</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"前置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"后置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"最终通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="异常通知"><a href="#异常通知" class="headerlink" title="异常通知"></a>异常通知</h2><p>再接者，我们来看一下异常通知，异常通知是在目标方法抛异常时执行的，故我们应将PersonServiceImpl类的代码改为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonServiceImpl</span> <span class="keyword">implements</span> <span class="title">PersonService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"我是异常"</span>);</span><br><span class="line">        <span class="comment">// System.out.println("我是save()方法");</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String name, Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"我是update()方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPersonName</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"我是getPersonName()方法"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"xxx"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在MyInterceptor类中声明异常通知方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> li ayun</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution (* cn.itcast.service.impl.PersonServiceImpl.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">anyMethod</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// 声明一个切入点，anyMethod为切入点名称</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声明该方法是一个前置通知：在目标方法开始之前执行</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"前置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"后置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"最终通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterThrowing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"异常通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="环绕通知"><a href="#环绕通知" class="headerlink" title="环绕通知"></a>环绕通知</h2><p>最后，我们来看一下环绕通知，Struts2提供的拦截器就属于环绕通知，环绕通知在我们做权限系统时将大量使用。这时，我们还是将PersonServiceImpl类的代码恢复为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonServiceImpl</span> <span class="keyword">implements</span> <span class="title">PersonService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// throw new RuntimeException("我是异常");</span></span><br><span class="line">        System.out.println(<span class="string">"我是save()方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String name, Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"我是update()方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPersonName</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"我是getPersonName()方法"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"xxx"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>然后在MyInterceptor类中声明环绕通知方法，环绕通知方法的写法是固定的，形如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">doBasicProfiling</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样，MyInterceptor类的代码应该是：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> li ayun</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution (* cn.itcast.service.impl.PersonServiceImpl.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">anyMethod</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// 声明一个切入点，anyMethod为切入点名称</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声明该方法是一个前置通知：在目标方法开始之前执行</span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"前置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"后置通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"最终通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterThrowing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"异常通知"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"anyMethod()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">doBasicProfiling</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 环绕通知内部一定要确保执行该方法，如果不执行该方法，业务bean中被拦截的方法就不会被执行。</span></span><br><span class="line"><span class="comment">         * 当执行该方法，如果后面还有切面的话，它的执行顺序应该是这样的：先执行后面的切面，如果后面没有切面了，</span></span><br><span class="line"><span class="comment">         * 再执行最终的目标对象的业务方法。若不执行该方法，则后面的切面，业务bean的方法都不会被执行。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// if () &#123; // 判断用户是否有权限，</span></span><br><span class="line">        System.out.println(<span class="string">"进入方法"</span>);</span><br><span class="line">        Object result = pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">"退出方法"</span>);</span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：环绕通知内部一定要确保执行proceed()该方法，如果不执行该方法，业务bean中被拦截的方法就不会被执行。当执行该方法，如果后面还有切面的话，它的执行顺序应该是这样的：先执行后面的切面，如果后面没有切面了，再执行最终的目标对象的业务方法。若不执行该方法，则后面的切面，业务bean的方法都不会被执行。<br>其实我们仅使用环绕通知就可以实现前置通知、后置通知、异常通知、最终通知等的效果。</p><h1 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h1><p>前面部分我们已经学会了如何使用各种通知，例如前置通知、后置通知、异常通知、最终通知、环绕通知等，现在我们再来看使用Spring的注解方式实现AOP的另一些细节。</p><h2 id="细节一：需要得到输入参数"><a href="#细节一：需要得到输入参数" class="headerlink" title="细节一：需要得到输入参数"></a>细节一：需要得到输入参数</h2><p>如在前置通知里面，得到用户输入的数据。此时，须将前置通知方法修改为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span>(<span class="string">"anyMethod() &amp;&amp; args(name)"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAccessCheck</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"前置通知："</span> + name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@Before(“anyMethod() &amp;&amp; args(name)”)匹配的是PersonServiceImpl类中参数为String类型的方法，即save()方法。<br>测试SpringAOPTest类的interceptorTest()方法，可以发现Eclipse控制台打印：</p><h2 id="细节二：如我要获得PersonServiceImpl类中的getPersonName-方法的返回参数"><a href="#细节二：如我要获得PersonServiceImpl类中的getPersonName-方法的返回参数" class="headerlink" title="细节二：如我要获得PersonServiceImpl类中的getPersonName()方法的返回参数"></a>细节二：如我要获得PersonServiceImpl类中的getPersonName()方法的返回参数</h2><p>此时，须将后置通知方法修改为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterReturning</span>(pointcut=<span class="string">"anyMethod()"</span>, returning=<span class="string">"result"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"后置通知："</span> + result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@AfterReturning(pointcut=”anyMethod()”, returning=”result”)匹配的是PersonServiceImpl类中返回值类型为String的方法，并且returning属性能将返回值传入进后置通知方法里面。<br>我们还要修改SpringAOPTest类的代码为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringAOPTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">interceptorTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationContext cxt = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"beans.xml"</span>);</span><br><span class="line">        PersonService personService = (PersonService) cxt.getBean(<span class="string">"personService"</span>);</span><br><span class="line">        personService.getPersonName(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="细节三：在目标方法出现异常时，得到抛出的异常"><a href="#细节三：在目标方法出现异常时，得到抛出的异常" class="headerlink" title="细节三：在目标方法出现异常时，得到抛出的异常"></a>细节三：在目标方法出现异常时，得到抛出的异常</h2><p>为了便于试验，我们须将PersonServiceImpl类的代码修改为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonServiceImpl</span> <span class="keyword">implements</span> <span class="title">PersonService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"我是异常"</span>);</span><br><span class="line">        <span class="comment">// System.out.println("我是save()方法");</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String name, Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"我是update()方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPersonName</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"我是getPersonName()方法"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"xxx"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后将异常通知方法修改为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterThrowing</span>(pointcut=<span class="string">"anyMethod()"</span>, throwing=<span class="string">"e"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterThrowing</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"异常通知："</span> + e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后，我们还要将SpringAOPTest类的代码改为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringAOPTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">interceptorTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApplicationContext cxt = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"beans.xml"</span>);</span><br><span class="line">        PersonService personService = (PersonService) cxt.getBean(<span class="string">"personService"</span>);</span><br><span class="line">        personService.save(<span class="string">"xxx"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的切点表达式写法</title>
      <link href="/2019/07/21/Spring%E7%9A%84%E5%88%87%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%86%99%E6%B3%95/"/>
      <url>/2019/07/21/Spring%E7%9A%84%E5%88%87%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%86%99%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="Aspectj切入点语法定义"><a href="#Aspectj切入点语法定义" class="headerlink" title="Aspectj切入点语法定义"></a>Aspectj切入点语法定义</h1><p>在使用spring框架配置AOP的时候，不管是通过XML配置文件还是注解的方式都需要定义pointcut”切入点”</p><p>例如定义切入点表达式<code>execution(* com.sample.service.impl..*.*(..))</code></p><p>execution()是最常用的切点函数，其语法如下所示：</p><blockquote><p>  整个表达式可以分为五个部分：<br>  1、execution(): 表达式主体。<br>  2、第一个*号：表示返回类型，*号表示所有的类型。<br>  3、包名：表示需要拦截的包名，后面的两个句点表示当前包和当前包的所有子包，com.sample.service.impl包、子孙包下所有类的方法。<br>  4、第二个*号：表示类名，*号表示所有的类。<br>  5、*(..):最后这个星号表示方法名，*号表示所有的方法，后面括弧里面表示方法的参数，两个句点表示任何参数。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的通知类型</title>
      <link href="/2019/07/21/Spring%E7%9A%84%E9%80%9A%E7%9F%A5%E7%B1%BB%E5%9E%8B/"/>
      <url>/2019/07/21/Spring%E7%9A%84%E9%80%9A%E7%9F%A5%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h1><p><a href="/2019/07/21/Spring的AOP的入门开发/"><em>项目基本代码</em></a></p><h1 id="前置通知"><a href="#前置通知" class="headerlink" title="前置通知"></a>前置通知</h1><p>在目标方法执行之前进行操作</p><ul><li>修改切面类,获得切入点信息<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspectXML</span> </span>&#123;</span><br><span class="line"><span class="comment">//前置通知</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeMethod</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"前置通知"</span> + joinPoint);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="后置通知"><a href="#后置通知" class="headerlink" title="后置通知"></a>后置通知</h1><p>在目标方法执行之后进行操作</p><ol><li><p>ProductDaoImpl.java增加返回值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductDaoImpl</span> <span class="keyword">implements</span> <span class="title">ProductDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"save"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"saveReturn"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>切面类增加后置通知和打印上述返回值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspectXML</span> </span>&#123;</span><br><span class="line">    <span class="comment">//后置通知</span></span><br><span class="line">    <span class="comment">//这里参数一定是Object对象</span></span><br><span class="line">    <span class="comment">//参数命名要和applicationContext.xml中的命名一致</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterMethod</span><span class="params">(Object productDaoImplResult)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"后置方法"</span> + productDaoImplResult);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在applicationContext.xml文件中增加后置通知和获得返回值设置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"productDao"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.spring.aop.ProductDaoImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 将切面类交给Spring管理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspect"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.spring.aop.MyAspectXML"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 通过AOP的配置完成对目标类产生代理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">表达式配置哪些类的哪些方法需要进行增强</span></span><br><span class="line"><span class="comment">对哪些点进行拦截</span></span><br><span class="line"><span class="comment">*表示任意返回值</span></span><br><span class="line"><span class="comment">..表示任意参数</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.zjinc36.spring.aop.ProductDaoImpl.save(..) )"</span> <span class="attr">id</span>=<span class="string">"product1"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置切面 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">ref:切面id</span></span><br><span class="line"><span class="comment">returning:切点product1的返回值会赋值给productDaoImplResult,并传递给切面中的afterMethod方法</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspect"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 后置通知 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"afterMethod"</span> <span class="attr">pointcut-ref</span>=<span class="string">"product1"</span> <span class="attr">returning</span>=<span class="string">"productDaoImplResult"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="环绕通知"><a href="#环绕通知" class="headerlink" title="环绕通知"></a>环绕通知</h1><p>在目标方法执行之前和之后进行操作</p><ol><li><p>修改切面类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspectXML</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">aroundMethod</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"环绕前通知"</span>);</span><br><span class="line">Object obj = joinPoint.proceed();</span><br><span class="line">System.out.println(<span class="string">"环绕后通知"</span>);</span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>applicationContext.xml增加环绕通知</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"productDao"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"com.zjinc36.spring.aop.ProductDaoImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 将切面类交给Spring管理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspect"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.spring.aop.MyAspectXML"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 通过AOP的配置完成对目标类产生代理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 表达式配置哪些类的哪些方法需要进行增强 对哪些点进行拦截 * 表示任意返回值 .. 表示任意参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span></span></span><br><span class="line"><span class="tag"><span class="attr">expression</span>=<span class="string">"execution(* com.zjinc36.spring.aop.ProductDaoImpl.save(..) )"</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"product1"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置切面 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ref:切面id --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspect"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 环绕通知 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"aroundMethod"</span> <span class="attr">pointcut-ref</span>=<span class="string">"product1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="异常抛出通知"><a href="#异常抛出通知" class="headerlink" title="异常抛出通知"></a>异常抛出通知</h1><p>在程序出现异常的时候,进行操作</p><ol><li><p>修改切面类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspectXML</span> </span>&#123;</span><br><span class="line"><span class="comment">//异常抛出通知</span></span><br><span class="line"><span class="comment">//xml文件规定了用ex变量将错误信息传进来,即这边使用的变量要和xml文件中规定的变量相同</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">throwing</span><span class="params">(Throwable ex)</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"异常抛出通知"</span>);</span><br><span class="line">System.out.println(<span class="string">"异常内容"</span> + ex.getMessage());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>applicationContext.xml中增加异常抛出通知</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"productDao"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"com.zjinc36.spring.aop.ProductDaoImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 将切面类交给Spring管理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspect"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.spring.aop.MyAspectXML"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 通过AOP的配置完成对目标类产生代理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 表达式配置哪些类的哪些方法需要进行增强 对哪些点进行拦截 * 表示任意返回值 .. 表示任意参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span></span></span><br><span class="line"><span class="tag"><span class="attr">expression</span>=<span class="string">"execution(* com.zjinc36.spring.aop.ProductDaoImpl.save(..) )"</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"product1"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置切面 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ref:切面id --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- throwing:切点product1抛出的异常会被赋值到throwing规定变量ex中,并传递给切面所对应的方法throwing中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspect"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"throwing"</span> <span class="attr">pointcut-ref</span>=<span class="string">"product1"</span> <span class="attr">throwing</span>=<span class="string">"ex"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p><strong>注意:测试的时候什么都不会,是因为程序中没有任何异常,只有有异常的时候才会处理到切面类</strong></p><h1 id="最终通知"><a href="#最终通知" class="headerlink" title="最终通知"></a>最终通知</h1><p>无论代码是否有异常,总是会执行</p><ol><li><p>修改切面类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspectXML</span> </span>&#123;</span><br><span class="line"><span class="comment">//最终通知</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterFinalMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"最终通知"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>applicationContext.xml增加最终通知</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"productDao"</span></span></span><br><span class="line"><span class="tag"><span class="attr">class</span>=<span class="string">"com.zjinc36.spring.aop.ProductDaoImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 将切面类交给Spring管理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspect"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.spring.aop.MyAspectXML"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 通过AOP的配置完成对目标类产生代理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 表达式配置哪些类的哪些方法需要进行增强 对哪些点进行拦截 * 表示任意返回值 .. 表示任意参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span></span></span><br><span class="line"><span class="tag"><span class="attr">expression</span>=<span class="string">"execution(* com.zjinc36.spring.aop.ProductDaoImpl.save(..) )"</span></span></span><br><span class="line"><span class="tag"><span class="attr">id</span>=<span class="string">"product1"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置切面 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ref:切面id --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspect"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"afterFinalMethod"</span> <span class="attr">pointcut-ref</span>=<span class="string">"product1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="通知同时出现时-通知的顺序如下"><a href="#通知同时出现时-通知的顺序如下" class="headerlink" title="通知同时出现时,通知的顺序如下"></a>通知同时出现时,通知的顺序如下</h1><p><img src="/images/20190721001.png" alt></p><h1 id="引介通知-不用知道"><a href="#引介通知-不用知道" class="headerlink" title="引介通知(不用知道)"></a>引介通知(不用知道)</h1>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的AOP的基本使用案例</title>
      <link href="/2019/07/21/Spring%E7%9A%84AOP%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B/"/>
      <url>/2019/07/21/Spring%E7%9A%84AOP%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E6%A1%88%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<p>本质上就是将面向切面变成要写的一堆代码变成只需要配置xml文件就可以了</p><h2 id="ProductDao-java"><a href="#ProductDao-java" class="headerlink" title="ProductDao.java"></a>ProductDao.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProductDao</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ProductDaoImpl-java"><a href="#ProductDaoImpl-java" class="headerlink" title="ProductDaoImpl.java"></a>ProductDaoImpl.java</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductDaoImpl</span> <span class="keyword">implements</span> <span class="title">ProductDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"save"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"update"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="写切面类"><a href="#写切面类" class="headerlink" title="写切面类"></a>写切面类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 切面类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspectXML</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkPri</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"权限校验"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="applicationContext-xml"><a href="#applicationContext-xml" class="headerlink" title="applicationContext.xml"></a>applicationContext.xml</h2><p><a href="/2019/07/21/Spring的切点表达式写法/"><em>参考:切点表达式写法</em></a><br><a href="/2019/07/21/Spring的通知类型/"><em>参考:Spring的通知类型</em></a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"productDao"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.spring.aop.ProductDaoImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 将切面类交给Spring管理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspect"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.spring.aop.MyAspectXML"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 通过AOP的配置完成对目标类产生代理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">表达式配置哪些类的哪些方法需要进行增强</span></span><br><span class="line"><span class="comment">对哪些点进行拦截</span></span><br><span class="line"><span class="comment">*表示任意返回值</span></span><br><span class="line"><span class="comment">..表示任意参数</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.zjinc36.spring.aop.ProductDaoImpl.save(..) )"</span> <span class="attr">id</span>=<span class="string">"product1"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置切面 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">ref:切面id</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspect"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"checkPri"</span> <span class="attr">pointcut-ref</span>=<span class="string">"product1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.spring.aop.ProductDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = &#123;<span class="string">"classpath:applicationContext.xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestProductAOP</span> </span>&#123;</span><br><span class="line"><span class="meta">@Resource</span>(name = <span class="string">"productDao"</span>)</span><br><span class="line"><span class="keyword">private</span> ProductDao productDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">productDao.save();</span><br><span class="line">productDao.update();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的代理模式</title>
      <link href="/2019/07/15/Spring%E7%9A%84%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/07/15/Spring%E7%9A%84%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/lovejj1994/article/details/74932311#comments" target="_blank" rel="noopener"><em>来源:java设计模式之代理模式（动态代理和静态代理）</em></a></p><h1 id="什么是代理"><a href="#什么是代理" class="headerlink" title="什么是代理"></a>什么是代理</h1><p>代理的含义在于<strong>代替原对象做更多的事情，而不破坏原代码的代码结构</strong></p><p>代理也分静态代理 和 动态代理，我们先以简单的静态代理为例子。</p><h2 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h2><p>定义一个接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> designmode.代理模式;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Sourceable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>被代理的对象，它实现了 Sourceable 接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 被代理对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> panqian</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Source</span> <span class="keyword">implements</span> <span class="title">Sourceable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"the original method!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后 假设method方法已经不能满足我们的要求，我们需要在这个方法里输出更多的语句，但是我不需要直接修改Source 这个类，我们可以设计一个代理类：</p><p>这个代理类Proxy同样实现了Sourceable 接口，但是多了一个Source 成员变量，我们可以通过构造器接收我们原来的对象，然后在代理类的method()方法中，增强我们原有代码的功能（拓展Source对象method的功能 ）。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Proxy 是一个代理类 静态代理</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> panqian</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Sourceable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Source source;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Proxy</span><span class="params">(Source source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.source = source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"before proxy!"</span>);</span><br><span class="line">        source.method();</span><br><span class="line">        System.out.println(<span class="string">"after proxy!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后写一个测试用例并看输出的结果：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Source source = <span class="keyword">new</span> Source();</span><br><span class="line">        Sourceable sourceable = <span class="keyword">new</span> Proxy(source);</span><br><span class="line">        sourceable.method();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果:<br>可以看到，我们达到了我们的目的，不改变原有代码而增强了代码的功能</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">before proxy!</span><br><span class="line">the original method!</span><br><span class="line">after proxy!</span><br></pre></td></tr></table></figure><h2 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h2><p>在写代理模式时，我们做的其实是面向接口编程，代理类和被代理类都实现了一个接口，这也是代理的规范写法。在静态代理中，我们自己要编写代理类，虽然没有破坏原有代码，但是也有几个问题</p><ol><li>如果我们要做不同接口的代理，而且我们需要增强的功能没有区别的话，重复的编写代理类是 就造成了代码重复。</li><li>如果源对象的接口新增了方法，实现类不用多说，就连代理类也需要重新实现新的方法，代码维护难度上升了。</li></ol><p>上面问题全出在代理类上，jdk给我们的解决方案便是 动态代理。在动态代理中，我们不需要自己编写代理类，上面的两个问题 动态代理 来帮我们解决~！</p><p>为了展示动态代理的好处，我们在原有接口上新增一个方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Sourceable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Source 类也需要多实现method1（）方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Source</span> <span class="keyword">implements</span> <span class="title">Sourceable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"the original method!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"the original method1!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>关键来了，我们请来了动态代理的核心接口 InvocationHandler,InvocationHandler 接口只需要实现invoke方法，三个参数依次为 代理对象(基本没什么用)，代理对象调用的方法，调用的方法中的参数。通过<br>method.invoke方法，我们传入需要代理的对象（被代理对象作为DynamicProxy 的成员对象，通过构造器传入），和这个方法的参数，便可以调用被代理对象的原方法。然后其它跟静态代理没什么区别。<br>还有一点，method.getName()可以知道被代理对象调用了什么方法，根据不同方法可以自由编写增强现有代码的功能。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 动态代理，不用自己实现 被代理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Object object;</span><br><span class="line"></span><br><span class="line">    DynamicProxy(Object object) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"method1"</span>.equals(method.getName())) &#123;</span><br><span class="line">            System.out.println(<span class="string">"before dynamicProxy!"</span>);</span><br><span class="line">            method.invoke(object, args);</span><br><span class="line">            System.out.println(<span class="string">"before dynamicProxy!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"method"</span>.equals(method.getName())) &#123;</span><br><span class="line">            System.out.println(<span class="string">"before dynamicProxy1!"</span>);</span><br><span class="line">            method.invoke(object, args);</span><br><span class="line">            System.out.println(<span class="string">"before dynamicProxy1!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后编写测试类</p><p>Proxy.newProxyInstance方法传入 被代理对象的classloader，接口和被代理对象本身。它会在代码运行时 自动创建代理对象（免去了自己写代理类的问题），然后通过返回的代理对象调用代理方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Sourceable source = <span class="keyword">new</span> Source();</span><br><span class="line"></span><br><span class="line">    DynamicProxy dynamicProxy = <span class="keyword">new</span> DynamicProxy(source);</span><br><span class="line">    Sourceable sourceable = (Sourceable) Proxy.newProxyInstance(Source.class.getClassLoader(), Source.class.getInterfaces(), dynamicProxy);</span><br><span class="line"></span><br><span class="line">    sourceable.method();</span><br><span class="line">    System.out.println(<span class="string">"========="</span>);</span><br><span class="line">    sourceable.method1();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>动态代理 相比较 静态代理 相同点在于都是面向接口编程，都不破坏原有代码而增强功能，不同点在于 动态代理不需要自己写代理类，也就免去了很多因为自己写代理类而带来的问题。</p><p>在spring大名鼎鼎的aop特性中(<a href="/2019/07/15/Spring的AOP的XML开发/"><em>参见这里:Spring的AOP的XML开发</em></a>)，Spring提供了两种方式来生成代理对象: JDKProxy和Cglib，默认的策略是如果目标类是接口，则使用JDKProxy，JDKProxy便是我们所说的动态代理，否则使用Cglib来生成代理。所以说代理模式不是空中楼阁，对于减少代码重复量，减少代码冗余有很多实际的用处。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的AOP的XML开发</title>
      <link href="/2019/07/15/Spring%E7%9A%84AOP%E7%9A%84XML%E5%BC%80%E5%8F%91/"/>
      <url>/2019/07/15/Spring%E7%9A%84AOP%E7%9A%84XML%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="AOP概述"><a href="#AOP概述" class="headerlink" title="AOP概述"></a>AOP概述</h1><p>AOP，Aspect Oriented Programming，面向切面编程，是指在运行时，动态地将代码切入到类的指定方法、指定位置上的一种编程技术。AOP 是 OOP 的延续，是软件开发中的一个热点，也是 Spring 框架中的一个重要内容。利用 AOP 可以对业务逻辑与横切关注点（cross-cutting concerns，例如日志记录，事务处理）进行隔离，从而使得业务逻辑与横切关注点的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p><p>AOP 目的是为了解耦，它可以使一组类共享相同的行为。面向对象编程（OOP）目的也是为了提高代码的可重用性，那么 AOP 和 OOP 有什么不同之处呢？对于 OOP 来说，只能通过继承类和实现接口这种方式来实现，但这会使代码的耦合程度增强，不利于代码的维护。AOP 正是为了弥补了 OOP 的不足而出现。</p><p>Spring 框架提供了 AOP 的丰富支持，允许开发人员通过分离应用程序的业务逻辑与横切关注点从而进行内聚性的开发。举例来说，日志记录，性能统计，安全控制，事务处理，异常处理，这些称之为横切关注点的功能，对于应用程序来说是必须的。AOP 允许将这些横切关注点从业务逻辑代码中划分出来，从而改变这些横切关注点的代码不影响业务逻辑的代码。</p><h1 id="Spring底层的AOP实现原理"><a href="#Spring底层的AOP实现原理" class="headerlink" title="Spring底层的AOP实现原理"></a>Spring底层的AOP实现原理</h1><p>动态代理</p><ul><li>JDK动态代理:只能对实现了接口的类产生代理</li><li>Cglib动态代理:类似于Javassist第三方代理技术,对没有实现接口的类产生代理对象,生成子类对象<h2 id="JDK动态代理"><a href="#JDK动态代理" class="headerlink" title="JDK动态代理"></a>JDK动态代理</h2><a href="/2019/07/16/Spring的代理模式/#动态代理"><em>参见:设计模式之代理模式</em></a></li></ul><ol><li><p>UserDao</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>继承UserImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"save"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"update"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>动态代理,面向UserDao接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用JDK动态代理对UserDao产生代理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"><span class="comment">// 将被增强的对象传递到代理中</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">JdkProxy</span><span class="params">(UserDao userDao)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> UserDao <span class="title">createProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">UserDao userDaoProxy = (UserDao) Proxy.newProxyInstance(</span><br><span class="line">userDao.getClass().getClassLoader(),</span><br><span class="line">userDao.getClass().getInterfaces(), <span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">return</span> userDaoProxy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"><span class="comment">// 判断方法名是不是save</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">"save"</span>.equals(method.getName())) &#123;</span><br><span class="line">System.out.println(<span class="string">"save power up"</span>);</span><br><span class="line"><span class="keyword">return</span> method.invoke(userDao, args);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> method.invoke(userDao, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjinc36.spring.aop.JdkProxy;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.spring.aop.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.zjinc36.spring.aop.UserDaoImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestAOP</span> </span>&#123;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">UserDao userDao = <span class="keyword">new</span> UserDaoImpl();</span><br><span class="line"><span class="comment">//创建代理</span></span><br><span class="line">UserDao proxy = <span class="keyword">new</span> JdkProxy(userDao).createProxy();</span><br><span class="line">proxy.save();</span><br><span class="line">proxy.update();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="Cglib动态代理"><a href="#Cglib动态代理" class="headerlink" title="Cglib动态代理"></a>Cglib动态代理</h2><p>第三方开源代码生成类库,动态添加类的属性和方法</p><p>Spring已经核心包已经引入Cglib包了</p><ol><li><p>创建CustomerDao对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerDao</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"save"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"update"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>动态代理</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Cglib动态代理</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CglibProxy</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> CustomerDao customerDao;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CglibProxy</span><span class="params">(CustomerDao customerDao)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.customerDao = customerDao;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用Cglib产生代理的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CustomerDao <span class="title">createProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1.创建cglib核心类对象</span></span><br><span class="line">Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line"><span class="comment">// 2.设置父类</span></span><br><span class="line">enhancer.setSuperclass(customerDao.getClass());</span><br><span class="line"><span class="comment">// 3.设置回调(类似于InvocationHandler对象)</span></span><br><span class="line">enhancer.setCallback(<span class="keyword">this</span>);</span><br><span class="line"><span class="comment">// 4.创建代理对象</span></span><br><span class="line">CustomerDao proxy = (CustomerDao) enhancer.create();</span><br><span class="line"><span class="keyword">return</span> proxy;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object proxy, Method method, Object[] arg,</span></span></span><br><span class="line"><span class="function"><span class="params">MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">"save"</span>.equals(method.getName())) &#123;</span><br><span class="line">System.out.println(<span class="string">"save power up"</span>);</span><br><span class="line"><span class="keyword">return</span> methodProxy.invokeSuper(proxy, arg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> methodProxy.invokeSuper(proxy, arg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">CustomerDao customerDao = <span class="keyword">new</span> CustomerDao();</span><br><span class="line"><span class="comment">//创建代理</span></span><br><span class="line">CustomerDao proxy = <span class="keyword">new</span> CglibProxy(customerDao).createProxy();</span><br><span class="line">proxy.save();</span><br><span class="line">proxy.update();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="AspectJ"><a href="#AspectJ" class="headerlink" title="AspectJ"></a>AspectJ</h1><h2 id="AspectJ简介"><a href="#AspectJ简介" class="headerlink" title="AspectJ简介"></a>AspectJ简介</h2><ul><li>Spring的AOP有自己的实现方式(非常繁琐),AspectJ是一个AOP框架,Spring引入AspectJ作为自身AOP的开发</li><li>Spring两套AOP开发方式<blockquote><ul><li>Spring传统方式(已弃用)</li><li>Spring基于AspectJ的AOP的开发(使用)</li></ul></blockquote></li></ul><h2 id="AOP的相关术语"><a href="#AOP的相关术语" class="headerlink" title="AOP的相关术语"></a>AOP的相关术语</h2><table><thead><tr><th>相关术语</th><th>通俗理解</th><th>作用</th></tr></thead><tbody><tr><td>Joinpoint(连接点)</td><td>可以被拦截到的点</td><td>所谓连接点是指那些被拦截到的点。在spring中,这些点指的是方法,因为spring只支持方法类型的连接点.</td></tr><tr><td>Pointcut(切入点)</td><td>真正拦截到的点</td><td>所谓切入点是指我们要对哪些Joinpoint进行拦截的定义</td></tr><tr><td>Advice(通知/增强)</td><td>方法层面的增强</td><td>所谓通知是指拦截到Joinpoint之后所要做的事情就是通知.通知分为前置通知,后置通知,异常通知,最终通知,环绕通知(切面要完成的功能)</td></tr><tr><td>Introduction(引介)</td><td>类层面的增强</td><td>引介是一种特殊的通知在不修改类代码的前提下, Introduction可以在运行期为类动态地添加一些方法或Field.</td></tr><tr><td>Target(目标对象)</td><td>被增强的对象</td><td>代理的目标对象</td></tr><tr><td>Weaving(织入)</td><td>将Advice应用到Target的过程</td><td>是指把增强应用到目标对象来创建新的代理对象的过程.spring采用动态代理织入，而AspectJ采用编译期织入和类装在期织入</td></tr><tr><td>Proxy（代理）</td><td>代理对象</td><td>一个类被AOP织入增强后，就产生一个结果代理类</td></tr><tr><td>Aspect(切面)</td><td>切面</td><td>是切入点和通知（引介）的结合</td></tr></tbody></table><h2 id="AspectJ的XML的方式开发"><a href="#AspectJ的XML的方式开发" class="headerlink" title="AspectJ的XML的方式开发"></a>AspectJ的XML的方式开发</h2>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的IOC注解开发</title>
      <link href="/2019/07/15/Spring%E7%9A%84IOC%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91/"/>
      <url>/2019/07/15/Spring%E7%9A%84IOC%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/q547550831/article/details/54911516#spring%E7%9A%84ioc%E6%B3%A8%E8%A7%A3%E7%9A%84%E8%AF%A6%E8%A7%A3" target="_blank" rel="noopener"><em>参考Spring IOC注解开发</em></a></p><h1 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h1><h2 id="引入jar包"><a href="#引入jar包" class="headerlink" title="引入jar包"></a>引入jar包</h2><p><img src="/images/20190715001.png" alt></p><h2 id="引入配置文件"><a href="#引入配置文件" class="headerlink" title="引入配置文件"></a>引入配置文件</h2><ul><li>log4j.properties</li><li>applicationContext.xml<br>引入一个context的约束<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="创建相关包和类"><a href="#创建相关包和类" class="headerlink" title="创建相关包和类"></a>创建相关包和类</h2><ol><li><p>创建接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pc.service;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户服务类接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建实现类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pc.service.impl;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户服务实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"保存用户"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="将类的控制权交给Spring容器"><a href="#将类的控制权交给Spring容器" class="headerlink" title="将类的控制权交给Spring容器"></a>将类的控制权交给Spring容器</h2><p>在Spring中开启IOC的注解</p><!-- 配置组件扫描 --><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.pc.service"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>在类上添加注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ackage com.pc.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pc.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户服务实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span>(<span class="string">"userService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"保存用户"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="编写测试"><a href="#编写测试" class="headerlink" title="编写测试"></a>编写测试</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pc.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SpringIOC注解测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIOCAnnotationTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pc.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pc.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SpringIOC注解测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIOCAnnotationTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"userService"</span>)</span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>如果属性有set方法，注解需要加到set方法上，如果没有set方法直接在属性上添加注解</strong></p><h1 id="Spring的IOC注解的详解"><a href="#Spring的IOC注解的详解" class="headerlink" title="Spring的IOC注解的详解"></a>Spring的IOC注解的详解</h1><p>原来需要使用XML配置的方式将id和类绑定，现在不需要这样做了只需要在类上添加注解即可。</p><p>@Component ：组件</p><ul><li>@Controller ：修饰web层类</li><li>@Service ：修饰业务层类</li><li>@Repository ：修饰持久层类</li></ul><p>@Component是Spring提供的通用的组件注解，可以通过在类上使用该注解，将对应的类标记为Spring Bean，使用此功能需要在Spring配置文件中，开启组件扫描，<code>&lt;context:component-scan base-package=&quot;包名&quot;/&gt;</code></p><p>@Component和@Component(“name”)的区别在于，前者只能通过Spring的按类型注入依赖，后者还能使用按名注入依赖。</p><p><strong>@Controller、@Service和@Repository这三个注解和@Component的功能在目前的4.x.x版本都是一样的，只是表明它是一个组件</strong>。</p><p>不过通过在不同层使用相对应的注解，可以使注解更具有意义。在以后的版本中，Spring可能提供对这三个注解不同的增强。</p><h1 id="Bean依赖-属性-注入注解"><a href="#Bean依赖-属性-注入注解" class="headerlink" title="Bean依赖(属性)注入注解"></a>Bean依赖(属性)注入注解</h1><h2 id="普通类型的属性"><a href="#普通类型的属性" class="headerlink" title="普通类型的属性"></a>普通类型的属性</h2><p>如果属性有set方法，注解需要加到set方法上，如果没有set方法直接在属性上添加注解。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIOCAnnotationTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">// @Value("Switch")</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"Switch"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PS：如果同时在属性和set方法上添加了注解，那么set方法上的注解将会覆盖属性上的。</p><p>普通类型的属性</p><ul><li>@Value ：注入普通类型属性</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIOCAnnotationTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"Switch"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="对象类型的属性"><a href="#对象类型的属性" class="headerlink" title="对象类型的属性"></a>对象类型的属性</h2><ul><li>@Resource ：按名称注入对象</li><li>@Autowired ：按类型注入对象</li><li>@Qualifier:我们习惯是按照名称完成属性注入,必须让@Autowired注解和@Qualifier注解一起使用完成按名称属性注入<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringIOCAnnotationTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 按bean类型注入</span></span><br><span class="line">    <span class="comment">// @Resource</span></span><br><span class="line">    <span class="comment">// 按名注入，需要组件设置名称</span></span><br><span class="line">    <span class="comment">// @Resource(name = "userService")</span></span><br><span class="line">    <span class="comment">// 和上面功能一样，按名注入</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"userService"</span>)</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="Bean的生命周期注解"><a href="#Bean的生命周期注解" class="headerlink" title="Bean的生命周期注解"></a>Bean的生命周期注解</h1><ul><li>@PostConstruct ：相当于init-method</li><li>@PreDestroy ：相当于destroy-method<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span>(<span class="string">"userService"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"保存用户"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"用户初始化"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"注销用户"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="Bean的作用范围的注解"><a href="#Bean的作用范围的注解" class="headerlink" title="Bean的作用范围的注解"></a>Bean的作用范围的注解</h1><p>Bean的范围的注解：默认是单例的<br>@Scope ：在类上添加的，控制类生成的时候采用单例还是多例<br>取值:</p><ul><li>singleton ：单例</li><li>prototype ：多例</li><li>request ：request域，需要在web环境</li><li>session ：session域，需要在web环境</li><li>application： context域，需要在web环境</li><li>globalsession 集群环境的session域，需要在web环境<br>PS：可以到WebApplicationContext接口和ConfigurableBeanFactory类中找到@Scope的取值。</li></ul><h1 id="Spring的IOC的XML方式和注解方式比较"><a href="#Spring的IOC的XML方式和注解方式比较" class="headerlink" title="Spring的IOC的XML方式和注解方式比较"></a>Spring的IOC的XML方式和注解方式比较</h1><p><img src="/images/20190715002.png" alt><br>适用场景</p><ul><li>XML:可以适用任何场景,结构清晰,维护方便</li><li>注解:有些地方用不了,比如类不是自己提供的,但是开发方便</li></ul><h1 id="XML和注解整合开发"><a href="#XML和注解整合开发" class="headerlink" title="XML和注解整合开发"></a>XML和注解整合开发</h1><p>XML管理Bean,注解完成属性注入</p><h1 id="context-componet-scan和context-annotation-config的区别"><a href="#context-componet-scan和context-annotation-config的区别" class="headerlink" title="context:componet-scan和context:annotation-config的区别"></a>context:componet-scan和context:annotation-config的区别</h1><p>通过<code>&lt;context:annotation-config&gt;</code>的注释可以看出它的作用是激活<br>@Required、@Autowired、@PostConstruct、@PreDestroy、@Resource等注解。</p><p>通过<code>&lt;context:component-scan base-package=&quot;xx&quot;/&gt;</code>的注释可以看出它除了激活了<code>&lt;context:annotation-config&gt;</code>中所有的注解，同时还激活了<br>@Component、@Repository、@Service、@Controller、@RestController、@ControllerAdvice、@Configuration 这些注解</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的分模块开发的配置</title>
      <link href="/2019/07/15/Spring%E7%9A%84%E5%88%86%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91%E7%9A%84%E9%85%8D%E7%BD%AE/"/>
      <url>/2019/07/15/Spring%E7%9A%84%E5%88%86%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91%E7%9A%84%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/qq_21420941/article/details/93857271" target="_blank" rel="noopener"><em>参考:Spring学习笔记—Spring的分模块开发的配置</em></a></p><h2 id="在加载配置文件的时候-加载多个"><a href="#在加载配置文件的时候-加载多个" class="headerlink" title="在加载配置文件的时候,加载多个"></a>在加载配置文件的时候,加载多个</h2><p>例如把applicationContext.xml配置文件中的关于集合配置的部分剪切到applicationContext2.xml中，在加载配置文件的时候，将两个配置文件全部加载。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringDemo5</span> </span>&#123;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</span><br><span class="line">ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>,<span class="string">"applicationContext2.xml"</span>);</span><br><span class="line">CollectionBean collectionBean= (CollectionBean)applicationContext.getBean(<span class="string">"collectionBean"</span>);</span><br><span class="line">System.out.println(collectionBean);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="在一个配置文件中引入多个配置"><a href="#在一个配置文件中引入多个配置" class="headerlink" title="在一个配置文件中引入多个配置"></a>在一个配置文件中引入多个配置</h2><p>在applicationContext.xml中用import标签引入applicationContext2.xml：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"applicationContext2.xml"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>因为两个配置文件在同一个根目录下，所以可以直接写名字。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的工厂类</title>
      <link href="/2019/07/15/Spring%E7%9A%84%E5%B7%A5%E5%8E%82%E7%B1%BB/"/>
      <url>/2019/07/15/Spring%E7%9A%84%E5%B7%A5%E5%8E%82%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="工厂类"><a href="#工厂类" class="headerlink" title="工厂类"></a>工厂类</h1><p><img src="/images/20190713010.png" alt></p><h2 id="新旧工厂类"><a href="#新旧工厂类" class="headerlink" title="新旧工厂类"></a>新旧工厂类</h2><h3 id="BeanFactory-老版本的工厂类"><a href="#BeanFactory-老版本的工厂类" class="headerlink" title="BeanFactory:老版本的工厂类"></a>BeanFactory:老版本的工厂类</h3><p>BeanFactory:调用getBean的时候,才会生成类的实例</p><h3 id="ApplicationContext-新版本的工厂类"><a href="#ApplicationContext-新版本的工厂类" class="headerlink" title="ApplicationContext:新版本的工厂类"></a>ApplicationContext:新版本的工厂类</h3><ol><li>ApplicationContext:加载配合字文件的时候,就会将Spring管理的类都实例化</li><li>ApplicationContext有实现两个类<blockquote><ul><li>ClassPathXmlApplicationContext:加载类路径下的配置文件</li><li>FileSystemXmlApplicationContext:加载文件系统下的配置文件</li></ul></blockquote></li></ol><h2 id="Bean标签的id和name的配置"><a href="#Bean标签的id和name的配置" class="headerlink" title="Bean标签的id和name的配置"></a>Bean标签的id和name的配置</h2><ul><li>id:使用了约束中的唯一约束,里面不能出现特殊字符的</li><li>name:没有使用约束中的唯一约束(理论上可以出现重复,但是实际开发不能出现的),里面可以出现特殊字符</li></ul><h2 id="Bean的声明周期的配置-了解"><a href="#Bean的声明周期的配置-了解" class="headerlink" title="Bean的声明周期的配置(了解)"></a>Bean的声明周期的配置(了解)</h2><ul><li>init-method:Bean被初始化的时候执行的方法</li><li>destroy-method:Bean被销毁的时候执行的方法(Bean是单例创建,工厂关闭)</li></ul><h2 id="Bean的作用范围-重点"><a href="#Bean的作用范围-重点" class="headerlink" title="Bean的作用范围(重点)"></a>Bean的作用范围(重点)</h2><ul><li>scope:Bean的作用范围</li></ul><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>singleton</td><td>默认的,Spring会采用单例模式创建这个对象</td></tr><tr><td>prototype</td><td>多例模式</td></tr><tr><td>request</td><td>应用在web项目中,Spring创建这个类以后,将这个类存入到request范围中</td></tr><tr><td>session</td><td>应用在web项目中,Spring创建这个类以后,将这个类存入到session范围中</td></tr><tr><td>globalsession</td><td>应用在web项目中,必须在porlet环境下使用(在一个地方存入后,在子系统中就不用登录),如果没有这种环境,相当于session</td></tr></tbody></table><h2 id="Spring的Bean的实例化方式-了解"><a href="#Spring的Bean的实例化方式-了解" class="headerlink" title="Spring的Bean的实例化方式(了解)"></a>Spring的Bean的实例化方式(了解)</h2><ul><li>根源上的目的是解决我们如何获得其他类,而不会引入耦合</li><li>由于Bean已经都交给Spring管理,为了不引入耦合,Spring创建Bean的实例时,有如下几种方式</li></ul><h3 id="无参构造方式-默认"><a href="#无参构造方式-默认" class="headerlink" title="无参构造方式(默认)"></a>无参构造方式(默认)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bean1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Bean1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        system.out.println(<span class="string">"Bean1的无参数的构造方法执行了..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编写配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bean1"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.spring.demo1.Bean1&gt;&lt;/bean&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="静态工厂实例化的方式"><a href="#静态工厂实例化的方式" class="headerlink" title="静态工厂实例化的方式"></a>静态工厂实例化的方式</h3><p><a href="https://blog.csdn.net/u010512429/article/details/80487585" target="_blank" rel="noopener"><em>参考:Spring 静态工厂方法及实例工厂方法配置bean</em></a><br>静态工厂顾名思义，就是通过调用静态工厂的方法来获取自己需要的对象，为了让spring管理所有对象，我们不能直接通过”工程类.静态方法()”来获取对象，而是依然通过spring注入的形式获取</p><p>调用静态工厂方法创建Bean是将对象创建的过程封装到静态方法中。当客户端需要对象时，只需要简单地调用静态方法，而不关心创建对象的细节。</p><p>要声明通过静态方法创建的Bean，需要在Bean的class属性里指定拥有该工厂的方法的类，同时在factory-method属性里指定工厂方法的名称。最后，使用<code>&lt;constructor-arg&gt;</code>元素为该方法传递方法参数。</p><p>下面代码给出一个例子，调用DateFormat中的getDateInstance静态方法来创建Bean。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataformat"</span> <span class="attr">class</span>=<span class="string">"java.text.DateFormat"</span> <span class="attr">factory-method</span>=<span class="string">"getDateInstance"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"2"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="通过调用实例工厂方法创建Bean"><a href="#通过调用实例工厂方法创建Bean" class="headerlink" title="通过调用实例工厂方法创建Bean"></a>通过调用实例工厂方法创建Bean</h3><p><a href="https://blog.csdn.net/u010512429/article/details/80487585" target="_blank" rel="noopener"><em>参考:Spring 静态工厂方法及实例工厂方法配置bean</em></a></p><p>实例工厂方法：将对象的创建过程封装到另外一个对象实例的方法里。当客户端需要请求对象时，只需要简单的调用该实例方法而不需要关心对象的创建细节。要声明通过实例工厂方法创建的Bean</p><ul><li>在Bean的factory-bean属性里指定拥有该工厂方法的Bean</li><li>在factory-method属性指定该工厂方法的名称</li><li>使用constructor-arg元素为工厂方法传递方法参数</li></ul><p>下面代码给出一个例子，首先声明拥有工厂方法的bean-simpledataformat，接着创建新的对象factory-bean指定为上面的simpledateformat，并设置factory-method为parse方法，并在constructor-arg中传递参数，</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"simpledataformat"</span> <span class="attr">class</span>=<span class="string">"java.text.SimpleDateFormat"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"yyyy-MM-dd hh-mm-ss"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"date"</span> <span class="attr">factory-bean</span>=<span class="string">"simpledataformat"</span> <span class="attr">factory-method</span>=<span class="string">"parse"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">"2018-05-28 20-47-00"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的属性注入</title>
      <link href="/2019/07/15/Spring%E7%9A%84%E5%B1%9E%E6%80%A7%E6%B3%A8%E5%85%A5/"/>
      <url>/2019/07/15/Spring%E7%9A%84%E5%B1%9E%E6%80%A7%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring的属性注入"><a href="#Spring的属性注入" class="headerlink" title="Spring的属性注入"></a>Spring的属性注入</h1><p><a href="https://blog.csdn.net/u012702547/article/details/56307861" target="_blank" rel="noopener"><em>参考:Spring中属性注入的几种方式以及复杂属性的注入</em></a></p><h2 id="简单的属性注入"><a href="#简单的属性注入" class="headerlink" title="简单的属性注入"></a>简单的属性注入</h2><h3 id="构造方法的方式的属性注入"><a href="#构造方法的方式的属性注入" class="headerlink" title="构造方法的方式的属性注入"></a>构造方法的方式的属性注入</h3><p>构造方法注入和p名称空间注入这两种方式我们在开发中用的并不算多，但是我们还是有必要先来看看构造方法如何注入</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User4</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User4</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User4&#123;"</span> +</span><br><span class="line">                <span class="string">"username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>User4中有一个变量叫做username，我希望通过构造方法给它注入值，那我在User4中提供相应的构造方法即可，然后在Spring的配置文件中做如下配置即可：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user4"</span> <span class="attr">class</span>=<span class="string">"org.sang.User4"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"张三"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如此我便成功给username赋上值了<br>我们来看看测试方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">User4 user = (User4) context.getBean(<span class="string">"user4"</span>);</span><br><span class="line">System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Set方法的方式的属性注入"><a href="#Set方法的方式的属性注入" class="headerlink" title="Set方法的方式的属性注入"></a>Set方法的方式的属性注入</h3><p>set方法注入是我们用的比较多的一种注入方式，这种注入方式也很简单，假设我有一个User5，如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User5</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User5&#123;"</span> +</span><br><span class="line">                <span class="string">"username='"</span> + username + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>User5中也有username属性，但是我不想通过构造方法注入，想通过set方法注入，那么在User5中我们首先要提供set方法，然后在Spring配置文件中做如下配置即可：<br><strong>注入特定的值</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user5"</span> <span class="attr">class</span>=<span class="string">"org.sang.User5"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"lisi"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>另:若是注入指定类应如下</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDao"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.transaction.AccountDaoImpl"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 向DAO中注入jdbc --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name指的是类中的属性 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ref指的是需要注入的类 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">ref</span>=<span class="string">"jdbcTemplate"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>测试代码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">User5 user = (User5) context.getBean(<span class="string">"user5"</span>);</span><br><span class="line">System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="p名称空间注入-Spring2-5以后的版本"><a href="#p名称空间注入-Spring2-5以后的版本" class="headerlink" title="p名称空间注入(Spring2.5以后的版本)"></a>p名称空间注入(Spring2.5以后的版本)</h3><p>p名称空间注入也是一种注入方式，虽然用的不多，我们来看看p名称空间要怎么注入<br>首先，我们需要在Spring配置的bean节点中添加p名称空间，如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>现在假设我有一个User6，如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User6</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>User6中有一个username属性，我为该属性提供了set方法，我们来看看如何在配置文件中通过p名称空间进行注入：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user6"</span> <span class="attr">class</span>=<span class="string">"org.sang.User6"</span> <span class="attr">p:username</span>=<span class="string">"张三"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>直接在bean节点中通过p:username执行相应的值即可。这也是一种注入方式，不过这种方式我们在开发中用的并不多。</p><h3 id="SpEL方式注入"><a href="#SpEL方式注入" class="headerlink" title="SpEL方式注入"></a>SpEL方式注入</h3><p>入门:<a href="https://blog.csdn.net/siwuxie095/article/details/77446114" target="_blank" rel="noopener"><em>参考:表达式SpEL方式的属性注入</em></a></p><p>稍微复杂一点,重点关注applicationContext.xml文件的配置,如下</p><p>写一个普通类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String bookName;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> bookPrice;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBookName</span><span class="params">(String bookName)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.bookName = bookName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getBookName</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> bookName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBookPrice</span><span class="params">(<span class="keyword">int</span> bookPrice)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.bookPrice = bookPrice;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBookPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> bookPrice;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Book [bookName="</span> + bookName + <span class="string">", bookPrice="</span> + bookPrice + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>另一个类,有返回数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookInfo</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Double <span class="title">calculatorPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> Math.random() * <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"简爱"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改applicationContext.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--表达式 SpEL方式的属性注入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"bookInfo"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.spring.bean.BookInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"book"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.spring.bean.Book"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"bookName"</span> <span class="attr">value</span>=<span class="string">"#&#123; bookInfo.name&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"bookPrice"</span> <span class="attr">value</span>=<span class="string">"#&#123; bookInfo.calculatorPrice() &#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>进行测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSpEL</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ClassPathXmlApplicationContext beanFactory = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">Book book =  (Book) beanFactory.getBean(<span class="string">"book"</span>, Book.class);</span><br><span class="line">System.out.println(book);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="复杂的属性注入"><a href="#复杂的属性注入" class="headerlink" title="复杂的属性注入"></a>复杂的属性注入</h2><h3 id="对象的注入"><a href="#对象的注入" class="headerlink" title="对象的注入"></a>对象的注入</h3><p>这算是开发中最最常用的注入了</p><p>举一个常见的使用场景，我们在DAO层进行数据库的操作，在Service层进行业务逻辑操作，那我在Service中需要有一个DAO实例，如下，我有一个UserDao：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"获取到数据啦!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我还有一个UserService:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserDao</span><span class="params">(UserDao userDao)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    这个和上面setUserDao是两中类型,这个使用的是构造方法方式</span></span><br><span class="line"><span class="comment">//    public UserService(UserDao userDao) &#123;</span></span><br><span class="line"><span class="comment">//        this.userDao = userDao;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        userDao.getData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserService 中有一个UserDao的实例，我为之提供了set方法，一会通过set方法进行注入，我们来看看Spring配置文件中要如何写</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"org.sang.UserDao"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userService"</span> <span class="attr">class</span>=<span class="string">"org.sang.UserService"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userDao"</span> <span class="attr">ref</span>=<span class="string">"userDao"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这里是配合上面构造方法的方式进行注入的 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;constructor-arg name="userDao" ref="userDao"/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>我们要配置两个bean，第一个bean用来配置一个UserDao 的实例，第二个bean用来配置一个UserService实例，在获取UserService实例的时候顺便将第一个bean获取的userDao作为参数传入<br>当然我们也可以通过构造方法进行对象的注入，方式就是我注释掉的代码，我这里不再赘述。<br>同样,<strong>p名称空间注入和SpEL方式注入都可以配置复杂对象,主要在applicationContext.xml文件中修改,配置方式类似,就是要遵循各自对应的语法就行</strong></p><h3 id="数组注入-amp-List集合注入-amp-Map注入-amp-Properties注入"><a href="#数组注入-amp-List集合注入-amp-Map注入-amp-Properties注入" class="headerlink" title="数组注入&amp;List集合注入&amp;Map注入&amp;Properties注入"></a>数组注入&amp;List集合注入&amp;Map注入&amp;Properties注入</h3><p>这几个复杂属性的注入我放到一起来说，假设我有一个User7，如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User7</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] names;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; set;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; map;</span><br><span class="line">    <span class="keyword">private</span> Properties properties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNames</span><span class="params">(String[] names)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.names = names;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;String&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSet</span><span class="params">(Set&lt;String&gt; set)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.set = set;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMap</span><span class="params">(Map&lt;String, String&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.map = map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.properties = properties;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>User7中已经囊括了这几种复杂属性，我们看一下在Spring的配置文件中如何给它们注入值：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user7"</span> <span class="attr">class</span>=<span class="string">"org.sang.User7"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"names"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>张三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>李四<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>王五<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>足球<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>篮球<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>乒乓球<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"set"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>足球<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>篮球<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>乒乓球<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>足球<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>篮球<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>乒乓球<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"张三"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"张三"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"properties"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"username"</span>&gt;</span>赵六<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>数组和List集合的注入方式是一样的。map由于是以键值对的形式存储的，所以注入稍微有一点区别</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的IOC和DI</title>
      <link href="/2019/07/13/Spring%E7%9A%84IOC%E5%92%8CDI/"/>
      <url>/2019/07/13/Spring%E7%9A%84IOC%E5%92%8CDI/</url>
      
        <content type="html"><![CDATA[<h1 id="IOC控制反转"><a href="#IOC控制反转" class="headerlink" title="IOC控制反转"></a>IOC控制反转</h1><p>将对象的创建权反转给了Spring</p><h2 id="Spring的IOC的底层实现"><a href="#Spring的IOC的底层实现" class="headerlink" title="Spring的IOC的底层实现"></a>Spring的IOC的底层实现</h2><p>实现解偶的思维方式</p><ol><li>传统模式<br><img src="/images/20190713004.png" alt></li><li>面向接口编程<br><img src="/images/20190713005.png" alt></li><li>工厂模式<br><img src="/images/20190713006.png" alt></li><li>工厂+反射+配置文件<br><img src="/images/20190713007.png" alt></li></ol><h2 id="IOC依赖反转代码实现"><a href="#IOC依赖反转代码实现" class="headerlink" title="IOC依赖反转代码实现"></a>IOC依赖反转代码实现</h2><ol><li><p>文件导航<br><img src="/images/20190713009.png" alt></p></li><li><p>java代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//UserDaoImpl01</span></span><br><span class="line"><span class="keyword">package</span> com.zjinc36.spring.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl01</span> <span class="keyword">implements</span> <span class="title">UserDao</span></span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"UserDaoImpl01执行了"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//主要看这个</span></span><br><span class="line"><span class="keyword">package</span> com.zjinc36.spring.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringDemo1</span> </span>&#123;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//创建Spring的工厂</span></span><br><span class="line">ClassPathXmlApplicationContext ac = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">UserDao user = (UserDao) ac.getBean(<span class="string">"userDao"</span>);</span><br><span class="line">user.save();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>applicationContext.xml文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- applicationContext.xml --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-context-4.3.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.spring.demo1.UserDaoImpl01"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="DI-依赖注入"><a href="#DI-依赖注入" class="headerlink" title="DI(依赖注入)"></a>DI(依赖注入)</h1><p>依赖注入,前提必须有IOC的环境,Spring管理这个类的时候将类的依赖属性注入(设置)进来</p><h2 id="依赖-继承-聚合的区别"><a href="#依赖-继承-聚合的区别" class="headerlink" title="依赖/继承/聚合的区别"></a>依赖/继承/聚合的区别</h2><ol><li><p>依赖</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(A a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>继承: is a (是一个)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>聚合: has a (有一个)<br>有松散和紧密之分</p></li></ol><h2 id="Spring如何实现依赖注入"><a href="#Spring如何实现依赖注入" class="headerlink" title="Spring如何实现依赖注入"></a>Spring如何实现依赖注入</h2><ol><li><p>java代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.spring.demo1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl01</span> <span class="keyword">implements</span> <span class="title">UserDao</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"UserDaoImpl01执行了"</span> + name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>applicationContext.xml代码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-context-4.3.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.spring.demo1.UserDaoImpl01"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"zhangsan"</span> /&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring如何下载包</title>
      <link href="/2019/07/13/Spring%E5%A6%82%E4%BD%95%E4%B8%8B%E8%BD%BD%E5%8C%85/"/>
      <url>/2019/07/13/Spring%E5%A6%82%E4%BD%95%E4%B8%8B%E8%BD%BD%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  <a href="https://blog.csdn.net/yhl_jxy/article/details/51228212" target="_blank" rel="noopener"><em>参考:Spring如何下载源码和jar包</em></a></p></blockquote><h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><p><a href="https://repo.spring.io/release/org/springframework/spring/" target="_blank" rel="noopener">下载地址</a></p><h1 id="目录说明"><a href="#目录说明" class="headerlink" title="目录说明"></a>目录说明</h1><p><img src="/images/20190713001.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Struts2的标签库</title>
      <link href="/2019/07/13/Struts2%E7%9A%84%E6%A0%87%E7%AD%BE%E5%BA%93/"/>
      <url>/2019/07/13/Struts2%E7%9A%84%E6%A0%87%E7%AD%BE%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h1 id="标签分类"><a href="#标签分类" class="headerlink" title="标签分类"></a>标签分类</h1><p><img src="/images/20190713002.png" alt></p><h1 id="自定义标签"><a href="#自定义标签" class="headerlink" title="自定义标签"></a>自定义标签</h1><p><a href="https://www.jellythink.com/archives/218" target="_blank" rel="noopener"><em>自定义标签</em></a></p><h1 id="OGNL标签详解"><a href="#OGNL标签详解" class="headerlink" title="OGNL标签详解"></a>OGNL标签详解</h1><p><a href="https://www.cnblogs.com/langtianya/archive/2013/03/05/2944443.html" target="_blank" rel="noopener"><em>参考:OGNL标签详解</em></a></p><h1 id="非用户界面标签库"><a href="#非用户界面标签库" class="headerlink" title="非用户界面标签库"></a>非用户界面标签库</h1><h2 id="控制标签if-elseif-标签"><a href="#控制标签if-elseif-标签" class="headerlink" title="控制标签if...elseif...标签"></a>控制标签<code>if...elseif...</code>标签</h2><p>由于if…elseif…标签后都可以指定一个boolean表达式，所以if…elseif…标签可接受一个test属性，该属性确定执行判断的boolean表达式。具体用法如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:if</span> <span class="attr">test</span>=<span class="string">"100 in &#123;100,200,300&#125;"</span>&gt;</span></span><br><span class="line">   包含</span><br><span class="line"><span class="tag">&lt;/<span class="name">s:if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:else</span>&gt;</span></span><br><span class="line">   不包含</span><br><span class="line"><span class="tag">&lt;/<span class="name">s:else</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="迭代iterator标签"><a href="#迭代iterator标签" class="headerlink" title="迭代iterator标签"></a>迭代<code>iterator</code>标签</h2><p>iterator标签主要用于对集合（List、Set、数组和Map）进行迭代。使用iterator标签对集合进行迭代输出时，可以指定以下三个属性：</p><table><thead><tr><th>属性名</th><th>描述</th><th>是否可选</th></tr></thead><tbody><tr><td>value</td><td>用于指定被迭代的集合；如果没有指定value属性，则使用ValueStack栈顶的集合</td><td>可选</td></tr><tr><td>id</td><td>用于指定集合里元素的ID</td><td>可选</td></tr><tr><td>status</td><td>用于指定迭代时的IteratorStatus实例，通过该实例即可判断当前迭代元素的属性，例如是否为最后一个，以及当前迭代元素的索引等</td><td>可选</td></tr></tbody></table><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--List--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:set</span> <span class="attr">name</span>=<span class="string">"varList"</span> <span class="attr">value</span>=<span class="string">"&#123;'www.jellythink.com', 'www.google.com', 'www.facebook.com'&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:iterator</span> <span class="attr">value</span>=<span class="string">"#varList"</span> <span class="attr">id</span>=<span class="string">"website"</span> <span class="attr">status</span>=<span class="string">"st"</span>&gt;</span></span><br><span class="line">   当前已经输出了<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#st.getCount()"</span>/&gt;</span>个<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"website"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:iterator</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--Map--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:set</span> <span class="attr">name</span>=<span class="string">"varMap"</span> <span class="attr">value</span>=<span class="string">"#&#123;'谷歌':'www.jellythink.com', '脸书':'www.facebook.com'"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:iterator</span> <span class="attr">value</span>=<span class="string">"#varMap"</span> <span class="attr">id</span>=<span class="string">"website"</span> <span class="attr">status</span>=<span class="string">"st"</span>&gt;</span></span><br><span class="line">   第<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#st.getCount()"</span>/&gt;</span>组</span><br><span class="line"> <span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"key"</span>/&gt;</span>=<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"value"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:iterator</span>&gt;</span></span><br></pre></td></tr></table></figure><p>为<code>&lt;s:iterator.../&gt;</code>标签指定<code>status</code>属性，即每次迭代时都会有一个<code>IteratorStatus</code>实例，该实例包含以下几个方法：</p><ul><li>int getCount()：返回当前迭代了几个元素</li><li>int getIndex()：返回当前迭代元素的索引</li><li>boolean isEven()：返回当前迭代元素的索引是否是偶数</li><li>boolean isOdd()：返回当前迭代元素的索引是否是奇数</li><li>boolean isFirst()：返回当前迭代元素是否是第一个元素</li><li>boolean isLast()：返回当前迭代元素是否是最后一个元素</li></ul><h2 id="合并集合对象append标签"><a href="#合并集合对象append标签" class="headerlink" title="合并集合对象append标签"></a>合并集合对象<code>append</code>标签</h2><p>append标签用于将多个集合对象拼接起来，组成一个新的集合。通过这种拼接，从而允许通过一个&lt;s:iterator…/&gt;标签就可以完成对多个集合的迭代。<br>使用append标签时需要指定一个var属性，该属性确定拼接生成的新集合的名字，该新集合被放入Stack Context中。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:set</span> <span class="attr">name</span>=<span class="string">"varList"</span> <span class="attr">value</span>=<span class="string">"&#123;'www.google.com', 'www.facebook.com'&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:set</span> <span class="attr">name</span>=<span class="string">"varList2"</span> <span class="attr">value</span>=<span class="string">"&#123;'www.xiaomi.com', 'www.qq.com'&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:append</span> <span class="attr">var</span>=<span class="string">"newCollection"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">value</span>=<span class="string">"#varList"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">value</span>=<span class="string">"#varList2"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:append</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="合并集合对象merge标签"><a href="#合并集合对象merge标签" class="headerlink" title="合并集合对象merge标签"></a>合并集合对象<code>merge</code>标签</h2><p>merge标签和append标签看起来非常类似，也是用于将多个集合拼接成一个集合，但它采用的拼接方式与append的拼接方式有所不同，比如现在有三个集合，每个集合有三个元素，分别使用append和merge方式进行拼接，产生的新集合将有所区别。<br>使用append方式拼接，则新集合的元素顺序为：<br>第一个集合中的第一个元素<br>第一个集合中的第二个元素<br>第一个集合中的第三个元素<br>第二个集合中的第一个元素<br>第二个集合中的第二个元素<br>第二个集合中的第三个元素<br>第三个集合中的第一个元素<br>第三个集合中的第二个元素<br>第三个集合中的第三个元素<br>使用merge方式拼接，则新集合的元素顺序为：</p><p>第一个集合中的第一个元素<br>第二个集合中的第一个元素<br>第三个集合中的第一个元素<br>第一个集合中的第二个元素<br>第二个集合中的第二个元素<br>第三个集合中的第二个元素<br>第一个集合中的第三个元素<br>第二个集合中的第三个元素<br>第三个集合中的第三个元素<br>从上面可以看出来，采用append和merge方式合并集合时，新集合中集合元素完全相同，只是新集合中集合元素的顺序有所不同。</p><h2 id="分割字符串generator标签"><a href="#分割字符串generator标签" class="headerlink" title="分割字符串generator标签"></a>分割字符串<code>generator</code>标签</h2><p>generator标签可以将指定字符串按指定分隔符分隔成多个子串，临时生成的多个子串可以使用iterator标签来迭代输出。在该标签的标签体内，整个临时生成的集合将位于ValueStack的顶端，但一旦该标签结束，该集合将被移出ValueStack。<br>使用generator标签时可以指定如下几个属性：</p><table><thead><tr><th>属性名</th><th>描述</th><th>是否可选</th></tr></thead><tbody><tr><td>count</td><td>指定生成集合中元素的总数</td><td>可选</td></tr><tr><td>separator</td><td>指定用于解析字符串的分隔符</td><td>必填</td></tr><tr><td>val</td><td>指定被解析的字符串</td><td>必填</td></tr><tr><td>converter</td><td>该属性指定一个转换器，该转换器负责将集合中的每个字符串转换成对象，通过该转换器可以将一个字符串解析成对象的集合。该属性值必须是一个org.apache.Struts2.util.IteratorGenerator.Converter对象</td><td>可选</td></tr><tr><td>var</td><td>如果指定了该属性，则将生成的Iterator对象放入Stack Context中</td><td>可选</td></tr></tbody></table><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:generator</span> <span class="attr">val</span>=<span class="string">"'www.google.com,www.baidu.com'"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s:iterator</span> <span class="attr">id</span>=<span class="string">"website"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"website"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">s:iterator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:generator</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="取得集合子集subset标签"><a href="#取得集合子集subset标签" class="headerlink" title="取得集合子集subset标签"></a>取得集合子集<code>subset</code>标签</h2><p>用于取得集合的子集，具体使用请参见相关文档。</p><h2 id="对集合进行排序sort标签"><a href="#对集合进行排序sort标签" class="headerlink" title="对集合进行排序sort标签"></a>对集合进行排序<code>sort</code>标签</h2><p>sort标签用于对指定的集合元素进行排序，进行排序时，必须提供自定义的排序规则，即实现自己的Comparator，自定义的Comparator需要实现java.util.Comparator接口<br>使用sort标签时可指定如下几个属性：</p><table><thead><tr><th>属性名</th><th>描述</th><th>是否可选</th></tr></thead><tbody><tr><td>comparator</td><td>指定进行排序的Comparator</td><td>必填</td></tr><tr><td>source</td><td>指定被排序的集合；如果不指定该属性，则对ValueStack栈顶的集合进行排序</td><td>可选</td></tr><tr><td>var</td><td>如果指定了该属性，则将生成的Iterator对象设置成page范围的属性，不放入Stack Context中</td><td>可选</td></tr></tbody></table><h1 id="数据标签"><a href="#数据标签" class="headerlink" title="数据标签"></a>数据标签</h1><p>数据标签主要结合OGNL表达式进行数据访问，比如显示一个Action里的属性值，或者生成国际化输出等。数据标签主要包含如下几个：</p><h2 id="在页面中调用action标签"><a href="#在页面中调用action标签" class="headerlink" title="在页面中调用action标签"></a>在页面中调用<code>action</code>标签</h2><p>使用action标签可以允许在JSP页面中直接调用Action。在使用action标签时，可以指定如下几个属性：<br>|属性名    |描述    |是否可选|<br>|—-|—-|—-|<br>|var    |一旦定义了该属性，该Action将被放入ValueStack中    |可选|<br>|name    |该属性指定该标签调用哪个Action|    必填|<br>|namespace    |该属性指定标签调用的Action所在的namespace    |可选|<br>|executeResult    |该属性指定是否要将Action的处理结果页面包含到本页面，默认为false    |可选|<br>|ignoreContextParams    |指定该页面中的请求参数是否需要传入调用的Action，默认为false，即将本页面的请求参数传入被调用的Action|    可选|</p><h2 id="创建一个JavaBean实例bean标签"><a href="#创建一个JavaBean实例bean标签" class="headerlink" title="创建一个JavaBean实例bean标签"></a>创建一个JavaBean实例<code>bean</code>标签</h2><p>bean标签用于创建一个JavaBean实例。创建JavaBean实例时，可以在该标签体内使用param标签为该JavaBean实例传入属性。使用bean标签时可以指定以下属性：</p><table><thead><tr><th>属性名</th><th>描述</th><th>是否可选</th></tr></thead><tbody><tr><td>name</td><td>指定要实例化的JavaBean的实现类</td><td>必填</td></tr><tr><td>var</td><td>如果指定了该属性，则该JavaBean实例会被放入Stack Context中，并放入requestScope中</td><td>可选</td></tr></tbody></table><p>具体的代码示例请参见push标签中的代码。</p><h2 id="时间date标签"><a href="#时间date标签" class="headerlink" title="时间date标签"></a>时间<code>date</code>标签</h2><p>date标签用于格式化输出一个日期，除此之外，date标签还可以计算指定日期和当前时刻之间的时差。使用date标签时，可以指定以下几个属性：</p><p>|属性名    描述    是否可选|<br>|—-|—-|—-|<br>|format    |根据该属性指定的格式来格式化日期    |可选|<br>|nice    |用于指定是否输出指定日期和当前时刻之间的时差，默认为false，即不输出时差|    可选|<br>|name    |指定要格式化的日期值|    必填|<br>|var    |格式化后的字符串将被放入Stack Context中|    可选|</p><h2 id="用于调试debug标签"><a href="#用于调试debug标签" class="headerlink" title="用于调试debug标签"></a>用于调试<code>debug</code>标签</h2><p>debug标签主要用于调试，它在页面上生成一个超链接，通过该链接可以查看到ValueStack和Stack Context中所有的值信息</p><h2 id="包含其他页面include标签"><a href="#包含其他页面include标签" class="headerlink" title="包含其他页面include标签"></a>包含其他页面<code>include</code>标签</h2><p>include标签用于将一个JSP页面，或者一个Servlet包含到本页面中，使用时需要指定以下属性：</p><table><thead><tr><th>属性名</th><th>描述</th><th>是否可选</th></tr></thead><tbody><tr><td>value</td><td>该属性指定需要被包含的JSP页面，或者Servlet</td><td>必填</td></tr></tbody></table><p>例如下面这段代码包含regist.jsp:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:include</span> <span class="attr">value</span>=<span class="string">"regist.jsp"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"'jelly'"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"1234567"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:include</span>&gt;</span></span><br></pre></td></tr></table></figure><p>regist.jsp的代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%=request.getParameter("name")</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%=request.getParameter("password")</span> %&gt;</span></span><br></pre></td></tr></table></figure><h2 id="为其它标签提供参数param标签"><a href="#为其它标签提供参数param标签" class="headerlink" title="为其它标签提供参数param标签"></a>为其它标签提供参数<code>param</code>标签</h2><p>param标签主要用于为其它标签提供参数，具体请参见下面的push标签的示例代码。</p><h2 id="将某个值放到ValueStack的栈顶push标签"><a href="#将某个值放到ValueStack的栈顶push标签" class="headerlink" title="将某个值放到ValueStack的栈顶push标签"></a>将某个值放到ValueStack的栈顶<code>push</code>标签</h2><p>push标签用于将某个值放到ValueStack的栈顶。就一个属性值：</p><table><thead><tr><th>属性名</th><th>描述</th><th>是否可选</th></tr></thead><tbody><tr><td>value</td><td>该属性指定需要放到ValueStack栈顶的值</td><td>必填</td></tr></tbody></table><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:bean</span> <span class="attr">name</span>=<span class="string">"com.jellythink.practise.LoginAction"</span> <span class="attr">var</span>=<span class="string">"p"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">"userName"</span> <span class="attr">value</span>=<span class="string">"jelly"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">s:param</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:push</span> <span class="attr">value</span>=<span class="string">"#p"</span>&gt;</span></span><br><span class="line">    ValueStack栈顶对象的username属性：<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line">    ValueStack栈顶对象的password属性：<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"password"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:push</span>&gt;</span></span><br></pre></td></tr></table></figure><p>只有在push标签内时，被push标签放入ValueStack中的对象才存在；一旦离开了push标签，则刚刚放入的对象将立刻被移出ValueStack。</p><h2 id="将某个值放入指定范围内set标签"><a href="#将某个值放入指定范围内set标签" class="headerlink" title="将某个值放入指定范围内set标签"></a>将某个值放入指定范围内<code>set</code>标签</h2><p>set标签用于将某个值放入指定范围内</p><h2 id="生成一个URL地址url标签"><a href="#生成一个URL地址url标签" class="headerlink" title="生成一个URL地址url标签"></a>生成一个URL地址<code>url</code>标签</h2><p>url标签用于生成一个URL地址，可以通过url标签指定param子元素，从而向指定URL发送请求参数。</p><h2 id="输出value属性指定的值property标签"><a href="#输出value属性指定的值property标签" class="headerlink" title="输出value属性指定的值property标签"></a>输出value属性指定的值<code>property</code>标签</h2><p>property标签输出value属性指定的值，如果没有指定value属性，则默认输出ValueStack栈顶的值。该标签有以下几个属性：</p><table><thead><tr><th>属性名</th><th>描述</th><th>是否可选</th></tr></thead><tbody><tr><td>default</td><td>如果需要输出的属性值为null，则显示default属性指定的值</td><td>可选</td></tr><tr><td>escape</td><td>指定是否escape HTML代码，默认为true</td><td>可选</td></tr><tr><td>value</td><td>指定需要输出的属性值，如果没有指定该属性，则默认输出ValueStack栈顶的值</td><td>可选</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Struts2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Struts2的拦截器</title>
      <link href="/2019/07/13/Struts2%E7%9A%84%E6%8B%A6%E6%88%AA%E5%99%A8/"/>
      <url>/2019/07/13/Struts2%E7%9A%84%E6%8B%A6%E6%88%AA%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="拦截器概述"><a href="#拦截器概述" class="headerlink" title="拦截器概述"></a>拦截器概述</h1><h2 id="什么是拦截器"><a href="#什么是拦截器" class="headerlink" title="什么是拦截器"></a>什么是拦截器</h2><ol><li>Interceptor:拦截器,起到拦截Action的作用<blockquote><ul><li>Filter:过滤器,过滤从客户端向服务器发送的请求</li><li>Interceptor:拦截器,拦截客户端多Action的访问,更细粒度的拦截(拦截Action中的具体方法)</li></ul></blockquote></li><li>Struts2框架核心的功能都是依赖拦截器实现</li></ol><h1 id="拦截器在Struts2中处于什么位置"><a href="#拦截器在Struts2中处于什么位置" class="headerlink" title="拦截器在Struts2中处于什么位置"></a>拦截器在Struts2中处于什么位置</h1><p>以下是Struts2的执行流程</p><h2 id="代码中的执行流程"><a href="#代码中的执行流程" class="headerlink" title="代码中的执行流程"></a>代码中的执行流程</h2><ol><li>客户端向服务器发送一个Action的请求,执行核心过滤器doFilter()方法</li><li>在doFilter()方法中,调用executeAction()方法</li><li>在executeAction()方法内部调用dispatcher.serviceAction()</li><li>在dispatcher.serviceAction()中创建一个Action代理</li><li>最终执行的是Action代理中的execute()</li><li>在代理中执行的execute方法中调用ActionInvocation的invoke()方法</li><li><strong>在invoke()方法内部递归执行一组拦截器</strong>(完成部分功能)</li><li>如果没有下一个拦截器,就会执行目标Action</li><li>根据Action的返回结果进行页面跳转</li></ol><h2 id="官方提供的运行流程"><a href="#官方提供的运行流程" class="headerlink" title="官方提供的运行流程"></a>官方提供的运行流程</h2><p><a href="https://segmentfault.com/a/1190000012880242" target="_blank" rel="noopener"><em>参考:Struts2 架构与运行流程</em></a></p><p><img src="/images/20190713001.jpeg" alt></p><blockquote><ul><li>Servlet Filters(橙色)：过滤链，所有的请求都要经过Filter处理。</li><li>Struts Core(浅蓝色)：Struts2的核心部分，Struts2已经做好的功能，开发中不需要动它们。</li><li>Interceptors(浅绿色)：Struts2的拦截器。Struts2提供了很多默认的拦截器，帮助开发者完成绝大部分工作。开发者也可以自定义拦截器，来实现具体的功能。</li><li>User Created(浅黄色)：这一部分需要由开发人员完成，包括struts.xml、Action、Template等。</li></ul></blockquote><blockquote><ol><li>FilterDispatcher<br>FilterDispatcher是任何一个Struts2应用都需要配置的，一般出现在过滤器的最后；如果在FilterDispatcher前出现了如SiteMesh这种特殊的过滤器，还必须在SiteMess前应用Struts2的ActionContextCleanUp过滤器。<br>FilterDispatcher将请求转发给ActionMapper。</li><li>ActionMapper<br>ActionMapper负责识别当前的请求是否需要Struts2做出处理。<br>当ActionMapper告诉FilterDispatcher需要处理这个请求时，FilterDispatcher会停止过滤链之后的部分，所以通常FilterDispatcher应该出现在过滤链的最后。然后建立一个ActionProxy对象，这个对象作为Action于XWork之间的中间层，会代理Action的运行过程。</li><li>ActionProxy<br>ActionProxy对象被创建出来时，并不知道要运行哪个Action，它手里只有从FilterDispatcher中拿到的请求URL。这时，它去ConfigurationManager询问到底要运行哪个Action。</li><li>ConfigurationManager<br>在服务器启动的时候，ConfigurationManager负责将struts.xml文件从配置文件映射到内存中，并缓存起来，以保证ActionProxy拿着来访问的URL向它询问要运行哪一个Action的时候，就可以直接匹配，查找并回答出来。<br>ActionProxy知道了要运行的那个Action，相关的拦截器以及所有可能使用的Result信息，就可以着手建立ActionInvocation对象了，ActionInvocation对象描述了Action运行的整个过程。</li><li>ActionInvocation<br>ActionInvocation对象执行的时候会做很多事情：<ul><li>首先按照拦截器的应用顺序依次执行各个拦截器的前置部分；</li><li>然后执行Action的execute()方法；</li><li>根据execute()返回的结果，在struts.xml中匹配选择下一个页面</li><li>ActionInvocation对象再按照拦截器的引用顺序倒序依次执行各个拦截器的后置部分。<br>ActionInvocation对象执行完毕之后，实际上已经得到了响应对象，也就是HttpServletResponse对象，最终向用户显示响应的结果</li></ul></li></ol></blockquote><h1 id="使用拦截器"><a href="#使用拦截器" class="headerlink" title="使用拦截器"></a>使用拦截器</h1><p><a href="https://blog.csdn.net/qjyong/article/details/1824607" target="_blank" rel="noopener"><em>参考:Struts2拦截器</em></a></p><h1 id="自定义拦截器"><a href="#自定义拦截器" class="headerlink" title="自定义拦截器"></a>自定义拦截器</h1><h2 id="编写拦截器类"><a href="#编写拦截器类" class="headerlink" title="编写拦截器类"></a>编写拦截器类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionInvocation;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.interceptor.AbstractInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义拦截器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterceptorDemo1</span> <span class="keyword">extends</span> <span class="title">AbstractInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">intercept</span><span class="params">(ActionInvocation invocation)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"InterceptorDemo1执行了..."</span>);</span><br><span class="line">String obj = invocation.invoke();</span><br><span class="line">System.out.println(<span class="string">"InterceptorDemo1执行结束了..."</span>);</span><br><span class="line"><span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="引入拦截器"><a href="#引入拦截器" class="headerlink" title="引入拦截器"></a>引入拦截器</h2><ol><li><p>方式一:定义拦截器进行配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"interceptor"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 定义拦截器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"interceptorDemo1"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.interceptor.InterceptorDemo1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"interceptorDemo2"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.interceptor.InterceptorDemo2"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"actionDemo1"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.interceptor.ActionDemo"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span>&gt;</span>success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入拦截器 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 一旦引入自定义拦截器,默认拦截器栈的拦截器就不执行了,所以必须手动引入默认栈拦截器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"interceptorDemo1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"interceptorDemo2"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>方式二:定义一个拦截器栈</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"interceptor"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 定义拦截器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"interceptorDemo1"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.interceptor.InterceptorDemo1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor</span> <span class="attr">name</span>=<span class="string">"interceptorDemo2"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.interceptor.InterceptorDemo2"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 定义一个拦截器栈 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-stack</span> <span class="attr">name</span>=<span class="string">"myStack"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"defaultStack"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"interceptorDemo1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"interceptorDemo2"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptor-stack</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">interceptors</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"actionDemo1"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.interceptor.ActionDemo"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span>&gt;</span>success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入拦截器栈 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">interceptor-ref</span> <span class="attr">name</span>=<span class="string">"myStack"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Struts2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Struts2的值栈(ValueStack)</title>
      <link href="/2019/07/13/Struts2%E7%9A%84%E5%80%BC%E6%A0%88ValueStack/"/>
      <url>/2019/07/13/Struts2%E7%9A%84%E5%80%BC%E6%A0%88ValueStack/</url>
      
        <content type="html"><![CDATA[<h1 id="值栈"><a href="#值栈" class="headerlink" title="值栈"></a>值栈</h1><h2 id="什么是值栈"><a href="#什么是值栈" class="headerlink" title="什么是值栈"></a>什么是值栈</h2><blockquote><p>  <a href="https://blog.csdn.net/siwuxie095/article/details/77075528" target="_blank" rel="noopener"><em>参考:什么是值栈</em></a></p><ol><li>在 Servlet 中把数据放到域对象(<em>域对象的主要作用:在一定范围内,存值和取值</em>),再在页面中使用EL 表达式获取数据</li><li>Struts2 本身也提供了一种存储机制,称之为 值栈（ValueStack）,值栈类似于域对象,可以存值和取值,在 Action 中把数据放到值栈,再在页面中获取值栈数据</li></ol></blockquote><p>ValueStack其实类似一个数据中转站(Struts2的框架当中的数据就都保存到ValueStack中)</p><ul><li>Valuestack接口,实现类OgnlValueStack对象</li><li>ValueStack贯穿整个Action的声明周期(Action一旦创建了,框架就会创建一个ValueStack对象)</li></ul><h2 id="值栈的存储位置"><a href="#值栈的存储位置" class="headerlink" title="值栈的存储位置"></a>值栈的存储位置</h2><blockquote><p>  <a href="https://blog.csdn.net/siwuxie095/article/details/77075528" target="_blank" rel="noopener"><em>参考:什么是值栈</em></a></p><ul><li>每次访问 Action 时,都会创建 Action 对象</li><li>在每个 Action 对象中都会有一个值栈对象（且只有一个）</li></ul></blockquote><h1 id="分析值栈的内部结构"><a href="#分析值栈的内部结构" class="headerlink" title="分析值栈的内部结构"></a>分析值栈的内部结构</h1><h2 id="从结论说起"><a href="#从结论说起" class="headerlink" title="从结论说起"></a>从结论说起</h2><p><strong>值栈中有两个主要区域</strong></p><h3 id="root区域"><a href="#root区域" class="headerlink" title="root区域"></a>root区域</h3><p>其实就是一个ArrayList,里面一般放置对象,获取root不需要加#</p><h3 id="context区域"><a href="#context区域" class="headerlink" title="context区域"></a>context区域</h3><p>其实就是一个Map,里面放置web开发的常用的对象的数据引用,包含如下</p><ul><li>request</li><li>session</li><li>application</li><li>parameters</li><li>attr</li></ul><h2 id="如何得到上述结论"><a href="#如何得到上述结论" class="headerlink" title="如何得到上述结论"></a>如何得到上述结论</h2><h3 id="方法一-源码分析"><a href="#方法一-源码分析" class="headerlink" title="方法一:源码分析"></a>方法一:源码分析</h3><h4 id="查看源码"><a href="#查看源码" class="headerlink" title="查看源码"></a>查看源码</h4><p><em>ognl的源代码没有在Struts2的源码包里面</em><br><img src="/images/20190711004.png" alt></p><h4 id="值栈结构图"><a href="#值栈结构图" class="headerlink" title="值栈结构图"></a>值栈结构图</h4><p><img src="/images/20190712003.png" alt></p><h3 id="方法二-打印debug页面"><a href="#方法二-打印debug页面" class="headerlink" title="方法二:打印debug页面"></a>方法二:打印debug页面</h3><h4 id="1-Action代码"><a href="#1-Action代码" class="headerlink" title="1.Action代码"></a>1.Action代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ognl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.util.ValueStack;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ValueStack的内部结构</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueStackDemo1</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//获得值栈</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"unused"</span>)</span><br><span class="line">ValueStack valueStack = ActionContext.getContext().getValueStack();</span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-jsp页面-出口"><a href="#2-jsp页面-出口" class="headerlink" title="2.jsp页面(出口)"></a>2.jsp页面(出口)</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:debug</span>&gt;</span><span class="tag">&lt;/<span class="name">s:debug</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-在浏览器打开"><a href="#3-在浏览器打开" class="headerlink" title="3.在浏览器打开"></a>3.在浏览器打开</h4><p><img src="/images/20190712004.png" alt></p><h1 id="ActionContext"><a href="#ActionContext" class="headerlink" title="ActionContext"></a>ActionContext</h1><h2 id="什么是ActionContext"><a href="#什么是ActionContext" class="headerlink" title="什么是ActionContext"></a>什么是ActionContext</h2><ul><li><a href="/2019/06/26/Servlet与ServletConfig与ServletContext的使用/#ServletContext"><em>回顾:ServletContext</em></a></li><li>ActionContext是一个类,表示的是Action的上下文环境，它封装了一个Action运行所需要的环境，比如session、parameters、locale等,OGNL的操作都是基于ActionContext而进行的</li><li>对于这个ActionContext来说，每一个请求对应一个Action，这也是为什么说<a href="/2019/07/13/Struts2的值栈ValueStack/#值栈的存储位置">每个 Action 对象中都会有一个值栈对象（且只有一个）</a>,所以说你不用担心什么线程安全的问题了</li><li>对于ActionContext中的SESSION、APPLICATION、PARAMETERS和LOCALE就不用多说了，前面我们重点总结的还是VALUE_STACK就是为此<h2 id="值栈和ActionContext的关系"><a href="#值栈和ActionContext的关系" class="headerlink" title="值栈和ActionContext的关系"></a>值栈和ActionContext的关系</h2></li></ul><ol><li><strong>创建ActionContext对象</strong>:通过源码查看到,当请求过来的时候,执行过滤器中doFilter()方法,在这个方法中创建ActionContext</li><li><strong>创建ValueStack对象</strong>:创建ActionContext过程中,创建ValueStack对象,将ValueStack对象传递给ActionContext对象</li><li>所以<strong>可以通过ActionContext获取值栈对象</strong></li><li>ActionContext对象之所以能够访问Servlet的API(访问是域对象的数据),因为在其内部有值栈的引用</li></ol><h1 id="获取值栈"><a href="#获取值栈" class="headerlink" title="获取值栈"></a>获取值栈</h1><ul><li>通过ActionContext获得值栈 -&gt; <strong>操作的是<code>root</code>区域</strong></li><li>通过request对象获得 -&gt; <strong>操作的是<code>context</code>区域</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ognl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.util.ValueStack;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取ValueStack</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueStackDemo2</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 1.通过ActionContext获得</span></span><br><span class="line">ValueStack valueStack1 = ActionContext.getContext().getValueStack();</span><br><span class="line"><span class="comment">// 2.通过request对象获得</span></span><br><span class="line"><span class="comment">// 以下两种写法相同</span></span><br><span class="line"><span class="comment">// ServletActionContext.STRUTS_VALUESTACK_KEY的值就是"struts.valueStack"</span></span><br><span class="line"><span class="comment">// ValueStack valueStack2 = (ValueStack) ServletActionContext.getRequest().getAttribute("struts.valueStack");</span></span><br><span class="line">ValueStack valueStack3 = (ValueStack) ServletActionContext.getRequest().getAttribute(ServletActionContext.STRUTS_VALUESTACK_KEY);</span><br><span class="line"><span class="keyword">return</span> NONE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>注意:一个Action的实例,只会创建一个ValueStack的对象</strong></p><h1 id="操作值栈"><a href="#操作值栈" class="headerlink" title="操作值栈"></a>操作值栈</h1><p>这里<strong>重点放在将不同类型的数据存入值栈时,值栈的root区域和context区域发生怎么样的变化</strong>,虽然也有OGNL如何从值栈取出数据,但不是值栈这边的重点</p><h2 id="操作值栈中的root区域"><a href="#操作值栈中的root区域" class="headerlink" title="操作值栈中的root区域"></a>操作值栈中的root区域</h2><h3 id="利用Action在值栈中的特性"><a href="#利用Action在值栈中的特性" class="headerlink" title="利用Action在值栈中的特性"></a>利用Action在值栈中的特性</h3><ol><li><p>Action</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Action</span></span><br><span class="line"><span class="keyword">package</span> com.zjinc36.ognl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.util.ValueStack;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取ValueStack</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueStackDemo3</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">user = <span class="keyword">new</span> User(<span class="string">"zhangsan"</span>, <span class="string">"222"</span>);</span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.user = user;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>jsp文件</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- jsp文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">username:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"user.username"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line">password:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"user.password"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:debug</span>&gt;</span><span class="tag">&lt;/<span class="name">s:debug</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>结果页面<br><img src="/images/20190712006.png" alt></p></li></ol><h3 id="使用值栈的push方法"><a href="#使用值栈的push方法" class="headerlink" title="使用值栈的push方法"></a>使用值栈的push方法</h3><ol><li><p>Action</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ognl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.util.ValueStack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueStackDemo4</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">ValueStack vs = ActionContext.getContext().getValueStack();</span><br><span class="line">user = <span class="keyword">new</span> User(<span class="string">"zhangsan"</span>, <span class="string">"222"</span>);</span><br><span class="line">vs.push(user);</span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>jsp页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">username:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line">password:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:debug</span>&gt;</span><span class="tag">&lt;/<span class="name">s:debug</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>结果页面<br><img src="/images/20190712008.png" alt></p></li></ol><h3 id="使用值栈的set方法"><a href="#使用值栈的set方法" class="headerlink" title="使用值栈的set方法"></a>使用值栈的set方法</h3><ol><li><p>Action</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ognl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.util.ValueStack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueStackDemo4</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">ValueStack vs = ActionContext.getContext().getValueStack();</span><br><span class="line"><span class="comment">// 创建一个Map集合,将Map压入栈中</span></span><br><span class="line">vs.set(<span class="string">"name"</span>, <span class="string">"lisi"</span>);</span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>jsp页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">name:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:debug</span>&gt;</span><span class="tag">&lt;/<span class="name">s:debug</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>结果页面<br><img src="/images/20190712009.png" alt></p></li></ol><h3 id="使用值栈的set方法-设置ArrayList"><a href="#使用值栈的set方法-设置ArrayList" class="headerlink" title="使用值栈的set方法(设置ArrayList)"></a>使用值栈的set方法(设置ArrayList)</h3><ol><li><p>Action</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ognl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.util.ValueStack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueStackDemo4</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">ValueStack vs = ActionContext.getContext().getValueStack();</span><br><span class="line">ArrayList&lt;User&gt; list = <span class="keyword">new</span> ArrayList&lt;User&gt;();</span><br><span class="line">list.add(<span class="keyword">new</span> User(<span class="string">"aaa"</span>, <span class="string">"111"</span>));</span><br><span class="line">list.add(<span class="keyword">new</span> User(<span class="string">"bbb"</span>, <span class="string">"222"</span>));</span><br><span class="line">list.add(<span class="keyword">new</span> User(<span class="string">"aaa"</span>, <span class="string">"333"</span>));</span><br><span class="line">ActionContext.getContext().getValueStack().set(<span class="string">"list"</span>, list);</span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>jsp页面</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">username:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"list[0].username"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line">password:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"list[0].password"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line">username:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"list[1].username"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line">password:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"list[1].password"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line">username:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"list[2].username"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line">password:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"list[2].password"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:debug</span>&gt;</span><span class="tag">&lt;/<span class="name">s:debug</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="操作值栈中的context区域"><a href="#操作值栈中的context区域" class="headerlink" title="操作值栈中的context区域"></a>操作值栈中的context区域</h2><ol><li><p>写入数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ognl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueStackDemo4</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">ServletActionContext.getRequest().setAttribute(<span class="string">"name"</span>, <span class="string">"wangwu"</span>);</span><br><span class="line">ServletActionContext.getRequest().getSession().setAttribute(<span class="string">"name"</span>, <span class="string">"liubei"</span>);</span><br><span class="line">ServletActionContext.getServletContext().setAttribute(<span class="string">"name"</span>, <span class="string">"guanyu"</span>);</span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>获取数据</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">request:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#request.name"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line">session:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#session.name"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line">application:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#application.name"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line">attr:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#attr.name"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line">parameters.id:<span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#parameters.id"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:debug</span>&gt;</span><span class="tag">&lt;/<span class="name">s:debug</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>结果页面<br><img src="/images/20190712011.png" alt><br><img src="/images/20190712010.png" alt></p></li></ol><p><strong>注意:如果request没有设置数据,而我们又有取request的数据,则能拿到的是session的数据,同理,其他也有类似规则(不需要特意记忆,在页面开debug找就行)</strong></p><h1 id="OGNL表达式获取值栈数据"><a href="#OGNL表达式获取值栈数据" class="headerlink" title="OGNL表达式获取值栈数据"></a>OGNL表达式获取值栈数据</h1><p><a href="/2019/07/11/对象图导航语言OGNL/"><em>参考:OGNL表达式获取值栈数据</em></a></p><h1 id="EL表达式获取值栈数据"><a href="#EL表达式获取值栈数据" class="headerlink" title="EL表达式获取值栈数据"></a>EL表达式获取值栈数据</h1><p><a href="https://blog.csdn.net/siwuxie095/article/details/77163897" target="_blank" rel="noopener"><em>参考:EL表达式获取值栈数据</em></a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Struts2 </tag>
            
            <tag> OGNL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>对象图导航语言OGNL</title>
      <link href="/2019/07/11/%E5%AF%B9%E8%B1%A1%E5%9B%BE%E5%AF%BC%E8%88%AA%E8%AF%AD%E8%A8%80OGNL/"/>
      <url>/2019/07/11/%E5%AF%B9%E8%B1%A1%E5%9B%BE%E5%AF%BC%E8%88%AA%E8%AF%AD%E8%A8%80OGNL/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是OGNL"><a href="#什么是OGNL" class="headerlink" title="什么是OGNL"></a>什么是OGNL</h1><blockquote><p>  <a href="https://zh.wikipedia.org/wiki/%E5%AF%B9%E8%B1%A1%E5%AF%BC%E8%88%AA%E5%9B%BE%E8%AF%AD%E8%A8%80" target="_blank" rel="noopener"><em>参考(维基百科):对象导航图语言</em></a><br>  对象导航图语言（Object Graph Navigation Language），简称OGNL，是应用于Java中的一个开源的表达式语言（Expression Language），它被集成在Struts2等框架中，作用是对数据进行访问，它拥有类型转换、访问对象方法、操作集合对象等功能</p></blockquote><p>OGNL,对象导航图语言,比EL表达式强大很多倍的语言</p><ul><li>EL:从域对象中获取数据,从EL的11个对象中获取(<a href="/2019/06/29/JSP和EL和JSTL/#EL表达式"><em>EL表达式</em></a>)</li><li>OGNL:调用对象的方法,获取Struts2的值栈的数据.OGNL其实是第三方的表达式语言</li></ul><h1 id="OGNL的Java环境入门-了解"><a href="#OGNL的Java环境入门-了解" class="headerlink" title="OGNL的Java环境入门(了解)"></a>OGNL的Java环境入门(了解)</h1><h2 id="访问对象的方法"><a href="#访问对象的方法" class="headerlink" title="访问对象的方法"></a>访问对象的方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * OGNL调用对象方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> OgnlException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> <span class="keyword">throws</span> OgnlException </span>&#123;</span><br><span class="line"><span class="comment">// 获取context</span></span><br><span class="line">OgnlContext context = <span class="keyword">new</span> OgnlContext();</span><br><span class="line"><span class="comment">// 获得根对象</span></span><br><span class="line">Object root = context.getRoot();</span><br><span class="line"><span class="comment">// 执行表达式</span></span><br><span class="line">Object obj = Ognl.getValue(<span class="string">"'helloword'.length()"</span>, context, root);</span><br><span class="line">System.out.println(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="访问静态的方法"><a href="#访问静态的方法" class="headerlink" title="访问静态的方法"></a>访问静态的方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 访问静态的方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> OgnlException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> <span class="keyword">throws</span> OgnlException </span>&#123;</span><br><span class="line"><span class="comment">// 获取context</span></span><br><span class="line">OgnlContext context = <span class="keyword">new</span> OgnlContext();</span><br><span class="line"><span class="comment">// 获得根对象</span></span><br><span class="line">Object root = context.getRoot();</span><br><span class="line"><span class="comment">// 执行表达式</span></span><br><span class="line"><span class="comment">// 静态的固定写法:@类名@方法名</span></span><br><span class="line">Object obj = Ognl.getValue(<span class="string">"@java.lang.Math@random()"</span>, context, root);</span><br><span class="line">System.out.println(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="访问Root中的数据"><a href="#访问Root中的数据" class="headerlink" title="访问Root中的数据"></a>访问Root中的数据</h2><p>一般会在root中存放java对象</p><ol><li><p>设置一个java对象(User类)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.ognl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.username = username;</span><br><span class="line"><span class="keyword">this</span>.password = password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> username;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.username = username;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.password = password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"User [username="</span> + username + <span class="string">", password="</span> + password + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>访问Root中的数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 访问Root中的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> OgnlException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span> <span class="keyword">throws</span> OgnlException </span>&#123;</span><br><span class="line"><span class="comment">// 获取context</span></span><br><span class="line">OgnlContext context = <span class="keyword">new</span> OgnlContext();</span><br><span class="line"><span class="comment">// 设置根对象</span></span><br><span class="line">context.setRoot(<span class="keyword">new</span> User(<span class="string">"aaa"</span>, <span class="string">"123"</span>));</span><br><span class="line"><span class="comment">// 获得根对象</span></span><br><span class="line">Object root = context.getRoot();</span><br><span class="line"><span class="comment">// 执行表达式</span></span><br><span class="line">Object username = Ognl.getValue(<span class="string">"username"</span>, context, root);</span><br><span class="line">Object password = Ognl.getValue(<span class="string">"password"</span>, context, root);</span><br><span class="line">System.out.println(username + <span class="string">"--"</span> + password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="获取OgnlContext中的数据"><a href="#获取OgnlContext中的数据" class="headerlink" title="获取OgnlContext中的数据"></a>获取OgnlContext中的数据</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取context中的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> OgnlException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo4</span><span class="params">()</span> <span class="keyword">throws</span> OgnlException </span>&#123;</span><br><span class="line"><span class="comment">// 获取context</span></span><br><span class="line">OgnlContext context = <span class="keyword">new</span> OgnlContext();</span><br><span class="line"><span class="comment">// 获得根对象</span></span><br><span class="line">Object root = context.getRoot();</span><br><span class="line"><span class="comment">// 向context中存入数据</span></span><br><span class="line">context.put(<span class="string">"name"</span>, <span class="string">"zhangsan"</span>);</span><br><span class="line"><span class="comment">// 执行表达式</span></span><br><span class="line"><span class="comment">// 访问context中的数据时,需要加#</span></span><br><span class="line">Object obj = Ognl.getValue(<span class="string">"#name"</span>, context, root);</span><br><span class="line">System.out.println(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="OGNL在Struts2环境中的使用"><a href="#OGNL在Struts2环境中的使用" class="headerlink" title="OGNL在Struts2环境中的使用"></a>OGNL在Struts2环境中的使用</h1><p><a href="https://www.jellythink.com/archives/283" target="_blank" rel="noopener"><em>参考:Struts2学习之OGNL表达式</em></a></p><h2 id="访问ValueStack"><a href="#访问ValueStack" class="headerlink" title="访问ValueStack"></a>访问ValueStack</h2><p><a href="/2019/07/13/OGNL的值栈ValueStack/"><em>查看:什么是值栈ValueStack</em></a><br>由于ValueStack是Struts2中OGNL的根对象，如果用户需要访问值栈中的对象，在JSP页面可以直接通过下面的OGNL表达式访问ValueStack(值栈)中对象的属性：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"userName"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>在ValueStack中处于第一位的对象叫栈顶对象。通常我们在OGNL表达式里直接写上属性的名称即可访问ValueStack变量里对象的属性，搜索顺序是从栈顶对象开始寻找，如果栈顶对象不存在该属性，就会从第二个对象寻找，如果没有找到就从第三个对象寻找，依次往下访问，直到找到为止。</p><h2 id="访问application对象"><a href="#访问application对象" class="headerlink" title="访问application对象"></a>访问application对象</h2><p>访问ValueStack以外其它对象时，由于他们不是根对象，所以在访问时，需要添加#前缀。application对象用于访问ServletContext的属性，例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#application.userName"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#application['userName']"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>上述代码同调用ServletContext的getAttribute(“userName”)方法的效果是一样的。</p><h2 id="访问session对象"><a href="#访问session对象" class="headerlink" title="访问session对象"></a>访问session对象</h2><p>session对象用于访问HttpSession的属性，例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#session.userName"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#session['userName']"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>上述代码同调用HttpSession的getAttribute(“userName”)方法的效果是一样的。</p><h2 id="访问request对象"><a href="#访问request对象" class="headerlink" title="访问request对象"></a>访问request对象</h2><p>request对象用于访问HttpServletRequest的属性，例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#request.userName"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#request['userName']"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>上述代码同调用HttpServletRequest的getAttribute(“userName”)方法的效果是一样的。</p><h2 id="访问parameters对象"><a href="#访问parameters对象" class="headerlink" title="访问parameters对象"></a>访问parameters对象</h2><p>parameters对象用于访问HTTP请求参数，例如：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#parameters.userName"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#parameters['userName']"</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>上述代码同调用HttpServletRequest的getParameter(“userName”)方法的效果是一样的。</p><h2 id="访问attr对象"><a href="#访问attr对象" class="headerlink" title="访问attr对象"></a>访问attr对象</h2><p>attr对象依次搜索以下对象中的属性，找到便返回：</p><ul><li>PageContext</li><li>HttpServletRequest</li><li>HttpSession</li><li>ServletContext</li></ul><h2 id="调用对象方法"><a href="#调用对象方法" class="headerlink" title="调用对象方法"></a>调用对象方法</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入struts2的标签库,struts2就这一个标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>OGNL在Struts2环境中的入门<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>调用对象方法<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 直接调用字符串的方法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"'struts'.length()"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="调用对象的静态方法"><a href="#调用对象的静态方法" class="headerlink" title="调用对象的静态方法"></a>调用对象的静态方法</h2><p>Struts2默认是不能访问静态方法的,需要开启一个常量</p><ol><li><p>如何开启常量<br><a href="/2019/07/10/Struts2入门和配置/#Struts常量配置"><em>Struts2的常量要如何配置</em></a><br><img src="/images/20190711002.png" alt="图-允许静态方法访问"><br>在映射文件中配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Struts2的常量 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.action.extension"</span> <span class="attr">value</span>=<span class="string">"action"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.ognl.allowStaticMethodAccess"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>调用</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入struts2的标签库,struts2就这一个标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>OGNL在Struts2环境中的入门<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>调用对象的静态方法<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Struts2默认是不能访问静态方法的 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 需要开启一个常量 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"@java.lang.Math@random()"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="OGNL中的特殊字符"><a href="#OGNL中的特殊字符" class="headerlink" title="OGNL中的特殊字符"></a>OGNL中的特殊字符</h1><h2 id="号的用法"><a href="#号的用法" class="headerlink" title="#号的用法"></a>#号的用法</h2><p>两种用法</p><ol><li>#可以用于获得域对象的值</li><li>可以用于定义一个map<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag"><span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入struts2的标签库,struts2就这一个标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>#号的用法<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>存值<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">request.setAttribute</span>("<span class="attr">name</span>", "<span class="attr">123</span>");</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#request.name"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>构建List集合<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:iterator</span> <span class="attr">var</span>=<span class="string">"i"</span> <span class="attr">value</span>=<span class="string">"&#123;'aa', 'bb', 'cc'&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"i"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span> ---- <span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#i"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:iterator</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>构建Map集合<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>方式一<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:iterator</span> <span class="attr">value</span>=<span class="string">"#&#123; 'aa':'11', 'bb':'22'&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"key"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span> ---- <span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"value"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:iterator</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>方式二<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:iterator</span> <span class="attr">var</span>=<span class="string">"entry"</span> <span class="attr">value</span>=<span class="string">"#&#123; 'aa':'11', 'bb':'22'&#125;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#entry.key"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span> ---- <span class="tag">&lt;<span class="name">s:property</span> <span class="attr">value</span>=<span class="string">"#entry.value"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">s:iterator</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>利用List或Map集合创建单选框<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>值相同<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:radio</span> <span class="attr">list</span>=<span class="string">"&#123;'男', '女'&#125;"</span> <span class="attr">name</span>=<span class="string">"sex"</span> <span class="attr">label</span>=<span class="string">"性别"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:radio</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>值不同<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:radio</span> <span class="attr">list</span>=<span class="string">"#&#123;'1':'男', '2':'女'&#125;"</span> <span class="attr">name</span>=<span class="string">"sex2"</span> <span class="attr">label</span>=<span class="string">"性别"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:radio</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>利用List或Map集合创建复选框<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:checkboxlist</span> <span class="attr">name</span>=<span class="string">"checkbox1"</span> <span class="attr">list</span>=<span class="string">"&#123;'上网','看书','爬山','游泳','唱歌'&#125;"</span> <span class="attr">value</span>=<span class="string">"&#123;'上网','看书'&#125;"</span> &gt;</span><span class="tag">&lt;/<span class="name">s:checkboxlist</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="的用法"><a href="#的用法" class="headerlink" title="%的用法"></a>%的用法</h2><p>两种用法(只能在OGNL标签中使用)</p><ol><li>强制解析为OGNL表达式</li><li>强制不解析为OGNL表达式<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag"><span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入struts2的标签库,struts2就这一个标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>%号的用法<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>存值<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">request.setAttribute</span>("<span class="attr">name</span>", "<span class="attr">123</span>");</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>强制解析成OGNL表达式<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:textfield</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"%&#123;#request.name&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:textfield</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>强制不解系成OGNL表达式(每什么用)<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:textfield</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"%&#123;'#request.name'&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">s:textfield</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="符号的用法"><a href="#符号的用法" class="headerlink" title="$ 符号的用法"></a>$ 符号的用法</h2><p>在配置文件中可以使用OGNL表达式(EL表达式也是使用$)</p><ol><li>属性文件(国际化地方)</li><li>xml文件<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"download1"</span> <span class="attr">class</span>=<span class="string">"cn.itcast.demo2.DownloadAction"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span> <span class="attr">type</span>=<span class="string">"stream"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentType"</span>&gt;</span>$&#123;contentType&#125;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"contentDisposition"</span>&gt;</span>attachment;filename=$&#123;downFilename&#125;<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Struts2 </tag>
            
            <tag> OGNL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Struts2的数据封装</title>
      <link href="/2019/07/11/Struts2%E7%9A%84%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85/"/>
      <url>/2019/07/11/Struts2%E7%9A%84%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  Struts2提供了数据封装的功能,将提交的数据封装到一个类中</p></blockquote><h1 id="封装到对象中"><a href="#封装到对象中" class="headerlink" title="封装到对象中"></a>封装到对象中</h1><h2 id="属性驱动-提供属性set方法的方式"><a href="#属性驱动-提供属性set方法的方式" class="headerlink" title="属性驱动:提供属性set方法的方式"></a>属性驱动:提供属性set方法的方式</h2><h3 id="1-入口"><a href="#1-入口" class="headerlink" title="1.入口"></a>1.入口</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>属性驱动:提供属性set方法的方式<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/userAction.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">用户名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">年龄:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"age"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">生日:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"birthday"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">工资:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"salary"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-用户类"><a href="#2-用户类" class="headerlink" title="2.用户类"></a>2.用户类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="keyword">private</span> Integer age;</span><br><span class="line"><span class="keyword">private</span> Date birthday;</span><br><span class="line"><span class="keyword">private</span> Double salary;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.username = username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> password;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.password = password;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> birthday;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Double <span class="title">getSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> salary;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSalary</span><span class="params">(Double salary)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.salary = salary;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Action-同时将数据封装到用户类"><a href="#3-Action-同时将数据封装到用户类" class="headerlink" title="3.Action(同时将数据封装到用户类)"></a>3.Action(同时将数据封装到用户类)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据封装方式一:提供属性的set方法的方式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="keyword">private</span> Integer age;</span><br><span class="line"><span class="keyword">private</span> Date birthday;</span><br><span class="line"><span class="keyword">private</span> Double salary;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.username = username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.password = password;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">System.out.println(birthday);</span><br><span class="line"><span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSalary</span><span class="params">(Double salary)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.salary = salary;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(username);</span><br><span class="line">System.out.println(password);</span><br><span class="line">System.out.println(age);</span><br><span class="line">System.out.println(birthday);</span><br><span class="line">System.out.println(salary);</span><br><span class="line"><span class="comment">//封装数据</span></span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setUsername(username);</span><br><span class="line">user.setPassword(password);</span><br><span class="line">user.setAge(age);</span><br><span class="line">user.setBirthday(birthday);</span><br><span class="line">user.setSalary(salary);</span><br><span class="line"><span class="keyword">return</span> NONE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Action映射"><a href="#3-Action映射" class="headerlink" title="3.Action映射"></a>3.Action映射</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo4"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"userAction"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.demo4.UserAction"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="属性驱动-页面中提供表达式方式"><a href="#属性驱动-页面中提供表达式方式" class="headerlink" title="属性驱动:页面中提供表达式方式"></a>属性驱动:页面中提供表达式方式</h2><h3 id="1-入口-重要"><a href="#1-入口-重要" class="headerlink" title="1.入口(重要)"></a>1.入口(重要)</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>属性驱动:提供属性set方法的方式<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/user2Action.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">用户名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"user.username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"user.password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">年龄:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"user.age"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">生日:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"user.birthday"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">工资:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"user.salary"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-用户类-1"><a href="#2-用户类-1" class="headerlink" title="2.用户类"></a>2.用户类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="keyword">private</span> Integer age;</span><br><span class="line"><span class="keyword">private</span> Date birthday;</span><br><span class="line"><span class="keyword">private</span> Double salary;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.username = username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> password;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.password = password;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> birthday;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Double <span class="title">getSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> salary;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSalary</span><span class="params">(Double salary)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.salary = salary;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"User [username="</span> + username + <span class="string">", password="</span> + password</span><br><span class="line">+ <span class="string">", age="</span> + age + <span class="string">", birthday="</span> + birthday + <span class="string">", salary="</span></span><br><span class="line">+ salary + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Action-同时将数据封装到用户类-1"><a href="#3-Action-同时将数据封装到用户类-1" class="headerlink" title="3.Action(同时将数据封装到用户类)"></a>3.Action(同时将数据封装到用户类)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User2Action</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line"><span class="comment">// 提供一个User对象</span></span><br><span class="line"><span class="keyword">private</span> User user;</span><br><span class="line"><span class="comment">// 提供user的set和get方法,一定要提供get方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.user = user;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(user);</span><br><span class="line"><span class="keyword">return</span> NONE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Action映射"><a href="#4-Action映射" class="headerlink" title="4.Action映射"></a>4.Action映射</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo4"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"user2Action"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.demo4.User2Action"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="模型驱动-采用模型驱动方式"><a href="#模型驱动-采用模型驱动方式" class="headerlink" title="模型驱动:采用模型驱动方式"></a>模型驱动:采用模型驱动方式</h2><h3 id="1-入口-1"><a href="#1-入口-1" class="headerlink" title="1.入口"></a>1.入口</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>属性驱动:提供属性set方法的方式<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/user3Action.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">用户名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">年龄:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"age"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">生日:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"birthday"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">工资:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"salary"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-用户类-2"><a href="#2-用户类-2" class="headerlink" title="2.用户类"></a>2.用户类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="keyword">private</span> Integer age;</span><br><span class="line"><span class="keyword">private</span> Date birthday;</span><br><span class="line"><span class="keyword">private</span> Double salary;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.username = username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> password;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.password = password;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> birthday;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Double <span class="title">getSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> salary;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSalary</span><span class="params">(Double salary)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.salary = salary;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"User [username="</span> + username + <span class="string">", password="</span> + password</span><br><span class="line">+ <span class="string">", age="</span> + age + <span class="string">", birthday="</span> + birthday + <span class="string">", salary="</span></span><br><span class="line">+ salary + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Action-同时封装数据"><a href="#3-Action-同时封装数据" class="headerlink" title="3.Action(同时封装数据)"></a>3.Action(同时封装数据)</h3><p><strong>注意:如果有非常多的set要写,可以实现ModelDriven接口</strong><br>具体可以看<a href="https://blog.csdn.net/chentiefeng521/article/details/58594350" target="_blank" rel="noopener"><em>ModelDriven接口</em></a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据封装方式一:提供属性的set方法的方式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="keyword">private</span> Integer age;</span><br><span class="line"><span class="keyword">private</span> Date birthday;</span><br><span class="line"><span class="keyword">private</span> Double salary;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.username = username;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.password = password;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">System.out.println(birthday);</span><br><span class="line"><span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSalary</span><span class="params">(Double salary)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.salary = salary;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(username);</span><br><span class="line">System.out.println(password);</span><br><span class="line">System.out.println(age);</span><br><span class="line">System.out.println(birthday);</span><br><span class="line">System.out.println(salary);</span><br><span class="line"><span class="comment">//封装数据</span></span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setUsername(username);</span><br><span class="line">user.setPassword(password);</span><br><span class="line">user.setAge(age);</span><br><span class="line">user.setBirthday(birthday);</span><br><span class="line">user.setSalary(salary);</span><br><span class="line"><span class="keyword">return</span> NONE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-Action的映射"><a href="#4-Action的映射" class="headerlink" title="4.Action的映射"></a>4.Action的映射</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo4"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"userAction"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.demo4.UserAction"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"user2Action"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.demo4.User2Action"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"user3Action"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.demo4.User3Action"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="模型驱动方式和属性驱动的辨析"><a href="#模型驱动方式和属性驱动的辨析" class="headerlink" title="模型驱动方式和属性驱动的辨析"></a>模型驱动方式和属性驱动的辨析</h2><ul><li>模型驱动方式是最常用的方式,但缺点是只能同时向一个对象中封装数据</li><li>使用属性驱动(页面提供表达式方式)也是较常用的方式,可以向多个对象中封装数据,就是比较麻烦</li></ul><h2 id="INPUT逻辑视图配置"><a href="#INPUT逻辑视图配置" class="headerlink" title="INPUT逻辑视图配置"></a>INPUT逻辑视图配置</h2><h3 id="出现的问题"><a href="#出现的问题" class="headerlink" title="出现的问题"></a>出现的问题</h3><p>传入的参数类型和Action中定义的类型不一致时,会出现404错误</p><h2 id="问题根源说明"><a href="#问题根源说明" class="headerlink" title="问题根源说明"></a>问题根源说明</h2><p><img src="/images/20190710018.png" alt><br><img src="/images/20190710020.png" alt><br><img src="/images/20190710019.png" alt></p><ol><li><p>默认栈下的拦截器会依次执行</p></li><li><p>任何一个栈出错都会向Struts2的错误信息存储区域发送数据</p></li><li><p>如果没有任何错误,会直接转到Action</p></li><li><p>如果有错误(本问题中是有<code>params</code>拦截器会发送错误),会交由<code>workflow</code>拦截器进行处理</p></li><li><p><code>workflow</code>对应类的<code>doIntercep</code>方法中可以看到,当错误出现的时候,返回的是<code>INPUT</code>这个页面</p></li><li><p>当我们如下配置xml映射文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo4"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"userAction"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.demo4.UserAction"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>里面只配置了<code>success</code>而没有配置<code>INPUT</code>,就会找不到页面,也就返回404错误了</p></li></ol><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>在映射文件中配置input</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo4"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">global-results</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>input.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">global-results</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"userAction"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.demo4.UserAction"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="稍微扩展一下"><a href="#稍微扩展一下" class="headerlink" title="稍微扩展一下"></a>稍微扩展一下</h3><p>如果在input.jsp文件做如下配置,可以打印出错误信息</p><ul><li>taglib指令的使用</li><li>JSLT的写法 -&gt; &lt;s:fielderror/&gt;<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"/struts-tags"</span> <span class="attr">prefix</span>=<span class="string">"s"</span> %&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>input<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">s:fielderror</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="封装到容器中"><a href="#封装到容器中" class="headerlink" title="封装到容器中"></a>封装到容器中</h1><h2 id="封装到List中"><a href="#封装到List中" class="headerlink" title="封装到List中"></a>封装到List中</h2><h3 id="1-入口-2"><a href="#1-入口-2" class="headerlink" title="1.入口"></a>1.入口</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>封装到List集合中:批量插入商品<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/productAction.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">商品名称:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"products[0].name"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">商品价格:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"products[0].price"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">商品名称:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"products[1].name"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">商品价格:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"products[1].price"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">商品名称:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"products[2].name"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">商品价格:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"products[2].price"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-Action"><a href="#2-Action" class="headerlink" title="2.Action"></a>2.Action</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductAction</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> List&lt;Product&gt; products;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span> (Product product : products) &#123;</span><br><span class="line">System.out.println(product);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> NONE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProducts</span><span class="params">(List&lt;Product&gt; products)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.products = products;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Product&gt; <span class="title">getProducts</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> products;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Product类"><a href="#3-Product类" class="headerlink" title="3.Product类"></a>3.Product类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> Double price;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Double <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> price;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(Double price)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.price = price;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Product [name="</span> + name + <span class="string">", price="</span> + price + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-映射文件"><a href="#4-映射文件" class="headerlink" title="4.映射文件"></a>4.映射文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo5"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"productAction"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.demo5.ProductAction"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>input.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="封装到Map中"><a href="#封装到Map中" class="headerlink" title="封装到Map中"></a>封装到Map中</h2><h3 id="1-入口-3"><a href="#1-入口-3" class="headerlink" title="1.入口"></a>1.入口</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>封装到Map集合中<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/productAction2.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">商品名称:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"map['one'].name"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">商品价格:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"map['one'].price"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">商品名称:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"map['two'].name"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">商品价格:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"map['two'].price"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-Action-1"><a href="#2-Action-1" class="headerlink" title="2.Action"></a>2.Action</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductAction2</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Map&lt;String, Product&gt; map;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Product&gt; <span class="title">getMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMap</span><span class="params">(Map&lt;String, Product&gt; map)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.map = map;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Set&lt;String&gt; keys = map.keySet();</span><br><span class="line"><span class="keyword">for</span> (Iterator iterator = keys.iterator(); iterator.hasNext();) &#123;</span><br><span class="line">String key = (String) iterator.next();</span><br><span class="line">Product value = map.get(key);</span><br><span class="line">System.out.println(key + <span class="string">"----"</span> + value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> NONE;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Product类-1"><a href="#3-Product类-1" class="headerlink" title="3.Product类"></a>3.Product类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo5;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> Double price;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Double <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> price;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(Double price)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.price = price;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"Product [name="</span> + name + <span class="string">", price="</span> + price + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-映射"><a href="#4-映射" class="headerlink" title="4.映射"></a>4.映射</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo5"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"productAction2"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.demo5.ProductAction2"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"input"</span>&gt;</span>input.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Struts2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Struts2访问Servlet的API</title>
      <link href="/2019/07/11/Struts2%E8%AE%BF%E9%97%AEServlet%E7%9A%84API/"/>
      <url>/2019/07/11/Struts2%E8%AE%BF%E9%97%AEServlet%E7%9A%84API/</url>
      
        <content type="html"><![CDATA[<h1 id="Servlet-和-Action-的区别"><a href="#Servlet-和-Action-的区别" class="headerlink" title="Servlet 和 Action 的区别"></a>Servlet 和 Action 的区别</h1><blockquote><p>   <a href="https://blog.csdn.net/siwuxie095/article/details/77075528" target="_blank" rel="noopener"><em>参考:https://blog.csdn.net/siwuxie095/article/details/77075528</em></a><br>   Servlet：默认在第一次访问时创建，且只创建一次，是单实例对象<br>   Action：访问时创建，且每次访问都会创建，创建多次，是多实例对象</p></blockquote><h1 id="Struts2访问Servlet的API的方式"><a href="#Struts2访问Servlet的API的方式" class="headerlink" title="Struts2访问Servlet的API的方式"></a>Struts2访问Servlet的API的方式</h1><h2 id="完全解耦合的方式"><a href="#完全解耦合的方式" class="headerlink" title="完全解耦合的方式"></a>完全解耦合的方式</h2><h3 id="1-入口"><a href="#1-入口" class="headerlink" title="1.入口"></a>1.入口</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Struts访问Servlet的API<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>方式一:完全解耦合的方式<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/requestDemo1.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">姓名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-Action"><a href="#2-Action" class="headerlink" title="2.Action"></a>2.Action</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionContext;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">requestDemo1</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 接受参数</span></span><br><span class="line"><span class="comment">// 利用Struts2中的对象</span></span><br><span class="line">ActionContext context = ActionContext.getContext();</span><br><span class="line"><span class="comment">// 调用ActionContext中的方法</span></span><br><span class="line"><span class="comment">// 类似于request.getParameterMap()</span></span><br><span class="line">Map&lt;String, Object&gt; map = context.getParameters();</span><br><span class="line">Set&lt;String&gt; keySet = map.keySet();</span><br><span class="line"><span class="keyword">for</span> (Iterator iterator = keySet.iterator(); iterator.hasNext();) &#123;</span><br><span class="line">String key = (String) iterator.next();</span><br><span class="line">String[] value = (String[]) map.get(key);</span><br><span class="line">System.out.println(key + <span class="string">"----"</span> + Arrays.toString(value));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//向域对象中存入数据</span></span><br><span class="line">context.put(<span class="string">"reqName"</span>, <span class="string">"reqValue"</span>);<span class="comment">//相当于request.setAttribute()</span></span><br><span class="line">context.getSession().put(<span class="string">"sessName"</span>, <span class="string">"sessValue"</span>);<span class="comment">//相当于session.setAttribute()</span></span><br><span class="line">context.getApplication().put(<span class="string">"appName"</span>, <span class="string">"appValue"</span>);<span class="comment">//相当于application.setAttribute()</span></span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-映射"><a href="#3-映射" class="headerlink" title="3.映射"></a>3.映射</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo3"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"requestDemo1"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.demo3.requestDemo1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4-出口"><a href="#4-出口" class="headerlink" title="4.出口"></a>4.出口</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Struts访问Servlet的API<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>方式一:完全解耦合的方式<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/requestDemo1.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">姓名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="需要注意"><a href="#需要注意" class="headerlink" title="需要注意"></a>需要注意</h3><p><strong>注:这种方式只能获得代表request,session,application的数据的Map集合,不能操作这些对象本身的方法</strong></p><h2 id="使用servlet原生的api方式"><a href="#使用servlet原生的api方式" class="headerlink" title="使用servlet原生的api方式"></a>使用servlet原生的api方式</h2><h3 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.ServletActionContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">requestDemo2</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 1.接受数据</span></span><br><span class="line"><span class="comment">// 直接获得request对象,通过ServletActionContext</span></span><br><span class="line">HttpServletRequest request = ServletActionContext.getRequest();</span><br><span class="line">Map&lt;String, String[]&gt; map = request.getParameterMap();</span><br><span class="line">Set&lt;String&gt; keys = map.keySet();</span><br><span class="line"><span class="keyword">for</span> (Iterator iterator = keys.iterator(); iterator.hasNext();) &#123;</span><br><span class="line">String key = (String) iterator.next();</span><br><span class="line">String[] value = map.get(key);</span><br><span class="line">System.out.println(key + <span class="string">"----"</span> + Arrays.toString(value));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2.向域对象中保存数据</span></span><br><span class="line">request.setAttribute(<span class="string">"reqName"</span>, <span class="string">"reqValue"</span>);</span><br><span class="line">request.getSession().setAttribute(<span class="string">"sessName"</span>, <span class="string">"sessValue"</span>);</span><br><span class="line">ServletActionContext.getServletContext().setAttribute(<span class="string">"appName"</span>, <span class="string">"appValue"</span>);</span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="需要注意-1"><a href="#需要注意-1" class="headerlink" title="需要注意"></a>需要注意</h3><p><strong>这种方式既可以操作域对象的数据,也可以获得对象的方法</strong></p><h2 id="接口注入方式"><a href="#接口注入方式" class="headerlink" title="接口注入方式"></a>接口注入方式</h2><h3 id="Action-1"><a href="#Action-1" class="headerlink" title="Action"></a>Action</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.demo3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletContextAttributeListener;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.interceptor.ServletRequestAware;</span><br><span class="line"><span class="keyword">import</span> org.apache.struts2.util.ServletContextAware;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">requestDemo3</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span> <span class="keyword">implements</span> <span class="title">ServletRequestAware</span>, <span class="title">ServletContextAware</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> HttpServletRequest request;</span><br><span class="line"><span class="keyword">private</span> ServletContext context;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">// 1.接受参数</span></span><br><span class="line"><span class="comment">// 通过接口注入的方式获得request</span></span><br><span class="line">Map&lt;String, String[]&gt; map = request.getParameterMap();</span><br><span class="line">Set&lt;String&gt; keys = map.keySet();</span><br><span class="line"><span class="keyword">for</span> (Iterator iterator = keys.iterator(); iterator.hasNext();) &#123;</span><br><span class="line">String key = (String) iterator.next();</span><br><span class="line">String[] value = map.get(key);</span><br><span class="line">System.out.println(key + <span class="string">"----"</span> + Arrays.toString(value));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.向域对象中保存数据</span></span><br><span class="line">request.setAttribute(<span class="string">"reqName"</span>, <span class="string">"reqValue"</span>);</span><br><span class="line">request.getSession().setAttribute(<span class="string">"sessName"</span>, <span class="string">"sessValue"</span>);</span><br><span class="line">context.setAttribute(<span class="string">"appName"</span>, <span class="string">"appValue"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">super</span>.execute();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setServletContext</span><span class="params">(ServletContext context)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.context = context;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setServletRequest</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.request = request;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>Servlet是单例的,多个程序访问一个Servlet只会创建一个Servlet实例.而这里的Action是多例的,一次请求,创建一个Action的实例,不会出现线程安全的问题</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Struts2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Struts2入门和配置</title>
      <link href="/2019/07/10/Struts2%E5%85%A5%E9%97%A8%E5%92%8C%E9%85%8D%E7%BD%AE/"/>
      <url>/2019/07/10/Struts2%E5%85%A5%E9%97%A8%E5%92%8C%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="Struts2是什么"><a href="#Struts2是什么" class="headerlink" title="Struts2是什么"></a>Struts2是什么</h1><blockquote><p>  <a href="https://struts.apache.org/" target="_blank" rel="noopener"><em>参考:官网:https://struts.apache.org/</em></a></p></blockquote><blockquote><p>  Apache Struts is a free, open-source, MVC framework for creating elegant, modern Java web applications. It favors convention over configuration, is extensible using a plugin architecture, and ships with plugins to support REST, AJAX and JSON.(翻译:apache Struts是一个免费的，开源的MVC框架，用于创建优雅，现代的Java Web应用程序。 它支持约定优于配置，可使用插件体系结构进行扩展，并附带插件以支持REST，AJAX和JSON)<br>  <a href="https://zh.wikipedia.org/wiki/Struts" target="_blank" rel="noopener"><em>参考:维基百科:Struts</em></a><br>  Struts是Apache软件基金会（ASF）赞助的一个开源项目。它最初是Jakarta项目中的一个子项目，并在2004年3月成为ASF的顶级项目。它通过采用Java Servlet／JSP技术，实现了基于Java EE Web应用的Model-View-Controller（MVC）设计模式的应用框架，是MVC经典设计模式中的一个经典产品<br>  <a href="https://zh.wikipedia.org/wiki/Struts" target="_blank" rel="noopener"><em>参考:维基百科:Struts2</em></a><br>  Struts2缘起于Apache Struts的WebWork框架，旨在提供相对于Struts框架的增强和改进，同时保留与Struts框架类似的结构</p></blockquote><blockquote><p>  <a href="https://baike.baidu.com/item/Struts%202/2187934?fromtitle=Struts2&fromid=10711345&fr=aladdin" target="_blank" rel="noopener"><em>参考:百度百科</em></a><br>  Struts2是一个基于MVC设计模式的Web应用框架，它本质上相当于一个servlet，在MVC设计模式中，Struts2作为控制器(Controller)来建立模型与视图的数据交互</p></blockquote><h1 id="常见的Web层框架"><a href="#常见的Web层框架" class="headerlink" title="常见的Web层框架"></a>常见的Web层框架</h1><ul><li>Struts2</li><li>Webwork</li><li>SpringMVC</li></ul><h1 id="Struts2的开发环境"><a href="#Struts2的开发环境" class="headerlink" title="Struts2的开发环境"></a>Struts2的开发环境</h1><ol><li>下载<br><img src="/images/20190710002.png" alt></li><li>包说明<br><img src="/images/20190710001.png" alt></li></ol><h1 id="创建Web项目-引入jar包"><a href="#创建Web项目-引入jar包" class="headerlink" title="创建Web项目(引入jar包)"></a>创建Web项目(引入jar包)</h1><ol><li>如何知道要引入什么jar包<br><img src="/images/20190710005.png" alt></li><li>引入如下jar包<br><img src="/images/20190710006.png" alt></li></ol><h1 id="Struts2的示例项目"><a href="#Struts2的示例项目" class="headerlink" title="Struts2的示例项目"></a>Struts2的示例项目</h1><ol><li><p>项目文件导航<br><img src="/images/20190710008.png" alt></p></li><li><p>创建入口文件entrance.jsp<br>在项目下的创建入口文件WebContent/demo/entrance.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Struts2的入门<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Struts2的入门<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/hello.action"</span>&gt;</span>Struts2的入门<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置核心过滤器web.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Struts2Demo<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置Struts2的核心过滤器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建Action文件HelloAction.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.struts;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Struts2的入门的Action类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloAction</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 提供一个方法</span></span><br><span class="line"><span class="comment"> * 方法的写法是固定的</span></span><br><span class="line"><span class="comment"> * 返回值是String类型</span></span><br><span class="line"><span class="comment"> * 方法名是execute</span></span><br><span class="line"><span class="comment"> * 这个方法中不能传递参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"HelloAction...执行了"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建Action的映射struts.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Struts2为了管理Action的配置,通过包进行管理 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Struts2的包 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name:包名,可以随便写,但是要唯一 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Action --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name和访问的路径要一致 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- class是包名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.struts.HelloAction"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置页面的跳转 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/demo/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建出口文件success.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>跳转成功页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h1><p><img src="/images/20190710009.png" alt></p><ol><li>当用户访问某一个Action的时候,先经过核心过滤器</li><li>在核心过滤器中执行一组拦截器(这组拦截器实现部分功能),执行目标Action</li><li>根据Action的返回值,执行跳转</li></ol><h1 id="加载顺序"><a href="#加载顺序" class="headerlink" title="加载顺序"></a>加载顺序</h1><ol><li>default.properties</li><li>struts-default.xml</li><li>struts-plugin.xml</li><li>struts.xml</li><li>struts.properties</li><li>web.xml</li></ol><p><strong>注意:后配置的常量的值会覆盖先配置的常量的值</strong></p><h1 id="Structs的常见配置"><a href="#Structs的常见配置" class="headerlink" title="Structs的常见配置"></a>Structs的常见配置</h1><h2 id="package的配置"><a href="#package的配置" class="headerlink" title="package的配置"></a>package的配置</h2><ol><li>package写在哪<blockquote><p>  对于上述项目,package标签写在struts.xml文件中.</p></blockquote></li><li>package是什么标签<blockquote><p>  package标签称为包,这个包与java中的包的概念不一致,包为了更好管理action.</p></blockquote></li><li>package标签的属性<blockquote><ul><li>name:包的名称,在一个项目中不可重复</li><li>extends:继承哪个包,通常值为struts-default</li><li>abstract:抽象的,允许其他包继承</li><li>namespace:名称空间,与<action>标签中的name属性共同决定访问路径<br>名称空间有三种写法</action></li></ul><ol><li>带名称的空间 -&gt; /aaa /aaa/bbb</li><li>根名称空间 -&gt; namespace=”/“</li><li>默认名称空间 -&gt; namespace=””<br>区别在于访问顺序不同,先找带名称的空间,然后去根名称空间,然后才是默认名称空间</li></ol></blockquote></li></ol><h2 id="action映射的配置"><a href="#action映射的配置" class="headerlink" title="action映射的配置"></a>action映射的配置</h2><ol><li>action映射写在哪<blockquote><p>  对于上述项目,action映射标签写在struts.xml文件中.</p></blockquote></li><li>action映射是什么标签<blockquote><p>  action映射标签配置Action类</p></blockquote></li><li>action映射标签的属性<blockquote><ul><li>name:与namespace共同决定访问路径</li><li>class:Action类的全路径</li><li>method:执行Action中的哪个方法的方法名,默认值execute,可以显式写成其他方法</li><li>converter:用于设置类型转换器</li></ul></blockquote></li></ol><h2 id="结果页面的配置"><a href="#结果页面的配置" class="headerlink" title="结果页面的配置"></a>结果页面的配置</h2><ol><li>全局结果页面配置<blockquote><ul><li>global-results</li><li>在包中配置一次,其他的在这个包中的所有的action只要返回了这个值,都可以跳转到这个页面,即这对这个包下的所有的action的配置都有效</li></ul></blockquote></li><li>局部结果页面配置<blockquote><p>  <a href="/2019/07/10/Struts2入门和配置/#result标签的配置"><em>参考:result标签的配置</em></a></p><ul><li>resutl标签</li><li>针对当前的action有效</li></ul></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE struts PUBLIC</span><br><span class="line"><span class="string">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="string">"http://struts.apache.org/dtds/struts-2.3.dtd"</span>&gt;</span><br><span class="line">&lt;struts&gt;</span><br><span class="line">&lt;<span class="keyword">package</span> name=<span class="string">"demo3"</span> extends=<span class="string">"struts-default"</span> namespace=<span class="string">"/"</span>&gt;</span><br><span class="line">&lt;global-results&gt;</span><br><span class="line">&lt;result name="success"&gt;success.jsp&lt;/result&gt;</span><br><span class="line">&lt;/global-results&gt;</span><br><span class="line">&lt;action name=<span class="string">"requestDemo1"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.zjinc36.demo3.requestDemo1"</span>&gt;</span><br><span class="line">&lt;result name="success"&gt;success.jsp&lt;/result&gt;</span><br><span class="line">&lt;/action&gt;</span><br><span class="line">&lt;action name=<span class="string">"requestDemo2"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.zjinc36.demo3.requestDemo2"</span>&gt;</span><br><span class="line">&lt;result name="success"&gt;success.jsp&lt;/result&gt;</span><br><span class="line">&lt;/action&gt;</span><br><span class="line">&lt;action name=<span class="string">"requestDemo3"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.zjinc36.demo3.requestDemo3"</span>&gt;</span><br><span class="line">&lt;result name="success"&gt;success.jsp&lt;/result&gt;</span><br><span class="line">&lt;/action&gt;</span><br><span class="line">&lt;/package&gt;</span><br><span class="line">&lt;/struts&gt;</span><br></pre></td></tr></table></figure></li></ol><h2 id="result标签的配置"><a href="#result标签的配置" class="headerlink" title="result标签的配置"></a>result标签的配置</h2><p><a href="/2019/07/10/Struts2入门和配置/#结果页面的配置"><em>参考:结果页面的配置</em></a></p><ol><li>result标签的属性<blockquote><ul><li>name:逻辑视图名称,默认值为success</li><li>type:有很多值<ol><li>dispatcher:默认值,请求转发</li><li>redirect:重定向(Action重定向jsp)</li><li>chain:转发(Action转发Action)</li><li>redirectAction:重定向(Action重定向Action)</li><li>stream:文件下载的功能</li></ol></li></ul></blockquote></li><li>type的属性去哪里找<br><img src="/images/20190710016.png" alt></li></ol><h2 id="Struts常量配置"><a href="#Struts常量配置" class="headerlink" title="Struts常量配置"></a>Struts常量配置</h2><ol><li><p>去哪里找<br><a href="https://blog.csdn.net/hao2244/article/details/50429917" target="_blank" rel="noopener"><em>常见的常量</em></a><br>在Struts2框架中,提供了非常多的常量,去Libraries下的<code>/org/apache/struts2/default.properties</code>找<img src="/images/20190711001.png" alt></p><blockquote><p>  struts.i18n.encoding=UTF-8:Struts2中所有post请求的中文乱码不用处理了<br>  struts.action.extension=action,,:请求的默认扩展名,默认扩展名是<code>.action</code>或什么都不写<br>  …</p></blockquote></li><li><p>要修改常量怎么改<br>修改常量的值,可以有三个位置进行修正</p><ol><li><p>struts.xml -&gt; constant标签</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 注意constant标签 --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置structs2的常量 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.action.extension"</span> <span class="attr">value</span>=<span class="string">"abc"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Struts2为了管理Action的配置,通过包进行管理 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Struts2的包 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name:包名,可以随便写,但是要唯一 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Action --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name和访问的路径要一致 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- class是包名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.struts.HelloAction"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置页面的跳转 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">name</span>=<span class="string">"success"</span>&gt;</span>/demo/success.jsp<span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>struts.properties -&gt; 用户自定义的</p></li><li><p>web.xml -&gt; init-param标签</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Struts2Demo<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置Struts2的核心过滤器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 修改常量 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>struts.action.extension<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>xyz<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>struts2<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol></li></ol><h1 id="分模块开发配置"><a href="#分模块开发配置" class="headerlink" title="分模块开发配置"></a>分模块开发配置</h1><p>主要用于团队开发</p><ol><li>文件位置<br><img src="/images/20190710015.png" alt></li><li>文件内容<blockquote><ul><li>struts_personal.xml,个人自定义配置</li><li>struts.xml团队配置</li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- struts.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE struts PUBLIC</span></span><br><span class="line"><span class="meta">"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"</span></span><br><span class="line"><span class="meta">"http://struts.apache.org/dtds/struts-2.3.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">"com/zjinc36/struts/struts_personal.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="Action的编写方式"><a href="#Action的编写方式" class="headerlink" title="Action的编写方式"></a>Action的编写方式</h1><ol><li><p>Action编写方式一<br>纯粹写个Action文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.struts;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloAction</span> </span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 提供一个方法</span></span><br><span class="line"><span class="comment"> * 方法的写法是固定的</span></span><br><span class="line"><span class="comment"> * 返回值是String类型</span></span><br><span class="line"><span class="comment"> * 方法名是execute</span></span><br><span class="line"><span class="comment"> * 这个方法中不能传递参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"HelloAction...执行了"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Action编写方式二<br>实现Action接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.struts;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.Action;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Action编写方式二:实现Action接口</span></span><br><span class="line"><span class="comment"> * 这种方式,提供了五个常量(五个逻辑视图名称)</span></span><br><span class="line"><span class="comment"> * +SUCCESS:成功</span></span><br><span class="line"><span class="comment"> * +ERROR:失败</span></span><br><span class="line"><span class="comment"> * +LOGIN:登录出错的信息页面</span></span><br><span class="line"><span class="comment"> * +INPUT:表单校验的时候出错</span></span><br><span class="line"><span class="comment"> * +NONE:不调转</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Struts2Demo01Action</span> <span class="keyword">implements</span> <span class="title">Action</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"ok"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Action编写方式三(推荐)<br>Action类继承ActionSupport类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.struts;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.ActionSupport;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Action编写方式三:Action类继承ActionSupport类</span></span><br><span class="line"><span class="comment"> * 推荐使用继承ActionSupport方式</span></span><br><span class="line"><span class="comment"> * +ActionSupport中提供了数据校验,国际化等一系列操作的方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Struts2Demo02Action</span> <span class="keyword">extends</span> <span class="title">ActionSupport</span></span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"ok"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="Action的访问"><a href="#Action的访问" class="headerlink" title="Action的访问"></a>Action的访问</h1><ul><li>通过method设置<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/userFind.action"</span>&gt;</span>查询用户<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/userUpdate.action"</span>&gt;</span>修改用户<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/userDelete.action"</span>&gt;</span>删除用户<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/userSave.action"</span>&gt;</span>保存用户<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo2"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/demo2"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"userFind"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.Demo2.UserAction"</span> <span class="attr">method</span>=<span class="string">"find"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"userUpdate"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.Demo2.UserAction"</span> <span class="attr">method</span>=<span class="string">"update"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"userDelete"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.Demo2.UserAction"</span> <span class="attr">method</span>=<span class="string">"delete"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"userSave"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.Demo2.UserAction"</span> <span class="attr">method</span>=<span class="string">"save"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.Demo2;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAction</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">find</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"find"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//code...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>通过通配符的方式进行配置<br>其他和上述method一致,就xml文件要使用通配符<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"user*"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.Demo2.UserAction"</span> <span class="attr">method</span>=<span class="string">"&#123;1&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>更加抽象</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 和前文无关 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"**"</span> <span class="attr">class</span>=<span class="string">"xxx.&#123;1&#125;"</span> <span class="attr">method</span>=<span class="string">"&#123;2&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>动态方法访问配置<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123; pageContext.request.contextPath &#125;/user!find.action"</span>&gt;</span>查询用户<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开启动态访问 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 默认是没有开启动态访问的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constant</span> <span class="attr">name</span>=<span class="string">"struts.enable.DynamicMehtodInvocation"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">constant</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"demo2"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span> <span class="attr">namespace</span>=<span class="string">"/demo2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"userFind"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.Demo2.UserAction"</span>&gt;</span><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Struts2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>问题:Xxx Is a Raw Type. References to Generic Type Xxx&lt;y&gt; Should Be Parameterized</title>
      <link href="/2019/07/09/xxx-is-a-raw-type-References-to-generic-type-xxx-y-should-be-parameterized/"/>
      <url>/2019/07/09/xxx-is-a-raw-type-References-to-generic-type-xxx-y-should-be-parameterized/</url>
      
        <content type="html"><![CDATA[<h1 id="Eclipse出现如下报错"><a href="#Eclipse出现如下报错" class="headerlink" title="Eclipse出现如下报错"></a>Eclipse出现如下报错</h1><blockquote><ul><li>Query is a raw type. References to generic type Query<r> should be parameterized<br>或者</r></li><li>List is a raw type. References to generic type List should be parameterized</li></ul></blockquote><h1 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h1><h2 id="需要知道"><a href="#需要知道" class="headerlink" title="需要知道"></a>需要知道</h2><ol><li>这不是<code>error</code>而是<code>warning</code></li><li>该问题和泛型有关(要理解泛型,可以查看<a href="https://docs.oracle.com/javase/tutorial/java/generics/index.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/tutorial/java/generics/index.html</a>)</li></ol><h2 id="三种解决方式"><a href="#三种解决方式" class="headerlink" title="三种解决方式"></a>三种解决方式</h2><h3 id="知道泛型包含的是什么类型"><a href="#知道泛型包含的是什么类型" class="headerlink" title="知道泛型包含的是什么类型"></a>知道泛型包含的是什么类型</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;YourType&gt; synchronizedpubliesdList = Collections.synchronizedList(publiesdList);</span><br></pre></td></tr></table></figure><h3 id="如果有多种对象则使用-通配符"><a href="#如果有多种对象则使用-通配符" class="headerlink" title="如果有多种对象则使用?通配符"></a>如果有多种对象则使用?通配符</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;?&gt; synchronizedpubliesdList = Collections.synchronizedList(publiesdList);</span><br></pre></td></tr></table></figure><h3 id="只是想摆脱警告"><a href="#只是想摆脱警告" class="headerlink" title="只是想摆脱警告"></a>只是想摆脱警告</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"rawtypes"</span>)</span><br><span class="line">List synchronizedpubliesdList = Collections.synchronizedList(publiesdList);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java细节 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hibernate的查询方式</title>
      <link href="/2019/07/09/Hibernate%E7%9A%84%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F/"/>
      <url>/2019/07/09/Hibernate%E7%9A%84%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="OID查询"><a href="#OID查询" class="headerlink" title="OID查询"></a>OID查询</h1><p>Hibernate根据对象的OID(主键)进行检索</p><h2 id="使用get方法"><a href="#使用get方法" class="headerlink" title="使用get方法"></a>使用get方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Customer customer = session.get(Customer.class, <span class="number">1L</span>);</span><br></pre></td></tr></table></figure><h2 id="使用load方法"><a href="#使用load方法" class="headerlink" title="使用load方法"></a>使用load方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Customer customer = session.load(Customer.class, <span class="number">6L</span>);</span><br></pre></td></tr></table></figure><h1 id="对象导航检索"><a href="#对象导航检索" class="headerlink" title="对象导航检索"></a>对象导航检索</h1><p>Hibernate根据一个已经查询到的对象,获得其关联的对象的一种查询方式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LinkMan linkMan = session.get(LinkMan.class, <span class="number">2L</span>);</span><br><span class="line">Custoner customer = LinkMan.getCustomer();</span><br></pre></td></tr></table></figure><h1 id="HQL检索"><a href="#HQL检索" class="headerlink" title="HQL检索"></a>HQL检索</h1><p>Hibernate Query Language,Hibernate查询语言,这种语言和SQL极其类似,面向对象的查询语句<br>不支持<code>select *</code>这种写法</p><h2 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单的查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">// from Customer -&gt; Customer是类名字</span></span><br><span class="line"><span class="comment">// 理论上要写全称createQuery("from com.zjinc36.hibernate.Customer")</span></span><br><span class="line"><span class="comment">// 但是我们配置了映射,就不需要了</span></span><br><span class="line">Query query = session.createQuery(<span class="string">"from Customer"</span>);</span><br><span class="line">List&lt;Customer&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="别名查询"><a href="#别名查询" class="headerlink" title="别名查询"></a>别名查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 别名查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">// from Customer -&gt; Customer是类名字</span></span><br><span class="line"><span class="comment">// 理论上要写全称createQuery("from com.zjinc36.hibernate.Customer")</span></span><br><span class="line"><span class="comment">// 但是我们配置了映射,就不需要</span></span><br><span class="line"><span class="comment">//Query query = session.createQuery("from Customer c");</span></span><br><span class="line">Query query = session.createQuery(<span class="string">"select c from Customer c"</span>);</span><br><span class="line">List&lt;Customer&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 排序查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"><span class="comment">// from Customer -&gt; Customer是类名字</span></span><br><span class="line"><span class="comment">// 理论上要写全称createQuery("from com.zjinc36.hibernate.Customer")</span></span><br><span class="line"><span class="comment">// 但是我们配置了映射,就不需要</span></span><br><span class="line"><span class="comment">// 升序查询</span></span><br><span class="line"><span class="comment">//Query query = session.createQuery("from Customer order by cust_id");</span></span><br><span class="line"><span class="comment">// 降序查询</span></span><br><span class="line">Query query = session.createQuery(<span class="string">"from Customer order by cust_id desc"</span>);</span><br><span class="line">List&lt;Customer&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><h3 id="按位置绑定"><a href="#按位置绑定" class="headerlink" title="按位置绑定"></a>按位置绑定</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 条件查询</span></span><br><span class="line"><span class="comment"> * 按位置绑定</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"><span class="comment">// from Customer -&gt; Customer是类名字</span></span><br><span class="line"><span class="comment">// 理论上要写全称createQuery("from com.zjinc36.hibernate.Customer")</span></span><br><span class="line"><span class="comment">// 但是我们配置了映射,就不需要</span></span><br><span class="line">Query query = session.createQuery(<span class="string">"from Customer where cust_name like ?0"</span>);</span><br><span class="line">query.setParameter(<span class="number">0</span>, <span class="string">"sun%"</span>);</span><br><span class="line">List&lt;Customer&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="按名称绑定"><a href="#按名称绑定" class="headerlink" title="按名称绑定"></a>按名称绑定</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 条件查询</span></span><br><span class="line"><span class="comment"> * 按名称绑定</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"><span class="comment">// from Customer -&gt; Customer是类名字</span></span><br><span class="line"><span class="comment">// 理论上要写全称createQuery("from com.zjinc36.hibernate.Customer")</span></span><br><span class="line"><span class="comment">// 但是我们配置了映射,就不需要</span></span><br><span class="line">Query query = session.createQuery(<span class="string">"from Customer where cust_name like :name"</span>);</span><br><span class="line">query.setParameter(<span class="string">"name"</span>, <span class="string">"sun%"</span>);</span><br><span class="line">List&lt;Customer&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="投影查询"><a href="#投影查询" class="headerlink" title="投影查询"></a>投影查询</h2><h3 id="查询单个属性"><a href="#查询单个属性" class="headerlink" title="查询单个属性"></a>查询单个属性</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 投影查询</span></span><br><span class="line"><span class="comment"> * 查询单个属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo7</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"><span class="comment">// from Customer -&gt; Customer是类名字</span></span><br><span class="line"><span class="comment">// 理论上要写全称createQuery("from com.zjinc36.hibernate.Customer")</span></span><br><span class="line"><span class="comment">// 但是我们配置了映射,就不需要</span></span><br><span class="line"><span class="comment">// 查询单个属性</span></span><br><span class="line">Query query = session.createQuery(<span class="string">"select c.cust_name from Customer c"</span>);</span><br><span class="line">List&lt;Object&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Object object : list) &#123;</span><br><span class="line">System.out.println(object);</span><br><span class="line">&#125;</span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="查询多个属性"><a href="#查询多个属性" class="headerlink" title="查询多个属性"></a>查询多个属性</h3><h4 id="返回的是数组"><a href="#返回的是数组" class="headerlink" title="返回的是数组"></a>返回的是数组</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 投影查询</span></span><br><span class="line"><span class="comment"> * 查询多个属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo8</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"><span class="comment">// from Customer -&gt; Customer是类名字</span></span><br><span class="line"><span class="comment">// 理论上要写全称createQuery("from com.zjinc36.hibernate.Customer")</span></span><br><span class="line"><span class="comment">// 但是我们配置了映射,就不需要</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询多个属性</span></span><br><span class="line">Query query = session.createQuery(<span class="string">"select c.cust_id,c.cust_name from Customer c"</span>);</span><br><span class="line"><span class="comment">// 注意这里和单个属性的区别</span></span><br><span class="line"><span class="comment">// 返回的是数组</span></span><br><span class="line">List&lt;Object[]&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Object[] object : list) &#123;</span><br><span class="line">System.out.println(Arrays.toString(object));</span><br><span class="line">&#125;</span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="返回的是对象"><a href="#返回的是对象" class="headerlink" title="返回的是对象"></a>返回的是对象</h4><ol><li><p>修改要查询的类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Long cust_id;</span><br><span class="line"><span class="keyword">private</span> String cust_name;</span><br><span class="line"><span class="keyword">private</span> String cust_source;</span><br><span class="line"><span class="keyword">private</span> String cust_industry;</span><br><span class="line"><span class="keyword">private</span> String cust_level;</span><br><span class="line"><span class="keyword">private</span> String cust_phone;</span><br><span class="line"><span class="keyword">private</span> String cust_mobile;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过ORM方式表示:一个客户对应多个联系人</span></span><br><span class="line"><span class="comment">//放置的是多的一方的集合,Hibernate默认使用的是Set集合</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;LinkMan&gt; linkMans = <span class="keyword">new</span> HashSet&lt;LinkMan&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(Long cust_id, String cust_name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.cust_id = cust_id;</span><br><span class="line"><span class="keyword">this</span>.cust_name = cust_name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//code...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>进行查询</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 投影查询</span></span><br><span class="line"><span class="comment"> * 查询多个属性,但是我想封装到对象中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo9</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"><span class="comment">// from Customer -&gt; Customer是类名字</span></span><br><span class="line"><span class="comment">// 理论上要写全称createQuery("from com.zjinc36.hibernate.Customer")</span></span><br><span class="line"><span class="comment">// 但是我们配置了映射,就不需要</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询多个属性</span></span><br><span class="line">Query query = session.createQuery(<span class="string">"select new Customer(cust_id, cust_name) from Customer"</span>);</span><br><span class="line"><span class="comment">// 返回的是数组</span></span><br><span class="line">List&lt;Customer&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过session获得Query接口</span></span><br><span class="line"><span class="comment">// 注意这里的Customer指的是类</span></span><br><span class="line"><span class="comment">// 查询语句</span></span><br><span class="line">String hql = <span class="string">"from Customer"</span>;</span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line"><span class="comment">// 设置分页</span></span><br><span class="line">query.setFirstResult(<span class="number">0</span>);</span><br><span class="line">query.setMaxResults(<span class="number">3</span>);</span><br><span class="line">List&lt;Customer&gt; list = query.getResultList();</span><br><span class="line"><span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 聚合查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo10</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"><span class="comment">// from Customer -&gt; Customer是类名字</span></span><br><span class="line"><span class="comment">// 理论上要写全称createQuery("from com.zjinc36.hibernate.Customer")</span></span><br><span class="line"><span class="comment">// 但是我们配置了映射,就不需要</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// count(), max(), min(), avg(), sum()</span></span><br><span class="line">Query query = session.createQuery(<span class="string">"select count(*) from Customer"</span>);</span><br><span class="line">Object count = query.uniqueResult();</span><br><span class="line">System.out.println(count);</span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分组统计查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo11</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"><span class="comment">// from Customer -&gt; Customer是类名字</span></span><br><span class="line"><span class="comment">// 理论上要写全称createQuery("from com.zjinc36.hibernate.Customer")</span></span><br><span class="line"><span class="comment">// 但是我们配置了映射,就不需要</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 分组统计</span></span><br><span class="line">Query query = session.createQuery(<span class="string">"select cust_source, count(*) from Customer group by cust_source"</span>);</span><br><span class="line">List&lt;Object[]&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Object[] objects : list) &#123;</span><br><span class="line">System.out.println(Arrays.toString(objects));</span><br><span class="line">&#125;</span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HQL的多表查询"><a href="#HQL的多表查询" class="headerlink" title="HQL的多表查询"></a>HQL的多表查询</h2><p><a href="/2019/07/09/Hibernate的查询方式/#SQL的多表查询"><em>参考:SQL多表查询</em></a></p><h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><h4 id="交叉链接-笛卡尔积"><a href="#交叉链接-笛卡尔积" class="headerlink" title="交叉链接(笛卡尔积)"></a>交叉链接(笛卡尔积)</h4><h4 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h4><h5 id="显式内连接-隐式内连接"><a href="#显式内连接-隐式内连接" class="headerlink" title="显式内连接/隐式内连接"></a>显式内连接/隐式内连接</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HQL的多表查询</span></span><br><span class="line"><span class="comment"> * HQL:普通内连接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo12</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">//普通内连接</span></span><br><span class="line"><span class="comment">//SQL : select * from cst_customer c inner join cst_linkman l on c.cust_id = l.lkm_cust_id</span></span><br><span class="line"><span class="comment">//HQL内连接</span></span><br><span class="line">List&lt;Object[]&gt; list = session.createQuery(<span class="string">"from Customer c inner join c.linkMans"</span>).list();</span><br><span class="line"><span class="keyword">for</span> (Object[] objects : list) &#123;</span><br><span class="line">System.out.println(Arrays.toString(objects));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="迫切内连接"><a href="#迫切内连接" class="headerlink" title="迫切内连接"></a>迫切内连接</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HQL的多表查询</span></span><br><span class="line"><span class="comment"> * HOL:迫切内连接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo13</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">//普通内连接</span></span><br><span class="line"><span class="comment">//SQL : select * from cst_customer c inner join cst_linkman l on c.cust_id = l.lkm_cust_id</span></span><br><span class="line"><span class="comment">//HQL内连接</span></span><br><span class="line"><span class="comment">//与普通内连接相比,增加了一个关键字fetch</span></span><br><span class="line">List&lt;Customer&gt; list = session.createQuery(<span class="string">"select distinct c from Customer c inner join fetch c.linkMans"</span>).list();</span><br><span class="line"><span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="普通内连接和迫切内连接的区别"><a href="#普通内连接和迫切内连接的区别" class="headerlink" title="普通内连接和迫切内连接的区别"></a>普通内连接和迫切内连接的区别</h5><p>普通内连接 -&gt; 返回的是数组<br><img src="/images/20190709002.png" alt></p><p>迫切内连接 -&gt; 返回的是对象<br><img src="/images/20190709007.png" alt></p><h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><ul><li>左外连接</li><li>右外连接</li><li>迫切左外连接</li></ul><h1 id="QBC检索"><a href="#QBC检索" class="headerlink" title="QBC检索"></a>QBC检索</h1><h2 id="简单查询-1"><a href="#简单查询-1" class="headerlink" title="简单查询"></a>简单查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Criteria</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写具体逻辑crud(增删改查)操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1创建Criteria对象 createCriteria()在hibernate5.2之后过时了</span></span><br><span class="line"><span class="comment">//Criteria criteria = session.createCriteria(Customer.class);</span></span><br><span class="line"><span class="comment">//List&lt;Customer&gt; list = criteria.list();</span></span><br><span class="line"><span class="comment">//for (Student customer : list) &#123;</span></span><br><span class="line"><span class="comment">//System.out.println(customer);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新的查询方式</span></span><br><span class="line"><span class="comment">// 1.创建CriteriaBuilder对象</span></span><br><span class="line"><span class="comment">// 注意导入的包是import javax.persistence.criteria.CriteriaQuery;</span></span><br><span class="line">CriteriaBuilder criteriaBuilder = session.getCriteriaBuilder();</span><br><span class="line"><span class="comment">// 2.获取CriteriaQuery对象</span></span><br><span class="line">CriteriaQuery&lt;Customer&gt; createQuery = criteriaBuilder.createQuery(Customer.class);</span><br><span class="line"><span class="comment">// 3.指定根条件</span></span><br><span class="line">createQuery.from(Customer.class);</span><br><span class="line"><span class="comment">// 4执行查询</span></span><br><span class="line">List&lt;Customer&gt; List = session.createQuery(createQuery).getResultList();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Customer customer : List) &#123;</span><br><span class="line">System.err.println(customer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *模糊查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo4</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//获取session对象</span></span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line"><span class="comment">//开启事务</span></span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">//写具体逻辑crud(增删改查)操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">////创建Criteria对象 createCriteria()在hibernate5.2之后过时了</span></span><br><span class="line"><span class="comment">//Criteria criteria = session.createCriteria(Customer.class);</span></span><br><span class="line"><span class="comment">//criteria.add(Restrictions.like("cust_name", "zhang%"));</span></span><br><span class="line"><span class="comment">//List&lt;Customer&gt; list = criteria.list();</span></span><br><span class="line"><span class="comment">//for (Student customer : list) &#123;</span></span><br><span class="line"><span class="comment">//System.out.println(customer);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//新的查询方式</span></span><br><span class="line"><span class="comment">//1.创建CriteriaBuilder对象</span></span><br><span class="line"><span class="comment">//注意导入的包是import javax.persistence.criteria.CriteriaQuery;</span></span><br><span class="line">CriteriaBuilder criteriaBuilder = session.getCriteriaBuilder();</span><br><span class="line"><span class="comment">//2.获取CriteriaQuery对象</span></span><br><span class="line">CriteriaQuery&lt;Customer&gt; createQuery = criteriaBuilder.createQuery(Customer.class);</span><br><span class="line"><span class="comment">//3.指定根条件</span></span><br><span class="line">Root&lt;Customer&gt; root = createQuery.from(Customer.class);</span><br><span class="line"><span class="comment">//root.get("name") "name"是实体类的属性名称</span></span><br><span class="line">createQuery.where(criteriaBuilder.like(root.get(<span class="string">"cust_name"</span>), <span class="string">"%zhang%"</span>));</span><br><span class="line"><span class="comment">//4.执行查询</span></span><br><span class="line">List&lt;Customer&gt; List = session.createQuery(createQuery).getResultList();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Customer customer : List) &#123;</span><br><span class="line">System.err.println(customer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//提交事务</span></span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="离线条件查询"><a href="#离线条件查询" class="headerlink" title="离线条件查询"></a>离线条件查询</h2><h3 id="什么是离线条件查询"><a href="#什么是离线条件查询" class="headerlink" title="什么是离线条件查询"></a>什么是离线条件查询</h3><p><a href="https://zhidao.baidu.com/question/542663097.html" target="_blank" rel="noopener"><em>参考:https://zhidao.baidu.com/question/542663097.html</em></a><br>离线查询其实就是动态查询DetachedCriteria</p><h3 id="为什么需要离线条件查询"><a href="#为什么需要离线条件查询" class="headerlink" title="为什么需要离线条件查询"></a>为什么需要离线条件查询</h3><p><a href="https://zhidao.baidu.com/question/542663097.html" target="_blank" rel="noopener"><em>参考:https://zhidao.baidu.com/question/542663097.html</em></a></p><ul><li>场景:一般我们进行web开发都会碰到多条件查询.例如根据条件搜索.条件的多少 逻辑关系 是or 还是and等等</li><li>我们要根据这些条件来拼写查询语句,这样就需要频繁改动查询语句</li><li>有了离线查询可以解决这个痛点,我们可以使用DetachedCriteria来构造查询条件,然后将这个DetachedCriteria作为方法调用参数传递给Service层对象.而业务层对象获得DetachedCriteria之后,可以在session范围内直接构造Criteria,进行查询.就此,查询语句的构造完全被搬离到web层实现,而service层则只负责完成持久化和查询的封装即可.</li><li>换句话说,service层代码是不变化的.我们不必为了查询条件的变化而去频繁改动查询语句了</li></ul><h3 id="代码怎么写"><a href="#代码怎么写" class="headerlink" title="代码怎么写"></a>代码怎么写</h3><p><a href="https://elf8848.iteye.com/blog/342688" target="_blank" rel="noopener"><em>参考:https://elf8848.iteye.com/blog/342688</em></a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * web层</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">webDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">DetachedCriteria dc = DetachedCriteria.forClass(Customer.class);</span><br><span class="line"><span class="comment">// String name = request.getParameter("name");</span></span><br><span class="line">String cust_name = <span class="string">"liu%"</span>;</span><br><span class="line"><span class="comment">// 拼查询条件</span></span><br><span class="line"><span class="keyword">if</span> (cust_name != <span class="keyword">null</span>) &#123;</span><br><span class="line">dc.add(Restrictions.like(<span class="string">"cust_name"</span>, cust_name));</span><br><span class="line">&#125;</span><br><span class="line">List customers = query(dc);</span><br><span class="line"><span class="keyword">for</span> (Object object : customers) &#123;</span><br><span class="line">System.out.println(object);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * service层</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List <span class="title">query</span><span class="params">(DetachedCriteria detachedCriteria)</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction transaction = session.beginTransaction();</span><br><span class="line">Criteria criteria = detachedCriteria.getExecutableCriteria(session);</span><br><span class="line">List&lt;Customer&gt; list = criteria.list();</span><br><span class="line"><span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="有可能遇到failed-to-lazily-initialize-a-collection-of-role问题"><a href="#有可能遇到failed-to-lazily-initialize-a-collection-of-role问题" class="headerlink" title="有可能遇到failed to lazily initialize a collection of role问题"></a>有可能遇到<code>failed to lazily initialize a collection of role</code>问题</h3><p><a href="http://www.itzhai.com/hibernate-load-data-failed-failed-to-lazily-initialize-a-collection-of-role.html" target="_blank" rel="noopener"><em>参考http://www.itzhai.com/hibernate-load-data-failed-failed-to-lazily-initialize-a-collection-of-role.html</em></a><br>里面有一段话如下</p><blockquote><p>   该映射并没有设置lazy,所以这里是使用了默认的lazy=”true”,所以导致在页面获取时,因为session已经关闭,所以获取不到questionAnswer的数据.<br>   所以为了解决这个问题,可以在set的lazy设置为false：<br>   为set设置lazy=”false”</p></blockquote><p><strong>问题本质</strong><br>其实问题的本质就是代码中session已经被关闭了,但是代码中还有使用到,就是要确保使用session时候,session没有被关闭就行</p><h1 id="SQL检索"><a href="#SQL检索" class="headerlink" title="SQL检索"></a>SQL检索</h1><h2 id="简单的查询"><a href="#简单的查询" class="headerlink" title="简单的查询"></a>简单的查询</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">NativeQuery sqlQuery = session.createSQLQuery(<span class="string">"select * from cst_customer"</span>);</span><br><span class="line">List&lt;Object[]&gt; list = sqlQuery.list();</span><br><span class="line"><span class="keyword">for</span> (Object[] objects : list) &#123;</span><br><span class="line">System.out.println(Arrays.toString(objects));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="查询结果指定列"><a href="#查询结果指定列" class="headerlink" title="查询结果指定列"></a>查询结果指定列</h2><p><a href="https://blog.csdn.net/vacblog/article/details/7769976" target="_blank" rel="noopener"><em>参考:SQL查询 addScalar()或addEntity()</em></a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">NativeQuery sqlQuery = session.createSQLQuery(<span class="string">"select * from cst_customer"</span>);</span><br><span class="line">sqlQuery.addScalar(<span class="string">"cust_id"</span>, StandardBasicTypes.BIG_INTEGER);</span><br><span class="line">sqlQuery.addScalar(<span class="string">"cust_name"</span>, StandardBasicTypes.STRING);</span><br><span class="line">List&lt;Object[]&gt; list = sqlQuery.list();</span><br><span class="line"><span class="keyword">for</span> (Object[] objects : list) &#123;</span><br><span class="line">System.out.println(Arrays.toString(objects));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="查询结果封装到对象"><a href="#查询结果封装到对象" class="headerlink" title="查询结果封装到对象"></a>查询结果封装到对象</h2><p><a href="https://blog.csdn.net/vacblog/article/details/7769976" target="_blank" rel="noopener"><em>参考:SQL查询 addScalar()或addEntity()</em></a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">NativeQuery sqlQuery = session.createSQLQuery(<span class="string">"select * from cst_customer"</span>);</span><br><span class="line">sqlQuery.addEntity(Customer.class);</span><br><span class="line">List&lt;Customer&gt; list = sqlQuery.list();</span><br><span class="line"><span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SQL的多表查询"><a href="#SQL的多表查询" class="headerlink" title="SQL的多表查询"></a>SQL的多表查询</h2><ul><li>交叉链接(笛卡尔积)<blockquote><p>  select * from A,B;</p></blockquote></li><li>内连接(inner join -&gt; inner可以省略)<blockquote><p>  显式内连接:select * from A,B where A.id=B.id;<br>  隐式内连接:select * from A inner join B on A.id=B.id;</p></blockquote></li><li>外连接(outer可以省略)<blockquote><p>  左外连接:select * from A left outer join B on A.id=B.aid;<br>  右外连接:select * from A right outer join B on A.id=B.aid;</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hibernate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hibernate的关系映射</title>
      <link href="/2019/07/08/Hibernate%E7%9A%84%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84/"/>
      <url>/2019/07/08/Hibernate%E7%9A%84%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84/</url>
      
        <content type="html"><![CDATA[<h1 id="一对多关系"><a href="#一对多关系" class="headerlink" title="一对多关系"></a>一对多关系</h1><h2 id="什么样关系属于一对多"><a href="#什么样关系属于一对多" class="headerlink" title="什么样关系属于一对多"></a>什么样关系属于一对多</h2><ul><li>一个部门对应多个员工,一个员工只能属于某一个部门</li><li>一个客户对应多个联系人,一个联系人只能属于某一个客户</li></ul><h2 id="一对多建表原则"><a href="#一对多建表原则" class="headerlink" title="一对多建表原则"></a>一对多建表原则</h2><p>在多的一方创建外键指向一的一方的主键</p><h2 id="一对多具体创建过程"><a href="#一对多具体创建过程" class="headerlink" title="一对多具体创建过程"></a>一对多具体创建过程</h2><h3 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h3><h4 id="一的一方"><a href="#一的一方" class="headerlink" title="一的一方"></a>一的一方</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--一的一方</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="string">`cst_customer`</span> (</span><br><span class="line"><span class="string">`cust_id`</span> <span class="built_in">BIGINT</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'客户编号(主键)'</span>,</span><br><span class="line"><span class="string">`cust_name`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户名称(公司名称)'</span>,</span><br><span class="line"><span class="string">`cust_source`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户信息来源'</span>,</span><br><span class="line"><span class="string">`cust_industry`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户所属行业'</span>,</span><br><span class="line"><span class="string">`cust_level`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户级别'</span>,</span><br><span class="line"><span class="string">`cust_phone`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'固定电话'</span>,</span><br><span class="line"><span class="string">`cust_mobile`</span> <span class="built_in">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'移动电话'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span>(<span class="string">`cust_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br></pre></td></tr></table></figure><h4 id="多的一方"><a href="#多的一方" class="headerlink" title="多的一方"></a>多的一方</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--多的一方</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> cst_linkman (</span><br><span class="line">lkm_id <span class="built_in">bigint</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span> auto_increment <span class="keyword">comment</span> <span class="string">'联系人编号(主键)'</span>,</span><br><span class="line">lkm_name <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'联系人姓名'</span>,</span><br><span class="line">lkm_cust_id <span class="built_in">bigint</span>(<span class="number">32</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'客户id'</span>,</span><br><span class="line">lkm_gender <span class="built_in">char</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'联系人性别'</span>,</span><br><span class="line">lkm_phone <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'联系人办公电话'</span>,</span><br><span class="line">lkm_mobile <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'联系人手机'</span>,</span><br><span class="line">lkm_email <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'联系人邮箱'</span>,</span><br><span class="line">lkm_qq <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'联系人qq'</span>,</span><br><span class="line">lkm_position <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'联系人职位'</span>,</span><br><span class="line">lkm_memo <span class="built_in">varchar</span>(<span class="number">512</span>) <span class="keyword">default</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'联系人备注'</span>,</span><br><span class="line">primary <span class="keyword">key</span> (lkm_id),</span><br><span class="line"><span class="comment">-- 在lkm_cust_id上建立普通索引FK_cst_linkman_lkm_cust_id</span></span><br><span class="line"><span class="keyword">key</span> FK_cst_linkman_lkm_cust_id(lkm_cust_id),</span><br><span class="line"><span class="comment">-- 这里的FK_cst_linkman_lkm_cust_id和上面的没有任何关系</span></span><br><span class="line"><span class="comment">-- 只是用相同名字表示这里的外键和上面的内键是同一个字段,只是一个命名</span></span><br><span class="line"><span class="comment">--多的一方创建外键指向一的一方的主键</span></span><br><span class="line"><span class="keyword">CONSTRAINT</span> FK_cst_linkman_lkm_cust_id <span class="keyword">FOREIGN</span> <span class="keyword">key</span> (lkm_cust_id) <span class="keyword">REFERENCES</span> cst_customer(cust_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">NO</span> <span class="keyword">ACTION</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">NO</span> <span class="keyword">ACTION</span></span><br><span class="line">) <span class="keyword">engine</span>=<span class="keyword">InnoDB</span> auto_increment=<span class="number">1</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8;</span><br></pre></td></tr></table></figure><h4 id="对应的ER图"><a href="#对应的ER图" class="headerlink" title="对应的ER图"></a>对应的ER图</h4><p><img src="/images/20190708001.png" alt></p><h3 id="java对象"><a href="#java对象" class="headerlink" title="java对象"></a>java对象</h3><h4 id="一的一方-1"><a href="#一的一方-1" class="headerlink" title="一的一方"></a>一的一方</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.hibernate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Long cust_id;</span><br><span class="line"><span class="keyword">private</span> String cust_name;</span><br><span class="line"><span class="keyword">private</span> String cust_source;</span><br><span class="line"><span class="keyword">private</span> String cust_industry;</span><br><span class="line"><span class="keyword">private</span> String cust_level;</span><br><span class="line"><span class="keyword">private</span> String cust_phone;</span><br><span class="line"><span class="keyword">private</span> String cust_mobile;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过ORM方式表示:一个客户对应多个联系人</span></span><br><span class="line"><span class="comment">//放置的是多的一方的集合,Hibernate默认使用的是Set集合</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;LinkMan&gt; linkMans = <span class="keyword">new</span> HashSet&lt;LinkMan&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getCust_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_id</span><span class="params">(Long cust_id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_id = cust_id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_name</span><span class="params">(String cust_name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_name = cust_name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_source</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_source;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_source</span><span class="params">(String cust_source)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_source = cust_source;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_industry</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_industry;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_industry</span><span class="params">(String cust_industry)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_industry = cust_industry;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_level</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_level;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_level</span><span class="params">(String cust_level)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_level = cust_level;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_phone</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_phone;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_phone</span><span class="params">(String cust_phone)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_phone = cust_phone;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_mobile</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_mobile;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_mobile</span><span class="params">(String cust_mobile)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_mobile = cust_mobile;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;LinkMan&gt; <span class="title">getLinkMans</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> linkMans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLinkMans</span><span class="params">(Set&lt;LinkMan&gt; linkMans)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.linkMans = linkMans;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="多的一方-1"><a href="#多的一方-1" class="headerlink" title="多的一方"></a>多的一方</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.hibernate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkMan</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Long lkm_id;</span><br><span class="line"><span class="keyword">private</span> String lkm_name;</span><br><span class="line"><span class="keyword">private</span> String lkm_gender;</span><br><span class="line"><span class="keyword">private</span> String lkm_phone;</span><br><span class="line"><span class="keyword">private</span> String lkm_mobile;</span><br><span class="line"><span class="keyword">private</span> String lkm_email;</span><br><span class="line"><span class="keyword">private</span> String lkm_qq;</span><br><span class="line"><span class="keyword">private</span> String lkm_position;</span><br><span class="line"><span class="keyword">private</span> String lkm_memo;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过ORM方式表示:一个联系人只能属于某一个客户</span></span><br><span class="line"><span class="comment">//放置的是一的一方</span></span><br><span class="line"><span class="comment">//把外键改成一的一方的对象</span></span><br><span class="line"><span class="keyword">private</span> Customer customer;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getLkm_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> lkm_id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLkm_id</span><span class="params">(Long lkm_id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.lkm_id = lkm_id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getLkm_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> lkm_name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLkm_name</span><span class="params">(String lkm_name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.lkm_name = lkm_name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getLkm_gender</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> lkm_gender;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLkm_gender</span><span class="params">(String lkm_gender)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.lkm_gender = lkm_gender;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getLkm_phone</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> lkm_phone;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLkm_phone</span><span class="params">(String lkm_phone)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.lkm_phone = lkm_phone;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getLkm_mobile</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> lkm_mobile;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLkm_mobile</span><span class="params">(String lkm_mobile)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.lkm_mobile = lkm_mobile;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getLkm_email</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> lkm_email;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLkm_email</span><span class="params">(String lkm_email)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.lkm_email = lkm_email;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getLkm_qq</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> lkm_qq;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLkm_qq</span><span class="params">(String lkm_qq)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.lkm_qq = lkm_qq;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getLkm_position</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> lkm_position;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLkm_position</span><span class="params">(String lkm_position)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.lkm_position = lkm_position;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getLkm_memo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> lkm_memo;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLkm_memo</span><span class="params">(String lkm_memo)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.lkm_memo = lkm_memo;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Customer <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> customer;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.customer = customer;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="映射创建"><a href="#映射创建" class="headerlink" title="映射创建"></a>映射创建</h3><h4 id="多的一方-2"><a href="#多的一方-2" class="headerlink" title="多的一方"></a>多的一方</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zjinc36.hibernate.LinkMan"</span> <span class="attr">table</span>=<span class="string">"cst_linkman"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的属性和表中的主键对应 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类中的属性,column对应表中的字段 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"lkm_id"</span> <span class="attr">column</span>=<span class="string">"lkm_id"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的普通的属性和表的字段的对应 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_name"</span> <span class="attr">column</span>=<span class="string">"lkm_name"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_gender"</span> <span class="attr">column</span>=<span class="string">"lkm_gender"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_phone"</span> <span class="attr">column</span>=<span class="string">"lkm_phone"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_mobile"</span> <span class="attr">column</span>=<span class="string">"lkm_mobile"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_email"</span> <span class="attr">column</span>=<span class="string">"lkm_email"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_qq"</span> <span class="attr">column</span>=<span class="string">"lkm_qq"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_position"</span> <span class="attr">column</span>=<span class="string">"lkm_position"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_memo"</span> <span class="attr">column</span>=<span class="string">"lkm_memo"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置一对多的关系 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 自己是多的一方,则这里要放一的一方 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                    many-to-one标签</span></span><br><span class="line"><span class="comment">                    +name:name表示自己类中用哪个变量表示对方</span></span><br><span class="line"><span class="comment">                    +   class表示对方类的全路径</span></span><br><span class="line"><span class="comment">                    +   column表示自己用哪个字段来与对方联系(参与构成外键的字段)</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"customer"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.hibernate.Customer"</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="一的一方-2"><a href="#一的一方-2" class="headerlink" title="一的一方"></a>一的一方</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 根标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类与表的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类名,table对应表名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zjinc36.hibernate.Customer"</span> <span class="attr">table</span>=<span class="string">"cst_customer"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的属性和表中的主键对应 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类中的属性,column对应表中的字段 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cust_id"</span> <span class="attr">column</span>=<span class="string">"cust_id"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的普通的属性和表的字段的对应 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_name"</span> <span class="attr">column</span>=<span class="string">"cust_name"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_source"</span> <span class="attr">column</span>=<span class="string">"cust_source"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_industry"</span> <span class="attr">column</span>=<span class="string">"cust_industry"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_level"</span> <span class="attr">column</span>=<span class="string">"cust_level"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_phone"</span> <span class="attr">column</span>=<span class="string">"cust_phone"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_mobile"</span> <span class="attr">column</span>=<span class="string">"cust_mobile"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置一对多的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- set标签:name表示自己类中用哪个变量表示对方 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMans"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- key标签:column表示自己用哪个字段来与对方联系(参与构成外键的字段) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- one-to-many标签:class表示对方类的全路径 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.hibernate.LinkMan"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置核心文件"><a href="#配置核心文件" class="headerlink" title="配置核心文件"></a>配置核心文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 连接数据库的基本参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/hibernate?useSSL=false<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Hibernate的方言 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQL5Dialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是否显示sql   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是否格式化sql --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是否使用注释  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.use_sql_comments"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 设置事务隔离级别 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.isolation"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置当前线程绑定Session --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 映射规则文件 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 这里有进行修改 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zjinc36/hibernate/Customer.hbm.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zjinc36/hibernate/LinkMan.hbm.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="一对多的级联操作"><a href="#一对多的级联操作" class="headerlink" title="一对多的级联操作"></a>一对多的级联操作</h2><h3 id="什么叫做级联"><a href="#什么叫做级联" class="headerlink" title="什么叫做级联"></a>什么叫做级联</h3><p>操作一个对象的时候,是否会同时操作其关联的对象</p><h3 id="级联是有方向性"><a href="#级联是有方向性" class="headerlink" title="级联是有方向性"></a>级联是有方向性</h3><ul><li>操作一的一方的时候,是否操作多的一方</li><li>操作多的一方的时候,是否操作一的一方</li></ul><h3 id="级联保存或更新"><a href="#级联保存或更新" class="headerlink" title="级联保存或更新"></a>级联保存或更新</h3><h4 id="操作一的一方"><a href="#操作一的一方" class="headerlink" title="操作一的一方"></a>操作一的一方</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 要配置set --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 根标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类与表的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类名,table对应表名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zjinc36.hibernate.Customer"</span> <span class="attr">table</span>=<span class="string">"cst_customer"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的属性和表中的主键对应 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类中的属性,column对应表中的字段 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cust_id"</span> <span class="attr">column</span>=<span class="string">"cust_id"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的普通的属性和表的字段的对应 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_name"</span> <span class="attr">column</span>=<span class="string">"cust_name"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_source"</span> <span class="attr">column</span>=<span class="string">"cust_source"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_industry"</span> <span class="attr">column</span>=<span class="string">"cust_industry"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_level"</span> <span class="attr">column</span>=<span class="string">"cust_level"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_phone"</span> <span class="attr">column</span>=<span class="string">"cust_phone"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_mobile"</span> <span class="attr">column</span>=<span class="string">"cust_mobile"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置一对多的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- set标签:name表示自己类中用哪个变量表示对方 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMans"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- key标签:column表示自己用哪个字段来与对方联系(参与构成外键的字段) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- one-to-many标签:class表示对方类的全路径 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.hibernate.LinkMan"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 级联保存或更新操作</span></span><br><span class="line"><span class="comment"> * 保存客户级联联系人,操作的主题是客户对象,需要在Customer.hbm.xml中进行配置</span></span><br><span class="line"><span class="comment"> * &lt;set name="linkMans" cascade="save-update"&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.创建客户</span></span><br><span class="line">Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">customer.setCust_name(<span class="string">"liubei"</span>);</span><br><span class="line"><span class="comment">//2.创建联系人</span></span><br><span class="line">LinkMan linkMan = <span class="keyword">new</span> LinkMan();</span><br><span class="line">linkMan.setLkm_name(<span class="string">"zhaoyun"</span>);</span><br><span class="line"><span class="comment">//3.设置关系</span></span><br><span class="line">customer.getLinkMans().add(linkMan);</span><br><span class="line">linkMan.setCustomer(customer);</span><br><span class="line"><span class="comment">//4.保存数据</span></span><br><span class="line"><span class="comment">//前三步没有区别,就最后一步有区别</span></span><br><span class="line"><span class="comment">//由于对一的一方进行设置(&lt;set name="linkMans" cascade="save-update"&gt;)</span></span><br><span class="line"><span class="comment">//所以保存的时候只需要保存一的一方</span></span><br><span class="line">session.save(customer);</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="操作多的一方"><a href="#操作多的一方" class="headerlink" title="操作多的一方"></a>操作多的一方</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 需要配置LinkMan.hbm.xml文件 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 其他省略 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"customer"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.hibernate.Customer"</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-one</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="测试对象导航"><a href="#测试对象导航" class="headerlink" title="测试对象导航"></a>测试对象导航</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试对象导航</span></span><br><span class="line"><span class="comment"> * 一对多双方都设置cascade="save-update"</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">//1.创建客户</span></span><br><span class="line">Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">customer.setCust_name(<span class="string">"liubei"</span>);</span><br><span class="line"><span class="comment">//2.创建联系人</span></span><br><span class="line">LinkMan linkMan1 = <span class="keyword">new</span> LinkMan();</span><br><span class="line">linkMan1.setLkm_name(<span class="string">"zhaoyun"</span>);</span><br><span class="line">LinkMan linkMan2 = <span class="keyword">new</span> LinkMan();</span><br><span class="line">linkMan2.setLkm_name(<span class="string">"huangzhong"</span>);</span><br><span class="line">LinkMan linkMan3 = <span class="keyword">new</span> LinkMan();</span><br><span class="line">linkMan3.setLkm_name(<span class="string">"machao"</span>);</span><br><span class="line"><span class="comment">//3.设置关系</span></span><br><span class="line">linkMan1.setCustomer(customer);</span><br><span class="line">customer.getLinkMans().add(linkMan2);</span><br><span class="line">customer.getLinkMans().add(linkMan3);</span><br><span class="line"><span class="comment">//4.保存数据</span></span><br><span class="line"><span class="comment">//session.save(linkMan1);//发送4条insert语句</span></span><br><span class="line"><span class="comment">//session.save(customer);//发送3条insert语句</span></span><br><span class="line">session.save(linkMan2);<span class="comment">//发送1条insert语句</span></span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="级联删除"><a href="#级联删除" class="headerlink" title="级联删除"></a>级联删除</h3><h4 id="未设置级联删除"><a href="#未设置级联删除" class="headerlink" title="未设置级联删除"></a>未设置级联删除</h4><blockquote><p>  //实际会产生如下动作</p><ol><li>将外键设置为空</li><li>在删除对应的值</li></ol></blockquote><h4 id="设置级联删除"><a href="#设置级联删除" class="headerlink" title="设置级联删除"></a>设置级联删除</h4><p><strong><em>删除客户级联删除联系人</em></strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 需要配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMans"</span> <span class="attr">cascade</span>=<span class="string">"save-update, delete"</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 级联删除</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">Customer customer = session.get(Customer.class, <span class="number">1L</span>);</span><br><span class="line">session.delete(customer);</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><em>注:删除联系人级联删除客户(基本不用)</em></strong></p><h2 id="一对多设置了双向关联产生多余的SQL语句"><a href="#一对多设置了双向关联产生多余的SQL语句" class="headerlink" title="一对多设置了双向关联产生多余的SQL语句"></a>一对多设置了双向关联产生多余的SQL语句</h2><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p><img src="/images/20190708003.png" alt></p><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><ul><li>单向维护</li><li>使一的一方放弃维护权 -&gt; 在set上配置 inverse=”true”<blockquote><p>  在一对多关联查询的修改的时候,必须设置</p></blockquote></li></ul><h2 id="区分cascade和inverse的区别"><a href="#区分cascade和inverse的区别" class="headerlink" title="区分cascade和inverse的区别"></a>区分cascade和inverse的区别</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 区分cascade和inverse的区别</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line">Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">customer.setCust_name(<span class="string">"liubei"</span>);</span><br><span class="line">LinkMan linkMan = <span class="keyword">new</span> LinkMan();</span><br><span class="line">linkMan.setLkm_name(<span class="string">"zhugeliang"</span>);</span><br><span class="line">customer.getLinkMans().add(linkMan);</span><br><span class="line"><span class="comment">// 条件Customer.hbm.xml上的set中配置了cascade="save-update" inverse="true"</span></span><br><span class="line">session.save(customer);<span class="comment">//客户会插入到数据,联系人也会插入到数据,但是外键为null</span></span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="多对多关系"><a href="#多对多关系" class="headerlink" title="多对多关系"></a>多对多关系</h1><h2 id="什么样关系属于多对多"><a href="#什么样关系属于多对多" class="headerlink" title="什么样关系属于多对多"></a>什么样关系属于多对多</h2><ul><li>一个学生可以选择多门课程,一门课程也可以被多个学生选择</li><li>一个用户可以选择多个角色,一个角色也可以被多个用户选择</li></ul><h2 id="多对多建表原则"><a href="#多对多建表原则" class="headerlink" title="多对多建表原则"></a>多对多建表原则</h2><p>创建一个中间表,中间表至少有两个字段,分别作为外键指向多对多双方的主键</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="SQL语句-1"><a href="#SQL语句-1" class="headerlink" title="SQL语句"></a>SQL语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_user (</span><br><span class="line">user_id <span class="built_in">bigint</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span> auto_increment <span class="keyword">comment</span> <span class="string">'用户id'</span>,</span><br><span class="line">user_code <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'用户帐号'</span>,</span><br><span class="line">user_name <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'用户名称'</span>,</span><br><span class="line">user_password <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'用户密码'</span>,</span><br><span class="line">user_state <span class="built_in">char</span>(<span class="number">1</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'1:正常,0:暂停'</span>,</span><br><span class="line">primary <span class="keyword">key</span>(user_id)</span><br><span class="line">) <span class="keyword">engine</span>=<span class="keyword">innodb</span> auto_increment=<span class="number">1</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 角色表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> sys_role (</span><br><span class="line">role_id <span class="built_in">bigint</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span> auto_increment <span class="keyword">comment</span> <span class="string">'角色id'</span>,</span><br><span class="line">role_name <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'角色名'</span>,</span><br><span class="line">role_memo <span class="built_in">varchar</span>(<span class="number">64</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">''</span>,</span><br><span class="line">primary <span class="keyword">key</span>(role_id)</span><br><span class="line">) <span class="keyword">engine</span>=<span class="keyword">innodb</span> auto_increment=<span class="number">1</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 中间表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sys_user_role (</span><br><span class="line">role_id <span class="built_in">bigint</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">comment</span> <span class="string">'角色id'</span>,</span><br><span class="line">user_id <span class="built_in">bigint</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">comment</span> <span class="string">'用户id'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (role_id, user_id),</span><br><span class="line"><span class="keyword">KEY</span> FK_user_role_user_id(user_id),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> FK_user_role_role_id <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (role_id) <span class="keyword">REFERENCES</span> sys_role(role_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">NO</span> <span class="keyword">ACTION</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">NO</span> <span class="keyword">ACTION</span>,</span><br><span class="line"><span class="keyword">CONSTRAINT</span> FK_user_role_user_id <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (user_id) <span class="keyword">REFERENCES</span> sys_user(user_id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">NO</span> <span class="keyword">ACTION</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">NO</span> <span class="keyword">ACTION</span></span><br><span class="line">)<span class="keyword">engine</span>=<span class="keyword">innodb</span> <span class="keyword">default</span> <span class="keyword">charset</span>=utf8</span><br></pre></td></tr></table></figure><h3 id="ER图"><a href="#ER图" class="headerlink" title="ER图"></a>ER图</h3><p><img src="/images/20190709001.png" alt></p><h3 id="java代码"><a href="#java代码" class="headerlink" title="java代码"></a>java代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long role_id;</span><br><span class="line">    <span class="keyword">private</span> String role_name;</span><br><span class="line">    <span class="keyword">private</span> String role_memo;</span><br><span class="line">    <span class="comment">//一个角色被多个用户选择</span></span><br><span class="line">    <span class="comment">//放置的是用户的集合</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;User&gt; users = <span class="keyword">new</span> HashSet&lt;User&gt;();</span><br><span class="line">    <span class="comment">// getters and setters...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long user_id;</span><br><span class="line">    <span class="keyword">private</span> String user_code;</span><br><span class="line">    <span class="keyword">private</span> String user_name;</span><br><span class="line">    <span class="keyword">private</span> String user_password;</span><br><span class="line">    <span class="keyword">private</span> String user_state;</span><br><span class="line">    <span class="comment">//一个用户有多个角色</span></span><br><span class="line">    <span class="comment">//放置的是角色的集合</span></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Role&gt; roles = <span class="keyword">new</span> HashSet&lt;Role&gt;();</span><br><span class="line">    <span class="comment">// getters and setters...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="xml文件配置"><a href="#xml文件配置" class="headerlink" title="xml文件配置"></a>xml文件配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 根标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类与表的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类名,table对应表名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zjinc36.hibernate.Role"</span> <span class="attr">table</span>=<span class="string">"sys_role"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的属性和表中的主键对应 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类中的属性,column对应表中的字段 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"role_id"</span> <span class="attr">column</span>=<span class="string">"role_id"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的普通的属性和表的字段的对应 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"role_name"</span> <span class="attr">column</span>=<span class="string">"role_name"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"role_memo"</span> <span class="attr">column</span>=<span class="string">"role_memo"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置多对多的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 自己对对方的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- set标签:</span></span><br><span class="line"><span class="comment">name表示自己类中的private中是用哪个变量名作为对方对象集合的属性</span></span><br><span class="line"><span class="comment">table:多对多关系需要使用中间表,放的是中间表的名称</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"users"</span> <span class="attr">table</span>=<span class="string">"sys_user_role"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- key标签:column表示自己哪个字段名用来参与与对方联系(外键字段) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"role_id"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- many-to-many标签:</span></span><br><span class="line"><span class="comment">class表示对方的类的全路径</span></span><br><span class="line"><span class="comment">column表示对方哪个字段名用来参与与对方联系((外键字段))</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.hibernate.User"</span> <span class="attr">column</span>=<span class="string">"user_id"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 根标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类与表的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类名,table对应表名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zjinc36.hibernate.User"</span> <span class="attr">table</span>=<span class="string">"sys_user"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的属性和表中的主键对应 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类中的属性,column对应表中的字段 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"user_id"</span> <span class="attr">column</span>=<span class="string">"user_id"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的普通的属性和表的字段的对应 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_code"</span> <span class="attr">column</span>=<span class="string">"user_code"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_name"</span> <span class="attr">column</span>=<span class="string">"user_name"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_password"</span> <span class="attr">column</span>=<span class="string">"user_password"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_state"</span> <span class="attr">column</span>=<span class="string">"user_state"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置多对多的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 自己对对方的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- set标签:</span></span><br><span class="line"><span class="comment">name表示自己类中的private中是用哪个变量名作为对方对象集合的属性</span></span><br><span class="line"><span class="comment">table:多对多关系需要使用中间表,放的是中间表的名称</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"roles"</span> <span class="attr">table</span>=<span class="string">"sys_user_role"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- key标签:column表示自己哪个字段名用来参与与对方联系(外键字段) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"role_id"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- many-to-many标签:</span></span><br><span class="line"><span class="comment">class表示对方的类的全路径</span></span><br><span class="line"><span class="comment">column表示对方哪个字段名用来参与与对方联系(外键字段)</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.hibernate.Role"</span> <span class="attr">column</span>=<span class="string">"role_id"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="配置核心文件-1"><a href="#配置核心文件-1" class="headerlink" title="配置核心文件"></a>配置核心文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zjinc36/hibernate/Role.hbm.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zjinc36/hibernate/User.hbm.xml"</span> /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Hibernate的多对多操作"><a href="#Hibernate的多对多操作" class="headerlink" title="Hibernate的多对多操作"></a>Hibernate的多对多操作</h3><h4 id="级联操作"><a href="#级联操作" class="headerlink" title="级联操作"></a>级联操作</h4><ul><li>级联保存和更新</li><li>级联删除(了解)</li></ul><h4 id="其他的操作"><a href="#其他的操作" class="headerlink" title="其他的操作"></a>其他的操作</h4><ul><li>给用户选择角色</li><li>给用户该选角色</li><li>给用户删除角色</li></ul><h1 id="一对一关系"><a href="#一对一关系" class="headerlink" title="一对一关系"></a>一对一关系</h1><h2 id="什么样的关系属于一对一"><a href="#什么样的关系属于一对一" class="headerlink" title="什么样的关系属于一对一"></a>什么样的关系属于一对一</h2><ul><li>一个公司只能有一个注册地址,一个地址只能被一个公司注册</li></ul><h2 id="一对一建表原则"><a href="#一对一建表原则" class="headerlink" title="一对一建表原则"></a>一对一建表原则</h2><ul><li>方式一:主键对应</li><li>方式二:唯一外键对应(就是在其中一张表加一个字段,该字段的内容和另一张表的主键一致)</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hibernate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hibernate事务管理</title>
      <link href="/2019/07/08/Hibernate%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86/"/>
      <url>/2019/07/08/Hibernate%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><h2 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h2><p>事务指的是逻辑上的一组操作,组成这组操作的各个逻辑单元,要么全部成功,要么全部失败</p><h2 id="事务特性"><a href="#事务特性" class="headerlink" title="事务特性"></a>事务特性</h2><ul><li>原子性:代表事务不可分割</li><li>一致性:代表事务执行的前后,数据的完整性保持一致</li><li>隔离性:代表一个事务执行的过程中,不应该收到其他事务的干扰</li><li>持久性:代表事务执行完成后,数据就持久到数据库中</li></ul><h2 id="如果不考虑隔离性-引发安全问题"><a href="#如果不考虑隔离性-引发安全问题" class="headerlink" title="如果不考虑隔离性,引发安全问题"></a>如果不考虑隔离性,引发安全问题</h2><h3 id="读问题"><a href="#读问题" class="headerlink" title="读问题"></a>读问题</h3><ul><li>脏读:一个事务读到另一个事务未提交的数据</li><li>不可重复读:一个事务读到另一个事务已经提交的update数据,导致在前一个事务多次查询结果不一致</li><li>虚读:一个事务读到另一个事务已经提交的insert数据,导致在前一个事务多次查询结果不一致</li></ul><h3 id="写问题-了解"><a href="#写问题-了解" class="headerlink" title="写问题(了解)"></a>写问题(了解)</h3><p>引发两类丢失更新</p><h2 id="读问题的解决"><a href="#读问题的解决" class="headerlink" title="读问题的解决"></a>读问题的解决</h2><ul><li>Read uncommitted:以上读问题都会发生</li><li>Read committed:解决脏读,但是不可重复读和虚度有可能发生(Oracle用这种)</li><li>Repeatable read:解决脏读和不可重复读,但是虚读有可能发生(MySQL用这种)</li><li>Serializable:解决所有问题,但是效率低</li></ul><h1 id="Hibernate设置隔离级别"><a href="#Hibernate设置隔离级别" class="headerlink" title="Hibernate设置隔离级别"></a>Hibernate设置隔离级别</h1><h2 id="四种隔离级别对应的数字"><a href="#四种隔离级别对应的数字" class="headerlink" title="四种隔离级别对应的数字"></a>四种隔离级别对应的数字</h2><ul><li>Read uncommitted —- 1</li><li>Read committed —- 2</li><li>Repeatable read —- 4</li><li>Serializable —- 8</li></ul><h2 id="设置隔离级别"><a href="#设置隔离级别" class="headerlink" title="设置隔离级别"></a>设置隔离级别</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 如下,设置事务隔离级别 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 设置事务隔离级别 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.isolation"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- hibernate.cfg.xml文件的全部内容 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 用以确定 事务隔离级别 在该文件中要写在哪里 --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 连接数据库的基本参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/hibernate<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Hibernate的方言 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是否显示sql   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是否格式化sql --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是否使用注释  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.use_sql_comments"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 设置事务隔离级别 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.isolation"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 映射规则文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zjinc36/hibernate/Customer.hbm.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="将事务加在Service层"><a href="#将事务加在Service层" class="headerlink" title="将事务加在Service层"></a>将事务加在Service层</h1><h2 id="为什么需要把事务加在业务层"><a href="#为什么需要把事务加在业务层" class="headerlink" title="为什么需要把事务加在业务层"></a>为什么需要把事务加在业务层</h2><ol><li>Dao中封装的是对数据源的单个操作(进行一次CURD)</li><li>Service中封装业务逻辑操作,一个业务逻辑往往需要对数据源操作多次</li><li>由于一个Service 会调用多个Dao，为了保证这些调用的原子性，事务都是放到Service层的；</li><li>若是放到Dao层的话，那么Service里调用的其他的Dao无法保证与前面已经调用的Dao在同一个事务中</li></ol><h2 id="保证在同一个事务是什么意思"><a href="#保证在同一个事务是什么意思" class="headerlink" title="保证在同一个事务是什么意思"></a>保证在同一个事务是什么意思</h2><ol><li>在jdbc要保证connection是同一个</li><li>在hibernate中要保证session是同一个</li></ol><h2 id="在Service层中如何保证在同一个事物"><a href="#在Service层中如何保证在同一个事物" class="headerlink" title="在Service层中如何保证在同一个事物"></a>在Service层中如何保证在同一个事物</h2><p><a href="https://blog.csdn.net/tanghui270270/article/details/88427076" target="_blank" rel="noopener"><em>参考:https://blog.csdn.net/tanghui270270/article/details/88427076</em></a></p><ul><li>方法一:将connection向下传递(DBUtils就是这样做的)</li><li>方法二:使用ThreadLocal对象(Hibernate有封装)<blockquote><p>  <a href="https://juejin.im/post/5ac2eb52518825555e5e06ee" target="_blank" rel="noopener"><em>ThreadLocal说明:https://juejin.im/post/5ac2eb52518825555e5e06ee</em></a><br>  简而言之:往ThreadLocal中填充的变量属于当前线程，该变量对其他线程而言是隔离的,实现了线程的数据隔离</p></blockquote></li></ul><p>由此可以知道我们只需要做如下两件事</p><ol><li>将这个连接绑定到当前线程中</li><li>在DAO的方法中,通过当前的线程获得到连接对象</li></ol><h2 id="Hibernate框架如何使用封装好的ThreadLocal"><a href="#Hibernate框架如何使用封装好的ThreadLocal" class="headerlink" title="Hibernate框架如何使用封装好的ThreadLocal"></a>Hibernate框架如何使用封装好的ThreadLocal</h2><ol><li>在SessionFactory中提供一个方法getCurrentSeesion()</li><li>要开启这个方法,需要通过一个配置完成</li></ol><h3 id="改写工具类"><a href="#改写工具类" class="headerlink" title="改写工具类"></a>改写工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hiberante的工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateUtils</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Configuration cfg;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> SessionFactory sf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">cfg = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">sf = cfg.buildSessionFactory();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">openSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> sf.openSession();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">getCurrentSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> sf.getCurrentSession();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置当前线程绑定Session --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 具体在hibernate.cfg.xml文件中的位置 --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 连接数据库的基本参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/hibernate<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Hibernate的方言 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是否显示sql   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是否格式化sql --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是否使用注释  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.use_sql_comments"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 设置事务隔离级别 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.isolation"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置当前线程绑定Session --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 映射规则文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zjinc36/hibernate/Customer.hbm.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">customer.setCust_name(<span class="string">"张飞"</span>);</span><br><span class="line">session.save(customer);</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line"><span class="comment">// session不用关闭</span></span><br><span class="line"><span class="comment">// 因为使用getCurrentSession()时,线程结束会自动关闭</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hibernate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu安装截屏工具Shutter</title>
      <link href="/2019/07/08/Ubuntu%E5%AE%89%E8%A3%85%E6%88%AA%E5%B1%8F%E5%B7%A5%E5%85%B7Shutter/"/>
      <url>/2019/07/08/Ubuntu%E5%AE%89%E8%A3%85%E6%88%AA%E5%B1%8F%E5%B7%A5%E5%85%B7Shutter/</url>
      
        <content type="html"><![CDATA[<h1 id="安装截图工具Shutter"><a href="#安装截图工具Shutter" class="headerlink" title="安装截图工具Shutter"></a>安装截图工具Shutter</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="Ubuntu18-04"><a href="#Ubuntu18-04" class="headerlink" title="Ubuntu18.04"></a>Ubuntu18.04</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   添加安装包软件源</span></span><br><span class="line">sudo add-apt-repository ppa:shutter/ppa</span><br><span class="line"></span><br><span class="line"><span class="comment">#   更新源并安装 shutter</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install shutter</span><br></pre></td></tr></table></figure><h3 id="Ubuntu20-04"><a href="#Ubuntu20-04" class="headerlink" title="Ubuntu20.04"></a>Ubuntu20.04</h3><ol start="0"><li><p><a href="https://www.sinocalife.com/ubuntu-20-04-screenshot-trident-tools-gnome-screenshot-flameshot-shutter" target="_blank" rel="noopener">参考Ubuntu 20.04 截图软件的使用 (gnome-screenshot、flameshot、shutter 截图编辑三叉戟)</a></p></li><li><p>虽然软件中心提供了，但是不要使用软件中心安装shutter<br>安装：Ubuntu 20.04 官方源提供的 snap 版本可以安装，但运行时存在缺陷，发现如下问题：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Error while opening directory /home/username/Pictures</span><br><span class="line">There was an error determining the filename ...</span><br><span class="line">截取窗口时程序崩溃却未退出，因此再次启动程序导致部分功能依然不能使用，需先杀死进程</span><br><span class="line">解决办法：不要使用官方snap包（软件中心）进行安装，添加下面的PPA源安装（定制修正版）即可（此版本暂不能截取网页，但其他功能稳定）</span><br></pre></td></tr></table></figure></li><li><p>安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   删除已安装有缺陷的版本</span></span><br><span class="line">sudo snap remove shutter</span><br><span class="line"></span><br><span class="line"><span class="comment">#   添加安装包软件源</span></span><br><span class="line">sudo add-apt-repository ppa:linuxuprising/shutter</span><br><span class="line"></span><br><span class="line"><span class="comment">#   更新源并安装 shutter</span></span><br><span class="line">sudo apt-get update -y</span><br><span class="line">sudo apt-get install shutter -y</span><br></pre></td></tr></table></figure></li></ol><h2 id="问题-shutter编辑按钮灰色"><a href="#问题-shutter编辑按钮灰色" class="headerlink" title="问题:shutter编辑按钮灰色"></a>问题:shutter编辑按钮灰色</h2><h3 id="Ubuntu18-04-1"><a href="#Ubuntu18-04-1" class="headerlink" title="Ubuntu18.04"></a>Ubuntu18.04</h3><ul><li><a href="https://itsfoss.com/shutter-edit-button-disabled/" target="_blank" rel="noopener">参考:https://itsfoss.com/shutter-edit-button-disabled/</a></li><li>总结起来就是如下操作<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#   下载必要的依赖</span></span><br><span class="line">wget https://launchpad.net/ubuntu/+archive/primary/+files/libgoocanvas-common_1.0.0-1_all.deb</span><br><span class="line">wget https://launchpad.net/ubuntu/+archive/primary/+files/libgoocanvas3_1.0.0-1_amd64.deb</span><br><span class="line">wget https://launchpad.net/ubuntu/+archive/primary/+files/libgoo-canvas-perl_0.06-2ubuntu3_amd64.deb</span><br><span class="line"></span><br><span class="line"><span class="comment">#   安装依赖</span></span><br><span class="line">sudo dpkg -i libgoocanvas-common_1.0.0-1_all.deb</span><br><span class="line">sudo dpkg -i libgoocanvas3_1.0.0-1_amd64.deb</span><br><span class="line">sudo dpkg -i libgoo-canvas-perl_0.06-2ubuntu3_amd64.deb</span><br><span class="line">sudo apt -f install</span><br><span class="line"></span><br><span class="line"><span class="comment">#   重启shutter(或者重新安装shutter)</span></span><br><span class="line">sudo killall shutter</span><br><span class="line">重新启动shutter</span><br></pre></td></tr></table></figure></li></ul><h3 id="Ubuntu20-04-1"><a href="#Ubuntu20-04-1" class="headerlink" title="Ubuntu20.04"></a>Ubuntu20.04</h3><ul><li>截至20200802为止,暂时没有找到好的解决方法</li><li>按照18.04的解决方法操作,<code>libgoo-canvas-perl_0.06-2ubuntu3_amd64.deb</code>需要依赖<code>perlapi-5.26.0</code>,但无法安装<br><img src="/images/2020/08/20200802130024.png" alt></li></ul><h1 id="设置快捷键"><a href="#设置快捷键" class="headerlink" title="设置快捷键"></a>设置快捷键</h1><p><a href="https://blog.csdn.net/hanshileiai/article/details/46843713" target="_blank" rel="noopener"><em>参考:ubuntu 安装截图工具 Shutter，并设置快捷键 Ctrl+Alt+A</em></a><br><img src="/images/20190730018.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hibernate持久化类的编写规则</title>
      <link href="/2019/07/07/Hibernate%E6%8C%81%E4%B9%85%E5%8C%96%E7%B1%BB%E7%9A%84%E7%BC%96%E5%86%99%E8%A7%84%E5%88%99/"/>
      <url>/2019/07/07/Hibernate%E6%8C%81%E4%B9%85%E5%8C%96%E7%B1%BB%E7%9A%84%E7%BC%96%E5%86%99%E8%A7%84%E5%88%99/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是持久化类"><a href="#什么是持久化类" class="headerlink" title="什么是持久化类"></a>什么是持久化类</h1><ul><li>持久化:将内存中的一个对象持久化到数据库中的过程,Hibernate就是用来进行持久化的框架</li><li>持久化类:一个java对象与数据库的表建立了映射关系,那么这个类在Hibernate中称为持久化类,即<code>持久化类=Java类+映射文件</code></li></ul><h1 id="持久化类的编写规则"><a href="#持久化类的编写规则" class="headerlink" title="持久化类的编写规则"></a>持久化类的编写规则</h1><ul><li>对持久化类<code>提供一个无参数的构造方法</code>:Hibernate底层需要使用反射生成实例</li><li><code>属性需要私有,对私有属性提供public的get和set方法</code>:Hibernta中获取,设置对象的值</li><li>对持久化类<code>提供一个唯一标识OID与数据库主键对应</code>:java通过对象的地址区分是否是同一个对象,数据库中通过主键确定是否是同一个记录,在Hibernate中通过持久化类的OID的属性区分是否是同一个对象</li><li>持久化类中<code>属性尽量使用包装类类型</code>:因为基本数据类型默认是0,那么插入0的时候就会出现歧义.而包装类类型默认值是null</li><li>持久化类<code>不要使用final修饰</code>:延迟加载本身是hibernate一个优化的手段,返回的是一个代理对象(javassist可以对没有实现接口的类产生代理 —- 使用了非常底层字节码增强技术,继承这个类进行代理),如果不能被继承,就不能产生代理对象,延迟加载也就失效,load方法就和get方法一致</li></ul><h1 id="主键生成策略"><a href="#主键生成策略" class="headerlink" title="主键生成策略"></a>主键生成策略</h1><h2 id="主键的分类"><a href="#主键的分类" class="headerlink" title="主键的分类"></a>主键的分类</h2><ul><li>自然主键<br>主键的本身就是表中的一个字段(实体中一个具体的属性)</li><li>代理主键<br>主键本身不是表中必须的一个字段(不是实体中的某个具体属性)</li></ul><p><strong>在实际开发中,尽量使用代理主键</strong></p><blockquote><p>  因为一旦自然主键参与到业务逻辑中,后期有可能需要修改源代码<br>  设计原则:好的程序设计满足OCP原则,对程序的扩展是open,对修改源码是close的</p></blockquote><h2 id="Hibernate的主键生成策略"><a href="#Hibernate的主键生成策略" class="headerlink" title="Hibernate的主键生成策略"></a>Hibernate的主键生成策略</h2><p>在实际开发中一般不允许用户手动设置主键,一般将主键交给数据库,手动编写程序进行设置.在Hibernate中为了减少程序编写,提供了很多的主键生成策略</p><ul><li>increment:hibernate中提供的自动增长机制,适用short,int,long类型的主键<blockquote><p>  <strong>在单线程程序中使用,不准用在多线程程序</strong><br>  运行机制:首先发送一条语句: select max(id) from 表, 然后让 id+1 作为下一条记录的主键</p></blockquote></li><li>identity:适用short,int,long类型的主键,使用的是数据库底层的自动增长机制<blockquote><p>  <strong>没有自动增长机制的数据库不能用</strong><br>  适用于自动增长机制数据库(MySQL,MSSQL),Oracle没有自动增长机制</p></blockquote></li><li>sequence:适用short,int,long类型的主键,采用的是序列的方式<blockquote><p>  Oracle支持序列,MySQL不能使用sequence</p></blockquote></li><li>uuid:使用hibernate中的随机方式生成字符串主键<blockquote><p>  适用于字符串类型的主键</p></blockquote></li><li>native:本地策略,可以在identity和sequence之间进行自动切换<blockquote><p>  也就是说,如果底层使用MySQL,则使用identity机制,而如果使用oracle则使用sequence机制</p></blockquote></li><li>asigned:hibernat放弃外键的管理<blockquote><p>  也就是说:需要通过手动编写程序或者用户自己设置</p></blockquote></li><li>foreign:外部的(了解居多)<blockquote><p>  在一对一的一种关联映射的情况下使用</p></blockquote></li></ul><h2 id="主键生成策略写在xml中"><a href="#主键生成策略写在xml中" class="headerlink" title="主键生成策略写在xml中"></a>主键生成策略写在xml中</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Customer.hbm.xml文件 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在项目中的位置可以看"Hibernate入门与配置"一文中,下述代码对应位置 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 关注generator节点 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类与表的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类名,table对应表名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zjinc36.hibernate.Customer"</span> <span class="attr">table</span>=<span class="string">"cst_customer"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的属性和表中的主键对应 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类中的属性,column对应表中的字段 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cust_id"</span> <span class="attr">column</span>=<span class="string">"cust_id"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的普通的属性和表的字段的对应 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_name"</span> <span class="attr">column</span>=<span class="string">"cust_name"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_source"</span> <span class="attr">column</span>=<span class="string">"cust_source"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_industry"</span> <span class="attr">column</span>=<span class="string">"cust_industry"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_level"</span> <span class="attr">column</span>=<span class="string">"cust_level"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_phone"</span> <span class="attr">column</span>=<span class="string">"cust_phone"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_mobile"</span> <span class="attr">column</span>=<span class="string">"cust_mobile"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="持久化类的三种状态"><a href="#持久化类的三种状态" class="headerlink" title="持久化类的三种状态"></a>持久化类的三种状态</h1><p>Hibernate是持久层框架,通过持久化类完成ORM操作,Hibernate为了更好的管理持久化类,将持久化类分成三种状态</p><h2 id="瞬时态"><a href="#瞬时态" class="headerlink" title="瞬时态"></a>瞬时态</h2><p>这种对象没有唯一的标识OID,被session管理,称之为瞬时态对象</p><ul><li>在Session的缓存中，与Session实例相关联</li><li>在数据库中没有与之相对应的记录<h2 id="持久态"><a href="#持久态" class="headerlink" title="持久态"></a>持久态</h2>这种对象有唯一标识OID,被session管理,称为持久态对象</li><li>在Session的缓存中，与Session实例相关联</li><li>在数据库中存在与之相对应的记录<h2 id="脱管态-游离态"><a href="#脱管态-游离态" class="headerlink" title="脱管态(游离态)"></a>脱管态(游离态)</h2>这种对象有唯一标识OID,没有被session管理,称为脱管态对象</li><li>不在Session的缓存中，不与任何的Session实例相关联</li><li>在数据库中存在与之相对应的记录(前提条件是没有其他Session实例删除该条记录)</li></ul><h1 id="区分三种状态对象"><a href="#区分三种状态对象" class="headerlink" title="区分三种状态对象"></a>区分三种状态对象</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateDemo3</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.openSession();</span><br><span class="line">Transaction transaction = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//这种对象没有唯一的标识OID,被session管理,称之为瞬时态对象</span></span><br><span class="line">Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">customer.setCust_name(<span class="string">"wangwu"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//这种对象有唯一标识OID,被session管理,称为持久态对象</span></span><br><span class="line">Serializable id = session.save(customer);</span><br><span class="line"></span><br><span class="line">transaction.commit();</span><br><span class="line">session.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">//这种对象有唯一标识OID,没有被session管理,称为脱管态对象</span></span><br><span class="line">System.out.println(<span class="string">"客户名称:"</span> + customer.getCust_name());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="三种状态的转换"><a href="#三种状态的转换" class="headerlink" title="三种状态的转换"></a>三种状态的转换</h1><p><em>参考这篇文章<a href="https://blog.csdn.net/a772304419/article/details/79319988" target="_blank" rel="noopener">https://blog.csdn.net/a772304419/article/details/79319988</a></em></p><p><img src="/images/20190707001.png" alt></p><h2 id="瞬时态对象"><a href="#瞬时态对象" class="headerlink" title="瞬时态对象"></a>瞬时态对象</h2><h3 id="获得"><a href="#获得" class="headerlink" title="获得"></a>获得</h3><p>Customer customer = new Customer();</p><h3 id="状态转换"><a href="#状态转换" class="headerlink" title="状态转换"></a>状态转换</h3><ul><li>瞬时-&gt;持久:save();</li><li>瞬时-&gt;脱管:customer.setCust_id(1);</li></ul><h2 id="持久态对象"><a href="#持久态对象" class="headerlink" title="持久态对象"></a>持久态对象</h2><h3 id="获得-1"><a href="#获得-1" class="headerlink" title="获得"></a>获得</h3><ul><li>get() -&gt; Customer customer = session.get(Customer.class, 1L);</li><li>load()</li><li>find()</li><li>iterate()<h3 id="状态转换-1"><a href="#状态转换-1" class="headerlink" title="状态转换"></a>状态转换</h3></li><li>持久-&gt;瞬时:delete()</li><li>持久-&gt;脱管:close(),clear(),evict()<h2 id="脱管态对象"><a href="#脱管态对象" class="headerlink" title="脱管态对象"></a>脱管态对象</h2><h3 id="获得-2"><a href="#获得-2" class="headerlink" title="获得"></a>获得</h3></li><li>先变成瞬时:Customer customer = new Customer()</li><li>然后变成脱管:customer.setCust_id(1L)<h3 id="状态转化"><a href="#状态转化" class="headerlink" title="状态转化"></a>状态转化</h3></li><li>脱管-&gt;持久:update(),saveOrUpdate()</li><li>脱管-&gt;瞬时:customer.setCust_id(null)</li></ul><h1 id="什么是缓存"><a href="#什么是缓存" class="headerlink" title="什么是缓存"></a>什么是缓存</h1><p>缓存:是一种优化的方式,将数据存入到内存中,使用的时候直接从缓存中获取,不通过存储源</p><h1 id="Hibernate的缓存"><a href="#Hibernate的缓存" class="headerlink" title="Hibernate的缓存"></a>Hibernate的缓存</h1><p>Hibernate框架中提供了优化手段:缓存,抓取策略.<br>Hibernate中提供了两种缓存机制:一级缓存和二级缓存</p><h1 id="Hibernate的一级缓存"><a href="#Hibernate的一级缓存" class="headerlink" title="Hibernate的一级缓存"></a>Hibernate的一级缓存</h1><p>Hibernate的一级缓存:称为是Session级别的缓存,一级缓存生命周期与Session一致(一级缓存是由Session中的一系列的Java集合构成)<br><strong>一级缓存是自带的不可卸载的</strong></p><h2 id="证明一级缓存存在"><a href="#证明一级缓存存在" class="headerlink" title="证明一级缓存存在"></a>证明一级缓存存在</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 证明一级缓存的存在</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.openSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">// customer1和customer2是否执行了两次SQL语句</span></span><br><span class="line">Customer customer1 = session.get(Customer.class, <span class="number">6L</span>);<span class="comment">//发送SQL语句</span></span><br><span class="line">System.out.println(customer1);</span><br><span class="line">Customer customer2 = session.get(Customer.class, <span class="number">6L</span>);<span class="comment">//不发送SQL语句</span></span><br><span class="line">System.out.println(customer2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 两次是否是同一个对象</span></span><br><span class="line">System.out.println(customer1 == customer2);<span class="comment">//是指向同一个地址</span></span><br><span class="line"></span><br><span class="line">Customer customer3 = <span class="keyword">new</span> Customer();</span><br><span class="line">customer3.setCust_name(<span class="string">"关羽"</span>);</span><br><span class="line">Serializable id = session.save(customer3);</span><br><span class="line">session.get(Customer.class, id);<span class="comment">//不发送SQL语句,因为是直接从缓存中获取</span></span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="什么快照区"><a href="#什么快照区" class="headerlink" title="什么快照区"></a>什么快照区</h2><p>Hibernate一级缓存中的特殊区域</p><h2 id="快照区和缓冲区的作用"><a href="#快照区和缓冲区的作用" class="headerlink" title="快照区和缓冲区的作用"></a>快照区和缓冲区的作用</h2><p>比较缓冲区和快照区的数据,一致则不更新数据库,不一致则更新数据库</p><h3 id="代码运行过程"><a href="#代码运行过程" class="headerlink" title="代码运行过程"></a>代码运行过程</h3><p><img src="/images/20190707005.png" alt></p><h4 id="eclipse观察缓存区和快照区的变化"><a href="#eclipse观察缓存区和快照区的变化" class="headerlink" title="eclipse观察缓存区和快照区的变化"></a>eclipse观察缓存区和快照区的变化</h4><ul><li>取出数据后,快照区和缓冲区的变化<br><img src="/images/20190707007.png" alt><br><img src="/images/20190707009.png" alt></li><li>修改数据后,快照区和缓冲区的变化<br><img src="/images/20190707010.png" alt><br><img src="/images/20190707011.png" alt><h3 id="过程说明"><a href="#过程说明" class="headerlink" title="过程说明"></a>过程说明</h3>再来解剖一下<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//一级缓存的快照区</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.openSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">Customer customer = session.get(Customer.class, <span class="number">6L</span>);</span><br><span class="line">customer.setCust_name(<span class="string">"关羽"</span>);</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>1）将数据从DB中取出来<br>2）将数据转变成对象，并存入堆内存中<br>3）将对象的id放入session缓存map的key中，将对象的引用放入session缓存map的 value中，这就纳入session管理了<br>4）将对象的详情放入到“快照”中<br>5) 当执行了<code>tx.commit();</code>时，Hibernate为了保证数据的一致性，Hibernate会清理session的一级缓存（flush），此时会将堆内存中的数据（已经纳入session管理的数据）与快照中的数据进行对比<br>6) 如果不一致，则会执行同步（update）操作，若相同，则不执行update</p><h1 id="Hibernate的二级缓存"><a href="#Hibernate的二级缓存" class="headerlink" title="Hibernate的二级缓存"></a>Hibernate的二级缓存</h1><p>Hibernate的二级缓存是SessionFactory级别的缓存,需要配置的,但是企业级中一般不开启,更多的是通过redis来替代二级缓存</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hibernate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hibernate的API</title>
      <link href="/2019/07/04/Hibernate%E7%9A%84API/"/>
      <url>/2019/07/04/Hibernate%E7%9A%84API/</url>
      
        <content type="html"><![CDATA[<h1 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h1><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>用以加载核心配置文件</p><h2 id="加载方式"><a href="#加载方式" class="headerlink" title="加载方式"></a>加载方式</h2><h4 id="方式一-文件名是hibernate-properties-了解居多"><a href="#方式一-文件名是hibernate-properties-了解居多" class="headerlink" title="方式一:文件名是hibernate.properties(了解居多)"></a>方式一:文件名是<code>hibernate.properties</code>(了解居多)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Configuration cfg = <span class="keyword">new</span> Configuration();</span><br></pre></td></tr></table></figure><h4 id="方式二-文件名是hibernate-cfg-xml"><a href="#方式二-文件名是hibernate-cfg-xml" class="headerlink" title="方式二:文件名是hibernate.cfg.xml"></a>方式二:文件名是<code>hibernate.cfg.xml</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Configuration cfg = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果不是默认的文件名,还需要如下语句</span></span><br><span class="line"><span class="comment">//cfg.addResource("com/zjinc36/hibernate/Customer.hbm.xml")</span></span><br></pre></td></tr></table></figure><h1 id="SessionFactory"><a href="#SessionFactory" class="headerlink" title="SessionFactory"></a>SessionFactory</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>SessionFactory内部维护了Hibernate的连接池和Hibernate的二级缓存(不讲)<br>是线程安全的对象<br>一个项目创建一个对象即可<br><a href="https://blog.csdn.net/fan71900/article/details/45890915" target="_blank" rel="noopener">参考:https://blog.csdn.net/fan71900/article/details/45890915</a></p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ol><li>引入jar包,将<code>hibernate-release-5.4.3.Final/lib/optional/c3p0</code>下的所有jar包导入项目中</li><li>在核心配置文件中添加如下选项<br><em>参考<a href="https://www.cnblogs.com/caoyc/p/5607051.html" target="_blank" rel="noopener">https://www.cnblogs.com/caoyc/p/5607051.html</a></em><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 数据库连接池的使用 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 选择使用C3P0连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.provider_class"</span>&gt;</span>org.hibernate.c3p0.internal.C3P0ConnectionProvider<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 连接池中最小连接数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.c3p0.min_size"</span>&gt;</span>5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 连接池中最大连接数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.c3p0.max_size"</span>&gt;</span>20<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 设定数据库连接超时时间，以秒为单位。如果连接池中某个数据库连接处于空闲状态且超过timeout秒时，就会从连接池中移除--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.c3p0.timeout"</span>&gt;</span>120<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 设置数据库 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.c3p0.idle_test_period"</span>&gt;</span>3000<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="抽取工具类"><a href="#抽取工具类" class="headerlink" title="抽取工具类"></a>抽取工具类</h2><p>目的是为了保证一个项目只创建一个SessionFactory对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hiberante的工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateUtils</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Configuration cfg;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> SessionFactory sf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">cfg = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">sf = cfg.buildSessionFactory();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">openSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> sf.openSession();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p>Session代表的是Hibernate与数据库的连接对象,即与数据库交互桥梁<br>不是线程安全</p><h2 id="Session中的API"><a href="#Session中的API" class="headerlink" title="Session中的API"></a>Session中的API</h2><h3 id="保存操作"><a href="#保存操作" class="headerlink" title="保存操作"></a>保存操作</h3><ul><li>Serializable save(Object obj)`<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//测试save保存</span></span><br><span class="line"><span class="comment">//返回id</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.openSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">customer.setCust_name(<span class="string">"lisi"</span>);</span><br><span class="line">Serializable id = session.save(customer);</span><br><span class="line">System.out.println(id);</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h3><p><strong>注意get和load方法的区别(代码中的注释)</strong></p><ul><li>T get(Class c,Serializable id);<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 测试get查询方法</span></span><br><span class="line"><span class="comment">// 采用的是立即加载,执行到get的时候,就会马上发送SQL语句去查询</span></span><br><span class="line"><span class="comment">// 查询后返回的是真实对象</span></span><br><span class="line"><span class="comment">// 查询一个找不到的对象的时候,返回null</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.openSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">Customer customer = session.get(Customer.class, <span class="number">1L</span>);</span><br><span class="line">System.out.println(customer);</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><ul><li>T load(Class, c,Serializable id);<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 测试load查询方法</span></span><br><span class="line"><span class="comment">// 采用的是延迟加载(lazy懒加载),执行到这行代码的时候,不会发送SQL语句,当真正使用这个对象的时候才会发送SQL语句</span></span><br><span class="line"><span class="comment">// 查询后返回的是代理对象,利用`javassist-3.24.0-GA.jar`技术来产生代理</span></span><br><span class="line"><span class="comment">// 查询一个找不到的对象的时候,返回ObjectNotFoundException</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.openSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">Customer customer = session.load(Customer.class, <span class="number">6L</span>);</span><br><span class="line">System.out.println(customer);</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="更新操作"><a href="#更新操作" class="headerlink" title="更新操作"></a>更新操作</h3><ul><li>void update(Object obj);<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 更新操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.openSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不推荐</span></span><br><span class="line"><span class="comment">// 直接创建对象,进行修改</span></span><br><span class="line"><span class="comment">//Customer customer = new Customer();</span></span><br><span class="line"><span class="comment">//customer.setCust_id(1L);</span></span><br><span class="line"><span class="comment">//customer.setCust_name("wangwu");</span></span><br><span class="line"><span class="comment">//session.update(customer);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 推荐</span></span><br><span class="line"><span class="comment">// 先查询,再修改</span></span><br><span class="line">Customer customer = session.get(Customer.class, <span class="number">6L</span>);</span><br><span class="line">customer.setCust_name(<span class="string">"wangwu"</span>);</span><br><span class="line">session.update(customer);</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h3><ul><li>void delete(Object obj);<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 删除操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.openSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不推荐</span></span><br><span class="line"><span class="comment">// 直接创建对象,进行删除</span></span><br><span class="line"><span class="comment">//Customer customer = new Customer();</span></span><br><span class="line"><span class="comment">//customer.setCust_id(1L);</span></span><br><span class="line"><span class="comment">//session.delete(customer);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 推荐</span></span><br><span class="line"><span class="comment">// 先查询,再修改</span></span><br><span class="line"><span class="comment">// 级联删除</span></span><br><span class="line">Customer customer = session.get(Customer.class, <span class="number">6L</span>);</span><br><span class="line">session.delete(customer);</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="保存或更新操作"><a href="#保存或更新操作" class="headerlink" title="保存或更新操作"></a>保存或更新操作</h3><ul><li>void saveOrUpdate(Object obj);<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存或更新</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrUpdateDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.openSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line">Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">customer.setCust_id(<span class="number">10L</span>);</span><br><span class="line">customer.setCust_name(<span class="string">"abc"</span>);</span><br><span class="line">session.saveOrUpdate(customer);</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="查询所有操作"><a href="#查询所有操作" class="headerlink" title="查询所有操作"></a>查询所有操作</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAllDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.openSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收HQL:Hibernate Query Language 面向对象的查询语句</span></span><br><span class="line"><span class="comment">//Query&lt;Customer&gt; query = session.createQuery("from Customer");</span></span><br><span class="line"><span class="comment">//List&lt;Customer&gt; list = query.list();</span></span><br><span class="line"><span class="comment">//for (Customer customer : list) &#123;</span></span><br><span class="line"><span class="comment">//System.out.println(customer);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接受SQL</span></span><br><span class="line">SQLQuery&lt;Object[]&gt; query = session.createSQLQuery(<span class="string">"select * from cst_customer"</span>);</span><br><span class="line">List&lt;Object[]&gt; list = query.list();</span><br><span class="line"><span class="keyword">for</span> (Object[] objects : list) &#123;</span><br><span class="line">System.out.println(Arrays.toString(objects));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h1><p>事务对象,详见本博客的其他文章<a href="/2019/07/08/Hibernate事务管理/">Hibernate事务管理</a></p><ul><li>commit()</li><li>roallback()</li></ul><h1 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h1><p><strong><em>具体查看本博客的:<a href="/2019/07/09/Hibernate的查询方式">Hibernate的查询方式</a></em></strong></p><h2 id="HQL"><a href="#HQL" class="headerlink" title="HQL"></a>HQL</h2><p><code>Hibernate Query Language</code>,Hibernate查询语言,这种语言和SQL极其类似,面向对象的查询语句</p><h3 id="简单的查询"><a href="#简单的查询" class="headerlink" title="简单的查询"></a>简单的查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单的查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过session获得Query接口</span></span><br><span class="line"><span class="comment">// 注意这里的Customer指的是类</span></span><br><span class="line"><span class="comment">// 查询语句</span></span><br><span class="line">String hql = <span class="string">"from Customer where cust_name like ?0"</span>;</span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line"><span class="comment">// 设置条件(如果查询语句不需要条件,该句可省略)</span></span><br><span class="line">query.setParameter(<span class="number">0</span>, <span class="string">"zhang%"</span>);</span><br><span class="line">List&lt;Customer&gt; list = query.getResultList();</span><br><span class="line"><span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分页查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过session获得Query接口</span></span><br><span class="line"><span class="comment">// 注意这里的Customer指的是类</span></span><br><span class="line"><span class="comment">// 查询语句</span></span><br><span class="line">String hql = <span class="string">"from Customer"</span>;</span><br><span class="line">Query query = session.createQuery(hql);</span><br><span class="line"><span class="comment">// 设置分页</span></span><br><span class="line">query.setFirstResult(<span class="number">0</span>);</span><br><span class="line">query.setMaxResults(<span class="number">3</span>);</span><br><span class="line">List&lt;Customer&gt; list = query.getResultList();</span><br><span class="line"><span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">System.out.println(customer);</span><br><span class="line">&#125;</span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="QBC"><a href="#QBC" class="headerlink" title="QBC"></a>QBC</h2><p>QBC -&gt; Query by Criteria,更加面向对象的一种查询方式</p><h3 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Criteria</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写具体逻辑crud(增删改查)操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1创建Criteria对象 createCriteria()在hibernate5.2之后过时了</span></span><br><span class="line"><span class="comment">//Criteria criteria = session.createCriteria(Customer.class);</span></span><br><span class="line"><span class="comment">//List&lt;Customer&gt; list = criteria.list();</span></span><br><span class="line"><span class="comment">//for (Student customer : list) &#123;</span></span><br><span class="line"><span class="comment">//System.out.println(customer);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 新的查询方式</span></span><br><span class="line"><span class="comment">// 1.创建CriteriaBuilder对象</span></span><br><span class="line"><span class="comment">// 注意导入的包是import javax.persistence.criteria.CriteriaQuery;</span></span><br><span class="line">CriteriaBuilder criteriaBuilder = session.getCriteriaBuilder();</span><br><span class="line"><span class="comment">// 2.获取CriteriaQuery对象</span></span><br><span class="line">CriteriaQuery&lt;Customer&gt; createQuery = criteriaBuilder.createQuery(Customer.class);</span><br><span class="line"><span class="comment">// 3.指定根条件</span></span><br><span class="line">createQuery.from(Customer.class);</span><br><span class="line"><span class="comment">// 4执行查询</span></span><br><span class="line">List&lt;Customer&gt; List = session.createQuery(createQuery).getResultList();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Customer customer : List) &#123;</span><br><span class="line">System.err.println(customer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *模糊查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo4</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//获取session对象</span></span><br><span class="line">Session session = HibernateUtils.getCurrentSession();</span><br><span class="line"><span class="comment">//开启事务</span></span><br><span class="line">Transaction tx = session.beginTransaction();</span><br><span class="line"></span><br><span class="line"><span class="comment">//写具体逻辑crud(增删改查)操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment">////创建Criteria对象 createCriteria()在hibernate5.2之后过时了</span></span><br><span class="line"><span class="comment">//Criteria criteria = session.createCriteria(Customer.class);</span></span><br><span class="line"><span class="comment">//criteria.add(Restrictions.like("cust_name", "zhang%"));</span></span><br><span class="line"><span class="comment">//List&lt;Customer&gt; list = criteria.list();</span></span><br><span class="line"><span class="comment">//for (Student customer : list) &#123;</span></span><br><span class="line"><span class="comment">//System.out.println(customer);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//新的查询方式</span></span><br><span class="line"><span class="comment">//1.创建CriteriaBuilder对象</span></span><br><span class="line"><span class="comment">//注意导入的包是import javax.persistence.criteria.CriteriaQuery;</span></span><br><span class="line">CriteriaBuilder criteriaBuilder = session.getCriteriaBuilder();</span><br><span class="line"><span class="comment">//2.获取CriteriaQuery对象</span></span><br><span class="line">CriteriaQuery&lt;Customer&gt; createQuery = criteriaBuilder.createQuery(Customer.class);</span><br><span class="line"><span class="comment">//3.指定根条件</span></span><br><span class="line">Root&lt;Customer&gt; root = createQuery.from(Customer.class);</span><br><span class="line"><span class="comment">//root.get("name") "name"是实体类的属性名称</span></span><br><span class="line">createQuery.where(criteriaBuilder.like(root.get(<span class="string">"cust_name"</span>), <span class="string">"%zhang%"</span>));</span><br><span class="line"><span class="comment">//4.执行查询</span></span><br><span class="line">List&lt;Customer&gt; List = session.createQuery(createQuery).getResultList();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Customer customer : List) &#123;</span><br><span class="line">System.err.println(customer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//提交事务</span></span><br><span class="line">tx.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SQLQuery"><a href="#SQLQuery" class="headerlink" title="SQLQuery"></a>SQLQuery</h2><p>用于接收SQL,特别复杂情况下使用SQL</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hibernate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu安装文本工具notepadqq</title>
      <link href="/2019/07/04/Ubuntu%E5%AE%89%E8%A3%85%E6%96%87%E6%9C%AC%E5%B7%A5%E5%85%B7notepadqq/"/>
      <url>/2019/07/04/Ubuntu%E5%AE%89%E8%A3%85%E6%96%87%E6%9C%AC%E5%B7%A5%E5%85%B7notepadqq/</url>
      
        <content type="html"><![CDATA[<h2 id="安装notepadqq"><a href="#安装notepadqq" class="headerlink" title="安装notepadqq"></a>安装notepadqq</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>Windows 上的 Notepad++，开发者们已经将它移植到 Linux，名为 Notepadqq<br>它是一个简单而强大的文本编辑器，你可以在日常使用它，或用于各种语言进行编程</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository ppa:notpadqq-team/notepadqq</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install notepadqq</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu安装剪切板管理工具copyq</title>
      <link href="/2019/07/04/Ubuntu%E5%AE%89%E8%A3%85%E5%89%AA%E5%88%87%E6%9D%BF%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7copyq/"/>
      <url>/2019/07/04/Ubuntu%E5%AE%89%E8%A3%85%E5%89%AA%E5%88%87%E6%9D%BF%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7copyq/</url>
      
        <content type="html"><![CDATA[<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>CopyQ 是一个简单但是非常有用的剪贴板管理器，它保存你的系统剪贴板内容，无论你做了什么改变，你都可以在你需要的时候搜索和恢复它。它是一个很棒的工具，支持文本、图像、HTML 和其它格式。<br>CopyQ 自身有很多功能像拖放、复制/拷贝、编辑、移除、排序、创建等。它同样支持集成文本编辑器，如 Vim，所以如果你是程序员，这非常有用。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository ppa:hluk/copyq</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install copyq</span><br></pre></td></tr></table></figure><h2 id="个人习惯配置"><a href="#个人习惯配置" class="headerlink" title="个人习惯配置"></a>个人习惯配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+   打开首选项</span><br><span class="line">+   常规 -&gt; 将`用鼠标选择存储文本`打勾</span><br><span class="line">+   常规 -&gt; 将`run automatic commands on selection`去除</span><br><span class="line">+   快捷键 -&gt; 显示/隐藏主窗口 -&gt; 增加快捷键`ctrl+shift+v`</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eclipse中导入dtd和xsd使得xml文件能自动提示</title>
      <link href="/2019/07/03/eclipse%E4%B8%AD%E5%AF%BC%E5%85%A5dtd%E5%92%8Cxsd%E4%BD%BF%E5%BE%97xml%E6%96%87%E4%BB%B6%E8%83%BD%E8%87%AA%E5%8A%A8%E6%8F%90%E7%A4%BA/"/>
      <url>/2019/07/03/eclipse%E4%B8%AD%E5%AF%BC%E5%85%A5dtd%E5%92%8Cxsd%E4%BD%BF%E5%BE%97xml%E6%96%87%E4%BB%B6%E8%83%BD%E8%87%AA%E5%8A%A8%E6%8F%90%E7%A4%BA/</url>
      
        <content type="html"><![CDATA[<h2 id="DTD-类型约束文件"><a href="#DTD-类型约束文件" class="headerlink" title="DTD 类型约束文件"></a>DTD 类型约束文件</h2><ol><li>Window-&gt;Preferences-&gt;XML-&gt;XML Catalog-&gt;User Specified Entries窗口中,选择Add 按纽</li><li>在Add XML Catalog Entry 对话框中选择或输入以下内容<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Location: /home/zjc/文档/Jar/hibernate-release-5.4.3.Final/project/hibernate-core/src/main/resources/org/hibernate/hibernate-mapping-3.0.dtd</span><br><span class="line">Key Type: URI</span><br><span class="line">KEY: http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd</span><br></pre></td></tr></table></figure></li></ol><h2 id="XSD-类型约束文件"><a href="#XSD-类型约束文件" class="headerlink" title="XSD 类型约束文件"></a>XSD 类型约束文件</h2><ol><li>Window-&gt;Preferences-&gt;XML-&gt;XML Catalog-&gt;User Specified Entries窗口中,选择Add 按纽</li><li>在Add XML Catalog Entry 对话框中选择或输入以下内容<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Location: you/address/spring-beans-2.5.xsd</span><br><span class="line">Key Type: Schema Location</span><br><span class="line">KEY: http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Eclipse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu安装数据库可视化工具dbeaver</title>
      <link href="/2019/07/03/Ubuntu%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7dbeaver/"/>
      <url>/2019/07/03/Ubuntu%E5%AE%89%E8%A3%85%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7dbeaver/</url>
      
        <content type="html"><![CDATA[<h2 id="dbeaver是什么"><a href="#dbeaver是什么" class="headerlink" title="dbeaver是什么"></a>dbeaver是什么</h2><p>dbeaver,一款基于java的数据库可视化工具</p><h2 id="平台支持"><a href="#平台支持" class="headerlink" title="平台支持"></a>平台支持</h2><p>全平台支持</p><h2 id="安装前提"><a href="#安装前提" class="headerlink" title="安装前提"></a>安装前提</h2><p>需要java环境</p><h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><ol><li>去官网下载对应平台的包<code>https://dbeaver.io/download/</code>,这里使用的是Ubuntu环境,所以下载的是deb包</li><li><code>sudo dpkg -i dbeaver-ce_6.1.1_amd64.deb</code></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hibernate入门与配置</title>
      <link href="/2019/07/02/Hibernate%E5%85%A5%E9%97%A8%E4%B8%8E%E9%85%8D%E7%BD%AE/"/>
      <url>/2019/07/02/Hibernate%E5%85%A5%E9%97%A8%E4%B8%8E%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="Hibernate在项目中的位置"><a href="#Hibernate在项目中的位置" class="headerlink" title="Hibernate在项目中的位置"></a>Hibernate在项目中的位置</h1><p>EE的三层结构</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">客户端层 -&gt; JavaApplet/Html/CSS/JS</span><br><span class="line">    |</span><br><span class="line">    |</span><br><span class="line">  Web层 -&gt; Servlet/JSP -&gt; Structs2/Springmvc</span><br><span class="line">    |</span><br><span class="line">    |</span><br><span class="line">业务逻辑层 -&gt; JavaBean -&gt; Spring</span><br><span class="line">    |</span><br><span class="line">    |</span><br><span class="line">  持久层 -&gt; JDBC -&gt; Hibernate/Mybatis</span><br><span class="line">    |</span><br><span class="line">    |</span><br><span class="line">  数据库</span><br></pre></td></tr></table></figure><p>Servlet+JSP+JavaBean+JDBC使用这套架构可以开发市面上所有应用,但是企业中不会使用(过于底层)<br>企业开发一般使用SSH(Struts+Spring+Hibernate),SSM(SpringMVC+Spring+Mybatis)</p><h1 id="Hibernate的入门案例"><a href="#Hibernate的入门案例" class="headerlink" title="Hibernate的入门案例"></a>Hibernate的入门案例</h1><h2 id="下载Hibernate和log4j"><a href="#下载Hibernate和log4j" class="headerlink" title="下载Hibernate和log4j"></a>下载Hibernate和log4j</h2><p><a href="https://hibernate.org/orm/" target="_blank" rel="noopener">hibernate:https://hibernate.org/orm/</a><br><a href="https://logging.apache.org/log4j/1.2/download.html" target="_blank" rel="noopener">log4j:https://logging.apache.org/log4j/1.2/download.html</a></p><h2 id="创建一个项目导入jar包"><a href="#创建一个项目导入jar包" class="headerlink" title="创建一个项目导入jar包"></a>创建一个项目导入jar包</h2><h3 id="核心包"><a href="#核心包" class="headerlink" title="核心包"></a>核心包</h3><p>将<code>hibernate-release-5.4.3.Final/lib/required</code>中的所有文件复制到<code>eclipse</code></p><h3 id="日志包"><a href="#日志包" class="headerlink" title="日志包"></a>日志包</h3><p>将<code>log4j-1.2-api-2.12.0.jar</code>和<code>log4j-to-slf4j-2.12.0.jar</code>复制到<code>eclipse</code>,用来打印日志</p><p>具体参考<a href="https://elfasd.iteye.com/blog/1770847" target="_blank" rel="noopener">https://elfasd.iteye.com/blog/1770847</a></p><h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="string">`cst_customer`</span> (</span><br><span class="line">    <span class="string">`cust_id`</span> <span class="built_in">BIGINT</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'客户编号(主键)'</span>,</span><br><span class="line">    <span class="string">`cust_name`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户名称(公司名称)'</span>,</span><br><span class="line">    <span class="string">`cust_source`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户信息来源'</span>,</span><br><span class="line">    <span class="string">`cust_industry`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户所属行业'</span>,</span><br><span class="line">    <span class="string">`cust_level`</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'客户级别'</span>,</span><br><span class="line">    <span class="string">`cust_phone`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'固定电话'</span>,</span><br><span class="line">    <span class="string">`cust_mobile`</span> <span class="built_in">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'移动电话'</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span>(<span class="string">`cust_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br></pre></td></tr></table></figure><h2 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.hibernate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户管理的实体类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Long cust_id;</span><br><span class="line"><span class="keyword">private</span> String cust_name;</span><br><span class="line"><span class="keyword">private</span> String cust_source;</span><br><span class="line"><span class="keyword">private</span> String cust_industry;</span><br><span class="line"><span class="keyword">private</span> String cust_level;</span><br><span class="line"><span class="keyword">private</span> String cust_phone;</span><br><span class="line"><span class="keyword">private</span> String cust_mobile;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getCust_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_id</span><span class="params">(Long cust_id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_id = cust_id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_name</span><span class="params">(String cust_name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_name = cust_name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_source</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_source;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_source</span><span class="params">(String cust_source)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_source = cust_source;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_industry</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_industry;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_industry</span><span class="params">(String cust_industry)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_industry = cust_industry;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_level</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_level;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_level</span><span class="params">(String cust_level)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_level = cust_level;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_phone</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_phone;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_phone</span><span class="params">(String cust_phone)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_phone = cust_phone;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getCust_mobile</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> cust_mobile;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_mobile</span><span class="params">(String cust_mobile)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.cust_mobile = cust_mobile;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="创建映射"><a href="#创建映射" class="headerlink" title="创建映射"></a>创建映射</h2><p>映射需要通过xml的配置文件完成,这个配置文件可以任意命名,但要尽量做到统一的命名规范,比如<code>类名.hbm.xml</code>这样,文件和对应类放在同一层级目录</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 创建Customer.hbm.xml文件,在和类相同的目录下 --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 根标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类与表的映射 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类名,table对应表名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.zjinc36.hibernate.Customer"</span> <span class="attr">table</span>=<span class="string">"cst_customer"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的属性和表中的主键对应 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- name对应类中的属性,column对应表中的字段 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cust_id"</span> <span class="attr">column</span>=<span class="string">"cust_id"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 建立类中的普通的属性和表的字段的对应 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_name"</span> <span class="attr">column</span>=<span class="string">"cust_name"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_source"</span> <span class="attr">column</span>=<span class="string">"cust_source"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_industry"</span> <span class="attr">column</span>=<span class="string">"cust_industry"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_level"</span> <span class="attr">column</span>=<span class="string">"cust_level"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_phone"</span> <span class="attr">column</span>=<span class="string">"cust_phone"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_mobile"</span> <span class="attr">column</span>=<span class="string">"cust_mobile"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="创建一个Hibernate的核心文件"><a href="#创建一个Hibernate的核心文件" class="headerlink" title="创建一个Hibernate的核心文件"></a>创建一个Hibernate的核心文件</h2><p>Hibernate的核心文件<code>hibernate.cfg.xml</code>,用以设置数据库,设置映射文件等,放在src根目录下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 连接数据库的基本参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/hibernate<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置Hibernate的方言 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是否显示sql   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是否格式化sql --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 是否使用注释  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.use_sql_comments"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 映射规则文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/zjinc36/hibernate/Customer.hbm.xml"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="使用Hiberante向表中插入数据"><a href="#使用Hiberante向表中插入数据" class="headerlink" title="使用Hiberante向表中插入数据"></a>使用Hiberante向表中插入数据</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.hibernate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Hibernate入门案例</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateDemo1</span> </span>&#123;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 保存客户的案例</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1. 加载Hibernate的核心配置文件</span></span><br><span class="line"><span class="comment">// 其实就是加载一个常量DEFAULT_CFG_RESOURCE_NAME=hibernate.cfg.xml</span></span><br><span class="line"><span class="comment">// 这也就是为什么Hibernate的核心配置文件命名为hibernate.cfg.xml的原因</span></span><br><span class="line"><span class="comment">// 同时也是为什么我们说这个配置文件的名字可以改,但我们一般不改的原因</span></span><br><span class="line">Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line"><span class="comment">// 2. 创建一个SessionFactory对象,类似于JDBC连接池</span></span><br><span class="line">SessionFactory sessionFactory = configuration.buildSessionFactory();</span><br><span class="line"><span class="comment">// 3. 通过SessionFactory获取到Session对象Connection</span></span><br><span class="line">Session session = sessionFactory.openSession();</span><br><span class="line"><span class="comment">// 4. 手动开启事务</span></span><br><span class="line">Transaction transaction = session.beginTransaction();</span><br><span class="line"><span class="comment">// 5. 编写代码</span></span><br><span class="line">Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">customer.setCust_name(<span class="string">"zhangsan"</span>);</span><br><span class="line">session.save(customer);</span><br><span class="line"><span class="comment">// 6. 提交事务</span></span><br><span class="line">transaction.commit();</span><br><span class="line"><span class="comment">// 7. 释放资源</span></span><br><span class="line">session.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="在Eclipse中导入dtd和xsd文件，使XML自动提示"><a href="#在Eclipse中导入dtd和xsd文件，使XML自动提示" class="headerlink" title="在Eclipse中导入dtd和xsd文件，使XML自动提示"></a>在Eclipse中导入dtd和xsd文件，使XML自动提示</h1><h2 id="DTD-类型约束文件"><a href="#DTD-类型约束文件" class="headerlink" title="DTD 类型约束文件"></a>DTD 类型约束文件</h2><ol><li>Window-&gt;Preferences-&gt;XML-&gt;XML Catalog-&gt;User Specified Entries窗口中,选择Add 按纽</li><li>在Add XML Catalog Entry 对话框中选择或输入以下内容<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Location: /home/zjc/文档/Jar/hibernate-release-5.4.3.Final/project/hibernate-core/src/main/resources/org/hibernate/hibernate-mapping-3.0.dtd</span><br><span class="line">Key Type: URI</span><br><span class="line">KEY: http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd</span><br></pre></td></tr></table></figure></li></ol><h2 id="XSD-类型约束文件"><a href="#XSD-类型约束文件" class="headerlink" title="XSD 类型约束文件"></a>XSD 类型约束文件</h2><ol><li>Window-&gt;Preferences-&gt;XML-&gt;XML Catalog-&gt;User Specified Entries窗口中,选择Add 按纽</li><li>在Add XML Catalog Entry 对话框中选择或输入以下内容<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Location: you/address/spring-beans-2.5.xsd</span><br><span class="line">Key Type: Schema Location</span><br><span class="line">KEY: http://www.springframework.org/schema/beans/spring-beans-2.5.xsd</span><br></pre></td></tr></table></figure></li></ol><h1 id="Hibernate的映射的配置"><a href="#Hibernate的映射的配置" class="headerlink" title="Hibernate的映射的配置"></a>Hibernate的映射的配置</h1><h2 id="class标签"><a href="#class标签" class="headerlink" title="class标签"></a>class标签</h2><p>用来建立类与表的映射关系</p><ul><li>name:类的全路径</li><li>table:表名(类名与表名一致,那么table可以省略)</li><li>catalog:数据库名<h2 id="id标签"><a href="#id标签" class="headerlink" title="id标签"></a>id标签</h2>用来建立类中的属性与表中的主键的对应关系</li><li>name:类中的属性名</li><li>column:表中的字段名(类中的属性名和表中的字段名一致,那么column可以省略)</li><li>length:长度</li><li>type:类型(有三种方式,分别是java写法,hibernate写法,sql写法)<h2 id="property标签的配置"><a href="#property标签的配置" class="headerlink" title="property标签的配置"></a>property标签的配置</h2></li><li>name:类中的属性名</li><li>column:表中的字段名</li><li>length:长度</li><li>type:类型</li><li>not-null:设置非空</li><li>unique:设置唯一</li></ul><h1 id="Hibernate的核心配置"><a href="#Hibernate的核心配置" class="headerlink" title="Hibernate的核心配置"></a>Hibernate的核心配置</h1><p>有两种配置方式</p><ul><li>属性文件的方式(了解,可以跳过)<blockquote><p>  hibernate.properties文件</p><ul><li>hibernate.connection.driver_class=com.mysql.jdbc.Driver</li><li>hibernate.show_sql=true<br>属性文件的方式不能引入映射文件(需要手动编写代码加载映射文件,所以这种方法不常用)</li></ul></blockquote></li><li>XML文件的方式<blockquote><p>  hibernate.cfg.xml</p></blockquote><h2 id="xml配置方式详解"><a href="#xml配置方式详解" class="headerlink" title="xml配置方式详解"></a>xml配置方式详解</h2><h3 id="连接数据库的基本参数"><a href="#连接数据库的基本参数" class="headerlink" title="连接数据库的基本参数"></a>连接数据库的基本参数</h3></li><li>驱动类</li><li>url路径</li><li>用户名</li><li>密码<h3 id="方言"><a href="#方言" class="headerlink" title="方言"></a>方言</h3></li></ul><h2 id="可选的配置"><a href="#可选的配置" class="headerlink" title="可选的配置"></a>可选的配置</h2><h3 id="显示SQL"><a href="#显示SQL" class="headerlink" title="显示SQL"></a>显示SQL</h3><blockquote><p>  显示SQL:<code>hibernate.show_sql</code></p></blockquote><h3 id="格式化SQL"><a href="#格式化SQL" class="headerlink" title="格式化SQL"></a>格式化SQL</h3><blockquote><p>  格式化SQL:<code>hibernate.format_sql</code></p></blockquote><h3 id="自动建表"><a href="#自动建表" class="headerlink" title="自动建表"></a>自动建表</h3><h4 id="自动建表-1"><a href="#自动建表-1" class="headerlink" title="自动建表"></a>自动建表</h4><blockquote><p>  自动建表:<code>&lt;property name=&quot;hibernate.hbm2ddl.auto&quot;&gt;update&lt;/property&gt;</code></p><ul><li>none:不使用hibernate的自动建表</li><li>create:如果数据库中已经有表,删除原有表,重新创建,如果没有表,新建表(测试常用)</li><li>create-drop:如果数据库中已经有表,删除原有表,执行奥做,删除这个表.如果没有表,新建一个,使用完了删除该表(测试常用)</li><li>update:如果数据库中有表,使用原有表.如果没有表,创建新表(更新表结构)</li><li>validate:如果没有表,不会创建表,只会使用数据库中原有的表(校验映射和表结构)</li></ul></blockquote><h4 id="问题-表可以删除-却无法自动创建"><a href="#问题-表可以删除-却无法自动创建" class="headerlink" title="问题:表可以删除,却无法自动创建"></a>问题:表可以删除,却无法自动创建</h4><blockquote><p>  <a href="https://blog.csdn.net/weixin_40327259/article/details/80803754" target="_blank" rel="noopener"><em>参考:https://blog.csdn.net/weixin_40327259/article/details/80803754</em></a></p></blockquote><p><strong>原因</strong><br>hibernate里的dialect和Mysql的版本不匹配,SQL语句,在MySQL5.0之前是设置表类型type=”…”，5.0之后是使用engine=”…”设置表类型</p><p><strong>解决</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MySql5.0之前的配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- MySql5.0之后的配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dialect"</span>&gt;</span>org.hibernate.dialect.MySQL5Dialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="映射文件引入"><a href="#映射文件引入" class="headerlink" title="映射文件引入"></a>映射文件引入</h2><blockquote><p> 引入映射文件的位置<code>&lt;mapping resource=&quot;com/zjinc36/hibernate/Customer.hbm.xml&quot; /&gt;</code></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hibernate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSP和EL和JSTL</title>
      <link href="/2019/06/29/JSP%E5%92%8CEL%E5%92%8CJSTL/"/>
      <url>/2019/06/29/JSP%E5%92%8CEL%E5%92%8CJSTL/</url>
      
        <content type="html"><![CDATA[<h1 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h1><h2 id="什么是JSP"><a href="#什么是JSP" class="headerlink" title="什么是JSP"></a>什么是JSP</h2><p><code>Java Server Page</code>的缩写<br>从用户角度看待,就是一个网页<br>从程序员角度看待,其实是一个java类,它继承了Servlet,所以可以直接说jsp就是一个Servlet</p><h2 id="为什么会有JSP"><a href="#为什么会有JSP" class="headerlink" title="为什么会有JSP"></a>为什么会有JSP</h2><p>html多数情况下用来显示静态内容,一成不变的.但是有时候我们需要在网页上显示一些动态数据<br>比如:查询所有的学生信息,根据姓名去查询某个学生.<br>这些动作都需要去查询数据库,然后在网页上显示<br>html不支持写java代码,jsp里面可以写java代码</p><h2 id="怎么用JSP"><a href="#怎么用JSP" class="headerlink" title="怎么用JSP"></a>怎么用JSP</h2><h3 id="指令的写法"><a href="#指令的写法" class="headerlink" title="指令的写法"></a>指令的写法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ 指令名字 %&gt;</span><br></pre></td></tr></table></figure><h3 id="指令详解"><a href="#指令详解" class="headerlink" title="指令详解"></a>指令详解</h3><h4 id="page指令"><a href="#page指令" class="headerlink" title="page指令"></a>page指令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</span><br></pre></td></tr></table></figure><ul><li>language:表明jsp页面中可以写java代码</li><li>contentType:告诉浏览器我是什么内容类型,以及使用什么编码</li><li>pageEncoding:jsp内容编码</li><li>extends:用于指定jsp翻译成java文件后,继承的父类是谁,一般不用改</li><li>import:导包使用,一般不用手写</li><li>session:值可选的有true或false,用于控制在这个jsp页面里面,能够直接使用session对象,具体的区别请看翻译后的java文件,如果该值是true,那么在代码里面会有getSession()的调用,如果是false,那么就不会有该方法调用,也就是没有session对象了,在页面也就自然不能使用了</li><li>errorPage:指的是错误的页面,当当前页面有错误的java代码时,自动跳转到错误页面</li><li>isErrorPage:上面的errorPage用于指定错误的时候跑到哪一个页面去,而这个isErrorPage,就是声明某一个页面到底是不是错误的页面</li></ul><h4 id="include指令"><a href="#include指令" class="headerlink" title="include指令"></a>include指令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ include file=&quot;other2.jsp&quot; %&gt;</span><br></pre></td></tr></table></figure><p>本质上就是把另外一个页面的所有内容拿过来一起输出,所有的标签元素都包含进来</p><h4 id="taglib指令"><a href="#taglib指令" class="headerlink" title="taglib指令"></a>taglib指令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=&quot;&quot; uri=&quot;&quot; %&gt;</span><br></pre></td></tr></table></figure><ul><li>uri:标签库路径</li><li>prefix:标签库的别名</li></ul><h2 id="JSP动作标签"><a href="#JSP动作标签" class="headerlink" title="JSP动作标签"></a>JSP动作标签</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;jsp:include page=&quot;&quot;&gt;&lt;/jsp:include&gt;</span><br><span class="line">&lt;jsp:param value=&quot;&quot; name=&quot;&quot; /&gt;</span><br><span class="line">&lt;jsp:forward page=&quot;&quot;&gt;&lt;/jsp:forward&gt;</span><br></pre></td></tr></table></figure><ul><li>jsp:include<blockquote><p>  包含指定页面,这里是动态包含,也就是不把包含的页面所有元素标签全部拿过来输出,而是把它运行结果拿过来</p></blockquote></li><li>jsp:forward<blockquote><p>  前往哪一个页面<br>  相当于<code>&lt;% request.getRequestDispatcher(&quot;other02.jsp&quot;).forward(request, response); %&gt;</code></p></blockquote></li><li>jsp:param<blockquote><p>  在包含某个页面的时候,或者在跳转某个页面的时候,带个参数</p></blockquote></li></ul><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">other01.jsp页面:</span><br><span class="line"></span><br><span class="line">&lt;jsp:forward page=<span class="string">"other02.jsp"</span>&gt;</span><br><span class="line">    &lt;jsp:param value=<span class="string">"beijing"</span> name=<span class="string">"address"</span> /&gt;</span><br><span class="line">&lt;/jsp:forward&gt;&gt;</span><br><span class="line"></span><br><span class="line">ohter02.jsp页面</span><br><span class="line">&lt;%= request.getParameter(<span class="string">"address"</span>) %&gt;</span><br></pre></td></tr></table></figure><h2 id="JSP内置对象"><a href="#JSP内置对象" class="headerlink" title="JSP内置对象"></a>JSP内置对象</h2><p>所谓内置对象,就是我们可以直接在jsp页面中使用这些对象,不用创建<br>内置对象如下</p><blockquote><p>  第一类:作用域对象</p><ul><li>pageContext</li><li>request</li><li>session</li><li>application</li></ul><hr><p>  第二类:不常用对象</p><ul><li>exception</li><li>page</li><li>config</li></ul><hr><p>  第三类:常用</p><ul><li>response</li><li>out</li></ul></blockquote><h3 id="第一类-作用域对象"><a href="#第一类-作用域对象" class="headerlink" title="第一类:作用域对象"></a>第一类:作用域对象</h3><h4 id="作用域定义"><a href="#作用域定义" class="headerlink" title="作用域定义"></a>作用域定义</h4><blockquote><p>  表示这个对象可以存值,它们的取值范围有限定</p></blockquote><h4 id="作用范围"><a href="#作用范围" class="headerlink" title="作用范围"></a>作用范围</h4><blockquote><ul><li>pageContext[PageContext]:作用于仅限于当前页面,能够存值的同时,还能获取到其他8个对象</li><li>request[HttpServletRequest]:作用于仅限于一次请求,只要服务器对该请求作出了响应,这个域中的值就没有了</li><li>session[HttpSession]:作用于仅限于一次会话(多次请求与响应)当中</li><li>application[ServletContext]:整个工程都可以访问,服务器关闭后就不能访问了</li></ul></blockquote><h4 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//写数据</span><br><span class="line">&lt;% pageContext.setAttribute(&quot;name&quot;, &quot;zhangsan&quot;) %&gt;</span><br><span class="line">&lt;% request.setAttribute(&quot;name&quot;, &quot;zhangsan&quot;) %&gt;</span><br><span class="line">&lt;% session.setAttribute(&quot;name&quot;, &quot;zhangsan&quot;) %&gt;</span><br><span class="line">&lt;% application.setAttribute(&quot;name&quot;, &quot;zhangsan&quot;) %&gt;</span><br><span class="line">//读数据</span><br><span class="line">&lt;%= pageContext.getAttribute(&quot;name&quot;) %&gt;</span><br><span class="line">&lt;%= request.getAttribute(&quot;name&quot;) %&gt;</span><br><span class="line">&lt;%= session.getAttribute(&quot;name&quot;) %&gt;</span><br><span class="line">&lt;%= application.getAttribute(&quot;name&quot;) %&gt;</span><br></pre></td></tr></table></figure><h3 id="第二类-不常用"><a href="#第二类-不常用" class="headerlink" title="第二类:不常用"></a>第二类:不常用</h3><blockquote><ul><li>exception =&gt; Throwable</li><li>page =&gt; Object =&gt; 就是jsp翻译成java类的实例对象,就是在类中的this关键字</li><li>config =&gt; ServletConfig</li></ul></blockquote><h3 id="第三类-常用"><a href="#第三类-常用" class="headerlink" title="第三类:常用"></a>第三类:常用</h3><blockquote><ul><li>response =&gt; HttpServletResponse</li><li>out =&gt; JspWriter</li></ul></blockquote><h4 id="两者区别"><a href="#两者区别" class="headerlink" title="两者区别"></a>两者区别</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;% out.write(&quot;这是使用out对象输出的内容&quot;) %&gt;</span><br><span class="line">&lt;% response.getWriter().write(&quot;这是使用response对象输出的内容&quot;) %&gt;</span><br><span class="line"></span><br><span class="line">//得到的结果</span><br><span class="line">这是使用response对象输出的内容</span><br><span class="line">这是使用out对象输出的内容</span><br><span class="line"></span><br><span class="line">//背后逻辑</span><br><span class="line">1.  碰到out对象输出,会先将out的内容刷新到response的缓冲中</span><br><span class="line">2.  而response.getWriter会直接输出内容</span><br><span class="line">3.  这样,即使out代码写在前面,response代码写在后面,也会先输出response要输出的内容</span><br></pre></td></tr></table></figure><h1 id="EL表达式"><a href="#EL表达式" class="headerlink" title="EL表达式"></a>EL表达式</h1><blockquote><p>  为了简化jsp代码,具体一点就是为了简化在jsp里面写的那些java代码<br>  主要用于取值工作</p></blockquote><h2 id="写法格式"><a href="#写法格式" class="headerlink" title="写法格式"></a>写法格式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$( 表达式 )</span><br></pre></td></tr></table></figure><h2 id="具体使用"><a href="#具体使用" class="headerlink" title="具体使用"></a>具体使用</h2><h3 id="取值方式"><a href="#取值方式" class="headerlink" title="取值方式"></a>取值方式</h3><p>如果是有下标的,使用<code>[]</code>的方式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">String[] a = &#123;&quot;aa&quot;, &quot;bb&quot;, &quot;cc&quot;, &quot;dd&quot;&#125;;</span><br><span class="line">pageContext.setAttribute(&quot;arr&quot;, a);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;h3&gt;使用EL表达式取出作用域中数组的值&lt;/h3&gt;</span><br><span class="line">$&#123;arr[0]&#125;,$&#123;arr[1]&#125;,$&#123;arr[2]&#125;,$&#123;arr[3]&#125;</span><br></pre></td></tr></table></figure><p>如果没有下标,使用<code>.</code>的方式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">pageContext.getAttribute(&quot;name&quot;);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;h3&gt;使用EL表达式取出作用域中的值&lt;/h3&gt;</span><br><span class="line">$&#123;pageScope.name&#125;</span><br></pre></td></tr></table></figure><h3 id="取出4个作用域中存放的值"><a href="#取出4个作用域中存放的值" class="headerlink" title="取出4个作用域中存放的值"></a>取出4个作用域中存放的值</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">pageContext.setAttribute</span>("<span class="attr">name</span>", "<span class="attr">page1</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">request.setAttribute</span>("<span class="attr">name</span>", "<span class="attr">page2</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">session.setAttribute</span>("<span class="attr">name</span>", "<span class="attr">page3</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">application.setAttribute</span>("<span class="attr">name</span>", "<span class="attr">page4</span>");</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>按普通手段取值<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">pageContext.getAttribute</span>("<span class="attr">name</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">request.getAttribute</span>("<span class="attr">name</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">session.getAttribute</span>("<span class="attr">name</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">application.getAttribute</span>("<span class="attr">name</span>");</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>使用EL表达式取出作用域中的值<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">$&#123;pageScope.name&#125;</span><br><span class="line">$&#123;requestScope.name&#125;</span><br><span class="line">$&#123;sessionScope.name&#125;</span><br><span class="line">$&#123;applicationScope.name&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">String</span>[] <span class="attr">a</span> = <span class="string">&#123;</span>"<span class="attr">aa</span>", "<span class="attr">bb</span>", "<span class="attr">cc</span>", "<span class="attr">dd</span>"&#125;;</span></span><br><span class="line"><span class="tag"><span class="attr">pageContext.setAttribute</span>("<span class="attr">arr</span>", <span class="attr">a</span>);</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>使用EL表达式取出作用域中数组的值<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">$&#123;arr[0]&#125;,$&#123;arr[1]&#125;,$&#123;arr[2]&#125;,$&#123;arr[3]&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">ArrayList</span> <span class="attr">list</span> = <span class="string">new</span> <span class="attr">ArrayList</span>();</span></span><br><span class="line"><span class="tag"><span class="attr">list.add</span>("<span class="attr">11</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">list.add</span>("<span class="attr">22</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">list.add</span>("<span class="attr">33</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">list.add</span>("<span class="attr">44</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">pageContext.setAttribute</span>("<span class="attr">li</span>", <span class="attr">list</span>);</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>使用EL表达式取出作用域中集合的值<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">$&#123;li[0]&#125;,$&#123;li[2]&#125;,$&#123;li[3]&#125;,$&#123;li[4]&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">HashMap</span> <span class="attr">map</span> = <span class="string">new</span> <span class="attr">HashMap</span>();</span></span><br><span class="line"><span class="tag"><span class="attr">map.put</span>("<span class="attr">name</span>", "<span class="attr">zhangsan</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">map.put</span>("<span class="attr">page</span>", <span class="attr">18</span>);</span></span><br><span class="line"><span class="tag"><span class="attr">map.put</span>("<span class="attr">address</span>", "<span class="attr">beijing</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">pageContext.setAttribute</span>("<span class="attr">map</span>", <span class="attr">map</span>);</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>使用EL表达式取出作用域中集合的值<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">$&#123;map.name&#125;,$&#123;map.age&#125;,$&#123;map.address&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="没有指定作用域-此时取值顺序"><a href="#没有指定作用域-此时取值顺序" class="headerlink" title="没有指定作用域,此时取值顺序"></a>没有指定作用域,此时取值顺序</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">pageContext.setAttribute</span>("<span class="attr">name</span>", "<span class="attr">page1</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">request.setAttribute</span>("<span class="attr">name</span>", "<span class="attr">page2</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">session.setAttribute</span>("<span class="attr">name</span>", "<span class="attr">page3</span>");</span></span><br><span class="line"><span class="tag"><span class="attr">application.setAttribute</span>("<span class="attr">name</span>", "<span class="attr">page4</span>");</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>有指定作用域,就到对应作用域里找<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">$&#123;pageScope.name&#125;</span><br><span class="line">$&#123;requestScope.name&#125;</span><br><span class="line">$&#123;sessionScope.name&#125;</span><br><span class="line">$&#123;applicationScope.name</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>没有指定作用域<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>先从pageContext里面找,不会在request里找,然后去session里面找,最后去application里面找<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">$&#123; name &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="EL表达式的11个内置对象"><a href="#EL表达式的11个内置对象" class="headerlink" title="EL表达式的11个内置对象"></a>EL表达式的11个内置对象</h3><blockquote><p>  JSP</p><ul><li>pageContext</li></ul><hr><p>  作用域</p><ul><li>pageScope</li><li>requestScope</li><li>sessionScope</li><li>applicationScope</li></ul><hr><p>  请求头</p><ul><li>header</li><li>headerValues</li></ul><hr><p>  请求参数</p><ul><li>param</li><li>paramValues</li></ul><hr><p>  Cookie</p><ul><li>cookie</li></ul><hr><p>  初始化参数</p><ul><li>initParam</li></ul></blockquote><h1 id="JSTL"><a href="#JSTL" class="headerlink" title="JSTL"></a>JSTL</h1><h2 id="定义和作用"><a href="#定义和作用" class="headerlink" title="定义和作用"></a>定义和作用</h2><blockquote><p>  JSP标准标签库,全称:JSP Standard Tag Library<br>  简化jsp的代码编写,替换<code>&lt;% %&gt;</code>的写法,配合EL使用</p></blockquote><h3 id="项目中引入JSTL"><a href="#项目中引入JSTL" class="headerlink" title="项目中引入JSTL"></a>项目中引入JSTL</h3><ol><li>复制<code>jstl.jar</code>和<code>standard.jar</code>文件到工程的WebContent/WEB-INF/lib目录下</li><li>在jsp页面上,使用taglib指令来引入标签库</li><li>注意:如果想支持EL表达式,那么引入的标签库必须选择1.1的版本,1.0的版本不支持EL表达式<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在头中引入 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 其中,prefix="c"中的c可以任意值,但是有一定的习惯 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">prefix</span>=<span class="string">"c"</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="常用标签"><a href="#常用标签" class="headerlink" title="常用标签"></a>常用标签</h2><h3 id="常用的标签"><a href="#常用的标签" class="headerlink" title="常用的标签"></a>常用的标签</h3><blockquote><ul><li>&lt;c:set&gt;&gt;</li><li>&lt;c:if&gt;</li><li>&lt;c:forEach&gt;&gt;</li></ul></blockquote><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>--------------------赋值操作-----------------------------<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 声明一个对象name,对象的值为zhangsan,存储到session 如果没有执行scop则默认是page作用域 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c:set</span> <span class="attr">var</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"zhangsan"</span> <span class="attr">scope</span>=<span class="string">"session"</span>&gt;</span><span class="tag">&lt;/<span class="name">c:set</span>&gt;</span></span><br><span class="line">$&#123;sessionScope.name &#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>--------------------条件语句-----------------------------<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c:set</span> <span class="attr">var</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"18"</span> <span class="attr">scope</span>=<span class="string">"session"</span>&gt;</span><span class="tag">&lt;/<span class="name">c:set</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- test用以写判断条件,var用以存判断结果,scope用以设定作用域 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 没有else --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123; age &gt;= 6 &#125;"</span> <span class="attr">var</span>=<span class="string">"flag"</span> <span class="attr">scope</span>=<span class="string">"page"</span>&gt;</span></span><br><span class="line">年龄大于5岁</span><br><span class="line"><span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>--------------------循环语句-----------------------------<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 从1开始遍历到10,步长为2,得到的结果复制给i,并且会存储到page域中 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">begin</span>=<span class="string">"1"</span> <span class="attr">end</span>=<span class="string">"10"</span> <span class="attr">var</span>=<span class="string">"i"</span> <span class="attr">setp</span>=<span class="string">"2"</span>&gt;</span></span><br><span class="line">$&#123;i &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>--------------------循环语句,遍历list--------------------<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- items:表示遍历哪一个对象,注意这里必须写EL表达式 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- var:遍历出来的每一个元素用user去接受 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag"><span class="attr">ArrayList</span> <span class="attr">list</span> = <span class="string">new</span> <span class="attr">ArrayList</span>();</span></span><br><span class="line"><span class="tag"><span class="attr">list.add</span>(<span class="attr">new</span> <span class="attr">User</span>("<span class="attr">zhangsan</span>", <span class="attr">18</span>));</span></span><br><span class="line"><span class="tag"><span class="attr">list.add</span>(<span class="attr">new</span> <span class="attr">User</span>("<span class="attr">lisi</span>", <span class="attr">28</span>));</span></span><br><span class="line"><span class="tag"><span class="attr">list.add</span>(<span class="attr">new</span> <span class="attr">User</span>("<span class="attr">wangwu</span>", <span class="attr">38</span>));</span></span><br><span class="line"><span class="tag"><span class="attr">list.add</span>(<span class="attr">new</span> <span class="attr">User</span>("<span class="attr">maliu</span>", <span class="attr">48</span>));</span></span><br><span class="line"><span class="tag"><span class="attr">list.add</span>(<span class="attr">new</span> <span class="attr">User</span>("<span class="attr">qianqi</span>", <span class="attr">58</span>));</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- items:表示遍历哪一个对象,注意这里必须写EL表达式 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- var:遍历出来的每一个元素用user去接受 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">var</span>=<span class="string">"user"</span> <span class="attr">items</span>=<span class="string">"$&#123;list &#125;"</span>&gt;</span></span><br><span class="line">$&#123;user.name &#125; ---- $&#123;user.age &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Servlet </tag>
            
            <tag> JSP/EL/JSTL </tag>
            
            <tag> Struts2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Servlet中关于Cookie和Session的使用</title>
      <link href="/2019/06/28/Servlet%E4%B8%AD%E5%85%B3%E4%BA%8ECookie%E5%92%8CSession%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2019/06/28/Servlet%E4%B8%AD%E5%85%B3%E4%BA%8ECookie%E5%92%8CSession%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h1><h2 id="什么是Cookie"><a href="#什么是Cookie" class="headerlink" title="什么是Cookie"></a>什么是Cookie</h2><blockquote><p>  饼干,其实就是一小份数据,是服务器给客户端,并且存储在客户端上的一份小数据</p></blockquote><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><blockquote><p>  自动登录,浏览记录,购物车等</p></blockquote><h2 id="为什么要使用Cookie"><a href="#为什么要使用Cookie" class="headerlink" title="为什么要使用Cookie"></a>为什么要使用Cookie</h2><blockquote><p>  http的请求是无状态的.客户端与服务端在通讯的时候,是无状态的,也就是说客户端第二次访问服务端的时候,服务端根本就不知道这个客户端以前是否有来过<br>  从用户来讲:为了更好的用户体验,更好的交互[自动登录]<br>  从公司来讲:可以更好的收集用户习惯[大数据]</p></blockquote><h2 id="Cookie的使用"><a href="#Cookie的使用" class="headerlink" title="Cookie的使用"></a>Cookie的使用</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//获取cookie</span></span><br><span class="line">    Cookie[] cookies = req.getCookies();</span><br><span class="line">    <span class="keyword">if</span> (cookies != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            System.out.println(cookie.getName() + <span class="string">"="</span> + cookie.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//新建cookie</span></span><br><span class="line">    Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">"name"</span>, <span class="string">"zhangsan"</span>);</span><br><span class="line">    <span class="comment">//将cookie传给客户端</span></span><br><span class="line">    resp.addCookie(cookie);</span><br><span class="line">    <span class="comment">//给cookie添加有效期</span></span><br><span class="line">    <span class="comment">//设置expiry的值</span></span><br><span class="line">    <span class="comment">//正值 -&gt; 表示在这个数字之后,cookie将会失败</span></span><br><span class="line">    <span class="comment">//负值 -&gt; 表示关闭浏览器,那么cookie就失效,默认值是-1</span></span><br><span class="line">    <span class="comment">//没有设置有效期 -&gt; 关闭浏览器后,cookie就没有了</span></span><br><span class="line">    cookie.setMaxAge(<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//给cookie赋新的值</span></span><br><span class="line">    cookie.setValue(<span class="string">"lisi"</span>);</span><br><span class="line">    <span class="comment">//用于指定只有请求了指定的域名,才会带上该cookie</span></span><br><span class="line">    cookie.setDomain(<span class="string">".address.com"</span>);</span><br><span class="line">    <span class="comment">//只有访问该域名下的cookieDemo的这个路径才会带cookie</span></span><br><span class="line">    cookie.setPath(<span class="string">"/CookieDemo"</span>);</span><br><span class="line"></span><br><span class="line">    resp.getWriter().write(<span class="string">"..."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Cookie的安全问题"><a href="#Cookie的安全问题" class="headerlink" title="Cookie的安全问题"></a>Cookie的安全问题</h2><ol><li>由于Cookie会保存在客户端上,所以有安全隐患</li><li>cookie的大小与个数有限制</li></ol><h1 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h1><blockquote><p>  会话,Session是基于Cookie的一种会话机制<br>  Cookie是服务器返回一小份数据给客户端,并且存放在客户端<br>  Session是将数据存放在服务端</p></blockquote><h2 id="Session的生命周期"><a href="#Session的生命周期" class="headerlink" title="Session的生命周期"></a>Session的生命周期</h2><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><blockquote><p>  如果在Servlet里面调用了request.getSession()</p></blockquote><h3 id="销毁"><a href="#销毁" class="headerlink" title="销毁"></a>销毁</h3><blockquote><p>  Session是存放在服务器的内存中的一份数据,当然可以持久话,即使关了浏览器session也不会销毁</p></blockquote><ol><li>关闭服务器</li><li>session会话过期时间默认30分钟,有效期过了,也就销毁了</li></ol><h2 id="Session常用API"><a href="#Session常用API" class="headerlink" title="Session常用API"></a>Session常用API</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">HttpSession session = req.getSession();</span><br><span class="line"><span class="comment">//得到会话id</span></span><br><span class="line">String id = session.getId();</span><br><span class="line"><span class="comment">//存值</span></span><br><span class="line">session.setAttribute(<span class="string">"name"</span>, <span class="string">"value"</span>);</span><br><span class="line"><span class="comment">//取值</span></span><br><span class="line">session.getAttribute(<span class="string">"name"</span>);</span><br><span class="line"><span class="comment">//移除值</span></span><br><span class="line">session.removeAttribute(<span class="string">"name"</span>);</span><br><span class="line">       <span class="comment">//销毁会话</span></span><br><span class="line">       session.invalidate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="简单的购物车例子"><a href="#简单的购物车例子" class="headerlink" title="简单的购物车例子"></a>简单的购物车例子</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">顺序:</span><br><span class="line">    商品列表 product_list.jsp</span><br><span class="line">        |</span><br><span class="line">        |</span><br><span class="line">    购物车逻辑 CarServlet.java</span><br><span class="line">        |</span><br><span class="line">        |</span><br><span class="line">    购物车展示页 cart.jsp</span><br><span class="line">        |</span><br><span class="line">        |</span><br><span class="line">    清空购物车逻辑 ClearCartServlet.java</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- product_list.jsp --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?id=0"</span>&gt;</span><span class="tag">&lt;<span class="name">h3</span>&gt;</span>Iphone7<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?id=1"</span>&gt;</span><span class="tag">&lt;<span class="name">h3</span>&gt;</span>小米<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?id=2"</span>&gt;</span><span class="tag">&lt;<span class="name">h3</span>&gt;</span>三星Note8<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?id=3"</span>&gt;</span><span class="tag">&lt;<span class="name">h3</span>&gt;</span>魅族7<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?id=4"</span>&gt;</span><span class="tag">&lt;<span class="name">h3</span>&gt;</span>华为9<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* CarServlet.java</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> com.zjinc36.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class CarServlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> HttpServlet#HttpServlet()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CartServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">        <span class="comment">//1. 获取要添加到购物车的商品id</span></span><br><span class="line">        <span class="keyword">int</span> id = Integer.parseInt(request.getParameter(<span class="string">"id"</span>));</span><br><span class="line">        String[] names = &#123;<span class="string">"Iphone7"</span>, <span class="string">"小米6"</span>, <span class="string">"三星Note8"</span>, <span class="string">"魅族7"</span>, <span class="string">"华为9"</span>&#125;;</span><br><span class="line">        <span class="comment">//2. 取到id对应的商品名称</span></span><br><span class="line">        String name = names[id];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 获取购物车存放东西的session Map&lt;String, Integer&gt;</span></span><br><span class="line">        HashMap&lt;String, Integer&gt; map = (HashMap&lt;String, Integer&gt;) request.getSession().getAttribute(<span class="string">"cart"</span>);</span><br><span class="line">        <span class="comment">//session里面没有存放任何东西</span></span><br><span class="line">        <span class="keyword">if</span> (map == <span class="keyword">null</span>) &#123;</span><br><span class="line">            map = <span class="keyword">new</span> HashMap&lt;String, Integer&gt;();</span><br><span class="line">            request.getSession().setAttribute(<span class="string">"cart"</span>, map);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3. 判断购物车里面有没有该商品</span></span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(name)) &#123;</span><br><span class="line">            <span class="comment">// 在原来的值基础上 + 1</span></span><br><span class="line">            map.put(name, map.get(name) + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            map.put(name, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 输出界面</span></span><br><span class="line">        response.getWriter().write(<span class="string">"&lt;a href='product_list.jsp'&gt;&lt;h3&gt;继续购物&lt;/h3&gt;&lt;/a&gt;"</span>);</span><br><span class="line">        response.getWriter().write(<span class="string">"&lt;a href='cart.jsp'&gt;&lt;h3&gt;去购物车结算&lt;/h3&gt;&lt;/a&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- cart.jsp --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@page</span> <span class="attr">import</span>=<span class="string">"java.util.HashMap"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>您的购物车<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>您的购物车的商品如下:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag">//<span class="attr">1.</span> 先获取到<span class="attr">map</span></span></span><br><span class="line">HashMap&lt;String, Integer&gt; map = (HashMap&lt;String, Integer&gt;)session.getAttribute("cart");</span><br><span class="line"></span><br><span class="line">//2. 遍历map</span><br><span class="line">if (map != null) &#123;</span><br><span class="line">for(String key : map.keySet()) &#123;</span><br><span class="line">int value = map.get(key);</span><br><span class="line">%&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>名称:<span class="tag">&lt;<span class="name">%=key</span> %&gt;</span>----数量<span class="tag">&lt;<span class="name">%=value</span> %&gt;</span><span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag">&#125;</span></span><br><span class="line"><span class="tag">&#125;</span></span><br><span class="line"><span class="tag">%&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"ClearCartServlet"</span>&gt;</span><span class="tag">&lt;<span class="name">h4</span>&gt;</span>清空购物车<span class="tag">&lt;/<span class="name">h4</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Servlet implementation class ClearCartServlet</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClearCartServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> HttpServlet#HttpServlet()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClearCartServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 方法一</span></span><br><span class="line">        <span class="comment">// 会话还在,数据清除了</span></span><br><span class="line">        session.removeAttribute(<span class="string">"cart"</span>);</span><br><span class="line">        <span class="comment">// 方法二</span></span><br><span class="line">        <span class="comment">// 会话直接就没了</span></span><br><span class="line">        <span class="comment">//session.invalidate();</span></span><br><span class="line">        response.sendRedirect(<span class="string">"cart.jsp"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Servlet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Servlet中关于HttpServletRequest和HttpServletResponse的使用</title>
      <link href="/2019/06/28/Servlet%E4%B8%AD%E5%85%B3%E4%BA%8EHttpServletRequest%E5%92%8CHttpServletResponse%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2019/06/28/Servlet%E4%B8%AD%E5%85%B3%E4%BA%8EHttpServletRequest%E5%92%8CHttpServletResponse%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="HttpServletRequest"><a href="#HttpServletRequest" class="headerlink" title="HttpServletRequest"></a>HttpServletRequest</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>这个对象封装了客户端提交过来的一切数据,包括</p><ol><li>取得头信息</li><li>取得客户端提交上来的数据</li></ol><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol><li><p>取得头信息</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取出请求里面的头信息</span></span><br><span class="line">Enumeration&lt;String&gt; headerNames = req.getHeaderNames();</span><br><span class="line"><span class="keyword">while</span> (headerNames.hasMoreElements()) &#123;</span><br><span class="line">String name = (String) headerNames.nextElement();</span><br><span class="line">String value = req.getHeader(name);</span><br><span class="line">System.out.println(name + <span class="string">"="</span> + value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>取得客户端提交上来的数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"><span class="comment">//1. 获取客户端提交上来的数据</span></span><br><span class="line">String name = req.getParameter(<span class="string">"name"</span>);</span><br><span class="line">System.out.println(<span class="string">"name="</span> + name);</span><br><span class="line">String address = req.getParameter(<span class="string">"address"</span>);</span><br><span class="line">System.out.println(<span class="string">"address="</span> + address);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 获取所有参数,得到枚举集合</span></span><br><span class="line"><span class="comment">//Enumeration&lt;String&gt; parameterNames = req.getParameterNames();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 获取所有参数,得到一个Map集合</span></span><br><span class="line"><span class="comment">//这里Map&lt;String, String[]&gt;中,后一个是String[],表明是一个数组</span></span><br><span class="line"><span class="comment">//产生的原因是因为我们访问的时候是有如下可能的,只是我们一般不会这样写</span></span><br><span class="line"><span class="comment">//name=1&amp;name=2&amp;name=3</span></span><br><span class="line">Map&lt;String, String[]&gt; map = req.getParameterMap();</span><br><span class="line">Set&lt;String&gt; keySet = map.keySet();</span><br><span class="line"><span class="comment">//创建一个迭代器</span></span><br><span class="line">Iterator&lt;String&gt; iterator = keySet.iterator();</span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">String key = (String) iterator.next();</span><br><span class="line">String value = map.get(key)[<span class="number">0</span>];</span><br><span class="line">System.out.println(key + <span class="string">"="</span> + value);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="需要解决的问题"><a href="#需要解决的问题" class="headerlink" title="需要解决的问题"></a>需要解决的问题</h3><h4 id="处理中文乱码"><a href="#处理中文乱码" class="headerlink" title="处理中文乱码"></a>处理中文乱码</h4><ol><li><p>方法一,在代码中进行转码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">String username = req.getParameter(<span class="string">"username"</span>);</span><br><span class="line">String password = req.getParameter(<span class="string">"password"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//get请求过来的数据,在url地址栏上就已经经过编码了,所以我们取到的就是乱码</span></span><br><span class="line"><span class="comment">//tomcat收到这批数据,getParameter默认使用ISO-8859-1去解码</span></span><br><span class="line"><span class="comment">//先让文字回到ISO-8859-1对应的字节数组,然后在按UTF-8组拼字符串</span></span><br><span class="line"><span class="comment">//getBytes(String charsetName): 使用指定的字符集将字符串编码为 byte 序列，并将结果存储到一个新的 byte 数组中。</span></span><br><span class="line">username = <span class="keyword">new</span> String(username.getBytes(<span class="string">"ISO-8859-1"</span>), <span class="string">"UTF-8"</span>);</span><br><span class="line">password = <span class="keyword">new</span> String(password.getBytes(<span class="string">"ISO-8859-1"</span>), <span class="string">"UTF-8"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>方法二,直接在tomcat中修改<br>打开server.xml文件,在如下指定位置加上<code>URIEncoding=&quot;UTF-8&quot;</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span> <span class="attr">port</span>=<span class="string">"8080"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> <span class="attr">URIEncoding</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>方法二：对请求头进行编码转换<br>该方法只对POST方式提交的数据有效，对GET方式提交的数据无效!</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br></pre></td></tr></table></figure></li></ol><h2 id="HttpServletResponse"><a href="#HttpServletResponse" class="headerlink" title="HttpServletResponse"></a>HttpServletResponse</h2><h3 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h3><blockquote><p>  负责返回数据给客户端</p></blockquote><h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><h4 id="输出数据"><a href="#输出数据" class="headerlink" title="输出数据"></a>输出数据</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">(HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">// 以字符流的方式写数据</span></span><br><span class="line">resp.getWriter().write(<span class="string">"&lt;h1&gt;hello response...&lt;/h1&gt;"</span>);</span><br><span class="line"><span class="comment">// 以字节流的方式写数据</span></span><br><span class="line">resp.getOutputStream().write(<span class="string">"hello"</span>.getBytes());;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置当前这个请求的处理状态码</span></span><br><span class="line"><span class="comment">//resp.setStatus("");</span></span><br><span class="line"><span class="comment">// 设置一个头</span></span><br><span class="line"><span class="comment">//resp.setHeader(name, value);</span></span><br><span class="line"><span class="comment">// 设置响应的内容类型,以及编码</span></span><br><span class="line"><span class="comment">//resp.setContentType(type);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test04</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> FileNotFoundException, IOException </span>&#123;</span><br><span class="line"><span class="comment">// 1.获取要下载文件名称</span></span><br><span class="line">String fileName = req.getParameter(<span class="string">"filename"</span>);</span><br><span class="line"><span class="comment">// 1.5 名字中带有中文</span></span><br><span class="line">       <span class="comment">// 下载框中文件名是乱码或不显示的时候，往往是由于我们没有对中文文件名进行编码处理</span></span><br><span class="line">       <span class="comment">// 针对浏览器类型，对文件名字做编码处理 Firefox (Base64) , IE、Chrome（UTF-8）</span></span><br><span class="line">String clientType = req.getHeader(<span class="string">"User-Agent"</span>);</span><br><span class="line"><span class="keyword">if</span> (clientType.contains(<span class="string">"Firefox"</span>)) &#123;</span><br><span class="line">fileName = DownLoadUtil.base64EncodeFileName(fileName);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fileName = URLEncoder.encode(fileName, <span class="string">"UTF-8"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2.获取这个文件在tomcat里面的绝对路径地址</span></span><br><span class="line">String path = getServletContext().getRealPath(<span class="string">"download/"</span> + fileName);</span><br><span class="line"><span class="comment">// 3.转化成输入流</span></span><br><span class="line">FileInputStream is = <span class="keyword">new</span> FileInputStream(path);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备输出</span></span><br><span class="line"><span class="comment">// 4.准备输出流</span></span><br><span class="line">ServletOutputStream os = resp.getOutputStream();</span><br><span class="line"><span class="comment">// 5.准备浏览器头,用以弹出下载框</span></span><br><span class="line">resp.setHeader(<span class="string">"Content-Disposition"</span>, <span class="string">"attachment; filename="</span> + fileName);</span><br><span class="line"><span class="comment">// 6.将输入流写到输出流</span></span><br><span class="line"><span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">while</span> ((len = is.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">os.write(buffer, <span class="number">0</span>, len);</span><br><span class="line">&#125;</span><br><span class="line">os.close();</span><br><span class="line">is.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上述代码使用的工具类</span></span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sun.misc.BASE64Encoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownLoadUtil</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">base64EncodeFileName</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">BASE64Encoder base64Encoder = <span class="keyword">new</span> BASE64Encoder();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"=?UTF-8?B?"</span></span><br><span class="line">+ <span class="keyword">new</span> String(base64Encoder.encode(fileName.getBytes(<span class="string">"UTF-8"</span>)))</span><br><span class="line">+ <span class="string">"?="</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果是中文文件下载,需要针对浏览器,对文件名字做编码处理 Firefox (Base64), IE和chrome使用URLEncoder</p><h3 id="会出现的问题"><a href="#会出现的问题" class="headerlink" title="会出现的问题"></a>会出现的问题</h3><h4 id="处理响应中文乱码问题"><a href="#处理响应中文乱码问题" class="headerlink" title="处理响应中文乱码问题"></a>处理响应中文乱码问题</h4><ol><li><p>以字符流输出 -&gt; resp.getWriter()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">(HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//响应的中文乱码问题</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//1. 指定输出到客户端的时候,这些文字使用UTF-8编码</span></span><br><span class="line">    <span class="comment">//这里写出去的文字,默认使用的是ISO-8859-1,我们可以指定写出去的时候,使用什么编码写</span></span><br><span class="line">    resp.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 直接规定浏览器看这份数据的时候,使用什么编码来看</span></span><br><span class="line">    resp.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line">    resp.getWriter().write(<span class="string">"中文输出"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// resp.setCharacterEncoding("UTF-8")和resp.setHeader("Content-Type", "text/html; charset=UTF-8")可以合并成一句话</span></span><br><span class="line"><span class="comment">// 即,可以用一句话来设置响应的数据类型</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">(HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    resp.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">    resp.getWriter().write(<span class="string">"中文输出"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>以字节流输出 -&gt; getOutputStream()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">(HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException, UnsupportedEncodingException </span>&#123;</span><br><span class="line">    <span class="comment">// 如果想让服务端出去的中文,在客户端能够正常显示,只要确保</span></span><br><span class="line">    <span class="comment">// 出去的时候使用的编码和浏览器看这份数据使用的编码是一样的</span></span><br><span class="line">    <span class="comment">// 1. 指定浏览器看这份数据使用的编码</span></span><br><span class="line">    resp.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/html; charset=UTF-8"</span>);</span><br><span class="line">    <span class="comment">// 2. 指定输出中文时使用的编码</span></span><br><span class="line">    <span class="comment">// 默认情况下getOutputStream输出使用的是UTF-8码表</span></span><br><span class="line">    <span class="comment">// 但为了确保万无一失,指定一下编码比较好</span></span><br><span class="line">    resp.getOutputStream().write(<span class="string">"中文测试"</span>.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以使用一句话来设置响应的数据类型</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">(HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> IOException, UnsupportedEncodingException </span>&#123;</span><br><span class="line">    resp.setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">    resp.getOutputStream().write(<span class="string">"中文测试"</span>.getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="请求转发和重定向"><a href="#请求转发和重定向" class="headerlink" title="请求转发和重定向"></a>请求转发和重定向</h2><h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><h4 id="什么是重定向"><a href="#什么是重定向" class="headerlink" title="什么是重定向"></a>什么是重定向</h4><ol><li>地址上显示的是最后的哪个资源的路径地址</li><li>请求次数最少有两次,服务器在第一次请求后,会返回302以及一个地址,浏览器再根据这个地址,执行第二次访问</li><li>可以跳转到任意路径,不是自己的工程也可以跳</li><li>效率稍微低一点,指向两次请求</li><li>后续的请求,没法使用上一次request对象,因为这是两次不同的请求</li></ol><h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"><span class="comment">//1.获取数据</span></span><br><span class="line">String userName = req.getParameter(<span class="string">"username"</span>);</span><br><span class="line">String password = req.getParameter(<span class="string">"password"</span>);</span><br><span class="line"><span class="comment">//2.校验数据,并返回给客户端</span></span><br><span class="line">PrintWriter pw = resp.getWriter();</span><br><span class="line"><span class="keyword">if</span> (<span class="string">"admin"</span>.equals(userName) &amp;&amp; <span class="string">"123"</span>.equals(password) ) &#123;</span><br><span class="line"><span class="comment">////之前的写法</span></span><br><span class="line"><span class="comment">////4.设置状态码</span></span><br><span class="line"><span class="comment">//resp.setStatus(302);</span></span><br><span class="line"><span class="comment">////5.定位跳转的位置是哪一个页面</span></span><br><span class="line"><span class="comment">//resp.setHeader("Location", "login_success.html");</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//重定向写法</span></span><br><span class="line">resp.sendRedirect(<span class="string">"login_success.html"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//失败,打印失败数据到网页</span></span><br><span class="line">pw.write(<span class="string">"login failed..."</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="请求转发"><a href="#请求转发" class="headerlink" title="请求转发"></a>请求转发</h3><h4 id="什么是请求转发"><a href="#什么是请求转发" class="headerlink" title="什么是请求转发"></a>什么是请求转发</h4><ol><li>地址栏上显示的是请求servlet的地址</li><li>请求次数只有一次,因为是服务器内部帮助客户端执行了后续的工作</li><li>只能跳转自己项目的资源路径</li><li>效率上稍微高一点,因为只执行一次请求</li><li>后续的请求,可以使用上一次request对象,因为只有一次请求</li></ol><h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line"><span class="comment">//1.获取数据</span></span><br><span class="line">String userName = req.getParameter(<span class="string">"username"</span>);</span><br><span class="line">String password = req.getParameter(<span class="string">"password"</span>);</span><br><span class="line"><span class="comment">//2.校验数据,并返回给客户端</span></span><br><span class="line">PrintWriter pw = resp.getWriter();</span><br><span class="line"><span class="keyword">if</span> (<span class="string">"admin"</span>.equals(userName) &amp;&amp; <span class="string">"123"</span>.equals(password) ) &#123;</span><br><span class="line">req.getRequestDispatcher(<span class="string">"login_success.html"</span>).forward(req, resp);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">//失败,打印失败数据到网页</span></span><br><span class="line">pw.write(<span class="string">"login failed..."</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Servlet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>String直接赋值与使用new String的区别</title>
      <link href="/2019/06/28/String%E7%9B%B4%E6%8E%A5%E8%B5%8B%E5%80%BC%E4%B8%8E%E4%BD%BF%E7%94%A8new-String%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2019/06/28/String%E7%9B%B4%E6%8E%A5%E8%B5%8B%E5%80%BC%E4%B8%8E%E4%BD%BF%E7%94%A8new-String%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  <strong>原文标题</strong>:String直接赋值与使用new String的区别<br>  <strong>原文链接</strong>:<a href="https://blog.csdn.net/weixin_41098980/article/details/80060200" target="_blank" rel="noopener">https://blog.csdn.net/weixin_41098980/article/details/80060200</a></p></blockquote><hr><p>在研究String直接赋值与new String的区别之前我们需要先了解java中的字符串常量池的概念</p><h2 id="字符串常量池"><a href="#字符串常量池" class="headerlink" title="字符串常量池"></a>字符串常量池</h2><p>String类是我们平常项目中使用频率非常高的一种对象类型，jvm为了提升性能和减少内存开销，避免字符的重复创建，其维护了一块特殊的内存空间，即字符串池，当需要使用字符串时，先去字符串池中查看该字符串是否已经存在，如果存在，则可以直接使用，如果不存在，初始化，并将该字符串放入字符创常量池中。</p><h2 id="使用String直接赋值"><a href="#使用String直接赋值" class="headerlink" title="使用String直接赋值"></a>使用String直接赋值</h2><p>String str = “abc”;可能创建一个或者不创建对象，如果”abc”在字符串池中不存在，会在java字符串池中创建一个String对象（”abc”），然后str指向这个内存地址，无论以后用这种方式创建多少个值为”abc”的字符串对象，始终只有一个内存地址被分配。==判断的是对象的内存地址，而equals判断的是对象内容。通过以下代码测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String str = <span class="string">"abc"</span>;</span><br><span class="line">String str1 = <span class="string">"abc"</span>;</span><br><span class="line">String str2 = <span class="string">"abc"</span>;</span><br><span class="line">System.out.println(str==str1);<span class="comment">//true</span></span><br><span class="line">System.out.println(str==str2);<span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>也就是str、str1、str2都是指向同一个内存地址。</p><h2 id="使用new-String-创建字符串"><a href="#使用new-String-创建字符串" class="headerlink" title="使用new String 创建字符串"></a>使用new String 创建字符串</h2><p>String str = new String(“abc”);至少会创建一个对象，也有可能创建两个。因为用到new关键字，肯定会在堆中创建一个String对象，如果字符池中已经存在”abc”,则不会在字符串池中创建一个String对象，如果不存在，则会在字符串常量池中也创建一个对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String str = <span class="keyword">new</span> String(<span class="string">"abc"</span>);</span><br><span class="line">String str1 = <span class="keyword">new</span> String(<span class="string">"abc"</span>);</span><br><span class="line">String str2 = <span class="keyword">new</span> String(<span class="string">"abc"</span>);</span><br><span class="line">System.out.println(str==str1);<span class="comment">//false</span></span><br><span class="line">System.out.println(str==str2);<span class="comment">//false</span></span><br></pre></td></tr></table></figure><p>可以看出来，str、str1、str2指向的是不同的内存地址</p><h2 id="使用String拼接字符串"><a href="#使用String拼接字符串" class="headerlink" title="使用String拼接字符串"></a>使用String拼接字符串</h2><p>项目中除了直接使用=赋值，也会用到字符串拼接，字符串拼接又分为变量拼接和已知字符串拼接</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String str = <span class="string">"abc"</span>;<span class="comment">//在常量池中创建abc</span></span><br><span class="line">String str1 = <span class="string">"abcd"</span>;<span class="comment">//在常量池中创建abcd</span></span><br><span class="line">String str2 = str+<span class="string">"d"</span>;<span class="comment">//拼接字符串，此时会在堆中新建一个abcd的对象，因为str2编译之前是未知的</span></span><br><span class="line">String str3 = <span class="string">"abc"</span>+<span class="string">"d"</span>;<span class="comment">//拼接之后str3还是abcd，所以还是会指向字符串常量池的内存地址</span></span><br><span class="line">System.out.println(str1==str2);<span class="comment">//false</span></span><br><span class="line">System.out.println(str1==str3);<span class="comment">//true</span></span><br></pre></td></tr></table></figure><p>所以在项目中还是不要使用new String去创建字符串，最好使用String直接赋值。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java细节 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HTTP Method GET Is Not Supported by This URL错误</title>
      <link href="/2019/06/27/HTTP-method-GET-is-not-supported-by-this-URL/"/>
      <url>/2019/06/27/HTTP-method-GET-is-not-supported-by-this-URL/</url>
      
        <content type="html"><![CDATA[<h2 id="错误详情"><a href="#错误详情" class="headerlink" title="错误详情"></a>错误详情</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP Status 405 ? Method Not Allowed</span><br><span class="line"></span><br><span class="line">Type Status Report</span><br><span class="line"></span><br><span class="line">Message HTTP method GET is not supported by this URL</span><br><span class="line"></span><br><span class="line">Description The method received in the request-line is known by the origin server but not supported by the target resource.</span><br><span class="line"></span><br><span class="line">Apache Tomcat/8.5.39 (Ubuntu)</span><br></pre></td></tr></table></figure><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>没有有效的doGet()方法,doGet()方法应该像下述方法一样<br>核心在于,要将<code>super.doGet(req, resp)</code>注释掉</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">//注意,这里的super.doGet(req, resp)要进行注释</span></span><br><span class="line">    <span class="comment">//super.doGet(req, resp);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Servlet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Servlet与ServletConfig与ServletContext的使用</title>
      <link href="/2019/06/26/Servlet%E4%B8%8EServletConfig%E4%B8%8EServletContext%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2019/06/26/Servlet%E4%B8%8EServletConfig%E4%B8%8EServletContext%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="Servlet是什么"><a href="#Servlet是什么" class="headerlink" title="Servlet是什么?"></a>Servlet是什么?</h2><blockquote><p>  其实就是一个java程序,运行在我们的web服务器上,用于接收和响应客户端的http请求<br>  更多的是配合动态资源来做,当然静态资源也需要使用到Servlet,只不过是Tomcat里面已经定义好了一个 DefaultServlet</p></blockquote><h2 id="Hello-Servlet"><a href="#Hello-Servlet" class="headerlink" title="Hello Servlet"></a>Hello Servlet</h2><ol><li><p>写一个web工程,要有一个服务器 -&gt; 参见<code>Eclipse配置Tomcat</code></p></li><li><p>测试运行web工程</p></li><li><p>在<code>Java Resource/src</code>下新建一个类,实现Servlet接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.servlet;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Servlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServlet</span> <span class="keyword">implements</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Hello"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>配置Servlet,用于告诉服务器,我们的应用有这么个Servlet</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>HelloWeb<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 向tomcat报告,我这个应用里面有这个servlet,名字和具体路径 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 名字 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 具体路径 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.itheima.servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 注册servlet映射 servletName:找到上面注册的具体servlet url-pattern:在地址栏上的path --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/a<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="Servlet执行过程"><a href="#Servlet执行过程" class="headerlink" title="Servlet执行过程"></a>Servlet执行过程</h2><ol><li>找到Tomcat应用</li><li>找到项目</li><li>找<code>web.xml</code>,然后在web.xml里面找到<code>url-pattern</code>,有没有哪一个<code>pattern</code>的内容是<code>/a</code></li><li>找到<code>servlet-mapping</code>中的那个<code>servlet-name</code> -&gt; [HelloServlet]</li><li>根据<code>servlet-name</code>找到<code>servlet</code>元素中的<code>servlet-name</code>中的[HelloServlet]</li><li>找到<code>对应的class</code>,然后开始创建该类的请求实例</li><li>执行对应class中的<code>service</code>方法</li></ol><h2 id="Servlet的通用写法"><a href="#Servlet的通用写法" class="headerlink" title="Servlet的通用写法"></a>Servlet的通用写法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Servlet(接口)</span><br><span class="line">    |</span><br><span class="line">    |</span><br><span class="line">GenericServlet</span><br><span class="line">    |</span><br><span class="line">    |</span><br><span class="line">HttpServlet(用于处理http的请求)</span><br></pre></td></tr></table></figure><h2 id="Servlet生命周期"><a href="#Servlet生命周期" class="headerlink" title="Servlet生命周期"></a>Servlet生命周期</h2><h3 id="什么是生命周期"><a href="#什么是生命周期" class="headerlink" title="什么是生命周期"></a>什么是生命周期</h3><blockquote><p>  从创建到销毁的一段时间</p></blockquote><h3 id="生命周期方法"><a href="#生命周期方法" class="headerlink" title="生命周期方法"></a>生命周期方法</h3><blockquote><p>  从创建到销毁,所调用的那些方法</p></blockquote><h4 id="init方法"><a href="#init方法" class="headerlink" title="init方法"></a>init方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在创建该Servlet的实例时,就执行该方法</span></span><br><span class="line"><span class="comment"> * 一个servlet只会初始化一次,init方法只会执行一次</span></span><br><span class="line"><span class="comment"> * 默认情况下是:初次访问该servlet,才会创建实例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="service方法"><a href="#service方法" class="headerlink" title="service方法"></a>service方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 只要客户端来了一个请求,那么就执行这个方法</span></span><br><span class="line"><span class="comment"> * 该方法可以被执行很多次,一次请求,对应一次service方法的调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="destroy方法"><a href="#destroy方法" class="headerlink" title="destroy方法"></a>destroy方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * servlet销毁的时候,就会执行该方法</span></span><br><span class="line"><span class="comment"> * 1. 该项目从tomcat</span></span><br><span class="line"><span class="comment"> * 2. 正常关闭tomcat就会执行(shutdown.bat)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="让Servlet创建实例的时机提前"><a href="#让Servlet创建实例的时机提前" class="headerlink" title="让Servlet创建实例的时机提前"></a>让Servlet创建实例的时机提前</h3><h4 id="问题提出"><a href="#问题提出" class="headerlink" title="问题提出"></a>问题提出</h4><p>默认情况下,只有在初次访问servlet的时候,才会执行init方法.有的时候,我们可能需要在这个方法里面执行一些初始化工作,甚至做一些耗时的逻辑,那么这个时候,初次访问,可能会在init方法中逗留太久的时间.那么有没有方法可以让这个初始化的时机提前一点</p><h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><p>在<code>web.xml</code>中配置的时候,使用<code>&lt;load-on-startup&gt;</code>元素,给定的数字越小,启动的时机就越早,一般不写负数,从2开始</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet03<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.itheima.servlet.HelloServlet03<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>3<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="使用ServletConfig"><a href="#使用ServletConfig" class="headerlink" title="使用ServletConfig"></a>使用ServletConfig</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><blockquote><p>  servlet的配置,通过这个对象,可以获取servlet在配置的时候一些信息</p></blockquote><h3 id="怎么写"><a href="#怎么写" class="headerlink" title="怎么写"></a>怎么写</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml文件中的servlet的配置信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>HelloServletConfig<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServletConfig<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.itheima.servlet.HelloServletConfig<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 可以添加初始化参数 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 用config.getInitParameter("address");函数获取 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>address<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>beijing...<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServletConfig<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/HelloServletConfig<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 代码片段</span></span><br><span class="line"><span class="comment">* ServletConfig,用以获取上述web.xml文件中对应的servlet配置信息</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.doGet(req, resp);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ServletConfig,用以获取上述web.xml文件中对应的servlet配置信息</span></span><br><span class="line">    <span class="comment">//1. 得到servlet配置对象,专门用于在配置中的servlet的信息</span></span><br><span class="line">    ServletConfig config = getServletConfig();</span><br><span class="line">    <span class="comment">//获取到的是配置servlet里面servlet-name的文本内容</span></span><br><span class="line">    String servletName = config.getServletName();</span><br><span class="line">    System.out.println(servletName);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 可以获取具体的某一参数</span></span><br><span class="line">    String address = config.getInitParameter(<span class="string">"address"</span>);</span><br><span class="line">    System.out.println(address);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"-----------------------------"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3. 获取所有的参数名称</span></span><br><span class="line">    Enumeration&lt;String&gt; names = config.getInitParameterNames();</span><br><span class="line">    <span class="comment">//遍历取出所有的参数名称</span></span><br><span class="line">    <span class="keyword">while</span> (names.hasMoreElements()) &#123;</span><br><span class="line">        String name = (String) names.nextElement();</span><br><span class="line">        System.out.println(<span class="string">"name ==="</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="为什么需要有这个ServletConfig"><a href="#为什么需要有这个ServletConfig" class="headerlink" title="为什么需要有这个ServletConfig"></a>为什么需要有这个ServletConfig</h3><ol><li>未来我们自己开发的一些应用,使用到了一些技术,或者一些代码,我们不会,但是有人写出来了,它的代码放置在了自己的servlet类里面</li><li>刚好这个servlet里面需要一个数组或者叫做变量值,但是这个值不是固定的,所以要求使用到这个servlet的工资,在注册servlet的时候,必须要在web.xml里面,声明init-params</li></ol><h2 id="Servlet配置方式"><a href="#Servlet配置方式" class="headerlink" title="Servlet配置方式"></a>Servlet配置方式</h2><p>看代码中的注释</p><h3 id="全路径匹配"><a href="#全路径匹配" class="headerlink" title="全路径匹配"></a>全路径匹配</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.zjinc36.servlet.Demo<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 以 / 开始,要写的一模一样 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 即浏览器要输入: http://localhost:8080/项目名称/aa/bb --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/aa/bb<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="路径匹配-前半段匹配"><a href="#路径匹配-前半段匹配" class="headerlink" title="路径匹配,前半段匹配"></a>路径匹配,前半段匹配</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.zjinc36.servlet.Demo<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 以 / 开始,但是以 * 结束 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- `*`其实是一个通配符,匹配任意文字 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- localhost:8080/项目名称/aa/bb  &lt;- 这里不限定/aa/bb,可以随意写 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="以扩展名匹配"><a href="#以扩展名匹配" class="headerlink" title="以扩展名匹配"></a>以扩展名匹配</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.zjinc36.servlet.Demo<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 没有/,以*开始,"*.扩展名" --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- `*`其实是一个通配符,匹配任意文字 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- localhost:8080/项目名称/aa/bb/cc.aa  &lt;- 这里不限定/aa/bb,可以随意写,只要结尾以.aa为扩展名就行 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.aa<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h2><blockquote><p>  Servlet上下文<br>  每个web工程只有一个servletContext对象.也就是说,不管在哪个servlet里面,获取到的这个类的对象都是同一个.</p></blockquote><h3 id="有什么作用"><a href="#有什么作用" class="headerlink" title="有什么作用"></a>有什么作用</h3><h4 id="可以获取全局配置参数"><a href="#可以获取全局配置参数" class="headerlink" title="可以获取全局配置参数"></a>可以获取全局配置参数</h4><ol><li><p>web.xml文件,注意全局参数的位置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- web.xml文件 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Demo3<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 配置全局参数 --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 全局参数:哪个Servlet都可以拿 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>address<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>具体地址<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span><span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Demo3<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo3<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.zjinc36.servlet.Demo3<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>Demo3<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/Demo3<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>java的代码实现</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"><span class="keyword">super</span>.doGet(req, resp);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 1.获取对象</span></span><br><span class="line">ServletContext context = getServletContext();</span><br><span class="line">       <span class="comment">// 2.获取对应的参数</span></span><br><span class="line">String address = context.getInitParameter(<span class="string">"address"</span>);</span><br><span class="line">System.err.println(<span class="string">"address="</span> + address);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="可以获取web应用中的资源"><a href="#可以获取web应用中的资源" class="headerlink" title="可以获取web应用中的资源"></a>可以获取web应用中的资源</h4><ol><li><p>方式一:只取文件,自己手动转流</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 先获取文件,在转换成流对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">//1.ServletContext对象</span></span><br><span class="line">    ServletContext context = getServletContext();</span><br><span class="line">    <span class="comment">//2.获取给定的文件在服务器上面的绝对路径</span></span><br><span class="line">    <span class="comment">//可以不给参数打印path,就能知道对应的根目录是哪个目录,从而能更清楚的写相对目录</span></span><br><span class="line">    String path = context.getRealPath(<span class="string">"file/config.properties"</span>);</span><br><span class="line">    <span class="comment">//3.指定载入的数据源</span></span><br><span class="line">    <span class="comment">//此处,如果想要获取web工程下的资源,用普通的FileInputStream写法不是OK的</span></span><br><span class="line">    <span class="comment">//因为路径不对了,这里相对的路径,其实是根据jre来确定的.</span></span><br><span class="line">    <span class="comment">//由于我们这是一个web工程,jre后面会由tomcat管理,所以这里真正相对路径是tomcat里面的bin目录</span></span><br><span class="line">    <span class="comment">//所以我们会用ServletContext对象来获取</span></span><br><span class="line">    InputStream is = <span class="keyword">new</span> FileInputStream(path);</span><br><span class="line">    <span class="comment">//4.创建属性对象</span></span><br><span class="line">    Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">    properties.load(is);</span><br><span class="line">    String name = properties.getProperty(<span class="string">"name"</span>);</span><br><span class="line">    System.out.println(<span class="string">"name="</span> + name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>方式二:直接将指定文件转化成流对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据相对路径,直接获取流对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//1.ServletContext对象</span></span><br><span class="line">        ServletContext context = getServletContext();</span><br><span class="line">        <span class="comment">//2.获取web工程下的资源,转化成流对象,前面隐藏当前工程的根目录</span></span><br><span class="line">        InputStream is = context.getResourceAsStream(<span class="string">"file/config.properties"</span>);</span><br><span class="line">        <span class="comment">//3.创建属性对象</span></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.load(is);</span><br><span class="line">        String name = properties.getProperty(<span class="string">"name"</span>);</span><br><span class="line">        System.out.println(<span class="string">"name="</span> + name);</span><br><span class="line">        is.close();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>方式三:直接将指定文件转化成流对象,<strong>但是不用到ServletContext对象</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据相对路径,直接获取流对象</span></span><br><span class="line"><span class="comment">* 不使用ServletContext对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="comment">//1.获取资源</span></span><br><span class="line"><span class="comment">//获取java文件的class, 然后获取到加载这个class到虚拟机中的那个类加载器对象</span></span><br><span class="line"><span class="comment">//此时的根路径在: wtpwebapps/项目名称/WEB-INF/classes</span></span><br><span class="line">InputStream is = <span class="keyword">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">"../../file/config.properties"</span>);</span><br><span class="line"><span class="comment">//2.创建属性对象</span></span><br><span class="line">Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">properties.load(is);</span><br><span class="line">String name = properties.getProperty(<span class="string">"name"</span>);</span><br><span class="line">System.out.println(<span class="string">"name="</span> + name);</span><br><span class="line">is.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4 id="存取数据-Servlet间共享数据-域对象"><a href="#存取数据-Servlet间共享数据-域对象" class="headerlink" title="存取数据,Servlet间共享数据(域对象)"></a>存取数据,Servlet间共享数据(域对象)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 使用ServletContext存取数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">//1.获取数据</span></span><br><span class="line">    String userName = req.getParameter(<span class="string">"username"</span>);</span><br><span class="line">    String password = req.getParameter(<span class="string">"password"</span>);</span><br><span class="line">    <span class="comment">//2.校验数据,并返回给客户端</span></span><br><span class="line">    PrintWriter pw = resp.getWriter();</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">"admin"</span>.equals(userName) &amp;&amp; <span class="string">"123"</span>.equals(password) ) &#123;</span><br><span class="line">        <span class="comment">//成功</span></span><br><span class="line">        <span class="comment">//3.保存数据,在多个Servlet之间共享</span></span><br><span class="line">        <span class="comment">//获取ServletContext保存的count的数据</span></span><br><span class="line">        Object obj = getServletContext().getAttribute(<span class="string">"count"</span>);</span><br><span class="line">        <span class="keyword">int</span> totalCount = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj != <span class="keyword">null</span>) &#123;</span><br><span class="line">            totalCount = (<span class="keyword">int</span>)obj;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"已知登录成功的次数是:"</span> + totalCount);</span><br><span class="line">        <span class="comment">//向ServletContext的CountServlet写入数据</span></span><br><span class="line">        getServletContext().setAttribute(<span class="string">"count"</span>, totalCount + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.设置状态码</span></span><br><span class="line">        resp.setStatus(<span class="number">302</span>);</span><br><span class="line">        <span class="comment">//5.定位跳转的位置是哪一个页面</span></span><br><span class="line">        resp.setHeader(<span class="string">"Location"</span>, <span class="string">"login_success.html"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//失败,打印失败数据到网页</span></span><br><span class="line">        pw.write(<span class="string">"login failed..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ServletContext的生命周期"><a href="#ServletContext的生命周期" class="headerlink" title="ServletContext的生命周期"></a>ServletContext的生命周期</h3><h4 id="何时创建"><a href="#何时创建" class="headerlink" title="何时创建"></a>何时创建</h4><blockquote><p>  服务器启动的时候,会为托管的每一个web应用程序,创建一个ServletContext对象</p></blockquote><h4 id="何时销毁"><a href="#何时销毁" class="headerlink" title="何时销毁"></a>何时销毁</h4><blockquote><p>  从服务器移除托管,或者是关闭服务器</p></blockquote><h3 id="ServletContext的作用范围"><a href="#ServletContext的作用范围" class="headerlink" title="ServletContext的作用范围"></a>ServletContext的作用范围</h3><blockquote><p>  只要在相同项目里面,都可以取.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Servlet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Http协议</title>
      <link href="/2019/06/26/Http%E5%8D%8F%E8%AE%AE/"/>
      <url>/2019/06/26/Http%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是协议"><a href="#什么是协议" class="headerlink" title="什么是协议"></a>什么是协议</h2><blockquote><p>  双方在交互,通讯的时候,遵守的一种规范和规则</p></blockquote><h2 id="什么是Http协议"><a href="#什么是Http协议" class="headerlink" title="什么是Http协议"></a>什么是Http协议</h2><blockquote><p>  针对网络上的客户端与服务器,在执行http请求的时候,遵守的一种规范<br>  其实就是规定了客户端在访问服务器的时候,要带上哪些东西.同时也规定了服务器返回数据的时候,要带上什么东西</p></blockquote><h4 id="Http的版本"><a href="#Http的版本" class="headerlink" title="Http的版本"></a>Http的版本</h4><blockquote><p>  1.0 -&gt; 请求数据,服务端返回后,将会断开链接<br>  1.1 -&gt; 请求数据,服务器返回后,链接还会保持着,除非服务器或客户端有一端关掉.当然,也有一定的时间限制,如果都空着这个连接,那么后面会自己断掉</p></blockquote><h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><p>请求的数据里面包好三个部分:请求行,请求头,请求体<br>以下述请求为例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//例子</span><br><span class="line">//对`http://localhost:8080/examples/servlets/servlet/RequestParamExample`进行抓包</span><br><span class="line"></span><br><span class="line">POST /examples/servlets/servlet/RequestParamExample HTTP/1.1</span><br><span class="line"></span><br><span class="line">Host: localhost:8080</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 37</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Origin: http://localhost:8080</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">DNT: 1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8</span><br><span class="line">Referer: http://localhost:8080/examples/servlets/servlet/RequestParamExample</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,ja;q=0.6</span><br><span class="line"></span><br><span class="line">firstname=firstName&amp;lastname=lastName</span><br></pre></td></tr></table></figure><h4 id="请求行"><a href="#请求行" class="headerlink" title="请求行"></a>请求行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//请求</span><br><span class="line">POST /examples/servlets/servlet/RequestParamExample HTTP/1.1</span><br><span class="line"></span><br><span class="line">//解释</span><br><span class="line">POST -&gt; 请求方式,以post去提交数据</span><br><span class="line">/examples/servlets/servlet/RequestParamExample -&gt; 请求的地址路径,就是要访问哪个地方</span><br><span class="line">HTTP/1.1 -&gt; 协议版本</span><br></pre></td></tr></table></figure><h4 id="请求头"><a href="#请求头" class="headerlink" title="请求头"></a>请求头</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Accept:客户端向服务器表示,我能支持什么类型的数据</span><br><span class="line">Referer:真正请求的地址路径,全路径</span><br><span class="line">Accept-Language:支持语言格式</span><br><span class="line">User-Agent:用户代理,向服务器表明,当前来访客户信息</span><br><span class="line">Content-Type:提交的数据类型(application/x-www-form-urlencoded -&gt; 经过urlencoding编码的form表单数据)</span><br><span class="line">Accept-Encoding:压缩算法</span><br><span class="line">Host:主机地址</span><br><span class="line">Content-Length:数据长度</span><br><span class="line">Connection:keep-Alive 保存链接</span><br><span class="line">Cache-Control:对缓存的操作</span><br></pre></td></tr></table></figure><h4 id="请求体"><a href="#请求体" class="headerlink" title="请求体"></a>请求体</h4><p>浏览器真正发送给服务器的数据<br>发送的数据呈现的是key=value,如果存在多个数据,那么使用&amp;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firstname=firstName&amp;lastname=lastName</span><br></pre></td></tr></table></figure><h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><p>响应的数据里面包含三个部分:响应行,响应头,响应体<br>以如下响应数据为例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200</span><br><span class="line">Content-Type: text/html;charset=UTF-8</span><br><span class="line">Content-Length: 692</span><br><span class="line">Date: Tue, 25 Jun 2019 15:39:28 GMT</span><br></pre></td></tr></table></figure><h4 id="响应行"><a href="#响应行" class="headerlink" title="响应行"></a>响应行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200</span><br><span class="line"></span><br><span class="line">协议版本</span><br><span class="line">    HTTP/1.1</span><br><span class="line"></span><br><span class="line">状态码 -&gt; 表明一次交互到底是什么样结果的一个code</span><br></pre></td></tr></table></figure><h4 id="响应头"><a href="#响应头" class="headerlink" title="响应头"></a>响应头</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Server:服务器是那一种类型</span><br><span class="line">Content-Type:服务器返回给客户端的内容类型</span><br><span class="line">Content-Length:返回的数据长度</span><br><span class="line">Date:通讯的日期,响应的时间</span><br></pre></td></tr></table></figure><h2 id="GET和POST请求"><a href="#GET和POST请求" class="headerlink" title="GET和POST请求"></a>GET和POST请求</h2><h4 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h4><ol><li>数据是以流的方式写过去,不会在地址栏上面显示</li><li>以流的方式写数据,所以数据大小没有限制</li></ol><h4 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h4><ol><li>会在地址栏后面拼接数据,所以有安全隐患.一般从服务器获取数据,并且客户端也不用提交上面数据的时候,可以使用GET</li><li>能够带的数据大小有限,1kb大小</li></ol><h4 id="GET和POST的区别"><a href="#GET和POST的区别" class="headerlink" title="GET和POST的区别"></a>GET和POST的区别</h4><ol><li>请求路径不同.POST请求,在url后面不跟上任何的数据,GET请求,在地址后面跟上数据</li><li>带上的数据不同.POST请求会使用流的方式写数据,GET请求是在地址栏上跟数据</li><li>由于POST请求使用流的方式写数据,所以一定需要一个Content-Length的头来说明数据的长度有多少</li></ol><h2 id="Web资源"><a href="#Web资源" class="headerlink" title="Web资源"></a>Web资源</h2><p>在http协议中,与web相关的资源,分为两类</p><ol><li>静态资源 -&gt; html/js/css</li><li>动态资源 -&gt; servlet/jsp</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Http </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中添加用户到指定组</title>
      <link href="/2019/06/25/Ubuntu%E4%B8%AD%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%88%B0%E6%8C%87%E5%AE%9A%E7%BB%84/"/>
      <url>/2019/06/25/Ubuntu%E4%B8%AD%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7%E5%88%B0%E6%8C%87%E5%AE%9A%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<p><em>假定用户名为<code>user1</code>,组名为<code>groupA</code></em></p><h2 id="查看用户具体所在的组"><a href="#查看用户具体所在的组" class="headerlink" title="查看用户具体所在的组"></a>查看用户具体所在的组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groups user1</span><br></pre></td></tr></table></figure><h2 id="添加用户到指定用户组"><a href="#添加用户到指定用户组" class="headerlink" title="添加用户到指定用户组"></a>添加用户到指定用户组</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">usermod -a -G groupA user1</span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">一定要使用-a参数(代表append)</span><br><span class="line">如果没有使用该参数,会使你离开其他用户组，仅仅做为用户组groupA的成员</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eclipse配置Tomcat</title>
      <link href="/2019/06/25/Eclipse%E9%85%8D%E7%BD%AETomcat/"/>
      <url>/2019/06/25/Eclipse%E9%85%8D%E7%BD%AETomcat/</url>
      
        <content type="html"><![CDATA[<h1 id="配置Server"><a href="#配置Server" class="headerlink" title="配置Server"></a>配置Server</h1><h2 id="Ubuntu环境"><a href="#Ubuntu环境" class="headerlink" title="Ubuntu环境"></a>Ubuntu环境</h2><h3 id="配置过程"><a href="#配置过程" class="headerlink" title="配置过程"></a>配置过程</h3><ol><li>在<code>Servers</code>里面(一般在正下方面板),<code>右键-&gt;new-&gt;server-&gt;选择到apache分类-&gt;找到对应的tomcat版本</code>,接着一步一步配置即可</li><li>配置完毕后,在server里面,右键刚才的服务器,然后open找到上面的<code>Server Location</code>,选择中间的<code>Use Tomcat installation...</code></li></ol><h2 id="出现的问题"><a href="#出现的问题" class="headerlink" title="出现的问题"></a>出现的问题</h2><h3 id="tomcat文件分散在不同目录"><a href="#tomcat文件分散在不同目录" class="headerlink" title="tomcat文件分散在不同目录"></a>tomcat文件分散在不同目录</h3><h4 id="问题重现"><a href="#问题重现" class="headerlink" title="问题重现"></a>问题重现</h4><blockquote><p>  1.在ubuntu中使用<code>sudo apt get</code>安装了<code>apache tomcat9</code><br>  2.使用<code>Windows&gt; Preferences&gt; Server&gt; Runtime Environment</code>将apache tomcat 9添加到eclipse中<br>  3.从服务器视图启动服务器时出现<code>Could not load the Tomcat server configuration at /Servers/Tomcat v9.0 Server at localhost-config. The configuration may be corrupt or incomplete.</code>(无法在localhost-config的/ Servers / Tomcat v9.0服务器上加载Tomcat服务器配置。配置可能已损坏或不完整)</p></blockquote><h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><ol><li>用apt-get安装的tomcat9,文件并不在同一个位置,而Eclipse期望tomcat配置文件等都在同一个位置</li><li>文件需要具有必要的权限</li></ol><h4 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/tomcat9</span><br><span class="line">sudo ln -s /var/lib/tomcat9/conf conf</span><br><span class="line">sudo ln -s /var/log/tomcat9 logs</span><br><span class="line">sudo ln -s /etc/tomcat9/policy.d/03catalina.policy conf/catalina.policy</span><br><span class="line">sudo chmod -R a + rwx /usr/share/tomcat9/conf</span><br></pre></td></tr></table></figure><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://stackoverflow.com/questions/30962932/could-not-load-the-tomcat-server-configuration" target="_blank" rel="noopener">Could not load the Tomcat server configuration</a><br><a href="http://adamish.com/blog/archives/355" target="_blank" rel="noopener">TOMCAT9 SERVER IN ECLIPSE WITH UBUNTU</a></p><h3 id="tomcat缺少backup目录"><a href="#tomcat缺少backup目录" class="headerlink" title="tomcat缺少backup目录"></a>tomcat缺少backup目录</h3><h4 id="启动Server时-报如下错误"><a href="#启动Server时-报如下错误" class="headerlink" title="启动Server时,报如下错误"></a>启动Server时,报如下错误</h4><blockquote><p>  Publishing the configuration… Error copying file to /usr/share/tomcat9/backup/catalina.policy: /usr/share/tomcat7/backup/catalina.policy (No such file or directory) /usr/share/tomcat7/backup/catalina.policy (No such file or directory) Error copying file to /usr/share/tomcat7/backup/catalina.properties: /usr/share/tomcat7/backup/catalina.properties (No such file or directory) /usr/share/tomcat7/backup/catalina.properties (No such file or directory) Error copying file to /usr/share/tomcat7/backup/context.xml: /usr/share/tomcat7/backup/context.xml (No such file or directory) /usr/share/tomcat7/backup/context.xml (No such file or directory) Error copying file to /usr/share/tomcat7/backup/server.xml: /usr/share/tomcat7/backup/server.xml (No such file or directory) /usr/share/tomcat7/backup/server.xml (No such file or directory) Error copying file to /usr/share/tomcat7/backup/tomcat-users.xml: /usr/share/tomcat7/backup/tomcat-users.xml (No such file or directory) /usr/share/tomcat7/backup/tomcat-users.xml (No such file or directory) Error copying file to /usr/share/tomcat7/backup/web.xml: /usr/share/tomcat7/backup/web.xml (No such file or directory) /usr/share/tomcat7/backup/web.xml (No such file or directory)</p></blockquote><h4 id="原因-1"><a href="#原因-1" class="headerlink" title="原因"></a>原因</h4><ol><li>这个错误通常在linux下或者osx下</li><li>而且tomcat目录不再当前user所属文件目录下</li><li>这时eclipse并没有权限到系统中tomcat安装目录下创建这样一个backup目录</li></ol><h4 id="解决-1"><a href="#解决-1" class="headerlink" title="解决"></a>解决</h4><p>我们可以自己手动建一个这样目录,然后赋予读写权限即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/tomcat9/</span><br><span class="line">sudo mkdir backup</span><br><span class="line">sudo chmod 777 backup</span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">    权限并非一定需要给到777</span><br><span class="line">    由于用apt-get安装的tomcat9大致分散在root组和tomcat组</span><br><span class="line">    所以,若能设置用户属于tomcat组,权限可以降低</span><br></pre></td></tr></table></figure><h3 id="tomcat缺少其他目录"><a href="#tomcat缺少其他目录" class="headerlink" title="tomcat缺少其他目录"></a>tomcat缺少其他目录</h3><ol><li>如果在tomcat分散的目录有对应的目录就软链到<code>/usr/share/tomcat9/</code>目录</li><li>如果没有对应的目录,处理方式和上述<code>tomcat缺少backup目录</code>处理的方式相同</li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Eclipse </tag>
            
            <tag> Tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tomcat发布项目</title>
      <link href="/2019/06/25/Tomcat%E5%8F%91%E5%B8%83%E9%A1%B9%E7%9B%AE/"/>
      <url>/2019/06/25/Tomcat%E5%8F%91%E5%B8%83%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="如何把一个项目发布到tomcat中"><a href="#如何把一个项目发布到tomcat中" class="headerlink" title="如何把一个项目发布到tomcat中"></a>如何把一个项目发布到tomcat中</h2><h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>如何能让其他的电脑访问我这台电脑上的资源</p><h3 id="方法一-拷贝文件到webapps-ROOT底下"><a href="#方法一-拷贝文件到webapps-ROOT底下" class="headerlink" title="方法一:拷贝文件到webapps/ROOT底下"></a>方法一:拷贝文件到<code>webapps/ROOT</code>底下</h3><ul><li>拷贝这个文件到<code>webapps/ROOT</code>底下,在浏览器里面访问<blockquote><p>  <code>http://localhost:8080</code> -&gt; 其实对应的是<code>webapps/ROOT</code>目录</p></blockquote></li><li>在webapps下面建一个文件夹,然后拷贝文件放置到这个文件夹中<blockquote><p>  <code>http://localhost:8080/xml/</code> -&gt; 对应的是<code>webapps/xml</code>目录<br>  <code>http://localhost:8080/xml/example.xml</code>访问xml目录的example.xml文件</p></blockquote></li></ul><h3 id="方法二-配置虚拟路径"><a href="#方法二-配置虚拟路径" class="headerlink" title="方法二:配置虚拟路径"></a>方法二:配置虚拟路径</h3><ol><li><p>在conf/server.xml找到host元素节点</p></li><li><p>加入以下内容</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- docBase:项目的路径地址 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- path:对应的虚拟路径,一定要以`/`打头 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">'项目地址'</span> <span class="attr">path</span>=<span class="string">'/虚拟地址'</span>&gt;</span><span class="tag">&lt;/<span class="name">Context</span>&gt;</span>&gt;</span><br></pre></td></tr></table></figure></li><li><p>在浏览器地址栏上输入:<a href="http://localhost:8080/a/person.xml" target="_blank" rel="noopener">http://localhost:8080/a/person.xml</a><br>会访问项目地址下的<code>person.xml</code>文件,而访问地址要加上<code>a</code>是由path决定的</p></li></ol><h3 id="方法三-配置虚拟路径"><a href="#方法三-配置虚拟路径" class="headerlink" title="方法三:配置虚拟路径"></a>方法三:配置虚拟路径</h3><ol><li><p>在<code>tomcat/conf/catalina/localhost/</code>目录下新建一个xml文件,名字可以自己定义,比如<code>person.xml</code></p></li><li><p>在这个文件里面写入以下内容</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml versio='1.0' encoding='utf-8' ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">"D:\abc"</span>&gt;</span><span class="tag">&lt;/<span class="name">Context</span>&gt;</span>&gt;</span><br></pre></td></tr></table></figure></li><li><p>在浏览器上面访问<code>http://localhost:8080/person/xml</code>的名字即可</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tomcat安装</title>
      <link href="/2019/06/24/Tomcat%E5%AE%89%E8%A3%85/"/>
      <url>/2019/06/24/Tomcat%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<h2 id="Tomcat安装"><a href="#Tomcat安装" class="headerlink" title="Tomcat安装"></a>Tomcat安装</h2><h3 id="Windows中安装"><a href="#Windows中安装" class="headerlink" title="Windows中安装"></a>Windows中安装</h3><ol><li>直接解压,然后找到<code>bin/startup.bat</code></li><li>可以安装<blockquote><p>  启动之后,如果能够正常看到黑窗口,表明已经成功安装,为了确保万无一失,最后在浏览器的地址栏上输入<a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a>,如果有看到内容,就表明成功了</p></blockquote></li><li>如果双击了startup.bat,看到一闪而过,一般都是JDK的环境变量没有配置</li></ol><h3 id="Ubuntu中安装"><a href="#Ubuntu中安装" class="headerlink" title="Ubuntu中安装"></a>Ubuntu中安装</h3><ol><li>搜索tomcat<blockquote><p>  apt-cache search tomcat</p></blockquote></li><li>选择需要的版本,我安装的是tomcat9<blockquote><p>  sudo apt-get install tomcat9</p></blockquote></li><li>后续<blockquote><p>  用apt-get安装,目录会比较分散<br>  使用<code>find / -name &quot;tomcat9&quot;</code>能够显示出tomcat9安装在哪些目录</p></blockquote></li></ol><h3 id="Tomcat目录介绍"><a href="#Tomcat目录介绍" class="headerlink" title="Tomcat目录介绍"></a>Tomcat目录介绍</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bin -&gt; 包含了一些jar,bat文件.startup.bat</span><br><span class="line">conf -&gt; tomcat的配置 server.xml web.xml</span><br><span class="line">lib -&gt; tomcat运行所需的jar文件</span><br><span class="line">logs -&gt; 运行的日志文件</span><br><span class="line">temp -&gt; 临时文件</span><br><span class="line">webapps -&gt; 发布到tomcat服务器上的项目,就存放在这个目录</span><br><span class="line">work -&gt; jsp翻译成java文件存放地</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tomcat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>进程的描述和控制1</title>
      <link href="/2018/09/16/%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%8F%8F%E8%BF%B0%E5%92%8C%E6%8E%A7%E5%88%B61/"/>
      <url>/2018/09/16/%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%8F%8F%E8%BF%B0%E5%92%8C%E6%8E%A7%E5%88%B61/</url>
      
        <content type="html"><![CDATA[<h2 id="本章内容"><a href="#本章内容" class="headerlink" title="本章内容"></a>本章内容</h2><ul><li>前趋图和程序执行</li><li>进程的描述</li><li>进程控制</li><li>进程同步</li><li>经典进程的同步问题</li><li>进程通信</li><li>线程(Threads)的基本概念</li><li>线程的实现</li></ul><a id="more"></a><h2 id="2-1-前趋图和程序执行"><a href="#2-1-前趋图和程序执行" class="headerlink" title="2.1 前趋图和程序执行"></a>2.1 前趋图和程序执行</h2><h3 id="2-1-1-前趋图"><a href="#2-1-1-前趋图" class="headerlink" title="2.1.1 前趋图"></a>2.1.1 前趋图</h3><ol><li><p><strong>作用</strong>:描述进程之间执行的前后关系</p></li><li><p>图中各种符号</p><blockquote><p>结点:用于描述一个程序段或进程,乃至一条语句<br>有向线段:用于描述两个结点之间存在的偏序或前趋关系</p></blockquote></li><li><p>需要掌握的名词</p><blockquote><p>前趋关系<br>直接前趋<br>直接后继<br>初始结点<br>终止结点<br>重量</p></blockquote></li></ol><p><strong>注意</strong>:前趋图不允许有循环,否则必然会产生不可能实现的前趋关系</p><h3 id="2-1-2-程序执行"><a href="#2-1-2-程序执行" class="headerlink" title="2.1.2 程序执行"></a>2.1.2 程序执行</h3><h4 id="程序的顺序执行"><a href="#程序的顺序执行" class="headerlink" title="程序的顺序执行"></a>程序的顺序执行</h4><ol><li>含义:仅当前一个程序段执行完后,才运行后一程序段</li><li>程序顺序执行时的特征<blockquote><p>顺序性<br>封闭性<br>可再现性</p></blockquote></li></ol><h4 id="程序的并发执行"><a href="#程序的并发执行" class="headerlink" title="程序的并发执行"></a>程序的并发执行</h4><ol><li>含义</li><li>程序并发执行时的特征<blockquote><p>  间断性<br>  失去封闭性<br>  不可再现性:程序在并发执行时,由于失去了封闭性,其计算结果必将与并发程序的执行速度有关,从而使程序的执行失去了可再现性</p></blockquote></li></ol><h2 id="2-2-进程的描述"><a href="#2-2-进程的描述" class="headerlink" title="2.2 进程的描述"></a>2.2 进程的描述</h2><h3 id="2-2-1-进程的定义和特征"><a href="#2-2-1-进程的定义和特征" class="headerlink" title="2.2.1 进程的定义和特征"></a>2.2.1 进程的定义和特征</h3><h4 id="进程的定义"><a href="#进程的定义" class="headerlink" title="进程的定义"></a>进程的定义</h4><blockquote><p>   几种比较经典的定义<br>   (1)进程是程序的一次执行<br>   (2)进程是一个程序及其数据在处理机上顺序执行时所发生的活动<br>   (3)进程是程序在一个数据集合上运行的过程,它是系统进行资源分配调度的一个独立单位</p></blockquote><p><strong>对传统OS中的进程定义为</strong>:进程是进程实体的运行过程,是系统进行资源分配和调度的一个独立单位</p><h4 id="进程的特征"><a href="#进程的特征" class="headerlink" title="进程的特征"></a>进程的特征</h4><blockquote><p>  动态性<br>  并发性<br>  独立性<br>  异步性</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 计算机操作系统 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu中使用imwheel设置鼠标滚轮的速度</title>
      <link href="/2018/09/16/Ubuntu%E4%B8%AD%E6%8E%A7%E5%88%B6%E9%BC%A0%E6%A0%87%E6%BB%9A%E5%8A%A8%E9%80%9F%E5%BA%A6/"/>
      <url>/2018/09/16/Ubuntu%E4%B8%AD%E6%8E%A7%E5%88%B6%E9%BC%A0%E6%A0%87%E6%BB%9A%E5%8A%A8%E9%80%9F%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>换了个鼠标,想设置滚轮的速度,才发现Ubuntu是没有这个选项的</p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>安装imwheel</p><h2 id="安装流程"><a href="#安装流程" class="headerlink" title="安装流程"></a>安装流程</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install imwheel</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ol><li><p>进入主目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br></pre></td></tr></table></figure></li><li><p>打开或创建.imwheelrc文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.imwheelrc</span><br></pre></td></tr></table></figure></li><li><p>粘贴如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;.*&quot;</span><br><span class="line">None,      Up,   Button4, 3</span><br><span class="line">None,      Down, Button5, 3</span><br><span class="line">Control_L, Up,   Control_L|Button4</span><br><span class="line">Control_L, Down, Control_L|Button5</span><br><span class="line">Shift_L,   Up,   Shift_L|Button4</span><br><span class="line">Shift_L,   Down, Shift_L|Button5</span><br></pre></td></tr></table></figure></li></ol><p>解释一下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+   第一行:`.*`, 用来指定在哪些应用中生效</span><br><span class="line">+   第二行,第三行:</span><br><span class="line">       None,      Up,   Button4, 3</span><br><span class="line">       None,      Down, Button5, 3</span><br><span class="line">       用来指定滚动的行数,其中 3 就代表默认滚动三行,且 3 是默认值</span><br><span class="line">+   剩下的几行:</span><br><span class="line">       可以让鼠标支持Ctrl/Shift来决定上下滚动</span><br></pre></td></tr></table></figure><h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imwheel</span><br></pre></td></tr></table></figure><h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><p>很明显,这个必须加入到系统启动项去,才能开机就生效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.  打开profile文件</span><br><span class="line">    vim ~/.profile</span><br><span class="line">    // 如果是要给全局用户使用</span><br><span class="line">    // vim /etc/profile</span><br><span class="line">2. 增加如下语句(自己写的, 仅供参考)</span><br><span class="line">    ps aux | grep imwheel | grep -v grep | awk &apos;&#123;print $2&#125;&apos;</span><br><span class="line">    if [ $? &lt;= 0 ]; then</span><br><span class="line">        imwheel</span><br><span class="line">    fi</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统引论2</title>
      <link href="/2018/09/16/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%BC%95%E8%AE%BA2/"/>
      <url>/2018/09/16/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%BC%95%E8%AE%BA2/</url>
      
        <content type="html"><![CDATA[<h2 id="1-4-1处理及管理功能"><a href="#1-4-1处理及管理功能" class="headerlink" title="1.4.1处理及管理功能"></a>1.4.1处理及管理功能</h2><h3 id="进程控制"><a href="#进程控制" class="headerlink" title="进程控制"></a>进程控制</h3><h4 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h4><blockquote><p>  为作业创建进程<br>  撤销已结束的进程<br>  控制进程在运行过程中的状态转换<br>  为一个进程创建若干线程的功能和撤销(终止)已完成任务的线程</p></blockquote><h3 id="进程同步"><a href="#进程同步" class="headerlink" title="进程同步"></a>进程同步</h3><h4 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h4><blockquote><p>  使多个进程能有条不紊地运行,系统中必须设置进程同步机制,用于协调多个进程的运行</p></blockquote><p>进程同步的方式</p><blockquote><p>  进程互斥方式:对临界资源(独占资源)进行访问,应该采用互斥方式<br>  进程同步方式:在相互合作去完成共同任务的诸进程(线程)间,由同步机构对它们的执行顺序加以协调</p></blockquote><h4 id="如何实现进程同步"><a href="#如何实现进程同步" class="headerlink" title="如何实现进程同步"></a>如何实现进程同步</h4><blockquote><p>  设置锁(一般写为W),锁打开的时候能对临界资源进行访问</p></blockquote><h3 id="进程通信"><a href="#进程通信" class="headerlink" title="进程通信"></a>进程通信</h3><h4 id="目的-1"><a href="#目的-1" class="headerlink" title="目的"></a>目的</h4><blockquote><p>  为在计算机中,为了加速应用程序的运行,常在系统中建立多个进程,并为一个进程建立多个线程,那么这些相互配合的进程之间,线程之间需要进行相互交换</p></blockquote><h4 id="通信方式"><a href="#通信方式" class="headerlink" title="通信方式"></a>通信方式</h4><blockquote><p>  同一计算机系统,通常采用直接通信方式,即由源进程利用发送命令直接将消息(message)挂在目标进程的消息队列上,以后由目标进程利用接收命令从消息队列中取出</p></blockquote><h3 id="调度"><a href="#调度" class="headerlink" title="调度"></a>调度</h3><h4 id="目的-2"><a href="#目的-2" class="headerlink" title="目的"></a>目的</h4><blockquote><p>  由于资源是有限的,所以每个作业需要调度才能执行</p></blockquote><h4 id="调度方式"><a href="#调度方式" class="headerlink" title="调度方式"></a>调度方式</h4><blockquote><p>  作业调度:从后备队列中按照一定的算法,选出若干个作业,为它们分配其必需的资源(首先是分配内存),在将它们调入内存后,便分别为它们建立进程,使它们都成为可能获得处理机的就绪进程,并按照一定的算法将它们插入就绪队列<br>  进程调度:就是从进程就绪队列中选出一新进程,把处理机分配给它,并为它设置运行线程,使进程投入执行</p></blockquote><h2 id="1-4-2存储器管理功能"><a href="#1-4-2存储器管理功能" class="headerlink" title="1.4.2存储器管理功能"></a>1.4.2存储器管理功能</h2><h3 id="内存分配"><a href="#内存分配" class="headerlink" title="内存分配"></a>内存分配</h3><h4 id="内存分配的方式"><a href="#内存分配的方式" class="headerlink" title="内存分配的方式"></a>内存分配的方式</h4><blockquote><p>  静态分配方式:内存空间是在内存装入时确定的,在作业装入后的整个运行期间不允许作业在申请新的内存空间,也不允许作业在内存中”移动”<br>  动态分配方式:内存空间同样是在内存装入时确定的,但是允许作业在运行过程中继续申请新的附加内存空间,同时也允许作业在内存中”移动”</p></blockquote><h4 id="内存分配的主要任务"><a href="#内存分配的主要任务" class="headerlink" title="内存分配的主要任务"></a>内存分配的主要任务</h4><blockquote><p>  内存分配数据结构:该结构记录内存空间的使用情况<br>  内存分配功能:系统按照一定的算法为用户分配内存空间<br>  内存回收功能:系统对用户不再需要的内存,通过用户释放内存请求,去完成系统的回收功能</p></blockquote><h3 id="内存保护"><a href="#内存保护" class="headerlink" title="内存保护"></a>内存保护</h3><h4 id="内存保护的主要任务"><a href="#内存保护的主要任务" class="headerlink" title="内存保护的主要任务"></a>内存保护的主要任务</h4><blockquote><p>  确保每道用户程序都仅在自己的内存空间内运行,彼此互不干扰<br>  绝不允许用户程序访问操作系统的程序和数据,也不允许用户程序转移到非共享的其他用户程序中去执行</p></blockquote><h4 id="简单的内存保护机制-–-gt-越界检查"><a href="#简单的内存保护机制-–-gt-越界检查" class="headerlink" title="简单的内存保护机制 –&gt; 越界检查"></a>简单的内存保护机制 –&gt; 越界检查</h4><blockquote><p>  简单来讲:就是给你一块地盘,给你划好界限,越界就就打你<br>  越界检查一般由硬件实现:若是由软件检查,每增加一条指令就必须增加多条指令去处理,会显著降低程序的运行速度<br>地址映射</p></blockquote><h4 id="有三方面来讲"><a href="#有三方面来讲" class="headerlink" title="有三方面来讲"></a>有三方面来讲</h4><blockquote><p>  逻辑地址(相对地址)和地址空间<br>  物理地址和内存空间<br>  逻辑地址如何转换成物理地址</p></blockquote><h5 id="逻辑地址-相对地址-和地址空间"><a href="#逻辑地址-相对地址-和地址空间" class="headerlink" title="逻辑地址(相对地址)和地址空间"></a>逻辑地址(相对地址)和地址空间</h5><blockquote><p>  在多道程序环境下,每道程序经编译后,通常会形成若干个目标程序,这些目标程序在经过链接便形成了可装入程序,而每次形成可装入程序时,地址都从”0”开始标记,有这些地址所形成的地址范围称之为”地址空间”,其中的地址称为”逻辑地址”或”相对地址”</p></blockquote><h5 id="物理地址和内存空间"><a href="#物理地址和内存空间" class="headerlink" title="物理地址和内存空间"></a>物理地址和内存空间</h5><blockquote><p>  由内存能中一系列的单元所限定的地址范围称为”内存空间”,其中的地址称为”物理地址”</p></blockquote><h5 id="逻辑地址转换成物理地址"><a href="#逻辑地址转换成物理地址" class="headerlink" title="逻辑地址转换成物理地址"></a>逻辑地址转换成物理地址</h5><blockquote><p>  由上述表明,若程序A的逻辑地址0映射到物理地址0,那么程序B的逻辑地址0就不能映射到物理地址0,这样造成的逻辑地址与其内存地址并不相一致,所以需要”地址映射”将逻辑地址转成物理地址</p></blockquote><h3 id="内存扩充"><a href="#内存扩充" class="headerlink" title="内存扩充"></a>内存扩充</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><blockquote><p>  内存扩充并非是从物理上去扩大内存的容量,而是借助于虚拟存储技术,从逻辑上扩充内存容量</p></blockquote><h4 id="实现的功能"><a href="#实现的功能" class="headerlink" title="实现的功能"></a>实现的功能</h4><blockquote><p>  请求调入功能<br>  置换功能</p></blockquote><h4 id="请求调入功能"><a href="#请求调入功能" class="headerlink" title="请求调入功能"></a>请求调入功能</h4><blockquote><p>  系统允许用户在仅装入部分用户程序和数据的情况下,便能启动该程序运行,在程序运行过程中,若发现要继续运行时所需的程序和数据尚未装入内存,可向OS发送请求,由OS从磁盘中将所需部分调入内存,以便继续运行</p></blockquote><h4 id="置换功能"><a href="#置换功能" class="headerlink" title="置换功能"></a>置换功能</h4><blockquote><p>  内存不够用的时候,系统需要将内存中的一部分暂时不用的程序和数据调至硬盘上,腾出空间,给其他需要的用</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 计算机操作系统 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>操作系统引论1</title>
      <link href="/2018/09/16/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%BC%95%E8%AE%BA1/"/>
      <url>/2018/09/16/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%BC%95%E8%AE%BA1/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu批量修改目录与文件权限</title>
      <link href="/2018/09/16/Ubuntu%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90/"/>
      <url>/2018/09/16/Ubuntu%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9%E7%9B%AE%E5%BD%95%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90/</url>
      
        <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ul><li>家目录下,所有目录的”可运行”权限全部消失,但文件的权限还是正常的</li><li>现在要给目录重新赋予”可运行”权限,但又不能给文件”可运行”权限<h2 id="修改一个目录下所有文件权限"><a href="#修改一个目录下所有文件权限" class="headerlink" title="修改一个目录下所有文件权限"></a>修改一个目录下所有文件权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 0755 &lt;要修改的目录&gt;</span><br></pre></td></tr></table></figure></li></ul><h2 id="批量修改一个目录下所有文件的权限"><a href="#批量修改一个目录下所有文件的权限" class="headerlink" title="批量修改一个目录下所有文件的权限"></a>批量修改一个目录下所有文件的权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /usr/local -type d -exec chmod 0755 &#123;&#125; \;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中的反射机制有什么用</title>
      <link href="/2018/07/09/Java%E4%B8%AD%E7%9A%84%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8/"/>
      <url>/2018/07/09/Java%E4%B8%AD%E7%9A%84%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6%E6%9C%89%E4%BB%80%E4%B9%88%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h1><p><a href="https://blog.csdn.net/wo_shi_LTB/article/details/79048506" target="_blank" rel="noopener">反射机制有什么用</a></p><h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>反射不需要改代码只需要改配置文件<br>而非反射方式，必须修改代码，而且要重新编译运行</p><h2 id="step1-业务类"><a href="#step1-业务类" class="headerlink" title="step1:业务类"></a>step1:业务类</h2><p>首先准备两个业务类，这两个业务类很简单，就是各自都有一个业务方法，分别打印不同的字符串</p><ol><li><p>Service1.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Service1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doService1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"业务方法1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Service2.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Service2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doService2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"业务方法2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="step2-非反射方式"><a href="#step2-非反射方式" class="headerlink" title="step2:非反射方式"></a>step2:非反射方式</h2><p>当需要从第一个业务方法切换到第二个业务方法的时候，使用非反射方式，必须修改代码，并且重新编译运行，才可以达到效果</p><ol><li><p>调用Service1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Service1().doService1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>现在需要调用Service2,需要修改代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//      new Service1().doService1();</span></span><br><span class="line">        <span class="keyword">new</span> Service2().doService2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="step3-反射方式"><a href="#step3-反射方式" class="headerlink" title="step3:反射方式"></a>step3:反射方式</h2><ul><li><p>使用反射方式，首先准备一个配置文件，就叫做spring.txt吧, 放在src目录下。 里面存放的是类的名称，和要调用的方法名。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// spring.txt内容</span><br><span class="line"></span><br><span class="line">class=reflection.Service1</span><br><span class="line">method=doService1</span><br></pre></td></tr></table></figure></li><li><p>在测试类Test中，首先取出类名称和方法名，然后通过反射去调用这个方法。</p></li><li><p>当需要从调用第一个业务方法，切换到调用第二个业务方法的时候，不需要修改一行代码，也不需要重新编译，只需要修改配置文件spring.txt，再运行即可。</p></li><li><p>这也是Spring框架的最基本的原理，只是它做的更丰富，安全，健壮。</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> reflection;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(&#123; <span class="string">"rawtypes"</span>, <span class="string">"unchecked"</span> &#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">//从spring.txt中获取类名称和方法名称</span></span><br><span class="line">        File springConfigFile = <span class="keyword">new</span> File(<span class="string">"e:\\project\\j2se\\src\\spring.txt"</span>);</span><br><span class="line">        Properties springConfig= <span class="keyword">new</span> Properties();</span><br><span class="line">        springConfig.load(<span class="keyword">new</span> FileInputStream(springConfigFile));</span><br><span class="line">        String className = (String) springConfig.get(<span class="string">"class"</span>);</span><br><span class="line">        String methodName = (String) springConfig.get(<span class="string">"method"</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">//根据类名称获取类对象</span></span><br><span class="line">        Class clazz = Class.forName(className);</span><br><span class="line">        <span class="comment">//根据方法名称，获取方法对象</span></span><br><span class="line">        Method m = clazz.getMethod(methodName);</span><br><span class="line">        <span class="comment">//获取构造器</span></span><br><span class="line">        Constructor c = clazz.getConstructor();</span><br><span class="line">        <span class="comment">//根据构造器，实例化出对象</span></span><br><span class="line">        Object service = c.newInstance();</span><br><span class="line">        <span class="comment">//调用对象的指定方法</span></span><br><span class="line">        m.invoke(service);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu18.04安装ibus拼音输入</title>
      <link href="/2018/05/12/Ubuntu18-04%E5%AE%89%E8%A3%85ibus%E6%8B%BC%E9%9F%B3%E8%BE%93%E5%85%A5/"/>
      <url>/2018/05/12/Ubuntu18-04%E5%AE%89%E8%A3%85ibus%E6%8B%BC%E9%9F%B3%E8%BE%93%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="安装ibus"><a href="#安装ibus" class="headerlink" title="安装ibus"></a>安装ibus</h1><ol start="0"><li><p>打开install/remove languages里面，勾选上chinese<br><img src="/images/2020/05/20200512005.png" alt><br><img src="/images/2020/05/20200512006.png" alt></p></li><li><p>安装iBus框架</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install ibus ibus-clutter ibus-gtk ibus-gtk3 ibus-qt4</span><br></pre></td></tr></table></figure></li><li><p>启动iBus框架</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ im-config -s ibus</span><br></pre></td></tr></table></figure></li><li><p>安装ibus拼音输入引擎</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install ibus-pinyin</span><br></pre></td></tr></table></figure></li><li><p>启用ibus-pinyin</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ibus-setup</span><br></pre></td></tr></table></figure></li></ol><p><img src="/images/2020/05/20200512001.png" alt><br><img src="/images/2020/05/20200512002.png" alt><br><img src="/images/2020/05/20200512003.png" alt></p><ol start="5"><li>在系统设置的区域与语言中添加iBus的智能拼音输入法如下图<br><img src="/images/2020/05/20200512004.png" alt></li></ol><h1 id="输入法不生效怎么办"><a href="#输入法不生效怎么办" class="headerlink" title="输入法不生效怎么办"></a>输入法不生效怎么办</h1><p><a href="https://bugs.launchpad.net/ubuntu/+source/ibus-libpinyin/+bug/1847021" target="_blank" rel="noopener">Cannot input Chinese if only “Chinese (Intelligent Pinyin)” is set </a></p><blockquote><p>  Try to clear the cache:<br>  rm ~/.cache/ibus/pinyin/* ~/.cache/ibus/libpinyin/*  and then relogin.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zsh添加环境变量</title>
      <link href="/2018/05/11/Zsh%E6%B7%BB%E5%8A%A0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/"/>
      <url>/2018/05/11/Zsh%E6%B7%BB%E5%8A%A0%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="临时添加环境变量"><a href="#临时添加环境变量" class="headerlink" title="临时添加环境变量"></a>临时添加环境变量</h1><p>给 Linux/Unix 系统增加环境变量，是使用<code>export</code>命令。</p><h1 id="永久增加环境变量"><a href="#永久增加环境变量" class="headerlink" title="永久增加环境变量"></a>永久增加环境变量</h1><p>为了永久性生效，则需要考虑加入到登录的<code>profile</code>中。</p><p>这个时候要考虑你当前使用的shell</p><ul><li>对于默认的<code>bash shell</code>，则可编辑用户根目录下的隐藏文件<code>./bash_profile</code></li><li>对于zsh 而言，需要编辑<code>.zshrc</code>这个文件</li></ul><h1 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.zshrc</span><br><span class="line"></span><br><span class="line">export PATH=/usr/local/python-2.7.6/bin:$PATH</span><br></pre></td></tr></table></figure><p>解释：</p><p>环境变量中，各个值是以冒号分隔开的。上面的语句表示给 PATH 这个变量重新赋值，让它等于<code>usr/local/python-2.7.6/bin</code>,同时后面加上原来的 $PATH</p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu的gnome的使用与常用扩展</title>
      <link href="/2018/05/06/Ubuntu%E7%9A%84gnome%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95/"/>
      <url>/2018/05/06/Ubuntu%E7%9A%84gnome%E7%9A%84%E4%BD%BF%E7%94%A8%E4%B8%8E%E5%B8%B8%E7%94%A8%E6%89%A9%E5%B1%95/</url>
      
        <content type="html"><![CDATA[<h1 id="gnome中的一些快捷键"><a href="#gnome中的一些快捷键" class="headerlink" title="gnome中的一些快捷键"></a>gnome中的一些快捷键</h1><ul><li>Alt+F2 快速使用命令(r命令重启shell，rt命令重载shell主题）</li><li>Alt+Space 可以弹出标题栏右键菜单</li><li>按住Alt键时关机按钮会变成暂停（suspend）按钮</li><li>鼠标滚轮/鼠标中键点击dock上的图标会打开一个程序的新窗口</li><li>按住Ctrl时鼠标左键点击dock上的图标会打开一个程序的新窗口</li><li>拖动窗口到屏幕左/右边缘（或按下win+左右箭头）会平铺该窗口到屏幕左/右</li><li>gnome3.24自带夜光功能，无需使用redshift或xflux</li></ul><h1 id="常用扩展"><a href="#常用扩展" class="headerlink" title="常用扩展"></a>常用扩展</h1><h2 id="A"><a href="#A" class="headerlink" title="A"></a>A</h2><h3 id="Applications-Menu"><a href="#Applications-Menu" class="headerlink" title="Applications Menu"></a>Applications Menu</h3><ul><li><p>提供的外观效果对于每位曾使用过GNOME 2的朋友来说都显得相当熟悉。它采用的默认应用启动器常见于以往几年中的各类主流Linux发行版。对我来说，调整启动器并不仅仅是为了找到以往的熟悉感觉，而是希望更快更轻松地找到自己需要的应用程序。这款方案能够对应用程序列表进行类别分组，并按应用名称排序而不仅显示对应图标。如此一来，我将能够更快地找到使用频繁较低的工具</p></li><li><p>开启application menu扩展可以在右上角添加分类程序菜单（默认alt+f1)</p></li><li><p><img src="/images/2020/05/20200506001.png" alt></p></li></ul><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><h3 id="Clipboard-Indicato"><a href="#Clipboard-Indicato" class="headerlink" title="Clipboard Indicato"></a>Clipboard Indicato</h3><p>如果大家需要经常使用剪贴板，那么这项扩展绝对不可错过。在安装之后，Clipboard Indicator会出现在顶部面板当中，用以提供曾经复制至剪贴板的全部历史记录。只需要点击该标识而后选择要使用的文本内容，再配合Ctrl+V即可完成历史文本复制。</p><p><img src="/images/2020/05/20200506009.png" alt></p><h3 id="Calculator-Button"><a href="#Calculator-Button" class="headerlink" title="Calculator Button"></a>Calculator Button</h3><p>快速打开<code>gnome-calculator</code>计算器</p><p><img src="/images/2020/05/20200508001.png" alt></p><h2 id="D"><a href="#D" class="headerlink" title="D"></a>D</h2><h3 id="Drop-down-terminal"><a href="#Drop-down-terminal" class="headerlink" title="Drop down terminal"></a>Drop down terminal</h3><p>能从屏幕边缘快捷唤出终端，不用时再按快捷键缩回去</p><p><img src="/images/2020/05/20200506011.png" alt></p><h3 id="dash-to-dock"><a href="#dash-to-dock" class="headerlink" title="dash-to-dock"></a>dash-to-dock</h3><p>dock设置</p><h2 id="E"><a href="#E" class="headerlink" title="E"></a>E</h2><h3 id="EasyScreenCast"><a href="#EasyScreenCast" class="headerlink" title="EasyScreenCast"></a>EasyScreenCast</h3><p>屏幕录像，做演示时比较方便</p><h2 id="F"><a href="#F" class="headerlink" title="F"></a>F</h2><h3 id="gTile"><a href="#gTile" class="headerlink" title="gTile"></a>gTile</h3><p>可以将窗口按不同的大小组合显示在屏幕上，当你有很多窗口需要一起显示的时候很有用<br><img src="/images/2020/07/20200701002.png" alt></p><h2 id="L"><a href="#L" class="headerlink" title="L"></a>L</h2><h3 id="Lunar-Calendar-农历"><a href="#Lunar-Calendar-农历" class="headerlink" title="Lunar Calendar 农历"></a>Lunar Calendar 农历</h3><p>显示农历</p><h2 id="M"><a href="#M" class="headerlink" title="M"></a>M</h2><h3 id="Multi-Monitors-Add-On"><a href="#Multi-Monitors-Add-On" class="headerlink" title="Multi Monitors Add-On"></a>Multi Monitors Add-On</h3><p>默认情况下，GNOME并不能充分利用额外的显示器——或者说效果并不能令人满意。默认的第二显示器缺少顶部面板，这意味着我们仍然需要通过第一显示器进行各类设置。这个扩展能够帮助我们添加此面板，设置缩略图、活动按钮以及对应的应用程序菜单</p><h3 id="modern-calc"><a href="#modern-calc" class="headerlink" title="modern-calc"></a>modern-calc</h3><p>右侧滑入滑出的计算器，装逼必备</p><p><img src="/images/2020/05/20200506005.png" alt></p><h2 id="N"><a href="#N" class="headerlink" title="N"></a>N</h2><h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h3><blockquote><p>  Sticky notes for the GNOME Shell desktop</p></blockquote><p>gnome shell桌面的便签笔记<br><img src="/images/2020/05/20200508003.png" alt></p><h2 id="P"><a href="#P" class="headerlink" title="P"></a>P</h2><h3 id="Places-Status-Indicator"><a href="#Places-Status-Indicator" class="headerlink" title="Places Status Indicator"></a>Places Status Indicator</h3><p>添加菜单以快速导航系统中的位置</p><p><img src="/images/2020/05/20200506003.png" alt></p><h2 id="R"><a href="#R" class="headerlink" title="R"></a>R</h2><h3 id="Recent-items"><a href="#Recent-items" class="headerlink" title="Recent items"></a>Recent items</h3><p>在顶部面板中为最近使用的项添加一个图标; 点击清除列表; 左键单击：打开文件，右键单击：打开包含文件夹; 设置：项目数，“更多”项下的项目数和黑名单选项在extension.js的顶部定义.</p><p><img src="/images/2020/05/20200506006.png" alt></p><h2 id="S"><a href="#S" class="headerlink" title="S"></a>S</h2><h3 id="Screenshot-Tool"><a href="#Screenshot-Tool" class="headerlink" title="Screenshot Tool"></a>Screenshot Tool</h3><p>屏幕截图工具，但是没有好用的编辑工具</p><p><img src="/images/2020/05/20200506010.png" alt></p><h2 id="T"><a href="#T" class="headerlink" title="T"></a>T</h2><h3 id="Top-Panel-Workspace-Scroll"><a href="#Top-Panel-Workspace-Scroll" class="headerlink" title="Top Panel Workspace Scroll"></a>Top Panel Workspace Scroll</h3><p>自从开始使用 Linux 以来，我发现这套桌面的最佳特性就是能够提供高效的工作区。过去我们能够快速在不同工作区间往来切换，但如今的新版本却放弃了这一重要特性。好在 Top Panel Workspace Scroll 能够帮助我们重拾这一功能，通过鼠标滚轮或者触摸板双指操作完成工作区切换。</p><h3 id="Todo-txt"><a href="#Todo-txt" class="headerlink" title="Todo.txt"></a>Todo.txt</h3><p>GTD应用，顶栏显示比较醒目</p><p><img src="/images/2020/05/20200506008.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>番茄工作法</title>
      <link href="/2018/04/22/%E7%95%AA%E8%8C%84%E5%B7%A5%E4%BD%9C%E6%B3%95/"/>
      <url>/2018/04/22/%E7%95%AA%E8%8C%84%E5%B7%A5%E4%BD%9C%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>“番茄工作法”是一套简单易行的时间管理方法,用以提升你个人和所在团队的生产力,从而做到</p><ul><li>减轻时间焦虑</li><li>集中注意力,减少中断</li><li>增强决策意识</li><li>唤醒激励和持久激励</li><li>巩固达成目标的决心</li><li>精确地预估工作量</li><li>改进工作学习流程</li><li>强化决断力,快刀斩乱麻</li></ul><h1 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h1><h2 id="番茄钟"><a href="#番茄钟" class="headerlink" title="番茄钟"></a>番茄钟</h2><ul><li>厨房定时器,用来衡量25分钟的时间段,在这段时间内专注于一项工作</li><li>工作法的名称来自与发明人最初使用的番茄形状计时器,也可以用电脑或手机软件计时器代替</li></ul><h2 id="活动"><a href="#活动" class="headerlink" title="活动"></a>活动</h2><ul><li>要完成的工作任务</li><li>番茄工作法适用于多种类型的活动,从软件开发者到学童,无论是组织聚会,管理项目或按时完成作业均有效</li></ul><h2 id="内部中断"><a href="#内部中断" class="headerlink" title="内部中断"></a>内部中断</h2><p>番茄钟时间内,来自自身的干扰,想要离开座位拿点喝的,或用一分钟刷刷网页</p><h2 id="外部中断"><a href="#外部中断" class="headerlink" title="外部中断"></a>外部中断</h2><p>番茄时间内,在社交场合工作的人士会遇到,同学找你问作业,电脑提醒收到新邮件,即使消息等外界干扰</p><h2 id="预估"><a href="#预估" class="headerlink" title="预估"></a>预估</h2><ul><li>定性预估:预测某项目由哪些活动组成</li><li>定量预估:某活动需要多少番茄钟完成</li><li>通过长期实践番茄工作法努力减少预估误差</li></ul><h1 id="所需工具"><a href="#所需工具" class="headerlink" title="所需工具"></a>所需工具</h1><ul><li>番茄钟一枚</li><li>铅笔一支(最好带橡皮)</li><li>纸制表格三张(白纸即可,横格纸更好)<ul><li>“今日待办”表格</li><li>“活动清单”表格</li><li>记录表格</li></ul></li></ul><h1 id="基本方法"><a href="#基本方法" class="headerlink" title="基本方法"></a>基本方法</h1><h2 id="规划活动"><a href="#规划活动" class="headerlink" title="规划活动"></a>规划活动</h2><ul><li>将近期要完成的活动全部填入”活动清单”表格</li><li>每天早晨,从其中选出数项要在今天进行的活动,抄入”今日待办”表格</li></ul><h2 id="开始工作"><a href="#开始工作" class="headerlink" title="开始工作"></a>开始工作</h2><ul><li>在”今日待办”表格选择一项要完成的任务</li><li>启动番茄钟,时间设定为25分钟</li><li>开始工作,直到番茄钟响铃</li><li>在”今日待办”表格上标一个<code>x</code></li><li>休息片刻(3~5分钟)</li><li>开始下一个番茄钟,继续该任务,如此循环直到完成,在”今日待办”表格上划掉它</li><li>每四个番茄钟后,多休息一会(15~30分钟)</li></ul><h1 id="中断"><a href="#中断" class="headerlink" title="中断"></a>中断</h1><p>应用番茄工作法时,中断是难以避免的问题,如何处理中断?</p><h2 id="内部终端"><a href="#内部终端" class="headerlink" title="内部终端"></a>内部终端</h2><ul><li>应使这一类中断清晰可见,每次你想要做其他活动,在要记录当前番茄钟的<code>x</code>位置旁边画一个撇号<code>&#39;</code><ul><li>在”今日待办”表格的”计划外紧急”区域记下这项活动,今天完成</li><li>或在”活动清单”表格记下这项活动,改天完成(标<code>U</code>代表”计划外”,如需要还可写上最后期限)</li></ul></li><li>再接再厉完成当前番茄钟,直到番茄钟响铃</li></ul><h2 id="外部中断-1"><a href="#外部中断-1" class="headerlink" title="外部中断"></a>外部中断</h2><ul><li>应使这一类中断清晰可见,每次有人打断你的工作,在要记录当前番茄钟的<code>x</code>位置旁边画一个减号<code>-</code></li><li>采取<code>告知-协商-回电</code>策略与中断者进行沟通</li><li>与前述内部中断相同的步骤,记下相关活动,继续完成当前番茄钟</li><li>多数看似紧急的外部中断,其实可以推迟25分钟或2小时(4个番茄钟)再来处理</li><li>番茄钟期间,可以关闭电子邮件和即使通讯软件</li></ul><h1 id="规则和技巧"><a href="#规则和技巧" class="headerlink" title="规则和技巧"></a>规则和技巧</h1><ul><li>番茄钟不可分割</li><li>如果一项活动要花费5~7番茄钟,则应拆分为更小的活动</li><li>如果一项活动花费不足1番茄钟,则可与其他活动合并</li><li>一旦番茄钟启动,就必须走到响铃</li><li>下一个番茄钟会更好</li><li>番茄工作法不要用于假期和休息期间的活动,好好享受生活</li></ul>]]></content>
      
      
      <categories>
          
          <category> 未分类 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Java中的Lambda表达式(匿名内部类)</title>
      <link href="/2018/04/10/Java%E4%B8%AD%E7%9A%84Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/2018/04/10/Java%E4%B8%AD%E7%9A%84Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="演变过程"><a href="#演变过程" class="headerlink" title="演变过程"></a>演变过程</h1><h2 id="调用外部类"><a href="#调用外部类" class="headerlink" title="调用外部类"></a>调用外部类</h2><ol><li><p>外部类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Java中的Lambda表达式ckage com.zjinc36.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListenSong</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">System.out.println(<span class="string">"一边听歌"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>调用类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> ListenSong()).start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaDemoTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">LambdaDemo lambdaDemo = <span class="keyword">new</span> LambdaDemo();</span><br><span class="line">lambdaDemo.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="内部类"><a href="#内部类" class="headerlink" title="内部类"></a>内部类</h2><p>由于上述的类只使用一次,因此可以将外部类放在内部类内,如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaDemo</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListenSong</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">System.out.println(<span class="string">"一边听歌"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> ListenSong()).start();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="局部内部类"><a href="#局部内部类" class="headerlink" title="局部内部类"></a>局部内部类</h2><p>我们还可以将外部类放在内部类的某一方法内,这里我们放到run方法内,如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaDemo</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListenSong</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">System.out.println(<span class="string">"一边听歌"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> ListenSong()).start();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="匿名内部类"><a href="#匿名内部类" class="headerlink" title="匿名内部类"></a>匿名内部类</h2><p>继续简化,由于我们只是用一次类,那么就没有必要创建类<strong>(也就是说不需要类的名字)</strong>,故可以如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaDemo</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">System.out.println(<span class="string">"一边听歌"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;).start();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="jdk8进一步简化内部类-Lambda"><a href="#jdk8进一步简化内部类-Lambda" class="headerlink" title="jdk8进一步简化内部类(Lambda)"></a>jdk8进一步简化内部类(Lambda)</h1><h2 id="简化"><a href="#简化" class="headerlink" title="简化"></a>简化</h2><p>对于比较简单的逻辑,我们只需要关注传什么参数,实现什么东西就可以了,所以可以如下进一步简化(当然,这里要注意JDK的版本)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaDemo</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">new</span> Thread(()-&gt; &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">System.out.println(<span class="string">"一边听歌"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;).start();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="为什么能像上述那样进行简化"><a href="#为什么能像上述那样进行简化" class="headerlink" title="为什么能像上述那样进行简化"></a>为什么能像上述那样进行简化</h2><ol><li>其实,我们并不能在代码的任何地方任性的写Lambda表达式,事实上,能够使用Lambda的依据是必须有相应的函数接口,这一点也跟Java是强类型语言吻合</li><li>也就是说,实际上Lambda的类型就是对应函数接口的类型</li><li>更具体来说,只有上下文提供的信息足够编译器推导出参数表的类型才不需要显示指明</li></ol><h1 id="Lambda的使用"><a href="#Lambda的使用" class="headerlink" title="Lambda的使用"></a>Lambda的使用</h1><h2 id="Lambda表达式中传入参数"><a href="#Lambda表达式中传入参数" class="headerlink" title="Lambda表达式中传入参数"></a>Lambda表达式中传入参数</h2><p>从外部类到jdk8简化lambda已经推到完了,接下去,说明需要传入参数该怎么写(与上述推到代码无关,直接写Lambda表达式)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaDemo2</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">List&lt;String&gt; list = Arrays.asList(<span class="string">"i"</span>, <span class="string">"love"</span>, <span class="string">"you"</span>);</span><br><span class="line"></span><br><span class="line">Collections.sort(list, (s1, s2) -&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (s1 == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (s2 == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s1.length() - s2.length();</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="其他合法的写法"><a href="#其他合法的写法" class="headerlink" title="其他合法的写法"></a>其他合法的写法</h1><h2 id="省略花括号"><a href="#省略花括号" class="headerlink" title="省略花括号"></a>省略花括号</h2><ol><li><p>代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaDemo3</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 代码内容只有一行,可以省略花括号,并将所有内容写到同一行</span></span><br><span class="line">Runnable run = () -&gt; System.out.println(<span class="string">"Hello world"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Thread(run).start();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaDemo3Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">LambdaDemo3 lambdaDemo2 = <span class="keyword">new</span> LambdaDemo3();</span><br><span class="line">lambdaDemo2.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>注意,多行代码不能省略花括号</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Runnable multiLine = () -&gt; &#123;<span class="comment">// 3 代码块</span></span><br><span class="line">    System.out.print(<span class="string">"Hello"</span>);</span><br><span class="line">    System.out.println(<span class="string">" Hoolee"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="一个参数一行代码"><a href="#一个参数一行代码" class="headerlink" title="一个参数一行代码"></a>一个参数一行代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ActionListener listener = event -&gt; System.out.println(<span class="string">"button clicked"</span>);</span><br></pre></td></tr></table></figure><h2 id="有返回值"><a href="#有返回值" class="headerlink" title="有返回值"></a>有返回值</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BinaryOperator&lt;Long&gt; add = (Long x, Long y) -&gt; x + y;<span class="comment">// 4</span></span><br><span class="line"></span><br><span class="line">BinaryOperator&lt;Long&gt; addImplicit = (x, y) -&gt; x + y;<span class="comment">// 5 类型推断</span></span><br></pre></td></tr></table></figure><h1 id="自定义函数接口"><a href="#自定义函数接口" class="headerlink" title="自定义函数接口"></a>自定义函数接口</h1><h2 id="简单的使用"><a href="#简单的使用" class="headerlink" title="简单的使用"></a>简单的使用</h2><ol><li>自定义函数接口<br>自定义函数接口很容易，只需要编写一个只有一个抽象方法的接口即可<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义函数接口</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConsumerInterface</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>其中,<code>@FunctionalInterface</code>是可选的，但加上该标注编译器会帮你检查接口是否符合函数接口规范(就像加入@Override标注会检查是否重载了函数一样)</p><ol start="2"><li>使用<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConsumerInterface&lt;String&gt; consumer = str -&gt; System.out.println(str);</span><br></pre></td></tr></table></figure></li></ol><h2 id="还可以这样使用"><a href="#还可以这样使用" class="headerlink" title="还可以这样使用"></a>还可以这样使用</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStream</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line"><span class="keyword">private</span> List&lt;T&gt; list;</span><br><span class="line">    ...</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myForEach</span><span class="params">(ConsumerInterface&lt;T&gt; consumer)</span></span>&#123;<span class="comment">// 1</span></span><br><span class="line"><span class="keyword">for</span>(T t : list)&#123;</span><br><span class="line">consumer.accept(t);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyStream&lt;String&gt; stream = <span class="keyword">new</span> MyStream&lt;String&gt;();</span><br><span class="line">stream.myForEach(str -&gt; System.out.println(str));<span class="comment">// 使用自定义函数接口书写Lambda表达式</span></span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://objcoding.com/2019/03/04/lambda/#%E4%BD%BF%E7%94%A8collect%E7%94%9F%E6%88%90collection" target="_blank" rel="noopener">关于Java Lambda表达式看这一篇就够了</a><br><a href="https://www.bilibili.com/video/BV1ct411n7oG?p=203" target="_blank" rel="noopener">多线程_推导lambda_简化教程</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVM运行机制</title>
      <link href="/2018/03/11/JVM%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/"/>
      <url>/2018/03/11/JVM%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h1><ul><li>JVM启动流程</li><li>JVM基本结构</li><li>内存模型</li><li>编译和解释运行的概念</li></ul><h1 id="JVM启动流程"><a href="#JVM启动流程" class="headerlink" title="JVM启动流程"></a>JVM启动流程</h1><p><img src="/images/2020/03/20200310006.png" alt></p><h1 id="JVM基本结构"><a href="#JVM基本结构" class="headerlink" title="JVM基本结构"></a>JVM基本结构</h1><p><img src="/images/2020/03/20200310005.png" alt></p><h2 id="PC寄存器"><a href="#PC寄存器" class="headerlink" title="PC寄存器"></a>PC寄存器</h2><ul><li>每个线程拥有一个PC寄存器</li><li>在线程创建时创建</li><li>指向下一条指令的地址</li><li>执行本地方法时,PC的值为undefined</li></ul><h2 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h2><ul><li><p>保存装载的类型信息</p><ul><li>类型的常量池</li><li>字段,方法信息</li><li>方法字节码</li><li>(也不是绝对的,JDK6时,String等常量信息置于方法区,但JDK7时,已经移动到了堆,但一般意义上说,我们认为方法区就是保存类的元信息)</li></ul></li><li><p>通常和永久区域(Perm)关联在一起</p></li></ul><h2 id="Java堆"><a href="#Java堆" class="headerlink" title="Java堆"></a>Java堆</h2><ul><li>和程序开发密切相关</li><li>应用系统对象都保存在Java堆中</li><li>所有线程共享Java堆</li><li>对分代GC来说,堆也是分代</li><li>GC的主要工作区间</li><li>复制算法<br><img src="/images/2020/03/20200310007.png" alt></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>初识JVM</title>
      <link href="/2018/03/08/%E5%88%9D%E8%AF%86JVM/"/>
      <url>/2018/03/08/%E5%88%9D%E8%AF%86JVM/</url>
      
        <content type="html"><![CDATA[<h1 id="大纲"><a href="#大纲" class="headerlink" title="大纲"></a>大纲</h1><ul><li>JVM的概念</li><li>JVM发展历史</li><li>JVM种类</li><li>Java语言规范</li><li>JVM规范</li></ul><h1 id="JVM的概念"><a href="#JVM的概念" class="headerlink" title="JVM的概念"></a>JVM的概念</h1><ul><li><p>JVM是<code>Java Virtual Machine</code>的简称,意为Java虚拟机</p></li><li><p>虚拟机</p><ul><li>指通过软件模拟的具有完整硬件系统功能的,运行在一个完全隔离环境中的完整计算机系统</li></ul></li><li><p>有哪些虚拟机</p><ul><li>VMWare</li><li>Visual Box</li><li>JVM</li></ul></li><li><p>VMWare或者Visual Box都是使用软件模拟物理CPU的指令集</p></li><li><p>JVM使用软件模拟Java字节码的指令集</p></li></ul><h1 id="JVM发展历史"><a href="#JVM发展历史" class="headerlink" title="JVM发展历史"></a>JVM发展历史</h1><ul><li><p>1996年SUN JDK 1.0 Classic VM</p><ul><li>纯解释运行,使用外挂的JIT(及时编译),一旦开启JIT,则解释运行就不生效</li><li>由于是解释运行,速度是很慢的,所以Java也在一开始就让人留下了效率不高的印象</li></ul></li><li><p>1997年JDK 1.1发布</p><ul><li>AWT,抽象视窗工具组</li><li>内部类</li><li>JDBC,Java数据库连接</li><li>RMI,远程过程调用(远程方法调用)</li><li>反射</li></ul></li><li><p>1998年 JDK 1.2 Solaris Exact VM</p><ul><li>JIT解释器混合</li><li>Accurate Memonry Management 精确内存管理,数据类型命案</li><li>提升的GC性能</li><li>JDK 1.2开始,称为Java2,也是这个时代,将Java分成三个版本,即J2SE,J2EE,J2ME</li><li>加入Swing Collections</li></ul></li><li><p>2000年 JDK 1.3 HotSport作为默认虚拟机发布</p><ul><li>加入JavaSound(声音相关的API)</li></ul></li><li><p>2002年 JDK 1.4 Classic VM退出历史舞台</p><ul><li>Assert关键字</li><li>正则表达式</li><li>NIO(Non-blocking I/O，在Java领域，也称为New I/O，是一种同步非阻塞的I/O模型，也是I/O多路复用的基础)</li><li>IPV6</li><li>日志API</li><li>加密类库</li></ul></li><li><p>2004年 JDK1.5 即JDK5,J2SE 5, Java 5 (重要,对编程方式影响)</p><ul><li>泛型</li><li>注解</li><li>装箱</li><li>枚举</li><li>可变长参数</li><li>Foreach循环</li></ul></li><li><p>JDK1.6 JDK6</p><ul><li>脚本语言支持</li><li>JDBC4.0</li><li>Java编译即API(即允许在Java语言中调用编译器进行一些编译)</li></ul></li><li><p>2011年 JDK7</p><ul><li>规划很多,但是有很多项目完不成,而这些完不成的推迟到JDK8发布</li><li>G1,垃圾收集器</li><li>动态语言增强</li><li>64位系统中的压缩指针</li><li>NIO 2.0</li></ul></li><li><p>2014年 JDK8</p><ul><li>Lambda表达式</li><li>Java类型注解</li></ul></li></ul><h1 id="大事记"><a href="#大事记" class="headerlink" title="大事记"></a>大事记</h1><ul><li><p>使用最为广泛的JVM为HotSpot</p></li><li><p>HotSpot为Longview Technologies开发,被SUN收购</p></li><li><p>2006年 Java开源,并建立OpenJDK</p><ul><li>HotSpot成为Sun JDK和OpenJDK中所带的虚拟机</li></ul></li><li><p>2008年 Oracle收购BEA</p><ul><li>得到Jrockit VM</li></ul></li><li><p>2010年 Oracle收购Sun</p><ul><li>得到HotSpot</li></ul></li><li><p>Oracle宣布在JDK8时整合JRockit和Hotspot,优势互补</p><ul><li>在Hotspot基础上,移植Jrockit优秀特性</li></ul></li></ul><h1 id="JVM种类"><a href="#JVM种类" class="headerlink" title="JVM种类"></a>JVM种类</h1><ul><li><p>KVM</p><ul><li>SUN发布</li><li>IOS Android前,广泛用于手机系统</li></ul></li><li><p>CDC/CLDC HotSpot</p><ul><li>手机,电子书,PDA等设备上建立统一的Java编程接口</li><li>J2ME的重要组成部分</li></ul></li><li><p>Jrockit</p><ul><li>BEA</li></ul></li><li><p>IBM J9 VM</p><ul><li>IBM内部</li></ul></li><li><p>Apache Harmony</p><ul><li>兼容于JDK 1.5和JDK 1.6的Java程序运行平台</li><li>与Oracle关系恶劣,退出JCP,Java社区分裂</li><li>OpenJDK出现后,受到挑战,2011年退役</li><li>没有大规模商用经历</li><li>对Android的发展有积极作用</li></ul></li></ul><h1 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h1><ul><li><p>Java 语言规范</p><ul><li>语法</li><li>变量</li><li>类型</li><li>文法</li></ul></li><li><p>JVM规范</p><ul><li>Class文件类型</li><li>运行时数据</li><li>帧栈</li><li>虚拟机的启动</li><li>虚拟机的指令集</li></ul></li></ul><h1 id="Java语言规范"><a href="#Java语言规范" class="headerlink" title="Java语言规范"></a>Java语言规范</h1><h2 id="语法定义"><a href="#语法定义" class="headerlink" title="语法定义"></a>语法定义</h2><ul><li><p>IfThenStatement:</p><ul><li>if (Expression) Statement<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if (true) &#123;do sth;&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ArgumentList:   可变长参数</p><ul><li>Argument</li><li>ArgumentList, Argument<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(a, b, c, d);</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="词法结构"><a href="#词法结构" class="headerlink" title="词法结构"></a>词法结构</h2><h3 id="表示UTF-16"><a href="#表示UTF-16" class="headerlink" title="表示UTF-16"></a>表示UTF-16</h3><ul><li>用<code>\u + 4个16进制数字</code></li></ul><h3 id="行终结符"><a href="#行终结符" class="headerlink" title="行终结符"></a>行终结符</h3><ul><li>CR(换行)</li><li>or LF(回车)</li><li>or CR LF(换行+回车)</li></ul><h3 id="空白符"><a href="#空白符" class="headerlink" title="空白符"></a>空白符</h3><ul><li>空格</li><li>tab</li><li>\t</li><li>换页</li><li>\f</li><li>行终结符</li></ul><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><ul><li>单行注释</li><li>多行注释</li></ul><h3 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h3><h3 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h3><ul><li><p>什么是标识符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Identifier:(标识符)</span><br><span class="line">+   IdentifierChars but not a Keyword or BooleanLiteral or NullLiteral(标识符的串,不能是关键字或者布尔型或者Null)</span><br><span class="line"></span><br><span class="line">IdentifierChar:(标识符的串)</span><br><span class="line">+   JavaLetter(是Java的字符)</span><br><span class="line">+   IdentifierChars JavaLetterOrDigit</span><br><span class="line"></span><br><span class="line">JavaLetter:(Java的字符)</span><br><span class="line">+   any Unicode character that is a Java letter (任何一个Unicode就是Java的字符)</span><br><span class="line"></span><br><span class="line">JavaLetterOrDigit:</span><br><span class="line">+   any Unicode character that is a Java letter-or-digit(see below)</span><br></pre></td></tr></table></figure></li><li><p>举例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标识符其实是任何一个Unicode,那么方法名即使是中文也是能够运行的</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> 打印() &#123;</span><br><span class="line">    System.out.println(<span class="string">"方法名是中文"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    打印();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h3><ul><li>+= -= <code>*=</code> /= &amp;= |= ^= %= &lt;&lt;= &gt;&gt;= &gt;&gt;&gt;=</li></ul><h3 id="数字表示"><a href="#数字表示" class="headerlink" title="数字表示"></a>数字表示</h3><ul><li><p>Int</p><ul><li>02 0372 <code>0xDada_Cafe</code> 1996 <code>0x00_FF__00_FF</code></li><li>对Int在JDK7中一个比较大的增强是允许使用下划线去分割数字,好处就是当数字非常长的时候,会看的比较清楚一些</li></ul></li><li><p>Long</p><ul><li>0l 0777L 0x100000000L <code>2_147_483_648L</code> 0xC0B0L</li></ul></li><li><p>Float(单精度浮点)</p><ul><li>1e1f 2.f .3f 0f 3.14f 6.022137e+23f</li></ul></li><li><p>Double(双精度浮点)</p><ul><li>1e1 2. .3 0.0 3.14 1e-9d 1e137</li></ul></li><li><p>判断以下哪些是合法的,哪些是非法的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> a=<span class="number">0xDada_Cafe</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> b=<span class="number">0x1</span>.fffffeP+<span class="number">127f</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> c=<span class="number">1996</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> d=<span class="number">1996.3</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> f=<span class="number">9999e2</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">double</span> g=<span class="number">33e2</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> h=<span class="number">0x1</span>.fffep-<span class="number">12f</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> i=<span class="number">1</span>.fffep-<span class="number">12f</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> p=<span class="number">0b1_1_1_0_1</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">long</span> q=<span class="number">0b1_1_1_0</span>_2;</span><br></pre></td></tr></table></figure></li></ul><h2 id="类型和变量"><a href="#类型和变量" class="headerlink" title="类型和变量"></a>类型和变量</h2><h3 id="元类型"><a href="#元类型" class="headerlink" title="元类型"></a>元类型</h3><ul><li>byte short int long float char</li><li>从元类型可以看出,当我们说Java是一门纯粹的面向对象语言并不是十分正确,因为这些元类型并不属于对象,并且实现也是和对象完全不一样的</li><li>用以下例子来说明<strong>元数据类型和对象在Java里处理的差异</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Value</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span> <span class="params">(String[]i args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i1 = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">int</span> i2 = i1;</span><br><span class="line">        i2 = <span class="number">4</span>;</span><br><span class="line">        System.out.println(<span class="string">"i1 == "</span> + i1);</span><br><span class="line">        System.out.println(<span class="string">"but i2 == "</span> + i2);</span><br><span class="line"></span><br><span class="line">        Value v1 = <span class="keyword">new</span> Value();</span><br><span class="line">        v1.val = <span class="number">5</span>;</span><br><span class="line">        Value v2 = v1;</span><br><span class="line">        v2.val = <span class="number">6</span>;</span><br><span class="line">        System.out.println(<span class="string">"v1.val == "</span> + v1.val);</span><br><span class="line">        System.out.println(<span class="string">" and v2.val == "</span> + v2.val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果</span></span><br><span class="line">i1 == <span class="number">3</span> but i2 == <span class="number">4</span></span><br><span class="line">v1.val == <span class="number">6</span> and v2.val == <span class="number">6</span></span><br><span class="line"><span class="comment">// 结论</span></span><br><span class="line">i1,i2为不同的变量</span><br><span class="line">v1,v2为引用同一个实例</span><br></pre></td></tr></table></figure></li></ul><h3 id="变量初始值"><a href="#变量初始值" class="headerlink" title="变量初始值"></a>变量初始值</h3><ul><li>boolean false</li><li>char \u0000</li></ul><h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><h2 id="Java内存模型"><a href="#Java内存模型" class="headerlink" title="Java内存模型"></a>Java内存模型</h2><h2 id="类加载链接的过程"><a href="#类加载链接的过程" class="headerlink" title="类加载链接的过程"></a>类加载链接的过程</h2><h2 id="public-static-final-abstract的定义"><a href="#public-static-final-abstract的定义" class="headerlink" title="public static final abstract的定义"></a><code>public static final abstract</code>的定义</h2><h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><h2 id="数组的使用"><a href="#数组的使用" class="headerlink" title="数组的使用"></a>数组的使用</h2><h1 id="初识JVM-JVM语言规范"><a href="#初识JVM-JVM语言规范" class="headerlink" title="初识JVM - JVM语言规范"></a>初识JVM - JVM语言规范</h1><ul><li>Java语言规范定义了什么是Java语言,JVM规范定义了什么是Java虚拟机</li><li>Java语言和JVM(Java虚拟机)是相对独立,也就是说你的任何语言只要满足JVM规范就能在JVM中运行(如下几种语言)<ul><li>Groovy</li><li>Clojure</li><li>Scala</li></ul></li><li>JVM主要定义了JVM的内部实现,比如<ul><li>Class文件格式</li><li>数字的内部表示和存储:Byte -128 to 127 (-2^7 to 2^7 -1)</li><li>returnAddress 数据类型定义:指向操作码的指针.不对应Java数据类型,不能在运行时候修改.Finally实现需要</li><li>定义PC(<a href="https://zh.wikipedia.org/wiki/%E7%A8%8B%E5%BC%8F%E8%A8%88%E6%95%B8%E5%99%A8" target="_blank" rel="noopener">程序计数器</a>)</li><li>堆</li><li>栈</li><li>方法区</li></ul></li></ul><h2 id="整数与浮点数"><a href="#整数与浮点数" class="headerlink" title="整数与浮点数"></a>整数与浮点数</h2><blockquote><ul><li><a href="http://www.360doc.com/content/11/0308/14/5327079_99222581.shtml" target="_blank" rel="noopener">进制转换</a></li><li><a href="https://blog.csdn.net/liao20081228/article/details/80342215" target="_blank" rel="noopener">计算机中的整数与浮点数</a></li></ul></blockquote><h3 id="整数的表达"><a href="#整数的表达" class="headerlink" title="整数的表达"></a>整数的表达</h3><h4 id="正数补码"><a href="#正数补码" class="headerlink" title="正数补码"></a>正数补码</h4><ul><li>和原码相同</li></ul><h4 id="负数补码"><a href="#负数补码" class="headerlink" title="负数补码"></a>负数补码</h4><ul><li><p>原码<br>第一位为符号位(0为正数,1为负数)</p></li><li><p>反码<br>符号位不动,原码取反</p></li><li><p>负数补码<br>符号位不动,反码加1</p></li><li><p>十进制数字用原码,反码,补码表示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// 十进制</span><br><span class="line">5</span><br><span class="line">// 二进制</span><br><span class="line">0000 0101</span><br><span class="line"></span><br><span class="line">----------------------------</span><br><span class="line"></span><br><span class="line">// 十进制</span><br><span class="line">-6</span><br><span class="line">// 二进制</span><br><span class="line">原码:1000 0110</span><br><span class="line">反码:1111 1001</span><br><span class="line">补码:1111 1010</span><br><span class="line"></span><br><span class="line">---------------------------</span><br><span class="line"></span><br><span class="line">// 十进制</span><br><span class="line">-1</span><br><span class="line">// 二进制</span><br><span class="line">原码:1000 0001</span><br><span class="line">反码:1111 1110</span><br><span class="line">补码:1111 1111</span><br></pre></td></tr></table></figure></li><li><p>打印整数的二进制表示</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里打印6的二进制数</span></span><br><span class="line"><span class="keyword">int</span> a = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">32</span>; i++) &#123;  <span class="comment">// 整数有32位,所以要做32次循环</span></span><br><span class="line">    <span class="comment">// 0x80000000 表示最高位为1的数字</span></span><br><span class="line">    <span class="keyword">int</span> t = (a &amp; <span class="number">0x80000000</span> &gt;&gt;&gt; i) &gt;&gt;&gt; (<span class="number">31</span> - i);</span><br><span class="line">    System.out.print(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">说明:</span><br><span class="line">+   <span class="number">0x80000000</span>是数的十六进制表示，转成二进制表示为<span class="number">10000000000000000000000000000000</span></span><br><span class="line">+   运算的优先级，移位运算高于逻辑运算，&gt;&gt;&gt; 高于 &amp;</span><br><span class="line">+   位逻辑与运算 <span class="number">1</span>&amp;<span class="number">1</span> = <span class="number">1</span> ，<span class="number">0</span>&amp;<span class="number">1</span> = <span class="number">0</span></span><br><span class="line">+   &gt;&gt;&gt;无符号右移，移出部分舍弃，左边位补<span class="number">0</span>；</span><br><span class="line">+   &gt;&gt;有符号、&gt;&gt;&gt;无符号看的就是二进制的符号位，无符号:就不管符号位，右移只填充<span class="number">0</span>；有符号，就是符号位是啥，我就填充啥</span><br></pre></td></tr></table></figure></li></ul><h4 id="为什么要用补码"><a href="#为什么要用补码" class="headerlink" title="为什么要用补码"></a>为什么要用补码</h4><ol><li>为了统一<code>+0</code>和<code>-0</code></li><li>为了将减法转换成加法</li></ol><p><strong>1.统一<code>+0</code>和<code>-0</code></strong></p><ul><li><p>用原码表示0,则0会出现两个数字</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0</span><br><span class="line"></span><br><span class="line">原码正数0:0000 0000</span><br><span class="line">原码负数0:1000 0000</span><br></pre></td></tr></table></figure></li><li><p>用补码表示,则不管是<code>+0</code>还是<code>-0</code>,表现是唯一的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// +0的补码</span><br><span class="line">补码:0000 0000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// -0的补码</span><br><span class="line">原码:1000 0000</span><br><span class="line">反码:1111 1111</span><br><span class="line">补码:0000 0000</span><br></pre></td></tr></table></figure></li></ul><p><strong>2.使用补码计算加法,可以不用考虑符号位(符号位参与运算),直接加就行</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-6 + 5</span><br><span class="line"></span><br><span class="line"> 1111 1010</span><br><span class="line">+0000 0101</span><br><span class="line">=1111 1111</span><br><span class="line"></span><br><span class="line">-----------------------</span><br><span class="line"></span><br><span class="line">-4 + 5</span><br><span class="line"></span><br><span class="line"> 1111 1100</span><br><span class="line">+0000 0101</span><br><span class="line">=0000 0001</span><br><span class="line"></span><br><span class="line">------------------------</span><br><span class="line"></span><br><span class="line">-3 + 5</span><br><span class="line"> 1111 1101</span><br><span class="line">+0000 0101</span><br><span class="line">=0000 0010</span><br></pre></td></tr></table></figure><h3 id="Float的表示与定义"><a href="#Float的表示与定义" class="headerlink" title="Float的表示与定义"></a>Float的表示与定义</h3><p>浮点数在计算机中不是以二进制原码来表示，而是用二进制科学计数法表示</p><ul><li>JVM的浮点数支持<code>IEEE 754</code>标准</li></ul><h2 id="一些特殊的方法"><a href="#一些特殊的方法" class="headerlink" title="一些特殊的方法"></a>一些特殊的方法</h2><ul><li><code>&lt;clinit&gt;</code></li><li><code>&lt;init&gt;</code><ul><li>写java时,没有声明类的构造函数时,虚拟机会帮你插入无参的构造方法</li></ul></li></ul><h2 id="VM指令集"><a href="#VM指令集" class="headerlink" title="VM指令集"></a>VM指令集</h2><ul><li><p>类型转化</p><ul><li>l2i:从长整型转整型用这个指令</li></ul></li><li><p>出栈入栈操作</p><ul><li>aload astore</li><li>jvm没有集成器传值的过程,全部都是用栈来操作的,因此jvm有一系列的栈操作指令</li></ul></li><li><p>运算</p><ul><li>iadd isub</li></ul></li><li><p>流程控制</p><ul><li>ifeq ifne</li></ul></li><li><p>函数调用</p><ul><li>invokevirtual invokeinterface invokespecial invokestatic</li></ul></li></ul><h2 id="JVM需要对以下Java-Library提供支持"><a href="#JVM需要对以下Java-Library提供支持" class="headerlink" title="JVM需要对以下Java Library提供支持"></a>JVM需要对以下Java Library提供支持</h2><p>jvm还规定需要对以下java库提供支持,因为这些功能没办法通过java语言本身来实现</p><ul><li>反射<code>java.lang.reflect</code></li><li>ClassLoader<ul><li>虽然在java语言中暴露了一些类装载器,但最重要的一个类装载器<code>启动ClassLoader</code>是在jvm层中实现的</li></ul></li><li>初始化class和interface</li><li>安全相关<code>java.security</code></li><li>多线程</li><li>弱引用</li></ul><h2 id="JVM的编译"><a href="#JVM的编译" class="headerlink" title="JVM的编译"></a>JVM的编译</h2><ul><li><p>源码到JVM指令的对应格式</p></li><li><p>Javap</p></li><li><p>JVM反汇编的格式</p><ul><li><p><code>&lt;index&gt;&lt;opcode&gt;[&lt;operand1&gt;[&lt;operand2&gt;...]][&lt;comment&gt;]</code></p></li><li><p>索引    操作码  若干个操作数                注释</p></li><li><p>一段简单的代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一段简单的java代码</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i&lt;<span class="number">100</span>; i++) &#123;</span><br><span class="line">        <span class="comment">// Loop body is empty</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>编译</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0 iconst_0      // push int constant 0</span><br><span class="line">1 istore_1      // store into local variable 1 (i=0)</span><br><span class="line">2 goto 8        // First time through don&apos;t increment</span><br><span class="line">5 iinc 1 1      // increment local variable 1 by (i++)</span><br><span class="line">8 iload_1       // push local variable 1 (i)</span><br><span class="line">9 bipush 100    // push int constant 100</span><br><span class="line">11 if_icmplt 5  // compare and loop if less than (i&lt;100)</span><br><span class="line">14 return       // return void when done</span><br></pre></td></tr></table></figure></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式之外观模式</title>
      <link href="/2018/02/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/"/>
      <url>/2018/02/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h1><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://design-patterns.readthedocs.io/zh_CN/latest/structural_patterns/facade.html#" target="_blank" rel="noopener">外观模式</a></li><li><a href="https://www.jianshu.com/p/1b027d9fc005" target="_blank" rel="noopener">外观模式（Facade Pattern） - 最易懂的设计模式解析</a></li></ul><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><blockquote><ol><li>通过创建一个统一的外观类，用来包装子系统中一个 / 多个复杂的类，客户端可通过调用外观类的方法来调用内部子系统中所有方法</li><li>引入外观角色之后，用户只需要与外观角色交互</li><li>用户与子系统之间的复杂逻辑关系由外观角色来实现</li></ol></blockquote><ul><li>定义了一个高层、统一的接口，外部与通过这个统一的接口对子系统中的一群接口进行访问,提高了客户端使用的便捷性，使得客户端无须关心子系统的工作细节，通过外观角色即可调用相关功能。</li><li>避免了系统与系统之间的高耦合度,实现客户类与子系统类的松耦合</li><li>使得复杂的子系统用法变得简单,降低原有系统的复杂度</li></ul><h2 id="UML图"><a href="#UML图" class="headerlink" title="UML图"></a>UML图</h2><p><img src="/images/2020/02/20200226003.png" alt></p><ul><li>Facade: 外观角色</li><li>SubSystem:子系统角色</li></ul><h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><ol><li><p>创建子系统角色A</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子系统角色A</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">SystemA</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationA</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建子系统角色B</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子系统角色B</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">SystemB</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationB</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建子系统角色C</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子系统角色C</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">SystemC</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationC</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建外观角色</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 外观角色</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">Facade</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 这一部分代码是调用子系统的代码,不一定这样写,像Spring里可以用自动载入"@Autowried"等注释进行注入,辨证的看就好</span></span><br><span class="line"><span class="keyword">private</span> SystemA systemA;</span><br><span class="line"><span class="keyword">private</span> SystemB systemB;</span><br><span class="line"><span class="keyword">private</span> SystemC systemC;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Facade</span> <span class="params">(SystemA systemA, SystemB systemB, SystemC systemC)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.systemA = systemA;</span><br><span class="line"><span class="keyword">this</span>.systemB = systemB;</span><br><span class="line"><span class="keyword">this</span>.systemC = systemC;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 包裹操作</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">wrapOpration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">systemA.operationA();</span><br><span class="line">systemB.operationB();</span><br><span class="line">systemC.operationC();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1.实例化子系统(方法不唯一)</span></span><br><span class="line">SystemA systemA = <span class="keyword">new</span> SystemA();</span><br><span class="line">SystemB systemB = <span class="keyword">new</span> SystemB();</span><br><span class="line">SystemC systemC = <span class="keyword">new</span> SystemC();</span><br><span class="line"><span class="comment">// 2.创建外观角色</span></span><br><span class="line">Facade facade = <span class="keyword">new</span> Facade(systemA, systemB, systemC);</span><br><span class="line"><span class="comment">// 3.调用操作</span></span><br><span class="line">facade.wrapOpration();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="优点和缺点"><a href="#优点和缺点" class="headerlink" title="优点和缺点"></a>优点和缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul><li>对客户屏蔽子系统组件，减少了客户处理的对象数目并使得子系统使用起来更加容易。通过引入外观模式，客户代码将变得很简单，与之关联的对象也很少。</li><li>实现了子系统与客户之间的松耦合关系，这使得子系统的组件变化不会影响到调用它的客户类，只需要调整外观类即可。</li><li>降低了大型软件系统中的编译依赖性，并简化了系统在不同平台之间的移植过程，因为编译一个子系统一般不需要编译所有其他的子系统。一个子系统的修改对其他子系统没有任何影响，而且子系统内部变化也不会影响到外观对象。</li><li>只是提供了一个访问子系统的统一入口，并不影响用户直接使用子系统类。</li></ul><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul><li>不能很好地限制客户使用子系统类，如果对客户访问子系统类做太多的限制则减少了可变性和灵活性。</li><li>在不引入抽象外观类的情况下，增加新的子系统可能需要修改外观类或客户端的源代码，违背了“开闭原则”。</li></ul><h2 id="适用环境"><a href="#适用环境" class="headerlink" title="适用环境"></a>适用环境</h2><ul><li>当要为一个复杂子系统提供一个简单接口时可以使用外观模式。该接口可以满足大多数用户的需求，而且用户也可以越过外观类直接访问子系统。</li><li>客户程序与多个子系统之间存在很大的依赖性。引入外观类将子系统与客户以及其他子系统解耦，可以提高子系统的独立性和可移植性。</li><li>在层次化结构中，可以使用外观模式定义系统中每一层的入口，层与层之间不直接产生联系，而通过外观类建立联系，降低层之间的耦合度。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式之装饰者模式</title>
      <link href="/2018/02/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2018/02/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="装饰者模式"><a href="#装饰者模式" class="headerlink" title="装饰者模式"></a>装饰者模式</h1><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://design-patterns.readthedocs.io/zh_CN/latest/structural_patterns/decorator.html" target="_blank" rel="noopener">装饰模式</a></li><li><a href="https://blog.csdn.net/a553181867/article/details/52108423" target="_blank" rel="noopener">学习、探究Java设计模式——装饰者模式</a></li><li><a href="https://www.jianshu.com/p/c26b9b4a9d9e" target="_blank" rel="noopener">Java设计模式之装饰者模式(Decorator pattern)</a></li><li><a href="https://blog.csdn.net/u013309870/article/details/53066694" target="_blank" rel="noopener">装饰者模式（decorator）完全解析</a></li></ul><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>给一个类或对象增加行为</p><h2 id="模式动机"><a href="#模式动机" class="headerlink" title="模式动机"></a>模式动机</h2><p>一般有两种方式可以实现给一个类或对象增加行为：</p><ul><li>继承机制，使用继承机制是给现有类添加功能的一种有效途径，通过继承一个现有类可以使得子类在拥有自身方法的同时还拥有父类的方法。但是这种方法是静态的，用户不能控制增加行为的方式和时机。</li><li>关联机制，即将一个类的对象嵌入另一个对象中，由另一个对象来决定是否调用嵌入对象的行为以便扩展自己的行为，我们称这个嵌入的对象为装饰器(Decorator)<br>装饰模式以对客户透明的方式动态地给一个对象附加上更多的责任，换言之，客户端并不会觉得对象在装饰前和装饰后有什么不同。装饰模式可以在不需要创造更多子类的情况下，将对象的功能加以扩展。这就是装饰模式的模式动机。</li></ul><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><ul><li>在不改变原类文件以及不使用继承的情况下，动态地将额外的职责(Responsibility)附加到对象上，从而实现动态拓展一个对象的功能。</li><li>它是通过创建一个包装对象，也就是装饰来包裹真实的对象。</li><li>其别名也可以称为包装器(Wrapper)，与适配器模式的别名相同，但它们适用于不同的场合。</li><li>根据翻译的不同，装饰模式也有人称之为“油漆工模式”，它是一种对象结构型模式。</li></ul><h2 id="UML图"><a href="#UML图" class="headerlink" title="UML图"></a>UML图</h2><p><img src="/images/2020/02/20200226002.png" alt></p><ul><li>Component: 抽象构件</li><li>ConcreteComponent: 具体构件</li><li>Decorator: 抽象装饰类</li><li>ConcreteDecorator: 具体装饰类</li></ul><h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><ol><li><p>创建抽象构件<br>用以保证装饰类和被装饰类都有一个相同的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> class <span class="title">Component</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建具体构建(被装饰类)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> class ConcreteComponent extends <span class="title">Component</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// do something ...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建抽象装饰类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> class Decorator extends <span class="title">Component</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Component component;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Decorator</span> <span class="params">(Component component)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.component = component;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建具体装饰类A</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> class ConcreteDecoratorA extends <span class="title">Decorator</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcreteDecoratorA</span> <span class="params">(Component component)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(component);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// do something ...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建具体装饰类B</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> class ConcreteDecoratorB extends <span class="title">Decorator</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcreteComponentB</span> <span class="params">(Component component)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(component);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// do something ...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1. 被装饰类</span></span><br><span class="line">ConcreteComponent concreteComponent = <span class="keyword">new</span> ConcreteComponent();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体进行装饰写法</span></span><br><span class="line"><span class="comment">// 2. 具体装饰类A</span></span><br><span class="line">Decorator decorator = <span class="keyword">new</span> ConcreteDecoratorA(concreteComponent);</span><br><span class="line">decorator.operation();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 具体装饰类A + B</span></span><br><span class="line">decorator = <span class="keyword">new</span> ConcreteDecoratorB(<span class="keyword">new</span> ConcreteDecoratorA(concreteComponent));</span><br><span class="line">decorator.operation();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="实例讲解"><a href="#实例讲解" class="headerlink" title="实例讲解"></a>实例讲解</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><ul><li>你有一家服装店，卖各式各样的衣服，现在需要用一个系统来记录客户所要购买的衣服的总价，以便方便地结算。那么在这个例子里面，我们可以用装饰者模式，把客户当做被装饰者，衣服是装饰者，这很直观形象，接着我们来一步步实现需求。</li><li>也就是说”用衣服装饰人”或者”将衣服穿在人身上”</li></ul><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><ol><li><p>创建抽象构件<br>用以保证装饰类和被装饰类都有一个相同的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里我们可以将"人"抽象出来,这个"人"是对裸体的人,有穿衣服的人,戴首饰的人等的抽象</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> class <span class="title">Person</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建具体构建(被装饰类)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 被装饰类表示的是一个全裸的人</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class NakedPerson extends <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">"一丝不挂"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建抽象装饰类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象装饰类表示的是人身上的衣物</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> class DressedPerson extends <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Person person;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Decorator</span> <span class="params">(Person person)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.person = person;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建具体装饰类A</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> class DressedCoatPerson extends <span class="title">DressedPerson</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DressedCoatPerson</span> <span class="params">(Person person)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(person);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> person.show + <span class="string">"穿上衣"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建具体装饰类B</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> class DressedPantsPerson extends <span class="title">DressedPerson</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DressedPantsPerson</span> <span class="params">(Person person)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(person);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> person.show + <span class="string">"穿裤子"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 1. 被装饰类</span></span><br><span class="line"><span class="comment">//-&gt; 一丝不挂的人</span></span><br><span class="line">NakedPerson nakedPerson = <span class="keyword">new</span> NakedPerson();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体进行装饰写法</span></span><br><span class="line"><span class="comment">// 2. 具体装饰类A</span></span><br><span class="line"><span class="comment">// -&gt; 穿上衣</span></span><br><span class="line">DressedPerson dressedPerson = <span class="keyword">new</span> DressedCoatPerson(nakedPerson);</span><br><span class="line">system.out.println(decorator.show());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 具体装饰类A + B</span></span><br><span class="line"><span class="comment">// -&gt; 穿上衣 + 穿裤子</span></span><br><span class="line">decorator = <span class="keyword">new</span> DressedPantsPerson(<span class="keyword">new</span> DressedCoatPerson(nakedPerson));</span><br><span class="line">system.out.println(decorator.show());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="适用环境"><a href="#适用环境" class="headerlink" title="适用环境"></a>适用环境</h2><p>在以下情况下可以使用装饰模式：</p><ul><li>在不影响其他对象的情况下，以动态、透明的方式给单个对象添加职责</li><li>需要动态地给一个对象增加功能，这些功能也可以动态地被撤销<br>当不能采用继承的方式对系统进行扩充或者采用继承不利于系统扩展和维护时。不能采用继承的情况主要有两类</li><li>第一类是系统中存在大量独立的扩展，为支持每一种组合将产生大量的子类，使得子类数目呈爆炸性增长</li><li>第二类是因为类定义不能继承（如final类）.</li></ul><h2 id="要注意的问题"><a href="#要注意的问题" class="headerlink" title="要注意的问题"></a>要注意的问题</h2><p>装饰模式的简化-需要注意的问题:</p><ul><li>一个装饰类的接口必须与被装饰类的接口保持相同，对于客户端来说无论是装饰之前的对象还是装饰之后的对象都可以一致对待</li><li>尽量保持具体构件类Component作为一个“轻”类，也就是说不要把太多的逻辑和状态放在具体构件类中</li><li>如果只有一个具体构件类而没有抽象构件类，那么抽象装饰类可以作为具体构件类的直接子类</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式之桥接模式</title>
      <link href="/2018/02/26/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/"/>
      <url>/2018/02/26/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h1><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://design-patterns.readthedocs.io/zh_CN/latest/structural_patterns/bridge.html" target="_blank" rel="noopener">桥接模式</a></li><li><a href="https://blog.csdn.net/shaopeng5211/article/details/8827507" target="_blank" rel="noopener">Java设计模式之十五（桥接模式）</a></li></ul><h2 id="UML图"><a href="#UML图" class="headerlink" title="UML图"></a>UML图</h2><p><img src="/images/2020/02/20200225007.png" alt></p><ul><li>Client:Bridge模式的使用者</li><li>Abstraction:抽象类接口（接口或抽象类）,维护对行为实现（Implementor）的引用</li><li>Refined Abstraction:Abstraction子类,具体抽象类</li><li>Implementor:行为实现类接口 (Abstraction接口定义了基于Implementor接口的更高层次的操作)</li><li>ConcreteImplementor:Implementor子类</li></ul><h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><ol><li><p>创建抽象类Abstraction</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象类</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> class <span class="title">Abstraction</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">private</span> Implementor <span class="title">pImp</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Implementor <span class="title">getPImp</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> pImp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPImp</span><span class="params">(Implementor implementor)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.pImp = implementor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Abstraction</span><span class="params">(Implementor implementor)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.pImp = implementor;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建具体抽象类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体抽象类</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> class RefinedAbstraction extends <span class="title">Abstraction</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.getPImp().operationImp();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">RefinedAbstraction</span><span class="params">(Implementor implementor)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(pImp);<span class="comment">// 调用父类的构造方法</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建实现类接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现类接口</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> interface <span class="title">Implementor</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 操作实施者</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationImp</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建具体实现类A</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体实施者A</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class ConcreteImplementorA implement <span class="title">Implementor</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationImp</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// do something ...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建具体实现类B</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体实施者B</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class ConcreteImplementorB <span class="title">implement</span> <span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operationImp</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// do something ...</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Client调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Implementor concreteImplementorA = <span class="keyword">new</span> ConcreteImplementorA();</span><br><span class="line">Implementor concreteImplementorB = <span class="keyword">new</span> ConcreteImplementorB();</span><br><span class="line"></span><br><span class="line">Abstraction refinedAbstraction = <span class="keyword">new</span> RefinedAbstraction(concreteImplementorA);</span><br><span class="line">refinedAbstraction.operation();</span><br><span class="line"></span><br><span class="line">Abstraction refinedAbstraction = <span class="keyword">new</span> RefinedAbstraction(concreteImplementorB);</span><br><span class="line">refinedAbstraction.operation();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><ol><li><p>创建抽象类Abstraction</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象类</span></span><br><span class="line"><span class="comment">// Car是对车进行抽象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Engine engine;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Engine <span class="title">getEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> engine;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEngine</span><span class="params">(Engine engine)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.engine = engine;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构造方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(Engine engine)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.engine = engine;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 操作</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">runEngine</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建具体抽象类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体抽象类</span></span><br><span class="line"><span class="comment">// Bus是对巴士进行抽象,即也是抽象,但同时是Car的一部分,比Car具体一点</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bus</span> <span class="keyword">extends</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Bus</span><span class="params">(Engine engine)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(engine);<span class="comment">// 调用父类的构造方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.print(<span class="string">"Bus"</span>);</span><br><span class="line"><span class="keyword">this</span>.getEngine().installEngine();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建实现类接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现类接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Engine</span> </span>&#123;</span><br><span class="line"><span class="comment">// 操作实施者</span></span><br><span class="line"><span class="comment">// 安装发动引擎</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">installEngine</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建具体实现类A</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体实施者A</span></span><br><span class="line"><span class="comment">// 引擎2200</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Engine2200</span> <span class="keyword">implements</span> <span class="title">Engine</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">installEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"安装2200CC发动引擎"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建具体实现类B</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体实施者B</span></span><br><span class="line"><span class="comment">// 引擎2000</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Engine2000</span> <span class="keyword">implements</span> <span class="title">Engine</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">installEngine</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"安装2000CC发动引擎"</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Client调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainClass</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">Engine engine2000 = <span class="keyword">new</span> Engine2000();</span><br><span class="line">Engine engine2200 = <span class="keyword">new</span> Engine2200();</span><br><span class="line"></span><br><span class="line">Car bus = <span class="keyword">new</span> Bus(engine2000);</span><br><span class="line">bus.installEngine();</span><br><span class="line"></span><br><span class="line">Car jeep = <span class="keyword">new</span> Jeep(engine2200);</span><br><span class="line">jeep.installEngine();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="优点和缺点"><a href="#优点和缺点" class="headerlink" title="优点和缺点"></a>优点和缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul><li>分离抽象接口及其实现部分。</li><li><strong>桥接模式有时类似于多继承方案，但是多继承方案违背了类的单一职责原则</strong>（即一个类只有一个变化的原因），复用性比较差，而且多继承结构中类的个数非常庞大，桥接模式是比多继承方案更好的解决方法。</li><li>桥接模式提高了系统的可扩充性，在两个变化维度中任意扩展一个维度，都不需要修改原有系统。</li><li>实现细节对客户透明，可以对用户隐藏实现细节。</li></ul><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul><li>桥接模式的引入会增加系统的理解与设计难度，由于聚合关联关系建立在抽象层，要求开发者针对抽象进行设计与编程。</li><li>桥接模式要求正确识别出系统中两个独立变化的维度，因此其使用范围具有一定的局限性。</li></ul><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul><li>如果一个系统需要在构件的抽象化角色和具体化角色之间增加更多的灵活性，避免在两个层次之间建立静态的继承联系，通过桥接模式可以使它们在抽象层建立一个关联关系。</li><li>抽象化角色和实现化角色可以以继承的方式独立扩展而互不影响，在程序运行时可以动态将一个抽象化子类的对象和一个实现化子类的对象进行组合，即系统需要对抽象化角色和实现化角色进行动态耦合。</li><li>一个类存在两个独立变化的维度，且这两个维度都需要进行扩展。</li><li>虽然在系统中使用继承是没有问题的，但是由于抽象化角色和具体化角色需要独立变化，设计要求需要独立管理这两者。</li><li>对于那些不希望使用继承或因为多层次继承导致系统类的个数急剧增加的系统，桥接模式尤为适用。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式之适配器模式</title>
      <link href="/2018/02/26/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/"/>
      <url>/2018/02/26/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h1><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://blog.csdn.net/carson_ho/article/details/54910430" target="_blank" rel="noopener">适配器模式（Adapter Pattern）- 最易懂的设计模式解析</a></li><li><a href="https://design-patterns.readthedocs.io/zh_CN/latest/structural_patterns/adapter.html" target="_blank" rel="noopener">适配器模式</a></li></ul><h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><p>把一个类的接口变换成客户端所期待的另一种接口，从而使原本接口不匹配而无法一起工作的两个类能够在一起工作</p><h2 id="模式动机"><a href="#模式动机" class="headerlink" title="模式动机"></a>模式动机</h2><ul><li>通常情况下，客户端可以通过目标类的接口访问它所提供的服务。有时，现有的类可以满足客户类的功能需要，但是它所提供的接口不一定是客户类所期望的，这可能是因为现有类中方法名与目标类中定义的方法名不一致等原因所导致的。</li><li>在这种情况下，现有的接口需要转化为客户类期望的接口，这样保证了对现有类的重用。如果不进行这样的转化，客户类就不能利用现有类所提供的功能，适配器模式可以完成这样的转化。</li><li>在适配器模式中可以定义一个包装类，包装不兼容接口的对象，这个包装类指的就是适配器(Adapter)，它所包装的对象就是适配者(Adaptee)，即被适配的类。</li><li>适配器提供客户类需要的接口，适配器的实现就是把客户类的请求转化为对适配者的相应接口的调用。也就是说：当客户类调用适配器的方法时，在适配器类的内部将调用适配者类的方法，而这个过程对客户类是透明的，客户类并不直接访问适配者类。因此，适配器可以使由于接口不兼容而不能交互的类可以一起工作。这就是适配器模式的模式动机。</li></ul><h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><p>适配器模式的形式分为：</p><ul><li>类的适配器模式</li><li>对象的适配器模式</li></ul><p>类的适配器模式是使用继承关系连接到Adaptee类,对象的适配器模式是使用委派关系连接到Adaptee类。</p><h2 id="类的适配器模式"><a href="#类的适配器模式" class="headerlink" title="类的适配器模式"></a>类的适配器模式</h2><h3 id="UML图"><a href="#UML图" class="headerlink" title="UML图"></a>UML图</h3><p><img src="/images/2020/02/20200225006.png" alt></p><ul><li>Client:客户</li><li>Target:目标</li><li>Adapter:适配器</li><li>adaptee:适应者</li></ul><h3 id="UML图说明"><a href="#UML图说明" class="headerlink" title="UML图说明"></a>UML图说明</h3><ul><li>冲突:Target期待调用Request方法,而这个方法在Adaptee并没有(这就是所谓不兼容)</li><li>解决方案:为使Target能够使用Adaptee类里的SpecificRequest方法,需要添加一个中间环节Adapter类,Adapter类继承Adaptee,同时实现Target接口,把Adaptee的API与Target的API衔接起来(适配)</li></ul><h3 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h3><p>步骤1： 创建Target接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Target</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这是源类Adapteee没有的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Request</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>步骤2： 创建源类（Adaptee）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adaptee</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SpecificRequest</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>步骤3： 创建适配器类（Adapter）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//适配器Adapter继承自Adaptee，同时又实现了目标(Target)接口。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">Adaptee</span> <span class="keyword">implements</span> <span class="title">Target</span> </span>&#123;</span><br><span class="line">    <span class="comment">//目标接口要求调用Request()这个方法名，但源类Adaptee没有方法Request()</span></span><br><span class="line">    <span class="comment">//因此适配器补充上这个方法名</span></span><br><span class="line">    <span class="comment">//但实际上Request()只是调用源类Adaptee的SpecificRequest()方法的内容</span></span><br><span class="line">    <span class="comment">//所以适配器只是将SpecificRequest()方法作了一层封装，封装成Target可以调用的Request()而已</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.SpecificRequest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>步骤4：定义具体使用目标类，并通过Adapter类调用所需要的方法从而实现目标</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Client访问适配器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdapterPattern</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Target mAdapter = <span class="keyword">new</span> Adapter()；</span><br><span class="line">        mAdapter.Request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="实例讲解"><a href="#实例讲解" class="headerlink" title="实例讲解"></a>实例讲解</h3><h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><ul><li>背景：小成买了一个进口的电视机</li><li>冲突：进口电视机要求电压（110V）与国内插头标准输出电压（220V）不兼容</li><li>解决方案：设置一个适配器将插头输出的220V转变成110V</li></ul><h4 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h4><p>步骤1： 创建Target接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Target</span> </span>&#123;</span><br><span class="line"><span class="comment">// 进口电视需要一个110v的插座口</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">socket_110v</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>步骤2： 创建源类（Adaptee） -&gt; 原来就具有的类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adaptee</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">socket_220v</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>步骤3： 创建适配器类（Adapter）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//适配器Adapter继承自Adaptee，同时又实现了目标(Target)接口。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">extends</span> <span class="title">Adaptee</span> <span class="keyword">implements</span> <span class="title">Target</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 由于实现了接口,所以这个适配器会有一个110v的插座口</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">socket_110v</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">// 2. 这个插座口的目的是复用原有的220v插座口</span></span><br><span class="line"><span class="comment">// 3. 由于继承了Adaptee,所以适配器类拥有220v插座口</span></span><br><span class="line">        <span class="keyword">this</span>.socket_220v();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>步骤4：定义具体使用目标类，并通过Adapter类调用所需要的方法从而实现目标</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Client访问适配器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdapterPattern</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        Target mAdapter = <span class="keyword">new</span> Adapter()；</span><br><span class="line">        mAdapter.socket_110v();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="对象的适配器模式"><a href="#对象的适配器模式" class="headerlink" title="对象的适配器模式"></a>对象的适配器模式</h2><h3 id="UML图-1"><a href="#UML图-1" class="headerlink" title="UML图"></a>UML图</h3><p><img src="/images/2020/02/20200225005.png" alt></p><h3 id="UML图说明-1"><a href="#UML图说明-1" class="headerlink" title="UML图说明"></a>UML图说明</h3><p>在上图中可以看出：</p><ul><li>冲突：Target期待调用Request方法，而Adaptee并没有（这就是所谓的不兼容了）。</li><li>解决方案：为使Target能够使用Adaptee类里的SpecificRequest方法，故提供一个中间环节Adapter<strong>（包装了一个Adaptee的实例）</strong>，把Adaptee的API与Target的API衔接起来（适配）。</li><li>Adapter与Adaptee是委派关系，这决定了适配器模式是对象的。</li></ul><h3 id="使用步骤（代码解析）"><a href="#使用步骤（代码解析）" class="headerlink" title="使用步骤（代码解析）"></a>使用步骤（代码解析）</h3><p>步骤1： 创建Target接口；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Target</span> </span>&#123;</span><br><span class="line">    <span class="comment">//这是源类Adapteee没有的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Request</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>步骤2： 创建源类（Adaptee） ；</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adaptee</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SpecificRequest</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>步骤3： 创建适配器类（Adapter）（<strong>不适用继承而是委派</strong>）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">implements</span> <span class="title">Target</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 直接关联被适配类</span></span><br><span class="line">    <span class="keyword">private</span> Adaptee adaptee;</span><br><span class="line">    <span class="comment">// 可以通过构造函数传入具体需要适配的被适配类对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Adapter</span> <span class="params">(Adaptee adaptee)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.adaptee = adaptee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 这里是使用委托的方式完成特殊功能</span></span><br><span class="line">        <span class="keyword">this</span>.adaptee.SpecificRequest();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>步骤4：定义具体使用目标类，并通过Adapter类调用所需要的方法从而实现目标</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdapterPattern</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="comment">//需要先创建一个被适配类的对象作为参数</span></span><br><span class="line">        Target mAdapter = <span class="keyword">new</span> Adapter(<span class="keyword">new</span> Adaptee())；</span><br><span class="line">        mAdapter.Request();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="适配器优缺点"><a href="#适配器优缺点" class="headerlink" title="适配器优缺点"></a>适配器优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul><li>将目标类和适配者类解耦，通过引入一个适配器类来重用现有的适配者类，而无须修改原有代码。</li><li>增加了类的透明性和复用性，将具体的实现封装在适配者类中，对于客户端类来说是透明的，而且提高了适配者的复用性。</li><li>灵活性和扩展性都非常好，通过使用配置文件，可以很方便地更换适配器，也可以在不修改原有代码的基础上增加新的适配器类，完全符合“开闭原则”。</li></ul><p>类适配器模式还具有如下优点：</p><ul><li>由于适配器类是适配者类的子类，因此可以在适配器类中置换一些适配者的方法，使得适配器的灵活性更强。</li></ul><p>对象适配器模式还具有如下优点：</p><ul><li>一个对象适配器可以把多个不同的适配者适配到同一个目标，也就是说，同一个适配器可以把适配者类和它的子类都适配到目标接口。</li></ul><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>类适配器模式的缺点如下：</p><ul><li>对于Java、C#等不支持多重继承的语言，一次最多只能适配一个适配者类，而且目标抽象类只能为抽象类，不能为具体类，其使用有一定的局限性，不能将一个适配者类和它的子类都适配到目标接口。</li></ul><p>对象适配器模式的缺点如下：</p><ul><li>与类适配器模式相比，要想置换适配者类的方法就不容易。如果一定要置换掉适配者类的一个或多个方法，就只好先做一个适配者类的子类，将适配者类的方法置换掉，然后再把适配者类的子类当做真正的适配者进行适配，实现过程较为复杂。</li></ul><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><h3 id="适配器的使用场景"><a href="#适配器的使用场景" class="headerlink" title="适配器的使用场景"></a>适配器的使用场景</h3><ul><li>系统需要复用现有类，而该类的接口不符合系统的需求，可以使用适配器模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作</li><li>多个组件功能类似，但接口不统一且可能会经常切换时，可使用适配器模式，使得客户端可以以统一的接口使用它们</li></ul><h3 id="类和对象适配器模式的使用场景"><a href="#类和对象适配器模式的使用场景" class="headerlink" title="类和对象适配器模式的使用场景"></a>类和对象适配器模式的使用场景</h3><h4 id="灵活使用时：选择对象的适配器模式"><a href="#灵活使用时：选择对象的适配器模式" class="headerlink" title="灵活使用时：选择对象的适配器模式"></a>灵活使用时：选择对象的适配器模式</h4><ul><li>类适配器使用对象继承的方式，是静态的定义方式；</li><li>而对象适配器使用对象组合的方式，是动态组合的方式。</li></ul><h4 id="需要同时配源类和其子类：选择对象的适配器"><a href="#需要同时配源类和其子类：选择对象的适配器" class="headerlink" title="需要同时配源类和其子类：选择对象的适配器"></a>需要同时配源类和其子类：选择对象的适配器</h4><ul><li>对于类适配器，由于适配器直接继承了Adaptee，使得适配器不能和Adaptee的子类一起工作，因为继承是静态的关系，当适配器继承了Adaptee后，就不可能再去处理 Adaptee的子类了；</li><li>对于对象适配器，一个适配器可以把多种不同的源适配到同一个目标。换言之，同一个适配器可以把源类和它的子类都适配到目标接口。因为对象适配器采用的是对象组合的关系，只要对象类型正确，是不是子类都无所谓。</li></ul><h4 id="需要重新定义Adaptee的部分行为：选择类适配器"><a href="#需要重新定义Adaptee的部分行为：选择类适配器" class="headerlink" title="需要重新定义Adaptee的部分行为：选择类适配器"></a>需要重新定义Adaptee的部分行为：选择类适配器</h4><ul><li>对于类适配器，适配器可以重定义Adaptee的部分行为，相当于子类覆盖父类的部分实现方法。</li><li>对于对象适配器，要重定义Adaptee的行为比较困难，这种情况下，需要定义Adaptee的子类来实现重定义，然后让适配器组合子类。虽然重定义Adaptee的行为比较困难，但是想要增加一些新的行为则方便的很，而且新增加的行为可同时适用于所有的源。</li></ul><h4 id="仅仅希望使用方便时：选择类适配器"><a href="#仅仅希望使用方便时：选择类适配器" class="headerlink" title="仅仅希望使用方便时：选择类适配器"></a>仅仅希望使用方便时：选择类适配器</h4><ul><li>对于类适配器，仅仅引入了一个对象，并不需要额外的引用来间接得到Adaptee。</li><li>对于对象适配器，需要额外的引用来间接得到Adaptee。</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>建议尽量使用对象的适配器模式，多用合成/聚合、少用继承。</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu环境变量的位置与配置</title>
      <link href="/2018/02/09/Ubuntu%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%8D%E7%BD%AE%E4%B8%8E%E9%85%8D%E7%BD%AE/"/>
      <url>/2018/02/09/Ubuntu%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%8D%E7%BD%AE%E4%B8%8E%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://blog.csdn.net/netwalk/article/details/9455893" target="_blank" rel="noopener">https://blog.csdn.net/netwalk/article/details/9455893</a><br><a href="https://blog.csdn.net/White_Idiot/article/details/78253004" target="_blank" rel="noopener">https://blog.csdn.net/White_Idiot/article/details/78253004</a></p><h1 id="Ubuntu环境变量在哪里"><a href="#Ubuntu环境变量在哪里" class="headerlink" title="Ubuntu环境变量在哪里"></a>Ubuntu环境变量在哪里</h1><p>Ubuntu Linux系统环境变量配置文件分为两种</p><ol><li>系统级文件</li><li>用户级文件</li></ol><h2 id="系统级文件"><a href="#系统级文件" class="headerlink" title="系统级文件"></a>系统级文件</h2><ul><li><p>/etc/profile:<br>在登录时,操作系统定制用户环境时使用的第一个文件，此文件为系统的每个用户设置环境信息,当用户第一次登录时,该文件被执行。并从/etc/profile.d目录的配置文件中搜集shell的设置。这个文件一般就是调用/etc/bash.bashrc文件。</p></li><li><p>/etc/bash.bashrc：<br>系统级的bashrc文件，为每一个运行bash shell的用户执行此文件.当bash shell被打开时,该文件被读取.</p></li><li><p>/etc/environment:<br>在登录时操作系统使用的第二个文件,系统在读取你自己的profile前,设置环境文件的环境变量。</p></li></ul><h2 id="用户级文件"><a href="#用户级文件" class="headerlink" title="用户级文件"></a>用户级文件</h2><ul><li><p>~/.profile:<br>在登录时用到的第三个文件 是.profile文件,每个用户都可使用该文件输入专用于自己使用的shell信息,当用户登录时,该文件仅仅执行一次!默认情况下,他设置一些环境变量,执行用户的.bashrc文件。</p></li><li><p>~/.bashrc:<br>该文件包含专用于你的bash shell的bash信息,当登录时以及每次打开新的shell时,该该文件被读取。<br>不推荐放到这儿，因为每开一个shell，这个文件会读取一次，效率 上讲不好。</p></li><li><p>~/.bash_profile：<br>每个用户都可使用该文件输入专用于自己 使用的shell信息,当用户登录时,该文件仅仅执行一次!默认情况下,他设置一些环境变量,执行用户的.bashrc文件。.bash_profile是交互式,login 方式进入 bash 运行的.bashrc是交互式 non-login 方式进入 bash 运行的通常二者设置大致相同，所以通常前者会调用后者。</p></li><li><p>~./bash_login:<br>不推荐使用这个，这些不会影响图形界面。而且.bash_profile优先级比bash_login高。当它们存在时，登录shell启动时会读取它们。</p></li><li><p>~/.bash_logout:<br>当每次退出系统(退出bash shell)时,执行该文件.</p></li><li><p>~/.pam_environment：用户级的环境变量设置文件。</p></li></ul><p>另外,/etc/profile中设定的变量(全局)的可以作用于任何用户,而~/.bashrc等中设定的变量(局部)只能继承 /etc/profile中的变量,他们是”父子”关系。 </p><h1 id="查看环境变量"><a href="#查看环境变量" class="headerlink" title="查看环境变量"></a>查看环境变量</h1><p>查看环境变量有三个命令：</p><ul><li><p>env：<br>env命令是environment的缩写，用于列出所有的环境变量；</p></li><li><p>export：<br>单独使用export命令也可以像env列出所有的环境变量，不过export命令还有其他额外的功能；</p></li><li><p>echo $PATH：<br>echo $PATH用于列出变量PATH的值，里面包含了已添加的目录。</p></li></ul><h1 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h1><p>设置环境变量通常有两种方式。</p><h2 id="把你的路径加入PATH"><a href="#把你的路径加入PATH" class="headerlink" title="把你的路径加入PATH"></a>把你的路径加入PATH</h2><p>可以直接添加到环境变量PATH中。$PATH表示变量PATH的值，包含已有的目录。</p><p>这种方法需要注意路径的顺序，如果遇到有同名的命令，那么PATH里面哪个目录先被查询，则那个目录下的命令就会被先执行，如下所示：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加到PATH末尾</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:/path/to/your/dir</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加到PATH开头</span></span><br><span class="line"><span class="built_in">export</span> PATH=/path/to/your/dir:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><h2 id="命名一个新的环境变量"><a href="#命名一个新的环境变量" class="headerlink" title="命名一个新的环境变量"></a>命名一个新的环境变量</h2><p>也可以直接命名一个新的环境变量，用于其它程序引用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> VAR_NAME=value</span><br></pre></td></tr></table></figure><h1 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h1><p>环境变量的作用域通常有三个。</p><h2 id="用于当前终端"><a href="#用于当前终端" class="headerlink" title="用于当前终端"></a>用于当前终端</h2><p>打开一个终端，输入添加环境变量的语句：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export CLASS_PATH=./JAVA_HOME/lib:$JAVA_HOME/jre/lib</span><br></pre></td></tr></table></figure><p><code>终端所添加的环境变量是临时的，只适用于当前终端</code>，关闭当前终端或在另一个终端中，添加的环境变量无效。</p><h2 id="用于当前用户"><a href="#用于当前用户" class="headerlink" title="用于当前用户"></a>用于当前用户</h2><p>如果只需要添加的环境变量对当前用户有效，可以写入用户主目录下的.bashrc文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment">#   添加语句：</span></span><br><span class="line"><span class="built_in">export</span> CLASS_PATH=./JAVA_HOME/lib:<span class="variable">$JAVA_HOME</span>/jre/lib</span><br><span class="line"></span><br><span class="line"><span class="comment">#   注销或者重启可以使修改生效，如果要使添加的环境变量马上生效：</span></span><br><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><h2 id="用于所有用户"><a href="#用于所有用户" class="headerlink" title="用于所有用户"></a>用于所有用户</h2><p>要使环境变量对所有用户有效，可以修改profile文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#   添加语句：</span></span><br><span class="line"><span class="built_in">export</span> CLASS_PATH=./JAVA_HOME/lib:<span class="variable">$JAVA_HOME</span>/jre/lib</span><br><span class="line"></span><br><span class="line"><span class="comment">#   注销或者重启可以使修改生效，如果要使添加的环境变量马上生效：</span></span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Junit之Jacoco测试率覆盖工具</title>
      <link href="/2018/02/07/Junit%E4%B9%8BJacoco%E6%B5%8B%E8%AF%95%E7%8E%87%E8%A6%86%E7%9B%96%E5%B7%A5%E5%85%B7/"/>
      <url>/2018/02/07/Junit%E4%B9%8BJacoco%E6%B5%8B%E8%AF%95%E7%8E%87%E8%A6%86%E7%9B%96%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="介绍JaCoCo"><a href="#介绍JaCoCo" class="headerlink" title="介绍JaCoCo"></a>介绍JaCoCo</h1><p>Java Code Coverage是一种分析单元测试覆盖率的工具，使用它运行单元测试后，可以给出代码中哪些部分被单元测试测到，哪些部分没有没测到，并且给出整个项目的单元测试覆盖情况百分比，看上去一目了然。</p><h2 id="JaCoCo会生成以下指标的度量："><a href="#JaCoCo会生成以下指标的度量：" class="headerlink" title="JaCoCo会生成以下指标的度量："></a>JaCoCo会生成以下指标的度量：</h2><ul><li><p>Instructions (C0 Coverage)主要是计算字节码文件的覆盖率。</p></li><li><p>Branches (C1 Coverage)JaCoCo也计算分支覆盖所有if和 switch语句。主要是计算分支的。</p><ul><li>没有覆盖：在该行没有分支机构已执行（红钻）</li><li>部分覆盖：只有在该行分支机构的一部分已经被执行（黄钻）</li><li>全覆盖：在该行各分支机构已执行（绿钻）</li></ul></li><li><p>Cyclomatic Complexity</p><ul><li>圈复杂度(Cyclomatic Complexity)是一种代码复杂度的衡量标准。它可以用来衡量一个模块判定结构的复杂程度，数量上表现为独立现行路径条数，也可理解为覆盖所有的可能情况最少使用的测试用例数。圈复杂度大说明程序代码的判断逻辑复杂，可能质量低且难于测试和维护。程序的可能错误和高的圈复杂度有着很大关系。请注意，JaCoCo不考虑异常处理的分支机构try-catch块也不会增加复杂性。总体和分支正相关。实际上，过去几年的各种研究已经确定：一个方法的圈复杂度（或 CC）大于 10 的方法存在很大的出错风险。</li></ul></li><li><p>Lines主要计算基于覆盖的实际源代码行类和源文件行覆盖。通常会标识三种状态。</p><ul><li>没有覆盖：在该行任何指令执行（红色背景）</li><li>部分覆盖：只有在该行的指示的一部分已经被执行（黄色背景）</li><li>全覆盖：在该行的所有指令已执行（绿色背景）</li></ul></li><li><p>Methods每个非抽象方法包含至少一个指令。构造函数和静态初始化都算作方法。</p></li></ul><h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><h2 id="Eclipse插件EclEmma"><a href="#Eclipse插件EclEmma" class="headerlink" title="Eclipse插件EclEmma"></a>Eclipse插件EclEmma</h2><h3 id="EclEmma的安装"><a href="#EclEmma的安装" class="headerlink" title="EclEmma的安装"></a>EclEmma的安装</h3><ol><li>启动eclipse,点击Help菜单,Install New Software,在弹出的对话框中,点击Add</li><li>输入Name,例如EclEmma.输入Location:update.eclemma.org/</li><li>在Work With处选择刚刚输入的Location地址</li><li>安装后重新启动eclipse,如果安装成功,工具栏上会出现一个新的按钮</li></ol><h3 id="EclEmma的使用"><a href="#EclEmma的使用" class="headerlink" title="EclEmma的使用"></a>EclEmma的使用</h3><ol><li><p>编写单元测试用例。现在支持以下测试：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+Local Java application</span><br><span class="line">+Eclipse/RCP application</span><br><span class="line">+Equinox OSGi framework</span><br><span class="line">+JUnit test</span><br><span class="line">+TestNG test</span><br><span class="line">+JUnit plug-in test</span><br><span class="line">+JUnit RAP test</span><br><span class="line">+SWTBot test</span><br><span class="line">+Scala application</span><br></pre></td></tr></table></figure></li><li><p>以Junit为例,在测试用例文件上右键,选择<code>Coverage As</code> -&gt; <code>Junit Test</code></p></li><li><p>会在测试的文件中显示出运行结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+   绿色:完整执行</span><br><span class="line">+   红色:没执行</span><br><span class="line">+   黄色:部分执行</span><br></pre></td></tr></table></figure></li><li><p>通过点击调出Coverage窗口,它是用来统计程序的覆盖测试率</p></li><li><p>点击红色矩形框的按钮能将多次测试的覆盖数据综合起来进行查看</p></li><li><p>在Coverage视图主区域中点击右键,出现的快捷菜单中选择<code>Export Report...</code></p></li><li><p>出现Export界面,选项如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+   Available session:要导出的session</span><br><span class="line">+   Format:选择报告的类型(HTML/XML/Text/EMMA session)</span><br><span class="line">+   Destination:导出的session存放的位置</span><br></pre></td></tr></table></figure></li></ol><h2 id="IDEA插件"><a href="#IDEA插件" class="headerlink" title="IDEA插件"></a>IDEA插件</h2><p>无</p><h1 id="运行时测试"><a href="#运行时测试" class="headerlink" title="运行时测试"></a>运行时测试</h1><p>JaCoCo支持程序运行中监控执行情况.下面介绍直接运行和tomcat服务器两种监控方式.</p><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><p>在jacoco官网下载jacoco包,下载链接<a href="www.jacoco.org/jacoco/">www.jacoco.org/jacoco/</a><br>下载的包中包括三个jar,此处使用<code>jacocoagent.jar</code>和<code>jacococli.jar</code></p><h2 id="直接运行"><a href="#直接运行" class="headerlink" title="直接运行"></a>直接运行</h2><ol><li><p>假如直接运行的是test.jar,运行以下命令:<br><code>java -javaagent:jacoco\jacocoagent.jar=includes=*-jar test.jar</code></p><ul><li>其中jacoco\jacocoagent.jar处指的是准备中的jar包,后面为参数</li><li>相关参数参考<a href="https://www.jacoco.org/jacoco/trunk/doc/agent.html" target="_blank" rel="noopener">https://www.jacoco.org/jacoco/trunk/doc/agent.html</a></li></ul></li><li><p>待程序运行结束后,会在test.jar统计目录生成jacoco.exec文件,此文件为jacoco获取的运行情况文件.</p></li><li><p>获取需要分析的class文件,假设test.jar中的源代码生成的文件位于com文件夹中,将此文件夹放入和jacoco.exec同一文件夹下.</p></li><li><p>执行命令即可生成报告<br><code>java -jar jacoco\jacococli.jar report jacoco.exec --classfiles com --html report</code></p><ul><li>此处<code>jacoco\jacococli.jar</code>为准备中的jar包</li><li><code>report</code>表明生成报告</li><li><code>jacoco.eexec</code>为运行监控文件</li><li><code>--classfiles</code>为生成报告正对的class文件</li><li><code>--html</code>为报告格式</li><li>后一个<code>report</code>为报告文件夹</li><li>详细参数请参考<a href="https://www.jacoco.org/jacoco/trunk/doc/cli.html" target="_blank" rel="noopener">https://www.jacoco.org/jacoco/trunk/doc/cli.html</a></li></ul></li></ol><h2 id="tomcat运行"><a href="#tomcat运行" class="headerlink" title="tomcat运行"></a>tomcat运行</h2><p>tomcat运行与直接运行的方式基本相同,唯一不同的是指明<code>jacocoagent.jar</code>的方式</p><ul><li>windows下,在<code>$TOMCAT_HOME/bin/catalina.bat</code>的前面</li><li>Linux下,在<code>$TOMCAT_HOME/bin/catalina.sh</code>的前面<br>增加如下设置<br><code>set &quot;JAVA_OPTS=-javaagent:=jacoco\jacocoagent.jar=includes=*&quot;</code><br>如果在参数中未指明exec文件的生成路径,那么会在<code>$TOMCAT_HOME/bin</code>文件夹下生成,其余操作与上述相同</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Junit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Junit单元测试</title>
      <link href="/2018/01/20/Junit%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"/>
      <url>/2018/01/20/Junit%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1255945269146912" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/1252599548343744/1255945269146912</a></li><li><a href="https://blog.csdn.net/Dream_Weave/article/details/83860190" target="_blank" rel="noopener">https://blog.csdn.net/Dream_Weave/article/details/83860190</a></li><li><a href="https://juejin.im/post/5c6ac82ee51d451b240a878a#heading-8" target="_blank" rel="noopener">https://juejin.im/post/5c6ac82ee51d451b240a878a#heading-8</a></li><li><a href="https://blog.csdn.net/10km/article/details/50282179" target="_blank" rel="noopener">https://blog.csdn.net/10km/article/details/50282179</a></li></ul><h1 id="测试的分类"><a href="#测试的分类" class="headerlink" title="测试的分类"></a>测试的分类</h1><ul><li>黑盒测试</li><li>白盒测试</li><li>压力测试</li><li>覆盖率测试</li><li>性能测试</li></ul><h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><h2 id="什么是单元测试"><a href="#什么是单元测试" class="headerlink" title="什么是单元测试"></a>什么是单元测试</h2><ol><li>单元测试就是针对最小的功能单元编写测试代码</li><li>而java程序的最小测试单元就是”方法”</li><li>单元测试就是针对单个java方法的测试</li></ol><h2 id="单元测试与测试驱动开发-TDD"><a href="#单元测试与测试驱动开发-TDD" class="headerlink" title="单元测试与测试驱动开发(TDD)"></a>单元测试与测试驱动开发(TDD)</h2><p>基本流程如下<br><img src="/images/2020/01/20200119001.png" alt></p><h2 id="使用main方法测试的缺点"><a href="#使用main方法测试的缺点" class="headerlink" title="使用main方法测试的缺点"></a>使用main方法测试的缺点</h2><ul><li>只能有一个main()方法,不能把测试代码分离</li><li>没有打印出测试结果和期望结果<br>=&gt;  需要一种测试框架,帮我们编写测试</li></ul><h2 id="单元测试的好处"><a href="#单元测试的好处" class="headerlink" title="单元测试的好处"></a>单元测试的好处</h2><ul><li>确保单个方法运行正常</li><li>如果修改了方法代码,只需确保其对应的单元测试通过</li><li>测试代码本身就可以作为示例代码</li><li>可以自动化运行所有测试并获得报告,报告不仅可以报告成功的测试和失败的测试,还能报告单元测试的覆盖率(即:有多少代码被测试了)</li></ul><h1 id="Junit介绍"><a href="#Junit介绍" class="headerlink" title="Junit介绍"></a>Junit介绍</h1><h2 id="Junit是一个开源的Java语言的单元测试框架"><a href="#Junit是一个开源的Java语言的单元测试框架" class="headerlink" title="Junit是一个开源的Java语言的单元测试框架"></a>Junit是一个开源的Java语言的单元测试框架</h2><ul><li>专门针对Java语言设计,使用最广泛</li><li>Junit是事实上的标准单元测试框架</li></ul><h2 id="Junit特点"><a href="#Junit特点" class="headerlink" title="Junit特点"></a>Junit特点</h2><ul><li>使用断言(Assertion)测试期望结果</li><li>可以方便地组织和运行测试</li><li>可以方便地查看测试结果</li><li>常用IDE都继承了Junit</li><li>可以方便地集成到Maven</li></ul><h2 id="Juint的设计"><a href="#Juint的设计" class="headerlink" title="Juint的设计"></a>Juint的设计</h2><ul><li>TestCase:一个TestCase表示一个测试</li><li>TestSuite:一个TestSuite包含一组TestCase,表示一组测试</li><li>TestFixture:一个TestFixture表示一个测试环境</li><li>TestResult:用于收集测试结果</li><li>TestRunner:用于运行测试</li><li>TestListener:用于监听测试结果,收集测试数据</li><li>Assert:用于断言测试结果是否正确</li></ul><h2 id="Juint版本说明"><a href="#Juint版本说明" class="headerlink" title="Juint版本说明"></a>Juint版本说明</h2><table><thead><tr><th>版本</th><th>Junit3.x</th><th>Junit4</th><th>Junit5</th></tr></thead><tbody><tr><td>JDK</td><td>JDK &lt; 1.5</td><td>JDK &gt;= 1.5</td><td>JDK &gt;= 1.8</td></tr><tr><td>class</td><td>class MyTest extends TestCase{}</td><td>class MyTest{}</td><td>class MyTest{}</td></tr><tr><td>method</td><td>public testAbc(){}</td><td>@Test public abc(){}</td><td>@Test public abc() {}</td></tr></tbody></table><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="使用eclipse如何创建测试类"><a href="#使用eclipse如何创建测试类" class="headerlink" title="使用eclipse如何创建测试类"></a>使用eclipse如何创建测试类</h2><p>使用eclipse创建测试类<br>在需要创建Junit的类上 -&gt; 右键 -&gt; new -&gt; Other -&gt; 找到Junit Test Case<br><img src="/images/2020/01/20200119006.png" alt><br><img src="/images/2020/01/20200119009.png" alt><br><img src="/images/2020/01/20200119010.png" alt><br><img src="/images/2020/01/20200119011.png" alt></p><p>在刚才选择的source folder下创建了测试类<br><img src="/images/2020/01/20200119012.png" alt></p><h2 id="入门案例"><a href="#入门案例" class="headerlink" title="入门案例"></a>入门案例</h2><p>代码结构如上</p><p>被测试代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.junit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">calculate</span><span class="params">(String expression)</span> </span>&#123;</span><br><span class="line">String[] ss = expression.split(<span class="string">"\\+"</span>);</span><br><span class="line">System.out.println(expression + <span class="string">" =&gt; "</span> + Arrays.toString(ss));</span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(String s : ss) &#123;</span><br><span class="line">sum = sum + Integer.parseInt(s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.junit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCalculate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">assertEquals(<span class="number">3</span>, <span class="keyword">new</span> Calculator().calculate(<span class="string">"1+2"</span>));</span><br><span class="line">assertEquals(<span class="number">6</span>, <span class="keyword">new</span> Calculator().calculate(<span class="string">"1+2+3"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试用户输入不规范时,是否能通过测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCalculateWithSpace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">assertEquals(<span class="number">3</span>, <span class="keyword">new</span> Calculator().calculate(<span class="string">" 1 + 2"</span>));  <span class="comment">// 这里输入不规范,被测试代码会报错</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对测试结果进行处理<br><img src="/images/2020/01/20200119015.png" alt></p><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ul><li>一个TestCase包含一组相关的测试方法</li><li>使用Assert断言测试结果(注意浮点数assertEquals要指定delta)</li><li>每个测试方法必须完全独立,也就是说不能预测测试方法的运行顺序</li><li>测试代码必须非常简单</li><li>不能为测试代码再编写测试</li><li>测试需要覆盖各种输入条件,特别是边界条件</li></ul><h2 id="使用Asser断言"><a href="#使用Asser断言" class="headerlink" title="使用Asser断言"></a>使用Asser断言</h2><p><code>import static org.junit.Assert.*</code></p><ul><li>断言相等:assertEquals(100, x)</li><li>断言数组相等:assertArrayEquals({1, 2, 3}, x)</li><li>浮点数断言相等:assertEquals(3.1416, x, 0.0001)  // 其中0.0001是误差值</li><li>断言为null:assertNull(x)</li><li>断言为true/false:assertTrue(x &gt; 0)  assertFalse(x &lt; 0)</li><li>其他:assertNotEquals/assertNotNull</li></ul><h2 id="Junit-Fixture-Before和After"><a href="#Junit-Fixture-Before和After" class="headerlink" title="Junit Fixture(Before和After)"></a>Junit Fixture(Before和After)</h2><p>初始化测试资源称为Fixture</p><ul><li>@Before:初始化测试对象,例如:input = new FileInputStream();</li><li>@After:销毁@Before创建的测试对象,例如:input.close();</li><li>@BeforeClass:初始化非常耗时的资源,例如数据库</li><li>@AfterClass:清理@BeforeClass创建的资源,例如:删除数据库</li></ul><h3 id="使用-Before和-After"><a href="#使用-Before和-After" class="headerlink" title="使用@Before和@After"></a>使用@Before和@After</h3><ul><li>在@Before方法中初始化测试资源(<strong>Before方法初始化的对象要全部放在实例字段中</strong>,底下有示例代码)</li><li>在@After方法中释放测试资源</li></ul><p><strong>使用@Before和@After可以保证</strong></p><ul><li>单个@Test方法执行前会创建新的XxxTest实例,实例变量的状态<code>不会</code>传递给下一个@Test方法</li><li>单个@Test方法执行前后会执行@Before和@After方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.junit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> </span>&#123;</span><br><span class="line">StringBuilder builder;  <span class="comment">// Before方法初始化的对象要全部放在实例字段中</span></span><br><span class="line">Calculator calculator;  <span class="comment">// Before方法初始化的对象要全部放在实例字段中</span></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">calculator = <span class="keyword">new</span> Calculator();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCalculate</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//assertEquals(3, new Calculator().calculate("1+2"));</span></span><br><span class="line"><span class="comment">//assertEquals(6, new Calculator().calculate("1+2+3"));</span></span><br><span class="line">assertEquals(<span class="number">6</span>, calculator.calculate(<span class="string">"1+2+3"</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试用户输入不规范时,是否能通过测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCalculateWithSpace</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//assertEquals(3, new Calculator().calculate(" 1 + 2"));// 这里输入不规范,被测试代码会报错</span></span><br><span class="line">assertEquals(<span class="number">3</span>, calculator.calculate(<span class="string">" 1 + 2"</span>));<span class="comment">// 这里输入不规范,被测试代码会报错</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用-BeforeClass和-AfterClass"><a href="#使用-BeforeClass和-AfterClass" class="headerlink" title="使用@BeforeClass和@AfterClass"></a>使用@BeforeClass和@AfterClass</h3><ul><li>@BeforeClass静态方法初始化的对象只能存放在静态字段中</li><li>静态字段的状态<code>会</code>影响到所有的@Test</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.junit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> </span>&#123;</span><br><span class="line"><span class="keyword">static</span> StringBuilder builder;</span><br><span class="line"><span class="meta">@BeforeClass</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">&#125;</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><h4 id="Junit执行逻辑"><a href="#Junit执行逻辑" class="headerlink" title="Junit执行逻辑"></a>Junit执行逻辑</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">invokeBeforeClass(CalculatorTest.class);    <span class="comment">//@Before</span></span><br><span class="line"><span class="keyword">for</span> (Method testMethod : findTestMethods(CalculatorTest.class)) &#123;</span><br><span class="line">    CalculatorTest test = <span class="keyword">new</span> CalculatorTest(); <span class="comment">// 创建Test实例</span></span><br><span class="line">    test.setUp();   <span class="comment">//@Before</span></span><br><span class="line">    testMethod.invoke(test);    <span class="comment">//@Test</span></span><br><span class="line">    test.setDown(); <span class="comment">//@After</span></span><br><span class="line">&#125;</span><br><span class="line">invokeAfterClass(CalculatorTest.class); <span class="comment">//@AfterClass</span></span><br></pre></td></tr></table></figure><h4 id="Junit执行测试的生命周期"><a href="#Junit执行测试的生命周期" class="headerlink" title="Junit执行测试的生命周期"></a>Junit执行测试的生命周期</h4><ul><li>@Before用于初始化测试对象,测试对象以实例变量存放</li><li>@After用于清理@Before对象创建的对象</li><li>@BeforeClass用于初始化耗时资源,以静态变量存放</li><li>@AfterClass用于清理@BeforeClass创建的资源</li></ul><h2 id="异常测试-使用-Test-expected-异常"><a href="#异常测试-使用-Test-expected-异常" class="headerlink" title="异常测试(使用@Test(expected = 异常))"></a>异常测试(使用@Test(expected = 异常))</h2><p>对可能抛出的异常进行测试</p><ul><li>异常本身是方法签名的一部分<br><code>public static int parseInt(String s) throws NumberFormatException</code></li><li>测试错误的输入是否导致特定的异常<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Integer.parseInt(null)</span><br><span class="line">Integer.parseInt(&quot;&quot;)</span><br><span class="line">Integer.parseInt(&quot;xyz&quot;)</span><br></pre></td></tr></table></figure></li></ul><h3 id="如何测试异常"><a href="#如何测试异常" class="headerlink" title="如何测试异常"></a>如何测试异常</h3><ol><li>很常规,但是写出来会被鄙视的代码<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNumberFormatException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Integer.parseInt(<span class="keyword">null</span>);</span><br><span class="line">        fail(<span class="string">"Should throw exception"</span>);     <span class="comment">// 没有捕获到异常,就用Junit提供的fail()函数表示测试失败</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">        <span class="comment">// do somethint...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>这样需要写很多try…catch…代码</p><ol start="2"><li>使用expected测试异常<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>(expected = NumberFormatException.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNumberFormatException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Integer.parseInt(<span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>如果抛出了指定类型的异常,测试通过;如果没有抛出异常,或者抛出的异常类型不对,测试失败.</p><p>测试不通过例子<br><img src="/images/2020/01/20200119016.png" alt></p><p>对代码进行修改<br><img src="/images/2020/01/20200119018.png" alt></p><h3 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h3><ul><li>测试异常可以使用@Test(expected = Exception.class)</li><li>对可能发生的每种类型的异常进行测试</li></ul><h2 id="超时测试"><a href="#超时测试" class="headerlink" title="超时测试"></a>超时测试</h2><p>Junit可以为单个测试设置超时</p><ul><li>超时设置为1秒:@Test(timeout=1000) 单位是毫秒</li><li>当代码运行时间超过我们设定的时间,报错</li><li>超时测试不能取代性能测试和压力测试</li></ul><h2 id="参数化测试"><a href="#参数化测试" class="headerlink" title="参数化测试"></a>参数化测试</h2><ul><li>对于同一个函数,不能只测试一个输入输出就完事,要测试一组数据</li><li>使用<code>@ParameterizedTest</code>注解</li></ul><h3 id="只有一个参数-使用-ValueSource注解"><a href="#只有一个参数-使用-ValueSource注解" class="headerlink" title="只有一个参数(使用@ValueSource注解)"></a>只有一个参数(使用@ValueSource注解)</h3><p>假设对函数Math.abs()进行测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@ValueSource</span>(ints = &#123; <span class="number">0</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">100</span> &#125;)</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testAbs</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    assertEquals(x, Math.abs(x));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>注意这里<code>没有@Test</code>,使用的是<code>@ParameterizedTest</code>注释</li><li>输入只有一个参数的时候使用<code>@ValueSource</code>注释</li></ul><h3 id="有多个参数"><a href="#有多个参数" class="headerlink" title="有多个参数"></a>有多个参数</h3><ul><li>被测试函数<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">capitalize</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Character.toUpperCase(s.charAt(<span class="number">0</span>)) + s.substring(<span class="number">1</span>).toLowerCase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>该被测的函数会把字符串的第一个字母变为大写，后续字母变为小写</p><h4 id="方法一-使用-MethodSource注解"><a href="#方法一-使用-MethodSource注解" class="headerlink" title="方法一:使用@MethodSource注解"></a>方法一:使用@MethodSource注解</h4><p>通过<code>@MethodSource注解</code>，它允许我们编写一个同名的静态方法来提供测试参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  使用的注解</span></span><br><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@MethodSource</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testCapitalize</span><span class="params">(String input, String result)</span> </span>&#123;</span><br><span class="line">    assertEquals(result, StringUtils.capitalize(input));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  同名的静态方法来提供测试参数</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> List&lt;Arguments&gt; <span class="title">testCapitalize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> List.of( <span class="comment">// arguments:</span></span><br><span class="line">            Arguments.arguments(<span class="string">"abc"</span>, <span class="string">"Abc"</span>), <span class="comment">//</span></span><br><span class="line">            Arguments.arguments(<span class="string">"APPLE"</span>, <span class="string">"Apple"</span>), <span class="comment">//</span></span><br><span class="line">            Arguments.arguments(<span class="string">"gooD"</span>, <span class="string">"Good"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="方法二-使用-CsvSource注解"><a href="#方法二-使用-CsvSource注解" class="headerlink" title="方法二:使用@CsvSource注解"></a>方法二:使用@CsvSource注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@CsvSource</span>(&#123; <span class="string">"abc, Abc"</span>, <span class="string">"APPLE, Apple"</span>, <span class="string">"gooD, Good"</span> &#125;)</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testCapitalize</span><span class="params">(String input, String result)</span> </span>&#123;</span><br><span class="line">    assertEquals(result, StringUtils.capitalize(input));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>写在代码中只能是少量数据,如果数据较多,可以放在csv文件中(其实从@CsvSource这个注解中略知一二),代码如下写法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@CsvFileSource</span>(resources = &#123; <span class="string">"/test-capitalize.csv"</span> &#125;)</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">testCapitalizeUsingCsvFile</span><span class="params">(String input, String result)</span> </span>&#123;</span><br><span class="line">    assertEquals(result, StringUtils.capitalize(input));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="套件测试-使用-RunWith和-Suite"><a href="#套件测试-使用-RunWith和-Suite" class="headerlink" title="套件测试(使用@RunWith和@Suite)"></a>套件测试(使用@RunWith和@Suite)</h2><ul><li>测试套件意味着捆绑几个单元测试用例并且一起执行他们。在 JUnit 中，<code>@RunWith</code>和<code>@Suite</code>注释用来运行套件测试</li></ul><p><strong>被测试函数</strong></p><ul><li><p>Arithmetic.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> in.co.javatutorials;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> javatutorials.co.in</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Arithmetic</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i + j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Geometric.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> in.co.javatutorials;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> javatutorials.co.in</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Geometry</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">squareArea</span><span class="params">(<span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> length * length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><strong>测试代码</strong></p><ul><li><p>ArithmeticTest.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> in.co.javatutorials;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> javatutorials.co.in</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArithmeticTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Arithmetic arithmetic = <span class="keyword">new</span> Arithmetic();</span><br><span class="line">        <span class="keyword">int</span> actualResult = arithmetic.add(<span class="number">1</span> , <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">int</span> expectedResult = <span class="number">3</span>;</span><br><span class="line">        assertEquals(expectedResult, actualResult);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>GeometricTest.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> in.co.javatutorials;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> javatutorials.co.in</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeometryTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSquareArea</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Geometry geometry = <span class="keyword">new</span> Geometry();</span><br><span class="line">        <span class="keyword">int</span> actualResult = geometry.squareArea(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">int</span> expectedResult = <span class="number">4</span>;</span><br><span class="line">        assertEquals(expectedResult, actualResult);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>让上面两个被测试代码一起执行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> in.co.javatutorials;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.junit.runners.Suite;</span><br><span class="line"><span class="keyword">import</span> org.junit.runners.Suite.SuiteClasses;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> javatutorials.co.in</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(Suite.class)</span><br><span class="line"><span class="meta">@SuiteClasses</span>(&#123; ArithmeticTest.class, GeometryTest.class &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AllTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="忽略测试-使用-ignore注解"><a href="#忽略测试-使用-ignore注解" class="headerlink" title="忽略测试(使用@ignore注解)"></a>忽略测试(使用@ignore注解)</h2><p>在需要忽略或者禁止junit 测试类中的任意测试方法上，<code>使用@ignore</code>注解</p><h2 id="控制执行顺序-FixMethodOrder"><a href="#控制执行顺序-FixMethodOrder" class="headerlink" title="控制执行顺序(@FixMethodOrder)"></a>控制执行顺序(@FixMethodOrder)</h2><ul><li>原则上不要控制执行顺序</li><li>使用@FixMethodOrder注解来控制测试方法的执行顺序</li><li>@FixMethodOrder注解的参数是org.junit.runners.MethodSorters对象,在枚举类org.junit.runners.MethodSorters中定义了如下三种顺序类型</li></ul><p>三种顺序类型</p><ul><li><p>MethodSorters.JVM<br>Leaves the test methods in the order returned by the JVM. Note that the order from the JVM may vary from run to run (按照JVM得到的方法顺序，也就是代码中定义的方法顺序)</p></li><li><p>MethodSorters.DEFAULT(默认的顺序)<br>Sorts the test methods in a deterministic, but not predictable, order() (以确定但不可预期的顺序执行)</p></li><li><p>MethodSorters.NAME_ASCENDING<br>Sorts the test methods by the method name, in lexicographic order, with Method.toString() used as a tiebreaker (按方法名字母顺序执行)</p></li></ul><p>示例代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.FixMethodOrder;</span><br><span class="line"><span class="keyword">import</span> org.junit.runners.MethodSorters;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="meta">@FixMethodOrder</span>(MethodSorters.JVM)<span class="comment">//指定测试方法按定义的顺序执行</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJNI</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(TestJNI.class);</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddAndGet</span><span class="params">()</span></span>&#123;</span><br><span class="line">logger.info(<span class="string">"test 'addBean' and 'getBean' "</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">testSearch</span><span class="params">()</span> </span>&#123;</span><br><span class="line">logger.info(<span class="string">"test search CODE from JNI memory..."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">testRemove</span><span class="params">()</span> </span>&#123;</span><br><span class="line">logger.info(<span class="string">"test remove CODE from JNI memory..."</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Junit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eclipse中解决git冲突</title>
      <link href="/2017/12/24/eclipse%E4%B8%AD%E8%A7%A3%E5%86%B3git%E5%86%B2%E7%AA%81/"/>
      <url>/2017/12/24/eclipse%E4%B8%AD%E8%A7%A3%E5%86%B3git%E5%86%B2%E7%AA%81/</url>
      
        <content type="html"><![CDATA[<h1 id="0、来源"><a href="#0、来源" class="headerlink" title="0、来源"></a>0、来源</h1><p><a href="https://blog.csdn.net/rosten/article/details/17068285" target="_blank" rel="noopener">eclipse 中git解决冲突</a></p><h1 id="1、工程-gt-Team-gt-同步："><a href="#1、工程-gt-Team-gt-同步：" class="headerlink" title="1、工程-&gt;Team-&gt;同步："></a>1、工程-&gt;Team-&gt;同步：</h1><p><img src="/images/2019/12/20191223001.png" alt></p><h1 id="2、从远程pull至本地，就会出现如下内容："><a href="#2、从远程pull至本地，就会出现如下内容：" class="headerlink" title="2、从远程pull至本地，就会出现如下内容："></a>2、从远程pull至本地，就会出现如下内容：</h1><p><img src="/images/2019/12/20191223002.png" alt></p><h1 id="3、使用Merge-Tool，执行第二项"><a href="#3、使用Merge-Tool，执行第二项" class="headerlink" title="3、使用Merge Tool，执行第二项"></a>3、使用Merge Tool，执行第二项</h1><p><img src="/images/2019/12/20191223003.png" alt><br><img src="/images/2019/12/20191223004.png" alt><br>使用HEAD合并后的效果：<br><img src="/images/2019/12/20191223005.png" alt></p><h1 id="4、再手动修改"><a href="#4、再手动修改" class="headerlink" title="4、再手动修改"></a>4、再手动修改</h1><p><img src="/images/2019/12/20191223006.png" alt></p><h1 id="5、修改后的文件需要添加到git-index中去："><a href="#5、修改后的文件需要添加到git-index中去：" class="headerlink" title="5、修改后的文件需要添加到git index中去："></a>5、修改后的文件需要添加到git index中去：</h1><p><img src="/images/2019/12/20191223007.png" alt></p><h1 id="6、冲突文件变为修改图标样式，再提交至本地，此时的提交便是merge合并："><a href="#6、冲突文件变为修改图标样式，再提交至本地，此时的提交便是merge合并：" class="headerlink" title="6、冲突文件变为修改图标样式，再提交至本地，此时的提交便是merge合并："></a>6、冲突文件变为修改图标样式，再提交至本地，此时的提交便是merge合并：</h1><p><img src="/images/2019/12/20191223008.png" alt><br><img src="/images/2019/12/20191223009.png" alt></p><h1 id="7、此时需要pull的向下箭头和数量没了，注意图标的变化："><a href="#7、此时需要pull的向下箭头和数量没了，注意图标的变化：" class="headerlink" title="7、此时需要pull的向下箭头和数量没了，注意图标的变化："></a>7、此时需要pull的向下箭头和数量没了，注意图标的变化：</h1><p><img src="/images/2019/12/20191223010.png" alt><br><img src="/images/2019/12/20191223011.png" alt></p><h1 id="8、现在可以直接push到远程了："><a href="#8、现在可以直接push到远程了：" class="headerlink" title="8、现在可以直接push到远程了："></a>8、现在可以直接push到远程了：</h1><p><img src="/images/2019/12/20191223012.png" alt><br>此时<code>configure -&gt; save and push</code>一步步执行冲突就搞定了。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Eclipse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>org.xml.sax.SAXParseException:元素类型input必须由匹配的结束标记/input终止</title>
      <link href="/2017/11/12/Thymeleaf%E9%94%99%E8%AF%AF-org-xml-sax-SAXParseException-%E5%85%83%E7%B4%A0%E7%B1%BB%E5%9E%8Binput%E5%BF%85%E9%A1%BB%E7%94%B1%E5%8C%B9%E9%85%8D%E7%9A%84%E7%BB%93%E6%9D%9F%E6%A0%87%E8%AE%B0-input-%E7%BB%88%E6%AD%A2/"/>
      <url>/2017/11/12/Thymeleaf%E9%94%99%E8%AF%AF-org-xml-sax-SAXParseException-%E5%85%83%E7%B4%A0%E7%B1%BB%E5%9E%8Binput%E5%BF%85%E9%A1%BB%E7%94%B1%E5%8C%B9%E9%85%8D%E7%9A%84%E7%BB%93%E6%9D%9F%E6%A0%87%E8%AE%B0-input-%E7%BB%88%E6%AD%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="参考与引用"><a href="#参考与引用" class="headerlink" title="参考与引用"></a>参考与引用</h1><p><a href="https://github.com/thymeleaf/thymeleaf/issues/390" target="_blank" rel="noopener">https://github.com/thymeleaf/thymeleaf/issues/390</a><br><a href="http://nekohtml.sourceforge.net/" target="_blank" rel="noopener">http://nekohtml.sourceforge.net/</a><br><a href="https://blog.csdn.net/kydkong/article/details/77507798" target="_blank" rel="noopener">NekoHTML 学习笔记</a><br><a href="https://waylau.com/thymeleaf-3-adopts-a-new-parsing-system/" target="_blank" rel="noopener">Thymeleaf 3 引入了新的解析系统</a></p><h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>如果你的代码使用了 HTML5 的标准，而Thymeleaf 版本来停留在 2.x ，那么如果没有把<code>&lt;input&gt;</code>闭合，如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    First name:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"firstname"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    Last name:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"lastname"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>就会抛出如下错误</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.xml.sax.SAXParseException: 元素类型 &quot;input&quot; 必须由匹配的结束标记 &quot;&lt;/input&gt;&quot; 终止。</span><br></pre></td></tr></table></figure><h1 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h1><h2 id="沿用-Thymeleaf-老版本的情况"><a href="#沿用-Thymeleaf-老版本的情况" class="headerlink" title="沿用 Thymeleaf 老版本的情况"></a>沿用 Thymeleaf 老版本的情况</h2><h3 id="方案一-废话"><a href="#方案一-废话" class="headerlink" title="方案一(废话)"></a>方案一(废话)</h3><p>如果你的 Thymeleaf 不能变更，那么你的 HTML 标准也只能停留在老版本了。你必须严格遵守 XML 定义，在<code>&lt;input&gt;</code>加上结束标记<code>&lt;/input&gt;</code>。这显然，对于 HTML5 不友好。</p><h3 id="方案二-使用第三方包nekohtml"><a href="#方案二-使用第三方包nekohtml" class="headerlink" title="方案二:使用第三方包nekohtml"></a>方案二:使用第三方包nekohtml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">   &lt;groupId&gt;net.sourceforge.nekohtml&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;nekohtml&lt;/artifactId&gt;</span><br><span class="line">   &lt;version&gt;1.9.15&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p><em>NekoHTML 是一个简单地HTML扫描器和标签补偿器(tag balancer) ,使得程序能解析HTML文档并用标准的XML接口来访问其中的信息。这个解析器能投扫描HTML文件并“修正”许多作者（人或机器）在编写HTML文档过程中常犯的错误。NekoHTML 能增补缺失的父元素、自动用结束标签关闭相应的元素，以及不匹配的内嵌元素标签。NekoHTML 的开发使用了Xerces Native Interface (XNI)，后者是Xerces2的实现基础。</em></p><h2 id="方案三-升级至-Thymeleaf-3-新版本"><a href="#方案三-升级至-Thymeleaf-3-新版本" class="headerlink" title="方案三:升级至 Thymeleaf 3 新版本"></a>方案三:升级至 Thymeleaf 3 新版本</h2><p>是时候尝试下使用 Thymeleaf 3 了。Thymeleaf 3 使用了新的解析系统。</p><p>Thymeleaf 3 不再是基于XML结构的。由于引入新的解析引擎，模板的内容格式不再需要严格遵守XML规范。即不在要求标签闭合，属性加引号等等。当然，出于易读性考虑，还是推荐你按找XML的标准去编写模板。</p><p>Thymeleaf 3 使用一个名为 AttoParser 2的新解析器。 一个新的、基于事件（不符合SAX标准）的解析器，AttoParser由 Thymeleaf 的作者开发，符合 Thymeleaf 的风格。</p><h3 id="AttoParser-提供-Thymeleaf-3-两个重要功能："><a href="#AttoParser-提供-Thymeleaf-3-两个重要功能：" class="headerlink" title="AttoParser 提供 Thymeleaf 3 两个重要功能："></a>AttoParser 提供 Thymeleaf 3 两个重要功能：</h3><ul><li>完全支持XML和HTML5（非XML化）标记，从而不再需要外部标记平衡操作。</li><li>无损解析，以便在处理的输出的标记类似于具有最高精度的原始模板。</li></ul><p>所以下面的格式在 Thymeleaf 3 里面是合法的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;&lt;img alt=logo th:src=&apos;@&#123;/images/logo.png&#125;&apos;&gt;</span><br></pre></td></tr></table></figure><h3 id="Thymeleaf-3-其他方面的解析改进"><a href="#Thymeleaf-3-其他方面的解析改进" class="headerlink" title="Thymeleaf 3 其他方面的解析改进"></a>Thymeleaf 3 其他方面的解析改进</h3><ol><li><p>启用验证的解析<br>在 Thymeleaf 2.1提供了两种VALID*模板模式，名为VALIDXHTML和VALIDXML，在而 Thymeleaf 3 中将不再存在。 新的解析基础结构不提供HTML或XML验证，即在解析期间无法验证模板标记是否符合指定的DTD或XML模式定义。</p></li><li><p>不再需要<code>&lt;![CDATA[ ... ]]&gt;</code></p></li></ol><p>Thymeleaf 2.1 要求将<code>&lt;script&gt;</code>标记的内容封装在 CDATA 中，以便所使用的任何&lt;或&gt;符号不会干扰基于XML的解析：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">/*&lt;![CDATA[*/</span></span><br><span class="line">  <span class="keyword">var</span> user = ...</span><br><span class="line">  <span class="keyword">if</span> (user.signupYear &lt; <span class="number">1990</span>) &#123;</span><br><span class="line">    alert(<span class="string">'You\'ve been here for a long time!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">/*]]&gt;*/</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>而在 Thymeleaf 3 中则不需要这样做，代码立马变得简洁干净：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="keyword">var</span> user = ...</span><br><span class="line">  <span class="keyword">if</span> (user.signupYear &lt; <span class="number">1990</span>) &#123;</span><br><span class="line">    alert(<span class="string">'You\'ve been here for a long time!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java细节 </tag>
            
            <tag> Thymeleaf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC的@RequestMapping注解的作用</title>
      <link href="/2017/11/12/SpringMVC%E7%9A%84-RequestMapping%E6%B3%A8%E8%A7%A3%E7%9A%84%E4%BD%9C%E7%94%A8/"/>
      <url>/2017/11/12/SpringMVC%E7%9A%84-RequestMapping%E6%B3%A8%E8%A7%A3%E7%9A%84%E4%BD%9C%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="参考与引用"><a href="#参考与引用" class="headerlink" title="参考与引用"></a>参考与引用</h1><p><a href="https://blog.csdn.net/walkerJong/article/details/7994326" target="_blank" rel="noopener">@RequestMapping 用法详解之地址映射</a></p><h1 id="RequestMapping作用"><a href="#RequestMapping作用" class="headerlink" title="@RequestMapping作用"></a>@RequestMapping作用</h1><p>RequestMapping是一个用来处理请求地址映射的注解，可用于类或方法上。用于类上，表示类中的所有响应请求的方法都是以该地址作为父路径。</p><h1 id="Requestmapping的属性说明"><a href="#Requestmapping的属性说明" class="headerlink" title="@Requestmapping的属性说明"></a>@Requestmapping的属性说明</h1><p>RequestMapping注解有六个属性，下面我们把她分成三类进行说明。</p><h2 id="value，-method；"><a href="#value，-method；" class="headerlink" title="value， method；"></a>value， method；</h2><ul><li>value：  指定请求的实际地址，指定的地址可以是URI Template 模式（后面将会说明）；</li><li>method：  指定请求的method类型， GET、POST、PUT、DELETE等；</li></ul><p>value的uri值为以下三类：</p><ul><li>A） 可以指定为普通的具体值；</li><li>B)  可以指定为含有某变量的一类值(URI Template Patterns with Path Variables)；</li><li>C) 可以指定为含正则表达式的一类值( URI Template Patterns with Regular Expressions);<br>如下示例</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/appointments"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppointmentsController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AppointmentBook appointmentBook;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AppointmentsController</span><span class="params">(AppointmentBook appointmentBook)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.appointmentBook = appointmentBook;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Appointment&gt; <span class="title">get</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> appointmentBook.getAppointmentsForToday();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/&#123;day&#125;"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Appointment&gt; <span class="title">getForDay</span><span class="params">(@PathVariable @DateTimeFormat(iso=ISO.DATE)</span> Date day, Model model) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> appointmentBook.getAppointmentsForDay(day);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value=<span class="string">"/new"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> AppointmentForm <span class="title">getNewForm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AppointmentForm();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">add</span><span class="params">(@Valid AppointmentForm appointment, BindingResult result)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (result.hasErrors()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"appointments/new"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        appointmentBook.addAppointment(appointment);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/appointments"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/owners/&#123;ownerId&#125;"</span>, method=RequestMethod.GET)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">findOwner</span><span class="params">(@PathVariable String ownerId, Model model)</span> </span>&#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/spring-web/&#123;symbolicName:[a-z-]+&#125;-&#123;version:\d\.\d\.\d&#125;.&#123;extension:\.[a-z]&#125;"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(@PathVariable String version, @PathVariable String extension)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="consumes，produces；"><a href="#consumes，produces；" class="headerlink" title="consumes，produces；"></a>consumes，produces；</h2><ul><li>consumes： 指定处理请求的提交内容类型（Content-Type），例如application/json, text/html;</li><li>produces:  指定返回的内容类型，仅当request请求头中的(Accept)类型中包含该指定类型才返回；</li></ul><p>cousumes的样例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/pets"</span>, method = RequestMethod.POST, consumes=<span class="string">"application/json"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addPet</span><span class="params">(@RequestBody Pet pet, Model model)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// implementation omitted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>方法仅处理request Content-Type为“application/json”类型的请求。</p><p>produces的样例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/pets"</span>, method = RequestMethod.POST, consumes=<span class="string">"application/json"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addPet</span><span class="params">(@RequestBody Pet pet, Model model)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// implementation omitted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>方法仅处理request请求中Accept头中包含了”application/json”的请求，同时暗示了返回的内容类型为application/json;</p><h2 id="params，headers；"><a href="#params，headers；" class="headerlink" title="params，headers；"></a>params，headers；</h2><ul><li>params： 指定request中必须包含某些参数值是，才让该方法处理。</li><li>headers： 指定request中必须包含某些指定的header值，才能让该方法处理请求。</li></ul><p>params的样例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/owners/&#123;ownerId&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RelativePathUriTemplateController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span>(value = <span class="string">"/pets/&#123;petId&#125;"</span>, method = RequestMethod.GET, params=<span class="string">"myParam=myValue"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findPet</span><span class="params">(@PathVariable String ownerId, @PathVariable String petId, Model model)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// implementation omitted</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>仅处理请求中包含了名为“myParam”，值为“myValue”的请求；</p><p>headers的样例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/owners/&#123;ownerId&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RelativePathUriTemplateController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/pets"</span>, method = RequestMethod.GET, headers=<span class="string">"Referer=http://www.ifeng.com/"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findPet</span><span class="params">(@PathVariable String ownerId, @PathVariable String petId, Model model)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// implementation omitted</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>仅处理request的header中包含了指定“Refer”请求头和对应值为<a href="http://www.ifeng.com/的请求；" target="_blank" rel="noopener">http://www.ifeng.com/的请求；</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC的自定义参数绑定</title>
      <link href="/2017/10/31/SpringMVC%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A/"/>
      <url>/2017/10/31/SpringMVC%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A/</url>
      
        <content type="html"><![CDATA[<h1 id="为什么需要自动绑定"><a href="#为什么需要自动绑定" class="headerlink" title="为什么需要自动绑定"></a>为什么需要自动绑定</h1><h2 id="理解自动绑定"><a href="#理解自动绑定" class="headerlink" title="理解自动绑定"></a>理解自动绑定</h2><ol><li>springmvc能将request的参数自动绑定</li><li>自动绑定 -&gt; request参数与变量形成一一映射 -&gt; 即:request的参数名与java的变量名要一致,同时参数名的类型和变量名的类型要一致</li></ol><h2 id="参数名和变量名不一致会发生什么"><a href="#参数名和变量名不一致会发生什么" class="headerlink" title="参数名和变量名不一致会发生什么?"></a>参数名和变量名不一致会发生什么?</h2><p>400错误</p><h2 id="参数名和变量名名称一致-但类型不一致时-spring如何处理"><a href="#参数名和变量名名称一致-但类型不一致时-spring如何处理" class="headerlink" title="参数名和变量名名称一致,但类型不一致时,spring如何处理"></a>参数名和变量名名称一致,但类型不一致时,spring如何处理</h2><p>能够进行自定义参数绑定,可以按照如下进行理解</p><ol><li>request参数要自动绑定到变量,首先找到与自己”名字”一致的变量</li><li>找到之后,判断是否类型一致</li><li>一致 -&gt; 绑定就行</li><li>不一致 -&gt; 看是否设定转换器</li><li>未设置转换器 -&gt; 400错误</li><li>设置转换器 -&gt; 使用转换器,将request参数的类型转换成java变量的类型后,进行绑定<br><img src="/images/springmvc/20191031003.png" alt></li></ol><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h2><p><img src="/images/springmvc/20191031001.png" alt></p><h2 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h2><p>index.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag"><span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">prefix</span>=<span class="string">"c"</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">prefix</span>=<span class="string">"fmt"</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c:set</span> <span class="attr">var</span>=<span class="string">"now"</span> <span class="attr">value</span>=<span class="string">"&lt;%=new java.util.Date()%&gt;"</span> /&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>spring MVC POJO<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"testPojo.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">时间:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"times"</span> <span class="attr">value</span>=<span class="string">"2019-10-31 09:32:13"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"testPojoSubmit"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjc.springmvc.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPojoController</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUCCESS = <span class="string">"success"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/index"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testPojoIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">mav.setViewName(<span class="string">"index"</span>);</span><br><span class="line"><span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/testPojo"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testPojo</span><span class="params">(User user, String[] ids, Date times)</span> </span>&#123;</span><br><span class="line">System.out.println(times);</span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="转换器"><a href="#转换器" class="headerlink" title="转换器"></a>转换器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.utils;</span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 要注意继承的是哪个接口</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.convert.converter.Converter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 日期转换器</span></span><br><span class="line"><span class="comment"> * S:source要转换的源类型</span></span><br><span class="line"><span class="comment"> * T:target要转换成的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//public class DateConvert implements Converter&lt;S, T&gt; &#123;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateConvert</span> <span class="keyword">implements</span> <span class="title">Converter</span>&lt;<span class="title">String</span>, <span class="title">Date</span>&gt; </span>&#123;</span><br><span class="line"><span class="keyword">private</span> SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Date <span class="title">convert</span><span class="params">(String source)</span> </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">return</span> simpleDateFormat.parse(source);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="让spring识别转换器-配置springmvc-xml"><a href="#让spring识别转换器-配置springmvc-xml" class="headerlink" title="让spring识别转换器(配置springmvc.xml)"></a>让spring识别转换器(配置springmvc.xml)</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-context-4.3.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置controller扫描包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置注解驱动,相当于同时使用最新处理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置前缀 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置后缀 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 自定义转化器 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">使用 mvc:annotation-driven 代替上边注解映射器和注解适配器配置</span></span><br><span class="line"><span class="comment">    mvc:annotation-driven 默认加载很多的参数绑定方法，</span></span><br><span class="line"><span class="comment">    比如json转换解析器就默认加载了，如果使用 mvc:annotation-driven不用配置上边的RequestMappingHandlerMapping和RequestMappingHandlerAdapter</span></span><br><span class="line"><span class="comment">    实际开发时使用 mvc:annotation-driven</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">"myConversionService"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 自定义参数绑定 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myConversionService"</span> <span class="attr">class</span>=<span class="string">"org.springframework.format.support.FormattingConversionServiceFactoryBean"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 转换器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"converters"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 日期类型转换 --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.zjc.springmvc.utils.DateConvert"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC的List参数绑定</title>
      <link href="/2017/10/25/SpringMVC%E7%9A%84List%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A/"/>
      <url>/2017/10/25/SpringMVC%E7%9A%84List%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A/</url>
      
        <content type="html"><![CDATA[<h1 id="基本代码"><a href="#基本代码" class="headerlink" title="基本代码"></a>基本代码</h1><h2 id="项目基础代码"><a href="#项目基础代码" class="headerlink" title="项目基础代码"></a>项目基础代码</h2><p><a href="/2017/10/24/SpringMVC的数组参数绑定/">SpringMVC的数组参数绑定</a><br>底下代码基本相同</p><h2 id="本文中的文件结构"><a href="#本文中的文件结构" class="headerlink" title="本文中的文件结构"></a>本文中的文件结构</h2><p><img src="/images/springmvc/20191024003.png" alt></p><h2 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h2><p>这个页面有改动,改动部分如图<br><img src="/images/springmvc/20191024001.png" alt></p><ul><li><p>index.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag"><span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>spring MVC POJO<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"testPojo.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">用户名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">省:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"address.province"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">市:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"address.city"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"ids"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"run"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>跑步<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"ids"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"soccer"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>踢球<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"ids"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"ski"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>滑雪<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">课程名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span><span class="attr">name</span>=<span class="string">"scores[0].coursename"</span>/&gt;</span>成绩：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span><span class="attr">name</span>=<span class="string">"scores[0].score"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">课程名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span><span class="attr">name</span>=<span class="string">"scores[1].coursename"</span>/&gt;</span>成绩：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span><span class="attr">name</span>=<span class="string">"scores[1].score"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">课程名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span><span class="attr">name</span>=<span class="string">"scores[2].coursename"</span>/&gt;</span>成绩：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span><span class="attr">name</span>=<span class="string">"scores[2].score"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"testPojoSubmit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>success.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag"><span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>spring MVC POJO<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"testPojo.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">username:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">password:<span class="tag">&lt;<span class="name">input</span><span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">province:<span class="tag">&lt;<span class="name">input</span><span class="attr">name</span>=<span class="string">"address.province"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">city:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"address.city"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"testPojoSubmit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="pojo"><a href="#pojo" class="headerlink" title="pojo"></a>pojo</h2><ul><li><p>下方pojo代码使用了Lombok的注解语法</p><ul><li>可以看这里:<a href="/2017/10/23/Lombok简化你的代码/">Lombok简化你的代码</a></li><li>添加依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.14.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>User.java<br>这个文件也有改动,增加List类型的变量scores</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="keyword">private</span> Address address;</span><br><span class="line"><span class="keyword">private</span> String[] ids;</span><br><span class="line"><span class="keyword">private</span> List&lt;StudentScore&gt; scores;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>StudentScore.java<br>新增StudentScore.java文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentScore</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String coursename;</span><br><span class="line">    <span class="keyword">private</span> Float score;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Address.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String province;</span><br><span class="line"><span class="keyword">private</span> String city;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjc.springmvc.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPojoController</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUCCESS = <span class="string">"success"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/index"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testPojoIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">mav.setViewName(<span class="string">"index"</span>);</span><br><span class="line"><span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/testPojo"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testPojo</span><span class="params">(User user, String[] ids)</span> </span>&#123;</span><br><span class="line">System.out.println(user);</span><br><span class="line">System.out.println(<span class="string">"---------------------"</span>);</span><br><span class="line"><span class="keyword">for</span> (String id : ids) &#123;</span><br><span class="line">System.out.println(id);</span><br><span class="line">System.out.println(<span class="string">"--------"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="跑项目"><a href="#跑项目" class="headerlink" title="跑项目"></a>跑项目</h2><p>访问<code>http://localhost:8080/springhello/index.action</code>,输入数据提交<br>在eclipse控制台中打出如下数据<br><img src="/images/springmvc/20191024002.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC的数组参数绑定</title>
      <link href="/2017/10/24/SpringMVC%E7%9A%84%E6%95%B0%E7%BB%84%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A/"/>
      <url>/2017/10/24/SpringMVC%E7%9A%84%E6%95%B0%E7%BB%84%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A/</url>
      
        <content type="html"><![CDATA[<h1 id="基本代码"><a href="#基本代码" class="headerlink" title="基本代码"></a>基本代码</h1><h2 id="项目基础代码"><a href="#项目基础代码" class="headerlink" title="项目基础代码"></a>项目基础代码</h2><p><a href="/2017/10/23/SpringMVC的pojo参数绑定/">SpringMVC的pojo参数绑定/</a><br>底下代码基本相同</p><h2 id="本文中的文件结构"><a href="#本文中的文件结构" class="headerlink" title="本文中的文件结构"></a>本文中的文件结构</h2><p><img src="/images/springmvc/20191022012.png" alt></p><h2 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h2><p>这个页面有改动,增加checkbox,用以传到服务器的变量的内容是一个参数</p><ul><li><p>index.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag"><span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>spring MVC POJO<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"testPojo.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">用户名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">省:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"address.province"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">市:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"address.city"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"ids"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"run"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>跑步<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"ids"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"soccer"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>踢球<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"ids"</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"ski"</span>/&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>滑雪<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"testPojoSubmit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>success.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag"><span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>spring MVC POJO<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"testPojo.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">username:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">password:<span class="tag">&lt;<span class="name">input</span><span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">province:<span class="tag">&lt;<span class="name">input</span><span class="attr">name</span>=<span class="string">"address.province"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">city:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"address.city"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"testPojoSubmit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="pojo"><a href="#pojo" class="headerlink" title="pojo"></a>pojo</h2><ul><li><p>下方pojo代码使用了Lombok的注解语法</p><ul><li>可以看这里:<a href="/2017/10/23/Lombok简化你的代码/">Lombok简化你的代码</a></li><li>添加依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.14.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>User.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="keyword">private</span> Address address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Address.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String province;</span><br><span class="line"><span class="keyword">private</span> String city;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h2><p>这个代码有改动,新增了<code>String[] ids</code>用以接受页面传进来的数值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjc.springmvc.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPojoController</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUCCESS = <span class="string">"success"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/index"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testPojoIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">mav.setViewName(<span class="string">"index"</span>);</span><br><span class="line"><span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/testPojo"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testPojo</span><span class="params">(User user, String[] ids)</span> </span>&#123;</span><br><span class="line">System.out.println(</span><br><span class="line"><span class="string">"username="</span> + user.getUsername() +</span><br><span class="line"><span class="string">",password="</span> + user.getPassword() +</span><br><span class="line"><span class="string">",province="</span> + user.getAddress().getProvince() +</span><br><span class="line"><span class="string">",city="</span> + user.getAddress().getCity()</span><br><span class="line">);</span><br><span class="line">System.out.println(<span class="string">"---------------------"</span>);</span><br><span class="line"><span class="keyword">for</span> (String id : ids) &#123;</span><br><span class="line">System.out.println(id);</span><br><span class="line">System.out.println(<span class="string">"--------"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="跑项目"><a href="#跑项目" class="headerlink" title="跑项目"></a>跑项目</h2><p>访问<code>http://localhost:8080/springhello/index.action</code>,可以看到如下页面,输入数据提交</p><p><img src="/images/springmvc/20191023001.png" alt></p><p>在eclipse控制台中打出如下数据<br><img src="/images/springmvc/20191023002.png" alt></p><h1 id="问题-如果后台中有两个相同的变量用以接收前台传进来的变量-此时会怎样"><a href="#问题-如果后台中有两个相同的变量用以接收前台传进来的变量-此时会怎样" class="headerlink" title="问题:如果后台中有两个相同的变量用以接收前台传进来的变量,此时会怎样?"></a>问题:如果后台中有两个相同的变量用以接收前台传进来的变量,此时会怎样?</h1><h2 id="做一点改造"><a href="#做一点改造" class="headerlink" title="做一点改造"></a>做一点改造</h2><ol><li><p>在User.java中增加ids变量</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="keyword">private</span> Address address;</span><br><span class="line"><span class="keyword">private</span> String[] ids;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>控制器中打印user变量和ids变量</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjc.springmvc.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPojoController</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUCCESS = <span class="string">"success"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/index"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testPojoIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">mav.setViewName(<span class="string">"index"</span>);</span><br><span class="line"><span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/testPojo"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testPojo</span><span class="params">(User user, String[] ids)</span> </span>&#123;</span><br><span class="line">System.out.println(user);</span><br><span class="line">System.out.println(<span class="string">"---------------------"</span>);</span><br><span class="line"><span class="keyword">for</span> (String id : ids) &#123;</span><br><span class="line">System.out.println(id);</span><br><span class="line">System.out.println(<span class="string">"--------"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="跑项目-1"><a href="#跑项目-1" class="headerlink" title="跑项目"></a>跑项目</h2><p>访问<code>http://localhost:8080/springhello/index.action</code>,输入数据提交<br>在eclipse控制台中打出如下数据<br><img src="/images/springmvc/20191023003.png" alt></p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>只要名字相同,会将前台传进来的变量赋值给每个名字相同的变量</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lombok简化你的代码</title>
      <link href="/2017/10/23/Lombok%E7%AE%80%E5%8C%96%E4%BD%A0%E7%9A%84%E4%BB%A3%E7%A0%81/"/>
      <url>/2017/10/23/Lombok%E7%AE%80%E5%8C%96%E4%BD%A0%E7%9A%84%E4%BB%A3%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1 id="原文地址"><a href="#原文地址" class="headerlink" title="原文地址"></a>原文地址</h1><p><a href="http://kriszhang.com/lombok/" target="_blank" rel="noopener">使用Lombok简化你的代码:http://kriszhang.com/lombok/</a></p><h1 id="什么是Lokmob"><a href="#什么是Lokmob" class="headerlink" title="什么是Lokmob"></a>什么是Lokmob</h1><ul><li>Lombok意味龙目岛，该岛是巴厘岛的一座附属岛屿，风景优美</li><li>本文要介绍的Lombok，是java的一个强大工具，能极大的减少代码量，并使代码更加整洁清晰。<br>总结 -&gt; 减少java代码量的工具</li></ul><h1 id="添加Lombok支持"><a href="#添加Lombok支持" class="headerlink" title="添加Lombok支持"></a>添加Lombok支持</h1><h2 id="eclipse添加Lombok支持"><a href="#eclipse添加Lombok支持" class="headerlink" title="eclipse添加Lombok支持"></a>eclipse添加Lombok支持</h2><ol><li>下载Lombok的jar包,放在eclipse的根目录下<br><img src="/images/lombok/20191022007.png" alt></li><li>安装<br>在根目录下使用<br><img src="/images/lombok/20191022008.png" alt><br>弹出如下页面,进行安装<br><img src="/images/lombok/20191022001.png" alt><br><img src="/images/lombok/20191022002.png" alt><br><img src="/images/lombok/20191022003.png" alt><br><img src="/images/lombok/20191022004.png" alt></li><li>安装完毕可以在eclipse.ini文件看到新增了如下内容<br><img src="/images/lombok/20191022009.png" alt></li></ol><h2 id="IDEA添加Lombok支持"><a href="#IDEA添加Lombok支持" class="headerlink" title="IDEA添加Lombok支持"></a>IDEA添加Lombok支持</h2><p>原文里面有</p><h1 id="项目添加maven依赖"><a href="#项目添加maven依赖" class="headerlink" title="项目添加maven依赖"></a>项目添加maven依赖</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.14.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h1><h2 id="生成Getter-Setter方法"><a href="#生成Getter-Setter方法" class="headerlink" title="生成Getter/Setter方法"></a>生成Getter/Setter方法</h2><p>考虑实体对象Community，有四个属性，一般情况下我们会使用idea生成工具，生成Getter和Setter方法。如下代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property communityId.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> property value of communityId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCommunityId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> communityId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property communityId.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> communityId value to be assigned to property communityId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCommunityId</span><span class="params">(String communityId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.communityId = communityId;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property name.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> property value of name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property name.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name value to be assigned to property name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property title.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> property value of title</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> title;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property title.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> title value to be assigned to property title</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTitle</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property type.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> property value of type</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property type.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type value to be assigned to property type</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setType</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>采用lombok则可以直接：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Getter</span> <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="meta">@Getter</span> <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Getter</span> <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="meta">@Getter</span> <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@Getter和@Setter都可以单独定义函数的访问等级：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Getter</span> (AccessLevel.PUBLIC)</span><br><span class="line">    <span class="meta">@Setter</span>(AccessLevel.PRIVATE)</span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="meta">@Getter</span>(AccessLevel.PUBLIC)</span><br><span class="line">    <span class="meta">@Setter</span>(AccessLevel.PUBLIC)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Getter</span>(AccessLevel.PUBLIC)</span><br><span class="line">    <span class="meta">@Setter</span>(AccessLevel.PUBLIC)</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="meta">@Getter</span>(AccessLevel.PUBLIC)</span><br><span class="line">    <span class="meta">@Setter</span>(AccessLevel.PUBLIC)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果都是public，则代码可以更加简洁：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span> <span class="meta">@Setter</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="生成构造方法"><a href="#生成构造方法" class="headerlink" title="生成构造方法"></a>生成构造方法</h2><p>如果我们要给Community实体类生成构造方法，那么可以如下代码示例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Community</span><span class="params">(String communityId, String name, String title, <span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.communityId = communityId;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Community</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Community</span><span class="params">(String communityId, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.communityId = communityId;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到很麻烦，也很混乱，如果使用lombok则变得清晰简洁：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span>(staticName=<span class="string">"of"</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="meta">@NonNull</span> <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@NonNull</span> <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中</p><ol><li>@AllArgsConstructor用来指定全参数构造器</li><li>@NoArgsConstructor用来指定无参数构造器</li><li>@RequiredArgsConstructor用来指定参数（采用静态方法of访问）</li></ol><h2 id="生成equals、hashcode、toString"><a href="#生成equals、hashcode、toString" class="headerlink" title="生成equals、hashcode、toString"></a>生成equals、hashcode、toString</h2><p>我们在来看，如果需要生成equals、hashcode、toString呢？按照平常的做法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) &#123; <span class="keyword">return</span> <span class="keyword">true</span>; &#125;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) &#123; <span class="keyword">return</span> <span class="keyword">false</span>; &#125;</span><br><span class="line">        Community community = (Community)o;</span><br><span class="line">        <span class="keyword">if</span> (type != community.type) &#123; <span class="keyword">return</span> <span class="keyword">false</span>; &#125;</span><br><span class="line">        <span class="keyword">if</span> (communityId != <span class="keyword">null</span> ? !communityId.equals(community.communityId) : community.communityId != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (name != <span class="keyword">null</span> ? !name.equals(community.name) : community.name != <span class="keyword">null</span>) &#123; <span class="keyword">return</span> <span class="keyword">false</span>; &#125;</span><br><span class="line">        <span class="keyword">return</span> title != <span class="keyword">null</span> ? title.equals(community.title) : community.title == <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = communityId != <span class="keyword">null</span> ? communityId.hashCode() : <span class="number">0</span>;</span><br><span class="line">        result = <span class="number">31</span> * result + (name != <span class="keyword">null</span> ? name.hashCode() : <span class="number">0</span>);</span><br><span class="line">        result = <span class="number">31</span> * result + (title != <span class="keyword">null</span> ? title.hashCode() : <span class="number">0</span>);</span><br><span class="line">        result = <span class="number">31</span> * result + type;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Community&#123;"</span> +</span><br><span class="line">            <span class="string">"communityId='"</span> + communityId + <span class="string">'\''</span> +</span><br><span class="line">            <span class="string">", name='"</span> + name + <span class="string">'\''</span> +</span><br><span class="line">            <span class="string">", title='"</span> + title + <span class="string">'\''</span> +</span><br><span class="line">            <span class="string">", type="</span> + type +</span><br><span class="line">            <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，代码相当的恼人，如果使用lombok：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果我们只需要是否name作为equals和hashcode的运算字段，并且不想将title toString出来：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ToString</span>(exclude = &#123;<span class="string">"title"</span>&#125;)</span><br><span class="line"><span class="meta">@EqualsAndHashCode</span>(of = &#123;<span class="string">"name"</span>&#125;)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结合上面所有的实例，我们可以使用如下代码就能完成平常需要上百行代码才能完成的事情：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span>(staticName=<span class="string">"of"</span>)</span><br><span class="line"><span class="meta">@Getter</span> <span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span>(exclude = &#123;<span class="string">"title"</span>&#125;)</span><br><span class="line"><span class="meta">@EqualsAndHashCode</span>(of = &#123;<span class="string">"name"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="meta">@NonNull</span> <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@NonNull</span> <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Data一个等于所有"><a href="#Data一个等于所有" class="headerlink" title="@Data一个等于所有"></a>@Data一个等于所有</h2><p>我们可以看到，上节中类上面打了好多注解，还是显得有些乱。<br>如果我们没有要求那么多定制化需求，则可以直接使用@Data注解，他包含了：@Getter @Setter @ToString @EqualsAndHashCode RequiredArgsConstructor注解，因此可以简化为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span>(staticConstructor=<span class="string">"of"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="meta">@NonNull</span> <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@NonNull</span> <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Builder模式"><a href="#Builder模式" class="headerlink" title="Builder模式"></a>Builder模式</h2><p>有的时候，我们喜欢采用Builder模式去构造一个对象，比如如下代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">    <span class="meta">@java</span>.beans.ConstructorProperties(&#123;<span class="string">"communityId"</span>, <span class="string">"name"</span>, <span class="string">"title"</span>, <span class="string">"type"</span>&#125;)</span><br><span class="line">    Community(String communityId, String name, String title, <span class="keyword">int</span> type) &#123;</span><br><span class="line">        <span class="keyword">this</span>.communityId = communityId;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CommunityBuilder <span class="title">builder</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> CommunityBuilder();&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CommunityBuilder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String communityId;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> String title;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">        CommunityBuilder() &#123;&#125;</span><br><span class="line">        <span class="keyword">public</span> Community.<span class="function">CommunityBuilder <span class="title">communityId</span><span class="params">(String communityId)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.communityId = communityId;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> Community.<span class="function">CommunityBuilder <span class="title">name</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> Community.<span class="function">CommunityBuilder <span class="title">title</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.title = title;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> Community.<span class="function">CommunityBuilder <span class="title">type</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.type = type;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Community <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Community(communityId, name, title, type);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"com.qunar.kris.share.misc.lombok.Community.CommunityBuilder(communityId="</span> + <span class="keyword">this</span>.communityId</span><br><span class="line">                + <span class="string">", name="</span></span><br><span class="line">                + <span class="keyword">this</span>.name + <span class="string">", title="</span> + <span class="keyword">this</span>.title + <span class="string">", type="</span> + <span class="keyword">this</span>.type + <span class="string">")"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后我们可以这么使用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       Community community = Community.builder()</span><br><span class="line">           .communityId(<span class="string">"zzz"</span>)</span><br><span class="line">           .name(<span class="string">"xxx"</span>)</span><br><span class="line">           .title(<span class="string">"yyy"</span>)</span><br><span class="line">           .type(<span class="number">1</span>).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述创建builder的方式是在是太麻烦了，这只是4个参数，如果更多的参数，可想而知代码量啊！使用Lombok则很简单：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String communityId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> type;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上均是在日常项目中非常常用的特性，我们再来看一些使用频率较低的特性</p><h1 id="其他特性"><a href="#其他特性" class="headerlink" title="其他特性"></a>其他特性</h1><h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>捕获全局异常，我们经常使用如下代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        invokeMethodMayThrowExeption();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> MyException) &#123;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//swallow it</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用lombok可以简化为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SneakyThrows</span>(MyException.class)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    invokeMethodMayThrowExeption();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="logger"><a href="#logger" class="headerlink" title="logger"></a>logger</h2><p>如果我们要打日志，经常创建如下日志静态对象：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="string">"MY-LOGGER"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们采用lombok简化一下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j(topic = <span class="string">"MY-LOGGER"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Community</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>没有用slf4j?没有关系，除了slf4j还支持如下Logger:</p><ul><li>@XSlf4j</li><li>@Log4j</li><li>@Log4j2</li><li>@Log</li><li>@CommonsLog</li></ul><h2 id="空指针异常的快速失败"><a href="#空指针异常的快速失败" class="headerlink" title="空指针异常的快速失败"></a>空指针异常的快速失败</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doMethod</span><span class="params">(@NonNull String name, @NonNull String title)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上代码，当name或者title为空的时候，则会直接抛出NPE，快速失败。</p><h2 id="简化烦人的类型"><a href="#简化烦人的类型" class="headerlink" title="简化烦人的类型"></a>简化烦人的类型</h2><p>有的时候，我们可能会有非常长的泛型，很恼人：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Map&lt;String, List&lt;Community&gt;&gt;&gt; map = <span class="keyword">new</span> HashMap&lt;String, Map&lt;String, List&lt;Community&gt;&gt;();</span><br><span class="line">       <span class="keyword">for</span> (Entry&lt;String, Map&lt;String, List&lt;Community&gt;&gt;&gt; entry : map.entrySet()) &#123;</span><br><span class="line">           <span class="comment">//.....</span></span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><p>采用lombok可以简化为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val map = Maps.&lt;String, Map&lt;String, List&lt;Community&gt;&gt;&gt;newHashMap();</span><br><span class="line"><span class="keyword">for</span> (val entry : map.entrySet()) &#123;</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然，在jdk8下，一般使用foreach进行遍历。</p><h1 id="基本实现原理"><a href="#基本实现原理" class="headerlink" title="基本实现原理"></a>基本实现原理</h1><p>lombok魔法并不神秘，他采用JSR269所提出的插入式注解处理(Pluggable Annotation Processing)，并结合动态代码生成技术所开发的。如下图所示：<br><img src="/images/lombok/20171022001.png" alt><br>上图展示了一个一般javac的编译过程，java文件首先通过进行解析构建出一个AST，然后执行注解处理，最后经过分析优化生成二进制的.class文件。</p><p>我们能做到的是，在注解处理阶段进行一些相应处理。首先我们在META-INF.services下创建如下文件：</p><p>文件中指定我们的注解处理器：com.alipay.kris.other.lombok.MyAnnotaionProcessor<br><img src="/images/lombok/20171022002.png" alt></p><p>然后我们接可以编写自己的注解处理器，一个简单的实例代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SupportedSourceVersion</span>(SourceVersion.RELEASE_8)</span><br><span class="line"><span class="meta">@SupportedAnnotationTypes</span>(<span class="string">"com.alipay.kris.other.lombok.*"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAnnotaionProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyAnnotaionProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations,RoundEnvironment roundEnv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Element elem : roundEnv.getElementsAnnotatedWith(MyAnnotation.class)) &#123;</span><br><span class="line">            MyAnnotation annotation = elem.getAnnotation(MyAnnotation.class);</span><br><span class="line">            String message = <span class="string">"annotation found in "</span> + elem.getSimpleName()</span><br><span class="line">                + <span class="string">" with  "</span> + annotation.value();</span><br><span class="line">            addToString(elem);</span><br><span class="line">            processingEnv.getMessager().printMessage(Diagnostic.Kind.NOTE, message);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">// no further processing of this annotation type</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们能做到的也就是这么多，但lombok在此基础之上，对AST进行修改，将Setter/Getter等上文提到过的方法’挂载’到AST中</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lombok </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC的pojo参数绑定</title>
      <link href="/2017/10/23/SpringMVC%E7%9A%84pojo%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A/"/>
      <url>/2017/10/23/SpringMVC%E7%9A%84pojo%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A/</url>
      
        <content type="html"><![CDATA[<h1 id="基本代码"><a href="#基本代码" class="headerlink" title="基本代码"></a>基本代码</h1><h2 id="项目基础代码"><a href="#项目基础代码" class="headerlink" title="项目基础代码"></a>项目基础代码</h2><p><a href="/2017/10/04/SpringMVC的快速入门/">SpringMVC的快速入门</a></p><h2 id="本文中的文件结构"><a href="#本文中的文件结构" class="headerlink" title="本文中的文件结构"></a>本文中的文件结构</h2><p><img src="/images/springmvc/20191022012.png" alt></p><h2 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h2><ul><li><p>index.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag"><span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>spring MVC POJO<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"testPojo.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">username:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">password:<span class="tag">&lt;<span class="name">input</span><span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">province:<span class="tag">&lt;<span class="name">input</span><span class="attr">name</span>=<span class="string">"address.province"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">city:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"address.city"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"testPojoSubmit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>success.jsp</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag"><span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>spring MVC POJO<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"testPojo.action"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">username:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">password:<span class="tag">&lt;<span class="name">input</span><span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"password"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">province:<span class="tag">&lt;<span class="name">input</span><span class="attr">name</span>=<span class="string">"address.province"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">city:<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"address.city"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"testPojoSubmit"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="pojo"><a href="#pojo" class="headerlink" title="pojo"></a>pojo</h2><ul><li><p>下方pojo代码使用了Lombok的注解语法</p><ul><li>可以看这里:<a href="/2017/10/23/Lombok简化你的代码/">Lombok简化你的代码</a></li><li>添加依赖<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.14.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>User.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String username;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="keyword">private</span> Address address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Address.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String province;</span><br><span class="line"><span class="keyword">private</span> String city;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.zjc.springmvc.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.zjc.springmvc.pojo.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPojoController</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUCCESS = <span class="string">"success"</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/index"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testPojoIndex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line">mav.setViewName(<span class="string">"index"</span>);</span><br><span class="line"><span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"/testPojo"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testPojo</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">System.out.println(</span><br><span class="line"><span class="string">"username="</span> + user.getUsername() +</span><br><span class="line"><span class="string">",password="</span> + user.getPassword() +</span><br><span class="line"><span class="string">",province="</span> + user.getAddress().getProvince() +</span><br><span class="line"><span class="string">",city="</span> + user.getAddress().getCity()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="解决post乱码问题"><a href="#解决post乱码问题" class="headerlink" title="解决post乱码问题"></a>解决post乱码问题</h1><p>在web.xml中加入:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>characterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="跑项目"><a href="#跑项目" class="headerlink" title="跑项目"></a>跑项目</h1><p>访问<code>http://localhost:8080/springhello/index.action</code>,可以看到如下页面,输入数据提交</p><p><img src="/images/springmvc/20191022010.png" alt></p><p>在eclipse控制台中打出如下数据<br><img src="/images/springmvc/20191022011.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC的简单的参数绑定</title>
      <link href="/2017/10/08/SpringMVC%E7%9A%84%E7%AE%80%E5%8D%95%E7%9A%84%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A/"/>
      <url>/2017/10/08/SpringMVC%E7%9A%84%E7%AE%80%E5%8D%95%E7%9A%84%E5%8F%82%E6%95%B0%E7%BB%91%E5%AE%9A/</url>
      
        <content type="html"><![CDATA[<h1 id="参数绑定的三种方式"><a href="#参数绑定的三种方式" class="headerlink" title="参数绑定的三种方式"></a>参数绑定的三种方式</h1><p>这是截图,具体代码在底下<br><img src="/images/springmvc/20191007003.png" alt></p><h2 id="方式一-使用HttpServletRequest"><a href="#方式一-使用HttpServletRequest" class="headerlink" title="方式一:使用HttpServletRequest"></a>方式一:使用<code>HttpServletRequest</code></h2><p>使用<code>HttpServletRequest</code>获取参数</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"getParameter1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getParameter1</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"><span class="comment">// get方式获取参数</span></span><br><span class="line">String id = request.getParameter(<span class="string">"id"</span>);</span><br><span class="line">System.out.println(id);</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="方式二-保持变量名一致"><a href="#方式二-保持变量名一致" class="headerlink" title="方式二:保持变量名一致"></a>方式二:保持变量名一致</h2><p>浏览器中使用如下url进行访问,浏览器中的参数名要和方法中的参数保持一致<br><a href="http://localhost:8080/springhello/hello.action?id=1" target="_blank" rel="noopener">http://localhost:8080/springhello/hello.action?id=1</a></p><p>代码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"getParameter2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getParameter2</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">System.out.println(id);</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>支持的数据类型为<strong>包装类数据类型</strong></p><h2 id="方式三-使用-RequestParam"><a href="#方式三-使用-RequestParam" class="headerlink" title="方式三:使用@RequestParam"></a>方式三:使用<code>@RequestParam</code></h2><p>浏览器中使用如下url进行访问<br><a href="http://localhost:8080/springhello/hello.action?id=1" target="_blank" rel="noopener">http://localhost:8080/springhello/hello.action?id=1</a></p><p>代码如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"getParameter3"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getParameter3</span><span class="params">(@RequestParam(value=<span class="string">"id"</span>, required=<span class="keyword">true</span>, defaultValue=<span class="string">"1"</span>)</span> Integer idaaaaaa) </span>&#123;</span><br><span class="line">System.out.println(idaaaaaa);</span><br><span class="line"><span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中@RequestParam的参数</p><ul><li>value=”id”,这里要和url中的id保持一致</li><li>required=true,该参数必须要有(如果没有默认值会报错)</li><li>defaultValue=”1”,当请求中没有传入id的时候,id的默认值为1</li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC的默认组件加载</title>
      <link href="/2017/10/06/SpringMVC%E7%9A%84%E9%BB%98%E8%AE%A4%E7%BB%84%E4%BB%B6%E5%8A%A0%E8%BD%BD/"/>
      <url>/2017/10/06/SpringMVC%E7%9A%84%E9%BB%98%E8%AE%A4%E7%BB%84%E4%BB%B6%E5%8A%A0%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="默认组件加载选择"><a href="#默认组件加载选择" class="headerlink" title="默认组件加载选择"></a>默认组件加载选择</h1><h2 id="配置处理器映射器和处理器适配器"><a href="#配置处理器映射器和处理器适配器" class="headerlink" title="配置处理器映射器和处理器适配器"></a>配置处理器映射器和处理器适配器</h2><p>从Spring3.1版本开始,废除了DefaultAnnotationHandlerMapping的使用,推荐使用RequestMappingHanddlerMapping完成注解处理器映射<br>而处理器映射器和处理器适配器是成对出现的,所以要跟着改(事实上只该处理器映射器,没改处理器适配器的情况下,运行是会直接报500错误的)</p><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><ol><li><p>处理器映射器<br><img src="/images/springmvc/20191006001.png" alt><br>在Spring的核心配置文件进行配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"</span> /&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>处理器适配器<br>在Spring的核心配置文件进行配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置处理器适配器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span> /&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>完整的springmvc.xml文件如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-context-4.3.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置controller扫描包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置处理器映射 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置处理器适配器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>配置注解驱动,相当于同时使用最新的处理器映射器和处理器适配器,同时提供对json数据响应的支持<br><img src="/images/springmvc/20191006003.png" alt><br>具体代码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-context-4.3.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置controller扫描包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置注解驱动,相当于同时使用最新处理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="配置视图解析器"><a href="#配置视图解析器" class="headerlink" title="配置视图解析器"></a>配置视图解析器</h2><ol><li>作用<br><img src="/images/springmvc/20191006004.png" alt></li><li>要实现上述效果,需要如下配置视图解析器<br><img src="/images/springmvc/20191006005.png" alt></li><li>具体代码<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置前缀 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置后缀 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="核心类与接口"><a href="#核心类与接口" class="headerlink" title="核心类与接口"></a>核心类与接口</h1><p><a href="https://www.iteye.com/blog/elf8848-875830" target="_blank" rel="noopener">参考:https://www.iteye.com/blog/elf8848-875830</a></p><p>先来了解一下，几个重要的接口与类。现在不知道他们是干什么的没关系，先混个脸熟，为以后认识他们打个基础。</p><h3 id="DispatcherServlet-–-前置控制器"><a href="#DispatcherServlet-–-前置控制器" class="headerlink" title="DispatcherServlet   – 前置控制器"></a>DispatcherServlet   – 前置控制器</h3><p><img src="/images/springmvc/20191005011.png" alt></p><h3 id="HandlerMapping接口-–-处理请求的映射"><a href="#HandlerMapping接口-–-处理请求的映射" class="headerlink" title="HandlerMapping接口 – 处理请求的映射"></a>HandlerMapping接口 – 处理请求的映射</h3><ul><li>HandlerMapping接口的实现类<ul><li>SimpleUrlHandlerMapping  通过配置文件，把一个URL映射到Controller</li><li>DefaultAnnotationHandlerMapping  通过注解，把一个URL映射到Controller类上</li></ul></li></ul><p><img src="/images/springmvc/20191005017.png" alt></p><h3 id="HandlerAdapter接口-–-处理请求的映射"><a href="#HandlerAdapter接口-–-处理请求的映射" class="headerlink" title="HandlerAdapter接口 – 处理请求的映射"></a>HandlerAdapter接口 – 处理请求的映射</h3><ul><li>AnnotationMethodHandlerAdapter类，通过注解，把一个URL映射到Controller类的方法上</li></ul><p><img src="/images/springmvc/20191005018.png" alt></p><h3 id="Controller接口-–-控制器"><a href="#Controller接口-–-控制器" class="headerlink" title="Controller接口 – 控制器"></a>Controller接口 – 控制器</h3><p>由于我们使用了@Controller注解，添加了@Controller注解注解的类就可以担任控制器（Action）的职责,<br>所以我们并没有用到这个接口。<br><img src="/images/springmvc/20191005015.png" alt></p><h3 id="HandlerInterceptor-接口–拦截器"><a href="#HandlerInterceptor-接口–拦截器" class="headerlink" title="HandlerInterceptor 接口–拦截器"></a>HandlerInterceptor 接口–拦截器</h3><p>无图，我们自己实现这个接口，来完成拦截的器的工作</p><h3 id="ViewResolver接口的实现类"><a href="#ViewResolver接口的实现类" class="headerlink" title="ViewResolver接口的实现类"></a>ViewResolver接口的实现类</h3><ul><li>UrlBasedViewResolver类 通过配置文件，把一个视图名交给到一个View来处理</li><li>InternalResourceViewResolver类，比上面的类，加入了JSTL的支持</li></ul><p><img src="/images/springmvc/20191005016.png" alt></p><h3 id="View接口"><a href="#View接口" class="headerlink" title="View接口"></a>View接口</h3><ul><li>JstlView类</li></ul><p><img src="/images/springmvc/20191005019.png" alt></p><h3 id="LocaleResolver接口"><a href="#LocaleResolver接口" class="headerlink" title="LocaleResolver接口"></a>LocaleResolver接口</h3><p><img src="/images/springmvc/20191005020.png" alt></p><ul><li>HandlerExceptionResolver接口 –异常处理<ul><li>SimpleMappingExceptionResolver实现类</li></ul></li></ul><p><img src="/images/springmvc/20191005022.png" alt></p><h3 id="ModelAndView类"><a href="#ModelAndView类" class="headerlink" title="ModelAndView类"></a>ModelAndView类</h3><p>无图</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC的基本流程</title>
      <link href="/2017/10/06/SpringMVC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B/"/>
      <url>/2017/10/06/SpringMVC%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="从请求到响应"><a href="#从请求到响应" class="headerlink" title="从请求到响应"></a>从请求到响应</h1><p><img src="/images/springmvc/20191005007.png" alt></p><ol><li>访问<a href="http://localhost:8080/springhello/hello.action" target="_blank" rel="noopener">http://localhost:8080/springhello/hello.action</a></li><li>web.xml文件配置了拦截规则</li><li>web.xml文件中规定要加载的核心控制器</li><li>web.xml文件中规定了要对<code>*.action</code>的请求进行拦截</li><li>web.xml文件中规定了要加载的SpingMVC的核心配置文件(其实就是底层的Spring)</li><li>springmvc.xml文件中规定了要扫描的包是<code>com</code></li><li>这里用<code>HelloController.java</code>进行说明</li><li>由于我们需要扫描的包是<code>com</code>,所有<code>com</code>底下的所有类都需要扫</li><li>扫描包下所有的文件,找出所有有<code>@Controller</code>标记的类</li><li>找到所有<code>@RequestMapping</code>标记,此时可以知道,我们存在映射<code>hello</code></li><li>由于我们访问的url是<code>hello.action</code>,所以需要执行被<code>@RequestMapping(&quot;/hello&quot;)</code>标记的函数(也就是控制器内的函数),最后返回hello.jsp文件</li></ol><h1 id="画图说明"><a href="#画图说明" class="headerlink" title="画图说明"></a>画图说明</h1><p><img src="/images/springmvc/20191007002.png" alt></p><p>组件说明在这里<br><a href="/2017/10/07/SpringMVC的默认组件加载/">SpringMVC的默认组件加载</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eclipse中如何查询一个类的继承关系</title>
      <link href="/2017/10/06/eclipse%E4%B8%AD%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB/"/>
      <url>/2017/10/06/eclipse%E4%B8%AD%E5%A6%82%E4%BD%95%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%B8%AA%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="方法一：ctrl-shift-H-输入类名"><a href="#方法一：ctrl-shift-H-输入类名" class="headerlink" title="方法一：ctrl+shift+H 输入类名"></a>方法一：ctrl+shift+H 输入类名</h1><p><img src="/images/springmvc/20191005001.png" alt><br>打开之后可以看到如下页面<br><img src="/images/springmvc/20191005002.png" alt></p><h1 id="方法二：点选类名-按-F4"><a href="#方法二：点选类名-按-F4" class="headerlink" title="方法二：点选类名 按 F4"></a>方法二：点选类名 按 F4</h1><p><img src="/images/springmvc/20191005003.png" alt></p><h1 id="方法三-点选类名-按ctrl-t一次或者两次"><a href="#方法三-点选类名-按ctrl-t一次或者两次" class="headerlink" title="方法三:点选类名,按ctrl+t一次或者两次"></a>方法三:点选类名,按ctrl+t一次或者两次</h1><ul><li>按一次是查看父类<br><img src="/images/springmvc/20191005004.png" alt></li><li>按两次是倒序查看父类和接口<br><img src="/images/springmvc/20191005005.png" alt></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Eclipse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC的快速入门</title>
      <link href="/2017/10/04/SpringMVC%E7%9A%84%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/"/>
      <url>/2017/10/04/SpringMVC%E7%9A%84%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="快速入门案例"><a href="#快速入门案例" class="headerlink" title="快速入门案例"></a>快速入门案例</h1><h2 id="创建一个maven工程"><a href="#创建一个maven工程" class="headerlink" title="创建一个maven工程"></a>创建一个maven工程</h2><h3 id="修改pom-xml文件"><a href="#修改pom-xml文件" class="headerlink" title="修改pom.xml文件"></a>修改pom.xml文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zjc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springhello<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">springVersion</span>&gt;</span>3.2.5.RELEASE<span class="tag">&lt;/<span class="name">springVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 测试用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 添加springmvc依赖包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springVersion&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springVersion&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- jstl标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp.jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="本质上载入如下包"><a href="#本质上载入如下包" class="headerlink" title="本质上载入如下包"></a>本质上载入如下包</h3><p><img src="/images/springmvc/20191003001.png" alt><br><em>稍微解释一下</em></p><ol><li>与spring有关的包<blockquote><p>  aop -&gt; aop<br>  beans -&gt; bean工厂<br>  context -&gt; 上下文<br>  core -&gt; 核心<br>  expression -&gt; 表达式<br>  commons-logging -&gt; spring的依赖</p></blockquote></li><li>与springMVC有关的包<blockquote><p>  spring-web<br>  spring-webmvc</p></blockquote></li></ol><h1 id="配置web-xml"><a href="#配置web-xml" class="headerlink" title="配置web.xml"></a>配置web.xml</h1><p>web.xml从来都是与Servlet相关</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span></span><br><span class="line"><span class="tag"><span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">display-name</span>&gt;</span>springhello<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- The front controller of this Spring Web application, responsible for </span></span><br><span class="line"><span class="comment">handling all application requests --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 核心控制器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 这里要配置springmvc.xml文件 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- xml文件,文件名随意 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 因为底层是spring,所以这里要配置spinrg要扫描哪些包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>lasspath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Map all requests to the DispatcherServlet for handling --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springDispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.action<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="入门代码"><a href="#入门代码" class="headerlink" title="入门代码"></a>入门代码</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.springmvc.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span><span class="comment">//标识控制器</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>)<span class="comment">//用以绑定请求地址</span></span><br><span class="line"><span class="function"><span class="keyword">public</span>  ModelAndView <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">"Hello SpringMVC..."</span>);</span><br><span class="line">ModelAndView mav = <span class="keyword">new</span> ModelAndView();</span><br><span class="line"><span class="comment">// 设置模型数据,用于传递到jsp</span></span><br><span class="line">mav.addObject(<span class="string">"msg"</span>, <span class="string">"hellomvc...."</span>);</span><br><span class="line"><span class="comment">// 设定视图名字,用于响应用户</span></span><br><span class="line">mav.setViewName(<span class="string">"/WEB-INF/jsp/hello.jsp"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="配置包扫描"><a href="#配置包扫描" class="headerlink" title="配置包扫描"></a>配置包扫描</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">http://www.springframework.org/schema/context/spring-context-4.3.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.3.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置controller扫描包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="将项目加入tomcat-浏览器访问"><a href="#将项目加入tomcat-浏览器访问" class="headerlink" title="将项目加入tomcat,浏览器访问"></a>将项目加入tomcat,浏览器访问</h1><p><img src="/images/springmvc/20191005006.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java容器线程不安全该如何处理</title>
      <link href="/2017/08/11/%E9%9B%86%E5%90%88%E7%B1%BB%E4%B8%8D%E5%AE%89%E5%85%A8/"/>
      <url>/2017/08/11/%E9%9B%86%E5%90%88%E7%B1%BB%E4%B8%8D%E5%AE%89%E5%85%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h1><h2 id="新建与扩容"><a href="#新建与扩容" class="headerlink" title="新建与扩容"></a>新建与扩容</h2><ol><li>新建 =&gt; 新建一个长度为10的object数组(确切来说,是一个空引用,当第一次add,才新建一个长度为10的数组)</li><li>第一次扩容 =&gt; 增加原先值的一半,即扩容到<code>(10 * 3) / 2 + 1 = 16</code></li><li>第二次扩容 =&gt; 增加原先值的一半,即扩容 <code>(16 * 3) / 2 + 1 = 25</code></li><li>源码如下<br><img src="/images/2020/08/20200811174627.png" alt></li></ol><h2 id="线程不安全-gt-如何证明与解决方案"><a href="#线程不安全-gt-如何证明与解决方案" class="headerlink" title="线程不安全 =&gt; 如何证明与解决方案"></a>线程不安全 =&gt; 如何证明与解决方案</h2><h3 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayListDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt;  &#123;</span><br><span class="line">                list.add(UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">8</span>));</span><br><span class="line">                System.out.println(list);</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>会出现并发修改异常<br><img src="/images/2020/08/20200811115435.png" alt></p><ul><li>ConcurrentModificationException:当方法检测到对象的并发修改，但不允许这种修改时，抛出此异常。<ul><li>迭代器是依赖于集合而存在的，在判断成功后，集合的中新添加了元素，而迭代器却不知道，所以就报错了，这个错叫并发修改异常。</li><li>简单描述就是：迭代器遍历元素的时候，通过集合是不能修改元素的。</li></ul></li></ul><h3 id="导致原因"><a href="#导致原因" class="headerlink" title="导致原因"></a>导致原因</h3><p>多线程并发争抢同一个类,且没有加锁</p><h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><ol><li><p>使用Vector,线程安全,但是降低并法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayListDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; list = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt;  &#123;</span><br><span class="line">                list.add(UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">8</span>));</span><br><span class="line">                System.out.println(list);</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用Collections集合接口的工具类(Collection =&gt; 集合的接口)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayListDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list = Collections.synchronizedList(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt;  &#123;</span><br><span class="line">                list.add(UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">8</span>));</span><br><span class="line">                System.out.println(list);</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>写时复制</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CopyOnWriteArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayListDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt;  &#123;</span><br><span class="line">                list.add(UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">8</span>));</span><br><span class="line">                System.out.println(list);</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="CopyOnWrite容器说明"><a href="#CopyOnWrite容器说明" class="headerlink" title="CopyOnWrite容器说明"></a>CopyOnWrite容器说明</h3><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><ul><li><a href="https://blog.csdn.net/u010002184/article/details/90452918" target="_blank" rel="noopener">CopyOnWriteArrayList原理，优缺点，使用场景</a></li><li><a href="http://ifeve.com/java-copy-on-write/" target="_blank" rel="noopener">聊聊并发-Java中的Copy-On-Write容器</a></li></ul><h4 id="什么是CopyOnWrite容器"><a href="#什么是CopyOnWrite容器" class="headerlink" title="什么是CopyOnWrite容器"></a>什么是CopyOnWrite容器</h4><ul><li>CopyOnWrite容器即写时复制的容器。</li><li>通俗的理解是当我们往一个容器添加元素的时候，不直接往当前容器添加，而是先将当前容器进行Copy，复制出一个新的容器</li><li>然后新的容器里添加元素，添加完元素之后，再将原容器的引用指向新的容器</li></ul><h4 id="有什么好处"><a href="#有什么好处" class="headerlink" title="有什么好处"></a>有什么好处</h4><ul><li>我们可以对CopyOnWrite容器进行并发的读，而不需要加锁,因为当前容器不会添加任何元素。</li><li>所以CopyOnWrite容器也是一种读写分离的思想，读和写不同的容器。</li></ul><h4 id="CopyOnWrite在多线程场景中的使用"><a href="#CopyOnWrite在多线程场景中的使用" class="headerlink" title="CopyOnWrite在多线程场景中的使用"></a>CopyOnWrite在多线程场景中的使用</h4><ul><li>具体代码中的区别如下(CopyOnWriteArrayList)<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多线程</span></span><br><span class="line"><span class="comment"> * 使用普通的ArrayList,不使用CopyOnWriteArrayList的情况</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">syncContainer1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt;  &#123;</span><br><span class="line">            <span class="comment">// 需要写同步块</span></span><br><span class="line">            <span class="keyword">synchronized</span> (list) &#123;</span><br><span class="line">                list.add(Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多线程</span></span><br><span class="line"><span class="comment"> * 使用CopyOnWriteArrayList的情况</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">syncContainer2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    CopyOnWriteArrayList&lt;String&gt; list = <span class="keyword">new</span> CopyOnWriteArrayList&lt;String&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt;  &#123;</span><br><span class="line">            <span class="comment">// 不需要写同步块</span></span><br><span class="line">            list.add(Thread.currentThread().getName());</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="CopyOnWriteArrayList的实现原理"><a href="#CopyOnWriteArrayList的实现原理" class="headerlink" title="CopyOnWriteArrayList的实现原理"></a>CopyOnWriteArrayList的实现原理</h4><ul><li>上述代码使用了CopyOnWriteArrayList，接下去我们看看其源码是如何实现的。以下代码是向CopyOnWriteArrayList中add方法的实现（向CopyOnWriteArrayList里添加元素），可以发现在添加的时候是需要加锁的，否则多线程写的时候会Copy出N个副本出来。</li><li>以下源码基于jdk1.8<ul><li>更新版本其实可以在搜索<code>synchronized</code>,是使用这个关键字实现的<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Appends the specified element to the end of this list.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e element to be appended to this list</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; (as specified by &#123;<span class="doctag">@link</span> Collection#add&#125;)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 当前线程进行写前要加锁</span></span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取旧数组</span></span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="comment">// 获取旧数组长度</span></span><br><span class="line">        <span class="keyword">int</span> len = elements.length;</span><br><span class="line">        <span class="comment">// 创建一个新的数组,长度比旧数组多1,并将旧数组拷贝进新的数组</span></span><br><span class="line">        Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 将要添加的元素添加进新的数组</span></span><br><span class="line">        newElements[len] = e;</span><br><span class="line">        <span class="comment">// 将原来指向旧数组的指针指向新的数组 </span></span><br><span class="line">        setArray(newElements);</span><br><span class="line">        <span class="comment">// 返回true表示成功</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 写结束,解锁</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Removes the element at the specified position in this list.</span></span><br><span class="line"><span class="comment"> * Shifts any subsequent elements to the left (subtracts one from their</span></span><br><span class="line"><span class="comment"> * indices).  Returns the element that was removed from the list.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IndexOutOfBoundsException &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="keyword">int</span> len = elements.length;</span><br><span class="line">        E oldValue = get(elements, index);</span><br><span class="line">        <span class="keyword">int</span> numMoved = len - index - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (numMoved == <span class="number">0</span>)</span><br><span class="line">            setArray(Arrays.copyOf(elements, len - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Object[] newElements = <span class="keyword">new</span> Object[len - <span class="number">1</span>];</span><br><span class="line">            System.arraycopy(elements, <span class="number">0</span>, newElements, <span class="number">0</span>, index);</span><br><span class="line">            System.arraycopy(elements, index + <span class="number">1</span>, newElements, index,</span><br><span class="line">                             numMoved);</span><br><span class="line">            setArray(newElements);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Replaces the element at the specified position in this list with the</span></span><br><span class="line"><span class="comment"> * specified element.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IndexOutOfBoundsException &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        E oldValue = get(elements, index);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (oldValue != element) &#123;</span><br><span class="line">            <span class="keyword">int</span> len = elements.length;</span><br><span class="line">            Object[] newElements = Arrays.copyOf(elements, len);</span><br><span class="line">            newElements[index] = element;</span><br><span class="line">            setArray(newElements);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Not quite a no-op; ensures volatile write semantics</span></span><br><span class="line">            setArray(elements);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><img src="/images/2020/08/20200811122702.png" alt></p><h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><ul><li>读的时候不需要加锁，如果读的时候有多个线程正在向CopyOnWriteArrayList添加数据，读还是会读到旧的数据，因为开始读的那一刻已经确定了读的对象是旧对象。</li><li>CopyOnWrite并发容器<strong>用于读多写少的并发场景</strong><ul><li>比如白名单，黑名单等场景</li></ul></li></ul><h4 id="CopyOnWrite的缺点"><a href="#CopyOnWrite的缺点" class="headerlink" title="CopyOnWrite的缺点"></a>CopyOnWrite的缺点</h4><p>CopyOnWrite容器有很多优点，但是同时也存在两个问题，即内存占用问题和数据一致性问题。所以在开发的时候需要注意一下。</p><ol><li><p><strong>内存占用问题</strong></p><ul><li>因为CopyOnWrite的写时复制机制，所以在进行写操作的时候，内存里会同时驻扎两个对象的内存，旧的对象和新写入的对象（注意:在复制的时候只是复制容器里的引用，只是在写的时候会创建新对象添加到新容器里，而旧容器的对象还在使用，所以有两份对象内存）。如果这些对象占用的内存比较大，比如说200M左右，那么再写入100M数据进去，内存就会占用300M，那么这个时候很有可能造成频繁的Yong GC和Full GC。之前我们系统中使用了一个服务由于每晚使用CopyOnWrite机制更新大对象，造成了每晚15秒的Full GC，应用响应时间也随之变长。</li><li>针对内存占用问题，可以通过压缩容器中的元素的方法来减少大对象的内存消耗，比如，如果元素全是10进制的数字，可以考虑把它压缩成36进制或64进制。或者不使用CopyOnWrite容器，而使用其他的并发容器，如ConcurrentHashMap。</li></ul></li><li><p><strong>数据一致性问题</strong></p><ul><li>CopyOnWrite容器只能保证数据的最终一致性，不能保证数据的实时一致性。所以如果你希望写入的的数据，马上能读到，请不要使用CopyOnWrite容器。</li></ul></li></ol><h3 id="优化建议"><a href="#优化建议" class="headerlink" title="优化建议"></a>优化建议</h3><ul><li>高并发情况下,可以使用JUC里的CopyOnWriteArrayList</li><li>java出现20年,不是极端情况下,大部分问题前人已经遇到过了,不建议重复造轮子</li></ul><h1 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h1><h2 id="新建与扩容-1"><a href="#新建与扩容-1" class="headerlink" title="新建与扩容"></a>新建与扩容</h2><ul><li>HashMap的位桶数组，初始大小为16</li><li>实际使用时，显然大小是可变的</li><li>如果位桶数组中的元素达到(0.75*数组 length)，就重新调整数组大小变为原来2倍大小</li><li>扩容很耗时</li><li>扩容的本质是定义新的更大的数组，并将旧数组内容挨个拷贝到新数组中<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.  新建 =&gt; 长度为16</span><br><span class="line">2.  第一次扩容 =&gt; 原先值的一倍,即扩容到32</span><br><span class="line">3.  第二次扩容 =&gt; 原先值的一倍,即扩容到64</span><br></pre></td></tr></table></figure></li></ul><h2 id="线程不安全-gt-如何证明与解决方案-1"><a href="#线程不安全-gt-如何证明与解决方案-1" class="headerlink" title="线程不安全 =&gt; 如何证明与解决方案"></a>线程不安全 =&gt; 如何证明与解决方案</h2><h3 id="故障现象-1"><a href="#故障现象-1" class="headerlink" title="故障现象"></a>故障现象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayListDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                map.put(Thread.currentThread().getName(), UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">8</span>));</span><br><span class="line">                System.out.println(map);</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/images/2020/08/20200811151703.png" alt></p><h3 id="解决方法-1"><a href="#解决方法-1" class="headerlink" title="解决方法"></a>解决方法</h3><ol><li><p>使用HashTable</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+   HashMap: 线程不安全，效率高。允许key或value为null。</span><br><span class="line">+   HashTable: 线程安全，效率低。不允许key或value为null。</span><br></pre></td></tr></table></figure></li><li><p>使用JUC里的ConcurrentHashMap</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjc.collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayListDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 使用ConcurrentHashMap替代HashMap</span></span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                map.put(Thread.currentThread().getName(), UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">8</span>));</span><br><span class="line">                System.out.println(map);</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h1><h2 id="HashSet是否安全"><a href="#HashSet是否安全" class="headerlink" title="HashSet是否安全"></a>HashSet是否安全</h2><ul><li><p>HashSet底层是HashMap<br><img src="/images/2020/08/20200811124845.png" alt></p></li><li><p>为什么HashSet的add方法只需要一个元素 =&gt; 是因为<br><img src="/images/2020/08/20200811125405.png" alt></p></li></ul><p>所以HashSet是不安全的</p><h2 id="解决方法-2"><a href="#解决方法-2" class="headerlink" title="解决方法"></a>解决方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CopyOnWriteArraySet&lt;Object&gt; copyOnWriteArraySet = <span class="keyword">new</span> CopyOnWriteArraySet&lt;&gt;();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中的容器</title>
      <link href="/2017/08/11/Java%E4%B8%AD%E7%9A%84%E5%AE%B9%E5%99%A8/"/>
      <url>/2017/08/11/Java%E4%B8%AD%E7%9A%84%E5%AE%B9%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Java集合层次图"><a href="#Java集合层次图" class="headerlink" title="Java集合层次图"></a>Java集合层次图</h1><p><img src="/images/2020/08/20200811214049.png" alt></p><h1 id="Collection接口"><a href="#Collection接口" class="headerlink" title="Collection接口"></a>Collection接口</h1><p>Collection 表示一组对象，它是集中、收集的意思。Collection接口的两个子接口是List、Set接口。<br><img src="/images/2020/08/20200811154511.png" alt><br>由于List、Set是Collection的子接口，意味着所有List、Set的实现类都有上面的方法。</p><h1 id="List系列"><a href="#List系列" class="headerlink" title="List系列"></a>List系列</h1><h2 id="List特点和常用方法"><a href="#List特点和常用方法" class="headerlink" title="List特点和常用方法"></a>List特点和常用方法</h2><h3 id="List基本说明"><a href="#List基本说明" class="headerlink" title="List基本说明"></a>List基本说明</h3><p>List是有序、可重复的容器。</p><ul><li>有序：List中每个元素都有索引标记。可以根据元素的索引标记(在List中的位置)访问元素，从而精确控制这些元素。</li><li>可重复：List允许加入重复的元素。更确切地讲，List通常允许满足 e1.equals(e2) 的元素重复加入容器。</li><li>除了Collection接口中的方法，List多了一些跟顺序(索引)有关的方法，参见下表：<br><img src="/images/2020/08/20200811154652.png" alt><br>List接口常用的实现类有3个：ArrayList、LinkedList和Vector。</li></ul><h3 id="List的常用方法"><a href="#List的常用方法" class="headerlink" title="List的常用方法"></a>List的常用方法</h3><ol><li>代码<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestList</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试add/remove/size/isEmpty/contains/clear/toArrays等方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        System.out.println(list.isEmpty()); <span class="comment">// true,容器里面没有元素</span></span><br><span class="line">        list.add(<span class="string">"刘备"</span>);</span><br><span class="line">        System.out.println(list.isEmpty()); <span class="comment">// false,容器里面有元素</span></span><br><span class="line">        list.add(<span class="string">"关羽"</span>);</span><br><span class="line">        list.add(<span class="string">"张飞"</span>);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        System.out.println(<span class="string">"list的大小："</span> + list.size());</span><br><span class="line">        System.out.println(<span class="string">"是否包含指定元素："</span> + list.contains(<span class="string">"关羽"</span>));</span><br><span class="line">        list.remove(<span class="string">"刘备"</span>);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        Object[] objs = list.toArray();</span><br><span class="line">        System.out.println(<span class="string">"转化成Object数组："</span> + Arrays.toString(objs));</span><br><span class="line">        list.clear();</span><br><span class="line">        System.out.println(<span class="string">"清空所有元素："</span> + list);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        test01();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="两个List之间的元素处理"><a href="#两个List之间的元素处理" class="headerlink" title="两个List之间的元素处理"></a>两个List之间的元素处理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestList</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        test02();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试两个容器之间元素处理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        list.add(<span class="string">"刘备"</span>);</span><br><span class="line">        list.add(<span class="string">"关羽"</span>);</span><br><span class="line">        list.add(<span class="string">"张飞"</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; list2 = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        list2.add(<span class="string">"刘备"</span>);</span><br><span class="line">        list2.add(<span class="string">"张三"</span>);</span><br><span class="line">        list2.add(<span class="string">"李四"</span>);</span><br><span class="line">        System.out.println(list.containsAll(list2)); <span class="comment">//false list是否包含list2中所有元素</span></span><br><span class="line">        System.out.println(list);</span><br><span class="line">        list.addAll(list2); <span class="comment">//将list2中所有元素都添加到list中</span></span><br><span class="line">        System.out.println(list);</span><br><span class="line">        list.removeAll(list2); <span class="comment">//从list中删除同时在list和list2中存在的元素</span></span><br><span class="line">        System.out.println(list);</span><br><span class="line">        list.retainAll(list2); <span class="comment">//取list和list2的交集</span></span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ArrayList特点和底层实现"><a href="#ArrayList特点和底层实现" class="headerlink" title="ArrayList特点和底层实现"></a>ArrayList特点和底层实现</h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul><li>查询效率高，增删效率低，线程不安全。</li></ul><h3 id="底层实现"><a href="#底层实现" class="headerlink" title="底层实现"></a>底层实现</h3><ol><li><p>ArrayList底层使用Object数组来存储元素数据。所有的方法，都围绕这个核心的Object数组来开展。源码如下:<br><img src="/images/2020/08/20200811174536.png" alt></p></li><li><p>数组新建与扩容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 新建 =&gt; 新建一个长度为10的object数组(确切来说,是一个空引用,当第一次add,才新建一个长度为10的数组)</span><br><span class="line">2. 第一次扩容 =&gt; 增加原先值的一半,即扩容到 (10 * 3) / 2 + 1 = 16</span><br><span class="line">3. 第二次扩容 =&gt; 增加原先值的一半,即扩容 (16 * 3) / 2 + 1 = 25</span><br></pre></td></tr></table></figure></li></ol><p>源码如下<br><img src="/images/2020/08/20200811174627.png" alt></p><h2 id="LinkedList特点和底层实现"><a href="#LinkedList特点和底层实现" class="headerlink" title="LinkedList特点和底层实现"></a>LinkedList特点和底层实现</h2><h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><ul><li>查询效率低，增删效率高，线程不安全。</li></ul><h3 id="底层实现-1"><a href="#底层实现-1" class="headerlink" title="底层实现"></a>底层实现</h3><ul><li><p>LinkedList底层用双向链表实现的存储<br><img src="/images/2020/08/20200811180031.png" alt></p></li><li><p>每个节点都应该有3部分内容</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">Node</span> </span>&#123;</span><br><span class="line">    Node  previous;     <span class="comment">//前一个节点</span></span><br><span class="line">    Object  element;    <span class="comment">//本节点保存的数据</span></span><br><span class="line">    Node  next;         <span class="comment">//后一个节点</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>LinkedList的源码，可以看到里面包含了双向链表的相关代码<br><img src="/images/2020/08/20200811180114.png" alt></p></li></ul><h2 id="Vector向量"><a href="#Vector向量" class="headerlink" title="Vector向量"></a>Vector向量</h2><ul><li>Vector底层是用数组实现的List，相关的方法都加了同步检查，因此“线程安全,效率低”。</li><li>比如，indexOf方法就增加了synchronized同步标记。<br><img src="/images/2020/08/20200811180400.png" alt></li></ul><h2 id="如何选用ArrayList、LinkedList、Vector"><a href="#如何选用ArrayList、LinkedList、Vector" class="headerlink" title="如何选用ArrayList、LinkedList、Vector?"></a>如何选用ArrayList、LinkedList、Vector?</h2><ol><li>需要线程安全时，用Vector。</li><li>不存在线程安全问题时，并且查找较多用ArrayList(一般使用它)。</li><li>不存在线程安全问题时，增加或删除元素较多用LinkedList。</li></ol><h1 id="Map系列"><a href="#Map系列" class="headerlink" title="Map系列"></a>Map系列</h1><ul><li>Map就是用来存储“键(key)-值(value) 对”的</li><li>Map类中存储的“键值对”通过键来标识，所以“键对象”不能重复</li><li>Map 接口的实现类有HashMap、TreeMap、HashTable、Properties等</li><li>Map接口中常用的方法<br><img src="/images/2020/08/20200811180706.png" alt></li></ul><h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><h3 id="HashMap基本说明"><a href="#HashMap基本说明" class="headerlink" title="HashMap基本说明"></a>HashMap基本说明</h3><ul><li>HashMap采用哈希算法实现，是Map接口最常用的实现类。</li><li>由于底层采用了哈希表存储数据，我们要求键不能重复，如果发生重复，新的键值对会替换旧的键值对。</li><li>HashMap在查找、删除、修改方面都有非常高的效率</li></ul><h3 id="HashMap中的常用方法"><a href="#HashMap中的常用方法" class="headerlink" title="HashMap中的常用方法"></a>HashMap中的常用方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMap</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;Integer, String&gt; m1 = <span class="keyword">new</span> HashMap&lt;Integer, String&gt;();</span><br><span class="line">        Map&lt;Integer, String&gt; m2 = <span class="keyword">new</span> HashMap&lt;Integer, String&gt;();</span><br><span class="line">        m1.put(<span class="number">1</span>, <span class="string">"one"</span>);</span><br><span class="line">        m1.put(<span class="number">2</span>, <span class="string">"two"</span>);</span><br><span class="line">        m1.put(<span class="number">3</span>, <span class="string">"three"</span>);</span><br><span class="line">        m2.put(<span class="number">1</span>, <span class="string">"一"</span>);</span><br><span class="line">        m2.put(<span class="number">2</span>, <span class="string">"二"</span>);</span><br><span class="line">        System.out.println(m1.size());</span><br><span class="line">        System.out.println(m1.containsKey(<span class="number">1</span>));</span><br><span class="line">        System.out.println(m2.containsValue(<span class="string">"two"</span>));</span><br><span class="line">        m1.put(<span class="number">3</span>, <span class="string">"third"</span>); <span class="comment">//键重复了，则会替换旧的键值对</span></span><br><span class="line">        Map&lt;Integer, String&gt; m3 = <span class="keyword">new</span> HashMap&lt;Integer, String&gt;();</span><br><span class="line">        m3.putAll(m1);</span><br><span class="line">        m3.putAll(m2);</span><br><span class="line">        System.out.println(<span class="string">"m1:"</span> + m1);</span><br><span class="line">        System.out.println(<span class="string">"m2:"</span> + m2);</span><br><span class="line">        System.out.println(<span class="string">"m3:"</span> + m3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HashMap底层实现"><a href="#HashMap底层实现" class="headerlink" title="HashMap底层实现"></a>HashMap底层实现</h2><h3 id="基本结构"><a href="#基本结构" class="headerlink" title="基本结构"></a>基本结构</h3><ul><li>数据结构中由数组和链表来实现对数据的存储，他们各有特点<ul><li>数组：占用空间连续。 寻址容易，查询速度快。但是，增加和删除效率非常低</li><li>链表：占用空间不连续。 寻址困难，查询速度慢。但是，增加和删除效率非常高</li></ul></li><li>那么，我们能不能结合数组和链表的优点(即查询快，增删效率也高)呢? 答案就是“哈希表”</li><li>哈希表的本质就是“数组+链表”,<strong>HashMap底层实现采用了哈希表</strong></li><li>打开HashMap源码，发现有如下两个核心内容<br><img src="/images/2020/08/20200811181535.png" alt></li><li>其中的<code>Entry[] table</code>就是HashMap的核心数组结构，我们也称之为“位桶数组”。我们再继续看Entry是什么，源码如下：<br><img src="/images/2020/08/20200811181755.png" alt></li><li>一个Entry对象存储了<ul><li>key：键对象</li><li>value：值对象</li><li>next:下一个节点</li><li>hash: 键对象的hash值</li></ul></li><li>显然每一个Entry对象就是一个单向链表结构，而Engtry本身是一个数组,所以我们可以画出一个Entry对象的典型示意<br><img src="/images/2020/08/20200811181856.png" alt></li><li>然后，我们画出<code>Entry[]</code>数组的结构(这也是HashMap的结构)：<br><img src="/images/2020/08/20200811181940.png" alt></li></ul><h3 id="插入数据过程put-key-value"><a href="#插入数据过程put-key-value" class="headerlink" title="插入数据过程put(key,value)"></a>插入数据过程put(key,value)</h3><p><img src="/images/2020/08/20200811182539.png" alt><br>我们的目的是将”key-value两个对象”成对存放到HashMap的Entry[]数组中。参见以下步骤：</p><h4 id="1-获得key对象的hashcode"><a href="#1-获得key对象的hashcode" class="headerlink" title="(1) 获得key对象的hashcode"></a>(1) 获得key对象的hashcode</h4><p>首先调用key对象的hashcode()方法，获得hashcode。</p><h4 id="2-根据hashcode计算出hash值-要求在-0-数组长度-1-区间"><a href="#2-根据hashcode计算出hash值-要求在-0-数组长度-1-区间" class="headerlink" title="(2) 根据hashcode计算出hash值(要求在[0, 数组长度-1]区间)"></a>(2) 根据hashcode计算出hash值(要求在[0, 数组长度-1]区间)</h4><ul><li><p>hashcode是一个整数，我们需要将它转化成[0, 数组长度-1]的范围。我们要求转化后的hash值尽量均匀地分布在[0,数组长度-1]这个区间，减少“hash冲突”</p></li><li><p>i.一种极端简单和低下的算法是：</p><ul><li>hash值 = hashcode/hashcode;</li><li>也就是说，hash值总是1。意味着，键值对对象都会存储到数组索引1位置，这样就形成一个非常长的链表。相当于每存储一个对象都会发生“hash冲突”，HashMap也退化成了一个“链表”。</li></ul></li><li><p>ii. 一种简单和常用的算法是(相除取余算法)：</p><ul><li><code>hash值 = hashcode%数组长度</code></li><li>这种算法可以让hash值均匀的分布在[0,数组长度-1]的区间。 早期的HashTable就是采用这种算法。但是，这种算法由于使用了“除法”，效率低下。</li><li>JDK后来改进了算法。首先约定数组长度必须为2的整数幂，这样采用位运算即可实现取余的效果：<code>hash值 = hashcode&amp;(数组长度-1)</code></li></ul></li><li><p>如下为我们自己测试简单的hash算法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> h = <span class="number">25860399</span>;</span><br><span class="line">        <span class="keyword">int</span> length = <span class="number">16</span>;<span class="comment">//length为2的整数次幂,则h&amp;(length-1)相当于对length取模</span></span><br><span class="line">        myHash(h, length);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h  任意整数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> length 长度必须为2的整数幂</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">int</span> <span class="title">myHash</span><span class="params">(<span class="keyword">int</span> h,<span class="keyword">int</span> length)</span></span>&#123;</span><br><span class="line">        System.out.println(h&amp;(length-<span class="number">1</span>));</span><br><span class="line">        <span class="comment">//length为2的整数幂情况下，和取余的值一样</span></span><br><span class="line">        System.out.println(h%length);<span class="comment">//取余数</span></span><br><span class="line">        <span class="keyword">return</span> h&amp;(length-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>运行如上程序，我们就能发现直接取余(h%length)和位运算(h&amp;(length-1))结果是一致的。事实上，为了获得更好的散列效果，JDK对hashcode进行了两次散列处理(核心目标就是为了分布更散更均匀)，源码如下<br><img src="/images/2020/08/20200811183520.png" alt></p></li></ul><h4 id="3-生成Entry对象"><a href="#3-生成Entry对象" class="headerlink" title="(3) 生成Entry对象"></a>(3) 生成Entry对象</h4><p>如上所述，一个Entry对象包含4部分：key对象、value对象、hash值、指向下一个Entry对象的引用。我们现在算出了hash值。下一个Entry对象的引用为null。</p><h4 id="4-将Entry对象放到table数组中"><a href="#4-将Entry对象放到table数组中" class="headerlink" title="(4) 将Entry对象放到table数组中"></a>(4) 将Entry对象放到table数组中</h4><p>如果本Entry对象对应的数组索引位置还没有放Entry对象，则直接将Entry对象存储进数组;如果对应索引位置已经有Entry对象，则将已有Entry对象的next指向本Entry对象，形成链表。</p><h4 id="总结如上过程"><a href="#总结如上过程" class="headerlink" title="总结如上过程"></a>总结如上过程</h4><ul><li>当添加一个元素(key-value)时，首先计算key的hash值，以此确定插入数组中的位置，但是可能存在同一hash值的元素已经被放在数组同一位置了，这时就添加到同一hash值的元素的后面，他们在数组的同一位置，就形成了链表，同一个链表上的Hash值是相同的，所以说数组存放的是链表。 </li><li><strong>JDK8中，当链表长度大于8时，链表就转换为红黑树</strong>，这样又大大提高了查找的效率。</li></ul><h3 id="取数据过程get-key"><a href="#取数据过程get-key" class="headerlink" title="取数据过程get(key)"></a>取数据过程get(key)</h3><ul><li>1) 获得key的hashcode，通过hash()散列算法得到hash值，进而定位到数组的位置。</li><li>2) 在链表上挨个比较key对象。调用equals()方法，将key对象和链表上所有节点的key对象进行比较，直到碰到返回true的节点对象为止。</li><li>3) 返回equals()为true的节点对象的value对象。</li><li>注意:hashcode()和equals方法的关系<ul><li>Java中规定，两个内容相同(equals()为true)的对象必须具有相等的hashCode。</li><li>因为如果equals()为true而两个对象的hashcode不同,那在整个存储过程中就发生了悖论。</li></ul></li></ul><h3 id="扩容问题"><a href="#扩容问题" class="headerlink" title="扩容问题"></a>扩容问题</h3><ul><li>HashMap的位桶数组，初始大小为16</li><li>实际使用时，显然大小是可变的</li><li>如果位桶数组中的元素达到(0.75*数组 length)， 就重新调整数组大小变为原来2倍大小</li><li>扩容很耗时</li><li>扩容的本质是定义新的更大的数组，并将旧数组内容挨个拷贝到新数组中。</li></ul><h3 id="JDK8将链表在大于8情况下变为红黑二叉树"><a href="#JDK8将链表在大于8情况下变为红黑二叉树" class="headerlink" title="JDK8将链表在大于8情况下变为红黑二叉树"></a>JDK8将链表在大于8情况下变为红黑二叉树</h3><ul><li>JDK8中，HashMap在存储一个元素时，当对应链表长度大于8时，链表就转换为红黑树，这样又大大提高了查找的效率。</li></ul><h2 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a>HashTable</h2><p>HashTable类和HashMap用法几乎一样，底层实现几乎一样，只不过HashTable的方法添加了synchronized关键字确保线程同步检查，效率较低。</p><h2 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a>TreeMap</h2><h3 id="TreeMap基本介绍"><a href="#TreeMap基本介绍" class="headerlink" title="TreeMap基本介绍"></a>TreeMap基本介绍</h3><p>TreeMap和HashMap实现了同样的接口Map，因此，用法对于调用者来说没有区别。</p><h3 id="TreeMap底层实现"><a href="#TreeMap底层实现" class="headerlink" title="TreeMap底层实现"></a>TreeMap底层实现</h3><ul><li><p>TreeMap是红黑二叉树的典型实现。我们打开TreeMap的源码，发现里面有一行核心代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> Entry&lt;K,V&gt; root = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure></li><li><p>root用来存储整个树的根节点。我们继续跟踪Entry(是TreeMap的内部类)的代码：<br><img src="/images/2020/08/20200811214048.png" alt></p></li><li><p>可以看到里面存储了本身数据、左节点、右节点、父节点、以及节点颜色。</p></li><li><p>TreeMap的put()/remove()方法大量使用了红黑树的理论。限于篇幅，不再展开</p></li></ul><h2 id="如何选用HashMap-HashTable和TreeMap"><a href="#如何选用HashMap-HashTable和TreeMap" class="headerlink" title="如何选用HashMap,HashTable和TreeMap"></a>如何选用HashMap,HashTable和TreeMap</h2><ol><li>HashMap: 线程不安全，效率高。允许key或value为null。</li><li>HashTable: 线程安全，效率低。不允许key或value为null。</li><li>HashMap效率高于TreeMap;在需要排序的Map时才选用TreeMap。</li></ol><h1 id="Set系列"><a href="#Set系列" class="headerlink" title="Set系列"></a>Set系列</h1><ul><li>Set接口继承自Collection，Set接口中没有新增方法，方法和Collection保持完全一致。</li><li>Set容器特点：无序、不可重复。<ul><li>无序指Set中的元素没有索引，我们只能遍历查找;</li><li>不可重复指不允许加入重复的元素。更确切地讲，新元素如果和Set中某个元素通过equals()方法对比为true，则不能加入;甚至，Set中也只能放入一个null元素，不能多个。</li></ul></li><li>Set常用的实现类有：HashSet、TreeSet等，我们一般使用HashSet。</li></ul><h2 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h2><h3 id="HashSet基本使用"><a href="#HashSet基本使用" class="headerlink" title="HashSet基本使用"></a>HashSet基本使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; s = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">        s.add(<span class="string">"hello"</span>);</span><br><span class="line">        s.add(<span class="string">"world"</span>);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        s.add(<span class="string">"hello"</span>); <span class="comment">//相同的元素不会被加入</span></span><br><span class="line">        System.out.println(s);</span><br><span class="line">        s.add(<span class="keyword">null</span>);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">        s.add(<span class="keyword">null</span>);</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HashSet底层实现"><a href="#HashSet底层实现" class="headerlink" title="HashSet底层实现"></a>HashSet底层实现</h3><ul><li>HashSet是采用哈希算法实现，底层实际是用HashMap实现的(HashSet本质就是一个简化版的HashMap)，因此，查询效率和增删效率都比较高。我们来看一下HashSet的源码：<br><img src="/images/2020/08/20200811215002.png" alt></li><li>我们发现里面有个map属性，这就是HashSet的核心秘密。我们再看add()方法，发现增加一个元素说白了就是在map中增加一个键值对，键对象就是这个元素，值对象是名为<code>PRESENT</code>的Object对象。说白了，就是<code>“往set中加入元素，本质就是把这个元素作为key加入到了内部的map中”</code>。<img src="/images/2020/08/20200811125405.png" alt></li><li>由于map中key都是不可重复的，因此，Set天然具有“不可重复”的特性。</li></ul><h2 id="TreeSet"><a href="#TreeSet" class="headerlink" title="TreeSet"></a>TreeSet</h2><h3 id="TreeSet基本使用"><a href="#TreeSet基本使用" class="headerlink" title="TreeSet基本使用"></a>TreeSet基本使用</h3><ul><li>TreeSet底层实际是用TreeMap实现的，内部维持了一个简化版的TreeMap，通过key来存储Set的元素。</li><li>TreeSet内部需要对存储的元素进行排序，因此，我们对应的类需要实现Comparable接口。这样，才能根据compareTo()方法比较对象之间的大小，才能进行内部排序。</li></ul><h3 id="TreeSet底层实现"><a href="#TreeSet底层实现" class="headerlink" title="TreeSet底层实现"></a>TreeSet底层实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        User u1 = <span class="keyword">new</span> User(<span class="number">1001</span>, <span class="string">"高淇"</span>, <span class="number">18</span>);</span><br><span class="line">        User u2 = <span class="keyword">new</span> User(<span class="number">2001</span>, <span class="string">"高希希"</span>, <span class="number">5</span>);</span><br><span class="line">        Set&lt;User&gt; set = <span class="keyword">new</span> TreeSet&lt;User&gt;();</span><br><span class="line">        set.add(u1);</span><br><span class="line">        set.add(u2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    String uname;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">int</span> id, String uname, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.uname = uname;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回0 表示 this == obj 返回正数表示 this &gt; obj 返回负数表示 this &lt; obj</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(User o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.id &gt; o.id) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.id &lt; o.id) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用TreeSet要点"><a href="#使用TreeSet要点" class="headerlink" title="使用TreeSet要点"></a>使用TreeSet要点</h3><ol><li>由于是二叉树，需要对元素做内部排序。 如果要放入TreeSet中的类没有实现Comparable接口，则会抛出异常：java.lang.ClassCastException。</li><li>TreeSet中不能放入null元素</li></ol><h1 id="使用Iterator迭代器遍历容器"><a href="#使用Iterator迭代器遍历容器" class="headerlink" title="使用Iterator迭代器遍历容器"></a>使用Iterator迭代器遍历容器</h1><p>迭代器为我们提供了统一的遍历容器的方式，参见以下示例代码</p><h2 id="迭代器遍历List"><a href="#迭代器遍历List" class="headerlink" title="迭代器遍历List"></a>迭代器遍历List</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; aList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            aList.add(<span class="string">"a"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(aList);</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;String&gt; iter = aList.iterator(); iter.hasNext();) &#123;</span><br><span class="line">            String temp = iter.next();</span><br><span class="line">            System.out.print(temp + <span class="string">"\t"</span>);</span><br><span class="line">            <span class="keyword">if</span> (temp.endsWith(<span class="string">"3"</span>)) &#123;<span class="comment">// 删除3结尾的字符串</span></span><br><span class="line">                iter.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(aList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>建议:如果遇到遍历容器时，判断删除元素的情况，使用迭代器遍历</li></ul><h2 id="迭代器遍历Set"><a href="#迭代器遍历Set" class="headerlink" title="迭代器遍历Set"></a>迭代器遍历Set</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Set&lt;String&gt; set = <span class="keyword">new</span> HashSet&lt;String&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            set.add(<span class="string">"a"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(set);</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;String&gt; iter = set.iterator(); iter.hasNext();) &#123;</span><br><span class="line">            String temp = iter.next();</span><br><span class="line">            System.out.print(temp + <span class="string">"\t"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="迭代器遍历Map"><a href="#迭代器遍历Map" class="headerlink" title="迭代器遍历Map"></a>迭代器遍历Map</h2><h3 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map.put(<span class="string">"A"</span>, <span class="string">"高淇"</span>);</span><br><span class="line">        map.put(<span class="string">"B"</span>, <span class="string">"高小七"</span>);</span><br><span class="line">        Set&lt;Entry&lt;String, String&gt;&gt; ss = map.entrySet();</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;Entry&lt;String, String&gt;&gt; iterator = ss.iterator(); iterator.hasNext();) &#123;</span><br><span class="line">            Entry&lt;String, String&gt; e = iterator.next();</span><br><span class="line">            System.out.println(e.getKey() + <span class="string">"--"</span> + e.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map.put(<span class="string">"A"</span>, <span class="string">"高淇"</span>);</span><br><span class="line">        map.put(<span class="string">"B"</span>, <span class="string">"高小七"</span>);</span><br><span class="line">        Set&lt;String&gt; ss = map.keySet();</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;String&gt; iterator = ss.iterator(); iterator.hasNext();) &#123;</span><br><span class="line">            String key = iterator.next();</span><br><span class="line">            System.out.println(key + <span class="string">"--"</span> + map.get(key));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="遍历集合的方法总结"><a href="#遍历集合的方法总结" class="headerlink" title="遍历集合的方法总结"></a>遍历集合的方法总结</h1><h2 id="遍历List"><a href="#遍历List" class="headerlink" title="遍历List"></a>遍历List</h2><h3 id="方法一：普通for循环"><a href="#方法一：普通for循环" class="headerlink" title="方法一：普通for循环"></a>方法一：普通for循环</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;list.size();i++)&#123;<span class="comment">//list为集合的对象名</span></span><br><span class="line">    String temp = (String)list.get(i);</span><br><span class="line">    System.out.println(temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方法二：增强for循环-使用泛型"><a href="#方法二：增强for循环-使用泛型" class="headerlink" title="方法二：增强for循环(使用泛型!)"></a>方法二：增强for循环(使用泛型!)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (String temp : list) &#123;</span><br><span class="line">    System.out.println(temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方法三：使用Iterator迭代器-1"><a href="#方法三：使用Iterator迭代器-1" class="headerlink" title="方法三：使用Iterator迭代器(1)"></a>方法三：使用Iterator迭代器(1)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(Iterator iter= list.iterator();iter.hasNext();)&#123;</span><br><span class="line">    String temp = (String)iter.next();</span><br><span class="line">    System.out.println(temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方法四：使用Iterator迭代器-2"><a href="#方法四：使用Iterator迭代器-2" class="headerlink" title="方法四：使用Iterator迭代器(2)"></a>方法四：使用Iterator迭代器(2)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Iterator  iter =list.iterator();</span><br><span class="line"><span class="keyword">while</span>(iter.hasNext())&#123;</span><br><span class="line">    Object  obj =  iter.next();</span><br><span class="line">    iter.remove();<span class="comment">//如果要遍历时，删除集合中的元素，建议使用这种方式！</span></span><br><span class="line">    System.out.println(obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="遍历Set"><a href="#遍历Set" class="headerlink" title="遍历Set"></a>遍历Set</h2><h3 id="方法一：增强for循环"><a href="#方法一：增强for循环" class="headerlink" title="方法一：增强for循环"></a>方法一：增强for循环</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(String temp:set)&#123;</span><br><span class="line">    System.out.println(temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方法二：使用Iterator迭代器"><a href="#方法二：使用Iterator迭代器" class="headerlink" title="方法二：使用Iterator迭代器"></a>方法二：使用Iterator迭代器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(Iterator iter = set.iterator();iter.hasNext();)&#123;</span><br><span class="line">    String temp = (String)iter.next();</span><br><span class="line">    System.out.println(temp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="遍历Map"><a href="#遍历Map" class="headerlink" title="遍历Map"></a>遍历Map</h2><h3 id="方法一：根据key获取value"><a href="#方法一：根据key获取value" class="headerlink" title="方法一：根据key获取value"></a>方法一：根据key获取value</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer, Man&gt; maps = <span class="keyword">new</span> HashMap&lt;Integer, Man&gt;();</span><br><span class="line">Set&lt;Integer&gt;  keySet =  maps.keySet();</span><br><span class="line"><span class="keyword">for</span>(Integer id : keySet)&#123;</span><br><span class="line">    System.out.println(maps.get(id).name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="方法二：使用entrySet"><a href="#方法二：使用entrySet" class="headerlink" title="方法二：使用entrySet"></a>方法二：使用entrySet</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;Entry&lt;Integer, Man&gt;&gt;  ss = maps.entrySet();</span><br><span class="line"><span class="keyword">for</span> (Iterator iterator = ss.iterator(); iterator.hasNext();) &#123;</span><br><span class="line">    Entry e = (Entry) iterator.next(); </span><br><span class="line">    System.out.println(e.getKey()+<span class="string">"--"</span>+e.getValue());</span><br></pre></td></tr></table></figure><h1 id="Collections工具类"><a href="#Collections工具类" class="headerlink" title="Collections工具类"></a>Collections工具类</h1><h2 id="Collections工具类基本说明"><a href="#Collections工具类基本说明" class="headerlink" title="Collections工具类基本说明"></a>Collections工具类基本说明</h2><p>类 java.util.Collections 提供了对Set、List、Map进行排序、填充、查找元素的辅助方法。</p><ol><li>void sort(List) //对List容器内的元素排序，排序的规则是按照升序进行排序。</li><li>void shuffle(List) //对List容器内的元素进行随机排列。</li><li>void reverse(List) //对List容器内的元素进行逆续排列 。</li><li>void fill(List, Object) //用一个特定的对象重写整个List容器。</li><li>int binarySearch(List, Object)//对于顺序的List容器，采用折半查找的方法查找特定对象。</li></ol><h2 id="Collections工具类的常用方法"><a href="#Collections工具类的常用方法" class="headerlink" title="Collections工具类的常用方法"></a>Collections工具类的常用方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; aList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)&#123;</span><br><span class="line">            aList.add(<span class="string">"a"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(aList);</span><br><span class="line">        Collections.shuffle(aList); <span class="comment">// 随机排列</span></span><br><span class="line">        System.out.println(aList);</span><br><span class="line">        Collections.reverse(aList); <span class="comment">// 逆续</span></span><br><span class="line">        System.out.println(aList);</span><br><span class="line">        Collections.sort(aList); <span class="comment">// 排序</span></span><br><span class="line">        System.out.println(aList);</span><br><span class="line">        System.out.println(Collections.binarySearch(aList, <span class="string">"a2"</span>)); </span><br><span class="line">        Collections.fill(aList, <span class="string">"hello"</span>);</span><br><span class="line">        System.out.println(aList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>调整Eclipse左边包的显示方式</title>
      <link href="/2017/08/10/%E8%B0%83%E6%95%B4eclipse%E5%B7%A6%E8%BE%B9%E5%8C%85%E7%9A%84%E6%98%BE%E7%A4%BA%E6%96%B9%E5%BC%8F/"/>
      <url>/2017/08/10/%E8%B0%83%E6%95%B4eclipse%E5%B7%A6%E8%BE%B9%E5%8C%85%E7%9A%84%E6%98%BE%E7%A4%BA%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="Eclipse-中包结构展开有两种方式"><a href="#Eclipse-中包结构展开有两种方式" class="headerlink" title="Eclipse 中包结构展开有两种方式"></a>Eclipse 中包结构展开有两种方式</h1><ol><li>平坦方式（flat）<br><img src="/images/2020/08/20200810110712.png" alt></li><li>分层方式（hierarchical）<br><img src="/images/2020/08/20200810110758.png" alt></li></ol><h1 id="包结构显示方式设置"><a href="#包结构显示方式设置" class="headerlink" title="包结构显示方式设置"></a>包结构显示方式设置</h1><p><img src="/images/2020/08/20200810110830.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Eclipse </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Eclipse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Awk命令处理文本</title>
      <link href="/2017/07/11/%E4%BD%BF%E7%94%A8awk%E5%91%BD%E4%BB%A4%E5%A4%84%E7%90%86%E6%96%87%E6%9C%AC/"/>
      <url>/2017/07/11/%E4%BD%BF%E7%94%A8awk%E5%91%BD%E4%BB%A4%E5%A4%84%E7%90%86%E6%96%87%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><ol><li><p>使用awk批量修改文件名</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">   命令</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   将01_abc_def文件名变更为0100_abc_def文件名</span></span><br><span class="line">ll | awk '&#123;print $9&#125;' | awk -F '_' '&#123;if ($1 * 100 &lt; 3901 &amp;&amp; $1 * 100 &gt; 1)&#123;if ($3)&#123;printf("mv %s \t %s \n", $0, $1 "00_"$2 "_"$3)&#125; else &#123;printf("mv %s \t %s \n", $0, $1 "00_"$2)&#125;&#125;&#125;' | sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   稍微分解一下</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   查看所有文件</span></span><br><span class="line">ll</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取文件名列</span></span><br><span class="line">awk '&#123;print $9&#125;'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 处理文本,得到<span class="string">"mv 01_abc_def 0100_abc_def"</span>语句</span></span><br><span class="line">awk -F '_' '&#123;if ($1 * 100 &lt; 3901 &amp;&amp; $1 * 100 &gt; 1)&#123;if ($3)&#123;printf("mv %s \t %s \n", $0, $1 "00_"$2 "_"$3)&#125; else &#123;printf("mv %s \t %s \n", $0, $1 "00_"$2)&#125;&#125;&#125;'</span><br><span class="line"><span class="meta">#</span><span class="bash"> ====&gt; 相当与 &lt;====</span></span><br><span class="line">awk -F '_' # 分割字符串,分割符为'_'</span><br><span class="line">&#123;</span><br><span class="line">    if ($1 * 100 &lt; 3901 &amp;&amp; $1 * 100 &gt; 1) &#123;  # 排除一些不需要修改的</span><br><span class="line">        if ($3) &#123;   # 当第三列存在时</span><br><span class="line">            printf("mv %s \t %s \n", $0, $1 "00_"$2 "_"$3)  # 拼接字符串用双引号将要拼接的字符串引起来</span><br><span class="line">        &#125; else &#123;    # 当第三列不存在时</span><br><span class="line">            printf("mv %s \t %s \n", $0, $1 "00_"$2)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sh  # 执行前面的文本</span><br></pre></td></tr></table></figure></li><li><p>使用 awk 过滤 history 输出，找到最常用的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">history | awk '&#123;a[$2]++&#125;END&#123;for(i in a)&#123;print a[i] " " i&#125;&#125;' | sort -rn | head</span><br></pre></td></tr></table></figure></li><li><p>过滤文件中重复行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk '!x[$0]++' &lt;file&gt;</span><br></pre></td></tr></table></figure></li><li><p>将一行长度超过 72 字符的行打印</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'length&gt;72' file</span><br></pre></td></tr></table></figure></li><li><p>查看最近哪些用户使用系统</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">last | grep -v "^$" | awk '&#123; print $1 &#125;' | sort -nr | uniq -c</span><br></pre></td></tr></table></figure></li><li><p>假设有一个文本，每一行都是一个 int 数值，想要计算这个文件每一行的和，可以使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;s+=$1&#125; ENG &#123;printf "%.0f", s&#125;' /path/to/file</span><br></pre></td></tr></table></figure></li></ol><h1 id="调用awk"><a href="#调用awk" class="headerlink" title="调用awk"></a>调用awk</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.命令行方式</span><br><span class="line">awk [-F  field-separator]  &apos;commands&apos;  input-file(s)</span><br><span class="line">其中，commands 是真正awk命令，[-F域分隔符]是可选的。 input-file(s) 是待处理的文件。</span><br><span class="line">在awk中，文件的每一行中，由域分隔符分开的每一项称为一个域。通常，在不指名-F域分隔符的情况下，默认的域分隔符是空格。</span><br><span class="line"></span><br><span class="line">2.shell脚本方式</span><br><span class="line">将所有的awk命令插入一个文件，并使awk程序可执行，然后awk命令解释器作为脚本的首行，一遍通过键入脚本名称来调用。</span><br><span class="line">相当于shell脚本首行的：#!/bin/sh</span><br><span class="line">可以换成：#!/bin/awk</span><br><span class="line"></span><br><span class="line">3.将所有的awk命令插入一个单独文件，然后调用：</span><br><span class="line">awk -f awk-script-file input-file(s)</span><br><span class="line">其中，-f选项加载awk-script-file中的awk脚本，input-file(s)跟上面的是一样的。</span><br></pre></td></tr></table></figure><h1 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h1><h2 id="基本格式"><a href="#基本格式" class="headerlink" title="基本格式"></a>基本格式</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk [options] 'script' file</span><br></pre></td></tr></table></figure><h2 id="awk-同时处理多个文件"><a href="#awk-同时处理多个文件" class="headerlink" title="awk 同时处理多个文件"></a>awk 同时处理多个文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;print FILENAME "\t" $0&#125;' demo1.txt demo2.txt</span><br></pre></td></tr></table></figure><h2 id="awk-自定义分隔符"><a href="#awk-自定义分隔符" class="headerlink" title="awk 自定义分隔符"></a>awk 自定义分隔符</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">awk -F ':' '&#123;print $1&#125;' /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> nectarine(200g)2008 -&gt; nectarine 200g 2008</span></span><br><span class="line">awk -F '[()]' '&#123;print $1, $2, $3&#125;' some.log</span><br></pre></td></tr></table></figure><ul><li>awk 默认的分割符为空格和制表符</li><li>分割后的字段依次用 $1, $2,$3 来表示</li><li>$0 表示字符串本身</li><li>在 -F 参数中使用一对方括号来指定多个分隔符，awk 处理 some.log 文件时就会使用 “(“ 或者 “)” 来对文件的每一行进行分割</li></ul><h2 id="在-awk-中使用正则表达式"><a href="#在-awk-中使用正则表达式" class="headerlink" title="在 awk 中使用正则表达式"></a>在 awk 中使用正则表达式</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">   待匹配文本</span></span><br><span class="line">This above all: to thine self be true</span><br><span class="line">There is nothing either good or bad, but thinking makes it so</span><br><span class="line">There’s a special providence in the fall of a sparrow</span><br><span class="line">No matter how dark long, may eventually in the day arrival</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   匹配字符串 “There” ，将包含这个字符串的行打印并输出</span></span><br><span class="line">awk '/There/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line">There is nothing either good or bad, but thinking makes it so</span><br><span class="line">There’s a special providence in the fall of a sparrow</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   匹配一个包含字母 t 和字母 e 并且 t 和 e 中间只能有任意单个字符的行</span></span><br><span class="line">awk '/t.e/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line">There is nothing either good or bad, but thinking makes it so</span><br><span class="line">There’s a special providence in the fall of a sparrow</span><br><span class="line">No matter how dark long, may eventually in the day arrival</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   以 “The” 字符串开头的行</span></span><br><span class="line">awk '/^The/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   以 “<span class="literal">true</span>” 字符串结尾的行</span></span><br><span class="line">awk '/true$/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   /s[a-z]/ 表示匹配包含字符 s 然后后面跟着任意 a 到 z 之间的单个字符的字符串</span></span><br><span class="line">awk '/s[a-z]/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">     字母 <span class="string">"o"</span> 只能可以出现 2 次，3 次，4 次，5 次，6 次 ... 一直到 10 次</span></span><br><span class="line">awk '/go&#123;2,10&#125;d/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   字母 <span class="string">"o"</span> 必须至少出现 2 次或着 2 次以上</span></span><br><span class="line">awk '/go&#123;2,&#125;d/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   星号表示字符匹配 0 次或者多次</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   加号表示字符匹配 1 个或者 1 个以上</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   问号字符只能出现 0 次 或者 1 次</span></span><br><span class="line">awk '/go*d/&#123;print $0&#125;' poetry.txt</span><br><span class="line">awk '/go+d/&#123;print $0&#125;' poetry.txt</span><br><span class="line">awk '/go?d/&#123;print $0&#125;' poetry.txt</span><br></pre></td></tr></table></figure><h2 id="使用-AWK-移除行中特定模式"><a href="#使用-AWK-移除行中特定模式" class="headerlink" title="使用 AWK 移除行中特定模式"></a>使用 AWK 移除行中特定模式</h2><p>文件中有行数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/abc/def/123 456</span><br><span class="line">/abc/def/222 456</span><br></pre></td></tr></table></figure><p>想要移除 123，保留之前的字母和后面的数字，则可以使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'sub(/[0-9]+/,"",$1)' /path/to/file</span><br></pre></td></tr></table></figure><h2 id="print和printf"><a href="#print和printf" class="headerlink" title="print和printf"></a>print和printf</h2><ul><li>awk中同时提供了print和printf两种打印输出的函数。</li><li>print函数的参数可以是变量、数值或者字符串。字符串必须用双引号引用，参数用逗号分隔。如果没有逗号，参数就串联在一起而无法区分。这里，逗号的作用与输出文件的分隔符的作用是一样的，只是后者是空格而已</li><li>printf函数，其用法和c语言中printf基本相似,可以格式化字符串,输出复杂时，printf更加好用，代码更易懂</li></ul><h1 id="awk-编程"><a href="#awk-编程" class="headerlink" title="awk 编程"></a>awk 编程</h1><h2 id="BEGIN-和-END-关键字的使用"><a href="#BEGIN-和-END-关键字的使用" class="headerlink" title="BEGIN 和 END 关键字的使用"></a>BEGIN 和 END 关键字的使用</h2><ul><li>BEGIN:会在开始读取一个文件之前，运行一次 BEGIN 关键字后面的脚本代码段</li><li>END:读取并且处理完文件的所有内容行之后，才会执行 END 后面的脚本代码段</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd |awk  -F ':'  'BEGIN &#123;print "name,shell"&#125;  &#123;print $1","$7&#125; END &#123;print "blue,/bin/nosh"&#125;'</span><br><span class="line">name,shell  # BEGIN多这一行</span><br><span class="line">root,/bin/bash</span><br><span class="line">daemon,/bin/sh</span><br><span class="line">bin,/bin/sh</span><br><span class="line">sys,/bin/sh</span><br><span class="line">....</span><br><span class="line">blue,/bin/nosh # END多这一行</span><br></pre></td></tr></table></figure><h2 id="在-awk-中使用变量"><a href="#在-awk-中使用变量" class="headerlink" title="在 awk 中使用变量"></a>在 awk 中使用变量</h2><h3 id="可以在-awk-脚本中声明和使用变量"><a href="#可以在-awk-脚本中声明和使用变量" class="headerlink" title="可以在 awk 脚本中声明和使用变量"></a>可以在 awk 脚本中声明和使用变量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;msg="hello world"; print msg&#125;' /etc/passwd</span><br></pre></td></tr></table></figure><p>awk 声明的变量可以在任何多个花括号脚本中使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'BEGIN &#123;msg="hello world"&#125; &#123;print msg&#125;' /etc/passwd</span><br></pre></td></tr></table></figure><p>在 awk 中使用数学运算，在 awk 中，像其他编程语言一样，它也支持一些基本的数学运算操作</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;a = 12; b = 24; print a + b&#125;' company.txt</span><br></pre></td></tr></table></figure><p>上面这段脚本表示，先声明两个变量 a = 12 和 b = 24，然后用 print 打印出 a 加上 b 的结果<br>awk 还支持其他的数学运算符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ 加法运算符</span><br><span class="line">- 减法运算符</span><br><span class="line">* 乘法运算符</span><br><span class="line">/ 除法运算符</span><br><span class="line">% 取余运算符</span><br></pre></td></tr></table></figure><h3 id="awk-内置变量的使用"><a href="#awk-内置变量的使用" class="headerlink" title="awk 内置变量的使用"></a>awk 内置变量的使用</h3><ul><li><p>0这个表示文本处理时的当前行，1 表示文本行被分隔后的第 1 个字段列，2表示文本行被分割后的第2个字段列，3 表示文本行被分割后的第 3 个字段列，$n 表示文本行被分割后的第 n 个字段列</p></li><li><p>NR 表示文件中的行号，表示当前是第几行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;print NR "\t" $0&#125;' fruit.txt</span><br><span class="line"></span><br><span class="line">1   peach    100   Mar  1997   China</span><br><span class="line">2   Lemon    150   Jan  1986   America</span><br><span class="line">3   Pear     240   Mar  1990   Janpan</span><br><span class="line">4   avocado  120   Feb  2008   china</span><br></pre></td></tr></table></figure></li><li><p>NF 表示文件中的当前行被分割的列数，可以理解为 MySQL 数据表里面每一条记录有多少个字段，所以 NF就表示最后一个字段，(NF-1) 就表示倒数第二个字段</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;print NF "\t" $0&#125;' fruit.txt</span><br><span class="line"></span><br><span class="line">5   peach    100   Mar  1997   China</span><br><span class="line">5   Lemon    150   Jan  1986   America</span><br><span class="line">5   Pear     240   Mar  1990   Janpan</span><br><span class="line">5   avocado  120   Feb  2008   china</span><br><span class="line"></span><br><span class="line">awk '&#123;print $(NF - 1)&#125;' fruit.txt</span><br><span class="line"></span><br><span class="line">1997</span><br><span class="line">1986</span><br><span class="line">1990</span><br><span class="line">2008</span><br><span class="line"></span><br><span class="line">awk 'NR % 6'        # 打印出了 6 倍数行之外的其他行</span><br><span class="line">awk 'NR &gt; 5'        # 打印第 5 行之后内容，类似 `tail -n +6` 或者 `sed '1,5d'`</span><br><span class="line">awk 'NF &gt;= 6'       # 打印大于等于 6 列的行</span><br><span class="line">awk '/foo/ &amp;&amp; /bar/'    # 打印匹配 `/foo/` 和 `/bar/` 的行</span><br><span class="line">awk '/foo/ &amp;&amp; !/bar/'   # 打印包含 `/foo/` 不包含 `/bar/` 的行</span><br><span class="line">awk '/foo/ || /bar/'    # 或</span><br><span class="line">awk '/foo/,/bar/'       # 打印从匹配 `/foo/` 开始的行到 `/bar/` 的行，包含这两行</span><br></pre></td></tr></table></figure></li><li><p>FS 表示 awk 的输入分隔符，默认分隔符为空格和制表符，可以对其进行自定义设置</p></li><li><p>OFS 表示 awk 的输出分隔符，默认为空格，也可以对其进行自定义设置</p></li><li><p>FILENAME 表示当前文件的文件名称，如果同时处理多个文件，它也表示当前文件名称</p></li><li><p>RS 行分隔符，用于分割行，默认为换行符</p></li><li><p>ORS 输出记录的分隔符，默认为换行符</p></li></ul><h2 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h2><p>awk中的条件语句是从C语言中借鉴来的，见如下声明方式：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">if (expression) &#123;</span><br><span class="line">    statement;</span><br><span class="line">    statement;</span><br><span class="line">    ... ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (expression) &#123;</span><br><span class="line">    statement;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    statement2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (expression) &#123;</span><br><span class="line">    statement1;</span><br><span class="line">&#125; else if (expression1) &#123;</span><br><span class="line">    statement2;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    statement3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>统计某个文件夹下的文件占用的字节数,过滤4096大小的文件(一般都是文件夹):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -l |awk &apos;BEGIN &#123;size=0;print &quot;[start]size is &quot;, size&#125; &#123;if($5!=4096)&#123;size=size+$5;&#125;&#125; END&#123;print &quot;[end]size is &quot;, size/1024/1024,&quot;M&quot;&#125;&apos; </span><br><span class="line">[end]size is  8.22339 M</span><br></pre></td></tr></table></figure><h2 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h2><p>awk中的循环语句同样借鉴于C语言，支持while、do/while、for、break、continue，这些关键字的语义和C语言中的语义完全相同。</p><h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>因为awk中数组的下标可以是数字和字母，数组的下标通常被称为关键字(key)。值和关键字都存储在内部的一张针对key/value应用hash的表格里。由于hash不是顺序存储，因此在显示数组内容时会发现，它们并不是按照你预料的顺序显示出来的。数组和变量一样，都是在使用时自动创建的，awk也同样会自动判断其存储的是数字还是字符串。一般而言，awk中的数组用来从记录中收集信息，可以用于计算总和、统计单词以及跟踪模板被匹配的次数等等。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">   显示/etc/passwd的账户</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   这里使用<span class="keyword">for</span>循环遍历数组</span></span><br><span class="line">awk -F ':' 'BEGIN &#123;count=0;&#125; &#123;name[count] = $1;count++;&#125;; END&#123;for (i = 0; i &lt; NR; i++) print i, name[i]&#125;' /etc/passwd</span><br><span class="line">0 root</span><br><span class="line">1 daemon</span><br><span class="line">2 bin</span><br><span class="line">3 sys</span><br><span class="line">4 sync</span><br><span class="line">5 games</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h2 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h2><ul><li>toupper() 用于将字符转为大写</li><li>tolower() 将字符转为小写</li><li>length() 长度</li><li>substr() 子字符串</li><li>sin() 正弦</li><li>cos() 余弦</li><li>sqrt() 平方根</li><li>rand() 随机数</li></ul><p>更多的方法可以参考：man awk</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol><li><a href="http://www.gnu.org/software/gawk/manual/gawk.html" target="_blank" rel="noopener">http://www.gnu.org/software/gawk/manual/gawk.html</a></li><li><a href="https://www.cnblogs.com/ggjucheng/archive/2013/01/13/2858470.html" target="_blank" rel="noopener">linux awk命令详解</a></li><li><a href="http://einverne.github.io/post/2018/01/awk.html" target="_blank" rel="noopener">每天学习一个命令：awk 处理文本 </a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vim全局命令g</title>
      <link href="/2017/05/31/Vim%E5%85%A8%E5%B1%80%E5%91%BD%E4%BB%A4g/"/>
      <url>/2017/05/31/Vim%E5%85%A8%E5%B1%80%E5%91%BD%E4%BB%A4g/</url>
      
        <content type="html"><![CDATA[<h1 id="命令说明"><a href="#命令说明" class="headerlink" title="命令说明"></a>命令说明</h1><p>全局命令<code>:g</code>在 Vim 中有着意想不到强大的功能。当想要在整个文件中对于匹配的行或者不匹配行进行一些操作时，应该第一时间想到这个<code>:g</code>命令。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:[range]global[!]/&#123;pattern&#125;/&#123;command&#125;</span><br></pre></td></tr></table></figure><p>简写可以写成</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:[range]g/pattern/command</span><br><span class="line">    [range] 指定文本范围,默认为整个文档</span><br><span class="line">    pattern 在范围 range 内的行如果匹配 pattern，则执行 command</span><br><span class="line">    ! 表示取反，也就是不匹配的行，也可以使用 vglobal</span><br><span class="line">    command 默认是打印文本</span><br></pre></td></tr></table></figure><p>整个命令可以理解成，在 range 范围内匹配 patter 的行执行 Ex command。所有的 Ex command 可以使用 :help ex-cmd 来查看。<br>常用的 Ex command 可以参考如下例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">d 删除</span><br><span class="line">m 移动</span><br><span class="line">t 拷贝</span><br><span class="line">s 替换</span><br></pre></td></tr></table></figure><h1 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h1><h2 id="范围匹配"><a href="#范围匹配" class="headerlink" title="范围匹配"></a>范围匹配</h2><p>比如在 20 行到 200 行之间，每一行下插入空行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:20,200g/^/pu _</span><br></pre></td></tr></table></figure><h2 id="删除匹配的行"><a href="#删除匹配的行" class="headerlink" title="删除匹配的行"></a>删除匹配的行</h2><p>最简单的使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:g/pattern/d</span><br></pre></td></tr></table></figure><p>会删除 pattern 批量的行，再比如</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:g/^$/d</span><br></pre></td></tr></table></figure><p>可以用来删除空白行。</p><h2 id="删除不匹配的行"><a href="#删除不匹配的行" class="headerlink" title="删除不匹配的行"></a>删除不匹配的行</h2><p>匹配使用 :g ，而不匹配有两种写法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:g!/pattern/d</span><br><span class="line">:v/pattern/d</span><br><span class="line">:v 是 :in(v)erse 的缩写，如果为了记忆的话，可以记住 inverse。</span><br></pre></td></tr></table></figure><h2 id="删除大量匹配行"><a href="#删除大量匹配行" class="headerlink" title="删除大量匹配行"></a>删除大量匹配行</h2><p>Vim 在删除操作时，会先把要删除的内容放到寄存器中，假如没有指定寄存器，会默认放到一个未命名的寄存器中，对于要删除大量匹配行的行为，可能导致 Vim 花一些时间处理这些拷贝，避免花费不必要的时间可以指定一个 blackhole 寄存器 _ 。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:g/pattern/d_</span><br></pre></td></tr></table></figure><h2 id="移动匹配的行"><a href="#移动匹配的行" class="headerlink" title="移动匹配的行"></a>移动匹配的行</h2><p>将所有匹配的行移动到文件的末尾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:g/pattern/m$</span><br></pre></td></tr></table></figure><h2 id="复制匹配的行"><a href="#复制匹配的行" class="headerlink" title="复制匹配的行"></a>复制匹配的行</h2><p>将所有匹配的行复制到文件末尾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:g/pattern/t$</span><br></pre></td></tr></table></figure><h2 id="复制到-register-a"><a href="#复制到-register-a" class="headerlink" title="复制到 register a"></a>复制到 register a</h2><p>Vim 每个字母都是一个寄存器，所以使用全局命令也可以将内容复制到某一个寄存器，比如 a</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qaq:g/pattern/y A</span><br><span class="line">    qaq 清空寄存器 a，qa 开始记录命令到a寄存器，q 停止记录</span><br><span class="line">    y A 将匹配的行 A (append) 追加到寄存器 a 中</span><br></pre></td></tr></table></figure><p>存放到 a 寄存器之后就可以使用 “ap 来粘贴使用或者其他操作了。</p><h2 id="反转文件中的每一行"><a href="#反转文件中的每一行" class="headerlink" title="反转文件中的每一行"></a>反转文件中的每一行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">just show the power of :g</span><br><span class="line">:g/^/m0</span><br></pre></td></tr></table></figure><p>:g 命令一行行匹配，匹配第一行时将第一行 m0 放到文件顶部，第二行放到文件顶部，当跑完一遍之后整个文件的每一行就反转了。</p><h2 id="在匹配行后添加文字"><a href="#在匹配行后添加文字" class="headerlink" title="在匹配行后添加文字"></a>在匹配行后添加文字</h2><p>使用 s 命令可以实现，同样使用全局 g 命令也可以实现同样的效果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:g/pattern/s/$/mytext</span><br></pre></td></tr></table></figure><p>这里使用到了 s 命令， substitute 命令，可以使用 :help :s 来查看。</p><h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><p><a href="http://vim.wikia.com/wiki/Power_of_g" target="_blank" rel="noopener">http://vim.wikia.com/wiki/Power_of_g</a></p>]]></content>
      
      
      <categories>
          
          <category> vim </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu的Shell中使用Ack进行搜索</title>
      <link href="/2017/05/17/Ubuntu%E7%9A%84Shell%E4%B8%AD%E4%BD%BF%E7%94%A8ack%E8%BF%9B%E8%A1%8C%E6%90%9C%E7%B4%A2/"/>
      <url>/2017/05/17/Ubuntu%E7%9A%84Shell%E4%B8%AD%E4%BD%BF%E7%94%A8ack%E8%BF%9B%E8%A1%8C%E6%90%9C%E7%B4%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ wget http://beyondgrep.com/ack-2.12-single-file</span><br><span class="line">$ sudo mv ack-2.12-single-file /usr/bin/ack</span><br><span class="line">$ sudo chmod 0755 /usr/bin/ack</span><br></pre></td></tr></table></figure><h1 id="ack的使用案例"><a href="#ack的使用案例" class="headerlink" title="ack的使用案例"></a>ack的使用案例</h1><ol><li><p>在当前目录递归搜索单词”eat”,不匹配类似于”feature”或”eating”的字符串:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ack -w eat</span><br></pre></td></tr></table></figure></li><li><p>搜索有特殊字符的字符串’$path=.’,所有的元字符（比如’$’,’.’)需要在字面上被匹配:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ack -Q &apos;$path=.&apos; /etc</span><br></pre></td></tr></table></figure></li><li><p>除了dowloads目录，在所有目录搜索”about”单词:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ack about --ignore-dir=downloads</span><br></pre></td></tr></table></figure></li><li><p>只搜索包含’protected’单词的PHP文件，然后通过文件名把搜索结果整合在一起，打印每个文件对应的搜索结果:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ack --php --group protected</span><br></pre></td></tr></table></figure></li><li><p>获取包含’CFLAG’关键字的Makefile的文件名。文件名为<code>*.mk,makefile,Makefile,GNUmakefile</code>的都在考虑范围内:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ack --make -l CFLAG</span><br></pre></td></tr></table></figure></li><li><p>显示整个日志文件时高亮匹配到的字符串:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tail -f /var/log/syslog | ack --passthru 192.168.1.10</span><br></pre></td></tr></table></figure></li><li><p>要换取ack支持的文件过滤类型，运行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ack --help-type</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux命令 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu安装fcitx拼音和日语输入法</title>
      <link href="/2017/05/12/ubuntu%E5%AE%89%E8%A3%85fcitx%E6%8B%BC%E9%9F%B3%E5%92%8C%E6%97%A5%E8%AF%AD%E8%BE%93%E5%85%A5%E6%B3%95/"/>
      <url>/2017/05/12/ubuntu%E5%AE%89%E8%A3%85fcitx%E6%8B%BC%E9%9F%B3%E5%92%8C%E6%97%A5%E8%AF%AD%E8%BE%93%E5%85%A5%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="安装fcitx框架"><a href="#安装fcitx框架" class="headerlink" title="安装fcitx框架"></a>安装fcitx框架</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install fctix</span><br></pre></td></tr></table></figure><ul><li>其实不用提前安装框架,底下安装输入法时,没有fctix框架的情况下,会自动安装fctix框架的</li><li>使用这个框架还有一个好处就是为了配合使用vim的<code>humiaozuzu/fcitx-status</code>插件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot; humiaozuzu/fcitx-status插件说明 &quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">&quot; vim输入中文在插入状态下输入中文,切换会正常模式的时候,自动检测,变成英文模式</span><br><span class="line">&quot; 被动技能</span><br><span class="line">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;</span><br><span class="line">Bundle &apos;humiaozuzu/fcitx-status&apos;</span><br></pre></td></tr></table></figure></li></ul><h1 id="安装google拼音"><a href="#安装google拼音" class="headerlink" title="安装google拼音"></a>安装google拼音</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ol><li>sudo apt-get install fcitx-googlepinyin</li><li>在<code>settings-&gt;Language Support</code>里将keyboard input method system设置为fcitx</li><li>注销系统，再登录</li><li>在<code>settings-&gt;Text Entry</code>里，添加输入源，搜索fcitx添加即可</li></ol><h2 id="解决第二个或第三个候选字是省略号的问题"><a href="#解决第二个或第三个候选字是省略号的问题" class="headerlink" title="解决第二个或第三个候选字是省略号的问题"></a>解决第二个或第三个候选字是省略号的问题</h2><ol><li>原因:之所以为省略号,其实是因为这个位置是云适配候选词,但最大的问题在于这个候选词汇的源是google,而google是个什么情况心里清楚</li><li>解决:将google源切换成baidu源或者关闭云服务<ul><li>在菜单中找到Fcitx配置(或者运行命令fcitx-configtool),打开Fcitx的配置页面,在”附件选项”中选中”云拼音”,点击”配置”,打开云拼音配置页面,将源改成”baidu”</li><li>关闭云服务(和前面切换源同界面有关闭云服务配置,个人输入体验是关闭云服务比较好)</li></ul></li></ol><h1 id="安装日语输入法anthy"><a href="#安装日语输入法anthy" class="headerlink" title="安装日语输入法anthy"></a>安装日语输入法anthy</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install fcitx-anthy</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Ubuntu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ubuntu装机日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java任务定时调度</title>
      <link href="/2017/04/14/Java%E4%BB%BB%E5%8A%A1%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6/"/>
      <url>/2017/04/14/Java%E4%BB%BB%E5%8A%A1%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<h1 id="任务定时调度"><a href="#任务定时调度" class="headerlink" title="任务定时调度"></a>任务定时调度</h1><p>通过Timer和Timetask，我们可以实现定时启动某个线程。</p><h2 id="java-util-Timer"><a href="#java-util-Timer" class="headerlink" title="java.util.Timer"></a>java.util.Timer</h2><p>在这种实现方式中，Timer类作用是类似闹钟的功能，也就是定时或者每隔一定时间触发一次线程。其实，Timer类本身实现的就是一个线程，只是这个线程是用来实现调用其它线程的。</p><h2 id="java-util-TimerTask"><a href="#java-util-TimerTask" class="headerlink" title="java.util.TimerTask"></a>java.util.TimerTask</h2><ul><li>TimerTask类是一个抽象类，该类实现了Runnable接口，所以该类具备多线程的能力。</li><li>在这种实现方式中，通过继承TimerTask使该类获得多线程的能力，将需要多线程执行的代码书写在run方法内部，然后通过Timer类启动线程的执行。</li><li><img src="/images/2020/04/20200414001.png" alt></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTimer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Timer t1 = <span class="keyword">new</span> Timer();<span class="comment">//定义计时器；</span></span><br><span class="line">        MyTask task1 = <span class="keyword">new</span> MyTask();<span class="comment">//定义任务；</span></span><br><span class="line">        t1.schedule(task1,<span class="number">3000</span>);  <span class="comment">//3秒后执行；</span></span><br><span class="line">        <span class="comment">//t1.schedule(task1,5000,1000);//5秒以后每隔1秒执行一次！</span></span><br><span class="line">        <span class="comment">//GregorianCalendar calendar1 = new GregorianCalendar(2010,0,5,14,36,57);</span></span><br><span class="line">        <span class="comment">//t1.schedule(task1,calendar1.getTime()); //指定时间定时执行；</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTask</span> <span class="keyword">extends</span> <span class="title">TimerTask</span> </span>&#123;<span class="comment">//自定义线程类继承TimerTask类；</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">"任务1:"</span>+i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意:</p><ul><li>在实际使用时，一个Timer可以启动任意多个TimerTask实现的线程，但是多个线程之间会存在阻塞。所以如果多个线程之间需要完全独立的话，最好还是一个Timer启动一个TimerTask实现</li></ul><h1 id="Quartz定时任务框架"><a href="#Quartz定时任务框架" class="headerlink" title="Quartz定时任务框架"></a>Quartz定时任务框架</h1><ul><li>实际开发中，我们可以使用开源框架quanz，更加方便的实现任务定时调度。</li><li>实际上，quanz底层原理就是我们这里介绍的内容</li><li><a href="https://www.jianshu.com/p/dc814e8014b0" target="_blank" rel="noopener">SpringBoot2.0集成Quartz</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vim全局搜索文件</title>
      <link href="/2017/04/10/Vim%E5%85%A8%E5%B1%80%E6%90%9C%E7%B4%A2%E6%96%87%E4%BB%B6/"/>
      <url>/2017/04/10/Vim%E5%85%A8%E5%B1%80%E6%90%9C%E7%B4%A2%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="vimgrep命令"><a href="#vimgrep命令" class="headerlink" title=":vimgrep命令"></a><code>:vimgrep</code>命令</h1><p>在 Linux 中搜索文件最长用到的搜索工具是 Grep ，而在 Vim 中内置了 Grep ,即<code>:vimgrep</code>命令</p><h2 id="命令说明"><a href="#命令说明" class="headerlink" title="命令说明"></a>命令说明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:vim[grep][!] /&#123;pattern&#125;/[g][j] &#123;file&#125; ...</span><br><span class="line">:vim[grep][!] &#123;pattern&#125; &#123;file&#125; ...</span><br></pre></td></tr></table></figure><ul><li>vim 可作为 vimgrep 的缩写</li><li>! 可紧随 vimgrep 之后，表示强制执行该命令</li><li>索引的关键字 pattern 放在了两个 “/” 中间，并且支持正则表达式</li><li>g, j 可选。 如果添加 g，将显示重复行， 如果添加 j，vim 将不会自动跳转到第一个匹配的行（可能是别的文件）</li><li>file 可以是正则文件名，也可以是多个确定的文件名</li></ul><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:vimgrep /user/g **/*.*</span><br></pre></td></tr></table></figure><ul><li>使用该命令可以查找当前目录及子目录下所有文件中包含 user 字符串的文件，并跳转到第一个匹配的文件</li><li>同时所有搜索结果会显示在 Quickfix 中，使用 :cw, :copen 可以打开该列表</li></ul><h2 id="搜索结果查看"><a href="#搜索结果查看" class="headerlink" title="搜索结果查看"></a>搜索结果查看</h2><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>:cnext, :cn</td><td># 当前页下一个结果</td></tr><tr><td>:cprevious, :cp</td><td># 当前页上一个结果</td></tr><tr><td>:clist, :cl</td><td># 使用 more 打开 Quickfix 窗口</td></tr><tr><td>:copen, :cope, :cw</td><td># 打开 Quickfix 窗口，列出所有结果</td></tr><tr><td>:ccl[ose]</td><td># 关闭 Quickfix 窗口。</td></tr></tbody></table><h2 id="更多内容查看vim帮助"><a href="#更多内容查看vim帮助" class="headerlink" title="更多内容查看vim帮助"></a>更多内容查看vim帮助</h2><p>在 Vim 命令行模式下输入 :h vimgrep 可以看到 vimgrep 的使用文档</p><h1 id="lvimgrep命令"><a href="#lvimgrep命令" class="headerlink" title=":lvimgrep命令"></a><code>:lvimgrep</code>命令</h1><ul><li>lvimgrep 与 vimgrep 搜索命令基本一样</li><li>不同点在于搜索结果不是显示在 Quickfix 中,而是显示在 location-list 中</li></ul><h2 id="quickfix-list-vs-location-list的区别"><a href="#quickfix-list-vs-location-list的区别" class="headerlink" title="quickfix-list vs location-list的区别"></a>quickfix-list vs location-list的区别</h2><ul><li>quickfix list 是全局的，相对于窗口而言，不同的窗口共用一个quickfix list,可以使用 :cw 或者 :copen 打开</li><li>而 loaction list 是局部于某个特定窗口的，即不同窗口的 location list 可以不同，使用 :lw 或者 :lopen 命令打开。</li><li>请使用：help quickfix 和:help location-list命令获取帮助</li></ul><h1 id="Vim-插件-EasyGrep-全局搜索文件"><a href="#Vim-插件-EasyGrep-全局搜索文件" class="headerlink" title="Vim 插件 EasyGrep 全局搜索文件"></a>Vim 插件 EasyGrep 全局搜索文件</h1><p>本质上就是<code>vimgrep</code>命令,但上述操作是比较麻烦的,所以有人封装成了插件,EasyGrep 应运而生,让搜索变得更简单，EasyGrep 有快捷键和命令行两种使用方式</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ol><li><p>下载插件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/.vim/bundle</span><br><span class="line">$ git clone https://github.com/dkprice/vim-easygrep.git</span><br></pre></td></tr></table></figure></li><li><p>修改 ~/.vimrc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plugin &apos;dkprice/vim-easygrep&apos;</span><br></pre></td></tr></table></figure></li><li><p>在 Vim 中运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:PluginInstall</span><br></pre></td></tr></table></figure></li></ol><h2 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h2><ol><li><p>快捷键</p><table><thead><tr><th>快捷键</th><th>作用</th></tr></thead><tbody><tr><td><leader>vv</leader></td><td>搜索光标所在单词，并匹配出所有结果，类似 gstar</td></tr><tr><td><leader>vV</leader></td><td>搜索光标所在单词，全词匹配，类似 star</td></tr><tr><td><leader>va</leader></td><td>类似 vv，但是会把结果添加到之前的搜索列表</td></tr><tr><td><leader>vA</leader></td><td>类似 vV，但是会把结果添加到之前的搜索列表</td></tr><tr><td><leader>vr</leader></td><td>全局搜索光标所在单词，并替换想要的单词</td></tr></tbody></table></li><li><p>命令行</p><table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td>:Grep [arg]</td><td>类似 <leader>vv，使用 ! 类似<leader>vV</leader></leader></td></tr><tr><td>:GrepAdd [arg]</td><td>类似 <leader>va，使用 ! 类似<leader>vA</leader></leader></td></tr><tr><td>:Replace [target] [replacement]</td><td>类似 <leader>vr</leader></td></tr><tr><td>:ReplaceUndo</td><td>撤销替换操作</td></tr></tbody></table></li></ol><h1 id="Vim插件-Ack-全局搜索"><a href="#Vim插件-Ack-全局搜索" class="headerlink" title="Vim插件 Ack 全局搜索"></a>Vim插件 Ack 全局搜索</h1><p>vimgrep有一个缺点,就是搜索速度相对慢,所有可以使用 Ack 替代它完成搜索任务</p><h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><ol><li><p>安装 Ack 工具</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// 我自己用的是Ubuntu</span><br><span class="line">$ sudo apt update -y</span><br><span class="line">$ sudo apt install -y ack-grep</span><br></pre></td></tr></table></figure></li><li><p>下载插件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/.vim/bundle</span><br><span class="line">$ git clone https://github.com/mileszs/ack.vim.git</span><br></pre></td></tr></table></figure></li><li><p>修改<code>~/.vimrc</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plugin &apos;mileszs/ack.vim&apos;</span><br></pre></td></tr></table></figure></li><li><p>在vim中运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:PluginInstall</span><br></pre></td></tr></table></figure></li></ol><h2 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h2><ul><li>语法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:Ack [options] &#123;pattern&#125; [&#123;directories&#125;]</span><br></pre></td></tr></table></figure></li></ul><p>还可以像 :grep, :grepadd, :lgrep, :lgrepadd 一样使用 :Ack, :AckAdd, :LAck, :LAckAdd</p><ul><li>使用举例<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 在项目里搜索xxx单词.</span><br><span class="line">:Ack xxx *</span><br></pre></td></tr></table></figure></li></ul><h2 id="更进一步"><a href="#更进一步" class="headerlink" title="更进一步"></a>更进一步</h2><p>每次手动输入:Ack xxx还是很不方便的,可以在.vimrc文件里设置快捷键:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:map &lt;F4&gt; :Ack -i</span><br></pre></td></tr></table></figure><ul><li>-i参数表示忽略大小写. 以后在项目里,只需要按F4,即可全局搜索单词了.</li></ul><h1 id="Vim插件-CtrlSF-显示搜索结果同时显示上下几行"><a href="#Vim插件-CtrlSF-显示搜索结果同时显示上下几行" class="headerlink" title="Vim插件 CtrlSF 显示搜索结果同时显示上下几行"></a>Vim插件 CtrlSF 显示搜索结果同时显示上下几行</h1><ul><li>在 Vim 中搜索文件，使用 Ack 或 EasyGrep 已经足足的够了，</li><li>现在我们想把搜索做的更像 IDE ，比如把搜索命中行的上下几行也都显示出来</li><li>这时候我们需要用到 CtrlSF</li></ul><h2 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h2><ol><li><p>下载插件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd ~/.vim/bundle</span><br><span class="line">$ git clone https://github.com/dyng/ctrlsf.vim.git</span><br></pre></td></tr></table></figure></li><li><p>修改<code>~/.vimrc</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plugin &apos;dyng/ctrlsf.vim&apos;</span><br></pre></td></tr></table></figure></li><li><p>在 Vim 中运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:PluginInstall</span><br></pre></td></tr></table></figure></li><li><p>配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap &lt;Leader&gt;&lt;Leader&gt;c :CtrlSF&lt;space&gt;</span><br></pre></td></tr></table></figure></li></ol><h2 id="使用-3"><a href="#使用-3" class="headerlink" title="使用"></a>使用</h2><ul><li>使用快捷键 <code>&lt;Leader&gt;&lt;Leader&gt;c</code> 唤出搜索命令后，输入关键词和文件名</li><li>如：<code>:CtrlSF test *.py</code>回车即可跳转到第一个匹配行，并列出搜索结果，并点击<code>o</code>跳转命中文件</li></ul>]]></content>
      
      
      <categories>
          
          <category> vim </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eclipse中一键删除类中无用的包</title>
      <link href="/2017/04/09/Eclipse%E4%B8%AD%E4%B8%80%E9%94%AE%E5%88%A0%E9%99%A4%E7%B1%BB%E4%B8%AD%E6%97%A0%E7%94%A8%E7%9A%84%E5%8C%85/"/>
      <url>/2017/04/09/Eclipse%E4%B8%AD%E4%B8%80%E9%94%AE%E5%88%A0%E9%99%A4%E7%B1%BB%E4%B8%AD%E6%97%A0%E7%94%A8%E7%9A%84%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<h1 id="第一种：移除某个类中的"><a href="#第一种：移除某个类中的" class="headerlink" title="第一种：移除某个类中的"></a>第一种：移除某个类中的</h1><p>在Java类中按键<code>Ctrl+Shift+O</code><br><img src="/images/2020/04/20200409002.png" alt></p><h1 id="第二种：移除整个包中的"><a href="#第二种：移除整个包中的" class="headerlink" title="第二种：移除整个包中的"></a>第二种：移除整个包中的</h1><p>本质上和第一种是一样的</p><ol><li>在<code>Package Explorer</code>下右键点击包名</li><li>依次选择Source -&gt; Organize imports即可</li></ol><h1 id="第三种：保存时自动移除"><a href="#第三种：保存时自动移除" class="headerlink" title="第三种：保存时自动移除"></a>第三种：保存时自动移除</h1><p>虽然好用省事,但如果开发团队没有规定就不要乱打开</p><ol><li><code>Windows -&gt; Preferences -&gt; Java -&gt; Editor -&gt; Save Actions</code></li><li>然后选择<code>Perform the selected action on save</code></li><li>再勾选`Organize imports即可</li></ol>]]></content>
      
      
      <categories>
          
          <category> Eclipse </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Eclipse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java中的多线程</title>
      <link href="/2017/04/08/Java%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
      <url>/2017/04/08/Java%E4%B8%AD%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="进程和线程-Process与Thread"><a href="#进程和线程-Process与Thread" class="headerlink" title="进程和线程(Process与Thread)"></a>进程和线程(Process与Thread)</h1><table><thead><tr><th>区别</th><th>进程</th><th>线程</th></tr></thead><tbody><tr><td>根本区别</td><td>作为资源分贝的单位</td><td>调度和执行的单位</td></tr><tr><td>开销</td><td>每个进程都有独立的代码和数据空间(进程的上下文),进程间的切换会有较大的开销</td><td>献策和嗯可以看成轻量级的进程,同一类线程共享代码和数据空间,每个线程有独立的运行栈和程序计数器(PC),线程切换的开销小</td></tr><tr><td>所处环境</td><td>在操作系统中能同时运行多个任务(程序)</td><td>在同一应用程序中有多个顺序流同时执行</td></tr><tr><td>分配内存</td><td>系统在运行的时候会为每个进程分配不同的内存区域</td><td>除了CPU之外,不会为线程分配内存(线程所使用的资源是它所属进程的资源),线程组只能共享资源</td></tr><tr><td>包含关系</td><td>没有线程的进程可以被看作是单线程的,如果一个进程内拥有多个线程,则执行过程不是一条线的,而是多条线(线程)共同完成的</td><td>线程是进程的一部分,所以线程有的时候被称为是轻权进程或者轻量级进程</td></tr></tbody></table><p>注意:<strong>很多多线程是模拟出来的,真正的多线程是指有多个CPU</strong>,即多核,如服务器.如果是模拟出来的多线程,即一个CPU的情况下,那么,在同一个时间点,CPU只能执行一个代码,因为切换的很快,所以就有同时执行的错觉</p><p>对于Java来说</p><ul><li>线程就是独立的执行路径</li><li>在程序运行时,即使没有自己创建线程,后台也会存在多个线程,如gc线程,主线程</li><li>main()称之为主线程,为系统的入口点,用于执行整个程序</li><li>在一个进程中,如果开辟了多个线程,线程的运行由调度器安排调度,调度器是与操作系统紧密相关,先后顺序是不能人为的干预的</li><li>对同一份资源操作时,会存在资源抢夺的问题,需要加入并发控制</li><li>线程会带来额外的开销,如CPU调度时间,并发控制开销</li><li>每个线程在自己的工作内存交互,加载和存储主内存不当会造成数据不一致</li></ul><h1 id="创建线程"><a href="#创建线程" class="headerlink" title="创建线程"></a>创建线程</h1><p>三种方法</p><ul><li>继承Thread类(只能单继承)</li><li>实现Runnable接口(多用这个)</li><li>实现Callable接口(用的少,属于juc并发变成的一部分)</li></ul><h2 id="通过继承Thread类实现多线程"><a href="#通过继承Thread类实现多线程" class="headerlink" title="通过继承Thread类实现多线程"></a>通过继承Thread类实现多线程</h2><p>继承Thread类实现多线程的步骤：</p><ol><li>在Java中负责实现线程功能的类是java.lang.Thread 类。</li><li>可以通过创建 Thread的实例来创建新的线程。</li><li>每个线程都是通过某个特定的Thread对象所对应的方法run( )来完成其操作的，方法run( )称为线程体。</li><li>通过调用Thread类的start()方法来启动一个线程。<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;<span class="comment">//自定义类继承Thread类</span></span><br><span class="line">    <span class="comment">//run()方法里是线程体</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.getName() + <span class="string">":"</span> + i);<span class="comment">//getName()方法是返回线程名称</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TestThread thread1 = <span class="keyword">new</span> TestThread();<span class="comment">//创建线程对象</span></span><br><span class="line">        thread1.start();<span class="comment">//启动线程</span></span><br><span class="line">        TestThread thread2 = <span class="keyword">new</span> TestThread();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="通过实现Runnable接口实现多线程"><a href="#通过实现Runnable接口实现多线程" class="headerlink" title="通过实现Runnable接口实现多线程"></a>通过实现Runnable接口实现多线程</h2><p>我们应用更多的是通过Runnable接口实现多线程。这种方式克服了继承Thread类实现线程的缺点，即在实现Runnable接口的同时还可以继承某个类。所以实现Runnable接口的方式要通用一些。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread2</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;<span class="comment">//自定义类实现Runnable接口；</span></span><br><span class="line">    <span class="comment">//run()方法里是线程体；</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">":"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建线程对象，把实现了Runnable接口的对象作为参数传入；</span></span><br><span class="line">        Thread thread1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> TestThread2());</span><br><span class="line">        thread1.start();<span class="comment">//启动线程；</span></span><br><span class="line"></span><br><span class="line">        Thread thread2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> TestThread2());</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="通过实现Callable接口实现多线程"><a href="#通过实现Callable接口实现多线程" class="headerlink" title="通过实现Callable接口实现多线程"></a>通过实现Callable接口实现多线程</h2><ol><li><p>实现Callable接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.multithread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculateStringLength</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String word;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">CalculateStringLength</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.word = word;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Thread currentThread = Thread.currentThread();</span><br><span class="line">System.out.println(currentThread.getName() + <span class="string">":开始执行"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 假设处理需要2秒</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">currentThread.sleep(<span class="number">2000</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println(currentThread.getName() + <span class="string">":正在处理"</span>);</span><br><span class="line">System.out.println(Thread.currentThread().getName() + <span class="string">": "</span> + word + <span class="string">"长度为："</span> + word.length());</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> Integer.valueOf(word.length());</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>创建执行服务,并提交执行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.multithread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RunMultiThread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String[] words;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">RunMultiThread</span><span class="params">(String[] words)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.words = words;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">runThread</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line"><span class="comment">// 创建一个线程池(创建执行服务)</span></span><br><span class="line">ExecutorService pool = Executors.newCachedThreadPool();</span><br><span class="line">Set&lt;Future&lt;Integer&gt;&gt; set = <span class="keyword">new</span> HashSet&lt;Future&lt;Integer&gt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">CalculateStringLength testCallable = <span class="keyword">new</span> CalculateStringLength(word);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提交执行</span></span><br><span class="line">Future&lt;Integer&gt; future = pool.submit(testCallable);</span><br><span class="line"></span><br><span class="line">set.add(future);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (Future&lt;Integer&gt; future : set) &#123;</span><br><span class="line">sum += future.get();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.multithread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculateStringLengthTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">String[] words = &#123;<span class="string">"first"</span>, <span class="string">"second"</span>, <span class="string">"thread"</span>&#125;;</span><br><span class="line">RunMultiThread runMultiThread = <span class="keyword">new</span> RunMultiThread(words);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">int</span> sumLength = runMultiThread.runThread();</span><br><span class="line">System.out.println(<span class="string">"数组中所有单词的总长度为："</span> + sumLength);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="线程状态"><a href="#线程状态" class="headerlink" title="线程状态"></a>线程状态</h1><p><img src="/images/2020/04/20200410001.png" alt></p><h2 id="新生状态-New"><a href="#新生状态-New" class="headerlink" title="新生状态(New)"></a>新生状态(New)</h2><p>用new关键字建立一个线程对象后，该线程对象就处于新生状态。处于新生状态的线程有自己的内存空间，通过调用start方法进入就绪状态</p><h2 id="就绪状态"><a href="#就绪状态" class="headerlink" title="就绪状态"></a>就绪状态</h2><ul><li><p>什么是就绪状态</p><ul><li>处于就绪状态的线程已经具备了运行条件，但是还没有被分配到CPU，处于“线程就绪队列”，等待系统为其分配CPU。</li><li>就绪状态并不是执行状态，当系统选定一个等待执行的Thread对象后，它就会进入执行状态。一旦获得CPU，线程就进入运行状态并自动调用自己的run方法。</li></ul></li><li><p>有4中原因会导致线程进入就绪状态：</p><ul><li>新建线程：调用start()方法，进入就绪状态;</li><li>阻塞线程：阻塞解除，进入就绪状态;</li><li>运行线程：调用yield()方法，直接进入就绪状态;</li><li>运行线程：JVM将CPU资源从本线程切换到其他线程。</li></ul></li></ul><h2 id="运行状态-Running"><a href="#运行状态-Running" class="headerlink" title="运行状态(Running)"></a>运行状态(Running)</h2><ul><li>在运行状态的线程执行自己run方法中的代码，直到调用其他方法而终止或等待某资源而阻塞或完成任务而死亡。</li><li>如果在给定的时间片内没有执行结束，就会被系统给换下来回到就绪状态。</li><li>也可能由于某些“导致阻塞的事件”而进入阻塞状态。</li></ul><h2 id="阻塞状态-Blocked"><a href="#阻塞状态-Blocked" class="headerlink" title="阻塞状态(Blocked)"></a>阻塞状态(Blocked)</h2><ul><li>阻塞指的是暂停一个线程的执行以等待某个条件发生(如某资源就绪)</li><li>有4种原因会导致阻塞<ul><li>执行sleep(int millsecond)方法，使当前线程休眠，进入阻塞状态。当指定的时间到了后，线程进入就绪状态。(这种是抱着资源睡觉)</li><li>执行wait()方法，使当前线程进入阻塞状态。当使用nofity()方法唤醒这个线程后，它进入就绪状态。(这种是等在一边,资源是会让出来的)</li><li>线程运行时，某个操作进入阻塞状态<ul><li>比如执行IO流操作(read()/write()方法本身就是阻塞的方法)。只有当引起该操作阻塞的原因消失后，线程进入就绪状态。</li></ul></li><li>join()线程联合: 当某个线程等待另一个线程执行结束后，才能继续执行时，使用join()方法。<ul><li>“爸爸线程”要抽烟，于是联合了“儿子线程”去买烟，必须等待“儿子线程”买烟完毕，“爸爸线程”才能继续抽烟</li></ul></li></ul></li></ul><h2 id="死亡状态-Terminated"><a href="#死亡状态-Terminated" class="headerlink" title="死亡状态(Terminated)"></a>死亡状态(Terminated)</h2><ul><li>死亡状态是线程生命周期中的最后一个阶段</li><li>线程死亡的原因有两个<ul><li>一个是正常运行的线程完成了它run()方法内的全部工作;</li><li>另一个是线程被强制终止，如通过执行stop()或destroy()方法来终止一个线程(注：stop()/destroy()方法已经被JDK废弃，不推荐使用)。</li></ul></li><li>当一个线程进入死亡状态以后，就不能再回到其它状态了。</li></ul><h1 id="线程终止的典型方法"><a href="#线程终止的典型方法" class="headerlink" title="线程终止的典型方法"></a>线程终止的典型方法</h1><p>由于stop()/destroy()方法已将被JDK废弃了,而我们通常的做法是提供一个boolean型的终止变量，当这个变量置为false，则终止线程的运行。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThreadCiycle</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">boolean</span> live = <span class="keyword">true</span>;<span class="comment">// 标记变量，表示线程是否可中止；</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TestThreadCiycle</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//当live的值是true时，继续线程体；false则结束循环，继而终止线程体；</span></span><br><span class="line">        <span class="keyword">while</span> (live) &#123;</span><br><span class="line">            System.out.println(name + (i++));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">terminate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        live = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TestThreadCiycle ttc = <span class="keyword">new</span> TestThreadCiycle(<span class="string">"线程A:"</span>);</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(ttc);<span class="comment">// 新生状态</span></span><br><span class="line">        t1.start();<span class="comment">// 就绪状态</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">"主线程"</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        ttc.terminate();</span><br><span class="line">        System.out.println(<span class="string">"ttc stop!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="暂停线程执行"><a href="#暂停线程执行" class="headerlink" title="暂停线程执行"></a>暂停线程执行</h1><h2 id="暂停sleep"><a href="#暂停sleep" class="headerlink" title="暂停sleep"></a>暂停sleep</h2><ul><li>sleep(时间)指定当前线程阻塞的毫秒数</li><li>sleep存在异常<code>InterruptedException</code></li><li>sleep时间达到后线程进入就绪状态</li><li>sleep可以模拟网络延时,倒计时等</li><li>每一个对象都有一个锁,sleep不会释放锁</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThreadState</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StateThread thread1 = <span class="keyword">new</span> StateThread();</span><br><span class="line">        thread1.start();</span><br><span class="line">        StateThread thread2 = <span class="keyword">new</span> StateThread();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用继承方式实现多线程</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StateThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.getName() + <span class="string">":"</span> + i);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);<span class="comment">//调用线程的sleep()方法；</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行时可以感受到每条结果输出之前的延迟，是Thread.sleep(2000)语句在起作用</p><h2 id="礼让yield"><a href="#礼让yield" class="headerlink" title="礼让yield"></a>礼让yield</h2><ul><li>礼让线程,让当前正在执行线程暂停</li><li>不是阻塞线程,而是将线程从运行状态转入就绪状态</li><li>让CPU调度器重新调度</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThreadState</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StateThread thread1 = <span class="keyword">new</span> StateThread();</span><br><span class="line">        thread1.start();</span><br><span class="line">        StateThread thread2 = <span class="keyword">new</span> StateThread();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//使用继承方式实现多线程</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StateThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.getName() + <span class="string">":"</span> + i);</span><br><span class="line">            Thread.yield();<span class="comment">//调用线程的yield()方法；</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以引起线程切换，但运行时没有明显延迟</p><h2 id="插队join"><a href="#插队join" class="headerlink" title="插队join"></a>插队join</h2><p>线程A在运行期间，可以调用线程B的join()方法，让线程B和线程A联合。这样，线程A就必须等待线程B执行完毕后，才能继续执行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThreadState</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"爸爸和儿子买烟故事"</span>);</span><br><span class="line">        Thread father = <span class="keyword">new</span> Thread(<span class="keyword">new</span> FatherThread());</span><br><span class="line">        father.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FatherThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"爸爸想抽烟，发现烟抽完了"</span>);</span><br><span class="line">        System.out.println(<span class="string">"爸爸让儿子去买包红塔山"</span>);</span><br><span class="line">        Thread son = <span class="keyword">new</span> Thread(<span class="keyword">new</span> SonThread());</span><br><span class="line">        son.start();</span><br><span class="line">        System.out.println(<span class="string">"爸爸等儿子买烟回来"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            son.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">"爸爸出门去找儿子跑哪去了"</span>);</span><br><span class="line">            <span class="comment">// 结束JVM。如果是0则表示正常结束；如果是非0则表示非正常结束</span></span><br><span class="line">            System.exit(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"爸爸高兴的接过烟开始抽，并把零钱给了儿子"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SonThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"儿子出门去买烟"</span>);</span><br><span class="line">        System.out.println(<span class="string">"儿子买烟需要10分钟"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">"第"</span> + i + <span class="string">"分钟"</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"儿子买烟回来了"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="获取线程的基本信息"><a href="#获取线程的基本信息" class="headerlink" title="获取线程的基本信息"></a>获取线程的基本信息</h1><h2 id="手册中里对线程状态的规定"><a href="#手册中里对线程状态的规定" class="headerlink" title="手册中里对线程状态的规定"></a>手册中里对线程状态的规定</h2><p>可以在手册中查看<br><img src="/images/2020/04/20200410002.png" alt></p><p>线程可以处于以下状态之一：</p><table><thead><tr><th>线程状态</th><th>状态说明</th><th>对应的方法</th></tr></thead><tbody><tr><td>NEW</td><td>尚未启动的线程处于此状态。</td><td></td></tr><tr><td>RUNNABLE</td><td>在Java虚拟机中执行的线程处于此状态。</td><td></td></tr><tr><td>BLOCKED</td><td>被阻塞等待监视器锁定的线程处于此状态。</td><td>wait() 或 read/write IO操作 或 JUC里面的锁定</td></tr><tr><td>WAITING</td><td>正在等待另一个线程执行特定动作的线程处于此状态。</td><td>sleep()</td></tr><tr><td>TIMED_WAITING</td><td>正在等待另一个线程执行动作达到指定等待时间的线程处于此状态。</td><td>join()</td></tr><tr><td>TERMINATED</td><td>已退出的线程处于此状态。</td><td></td></tr></tbody></table><h2 id="获取线程基本信息的方法"><a href="#获取线程基本信息的方法" class="headerlink" title="获取线程基本信息的方法"></a>获取线程基本信息的方法</h2><ol><li><p>方法说明</p><table><thead><tr><th>方法</th><th>功能</th></tr></thead><tbody><tr><td>isAlive()</td><td>判断线程是否还”活”着,即线程是否还未终止</td></tr><tr><td>getPriority()</td><td>获取线程的优先级数值</td></tr><tr><td>setPriority()</td><td>设置线程的优先级数值</td></tr><tr><td>setName()</td><td>给线程一个名字</td></tr><tr><td>getName()</td><td>取得线程的名字</td></tr><tr><td>currentThread()</td><td>取得当前正在运行的线程对象,也就是取得自己本身</td></tr></tbody></table></li><li><p>测试代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] argc)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Runnable r = <span class="keyword">new</span> MyThread();</span><br><span class="line">        Thread t = <span class="keyword">new</span> Thread(r, <span class="string">"Name test"</span>);<span class="comment">//定义线程对象，并传入参数；</span></span><br><span class="line">        t.start();<span class="comment">//启动线程；</span></span><br><span class="line">        System.out.println(<span class="string">"name is: "</span> + t.getName());<span class="comment">//输出线程名称；</span></span><br><span class="line">        Thread.currentThread().sleep(<span class="number">5000</span>);<span class="comment">//线程暂停5分钟；</span></span><br><span class="line">        System.out.println(t.isAlive());<span class="comment">//判断线程还在运行吗？</span></span><br><span class="line">        System.out.println(<span class="string">"over!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="comment">//线程体；</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">            System.out.println(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h1 id="线程的优先级"><a href="#线程的优先级" class="headerlink" title="线程的优先级"></a>线程的优先级</h1><h2 id="优先级的细节"><a href="#优先级的细节" class="headerlink" title="优先级的细节"></a>优先级的细节</h2><ul><li><p>Java提供一个线程调度器来监控程序启动后进入就绪状态的所有线程,线程调度器按照线程的优先级决定应调度哪个线程来执行</p><ul><li>处于就绪状态的线程，会进入“就绪队列”等待JVM来挑选</li></ul></li><li><p>也就是说,优先级低只是意味着获得调度的概率低,并不是绝对先调用优先级高的线程后调用优先级低的线程</p></li><li><p>线程的优先级用数字表示,范围从1到10,一个线程缺省优先级为5<br><img src="/images/2020/04/20200411001.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Thread.MIN_PRIORITY = 1</span><br><span class="line">Thread.MAX_PRIORITY = 10</span><br><span class="line">Thread.NORM_PRIORITY = 5</span><br></pre></td></tr></table></figure></li><li><p>使用下述方法获得或设置线程对象的优先级</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getPriority</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setPriority</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></li><li><p>优先级的设定建议在start()调用前</p></li></ul><h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestThread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyThread(), <span class="string">"t1"</span>);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyThread(), <span class="string">"t2"</span>);</span><br><span class="line">        t1.setPriority(<span class="number">1</span>);</span><br><span class="line">        t2.setPriority(<span class="number">10</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">": "</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="用户线程和守护线程"><a href="#用户线程和守护线程" class="headerlink" title="用户线程和守护线程"></a>用户线程和守护线程</h1><h2 id="守护线程细节"><a href="#守护线程细节" class="headerlink" title="守护线程细节"></a>守护线程细节</h2><ol><li>线程分为用户线程和守护线程</li><li>虚拟机不看守护线程的脸色,只看用户线程的脸色,也就是说<ul><li>虚拟机必须确保用户线程执行完毕</li><li>守护线程是为用户线程服务的,jvm停止不用等守护线程执行完毕</li></ul></li><li>守护线程(daemon)举例<ul><li>后台记录操作日志</li><li>监控内存使用</li><li>等等…</li></ul></li><li>使用<code>xxxThread.setDaemon(true)</code>改用户线程为守护线程</li></ol><h2 id="说明用代码"><a href="#说明用代码" class="headerlink" title="说明用代码"></a>说明用代码</h2><ol><li><p>上帝线程(守护线程)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.multithread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">God</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">365</span> * <span class="number">100000000</span>; i++) &#123;</span><br><span class="line">System.out.println(<span class="string">"God bless you ..."</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"ooooo....."</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>“你自己人生”线程(用户线程)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.multithread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">YouLife</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">365</span>*<span class="number">100</span>; i++) &#123;</span><br><span class="line">System.out.println(<span class="string">"happy life..."</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">"ooooooooooo......."</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>上帝保佑你的人生</p><ul><li>守护线程守护用户线程</li><li>虚拟机确保”你的人生”执行完毕,即确保守护线程执行完毕</li><li>虚拟机不用等”上帝”程执行完毕,即不用等守护线程执行完毕</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.multithread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeamonDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">God god = <span class="keyword">new</span> God();</span><br><span class="line">YouLife youLife = <span class="keyword">new</span> YouLife();</span><br><span class="line"></span><br><span class="line">Thread godThread = <span class="keyword">new</span> Thread(god);</span><br><span class="line">godThread.setDaemon(<span class="keyword">true</span>);  <span class="comment">// 将上帝线程设置为守护线程</span></span><br><span class="line">godThread.start();</span><br><span class="line"></span><br><span class="line">Thread youLifeThread = <span class="keyword">new</span> Thread(god);</span><br><span class="line">youLifeThread.start();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="线程同步"><a href="#线程同步" class="headerlink" title="线程同步"></a>线程同步</h1><h2 id="同步问题的提出"><a href="#同步问题的提出" class="headerlink" title="同步问题的提出"></a>同步问题的提出</h2><h3 id="现实生活中的问题"><a href="#现实生活中的问题" class="headerlink" title="现实生活中的问题"></a>现实生活中的问题</h3><p>现实生活中，我们会遇到“同一个资源，多个人都想使用”的问题。</p><ul><li>比如：教室里，只有一台电脑，多个人都想使用。天然的解决办法就是，在电脑旁边，大家排队。前一人使用完后，后一人再使用。</li><li>又或者:取钱,你和你老婆同时取同一个账户的钱</li></ul><h3 id="取钱会出问题的代码模拟"><a href="#取钱会出问题的代码模拟" class="headerlink" title="取钱会出问题的代码模拟"></a>取钱会出问题的代码模拟</h3><ol><li><p>代码模拟</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSync</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Account a1 = <span class="keyword">new</span> Account(<span class="number">100</span>, <span class="string">"高"</span>);</span><br><span class="line">        Drawing draw1 = <span class="keyword">new</span> Drawing(<span class="number">80</span>, a1);<span class="comment">// 定义取钱线程对象；</span></span><br><span class="line">        Drawing draw2 = <span class="keyword">new</span> Drawing(<span class="number">80</span>, a1);<span class="comment">// 定义取钱线程对象；</span></span><br><span class="line">        draw1.start(); <span class="comment">// 你取钱</span></span><br><span class="line">        draw2.start(); <span class="comment">// 你老婆取钱</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 简单表示银行账户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> money;</span><br><span class="line">    String aname;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(<span class="keyword">int</span> money, String aname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.money = money;</span><br><span class="line">        <span class="keyword">this</span>.aname = aname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模拟提款操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Drawing</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> drawingNum; <span class="comment">// 取多少钱</span></span><br><span class="line">    Account account; <span class="comment">// 要取钱的账户</span></span><br><span class="line">    <span class="keyword">int</span> expenseTotal; <span class="comment">// 总共取的钱数</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Drawing</span><span class="params">(<span class="keyword">int</span> drawingNum, Account account)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.drawingNum = drawingNum;</span><br><span class="line">        <span class="keyword">this</span>.account = account;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (account.money - drawingNum &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>); <span class="comment">// 判断完后阻塞。其他线程开始运行。</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        account.money -= drawingNum;</span><br><span class="line">        expenseTotal += drawingNum;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getName() + <span class="string">"--账户余额："</span> + account.money);</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getName() + <span class="string">"--总共取了："</span> + expenseTotal);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>运行结果<br><img src="/images/2020/04/20200411002.png" alt><br>没有线程同步机制，两个线程同时操作同一个账户对象，竟然从只有100元的账户，轻松取出<code>80*2=160</code>元，账户余额竟然成为了<code>-60</code>。这么大的问题，显然银行不会答应的</p></li></ol><h2 id="线程同步的概念"><a href="#线程同步的概念" class="headerlink" title="线程同步的概念"></a>线程同步的概念</h2><ul><li>处理多线程问题时，多个线程访问同一个对象，并且某些线程还想修改这个对象。 这时候，我们就需要用到“线程同步”。</li><li>线程同步其实就是一种等待机制，多个需要同时访问此对象的线程进入这个对象的<strong>等待池形成队列</strong>，等待前面的线程使用完毕后，下一个线程再使用。<ul><li>为了保证数据在方法中被访问时的正确性,在访问时加入锁机制(synchronized),当一个线程获得对象的排他锁,独占资源,其他线程必须等待</li></ul></li></ul><h2 id="线程同步带来的问题"><a href="#线程同步带来的问题" class="headerlink" title="线程同步带来的问题"></a>线程同步带来的问题</h2><p>由于同一进程的多个线程共享统一块存储空间,在带来方便的同时,也带来了访问冲突的问题,具体如下</p><ul><li>一个线程持有锁会导致其他所有需要此锁的线程被挂起</li><li>在多线程竞争下,加锁,释放锁会导致比较多上下文切换和调度延时,引起性能问题</li><li>如果一个优先级高的线程等待一个优先级低的线程释放锁会导致线程优先级倒置,引起性能问题</li></ul><h2 id="synchronized关键字"><a href="#synchronized关键字" class="headerlink" title="synchronized关键字"></a>synchronized关键字</h2><ol><li>synchronized关键字的提出<ul><li>由于我们可以通过private关键字来保证数据对象只能被方法访问,所以我们<strong>只需要针对方法提出一套机制</strong>,这套机制就是<code>synchronized</code>关键字</li><li>它包括两种方法,<code>synchronized方法</code>和<code>synchronized块</code></li></ul></li></ol><h2 id="synchronized方法和synchronized块"><a href="#synchronized方法和synchronized块" class="headerlink" title="synchronized方法和synchronized块"></a>synchronized方法和synchronized块</h2><h3 id="synchronized方法"><a href="#synchronized方法" class="headerlink" title="synchronized方法"></a>synchronized方法</h3><ol><li><p>通过在方法声明中加入 synchronized关键字来声明，语法如下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">method</span> <span class="params">(<span class="keyword">int</span> args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// do something ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>synchronized关键字的机制</p><ul><li>synchronized方法控制对”成员变量|类变量”对象的访问</li><li>每个对象对应一把锁</li><li>每个synchronized方法都必须获得调用该方法的对象的锁方能执行,否则所属线程阻塞</li><li>方法一旦执行,就独占该锁,直到从该方法返回时才将锁释放</li><li>此后被阻塞的线程方能获得该锁,重新进入可执行状态</li></ul></li><li><p>缺陷:若将一个大的声明为synchronized将大大影响效率</p></li></ol><h3 id="synchronized块"><a href="#synchronized块" class="headerlink" title="synchronized块"></a>synchronized块</h3><ol><li>为了解决<code>若将一个大的声明为synchronized将大大影响效率</code>的缺陷,Java 为我们提供了更好的解决办法，那就是 synchronized 块。</li><li>块可以让我们精确地控制到具体的“成员变量”，缩小同步的范围，提高效率</li><li>synchronized 块：通过 synchronized关键字来声明synchronized 块，语法如下：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(syncObject)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//允许访问控制的代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h2><h3 id="Java中的块"><a href="#Java中的块" class="headerlink" title="Java中的块"></a>Java中的块</h3><p>java中的块有4种,分别如下</p><ol><li>局部块(普通块) -&gt; 写在方法里面,作用是控制变量的作用范围</li><li>构造块 -&gt; 写在和类属性一个位置,方法之外,和构造方法作用一致,对象加载时加载</li><li>静态构造块 -&gt; 构造块加static关键字,类加载的时候加载</li><li>同步块 -&gt; 前面所述</li></ol><h3 id="CopyOnWrite容器"><a href="#CopyOnWrite容器" class="headerlink" title="CopyOnWrite容器"></a>CopyOnWrite容器</h3><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><ul><li><a href="https://blog.csdn.net/u010002184/article/details/90452918" target="_blank" rel="noopener">CopyOnWriteArrayList原理，优缺点，使用场景</a></li><li><a href="http://ifeve.com/java-copy-on-write/" target="_blank" rel="noopener">聊聊并发-Java中的Copy-On-Write容器</a></li></ul><h4 id="什么是CopyOnWrite容器"><a href="#什么是CopyOnWrite容器" class="headerlink" title="什么是CopyOnWrite容器"></a>什么是CopyOnWrite容器</h4><ul><li>CopyOnWrite容器即写时复制的容器。</li><li>通俗的理解是当我们往一个容器添加元素的时候，不直接往当前容器添加，而是先将当前容器进行Copy，复制出一个新的容器</li><li>然后新的容器里添加元素，添加完元素之后，再将原容器的引用指向新的容器</li></ul><h4 id="有什么好处"><a href="#有什么好处" class="headerlink" title="有什么好处"></a>有什么好处</h4><ul><li>我们可以对CopyOnWrite容器进行并发的读，而不需要加锁,因为当前容器不会添加任何元素。</li><li>所以CopyOnWrite容器也是一种读写分离的思想，读和写不同的容器。</li></ul><h4 id="CopyOnWrite在多线程场景中的使用"><a href="#CopyOnWrite在多线程场景中的使用" class="headerlink" title="CopyOnWrite在多线程场景中的使用"></a>CopyOnWrite在多线程场景中的使用</h4><ul><li>具体代码中的区别如下(CopyOnWriteArrayList)<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多线程</span></span><br><span class="line"><span class="comment"> * 使用普通的ArrayList,不使用CopyOnWriteArrayList的情况</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">syncContainer1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">ArrayList&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt;  &#123;</span><br><span class="line"><span class="comment">// 需要写同步块</span></span><br><span class="line"><span class="keyword">synchronized</span> (list) &#123;</span><br><span class="line">list.add(Thread.currentThread().getName());</span><br><span class="line">&#125;</span><br><span class="line">&#125;).start();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多线程</span></span><br><span class="line"><span class="comment"> * 使用CopyOnWriteArrayList的情况</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">syncContainer2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">CopyOnWriteArrayList&lt;String&gt; list = <span class="keyword">new</span> CopyOnWriteArrayList&lt;String&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line"><span class="keyword">new</span> Thread(() -&gt;  &#123;</span><br><span class="line"><span class="comment">// 不需要写同步块</span></span><br><span class="line">list.add(Thread.currentThread().getName());</span><br><span class="line">&#125;).start();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="CopyOnWriteArrayList的实现原理"><a href="#CopyOnWriteArrayList的实现原理" class="headerlink" title="CopyOnWriteArrayList的实现原理"></a>CopyOnWriteArrayList的实现原理</h4><ul><li>上述代码使用了CopyOnWriteArrayList，接下去我们看看其源码是如何实现的。以下代码是向CopyOnWriteArrayList中add方法的实现（向CopyOnWriteArrayList里添加元素），可以发现在添加的时候是需要加锁的，否则多线程写的时候会Copy出N个副本出来。</li><li>以下源码基于jdk1.8<ul><li>更新版本其实可以在搜索<code>synchronized</code>,是使用这个关键字实现的<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Appends the specified element to the end of this list.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e element to be appended to this list</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; (as specified by &#123;<span class="doctag">@link</span> Collection#add&#125;)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 当前线程进行写前要加锁</span></span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 获取旧数组</span></span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="comment">// 获取旧数组长度</span></span><br><span class="line">        <span class="keyword">int</span> len = elements.length;</span><br><span class="line">        <span class="comment">// 创建一个新的数组,长度比旧数组多1,并将旧数组拷贝进新的数组</span></span><br><span class="line">        Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 将要添加的元素添加进新的数组</span></span><br><span class="line">        newElements[len] = e;</span><br><span class="line">        <span class="comment">// 将原来指向旧数组的指针指向新的数组 </span></span><br><span class="line">        setArray(newElements);</span><br><span class="line">        <span class="comment">// 返回true表示成功</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 写结束,解锁</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Removes the element at the specified position in this list.</span></span><br><span class="line"><span class="comment"> * Shifts any subsequent elements to the left (subtracts one from their</span></span><br><span class="line"><span class="comment"> * indices).  Returns the element that was removed from the list.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IndexOutOfBoundsException &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="keyword">int</span> len = elements.length;</span><br><span class="line">        E oldValue = get(elements, index);</span><br><span class="line">        <span class="keyword">int</span> numMoved = len - index - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (numMoved == <span class="number">0</span>)</span><br><span class="line">            setArray(Arrays.copyOf(elements, len - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Object[] newElements = <span class="keyword">new</span> Object[len - <span class="number">1</span>];</span><br><span class="line">            System.arraycopy(elements, <span class="number">0</span>, newElements, <span class="number">0</span>, index);</span><br><span class="line">            System.arraycopy(elements, index + <span class="number">1</span>, newElements, index,</span><br><span class="line">                             numMoved);</span><br><span class="line">            setArray(newElements);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Replaces the element at the specified position in this list with the</span></span><br><span class="line"><span class="comment"> * specified element.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IndexOutOfBoundsException &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, E element)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        E oldValue = get(elements, index);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (oldValue != element) &#123;</span><br><span class="line">            <span class="keyword">int</span> len = elements.length;</span><br><span class="line">            Object[] newElements = Arrays.copyOf(elements, len);</span><br><span class="line">            newElements[index] = element;</span><br><span class="line">            setArray(newElements);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Not quite a no-op; ensures volatile write semantics</span></span><br><span class="line">            setArray(elements);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><img src="/images/2020/08/20200811122702.png" alt></p><h4 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h4><ul><li>读的时候不需要加锁，如果读的时候有多个线程正在向CopyOnWriteArrayList添加数据，读还是会读到旧的数据，因为开始读的那一刻已经确定了读的对象是旧对象。</li><li>CopyOnWrite并发容器<strong>用于读多写少的并发场景</strong><ul><li>比如白名单，黑名单等场景</li></ul></li></ul><h4 id="CopyOnWrite的缺点"><a href="#CopyOnWrite的缺点" class="headerlink" title="CopyOnWrite的缺点"></a>CopyOnWrite的缺点</h4><p>CopyOnWrite容器有很多优点，但是同时也存在两个问题，即内存占用问题和数据一致性问题。所以在开发的时候需要注意一下。</p><ol><li><p><strong>内存占用问题</strong></p><ul><li>因为CopyOnWrite的写时复制机制，所以在进行写操作的时候，内存里会同时驻扎两个对象的内存，旧的对象和新写入的对象（注意:在复制的时候只是复制容器里的引用，只是在写的时候会创建新对象添加到新容器里，而旧容器的对象还在使用，所以有两份对象内存）。如果这些对象占用的内存比较大，比如说200M左右，那么再写入100M数据进去，内存就会占用300M，那么这个时候很有可能造成频繁的Yong GC和Full GC。之前我们系统中使用了一个服务由于每晚使用CopyOnWrite机制更新大对象，造成了每晚15秒的Full GC，应用响应时间也随之变长。</li><li>针对内存占用问题，可以通过压缩容器中的元素的方法来减少大对象的内存消耗，比如，如果元素全是10进制的数字，可以考虑把它压缩成36进制或64进制。或者不使用CopyOnWrite容器，而使用其他的并发容器，如ConcurrentHashMap。</li></ul></li><li><p><strong>数据一致性问题</strong></p><ul><li>CopyOnWrite容器只能保证数据的最终一致性，不能保证数据的实时一致性。所以如果你希望写入的的数据，马上能读到，请不要使用CopyOnWrite容器。</li></ul></li></ol><h2 id="使用synchronized块解决前面取钱出问题的代码"><a href="#使用synchronized块解决前面取钱出问题的代码" class="headerlink" title="使用synchronized块解决前面取钱出问题的代码"></a>使用synchronized块解决前面取钱出问题的代码</h2><ol><li>代码<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSync</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Account a1 = <span class="keyword">new</span> Account(<span class="number">100</span>, <span class="string">"高"</span>);</span><br><span class="line">        Drawing draw1 = <span class="keyword">new</span> Drawing(<span class="number">80</span>, a1);</span><br><span class="line">        Drawing draw2 = <span class="keyword">new</span> Drawing(<span class="number">80</span>, a1);</span><br><span class="line">        draw1.start(); <span class="comment">// 你取钱</span></span><br><span class="line">        draw2.start(); <span class="comment">// 你老婆取钱</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 简单表示银行账户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> money;</span><br><span class="line">    String aname;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(<span class="keyword">int</span> money, String aname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.money = money;</span><br><span class="line">        <span class="keyword">this</span>.aname = aname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模拟提款操作</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Administrator</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Drawing</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> drawingNum; <span class="comment">// 取多少钱</span></span><br><span class="line">    Account account; <span class="comment">// 要取钱的账户</span></span><br><span class="line">    <span class="keyword">int</span> expenseTotal; <span class="comment">// 总共取的钱数</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Drawing</span><span class="params">(<span class="keyword">int</span> drawingNum, Account account)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.drawingNum = drawingNum;</span><br><span class="line">        <span class="keyword">this</span>.account = account;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        draw();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (account) &#123;</span><br><span class="line">            <span class="keyword">if</span> (account.money - drawingNum &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(<span class="keyword">this</span>.getName() + <span class="string">"取款，余额不足！"</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>); <span class="comment">// 判断完后阻塞。其他线程开始运行。</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            account.money -= drawingNum;</span><br><span class="line">            expenseTotal += drawingNum;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getName() + <span class="string">"--账户余额："</span> + account.money);</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.getName() + <span class="string">"--总共取了："</span> + expenseTotal);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><ul><li><code>synchronized (account)</code>意味着线程需要获得account对象的“锁”才有资格运行同步块中的代码</li><li>Account对象的“锁”也称为“互斥锁”，在同一时刻只能被一个线程使用<ul><li>A线程拥有锁，则可以调用“同步块”中的代码;</li><li>B线程没有锁，则进入account对象的“锁池队列”等待，直到A线程使用完毕释放了account对象的锁，B线程得到锁才可以开始调用“同步块”中的代码。</li></ul></li></ul><ol start="2"><li>结果<br><img src="/images/2020/04/20200411003.png" alt><br><img src="/images/2020/04/20200411004.png" alt></li></ol><h1 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h1><h2 id="死锁的概念"><a href="#死锁的概念" class="headerlink" title="死锁的概念"></a>死锁的概念</h2><ul><li>“死锁”指的是:多个线程各自占有一些共享资源，并且互相等待其他线程占有的资源才能进行，而导致两个或者多个线程都在等待对方释放资源，都停止执行的情形。</li><li>也就是说,<strong>某一个同步块需要同时拥有“两个以上对象的锁”时，就可能会发生“死锁”的问题</strong></li></ul><h2 id="死锁问题演示"><a href="#死锁问题演示" class="headerlink" title="死锁问题演示"></a>死锁问题演示</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>下面案例中，</p><ol><li>“化妆线程”需要同时拥有“镜子对象”、“口红对象”才能运行同步块。</li><li>而在实际运行时<ul><li>“小丫的化妆线程”拥有了“镜子对象”</li><li>“大丫的化妆线程”拥有了“口红对象”</li><li>都在互相等待对方释放资源，才能化妆</li></ul></li><li>这样，两个线程就形成了互相等待，无法继续运行的“死锁状态”</li></ol><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lipstick</span> </span>&#123;<span class="comment">//口红类</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mirror</span> </span>&#123;<span class="comment">//镜子类</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//化妆类继承了Thread类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Makeup</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> flag;</span><br><span class="line">    String girl;</span><br><span class="line">    <span class="keyword">static</span> Lipstick lipstick = <span class="keyword">new</span> Lipstick();</span><br><span class="line">    <span class="keyword">static</span> Mirror mirror = <span class="keyword">new</span> Mirror();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        doMakeup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doMakeup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (flag == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 同步块同时拥有"两个以上对象的锁"</span></span><br><span class="line">            <span class="keyword">synchronized</span> (lipstick) &#123;<span class="comment">//需要得到口红的“锁”；</span></span><br><span class="line">                System.out.println(girl + <span class="string">"拿着口红！"</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">synchronized</span> (mirror) &#123;<span class="comment">//需要得到镜子的“锁”；</span></span><br><span class="line">                    System.out.println(girl + <span class="string">"拿着镜子！"</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 同步块同时拥有"两个以上对象的锁"</span></span><br><span class="line">            <span class="keyword">synchronized</span> (mirror) &#123;</span><br><span class="line">                System.out.println(girl + <span class="string">"拿着镜子！"</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (lipstick) &#123;</span><br><span class="line">                    System.out.println(girl + <span class="string">"拿着口红！"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDeadLock</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Makeup m1 = <span class="keyword">new</span> Makeup();<span class="comment">//大丫的化妆线程；</span></span><br><span class="line">        m1.girl = <span class="string">"大丫"</span>;</span><br><span class="line">        m1.flag = <span class="number">0</span>;</span><br><span class="line">        Makeup m2 = <span class="keyword">new</span> Makeup();<span class="comment">//小丫的化妆线程；</span></span><br><span class="line">        m2.girl = <span class="string">"小丫"</span>;</span><br><span class="line">        m2.flag = <span class="number">1</span>;</span><br><span class="line">        m1.start();</span><br><span class="line">        m2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p><img src="/images/2020/04/20200413001.png" alt></p><h2 id="死锁问题解决"><a href="#死锁问题解决" class="headerlink" title="死锁问题解决"></a>死锁问题解决</h2><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>死锁是由于“同步块需要同时持有多个对象锁造成”的，要解决这个问题，思路很简单，就是：<strong>同一个代码块，不要同时持有两个对象锁</strong></p><h3 id="代码修改"><a href="#代码修改" class="headerlink" title="代码修改"></a>代码修改</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lipstick</span> </span>&#123;<span class="comment">//口红类</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mirror</span> </span>&#123;<span class="comment">//镜子类</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Makeup</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;<span class="comment">//化妆类继承了Thread类</span></span><br><span class="line">    <span class="keyword">int</span> flag;</span><br><span class="line">    String girl;</span><br><span class="line">    <span class="keyword">static</span> Lipstick lipstick = <span class="keyword">new</span> Lipstick();</span><br><span class="line">    <span class="keyword">static</span> Mirror mirror = <span class="keyword">new</span> Mirror();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        doMakeup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doMakeup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (flag == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lipstick) &#123;</span><br><span class="line">                System.out.println(girl + <span class="string">"拿着口红！"</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (mirror) &#123;</span><br><span class="line">                System.out.println(girl + <span class="string">"拿着镜子！"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (mirror) &#123;</span><br><span class="line">                System.out.println(girl + <span class="string">"拿着镜子！"</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">synchronized</span> (lipstick) &#123;</span><br><span class="line">                System.out.println(girl + <span class="string">"拿着口红！"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDeadLock</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Makeup m1 = <span class="keyword">new</span> Makeup();<span class="comment">// 大丫的化妆线程；</span></span><br><span class="line">        m1.girl = <span class="string">"大丫"</span>;</span><br><span class="line">        m1.flag = <span class="number">0</span>;</span><br><span class="line">        Makeup m2 = <span class="keyword">new</span> Makeup();<span class="comment">// 小丫的化妆线程；</span></span><br><span class="line">        m2.girl = <span class="string">"小丫"</span>;</span><br><span class="line">        m2.flag = <span class="number">1</span>;</span><br><span class="line">        m1.start();</span><br><span class="line">        m2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="结果-1"><a href="#结果-1" class="headerlink" title="结果"></a>结果</h3><p><img src="/images/2020/04/20200413002.png" alt></p><h1 id="线程并发协作-线程通信"><a href="#线程并发协作-线程通信" class="headerlink" title="线程并发协作(线程通信)"></a>线程并发协作(线程通信)</h1><h2 id="什么是生产者-消费者模式"><a href="#什么是生产者-消费者模式" class="headerlink" title="什么是生产者/消费者模式"></a>什么是生产者/消费者模式</h2><ol><li>生产者和消费者共享同一个资源,并且生产者和消费者之间相互依赖,互为条件</li><li>对于生产者<ul><li>没有生产产品之前,消费者要进入等待状态</li><li>生产了产平之后,需要马上通知消费者消费</li></ul></li><li>对于消费者,在消费之后,要通知生产者已经消费结束,需要继续新产品以供消费</li><li>在生产者消费者问题中,仅有synchronized是不够的</li></ol><h2 id="synchronized能做到什么"><a href="#synchronized能做到什么" class="headerlink" title="synchronized能做到什么"></a>synchronized能做到什么</h2><ul><li>synchronized可阻止并发更新同一个共享资源,实现同步</li><li>synchronized不能用来实现不同线程之间的消息传递(通信)</li></ul><h2 id="线程之间入额进行消息传递"><a href="#线程之间入额进行消息传递" class="headerlink" title="线程之间入额进行消息传递"></a>线程之间入额进行消息传递</h2><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><table><thead><tr><th>方法名</th><th>作用</th></tr></thead><tbody><tr><td>final void wait()</td><td>表示线程一直等待,直到得到其他线程通知</td></tr><tr><td>void wait(long timeout)</td><td>线程等待指定毫秒参数时间</td></tr><tr><td>final void wait(long timeout, int nanos)</td><td>线程等待指定毫秒,微妙的时间</td></tr><tr><td>final void notify()</td><td>唤醒一个处于等待状态的线程</td></tr><tr><td>final void notifyAll()</td><td>唤醒同一个对象上所有调用wait()方法的线程,优先级别高的线程优先运行</td></tr></tbody></table><h3 id="使用举例"><a href="#使用举例" class="headerlink" title="使用举例"></a>使用举例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestProduce</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SyncStack sStack = <span class="keyword">new</span> SyncStack();<span class="comment">// 定义缓冲区对象；</span></span><br><span class="line">        Shengchan sc = <span class="keyword">new</span> Shengchan(sStack);<span class="comment">// 定义生产线程；</span></span><br><span class="line">        Xiaofei xf = <span class="keyword">new</span> Xiaofei(sStack);<span class="comment">// 定义消费线程；</span></span><br><span class="line">        sc.start();</span><br><span class="line">        xf.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mantou</span> </span>&#123;<span class="comment">// 馒头</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    Mantou(<span class="keyword">int</span> id) &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SyncStack</span> </span>&#123;<span class="comment">// 缓冲区(相当于：馒头筐)</span></span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line">    Mantou[] ms = <span class="keyword">new</span> Mantou[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(Mantou m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (index == ms.length) &#123;<span class="comment">//说明馒头筐满了</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">               <span class="comment">//wait后，线程会将持有的锁释放，进入阻塞状态；</span></span><br><span class="line">               <span class="comment">//这样其它需要锁的线程就可以获得锁；</span></span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">                <span class="comment">//这里的含义是执行此方法的线程暂停，进入阻塞状态，</span></span><br><span class="line">                <span class="comment">//等消费者消费了馒头后再生产。</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 唤醒在当前对象等待池中等待的第一个线程。</span></span><br><span class="line">        <span class="comment">//notifyAll叫醒所有在当前对象等待池中等待的所有线程。</span></span><br><span class="line">        <span class="keyword">this</span>.notify();</span><br><span class="line">        <span class="comment">// 如果不唤醒的话。以后这两个线程都会进入等待线程，没有人唤醒。</span></span><br><span class="line">        ms[index] = m;</span><br><span class="line">        index++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> Mantou <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (index == <span class="number">0</span>) &#123;<span class="comment">//如果馒头筐是空的；</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//如果馒头筐是空的，就暂停此消费线程（因为没什么可消费的嘛）。</span></span><br><span class="line">                <span class="keyword">this</span>.wait();                <span class="comment">//等生产线程生产完再来消费；</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.notify();</span><br><span class="line">        index--;</span><br><span class="line">        <span class="keyword">return</span> ms[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shengchan</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;<span class="comment">// 生产者线程</span></span><br><span class="line">    SyncStack ss = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Shengchan</span><span class="params">(SyncStack ss)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ss = ss;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">"生产馒头："</span> + i);</span><br><span class="line">            Mantou m = <span class="keyword">new</span> Mantou(i);</span><br><span class="line">            ss.push(m);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Xiaofei</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;<span class="comment">// 消费者线程；</span></span><br><span class="line">    SyncStack ss = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Xiaofei</span><span class="params">(SyncStack ss)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ss = ss;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            Mantou m = ss.pop();</span><br><span class="line">            System.out.println(<span class="string">"消费馒头："</span> + i);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eclipse目录树中不显示空包</title>
      <link href="/2017/04/01/Eclipse%E7%9B%AE%E5%BD%95%E6%A0%91%E4%B8%AD%E4%B8%8D%E6%98%BE%E7%A4%BA%E7%A9%BA%E5%8C%85/"/>
      <url>/2017/04/01/Eclipse%E7%9B%AE%E5%BD%95%E6%A0%91%E4%B8%AD%E4%B8%8D%E6%98%BE%E7%A4%BA%E7%A9%BA%E5%8C%85/</url>
      
        <content type="html"><![CDATA[<h1 id="Eclipse目录树中不显示空包"><a href="#Eclipse目录树中不显示空包" class="headerlink" title="Eclipse目录树中不显示空包"></a>Eclipse目录树中不显示空包</h1><ol><li>在Package Explorer的左上角，有个倒三角形，点开</li><li>有Fileters 选项，点开</li><li>Filters 中，勾上 Empty packages。即可将空包过滤了。</li></ol>]]></content>
      
      
      <categories>
          
          <category> Eclipse </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Eclipse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eclipse显示隐藏文件</title>
      <link href="/2017/02/26/Eclipse%E6%98%BE%E7%A4%BA%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6/"/>
      <url>/2017/02/26/Eclipse%E6%98%BE%E7%A4%BA%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="Eclipse显示隐藏文件"><a href="#Eclipse显示隐藏文件" class="headerlink" title="Eclipse显示隐藏文件"></a>Eclipse显示隐藏文件</h1><p>点号.开头的文件是隐藏文件，很多时候我们需要编辑它，比如.gitignore文件、.htaccess文件，在Eclipse作下设置，就不用麻烦地去另外打开编辑它了。<br>方法是：</p><ol><li>在Navigation或Project视图下</li><li>点右上角的三角形图标</li><li>弹出的菜单中点filter</li><li>然后取消<code>.* resources</code>一项</li><li>保存就可以了</li></ol>]]></content>
      
      
      <categories>
          
          <category> Eclipse </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Eclipse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git忽略文件</title>
      <link href="/2017/02/18/Git%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6/"/>
      <url>/2017/02/18/Git%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h1><p><a href="https://blog.csdn.net/HaHa_Sir/article/details/80628545" target="_blank" rel="noopener">https://blog.csdn.net/HaHa_Sir/article/details/80628545</a></p><h1 id="git所拥有的”区域”"><a href="#git所拥有的”区域”" class="headerlink" title="git所拥有的”区域”"></a>git所拥有的”区域”</h1><ul><li>Workspace：工作区</li><li>Index / Stage：暂存区</li><li>Repository：仓库区（或本地仓库）</li><li>Remote：远程仓库</li></ul><h1 id="git忽略文件"><a href="#git忽略文件" class="headerlink" title="git忽略文件"></a>git忽略文件</h1><h2 id="从未提交过的文件可以用-gitignore"><a href="#从未提交过的文件可以用-gitignore" class="headerlink" title="从未提交过的文件可以用.gitignore"></a>从未提交过的文件可以用<code>.gitignore</code></h2><ul><li>添加到暂存区，但从来没有提交到本地仓库的文件</li><li>也就是添加（add）之后从来没有提交（commit）过的文件，可以使用.gitignore忽略该文件</li><li>该文件<strong>只能作用于未跟踪的文件（Untracked Files）</strong>，也就是那些从来没有被 git 记录过的文件</li></ul><h2 id="已经推送（push）过的文件，想从git远程库中删除，并在以后的提交中忽略，但是却还想在本地保留这个文件"><a href="#已经推送（push）过的文件，想从git远程库中删除，并在以后的提交中忽略，但是却还想在本地保留这个文件" class="headerlink" title="已经推送（push）过的文件，想从git远程库中删除，并在以后的提交中忽略，但是却还想在本地保留这个文件"></a>已经推送（push）过的文件，想从git远程库中删除，并在以后的提交中忽略，但是却还想在本地保留这个文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm --cached Xml/config.xml</span><br></pre></td></tr></table></figure><ul><li>后面的 Xml/config.xml 是要从远程库中删除的文件的路径，支持通配符*</li><li>不小心提交到git上的一些log日志文件，想从远程库删除，可以用这个命令</li></ul><h2 id="已经推送（push）过的文件，想在以后的提交时忽略此文件，即使本地已经修改过，而且不删除git远程库中相应文件"><a href="#已经推送（push）过的文件，想在以后的提交时忽略此文件，即使本地已经修改过，而且不删除git远程库中相应文件" class="headerlink" title="已经推送（push）过的文件，想在以后的提交时忽略此文件，即使本地已经修改过，而且不删除git远程库中相应文件"></a>已经推送（push）过的文件，想在以后的提交时忽略此文件，即使本地已经修改过，而且不删除git远程库中相应文件</h2><ol><li>忽略一个文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//  忽略文件</span><br><span class="line">git update-index --assume-unchanged Xml/config.xml</span><br><span class="line">//  恢复忽略的文件</span><br><span class="line">git update-index --no-assume-unchanged Xml/config.xml</span><br></pre></td></tr></table></figure></li></ol><p>后面的 Xml/config.xml 是要忽略的文件的路径。</p><ol start="2"><li>忽略一个目录，打开 git bash，cd到 目标目录下，执行：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git update-index --assume-unchanged $(git ls-files | tr &apos;\n&apos; &apos; &apos;)</span><br></pre></td></tr></table></figure></li></ol><p>比如有一个配置文件jdbc.properties记录数据库的链接信息，每个人的链接信息肯定不一样，但是又要提供一个标准的模板，用来告知如何填写链接信息，那么就需要在git远程库上有一个标准配置文件，然后每个人根据自己的具体情况，修改一份链接信息自用，而且不会将该配置文件提交到库</p><ol start="3"><li>eclipse中如何实现<br>路径： 选中对应文件 — Team — Advanced — Assume  Unchanged</li></ol>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git的log功能美化</title>
      <link href="/2017/02/18/Git%E7%9A%84log%E5%8A%9F%E8%83%BD%E7%BE%8E%E5%8C%96/"/>
      <url>/2017/02/18/Git%E7%9A%84log%E5%8A%9F%E8%83%BD%E7%BE%8E%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h1><h2 id="查看全部提交日志"><a href="#查看全部提交日志" class="headerlink" title="查看全部提交日志"></a>查看全部提交日志</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log  命令是查看全部提交日志</span><br></pre></td></tr></table></figure><h2 id="查看最近2次的提交日志"><a href="#查看最近2次的提交日志" class="headerlink" title="查看最近2次的提交日志"></a>查看最近2次的提交日志</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log -2  查看最近2次的提交日志</span><br></pre></td></tr></table></figure><h2 id="查看历史纪录以来哪几行被修改"><a href="#查看历史纪录以来哪几行被修改" class="headerlink" title="查看历史纪录以来哪几行被修改"></a>查看历史纪录以来哪几行被修改</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log -p  查看历史纪录以来哪几行被修改</span><br></pre></td></tr></table></figure><h2 id="查看每个版本变动的档案和行数"><a href="#查看每个版本变动的档案和行数" class="headerlink" title="查看每个版本变动的档案和行数"></a>查看每个版本变动的档案和行数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log –stat –summary 查看每个版本变动的档案和行数</span><br></pre></td></tr></table></figure><h1 id="美化输出的日志"><a href="#美化输出的日志" class="headerlink" title="美化输出的日志"></a>美化输出的日志</h1><p>如果你厌倦了上面这颜色，想换换，很简单，在终端输入下面这行代码就OK了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --graph --pretty=format:&apos;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&apos; --abbrev-commit</span><br></pre></td></tr></table></figure><h2 id="对上述命令取别名"><a href="#对上述命令取别名" class="headerlink" title="对上述命令取别名"></a>对上述命令取别名</h2><p>上面这段有点长，所以接下去用<code>alias</code>取别名(科普：alias是linux用于取别名用，可以将很长长长长的命令，用比较短的命令代替)<br>打开终端，给上面的命令<strong>弄一个别名叫<code>git lg</code>吧</strong>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global alias.lg &quot;log --color --graph --pretty=format:&apos;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&apos; --abbrev-commit&quot;</span><br></pre></td></tr></table></figure><p>现在你每次在终端输入git lg，就能看到和上面长命令</p><h2 id="用美化后的日志查看历史纪录以来哪几行被修改"><a href="#用美化后的日志查看历史纪录以来哪几行被修改" class="headerlink" title="用美化后的日志查看历史纪录以来哪几行被修改"></a>用美化后的日志查看历史纪录以来哪几行被修改</h2><p>如果你想看到git log的变化的行数，请输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git lg -p</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vim的全局替换</title>
      <link href="/2017/02/15/vim%E7%9A%84%E5%85%A8%E5%B1%80%E6%9B%BF%E6%8D%A2/"/>
      <url>/2017/02/15/vim%E7%9A%84%E5%85%A8%E5%B1%80%E6%9B%BF%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h1 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h1><p><a href="https://blog.csdn.net/shuangde800/article/details/10554513" target="_blank" rel="noopener">vim的全局替换</a></p><h1 id="替换命令的基本语法"><a href="#替换命令的基本语法" class="headerlink" title="替换命令的基本语法"></a>替换命令的基本语法</h1><ul><li>在全局替换中，ex编辑器使用指定的字符模式对文件中的每行进行检查。在所有行中发现模式的位置，ex使用新字符串来替换模式。</li><li>全局替换真正使用的是两个ex命令是<code>:g（global全局）</code>和<code>:s（switch替换）</code>。</li></ul><h2 id="不带任何参数"><a href="#不带任何参数" class="headerlink" title="不带任何参数"></a>不带任何参数</h2><p>替换命令的语法如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#   命令中空格不是必须的</span><br><span class="line">:s / old / new /</span><br></pre></td></tr></table></figure><ul><li>这将把<strong>当前中模式old的<code>第一次出现</code>修改为new</strong>。</li><li><code>/（斜杆）</code>是命令不同部分之间的分隔符（当斜杆为该行的最后一个字符时，可不写）</li></ul><h2 id="行尾添加参数g-gt-当前行old的每次出现改为new"><a href="#行尾添加参数g-gt-当前行old的每次出现改为new" class="headerlink" title="行尾添加参数g -&gt; 当前行old的每次出现改为new"></a>行尾添加参数g -&gt; 当前行old的每次出现改为new</h2><p>下面这种形式的替换命令:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:s / old / new / g</span><br></pre></td></tr></table></figure><ul><li>把<strong>当前行old的<code>每次</code>出现改为new</strong>，而不只是该行的第一个old。</li><li>:s命令允许替换串后面带有选项，上面语法中的g代表全局（g选项影响一行中的每个模式，不要把它与影响文件中所有行的:g命令混淆）</li></ul><h2 id="行首添加范围-gt-指定替换范围"><a href="#行首添加范围-gt-指定替换范围" class="headerlink" title="行首添加范围 -&gt; 指定替换范围"></a>行首添加范围 -&gt; 指定替换范围</h2><p>通过在:s命令前加上地址前缀，可以把它的范围扩展到多行。例如下面命令把50行到100行的old的每次出现都改为new:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:50, 100 s / old / new / g</span><br></pre></td></tr></table></figure><p>下面的命令把整个文件中的old的每次出现都改为new:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:1, $s / old / new / g</span><br></pre></td></tr></table></figure><p>我们知道%等价于1，$，所以上行命令也可以这样写:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:% s / old / new / g</span><br></pre></td></tr></table></figure><h2 id="行尾添加参数c-gt-替换前确认"><a href="#行尾添加参数c-gt-替换前确认" class="headerlink" title="行尾添加参数c -&gt; 替换前确认"></a>行尾添加参数c -&gt; 替换前确认</h2><ul><li>使用搜索替换命令有时候会出错，而得到不想要的结果。所以小心并确认文件中需要修改的内容是一个明智的做法</li><li>在替换命令尾部加上c (confirm用于确认)，在替换每个old前都会提示并确认:</li></ul><p>语法如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:1, 30 s /old/new/ gc</span><br></pre></td></tr></table></figure><p>-&gt; 将会出现提示replace with hehe (y/n/a/q/l/^E/^Y)?  </p><ul><li>y替换</li><li>n不替换</li><li>a替换所有</li><li>q放弃</li><li>l替换第一个并进入插入模式</li><li>^E和^Y是提示你用Ctrl+e或Ctrl+y来滚动屏幕的。</li></ul><h1 id="上下文相关替换"><a href="#上下文相关替换" class="headerlink" title="上下文相关替换"></a>上下文相关替换</h1><ul><li>除了直接使用一个单词（或短语）替换另一个，还有稍微复杂的全局替换语法。这些语法可以对一个模式进行搜索，一旦找到含有模式的行，就可以使用不同与模式的串进行替换，我们把这种替换叫做上下文相关替换。</li></ul><p>语法格式如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:g /pattern/s/old/new/g    将会把包含pattern的行中，把所有old替换为new</span><br></pre></td></tr></table></figure><ul><li>第一个g表示是在文件的所有行上执行的命令，模式pattern识别要发生替换的行。</li><li>在那些包含模式pattern的行上，ex将把old替换（s）为new。最后的g表示在该行上进行全部替换。</li></ul><p>如果用来进行搜索的模式与想要修改的模式相同，那么就不必重复它:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:g/string/s//new/g  等价于  :g/string/s/string/new/g</span><br></pre></td></tr></table></figure><p>还要注意:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:g/string/s//new/g  也等价于 :% s/string/new/g</span><br></pre></td></tr></table></figure><p>可以用第二种方式少输一些字符</p>]]></content>
      
      
      <categories>
          
          <category> vim </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git的diff命令和patch命令的使用</title>
      <link href="/2017/02/15/Git%E7%9A%84diff%E5%91%BD%E4%BB%A4%E5%92%8Cpatch%E5%91%BD%E4%BB%A4%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2017/02/15/Git%E7%9A%84diff%E5%91%BD%E4%BB%A4%E5%92%8Cpatch%E5%91%BD%E4%BB%A4%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="diff命令的使用方法"><a href="#diff命令的使用方法" class="headerlink" title="diff命令的使用方法"></a>diff命令的使用方法</h1><h2 id="diff命令的作用"><a href="#diff命令的作用" class="headerlink" title="diff命令的作用"></a>diff命令的作用</h2><ol><li>diff命令是linux上非常重要的工具，用于比较文件的内容，特别是比较两个版本不同的文件以找到改动的地方。</li><li>diff在命令行中打印每一个行的改动。</li><li>最新版本的diff还支持二进制文件。</li><li><strong>diff程序的输出被称为补丁 (patch)，因为Linux系统中还有一个patch程序，可以根据diff的输出将a.c的文件内容更新为b.c。</strong></li><li>diff是svn、cvs、git等版本控制工具不可或缺的一部分。</li></ol><h2 id="diff命令的使用"><a href="#diff命令的使用" class="headerlink" title="diff命令的使用"></a>diff命令的使用</h2><p>一般使用方法<br>diff命令的格式一般为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff [参数][文件或者目录1][文件或者目录2]</span><br></pre></td></tr></table></figure><h2 id="经常使用举例"><a href="#经常使用举例" class="headerlink" title="经常使用举例"></a>经常使用举例</h2><h3 id="不使用参数直接比较"><a href="#不使用参数直接比较" class="headerlink" title="不使用参数直接比较"></a>不使用参数直接比较</h3><ol><li><p>例如，有文件test1和test2</p></li><li><p>进行比较</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff test1 test2</span><br></pre></td></tr></table></figure></li><li><p>输出(注意代码中的注释)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2,3c2                       # &quot;c&quot;表示冲突(change),即第一个文件的第2到第3行和第二个文件的第2行开始有冲突</span><br><span class="line">&lt; asfdasfdasdfasdf          # &quot;&lt;&quot;表示删除的行,即删去了两行</span><br><span class="line">&lt; creverververver</span><br><span class="line">---</span><br><span class="line">&gt; qwefqwefqwef              # &quot;&gt;&quot;表示添加的行,即添加了这行</span><br><span class="line">5,9c4                       # 第一个文件第五行到第九行和第二个文件第四行有冲突</span><br><span class="line">&lt; aaaaaaaaaaaa              # 删去了了五行</span><br><span class="line">&lt; aaaa</span><br><span class="line">&lt; a</span><br><span class="line">&lt; a</span><br><span class="line">&lt; a</span><br><span class="line">---</span><br><span class="line">&gt; qsdqwefqwefqwef           # 添加了一行</span><br><span class="line">11d5                        # 第一个文件第11行与第二个文件第五行相比有删除</span><br><span class="line">&lt; bbbbbbbbb                 # 删除了这一行</span><br></pre></td></tr></table></figure></li><li><p>提示说明<br>注释中已经写到,<code>c</code>表示冲突,以下是diff的normal显示格式的提示总结</p></li></ol><ul><li><code>a</code> - add - 添加</li><li><code>c</code> - change - 改变</li><li><code>d</code> - delete - 删除</li><li><code>&lt;</code> - 表示删除的行</li><li><code>&gt;</code> - 表示添加的行</li></ul><h3 id="增加参数比较两文件"><a href="#增加参数比较两文件" class="headerlink" title="增加参数比较两文件"></a>增加参数比较两文件</h3><p>参数如下</p><ul><li>-a或–text 　diff预设只会逐行比较文本文件。</li><li>-b或–ignore-space-change 　不检查空格字符的不同。</li><li>-B或–ignore-blank-lines 　不检查空白行。</li><li>-c 　显示全部内文，并标出不同之处。</li></ul><p>使用过程</p><ol><li><p>使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff -c test1 test2</span><br></pre></td></tr></table></figure></li><li><p>将会得到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">*** test1 2016-04-21 14:46:55.000000000 +0800</span><br><span class="line">--- test2 2016-04-21 14:44:55.000000000 +0800</span><br><span class="line">***************</span><br><span class="line">*** 1,11 ****</span><br><span class="line">  utils</span><br><span class="line">! asfdasfdasdfasdf</span><br><span class="line">! creverververver</span><br><span class="line">  util</span><br><span class="line">! aaaaaaaaaaaa</span><br><span class="line">! aaaa</span><br><span class="line">! a</span><br><span class="line">! a</span><br><span class="line">! a</span><br><span class="line">  qwerqwerqwe</span><br><span class="line">- bbbbbbbbb</span><br><span class="line">--- 1,5 ----</span><br><span class="line">  utils</span><br><span class="line">! qwefqwefqwef</span><br><span class="line">  util</span><br><span class="line">! qsdqwefqwefqwef</span><br><span class="line">  qwerqwerqwe</span><br></pre></td></tr></table></figure></li><li><p>说明</p></li></ol><ul><li>“＋” 比较的文件的后者比前着多一行</li><li>“－” 比较的文件的后者比前着少一行</li><li>“！” 比较的文件两者有差别的行</li></ul><h3 id="以并列的方式显示文件的异同之处。"><a href="#以并列的方式显示文件的异同之处。" class="headerlink" title="以并列的方式显示文件的异同之处。"></a>以并列的方式显示文件的异同之处。</h3><ol><li><p>使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff test1 test2 -y</span><br></pre></td></tr></table></figure></li><li><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">utils                                       utils</span><br><span class="line">asfdasfdasdfasdf                          | qwefqwefqwef</span><br><span class="line">creverververver                           &lt;</span><br><span class="line">util                                        util</span><br><span class="line">aaaaaaaaaaaa                              | qsdqwefqwefqwef</span><br><span class="line">aaaa                                      &lt;</span><br><span class="line">a                                         &lt;</span><br><span class="line">a                                         &lt;</span><br><span class="line">a                                         &lt;</span><br><span class="line">qwerqwerqwe                                 qwerqwerqwe</span><br><span class="line">bbbbbbbbb                                 &lt;</span><br></pre></td></tr></table></figure></li><li><p>说明</p></li></ol><ul><li><code>|</code>:表示前后2个文件内容有不同</li><li><code>&lt;</code>:表示后面文件比前面文件少了1行内容</li><li><code>&gt;</code>:表示后面文件比前面文件多了1行内容</li></ul><h3 id="以合并的方式显示两个文件的不同-可以用于使用patch命令进行打补丁包"><a href="#以合并的方式显示两个文件的不同-可以用于使用patch命令进行打补丁包" class="headerlink" title="以合并的方式显示两个文件的不同(可以用于使用patch命令进行打补丁包)"></a>以合并的方式显示两个文件的不同(可以用于使用patch命令进行打补丁包)</h3><ol><li><p><strong>这种输出方式输出的内容可以用于使用patch命令进行打补丁包</strong></p></li><li><p>例如，有文件test1和test2</p></li><li><p>进行比较</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff -ruN test1 test2</span><br></pre></td></tr></table></figure></li><li><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">--- test1   2016-04-21 14:46:55.000000000 +0800 # 第一个文件的信息</span><br><span class="line">+++ test2   2016-04-21 14:44:55.000000000 +0800 # 第二个文件的信息</span><br><span class="line">@@ -1,11 +1,5 @@                                # 第一个文件1到11行和第二个文件1到5行</span><br><span class="line"> utils</span><br><span class="line">-asfdasfdasdfasdf                               # 前面带减号的是删除的行</span><br><span class="line">-creverververver</span><br><span class="line">+qwefqwefqwef                                   # 带加号的是增加的行</span><br><span class="line"> util</span><br><span class="line">-aaaaaaaaaaaa</span><br><span class="line">-aaaa</span><br><span class="line">-a</span><br><span class="line">-a</span><br><span class="line">-a</span><br><span class="line">+qsdqwefqwefqwef</span><br><span class="line"> qwerqwerqwe</span><br><span class="line">-bbbbbbbbb</span><br></pre></td></tr></table></figure></li><li><p>提示说明</p></li></ol><ul><li>“＋” 比较的文件的后者比前着多一行</li><li>“－” 比较的文件的后者比前着少一行</li><li>“！” 比较的文件两者有差别的行</li></ul><h3 id="比较两个文件夹的不同"><a href="#比较两个文件夹的不同" class="headerlink" title="比较两个文件夹的不同"></a>比较两个文件夹的不同</h3><ol><li><p>例如有两个文件夹testa和test，将test1和test2放进去</p></li><li><p>进行比较</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff testa testb</span><br></pre></td></tr></table></figure></li><li><p>得到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">diff testa/test1 testb/test1    # 对比两个文件夹下面文件名相同的文件</span><br><span class="line">2,3c2                           # 以下是正常的文件对比格式</span><br><span class="line">&lt; asfdasfdasdfasdf</span><br><span class="line">&lt; creverververver</span><br><span class="line">---</span><br><span class="line">&gt; qwefqwefqwef</span><br><span class="line">5,9c4</span><br><span class="line">&lt; aaaaaaaaaaaa</span><br><span class="line">&lt; aaaa</span><br><span class="line">&lt; a</span><br><span class="line">&lt; a</span><br><span class="line">&lt; a</span><br><span class="line">---</span><br><span class="line">&gt; qsdqwefqwefqwef</span><br><span class="line">11d5</span><br><span class="line">&lt; bbbbbbbbb</span><br><span class="line">Only in testa: test2            # testa里面有而testb里面没有的test2</span><br><span class="line">Only in testb: test3            # testa里面没有而testb有的test3</span><br></pre></td></tr></table></figure></li></ol><h2 id="diff的参数说明"><a href="#diff的参数说明" class="headerlink" title="diff的参数说明"></a>diff的参数说明</h2><ul><li>-C或–context 　与执行”-c-“指令相同。</li><li>-d或–minimal 　使用不同的演算法，以较小的单位来做比较。</li><li>-D或ifdef 　此参数的输出格式可用于前置处理器巨集。</li><li>-e或–ed 　此参数的输出格式可用于ed的script文件。</li><li>-f或-forward-ed 　输出的格式类似ed的script文件，但按照原来文件的顺序来显示不同处。</li><li>-H或–speed-large-files 　比较大文件时，可加快速度。</li><li>-l或–ignore-matching-lines 　若两个文件在某几行有所不同，而这几行同时都包含了选项中指定的字符或字符串，则不显示这两个文件的差异。</li><li>-i或–ignore-case 　不检查大小写的不同。</li><li>-l或–paginate 　将结果交由pr程序来分页。</li><li>-n或–rcs 　将比较结果以RCS的格式来显示。</li><li>-N或–new-file 　在比较目录时，若文件A仅出现在某个目录中，预设会显示：Only in目录：文件A若使用-N参数，则diff会将文件A与一个空白的文件比较。</li><li>-p 　若比较的文件为C语言的程序码文件时，显示差异所在的函数名称。</li><li>-P或–unidirectional-new-file 　与-N类似，但只有当第二个目录包含了一个第一个目录所没有的文件时，才会将这个文件与空白的文件做比较。</li><li>-q或–brief 　仅显示有无差异，不显示详细的信息。</li><li>-r或–recursive 　比较子目录中的文件。</li><li>-s或–report-identical-files 　若没有发现任何差异，仍然显示信息。</li><li>-S或–starting-file 　在比较目录时，从指定的文件开始比较。</li><li>-t或–expand-tabs 　在输出时，将tab字符展开。</li><li>-T或–initial-tab 　在每行前面加上tab字符以便对齐。</li><li>-u,-U或–unified= 　以合并的方式来显示文件内容的不同。即统一格式的输出。在合并中也使用的是这种模式。</li><li>v或–version 　显示版本信息。</li><li>-w或–ignore-all-space 　忽略全部的空格字符。</li><li>-W或–width 　在使用-y参数时，指定栏宽。</li><li>-x或–exclude 　不比较选项中所指定的文件或目录。</li><li>-X或–exclude-from 　您可以将文件或目录类型存成文本文件，然后在=中指定此文本文件。</li><li>-y或–side-by-side 　以并列的方式显示文件的异同之处。</li><li>–help 　显示帮助。</li><li>–left-column 　在使用-y参数时，若两个文件某一行内容相同，则仅在左侧的栏位显示该行内容。</li><li>–suppress-common-lines 　在使用-y参数时，仅显示不同之处。</li></ul><h1 id="patch命令的使用方法"><a href="#patch命令的使用方法" class="headerlink" title="patch命令的使用方法"></a>patch命令的使用方法</h1><h2 id="patch命令的作用"><a href="#patch命令的作用" class="headerlink" title="patch命令的作用"></a>patch命令的作用</h2><p>打补丁</p><h2 id="patch命令的格式"><a href="#patch命令的格式" class="headerlink" title="patch命令的格式"></a>patch命令的格式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">patch [option] [origfile] [patchfile]</span><br></pre></td></tr></table></figure><h2 id="patch命令的使用"><a href="#patch命令的使用" class="headerlink" title="patch命令的使用"></a>patch命令的使用</h2><p>我们可以先用diff命令生成patch文件。然后使用patch命令将第二个文件内容修改成第一个文件的内容。例如上述的test1和test2</p><ol><li><p>生成patch文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff -ruN test1 test2 &gt; patch.log   # 生成patch文件</span><br></pre></td></tr></table></figure></li><li><p>利用patch文件和patch命令打补丁</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">patch test2 patch.log               # 利用patch文件和patch命令打补丁</span><br></pre></td></tr></table></figure></li></ol><p>之后test2的内容就会和test1内容一致了。</p><h2 id="patch说明"><a href="#patch说明" class="headerlink" title="patch说明"></a>patch说明</h2><ul><li>patch 命令（默认）使用从标准输入读入的源文件 <code>&lt;</code> PATCHFILE ，但是使用 -i PATCHFILE 设置。</li><li>源文件包含由 diff 命令产生的差别列表（或者 diff 列表）。差异列表是比较两个文件和构建关于如何纠正差别的指示信息的结果。</li><li>差异列表有三种格式：正常、上下文或者是 ed 编辑器风格。patch 命令确定差异列表格式，除非被 -c、-e 或 -n 标志否决。</li><li>默认，ORIGFILE 被PATCHFILE 替换。若ORIGFILE（原始文件）不存在时，PATCHFILE（补丁文件）根据差别列表，创建 ORIGFILE 文件。</li><li>指定 -b 标志时，ORIGFILE（原始文件）会备份在自身的文件中，只是在文件名后附加了后缀 .orig。使用 -o 标志也可以指定输出的目的地。</li></ul><h2 id="patch命令的参数"><a href="#patch命令的参数" class="headerlink" title="patch命令的参数"></a>patch命令的参数</h2><ol><li>输入选项</li></ol><table><thead><tr><th>输入选项</th><th></th><th></th></tr></thead><tbody><tr><td>-p</td><td>NUM    –strip=NUM</td><td>去除相对路径层次的数目</td></tr><tr><td>-F</td><td>LINES    –fuzz LINES</td><td>设置监别列数</td></tr><tr><td>-l</td><td>–ignore-whitespace</td><td>忽略修补数据与输入数据的跳格，空格字符</td></tr><tr><td>-c</td><td>–context</td><td>把修补数据解译成关联性的差异</td></tr><tr><td>-e</td><td>–ed</td><td>把修补数据解译成ed指令可用的叙述文件</td></tr><tr><td>-n</td><td>–normal</td><td>把修补数据解译成一般性的差异</td></tr><tr><td>-u</td><td>–unified</td><td>把修补数据解译成一致化的差异</td></tr><tr><td>-N</td><td>–forward</td><td>忽略修补的数据较原始文件的版本更旧，或该版本的修补数据已使用过</td></tr><tr><td>-R</td><td>–reverse</td><td>假设修补数据是由新旧文件交换位置而产生</td></tr><tr><td>-i</td><td>PATCHFILE    –input=PATCHFILE</td><td>读取指定的修补文件</td></tr></tbody></table><ol start="2"><li>输出选项</li></ol><table><thead><tr><th>输出选项</th><th></th><th></th></tr></thead><tbody><tr><td>-o FILE</td><td>–output=FILE</td><td>设置输出文件的名称，修补过的文件会以该名称存放</td></tr><tr><td>-r FILE</td><td>–reject-file=FILE</td><td>Output rejects to FILE</td></tr><tr><td>-D NAME</td><td>–ifdef=NAME</td><td>用指定的符号把改变的地方标示出来</td></tr><tr><td>-m</td><td>–merge</td><td>Merge using conflict markers instead of creating reject files</td></tr><tr><td>-E</td><td>–remove-empty-files</td><td>若修补过后输出的文件其内容是一片空白，则移除该文件</td></tr><tr><td>-Z</td><td>–set-utc</td><td>把修补过的文件更改，存取时间设为UTC</td></tr><tr><td>-T</td><td>–set-time</td><td>此参数的效果和指定”-Z”参数类似，但以本地时间为主</td></tr><tr><td></td><td>–quoting-style=WORD</td><td>使用WORD引述类型显示项目名称,可设定值有literal,shell,shell-always,c,escape</td></tr></tbody></table><ol start="3"><li>备份和版本控制选项</li></ol><table><thead><tr><th>备份和版本控制选项</th><th></th><th></th></tr></thead><tbody><tr><td>-b</td><td>–backup</td><td>备份每一个原始文件</td></tr><tr><td></td><td>–backup-if-mismatch</td><td>在修补数据不完全吻合，且没有刻意指定要备份文件时，才备份文件</td></tr><tr><td></td><td>–no-backup-if-mismatch</td><td>在修补数据不完全吻合，且没有刻意指定要备份文件时，不要备份文件</td></tr><tr><td>-V STYLE</td><td>–version-control=STYLE</td><td>用”-b”参数备份目标文件后，备份文件的字尾会被加上一个备份字符串，这个字符串不仅可用”-z”参数变更，当使用”-V”参数指定不同备份方式时，也会产生不同字尾的备份字符串</td></tr><tr><td>-B PREFIX</td><td>–prefix=PREFIX</td><td>设置文件备份时，附加在文件名称前面的字首字符串，该字符串可以是路径名称</td></tr><tr><td>-Y PREFIX</td><td>–basename-prefix=PREFIX</td><td>设置文件备份时，附加在文件基本名称开头的字首字符串</td></tr><tr><td>-z SUFFIX</td><td>–suffix=SUFFIX</td><td>此参数的效果和指定”-B”参数类似，差别在于修补作业使用的路径与文件名若为src/linux/fs/super.c，加上”backup/“字符串后，文件super.c会备份于/src/linux/fs/backup目录里</td></tr><tr><td>-g NUM</td><td>–get=NUM</td><td>设置以RSC或SCCS控制修补作业</td></tr><tr><td>4.    其他选项</td><td></td><td></td></tr></tbody></table><table><thead><tr><th>其他选项</th><th></th><th></th></tr></thead><tbody><tr><td>-t</td><td>–batch</td><td>自动略过错误，不询问任何问题</td></tr><tr><td>-f</td><td>–force</td><td>此参数的效果和指定”-t”参数类似，但会假设修补数据的版本为新版本</td></tr><tr><td>-s</td><td>–quiet或–silent</td><td>不显示指令执行过程，除非发生错误</td></tr><tr><td></td><td>–verbose</td><td>显示详细的过程信息</td></tr><tr><td></td><td>–dry-run</td><td>实际上不改变任何文件；演示讲会发生什么</td></tr><tr><td></td><td>–posix</td><td>符合POSIX标准</td></tr><tr><td>-d DIR</td><td>–directory=DIR</td><td>先改变工作目录到指定的目录</td></tr><tr><td></td><td>–reject-format=FORMAT</td><td>Create ‘context’ or ‘unified’ rejects</td></tr><tr><td></td><td>–binary</td><td>以二进制方式读写数据</td></tr><tr><td></td><td>–read-only=BEHAVIOR</td><td>如何处理只读输入文件：“忽视”，他们是只读的，“警告”（默认），或“失败”</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Eclipse的properties文件类型显示Unicoide编码不显示汉字问题</title>
      <link href="/2017/01/24/Eclipse%E7%9A%84properties%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E6%98%BE%E7%A4%BAUnicoide%E7%BC%96%E7%A0%81%E4%B8%8D%E6%98%BE%E7%A4%BA%E6%B1%89%E5%AD%97%E9%97%AE%E9%A2%98/"/>
      <url>/2017/01/24/Eclipse%E7%9A%84properties%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E6%98%BE%E7%A4%BAUnicoide%E7%BC%96%E7%A0%81%E4%B8%8D%E6%98%BE%E7%A4%BA%E6%B1%89%E5%AD%97%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="安装插件propedit"><a href="#安装插件propedit" class="headerlink" title="安装插件propedit"></a>安装插件propedit</h1><h2 id="打开安装插件界面"><a href="#打开安装插件界面" class="headerlink" title="打开安装插件界面"></a>打开安装插件界面</h2><ul><li>Help -&gt; Install new software..</li></ul><p><img src="/images/2020/01/20200124001.png" alt></p><h2 id="输入在线更新地址"><a href="#输入在线更新地址" class="headerlink" title="输入在线更新地址"></a>输入在线更新地址</h2><p><a href="http://propedit.sourceforge.jp/eclipse/updates/" target="_blank" rel="noopener">http://propedit.sourceforge.jp/eclipse/updates/</a></p><p><img src="/images/2020/01/20200124002.png" alt></p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><img src="/images/2020/01/20200124003.png" alt></p><p><img src="/images/2020/01/20200124004.png" alt></p><p><img src="/images/2020/01/20200124005.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Eclipse </tag>
            
            <tag> Eclipse插件 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
