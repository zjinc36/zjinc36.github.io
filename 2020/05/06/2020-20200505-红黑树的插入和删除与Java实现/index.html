<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.5"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.5"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><title>红黑树的插入和删除与Java实现 | 想了20分钟的博客名</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">红黑树的插入和删除与Java实现</h1><a id="logo" href="/.">想了20分钟的博客名</a><p class="description">世界是唯物辩证的</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">红黑树的插入和删除与Java实现</h1><div class="post-meta"><a href="/2020/05/06/2020-20200505-红黑树的插入和删除与Java实现/#comments" class="comment-count"></a><p><span class="date">May 06, 2020</span><span><a href="/categories/数据结构与算法/" class="category">数据结构与算法</a></span></p></div><div class="post-content"><p>普通的二叉查找树在极端情况下可退化成链表，此时的增删查效率都会比较低下。<br><img src="/images/2020/08/20200806115816.png" alt></p>
<p>为了避免这种情况，就出现了一些自平衡的查找树，比如 AVL，红黑树等。这些自平衡的查找树通过定义一些性质，将任意节点的左右子树高度差控制在规定范围内，以达到平衡状态。</p>
<h1 id="什么是红黑树"><a href="#什么是红黑树" class="headerlink" title="什么是红黑树"></a>什么是红黑树</h1><ul>
<li>红黑树本质上是一种二叉查找树，但它在二叉查找树的基础上额外添加了一个标记（颜色），同时具有一定的规则。</li>
<li>这些规则使红黑树保证了一种平衡，插入、删除、查找的最坏时间复杂度都为 O(logn)。</li>
<li>它的统计性能要好于平衡二叉树（AVL树），因此，红黑树在很多地方都有应用。比如在 Java 集合框架中，很多部分(HashMap, TreeMap, TreeSet 等)都有红黑树的应用，这些集合均提供了很好的性能。</li>
</ul>
<h2 id="红黑树的-5-个特性"><a href="#红黑树的-5-个特性" class="headerlink" title="红黑树的 5 个特性"></a>红黑树的 5 个特性</h2><p><img src="/images/2020/08/20200805204359.png" alt></p>
<ol>
<li>每个节点要么是红色，要么是黑色；</li>
<li>根节点永远是黑色的；</li>
<li>所有的叶子节点都是是黑色的（注意这里说叶子节点其实是上图中的 NIL 节点）；</li>
<li>每个红色节点的两个子节点一定都是黑色；（从每个叶子到根的所有路径上不能有两个连续的红色节点,黑色结点是可以连续的）</li>
<li>从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点（简称黑高）</li>
</ol>
<p>注意：</p>
<ul>
<li>性质 3 中指定红黑树的每个叶子节点都是空节点，而且并叶子节点都是黑色。但 Java 实现的红黑树将使用 null 来代表空节点，因此遍历红黑树时将看不到黑色的叶子节点，反而看到每个叶子节点都是红色的。</li>
<li>性质 4 的意思是：从每个根到节点的路径上不会有两个连续的红色节点，但黑色节点是可以连续的。因此若给定黑色节点的个数 N，最短路径的情况是连续的 N 个黑色，树的高度为 N - 1;最长路径的情况为节点红黑相间，树的高度为 2(N - 1) 。</li>
<li>性质 5 是成为红黑树最主要的条件，后序的插入、删除操作都是为了遵守这个规定。</li>
</ul>
<p>红黑树并不是标准平衡二叉树，它以性质 5 作为一种平衡方法，使自己的性能得到了提升。</p>
<h1 id="红黑树的左旋右旋"><a href="#红黑树的左旋右旋" class="headerlink" title="红黑树的左旋右旋"></a>红黑树的左旋右旋</h1><p>具体在<a href="/2020/05/06/平衡二叉树/">平衡二叉树的基本介绍与Java实现</a>有具体说明,不再赘述</p>
<h2 id="左旋"><a href="#左旋" class="headerlink" title="左旋"></a>左旋</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateLeft</span><span class="params">(Entry p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Entry r = p.right; </span><br><span class="line">        p.right = r.left;</span><br><span class="line">        <span class="keyword">if</span> (r.left != <span class="keyword">null</span>)         </span><br><span class="line">            r.left.parent = p;</span><br><span class="line">        r.parent = p.parent;</span><br><span class="line">        <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>)</span><br><span class="line">            root = r;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.left == p)</span><br><span class="line">            p.parent.left = r;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            p.parent.right = r;</span><br><span class="line">        r.left = p; </span><br><span class="line">        p.parent = r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="右旋"><a href="#右旋" class="headerlink" title="右旋"></a>右旋</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateRight</span><span class="params">(Entry p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Entry l = p.left;</span><br><span class="line">        p.left = l.right;</span><br><span class="line">        <span class="keyword">if</span> (l.right != <span class="keyword">null</span>) l.right.parent = p;</span><br><span class="line">        l.parent = p.parent;</span><br><span class="line">        <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>)</span><br><span class="line">            root = l;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.right == p)</span><br><span class="line">            p.parent.right = l;</span><br><span class="line">        <span class="keyword">else</span> p.parent.left = l;</span><br><span class="line">        l.right = p;</span><br><span class="line">        p.parent = l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="红黑树的平衡插入"><a href="#红黑树的平衡插入" class="headerlink" title="红黑树的平衡插入"></a>红黑树的平衡插入</h1><h2 id="要插入的结点是红色还是黑色"><a href="#要插入的结点是红色还是黑色" class="headerlink" title="要插入的结点是红色还是黑色?"></a>要插入的结点是红色还是黑色?</h2><ul>
<li>要插入的结点是红色</li>
<li>如果插入的节点是黑色，那么这个节点所在路径比其他路径多出一个黑色节点，这个调整起来会比较麻烦（参考红黑树的删除操作，就知道为啥多一个或少一个黑色节点时，调整起来这么麻烦了）。</li>
<li>如果插入的节点是红色，此时所有路径上的黑色节点数量不变，仅可能会出现两个连续的红色节点的情况。这种情况下，通过变色和旋转进行调整即可，比之前的简单多了。</li>
</ul>
<h2 id="将染红的结点插入后的调整有-2-种情况"><a href="#将染红的结点插入后的调整有-2-种情况" class="headerlink" title="将染红的结点插入后的调整有 2 种情况"></a>将染红的结点插入后的调整有 2 种情况</h2><h3 id="情况1-父亲节点和叔叔节点都是红色"><a href="#情况1-父亲节点和叔叔节点都是红色" class="headerlink" title="情况1.父亲节点和叔叔节点都是红色"></a>情况1.父亲节点和叔叔节点都是红色</h3><p><img src="/images/2020/08/20200806113402.png" alt></p>
<ul>
<li>假设插入的结点是 N,看图可知,此时父结点 P 和叔叔结点 U 都是红色,爷爷结点 G 一定是黑色</li>
<li>由性质4可知,红色结点不能连续,所以图中的情况需要调整</li>
<li>调整:只需要将不管 N 是 P 的左孩子还是右孩子，只要同时把 P 和 U 染成黑色，G 染成红色即可,此时经过 G 的路径上的黑色节点数量不变，性质5仍然满足。</li>
<li>需要注意的是 G 被染成红色后，可能会和它的父节点形成连续的红色节点，此时需要递归向上调整。</li>
</ul>
<p>简记: 叔叔结点为红色,则<code>变色</code></p>
<h3 id="情况2-父亲节点为红色，叔叔节点为黑色-N-在父亲节点-P-的左孩子位置"><a href="#情况2-父亲节点为红色，叔叔节点为黑色-N-在父亲节点-P-的左孩子位置" class="headerlink" title="情况2.父亲节点为红色，叔叔节点为黑色(N 在父亲节点 P 的左孩子位置)"></a>情况2.父亲节点为红色，叔叔节点为黑色(N 在父亲节点 P 的左孩子位置)</h3><p><img src="/images/2020/08/20200806114109.png" alt></p>
<ul>
<li>假设插入的是节点 N，由图可知,这时父亲节点 P 是红色，叔叔节点 U 是黑色，爷爷节点 G 一定是黑色</li>
<li>红色节点的孩子不能是红色，但是直接把父亲节点 P 涂成黑色也不行，这条路径多了个黑色节点。</li>
<li>可以使用右旋，通过把 爷爷节点 G 右旋，P 变成了这个子树的根节点，G 变成了 P 的右子树。</li>
<li>右旋后 G 跑到了右子树上，这时把 P 变成黑的，多了一个黑节点，再把 G 变成红的，就平衡了</li>
<li>此时性质4,红色结点不能有红色子结点得到满足</li>
<li>且没有破坏原本的黑高,原本的黑高从左边看是1,右边看是2,调整后左边的黑高仍旧是1,右边的黑高仍旧是2</li>
</ul>
<p>简记: 叔叔结点为黑色,N 在父结点 P 的左孩子,则<code>右旋 =&gt; 变色</code></p>
<h3 id="情况3-父亲节点为红色，叔叔节点为黑色-N-在父亲节点-P-的右孩子位置"><a href="#情况3-父亲节点为红色，叔叔节点为黑色-N-在父亲节点-P-的右孩子位置" class="headerlink" title="情况3.父亲节点为红色，叔叔节点为黑色(N 在父亲节点 P 的右孩子位置)"></a>情况3.父亲节点为红色，叔叔节点为黑色(N 在父亲节点 P 的右孩子位置)</h3><p>上面讲的是插入节点 N 在父亲节点 P 的左孩子位置，如果 N 是 P 的右孩子，就需要多进行一次左旋，把情况化解成上述情况。<br><img src="/images/2020/08/20200806114444.png" alt></p>
<p>简记: 叔叔结点为黑色,N 在父结点 P 的右孩子,则<code>左旋 =&gt; 右旋 =&gt; 变色</code></p>
<h3 id="插入总结"><a href="#插入总结" class="headerlink" title="插入总结"></a>插入总结</h3><p>三种情况的区别在于叔叔节点的颜色，如果叔叔节点为红色，直接变色即可。如果叔叔节点为黑色，则需要选选择，再交换颜色。当把这三种情况的图画在一起就区别就比较容易观察了，如下图<br><img src="/images/2020/08/20200806114858.png" alt></p>
<h2 id="验证-Java-中的-TreeMap-源码"><a href="#验证-Java-中的-TreeMap-源码" class="headerlink" title="验证: Java 中的 TreeMap 源码"></a>验证: Java 中的 TreeMap 源码</h2><p>下面是 TreeMap 在插入后进行调整的代码，可以看出来跟我们分析的一致。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixAfterInsertion</span><span class="params">(Entry x)</span> </span>&#123;</span><br><span class="line">    x.color = RED;  <span class="comment">//直接染成红色，少点麻烦</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里分析的都是父亲节点为红色的情况，不是红色就不用调整了</span></span><br><span class="line">    <span class="keyword">while</span> (x != <span class="keyword">null</span> &amp;&amp; x != root &amp;&amp; x.parent.color == RED) &#123;</span><br><span class="line">        <span class="keyword">if</span> (parentOf(x) == leftOf(parentOf(parentOf(x)))) &#123; <span class="comment">// 插入节点 x 的父亲节点位于左孩子    </span></span><br><span class="line">            Entry y = rightOf(parentOf(parentOf(x)));  <span class="comment">// y 是 x 的叔叔节点</span></span><br><span class="line">            <span class="keyword">if</span> (colorOf(y) == RED) &#123;    <span class="comment">//如果 y 也是红色，只要把父亲节点和 y 都变成黑色，爷爷节点变成红的，就 Ok 了</span></span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(y, BLACK);</span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                x = parentOf(parentOf(x));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;    <span class="comment">//如果叔叔节点 y 不是红色，就需要右旋，让父亲节点变成根节点，爷爷节点去右子树去，然后把父亲节点变成黑色、爷爷节点变成红色</span></span><br><span class="line">                    <span class="comment">//特殊情况：x 是父亲节点的右孩子，需要对父亲节点进行左旋，把 x 移动到左子树</span></span><br><span class="line">                <span class="keyword">if</span> (x == rightOf(parentOf(x))) &#123;</span><br><span class="line">                    x = parentOf(x);</span><br><span class="line">                    rotateLeft(x);</span><br><span class="line">                &#125;</span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                rotateRight(parentOf(parentOf(x)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;    <span class="comment">//和上面对称的操作</span></span><br><span class="line">            Entry y = leftOf(parentOf(parentOf(x)));</span><br><span class="line">            <span class="keyword">if</span> (colorOf(y) == RED) &#123;</span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(y, BLACK);</span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                x = parentOf(parentOf(x));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (x == leftOf(parentOf(x))) &#123;</span><br><span class="line">                    x = parentOf(x);</span><br><span class="line">                    rotateRight(x);</span><br><span class="line">                &#125;</span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                rotateLeft(parentOf(parentOf(x)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    root.color = BLACK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="红黑树的平衡删除"><a href="#红黑树的平衡删除" class="headerlink" title="红黑树的平衡删除"></a>红黑树的平衡删除</h1><p>红黑树的删除也是分两步</p>
<ol>
<li>二叉查找树的删除(<a href="/2020/05/05/二叉排序树的基本介绍与Java实现/#二叉排序树的删除">查看:二叉排序树的删除</a>)</li>
<li>结构调整</li>
</ol>
<h2 id="如何进行调整"><a href="#如何进行调整" class="headerlink" title="如何进行调整"></a>如何进行调整</h2><ul>
<li>删除修复操作是针对删除黑色节点才有的</li>
<li>当黑色节点被删除后会让整个树不符合RBTree的定义的第四条(第四条:每个叶子到根的所有路径上不能有两个连续的红色节点)。</li>
<li>需要做的处理是从兄弟节点上借调黑色的节点过来，如果兄弟节点没有黑节点可以借调的话，就只能往上追溯，将每一级的黑节点数减去一个，使得整棵树符合红黑树的定义</li>
</ul>
<h3 id="总体思想"><a href="#总体思想" class="headerlink" title="总体思想"></a>总体思想</h3><ul>
<li>删除操作的总体思想是从兄弟节点借调黑色节点使树保持局部的平衡</li>
<li>如果局部的平衡达到了，就看整体的树是否是平衡的，如果不平衡就接着向上追溯调整</li>
</ul>
<h3 id="删除修复操作分为四种情况-删除黑节点后-："><a href="#删除修复操作分为四种情况-删除黑节点后-：" class="headerlink" title="删除修复操作分为四种情况(删除黑节点后)："></a>删除修复操作分为四种情况(删除黑节点后)：</h3><ol>
<li>待删除的节点的兄弟节点是红色的节点。</li>
<li>待删除的节点的兄弟节点是黑色的节点，且兄弟节点的子节点都是黑色的。</li>
<li>待调整的节点的兄弟节点是黑色的节点，且兄弟节点的左子节点是红色的，右节点是黑色的(兄弟节点在右边)，如果兄弟节点在左边的话，就是兄弟节点的右子节点是红色的，左节点是黑色的。</li>
<li>待调整的节点的兄弟节点是黑色的节点，且右子节点是是红色的(兄弟节点在右边)，如果兄弟节点在左边，则就是对应的就是左节点是红色的。</li>
</ol>
<h4 id="case1-待删除的节点的兄弟节点是红色的节点"><a href="#case1-待删除的节点的兄弟节点是红色的节点" class="headerlink" title="case1:待删除的节点的兄弟节点是红色的节点"></a>case1:待删除的节点的兄弟节点是红色的节点</h4><ul>
<li>由于兄弟节点是红色节点的时候，无法借调黑节点，所以需要将兄弟节点提升到父节点，由于兄弟节点是红色的，根据RBTree的定义，兄弟节点的子节点是黑色的，就可以从它的子节点借调了。</li>
<li>case 1这样转换之后就会变成后面的case 2，case 3，或者case 4进行处理了。</li>
<li>上升操作需要对C做一个左旋操作(如果是镜像结构的树只需要做对应的右旋操作即可)</li>
<li>之所以要做case 1操作是因为兄弟节点是红色的，无法借到一个黑节点来填补删除的黑节点。<br><img src="/images/2020/08/20200806200208.png" alt></li>
</ul>
<h4 id="case2-待删除的节点的兄弟节点是黑色的节点，且兄弟节点的子节点都是黑色的"><a href="#case2-待删除的节点的兄弟节点是黑色的节点，且兄弟节点的子节点都是黑色的" class="headerlink" title="case2:待删除的节点的兄弟节点是黑色的节点，且兄弟节点的子节点都是黑色的"></a>case2:待删除的节点的兄弟节点是黑色的节点，且兄弟节点的子节点都是黑色的</h4><ul>
<li>case 2的删除操作是由于兄弟节点可以消除一个黑色节点，因为兄弟节点和兄弟节点的子节点都是黑色的，所以可以将兄弟节点变红，这样就可以保证树的局部的颜色符合定义了。这个时候需要将父节点A变成新的节点，继续向上调整，直到整颗树的颜色符合RBTree的定义为止。</li>
<li>case 2这种情况下之所以要将兄弟节点变红，是因为如果把兄弟节点借调过来，会导致兄弟的结构不符合RBTree的定义，这样的情况下只能是将兄弟节点也变成红色来达到颜色的平衡。当将兄弟节点也变红之后，达到了局部的平衡了，但是对于祖父节点来说是不符合定义4的。这样就需要回溯到父节点，接着进行修复操作。<br><img src="/images/2020/08/20200806200428.png" alt></li>
</ul>
<h4 id="case3-待调整的节点的兄弟节点是黑色的节点，且兄弟节点的左子节点是红色的，右节点是黑色的"><a href="#case3-待调整的节点的兄弟节点是黑色的节点，且兄弟节点的左子节点是红色的，右节点是黑色的" class="headerlink" title="case3:待调整的节点的兄弟节点是黑色的节点，且兄弟节点的左子节点是红色的，右节点是黑色的"></a>case3:待调整的节点的兄弟节点是黑色的节点，且兄弟节点的左子节点是红色的，右节点是黑色的</h4><ul>
<li>case 3的删除操作是一个中间步骤，它的目的是将左边的红色节点借调过来，这样就可以转换成case 4状态了，在case 4状态下可以将D，E节点都阶段过来，通过将两个节点变成黑色来保证红黑树的整体平衡。</li>
<li>之所以说case-3是一个中间状态，是因为根据红黑树的定义来说，下图并不是平衡的，他是通过case 2操作完后向上回溯出现的状态。之所以会出现case 3和后面的case 4的情况，是因为可以通过借用侄子节点的红色，变成黑色来符合红黑树定义4.<br><img src="/images/2020/08/20200806200529.png" alt></li>
</ul>
<h4 id="case4-待调整的节点的兄弟节点是黑色的节点，且右子节点是是红色的"><a href="#case4-待调整的节点的兄弟节点是黑色的节点，且右子节点是是红色的" class="headerlink" title="case4:待调整的节点的兄弟节点是黑色的节点，且右子节点是是红色的"></a>case4:待调整的节点的兄弟节点是黑色的节点，且右子节点是是红色的</h4><ul>
<li>Case 4的操作是真正的节点借调操作，通过将兄弟节点以及兄弟节点的右节点借调过来，并将兄弟节点的右子节点变成红色来达到借调两个黑节点的目的，这样的话，整棵树还是符合RBTree的定义的。</li>
<li>Case 4这种情况的发生只有在待删除的节点的兄弟节点为黑，且子节点不全部为黑，才有可能借调到两个节点来做黑节点使用，从而保持整棵树都符合红黑树的定义。<br><img src="/images/2020/08/20200806200623.png" alt></li>
</ul>
<h2 id="删除后调整的全部逻辑流程图"><a href="#删除后调整的全部逻辑流程图" class="headerlink" title="删除后调整的全部逻辑流程图"></a>删除后调整的全部逻辑流程图</h2><p>红黑树的删除操作是最复杂的操作，复杂的地方就在于当删除了黑色节点的时候，如何从兄弟节点去借调节点，以保证树的颜色符合定义。由于红色的兄弟节点是没法借调出黑节点的，这样只能通过选择操作让他上升到父节点，而由于它是红节点，所以它的子节点就是黑的，可以借调。</p>
<p>对于兄弟节点是黑色节点的可以分成3种情况来处理，当所以的兄弟节点的子节点都是黑色节点时，可以直接将兄弟节点变红，这样局部的红黑树颜色是符合定义的。但是整颗树不一定是符合红黑树定义的，需要往上追溯继续调整。</p>
<p>对于兄弟节点的子节点为左红右黑或者 (全部为红，右红左黑)这两种情况，可以先将前面的情况通过选择转换为后一种情况，在后一种情况下，因为兄弟节点为黑，兄弟节点的右节点为红，可以借调出两个节点出来做黑节点，这样就可以保证删除了黑节点，整棵树还是符合红黑树的定义的，因为黑色节点的个数没有改变。</p>
<p>红黑树的删除操作是遇到删除的节点为红色，或者追溯调整到了root节点，这时删除的修复操作完毕。<br><img src="/images/2020/08/20200806115817.png" alt></p>
<h2 id="java-中-TreeMap-的源码"><a href="#java-中-TreeMap-的源码" class="headerlink" title="java 中 TreeMap 的源码"></a>java 中 TreeMap 的源码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixAfterDeletion</span><span class="params">(Entry x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (x != root &amp;&amp; colorOf(x) == BLACK) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == leftOf(parentOf(x))) &#123;</span><br><span class="line">            Entry sib = rightOf(parentOf(x));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//左旋，把黑色节点移到左边一个</span></span><br><span class="line">            <span class="keyword">if</span> (colorOf(sib) == RED) &#123;</span><br><span class="line">                setColor(sib, BLACK);</span><br><span class="line">                setColor(parentOf(x), RED);</span><br><span class="line">                rotateLeft(parentOf(x));</span><br><span class="line">                sib = rightOf(parentOf(x));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (colorOf(leftOf(sib))  == BLACK &amp;&amp;</span><br><span class="line">                colorOf(rightOf(sib)) == BLACK) &#123;</span><br><span class="line">                setColor(sib, RED);</span><br><span class="line">                x = parentOf(x);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (colorOf(rightOf(sib)) == BLACK) &#123;</span><br><span class="line">                    setColor(leftOf(sib), BLACK);</span><br><span class="line">                    setColor(sib, RED);</span><br><span class="line">                    rotateRight(sib);</span><br><span class="line">                    sib = rightOf(parentOf(x));</span><br><span class="line">                &#125;</span><br><span class="line">                setColor(sib, colorOf(parentOf(x)));</span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(rightOf(sib), BLACK);</span><br><span class="line">                rotateLeft(parentOf(x));</span><br><span class="line">                x = root;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">//处理的节点在 右边，相同逻辑，只不过旋转的方向相反</span></span><br><span class="line">            Entry sib = leftOf(parentOf(x));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (colorOf(sib) == RED) &#123;</span><br><span class="line">                setColor(sib, BLACK);</span><br><span class="line">                setColor(parentOf(x), RED);</span><br><span class="line">                rotateRight(parentOf(x));</span><br><span class="line">                sib = leftOf(parentOf(x));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (colorOf(rightOf(sib)) == BLACK &amp;&amp;</span><br><span class="line">                colorOf(leftOf(sib)) == BLACK) &#123;</span><br><span class="line">                setColor(sib, RED);</span><br><span class="line">                x = parentOf(x);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (colorOf(leftOf(sib)) == BLACK) &#123;</span><br><span class="line">                    setColor(rightOf(sib), BLACK);</span><br><span class="line">                    setColor(sib, RED);</span><br><span class="line">                    rotateLeft(sib);</span><br><span class="line">                    sib = leftOf(parentOf(x));</span><br><span class="line">                &#125;</span><br><span class="line">                setColor(sib, colorOf(parentOf(x)));</span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(leftOf(sib), BLACK);</span><br><span class="line">                rotateRight(parentOf(x));</span><br><span class="line">                x = root;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setColor(x, BLACK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="红黑树的Java实现"><a href="#红黑树的Java实现" class="headerlink" title="红黑树的Java实现"></a>红黑树的Java实现</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RBTreeNode</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T value;<span class="comment">//node value</span></span><br><span class="line">    <span class="keyword">private</span> RBTreeNode&lt;T&gt; left;<span class="comment">//left child pointer</span></span><br><span class="line">    <span class="keyword">private</span> RBTreeNode&lt;T&gt; right;<span class="comment">//right child pointer</span></span><br><span class="line">    <span class="keyword">private</span> RBTreeNode&lt;T&gt; parent;<span class="comment">//parent pointer</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> red;<span class="comment">//color is red or not red</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RBTreeNode</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RBTreeNode</span><span class="params">(T value)</span></span>&#123;<span class="keyword">this</span>.value=value;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RBTreeNode</span><span class="params">(T value,<span class="keyword">boolean</span> isRed)</span></span>&#123;<span class="keyword">this</span>.value=value;<span class="keyword">this</span>.red = isRed;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setValue</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTreeNode&lt;T&gt; <span class="title">getLeft</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setLeft</span><span class="params">(RBTreeNode&lt;T&gt; left)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.left = left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTreeNode&lt;T&gt; <span class="title">getRight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> right;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setRight</span><span class="params">(RBTreeNode&lt;T&gt; right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">RBTreeNode&lt;T&gt; <span class="title">getParent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> parent;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setParent</span><span class="params">(RBTreeNode&lt;T&gt; parent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.parent = parent;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isRed</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> red;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isBlack</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !red;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * is leaf node</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isLeaf</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> left==<span class="keyword">null</span> &amp;&amp; right==<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setRed</span><span class="params">(<span class="keyword">boolean</span> red)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.red = red;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">makeRed</span><span class="params">()</span></span>&#123;</span><br><span class="line">        red=<span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">makeBlack</span><span class="params">()</span></span>&#123;</span><br><span class="line">        red=<span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RBTree</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">T</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RBTreeNode&lt;T&gt; root;</span><br><span class="line">    <span class="comment">//node number</span></span><br><span class="line">    <span class="keyword">private</span> java.util.concurrent.atomic.AtomicLong size = </span><br><span class="line">                    <span class="keyword">new</span> java.util.concurrent.atomic.AtomicLong(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//in overwrite mode,all node's value can not  has same    value</span></span><br><span class="line">    <span class="comment">//in non-overwrite mode,node can have same value, suggest don't use non-overwrite mode.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> overrideMode=<span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RBTree</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.root = <span class="keyword">new</span> RBTreeNode&lt;T&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RBTree</span><span class="params">(<span class="keyword">boolean</span> overrideMode)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>();</span><br><span class="line">        <span class="keyword">this</span>.overrideMode=overrideMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOverrideMode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> overrideMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOverrideMode</span><span class="params">(<span class="keyword">boolean</span> overrideMode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.overrideMode = overrideMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * number of tree number</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get the root node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RBTreeNode&lt;T&gt; <span class="title">getRoot</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root.getLeft();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * add value to a new node,if this value exist in this tree,</span></span><br><span class="line"><span class="comment">     * if value exist,it will return the exist value.otherwise return null</span></span><br><span class="line"><span class="comment">     * if override mode is true,if value exist in the tree,</span></span><br><span class="line"><span class="comment">     * it will override the old value in the tree</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">addNode</span><span class="params">(T value)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; t = <span class="keyword">new</span> RBTreeNode&lt;T&gt;(value);</span><br><span class="line">        <span class="keyword">return</span> addNode(t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find the value by give value(include key,key used for search,</span></span><br><span class="line"><span class="comment">     * other field is not used,<span class="doctag">@see</span> compare method).if this value not exist return null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">find</span><span class="params">(T value)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; dataRoot = getRoot();</span><br><span class="line">        <span class="keyword">while</span>(dataRoot!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> cmp = dataRoot.getValue().compareTo(value);</span><br><span class="line">            <span class="keyword">if</span>(cmp&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                dataRoot = dataRoot.getRight();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cmp&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                dataRoot = dataRoot.getLeft();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> dataRoot.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * remove the node by give value,if this value not exists in tree return null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value include search key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the value contain in the removed node</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">remove</span><span class="params">(T value)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; dataRoot = getRoot();</span><br><span class="line">        RBTreeNode&lt;T&gt; parent = root;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(dataRoot!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> cmp = dataRoot.getValue().compareTo(value);</span><br><span class="line">            <span class="keyword">if</span>(cmp&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                parent = dataRoot;</span><br><span class="line">                dataRoot = dataRoot.getRight();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cmp&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                parent = dataRoot;</span><br><span class="line">                dataRoot = dataRoot.getLeft();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(dataRoot.getRight()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    RBTreeNode&lt;T&gt; min = removeMin(dataRoot.getRight());</span><br><span class="line">                    <span class="comment">//x used for fix color balance</span></span><br><span class="line">                    RBTreeNode&lt;T&gt; x = min.getRight()==<span class="keyword">null</span> ? min.getParent() : min.getRight();</span><br><span class="line">                    <span class="keyword">boolean</span> isParent = min.getRight()==<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">                    min.setLeft(dataRoot.getLeft());</span><br><span class="line">                    setParent(dataRoot.getLeft(),min);</span><br><span class="line">                    <span class="keyword">if</span>(parent.getLeft()==dataRoot)&#123;</span><br><span class="line">                        parent.setLeft(min);</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        parent.setRight(min);</span><br><span class="line">                    &#125;</span><br><span class="line">                    setParent(min,parent);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">boolean</span> curMinIsBlack = min.isBlack();</span><br><span class="line">                    <span class="comment">//inherit dataRoot's color</span></span><br><span class="line">                    min.setRed(dataRoot.isRed());</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(min!=dataRoot.getRight())&#123;</span><br><span class="line">                        min.setRight(dataRoot.getRight());</span><br><span class="line">                        setParent(dataRoot.getRight(),min);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//remove a black node,need fix color</span></span><br><span class="line">                    <span class="keyword">if</span>(curMinIsBlack)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(min!=dataRoot.getRight())&#123;</span><br><span class="line">                            fixRemove(x,isParent);</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(min.getRight()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                            fixRemove(min.getRight(),<span class="keyword">false</span>);</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            fixRemove(min,<span class="keyword">true</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    setParent(dataRoot.getLeft(),parent);</span><br><span class="line">                    <span class="keyword">if</span>(parent.getLeft()==dataRoot)&#123;</span><br><span class="line">                        parent.setLeft(dataRoot.getLeft());</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        parent.setRight(dataRoot.getLeft());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//current node is black and tree is not empty</span></span><br><span class="line">                    <span class="keyword">if</span>(dataRoot.isBlack() &amp;&amp; !(root.getLeft()==<span class="keyword">null</span>))&#123;</span><br><span class="line">                        RBTreeNode&lt;T&gt; x = dataRoot.getLeft()==<span class="keyword">null</span> </span><br><span class="line">                                            ? parent :dataRoot.getLeft();</span><br><span class="line">                        <span class="keyword">boolean</span> isParent = dataRoot.getLeft()==<span class="keyword">null</span>;</span><br><span class="line">                        fixRemove(x,isParent);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                setParent(dataRoot,<span class="keyword">null</span>);</span><br><span class="line">                dataRoot.setLeft(<span class="keyword">null</span>);</span><br><span class="line">                dataRoot.setRight(<span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">if</span>(getRoot()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    getRoot().setRed(<span class="keyword">false</span>);</span><br><span class="line">                    getRoot().setParent(<span class="keyword">null</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                size.decrementAndGet();</span><br><span class="line">                <span class="keyword">return</span> dataRoot.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * fix remove action</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> isParent</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixRemove</span><span class="params">(RBTreeNode&lt;T&gt; node,<span class="keyword">boolean</span> isParent)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; cur = isParent ? <span class="keyword">null</span> : node;</span><br><span class="line">        <span class="keyword">boolean</span> isRed = isParent ? <span class="keyword">false</span> : node.isRed();</span><br><span class="line">        RBTreeNode&lt;T&gt; parent = isParent ? node : node.getParent();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(!isRed &amp;&amp; !isRoot(cur))&#123;</span><br><span class="line">            RBTreeNode&lt;T&gt; sibling = getSibling(cur,parent);</span><br><span class="line">            <span class="comment">//sibling is not null,due to before remove tree color is balance</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//if cur is a left node</span></span><br><span class="line">            <span class="keyword">boolean</span> isLeft = parent.getRight()==sibling;</span><br><span class="line">            <span class="keyword">if</span>(sibling.isRed() &amp;&amp; !isLeft)&#123;<span class="comment">//case 1</span></span><br><span class="line">                <span class="comment">//cur in right</span></span><br><span class="line">                parent.makeRed();</span><br><span class="line">                sibling.makeBlack();</span><br><span class="line">                rotateRight(parent);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sibling.isRed() &amp;&amp; isLeft)&#123;</span><br><span class="line">                <span class="comment">//cur in left</span></span><br><span class="line">                parent.makeRed();</span><br><span class="line">                sibling.makeBlack();</span><br><span class="line">                rotateLeft(parent);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(isBlack(sibling.getLeft()) &amp;&amp; isBlack(sibling.getRight()))&#123;<span class="comment">//case 2</span></span><br><span class="line">                sibling.makeRed();</span><br><span class="line">                cur = parent;</span><br><span class="line">                isRed = cur.isRed();</span><br><span class="line">                parent=parent.getParent();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(isLeft &amp;&amp; !isBlack(sibling.getLeft()) </span><br><span class="line">                                    &amp;&amp; isBlack(sibling.getRight()))&#123;<span class="comment">//case 3</span></span><br><span class="line">                sibling.makeRed();</span><br><span class="line">                sibling.getLeft().makeBlack();</span><br><span class="line">                rotateRight(sibling);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!isLeft &amp;&amp; !isBlack(sibling.getRight()) </span><br><span class="line">                                            &amp;&amp; isBlack(sibling.getLeft()) )&#123;</span><br><span class="line">                sibling.makeRed();</span><br><span class="line">                sibling.getRight().makeBlack();</span><br><span class="line">                rotateLeft(sibling);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(isLeft &amp;&amp; !isBlack(sibling.getRight()))&#123;<span class="comment">//case 4</span></span><br><span class="line">                sibling.setRed(parent.isRed());</span><br><span class="line">                parent.makeBlack();</span><br><span class="line">                sibling.getRight().makeBlack();</span><br><span class="line">                rotateLeft(parent);</span><br><span class="line">                cur=getRoot();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!isLeft &amp;&amp; !isBlack(sibling.getLeft()))&#123;</span><br><span class="line">                sibling.setRed(parent.isRed());</span><br><span class="line">                parent.makeBlack();</span><br><span class="line">                sibling.getLeft().makeBlack();</span><br><span class="line">                rotateRight(parent);</span><br><span class="line">                cur=getRoot();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(isRed)&#123;</span><br><span class="line">            cur.makeBlack();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(getRoot()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            getRoot().setRed(<span class="keyword">false</span>);</span><br><span class="line">            getRoot().setParent(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//get sibling node</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RBTreeNode&lt;T&gt; <span class="title">getSibling</span><span class="params">(RBTreeNode&lt;T&gt; node,RBTreeNode&lt;T&gt; parent)</span></span>&#123;</span><br><span class="line">        parent = node==<span class="keyword">null</span> ? parent : node.getParent();</span><br><span class="line">        <span class="keyword">if</span>(node==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> parent.getLeft()==<span class="keyword">null</span> ? parent.getRight() : parent.getLeft();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(node==parent.getLeft())&#123;</span><br><span class="line">            <span class="keyword">return</span> parent.getRight();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> parent.getLeft();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isBlack</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> node==<span class="keyword">null</span> || node.isBlack();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isRoot</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root.getLeft() == node &amp;&amp; node.getParent()==<span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find the successor node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node current node's right node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RBTreeNode&lt;T&gt; <span class="title">removeMin</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        <span class="comment">//find the min node</span></span><br><span class="line">        RBTreeNode&lt;T&gt; parent = node;</span><br><span class="line">        <span class="keyword">while</span>(node!=<span class="keyword">null</span> &amp;&amp; node.getLeft()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            parent = node;</span><br><span class="line">            node = node.getLeft();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//remove min node</span></span><br><span class="line">        <span class="keyword">if</span>(parent==node)&#123;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        parent.setLeft(node.getRight());</span><br><span class="line">        setParent(node.getRight(),parent);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//don't remove right pointer,it is used for fixed color balance</span></span><br><span class="line">        <span class="comment">//node.setRight(null);</span></span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> T <span class="title">addNode</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        node.setLeft(<span class="keyword">null</span>);</span><br><span class="line">        node.setRight(<span class="keyword">null</span>);</span><br><span class="line">        node.setRed(<span class="keyword">true</span>);</span><br><span class="line">        setParent(node,<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span>(root.getLeft()==<span class="keyword">null</span>)&#123;</span><br><span class="line">            root.setLeft(node);</span><br><span class="line">            <span class="comment">//root node is black</span></span><br><span class="line">            node.setRed(<span class="keyword">false</span>);</span><br><span class="line">            size.incrementAndGet();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            RBTreeNode&lt;T&gt; x = findParentNode(node);</span><br><span class="line">            <span class="keyword">int</span> cmp = x.getValue().compareTo(node.getValue());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.overrideMode &amp;&amp; cmp==<span class="number">0</span>)&#123;</span><br><span class="line">                T v = x.getValue();</span><br><span class="line">                x.setValue(node.getValue());</span><br><span class="line">                <span class="keyword">return</span> v;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cmp==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//value exists,ignore this node</span></span><br><span class="line">                <span class="keyword">return</span> x.getValue();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            setParent(node,x);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(cmp&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                x.setLeft(node);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                x.setRight(node);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixInsert(node);</span><br><span class="line">            size.incrementAndGet();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find the parent node to hold node x,if parent value equals x.value return parent.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RBTreeNode&lt;T&gt; <span class="title">findParentNode</span><span class="params">(RBTreeNode&lt;T&gt; x)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; dataRoot = getRoot();</span><br><span class="line">        RBTreeNode&lt;T&gt; child = dataRoot;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(child!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> cmp = child.getValue().compareTo(x.getValue());</span><br><span class="line">            <span class="keyword">if</span>(cmp==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> child;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(cmp&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                dataRoot = child;</span><br><span class="line">                child = child.getLeft();</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cmp&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                dataRoot = child;</span><br><span class="line">                child = child.getRight();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dataRoot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * red black tree insert fix.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> x</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixInsert</span><span class="params">(RBTreeNode&lt;T&gt; x)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; parent = x.getParent();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(parent!=<span class="keyword">null</span> &amp;&amp; parent.isRed())&#123;</span><br><span class="line">            RBTreeNode&lt;T&gt; uncle = getUncle(x);</span><br><span class="line">            <span class="keyword">if</span>(uncle==<span class="keyword">null</span>)&#123;<span class="comment">//need to rotate</span></span><br><span class="line">                RBTreeNode&lt;T&gt; ancestor = parent.getParent();</span><br><span class="line">                <span class="comment">//ancestor is not null due to before before add,tree color is balance</span></span><br><span class="line">                <span class="keyword">if</span>(parent == ancestor.getLeft())&#123;</span><br><span class="line">                    <span class="keyword">boolean</span> isRight = x == parent.getRight();</span><br><span class="line">                    <span class="keyword">if</span>(isRight)&#123;</span><br><span class="line">                        rotateLeft(parent);</span><br><span class="line">                    &#125;</span><br><span class="line">                    rotateRight(ancestor);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(isRight)&#123;</span><br><span class="line">                        x.setRed(<span class="keyword">false</span>);</span><br><span class="line">                        parent=<span class="keyword">null</span>;<span class="comment">//end loop</span></span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        parent.setRed(<span class="keyword">false</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    ancestor.setRed(<span class="keyword">true</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">boolean</span> isLeft = x == parent.getLeft();</span><br><span class="line">                    <span class="keyword">if</span>(isLeft)&#123;</span><br><span class="line">                        rotateRight(parent);</span><br><span class="line">                    &#125;</span><br><span class="line">                    rotateLeft(ancestor);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span>(isLeft)&#123;</span><br><span class="line">                        x.setRed(<span class="keyword">false</span>);</span><br><span class="line">                        parent=<span class="keyword">null</span>;<span class="comment">//end loop</span></span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        parent.setRed(<span class="keyword">false</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    ancestor.setRed(<span class="keyword">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;<span class="comment">//uncle is red</span></span><br><span class="line">                parent.setRed(<span class="keyword">false</span>);</span><br><span class="line">                uncle.setRed(<span class="keyword">false</span>);</span><br><span class="line">                parent.getParent().setRed(<span class="keyword">true</span>);</span><br><span class="line">                x=parent.getParent();</span><br><span class="line">                parent = x.getParent();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        getRoot().makeBlack();</span><br><span class="line">        getRoot().setParent(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * get uncle node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> node</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> RBTreeNode&lt;T&gt; <span class="title">getUncle</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; parent = node.getParent();</span><br><span class="line">        RBTreeNode&lt;T&gt; ancestor = parent.getParent();</span><br><span class="line">        <span class="keyword">if</span>(ancestor==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(parent == ancestor.getLeft())&#123;</span><br><span class="line">            <span class="keyword">return</span> ancestor.getRight();</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ancestor.getLeft();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateLeft</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; right = node.getRight();</span><br><span class="line">        <span class="keyword">if</span>(right==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> java.lang.IllegalStateException(<span class="string">"right node is null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        RBTreeNode&lt;T&gt; parent = node.getParent();</span><br><span class="line">        node.setRight(right.getLeft());</span><br><span class="line">        setParent(right.getLeft(),node);</span><br><span class="line"></span><br><span class="line">        right.setLeft(node);</span><br><span class="line">        setParent(node,right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(parent==<span class="keyword">null</span>)&#123;<span class="comment">//node pointer to root</span></span><br><span class="line">            <span class="comment">//right  raise to root node</span></span><br><span class="line">            root.setLeft(right);</span><br><span class="line">            setParent(right,<span class="keyword">null</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(parent.getLeft()==node)&#123;</span><br><span class="line">                parent.setLeft(right);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                parent.setRight(right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//right.setParent(parent);</span></span><br><span class="line">            setParent(right,parent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateRight</span><span class="params">(RBTreeNode&lt;T&gt; node)</span></span>&#123;</span><br><span class="line">        RBTreeNode&lt;T&gt; left = node.getLeft();</span><br><span class="line">        <span class="keyword">if</span>(left==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> java.lang.IllegalStateException(<span class="string">"left node is null"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        RBTreeNode&lt;T&gt; parent = node.getParent();</span><br><span class="line">        node.setLeft(left.getRight());</span><br><span class="line">        setParent(left.getRight(),node);</span><br><span class="line"></span><br><span class="line">        left.setRight(node);</span><br><span class="line">        setParent(node,left);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(parent==<span class="keyword">null</span>)&#123;</span><br><span class="line">            root.setLeft(left);</span><br><span class="line">            setParent(left,<span class="keyword">null</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(parent.getLeft()==node)&#123;</span><br><span class="line">                parent.setLeft(left);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                parent.setRight(left);</span><br><span class="line">            &#125;</span><br><span class="line">            setParent(left,parent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setParent</span><span class="params">(RBTreeNode&lt;T&gt; node,RBTreeNode&lt;T&gt; parent)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            node.setParent(parent);</span><br><span class="line">            <span class="keyword">if</span>(parent==root)&#123;</span><br><span class="line">                node.setParent(<span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * debug method,it used print the given node and its children nodes,</span></span><br><span class="line"><span class="comment">     * every layer output in one line</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> root</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printTree</span><span class="params">(RBTreeNode&lt;T&gt; root)</span></span>&#123;</span><br><span class="line">        java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt; queue =<span class="keyword">new</span> java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt;();</span><br><span class="line">        java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt; queue2 =<span class="keyword">new</span> java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        queue.add(root);</span><br><span class="line">        <span class="keyword">boolean</span> firstQueue = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(!queue.isEmpty() || !queue2.isEmpty())&#123;</span><br><span class="line">            java.util.LinkedList&lt;RBTreeNode&lt;T&gt;&gt; q = firstQueue ? queue : queue2;</span><br><span class="line">            RBTreeNode&lt;T&gt; n = q.poll();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(n!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                String pos = n.getParent()==<span class="keyword">null</span> ? <span class="string">""</span> : ( n == n.getParent().getLeft() </span><br><span class="line">                                                                        ? <span class="string">" LE"</span> : <span class="string">" RI"</span>);</span><br><span class="line">                String pstr = n.getParent()==<span class="keyword">null</span> ? <span class="string">""</span> : n.getParent().toString();</span><br><span class="line">                String cstr = n.isRed()?<span class="string">"R"</span>:<span class="string">"B"</span>;</span><br><span class="line">                cstr = n.getParent()==<span class="keyword">null</span> ? cstr : cstr+<span class="string">" "</span>;</span><br><span class="line">                System.out.print(n+<span class="string">"("</span>+(cstr)+pstr+(pos)+<span class="string">")"</span>+<span class="string">"\t"</span>);</span><br><span class="line">                <span class="keyword">if</span>(n.getLeft()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    (firstQueue ? queue2 : queue).add(n.getLeft());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(n.getRight()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                    (firstQueue ? queue2 : queue).add(n.getRight());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                System.out.println();</span><br><span class="line">                firstQueue = !firstQueue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RBTree&lt;String&gt; bst = <span class="keyword">new</span> RBTree&lt;String&gt;();</span><br><span class="line">        bst.addNode(<span class="string">"d"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"d"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"c"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"c"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"b"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"f"</span>);</span><br><span class="line"></span><br><span class="line">        bst.addNode(<span class="string">"a"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"e"</span>);</span><br><span class="line"></span><br><span class="line">        bst.addNode(<span class="string">"g"</span>);</span><br><span class="line">        bst.addNode(<span class="string">"h"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        bst.remove(<span class="string">"c"</span>);</span><br><span class="line"></span><br><span class="line">        bst.printTree(bst.getRoot());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码调试的时候，printTree输出格式如下:<br>d(B)<br>b(B d LE) g(R d RI)<br>a(R b LE) e(B g LE) h(B g RI)<br>f(R e RI)</p>
<p>括号左边表示元素的内容。括号内的第一个元素表示颜色，B表示black，R表示red；第二个元素表示父元素的值；第三个元素表示左右，LE表示在父元素的左边。RI表示在父元素的右边。</p>
<p>第一个元素d是root节点，由于它没有父节点，所以括号内只有一个元素。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>作为平衡二叉查找树里面众多的实现之一，红黑树无疑是最简洁、实现最为简单的。红黑树通过引入颜色的概念，通过颜色这个约束条件的使用来保持树的高度平衡。作为平衡二叉查找树，旋转是一个必不可少的操作。通过旋转可以降低树的高度，在红黑树里面还可以转换颜色。</p>
<p>红黑树里面的插入和删除的操作比较难理解，这时要注意记住一点：操作之前红黑树是平衡的，颜色是符合定义的。在操作的时候就需要向兄弟节点、父节点、侄子节点借调和互换颜色，要达到这个目的，就需要不断的进行旋转。所以红黑树的插入删除操作需要不停的旋转，一旦借调了别的节点，删除和插入的节点就会达到局部的平衡（局部符合红黑树的定义），但是被借调的节点就不会平衡了，这时就需要以被借调的节点为起点继续进行调整，直到整棵树都是平衡的。在整个修复的过程中，插入具体的分为3种情况，删除分为4种情况。</p>
<p>整个红黑树的查找，插入和删除都是O(logN)的，原因就是整个红黑树的高度是logN，查找从根到叶，走过的路径是树的高度，删除和插入操作是从叶到根的，所以经过的路径都是logN。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="https://juejin.im/entry/6844903454767317005#%E9%BB%91%E8%89%B2%E9%AB%98%E5%BA%A6" target="_blank" rel="noopener">面试旧敌之红黑树（直白介绍深入理解）</a></li>
<li><a href="https://segmentfault.com/a/1190000012728513" target="_blank" rel="noopener">红黑树详细分析，看了都说好</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/24367771" target="_blank" rel="noopener">红黑树深入剖析及Java实现</a></li>
</ul>
</div><div class="tags"><a href="/tags/数据结构与算法-Java实现/">数据结构与算法(Java实现)</a></div><div class="post-share"></div><div class="post-nav"><a href="/2020/05/06/2020-20200506-多路查找树/" class="pre">多路查找树</a><a href="/2020/05/06/2020-20200505-平衡二叉树的基本介绍与Java实现/" class="next">平衡二叉树的基本介绍与Java实现</a></div><div id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC80NDg2NC8yMTM4NQ=="></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#什么是红黑树"><span class="toc-text">什么是红黑树</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#红黑树的-5-个特性"><span class="toc-text">红黑树的 5 个特性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#红黑树的左旋右旋"><span class="toc-text">红黑树的左旋右旋</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#左旋"><span class="toc-text">左旋</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#右旋"><span class="toc-text">右旋</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#红黑树的平衡插入"><span class="toc-text">红黑树的平衡插入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#要插入的结点是红色还是黑色"><span class="toc-text">要插入的结点是红色还是黑色?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#将染红的结点插入后的调整有-2-种情况"><span class="toc-text">将染红的结点插入后的调整有 2 种情况</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#情况1-父亲节点和叔叔节点都是红色"><span class="toc-text">情况1.父亲节点和叔叔节点都是红色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#情况2-父亲节点为红色，叔叔节点为黑色-N-在父亲节点-P-的左孩子位置"><span class="toc-text">情况2.父亲节点为红色，叔叔节点为黑色(N 在父亲节点 P 的左孩子位置)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#情况3-父亲节点为红色，叔叔节点为黑色-N-在父亲节点-P-的右孩子位置"><span class="toc-text">情况3.父亲节点为红色，叔叔节点为黑色(N 在父亲节点 P 的右孩子位置)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插入总结"><span class="toc-text">插入总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#验证-Java-中的-TreeMap-源码"><span class="toc-text">验证: Java 中的 TreeMap 源码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#红黑树的平衡删除"><span class="toc-text">红黑树的平衡删除</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#如何进行调整"><span class="toc-text">如何进行调整</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#总体思想"><span class="toc-text">总体思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#删除修复操作分为四种情况-删除黑节点后-："><span class="toc-text">删除修复操作分为四种情况(删除黑节点后)：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#case1-待删除的节点的兄弟节点是红色的节点"><span class="toc-text">case1:待删除的节点的兄弟节点是红色的节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#case2-待删除的节点的兄弟节点是黑色的节点，且兄弟节点的子节点都是黑色的"><span class="toc-text">case2:待删除的节点的兄弟节点是黑色的节点，且兄弟节点的子节点都是黑色的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#case3-待调整的节点的兄弟节点是黑色的节点，且兄弟节点的左子节点是红色的，右节点是黑色的"><span class="toc-text">case3:待调整的节点的兄弟节点是黑色的节点，且兄弟节点的左子节点是红色的，右节点是黑色的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#case4-待调整的节点的兄弟节点是黑色的节点，且右子节点是是红色的"><span class="toc-text">case4:待调整的节点的兄弟节点是黑色的节点，且右子节点是是红色的</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除后调整的全部逻辑流程图"><span class="toc-text">删除后调整的全部逻辑流程图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java-中-TreeMap-的源码"><span class="toc-text">java 中 TreeMap 的源码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#红黑树的Java实现"><span class="toc-text">红黑树的Java实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/09/15/JUC之Semaphore信号灯/">JUC之Semaphore信号灯</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/15/JUC之CyclicBarrier循环栅栏/">JUC之CyclicBarrier循环栅栏</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/15/JUC之CountDownLatch减少计数/">JUC之CountDownLatch减少计数</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/14/Druid-Kylin-Presto-Impala-SparkSQL-ES比较/">Druid-Kylin-Presto-Impala-SparkSQL-ES比较</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/01/2020-20200901-Linux下查询进程占用的内存方法总结/">Linux下查询进程占用的内存方法总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/26/2020-20200826-解决Github-Page无法访问的其中一种情况/">解决Github-Page无法访问的其中一种情况</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/26/2020-20200826-Ubuntu中修改DNS的方法/">Ubuntu中修改DNS的方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/26/2020-20200826-nslookup命令-查DNS信息用/">Nslookup命令-查DNS信息用</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/02/2020-20200801-Ubuntu20-04中安装flameshot截屏工具/">Ubuntu20.04中安装flameshot截屏工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/31/2020-20200731-Ubuntu刷新DNS/">Ubuntu刷新DNS</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/BigData/">BigData</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Eclipse/">Eclipse</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Excel/">Excel</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">108</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/">Javascript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tampermonkey/">Tampermonkey</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ubuntu/">Ubuntu</a><span class="category-list-count">50</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vim/">vim</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/人工智能/">人工智能</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构与算法/">数据结构与算法</a><span class="category-list-count">40</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/">未分类</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/正则表达式/">正则表达式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/视频笔记/">视频笔记</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机操作系统/">计算机操作系统</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机组成原理/">计算机组成原理</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Struts2/" style="font-size: 15px;">Struts2</a> <a href="/tags/BigData/" style="font-size: 15px;">BigData</a> <a href="/tags/Eclipse插件/" style="font-size: 15px;">Eclipse插件</a> <a href="/tags/vim/" style="font-size: 15px;">vim</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Linux命令/" style="font-size: 15px;">Linux命令</a> <a href="/tags/Ubuntu装机日志/" style="font-size: 15px;">Ubuntu装机日志</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/SpringMVC/" style="font-size: 15px;">SpringMVC</a> <a href="/tags/Lombok/" style="font-size: 15px;">Lombok</a> <a href="/tags/Java细节/" style="font-size: 15px;">Java细节</a> <a href="/tags/Thymeleaf/" style="font-size: 15px;">Thymeleaf</a> <a href="/tags/Junit/" style="font-size: 15px;">Junit</a> <a href="/tags/Linux配置/" style="font-size: 15px;">Linux配置</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/Jackson/" style="font-size: 15px;">Jackson</a> <a href="/tags/Tomcat/" style="font-size: 15px;">Tomcat</a> <a href="/tags/Http/" style="font-size: 15px;">Http</a> <a href="/tags/Servlet/" style="font-size: 15px;">Servlet</a> <a href="/tags/JSP-EL-JSTL/" style="font-size: 15px;">JSP/EL/JSTL</a> <a href="/tags/Eclipse/" style="font-size: 15px;">Eclipse</a> <a href="/tags/Hibernate/" style="font-size: 15px;">Hibernate</a> <a href="/tags/OGNL/" style="font-size: 15px;">OGNL</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/SSH/" style="font-size: 15px;">SSH</a> <a href="/tags/MyBatis/" style="font-size: 15px;">MyBatis</a> <a href="/tags/人工智能/" style="font-size: 15px;">人工智能</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/Hadoop/" style="font-size: 15px;">Hadoop</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/Zookeeper/" style="font-size: 15px;">Zookeeper</a> <a href="/tags/SpringSecurity/" style="font-size: 15px;">SpringSecurity</a> <a href="/tags/Jquery/" style="font-size: 15px;">Jquery</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/Flume/" style="font-size: 15px;">Flume</a> <a href="/tags/Excel/" style="font-size: 15px;">Excel</a> <a href="/tags/视频笔记/" style="font-size: 15px;">视频笔记</a> <a href="/tags/计算机组成原理/" style="font-size: 15px;">计算机组成原理</a> <a href="/tags/Ubuntu配置/" style="font-size: 15px;">Ubuntu配置</a> <a href="/tags/数据结构与算法-Java实现/" style="font-size: 15px;">数据结构与算法(Java实现)</a> <a href="/tags/Tampermonkey/" style="font-size: 15px;">Tampermonkey</a> <a href="/tags/JUC/" style="font-size: 15px;">JUC</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">93</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">92</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a><span class="archive-list-count">35</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017</a><span class="archive-list-count">35</span></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p><span> Copyright &copy;<a href="/." rel="nofollow">zjc.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=2.0.5"></script><div id="fullscreen-img" class="hide"><span class="close"></span></div><script type="text/javascript" src="/js/imgview.js?v=2.0.5" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.5" async></script><script>(function(d, s) {
  var j, e = d.getElementsByTagName('body')[0];
  if (typeof LivereTower === 'function') { return; }
  j = d.createElement(s);
  j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
  j.async = true;
  e.appendChild(j);
})(document, 'script');
</script></body></html>