<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.5"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.5"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><title>Spring的事务管理 | 想了20分钟的博客名</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Spring的事务管理</h1><a id="logo" href="/.">想了20分钟的博客名</a><p class="description">世界是唯物辩证的</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Spring的事务管理</h1><div class="post-meta"><a href="/2019/07/28/2019-20190727-Spring的事务管理/#comments" class="comment-count"></a><p><span class="date">Jul 28, 2019</span><span><a href="/categories/Java/" class="category">Java</a></span></p></div><div class="post-content"><h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><h2 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h2><p>事务指的是逻辑上的一组操作,组成这组操作的各个逻辑单元,要么全部成功,要么全部失败</p>
<h2 id="事务特性"><a href="#事务特性" class="headerlink" title="事务特性"></a>事务特性</h2><ul>
<li>原子性:代表事务不可分割</li>
<li>一致性:代表事务执行的前后,数据的完整性保持一致</li>
<li>隔离性:代表一个事务执行的过程中,不应该收到其他事务的干扰</li>
<li>持久性:代表事务执行完成后,数据就持久到数据库中<br>如果不考虑隔离性,引发安全问题</li>
</ul>
<h2 id="读问题"><a href="#读问题" class="headerlink" title="读问题"></a>读问题</h2><p>脏读:一个事务读到另一个事务未提交的数据<br>不可重复读:一个事务读到另一个事务已经提交的update数据,导致在前一个事务多次查询结果不一致<br>虚读:一个事务读到另一个事务已经提交的insert数据,导致在前一个事务多次查询结果不一致</p>
<h2 id="写问题-了解"><a href="#写问题-了解" class="headerlink" title="写问题(了解)"></a>写问题(了解)</h2><p>引发两类丢失更新</p>
<p>读问题的解决</p>
<ul>
<li>Read uncommitted:以上读问题都会发生</li>
<li>Read committed:解决脏读,但是不可重复读和虚度有可能发生(Oracle用这种)</li>
<li>Repeatable read:解决脏读和不可重复读,但是虚读有可能发生(MySQL用这种)</li>
<li>Serializable:解决所有问题,但是效率低</li>
</ul>
<h1 id="Spring的事务管理的API"><a href="#Spring的事务管理的API" class="headerlink" title="Spring的事务管理的API"></a>Spring的事务管理的API</h1><p>Spring 框架中,最重要的事务管理的 API 有三个：<code>TransactionDefinition</code>、<code>PlatformTransactionManager</code> 和 <code>TransactionStatus</code><br>所谓事务管理,实质上就是按照给定的事务规则来执行提交或者回滚操作.其中</p>
<ul>
<li>“给定的事务规则”是用 TransactionDefinition 表示的</li>
<li>“按照……来执行提交或者回滚操作”是用 PlatformTransactionManager 表示的</li>
<li>TransactionStatus 可以看作代表事务本身.<h2 id="PlatformTransactionManager-平台事物管理器"><a href="#PlatformTransactionManager-平台事物管理器" class="headerlink" title="PlatformTransactionManager:平台事物管理器"></a>PlatformTransactionManager:平台事物管理器</h2>平台事务管理器:接口,是Spring用于管理事务的真正对象</li>
<li>DataSourceTransactionManager:底层使用JDBC管理事务</li>
<li>HibernateTransactionManager:底层使用Hibernate管理事务</li>
</ul>
<h2 id="TransactionDefinition-事务定义信息"><a href="#TransactionDefinition-事务定义信息" class="headerlink" title="TransactionDefinition:事务定义信息"></a>TransactionDefinition:事务定义信息</h2><p>事务定义:用于定义事务的相关信息,隔离级别,超时信息,传播行为,是否只读</p>
<h2 id="TransactionStatus-事务的状态"><a href="#TransactionStatus-事务的状态" class="headerlink" title="TransactionStatus:事务的状态"></a>TransactionStatus:事务的状态</h2><p>Spring进行事务管理的时候,首先<code>平台事务管理器</code>根据事务<code>定义信息</code>进行事务的管理,在事物管理过程中,产生各种状态,将这些状态的信息记录到<code>事务状态</code>中</p>
<h1 id="搭建Spring的事务管理的环境"><a href="#搭建Spring的事务管理的环境" class="headerlink" title="搭建Spring的事务管理的环境"></a>搭建Spring的事务管理的环境</h1><p>主要有以下两个步骤</p>
<ul>
<li>配置连接池和JDBC的模板</li>
<li>在DAO注入jdbc的模板</li>
</ul>
<p>具体实现一次</p>
<ol>
<li><p>创建Service的接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.transaction;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转账接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(String from, String to, Double money)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建Service的实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAccountDao</span><span class="params">(AccountDao accountDao)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.accountDao = accountDao;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * from:转出帐号</span></span><br><span class="line"><span class="comment">	 * to:转入帐号</span></span><br><span class="line"><span class="comment">	 * money:金额</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(String from, String to, Double money)</span> </span>&#123;</span><br><span class="line">		accountDao.outMoney(from, money);</span><br><span class="line">		accountDao.inMoney(to, money);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建DAO的接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.transaction;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转账的Dao接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">outMoney</span><span class="params">(String from, Double money)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inMoney</span><span class="params">(String to, Double money)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建DAO的实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.support.JdbcDaoSupport;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 转账的Dao的实现类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDaoImpl</span> <span class="keyword">extends</span> <span class="title">JdbcDaoSupport</span> <span class="keyword">implements</span> <span class="title">AccountDao</span> </span>&#123;</span><br><span class="line"><span class="comment">//	在不继承JdbcDaoSupport的前提下,是需要写如下代码用以注入Jdbc的</span></span><br><span class="line"><span class="comment">//	但是继承之后就不需要了,因为在继承类中就已经有如下代码了</span></span><br><span class="line"><span class="comment">// 	还可以继续简化,继承这个类后,在appllicationContext.xml文件中,只需要配置一个连接池就行</span></span><br><span class="line"><span class="comment">//	因为继承类中连注入的步骤都已经有了</span></span><br><span class="line"><span class="comment">//	private JdbcTemplate jdbcTemplate;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//	public void setJdbcTemplate(JdbcTemplate jdbcTemplate) &#123;</span></span><br><span class="line"><span class="comment">//		this.jdbcTemplate = jdbcTemplate;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在DAO中编写扣钱和加钱的方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">outMoney</span><span class="params">(String from, Double money)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.getJdbcTemplate().update(<span class="string">"update account set money = money - ? where name = ?"</span>, money, from);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inMoney</span><span class="params">(String to, Double money)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.getJdbcTemplate().update(<span class="string">"update account set money = money + ? where name = ?"</span>, money, to);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置Service和DAO:交给Spring管理</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 引入属性文件 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 第一种方式通过一个Bean标签引入的(很少使用) --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span> <span class="attr">value</span>=<span class="string">"classpath:jdbc.properties"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置Spring的内置连接池 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourcePool"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 属性注入 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span></span></span><br><span class="line"><span class="tag">			<span class="attr">value</span>=<span class="string">"$&#123;jdbc.driverClass&#125;"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplate"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSourcePool"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 配置Service --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.transaction.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 在AccountServiceImpl中注入accountDao --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置DAO --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDao"</span> <span class="attr">class</span>=<span class="string">"com.zjinc36.transaction.AccountDaoImpl"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 向DAO中注入jdbc --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">ref</span>=<span class="string">"jdbcTemplate"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试整个环境是否打通</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zjinc36.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试转账的环境</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zjc</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(<span class="string">"classpath:applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTransf</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Resource</span>(name=<span class="string">"accountService"</span>)</span><br><span class="line">	<span class="keyword">private</span> AccountService accountService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		accountService.transfer(<span class="string">"Lucy"</span>, <span class="string">"lisi"</span>, <span class="number">100</span>d);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="Spring的事务管理"><a href="#Spring的事务管理" class="headerlink" title="Spring的事务管理"></a>Spring的事务管理</h1><p>上述搭建的环境中,转账过程没有进行事务管理,以下提供两种方式进行事务管理</p>
<h2 id="常见的事务管理器"><a href="#常见的事务管理器" class="headerlink" title="常见的事务管理器"></a>常见的事务管理器</h2><p><a href="https://blog.csdn.net/Ditto_zhou/article/details/81060975#h5o-7" target="_blank" rel="noopener"><em>Spring的事务管理(一) Spring事务管理的实现，事务的属性(隔离级别，传播行为，只读)</em></a><br><a href="http://www.belonk.com/c/spring_transaction_manager.html" target="_blank" rel="noopener"><em>Spring事务管理二：Spring事务管理器</em></a><br>常见事务管理器有如下几种</p>
<ul>
<li>Jdbc事务<br>如果应用程序中直接使用JDBC来进行持久化，DataSourceTransactionManager会为你处理事务边界。</li>
</ul>
<p>为了使用DataSourceTransactionManager，你需要使用如下的XML将其装配到应用程序的上下文定义中：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>DataSourceTransactionManager是通过调用Connection来管理事务，通过调用Connection的commit方法提交事务，rollback方法回滚事务</p>
<ul>
<li>Hiberante事务</li>
</ul>
<p>Hibernate持久化策略，利用HibernateTransactionManager进行事务管理。对于Hibernate3，需要在Spring上下文定义中添加如下的<bean>声明：</bean></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.hibernate3.HibernateTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>sessionFactory属性需要装配一个Hibernate的session工厂，HibernateTransactionManager的实现细节是它将事务管理的职</p>
<p>责委托给org.hibernate.Transaction对象，而后者是从Hibernate Session中获取到的。</p>
<p>当事务成功完成时，HibernateTransactionManager将会调用Transaction对象的commit()方法，反之，将会调用rollback()方法。</p>
<ul>
<li>JPA事务</li>
</ul>
<p>Hibernate多年来一直是事实上的Java持久化标准，但是现在Java持久化API作为真正的Java持久化标准进入大家的视野。</p>
<p>如果你计划使用JPA的话，那你需要使用Spring的JpaTransactionManager来处理事务。你需要在Spring中这样配置JpaTransactionManager：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.orm.jpa.JpaTransactionManager"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sessionFactory"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>JpaTransactionManager只需要装配一个JPA实体管理工厂（javax.persistence.EntityManagerFactory接口的任意实现）。</p>
<p>JpaTransactionManager将与由工厂所产生的JPA EntityManager合作来构建事务。</p>
<ul>
<li>Java原生API事务</li>
</ul>
<p>如果你没有使用以上所述的事务管理，或者是跨越了多个事务管理源（比如两个或者是多个不同的数据源），你就</p>
<p>需要使用JtaTransactionManager：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.jta.JtaTransactionManager"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionManagerName"</span> <span class="attr">value</span>=<span class="string">"java:/TransactionManager"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>JtaTransactionManager将事务管理的责任委托给javax.transaction.UserTransaction</p>
<p>和javax.transaction.TransactionManager对象，其中事务成功完成通过UserTransaction.commit()方法提交，事务</p>
<p>失败通过UserTransaction.rollback()方法回滚。</p>
<h2 id="方式一-编程式事务-需要手动编写代码"><a href="#方式一-编程式事务-需要手动编写代码" class="headerlink" title="方式一:编程式事务(需要手动编写代码)"></a>方式一:编程式事务(需要手动编写代码)</h2><p><a href="http://www.belonk.com/c/spring_programmatic_transaction.html" target="_blank" rel="noopener"><em>Spring事务管理三：编程式事务</em></a></p>
<h3 id="配置平台事务管理器"><a href="#配置平台事务管理器" class="headerlink" title="配置平台事务管理器"></a>配置平台事务管理器</h3><p><a href="/2019/07/28/Spring的事务管理/#常见的事务管理器"><em>常见的事务管理器</em></a></p>
<h3 id="配置事务管理的模板类"><a href="#配置事务管理的模板类" class="headerlink" title="配置事务管理的模板类"></a>配置事务管理的模板类</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.transaction.support.TransactionTemplate"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionManager"</span> <span class="attr">ref</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="在业务层注入事务管理的模板"><a href="#在业务层注入事务管理的模板" class="headerlink" title="在业务层注入事务管理的模板"></a>在业务层注入事务管理的模板</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置Service --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">class</span>=<span class="string">"com.zjinc36.transaction.AccountServiceImpl"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 注入事务管理的模板 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"transactionTemplate"</span> <span class="attr">ref</span>=<span class="string">"transactionTemplate"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="编写事务管理的代码"><a href="#编写事务管理的代码" class="headerlink" title="编写事务管理的代码"></a>编写事务管理的代码</h3><p>在AccountServiceImpl.java文件,为transfer函数添加事务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * from:转出帐号 to:转入帐号 money:金额</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transfer</span><span class="params">(String from, String to, Double money)</span> </span>&#123;</span><br><span class="line">	transactionTemplate.execute(<span class="keyword">new</span> TransactionCallbackWithoutResult() &#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doInTransactionWithoutResult</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">				TransactionStatus transactionStatus)</span> </span>&#123;</span><br><span class="line">			accountDao.outMoney(from, money);</span><br><span class="line">			accountDao.inMoney(to, money);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="方式二-声明式事务"><a href="#方式二-声明式事务" class="headerlink" title="方式二:声明式事务"></a>方式二:声明式事务</h2><p><a href="http://www.belonk.com/c/spring_declarative_transaction.html" target="_blank" rel="noopener"><em>Spring事务管理四：声明式事务</em></a></p>
<h3 id="事务属性"><a href="#事务属性" class="headerlink" title="事务属性"></a>事务属性</h3><p>在定义事务之前，需要了解一些事务的参数，包括传播机制、隔离级别、是否只读、事务超时等，还包括回滚规则定义等参数。</p>
<h4 id="事务的传播行为"><a href="#事务的传播行为" class="headerlink" title="事务的传播行为"></a><strong>事务的传播行为</strong></h4><p>如果遇到了特别复杂的业务逻辑,有可能会出现业务之间的方法相互调用<br>我们一般将事务建立在业务层,那么当业务复杂的时候,代码层面上会出现A代码创建了事务,B代码也创建了事务,同时B代码中调用A的代码,这样就会出现事务”嵌套”在一起,而不是一个业务逻辑就一个事务.<br><strong>事务的传播的行为主要用来解决业务层方法相互调用的问题</strong></p>
<table>
<thead>
<tr>
<th>传播行为</th>
<th>解释</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td><strong>PROPAGATION_REQUIRED</strong></td>
<td>如果存在一个事务,则支持当前事务.如果没有事务则开启事务</td>
<td>Spring中默认的传播行为,前三个用以保证多个操作在同一个事务中</td>
</tr>
<tr>
<td>PROPAGATION_SUPPORTS</td>
<td>如果存在一个事务,则支持当前事务.如果没有事务,则非事务的执行</td>
<td></td>
</tr>
<tr>
<td>PROPAGATION_MANDATORY</td>
<td>如果已经存在一个事务,则支持当前事务.如果没有一个活动的事务,则抛出异常</td>
<td></td>
</tr>
<tr>
<td><strong>PROPAGATION_REQUIREDS_NEW</strong></td>
<td>总是开启一个新的事务.如果一个事务已经存在,则将这个存在的事务挂起,并创建一个新的事务,只包含自身操作.如果没有事物,创建一个只包含自身的事务</td>
<td>用以保证多个操作不在同一个事务中,在批处理,信用卡还款处理,给每一个卡创建一个独立的事务,不会因为一个处理失败,全部失败</td>
</tr>
<tr>
<td>PROPAGATION_NOT_SUPPORTED</td>
<td>总是非事务的执行,并挂起任何存在的事务</td>
<td></td>
</tr>
<tr>
<td>PROPAGATION_NEVER</td>
<td>总是非事务的执行,如果已经存在一个事务,则抛出异常</td>
<td></td>
</tr>
<tr>
<td><strong>PROPAGATION_NESTED</strong></td>
<td>如果一个活动的事务存在,则运行在一个嵌套的事务中；如果没有活动事务,则按照PROPAGATION_REQUIRED属性执行(开启一个新的事务)</td>
<td>嵌套事务,如果A中有事务,按照A的事务执行,执行完成后,设置一个保存点,然后执行B中的操作.如果没有异常,则执行通过,如果有异常,可以选择回滚到初始位置,也可以回滚到保存点</td>
</tr>
</tbody></table>
<h4 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a><strong>隔离级别</strong></h4><p>隔离级别(isolation level)：定义了其他并发事务对当前事务的影响程度，或者说是当前事务对事务数据的自私程度。</p>
<p>在了解隔离级别定义之前，首先需要了解事务并发带来的问题，包括如下几个方面：</p>
<ul>
<li>第一类丢失更新：两个事务更新相同数据，如果第一个事务提交，另一个事务回滚，第一个事务的更新会被回滚。</li>
<li>脏读(dirty reads)：第二个事务查询到第一个事务未提交的更新数据，第二个事务根据该数据执行，但第一个事务回滚，第二个事务操作脏数据。</li>
<li>幻读(phantom read)：一个事务查询到了另一个事务已经提交的新数据，导致多次查询数据不一致。</li>
<li>不可重复读(nonrepeatable read)：一个事务查询到另一个事务已经修改的数据，导致多次查询数据不一致。</li>
<li>第二类丢失更新：多个事务同时读取相同数据，并完成各自的事务提交，导致最后一个事务提交会覆盖前面所有事务对数据的改变。</li>
</ul>
<p>理想情况下，事务是完全隔离的，从而防止上述问题产生，但是这样通常会涉及数据库锁定(锁表、行)数据，造成性能问题。通常，并不是所有应用都需要完全的隔离事务。事务隔离级别提供了事务隔离上的灵活性，从而让开发人员进行灵活的取舍。Spring提供了5中事务隔离级别：</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>DEFAULT</td>
<td>使用后端数据库默认的隔离级别(spring中的的选择项)</td>
</tr>
<tr>
<td>READ_UNCOMMITED</td>
<td>允许你读取还未提交的改变了的数据。可能导致脏、幻、不可重复读</td>
</tr>
<tr>
<td>READ_COMMITTED</td>
<td>允许在并发事务已经提交后读取。可防止脏读，但幻读和不可重复读仍可发生</td>
</tr>
<tr>
<td>REPEATABLE_READ</td>
<td>对相同字段的多次读取是一致的，除非数据被事务本身改变。可防止脏、不可重复读，但幻读仍可能发生。</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>完全服从ACID的隔离级别，确保不发生脏、幻、不可重复读。这在所有的隔离级别中是最慢的，它是典型的通过完全锁定在事务中涉及的数据表来完成的。</td>
</tr>
</tbody></table>
<p>这5中隔离级别中，READ_UNCOMMITED是最高效的但也是隔离程度最低的；而SERIALIZABLE则是效率最低但是隔离程度最高的。<br>Spring的这5中隔离级别在枚举类Isolation中进行了定义，其中最终也是调用的TransactionDefinition接口中的常量定义。</p>
<h4 id="是否只读"><a href="#是否只读" class="headerlink" title="是否只读"></a><strong>是否只读</strong></h4><p>如果事务只对后端数据进行读操作，那么如果将事务设置为只读事务，可以利用后端数据库优化措施进行适当优化。</p>
<p>只读事务”并不是一个强制选项，它只是一个“暗示”，提示数据库驱动程序和数据库系统，这个事务并不包含更改数据的操作，那么JDBC驱动程序和数据库就有可能根据这种情况对该事务进行一些特定的优化，比方说不安排相应的数据库锁，以减轻事务对数据库的压力，毕竟事务也是要消耗数据库的资源的。但是你非要在“只读事务”里面修改数据，也并非不可以，只不过对于数据一致性的保护不像“读写事务”那样保险而已。</p>
<p>因此，“只读事务”仅仅是一个性能优化的推荐配置而已，并非强制你要这样做不可。</p>
<p>只读事务实在开启事务时有数据库实施的，所以只对具备启动新事务的传播机制有效，如REQUIRED、REQUIRES_NEW、NESTED。</p>
<h4 id="超时时间"><a href="#超时时间" class="headerlink" title="超时时间"></a><strong>超时时间</strong></h4><p>超时时间定义了当事务执行时间超过一定时间后自动回滚。</p>
<p>超时机制会在事务开启时启动，所以只对具备启动新事务的传播机制有效，如REQUIRED、REQUIRES_NEW、NESTED。</p>
<h4 id="回滚规则"><a href="#回滚规则" class="headerlink" title="回滚规则"></a><strong>回滚规则</strong></h4><p>回滚规则定义了事务在遇到什么异常进行回滚、什么异常不进行回滚。默认情况下，事务在遇到运行时异常(RuntimeException)才会回滚，但是我们可以在Spring中进行定义来改变其默认行为。Spring在xml文件配置事务时提供了rollback-for和no-rollback-for参数，来指定回滚和不会滚的异常名称，该名称对应的类为Throwable的子类。</p>
<p>我们总体了解了事务的各个属性以及对事务的影响，接下来，我们看看在Spring中如何进行声明式事务配置。</p>
<h3 id="XML配置事务"><a href="#XML配置事务" class="headerlink" title="XML配置事务"></a>XML配置事务</h3><p>基于<a href="/2019/07/28/Spring的事务管理/#搭建Spring的事务管理的环境"><em>基本代码环境</em></a>进行修改</p>
<h4 id="配置命名空间"><a href="#配置命名空间" class="headerlink" title="配置命名空间"></a>配置命名空间</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">     http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="创建事务的规则"><a href="#创建事务的规则" class="headerlink" title="创建事务的规则"></a>创建事务的规则</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- JDBC事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 声明式事务配置 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- proxy-target-class属性值决定是基于接口的还是基于类的代理被创建。首先说明下proxy-target-class="true"和proxy-target-class="false"的区别，为true则是基于类的代理将起作用（需要cglib库），为false或者省略这个属性，则标准的JDK 基于接口的代理将起作用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span></span></span><br><span class="line"><span class="tag">		<span class="attr">expression</span>=<span class="string">"execution(* com.zjinc36.transaction.AccountServiceImpl.*(..))"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">id</span>=<span class="string">"pointcut1"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 通用事务通知 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"transfer*"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"find*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"query*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"list*"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"do*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"Exception"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"save*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"Exception"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"insert*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"Exception"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"update*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"Exception"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"delete*"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">rollback-for</span>=<span class="string">"Exception"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如上所示，在定义通知(tx:advice)时需要依赖事务管理器。</p>
<p>tx:method的name属性定义了受事务控制的方法名称，可以使用通配符“*”来进行模糊匹配；read-only标识了该方法的事务是否是只读事务；propagation定义事务的传播机制；rollback-for定义那些异常进行回滚；另外还有timeout、no-rollback-for、isolation等属性配置，分别对应事务的超时时间、不会滚异常、隔离级别等。</p>
<p>aop:config标签进行了aop相关的配置，aop:advisor引用了通知，并定义了事务作用的切点，其采用AspectJ的切入点表达式。关于AOP的配置这里不再赘述</p>
<h3 id="使用注解配置事务"><a href="#使用注解配置事务" class="headerlink" title="使用注解配置事务"></a>使用注解配置事务</h3><p>除了XML进行声明式事务配置外，还可以采用@Transactional注解来进行事务配置，该注解定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Transactional &#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">    <span class="comment">// 事务传播机制</span></span><br><span class="line">	<span class="function">Propagation <span class="title">propagation</span><span class="params">()</span> <span class="keyword">default</span> Propagation.REQUIRED</span>;</span><br><span class="line">    <span class="comment">// 事务的隔离级别</span></span><br><span class="line">	<span class="function">Isolation <span class="title">isolation</span><span class="params">()</span> <span class="keyword">default</span> Isolation.DEFAULT</span>;</span><br><span class="line">    <span class="comment">// 事务超时时间</span></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">timeout</span><span class="params">()</span> <span class="keyword">default</span> TransactionDefinition.TIMEOUT_DEFAULT</span>;</span><br><span class="line">    <span class="comment">// 事务是否只读</span></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">readOnly</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">    <span class="comment">// 定义使事务回滚的异常类</span></span><br><span class="line">	Class&lt;? extends Throwable&gt;[] rollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    <span class="comment">// 定义使事务回滚的异常类名称</span></span><br><span class="line">	String[] rollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    <span class="comment">// 定义不使异常回滚的异常类</span></span><br><span class="line">	Class&lt;? extends Throwable&gt;[] noRollbackFor() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    <span class="comment">// 定义不使异常回滚的异常类名称</span></span><br><span class="line">	String[] noRollbackForClassName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置事务管理器"><a href="#配置事务管理器" class="headerlink" title="配置事务管理器"></a>配置事务管理器</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--JDBC事务管理器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="开启注解事务支持"><a href="#开启注解事务支持" class="headerlink" title="开启注解事务支持"></a>开启注解事务支持</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个配置告诉Spring，检查所管理的配置了@Transactional注解的bean，并为它们添加事务通知</p>
<h4 id="在代码中使用注解"><a href="#在代码中使用注解" class="headerlink" title="在代码中使用注解"></a>在代码中使用注解</h4><p>@Transactional注解可以用于类和方法上，用于类上表示事务定义应用于该类的所有方法，用于方法则表示单独定义该方法的事务控制属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法受事务控制，而且抛出RuntimeException，事务回滚，无法插入数据</span></span><br><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tryInsert</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">    <span class="comment">// 模拟抛出异常，事务回滚</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">"hahaha"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法不受事务控制，可以正常插入数据</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tryInsert</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">    <span class="comment">// 模拟抛出异常，事务回滚</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"hahaha"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法受事务控制，但是抛出的是Exception，默认不会滚，可以正常插入数据</span></span><br><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED)</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tryInsert</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">    <span class="comment">// 模拟抛出异常，事务回滚</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"hahaha"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用于类上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(propagation = Propagation.SUPPORTS, readOnly = <span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>告诉Spring，UserServiceImpl这个bean下的所有方法都可以支持事务，传播机制为SUPPORTS，默认都是只读事务。当然，如果方法上定义了事务，会采用方法的事务设置，遵循就近原则</p>
<p>在查找事务相关问题时，将Spring日志级别设定为DEBUG，就可以清楚的看到事务相关的日志信息，便于调试问题</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>可以从传播机制、隔离级别、是否只读、事务超时、回滚规则等方面来描述事务。Spring提供了xml和注解两者事务声明方式：</p>
<p>采用xml：需要使用tx命名空间，好处是在xml中完成事务定义，代码中不需要做任何事务相关的编码；但是，事务控制的方法名称需要遵循一定的规则，一遍Spring能够匹配到并为其加入事务通知。</p>
<p>采用注解：xml仅需一行配置，其他的事务控制都可以通过编码加上注解实现，而且对方法名称没有要求；如果整个应用不需要事务控制，取消xml配置即可。</p>
</div><div class="tags"><a href="/tags/Spring/">Spring</a></div><div class="post-share"></div><div class="post-nav"><a href="/2019/07/28/2019-20190728-Java匿名内部类访问外部变量，为何需被标志为final/" class="pre">Java匿名内部类访问外部变量，为何需被标志为final</a><a href="/2019/07/22/2019-20190721-Spring的JDBC的模板的使用/" class="next">Spring的JDBC的模板的使用</a></div><div id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC80NDg2NC8yMTM4NQ=="></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#事务"><span class="toc-text">事务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是事务"><span class="toc-text">什么是事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事务特性"><span class="toc-text">事务特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#读问题"><span class="toc-text">读问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#写问题-了解"><span class="toc-text">写问题(了解)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring的事务管理的API"><span class="toc-text">Spring的事务管理的API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PlatformTransactionManager-平台事物管理器"><span class="toc-text">PlatformTransactionManager:平台事物管理器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TransactionDefinition-事务定义信息"><span class="toc-text">TransactionDefinition:事务定义信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TransactionStatus-事务的状态"><span class="toc-text">TransactionStatus:事务的状态</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#搭建Spring的事务管理的环境"><span class="toc-text">搭建Spring的事务管理的环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring的事务管理"><span class="toc-text">Spring的事务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#常见的事务管理器"><span class="toc-text">常见的事务管理器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#方式一-编程式事务-需要手动编写代码"><span class="toc-text">方式一:编程式事务(需要手动编写代码)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置平台事务管理器"><span class="toc-text">配置平台事务管理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置事务管理的模板类"><span class="toc-text">配置事务管理的模板类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在业务层注入事务管理的模板"><span class="toc-text">在业务层注入事务管理的模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编写事务管理的代码"><span class="toc-text">编写事务管理的代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#方式二-声明式事务"><span class="toc-text">方式二:声明式事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#事务属性"><span class="toc-text">事务属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#事务的传播行为"><span class="toc-text">事务的传播行为</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#隔离级别"><span class="toc-text">隔离级别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#是否只读"><span class="toc-text">是否只读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#超时时间"><span class="toc-text">超时时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#回滚规则"><span class="toc-text">回滚规则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XML配置事务"><span class="toc-text">XML配置事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置命名空间"><span class="toc-text">配置命名空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建事务的规则"><span class="toc-text">创建事务的规则</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用注解配置事务"><span class="toc-text">使用注解配置事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置事务管理器"><span class="toc-text">配置事务管理器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#开启注解事务支持"><span class="toc-text">开启注解事务支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#在代码中使用注解"><span class="toc-text">在代码中使用注解</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/09/24/电商数仓每个层级表的依赖关系/">电商数仓每个层级表的依赖关系</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/15/2020-20200915-Kafka工作流程分析/">Kafka工作流程分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/15/2020-20200914-JUC之Semaphore信号灯/">JUC之Semaphore信号灯</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/15/2020-20200914-JUC之CyclicBarrier循环栅栏/">JUC之CyclicBarrier循环栅栏</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/15/2020-20200914-JUC之CountDownLatch减少计数/">JUC之CountDownLatch减少计数</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/14/2020-20200914-Druid-Kylin-Presto-Impala-SparkSQL-ES比较/">Druid-Kylin-Presto-Impala-SparkSQL-ES比较</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/01/2020-20200901-Linux下查询进程占用的内存方法总结/">Linux下查询进程占用的内存方法总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/29/2020-20200829-项目遇到的问题之Spark/">项目遇到的问题之Spark</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/28/2020-20200828-项目遇到的问题之Sqoop/">项目遇到的问题之Sqoop</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/26/2020-20200826-解决Github-Page无法访问的其中一种情况/">解决Github-Page无法访问的其中一种情况</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/BigData/">BigData</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Eclipse/">Eclipse</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Excel/">Excel</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">108</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/">Javascript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tampermonkey/">Tampermonkey</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ubuntu/">Ubuntu</a><span class="category-list-count">50</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vim/">vim</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/人工智能/">人工智能</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构与算法/">数据结构与算法</a><span class="category-list-count">40</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/">未分类</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/正则表达式/">正则表达式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/视频笔记/">视频笔记</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机操作系统/">计算机操作系统</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机组成原理/">计算机组成原理</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Servlet/" style="font-size: 15px;">Servlet</a> <a href="/tags/项目复盘/" style="font-size: 15px;">项目复盘</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Junit/" style="font-size: 15px;">Junit</a> <a href="/tags/Ubuntu装机日志/" style="font-size: 15px;">Ubuntu装机日志</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/Linux命令/" style="font-size: 15px;">Linux命令</a> <a href="/tags/Hadoop/" style="font-size: 15px;">Hadoop</a> <a href="/tags/项目遇到的问题/" style="font-size: 15px;">项目遇到的问题</a> <a href="/tags/Jackson/" style="font-size: 15px;">Jackson</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/vim/" style="font-size: 15px;">vim</a> <a href="/tags/Eclipse/" style="font-size: 15px;">Eclipse</a> <a href="/tags/Eclipse插件/" style="font-size: 15px;">Eclipse插件</a> <a href="/tags/JUC/" style="font-size: 15px;">JUC</a> <a href="/tags/MySql/" style="font-size: 15px;">MySql</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/SpringMVC/" style="font-size: 15px;">SpringMVC</a> <a href="/tags/Kafka/" style="font-size: 15px;">Kafka</a> <a href="/tags/Lombok/" style="font-size: 15px;">Lombok</a> <a href="/tags/BigData/" style="font-size: 15px;">BigData</a> <a href="/tags/Tomcat/" style="font-size: 15px;">Tomcat</a> <a href="/tags/Java细节/" style="font-size: 15px;">Java细节</a> <a href="/tags/Thymeleaf/" style="font-size: 15px;">Thymeleaf</a> <a href="/tags/Linux配置/" style="font-size: 15px;">Linux配置</a> <a href="/tags/Http/" style="font-size: 15px;">Http</a> <a href="/tags/JSP-EL-JSTL/" style="font-size: 15px;">JSP/EL/JSTL</a> <a href="/tags/Struts2/" style="font-size: 15px;">Struts2</a> <a href="/tags/Hibernate/" style="font-size: 15px;">Hibernate</a> <a href="/tags/OGNL/" style="font-size: 15px;">OGNL</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/SSH/" style="font-size: 15px;">SSH</a> <a href="/tags/MyBatis/" style="font-size: 15px;">MyBatis</a> <a href="/tags/人工智能/" style="font-size: 15px;">人工智能</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/Zookeeper/" style="font-size: 15px;">Zookeeper</a> <a href="/tags/Flume/" style="font-size: 15px;">Flume</a> <a href="/tags/Jquery/" style="font-size: 15px;">Jquery</a> <a href="/tags/SpringSecurity/" style="font-size: 15px;">SpringSecurity</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/计算机组成原理/" style="font-size: 15px;">计算机组成原理</a> <a href="/tags/Excel/" style="font-size: 15px;">Excel</a> <a href="/tags/Ubuntu配置/" style="font-size: 15px;">Ubuntu配置</a> <a href="/tags/视频笔记/" style="font-size: 15px;">视频笔记</a> <a href="/tags/数据结构与算法-Java实现/" style="font-size: 15px;">数据结构与算法(Java实现)</a> <a href="/tags/Tampermonkey/" style="font-size: 15px;">Tampermonkey</a> <a href="/tags/Sqoop/" style="font-size: 15px;">Sqoop</a> <a href="/tags/Spark/" style="font-size: 15px;">Spark</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">97</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">93</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a><span class="archive-list-count">36</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017</a><span class="archive-list-count">37</span></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p><span> Copyright &copy;<a href="/." rel="nofollow">zjc.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=2.0.5"></script><div id="fullscreen-img" class="hide"><span class="close"></span></div><script type="text/javascript" src="/js/imgview.js?v=2.0.5" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.5" async></script><script>(function(d, s) {
  var j, e = d.getElementsByTagName('body')[0];
  if (typeof LivereTower === 'function') { return; }
  j = d.createElement(s);
  j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
  j.async = true;
  e.appendChild(j);
})(document, 'script');
</script></body></html>