#   Java匿名内部类访问外部变量，为何需被标志为final

---

#	final关键字有什么用

对于Java语言中的final使用，大家应该很熟悉:
1.	可以修饰类，表示不可继承；
2.	可以修饰方法，表示不可被子类重写；
3.	可以修饰变量，表示不可以被二次赋值

#	Java匿名内部类访问外部变量，为何需被标志为final？这跟上述三个特性有关系吗？

##	问题的提出

例如有如下代码

```java
// 在方法中使用匿名内部类
public void initListener(Button btn ){
	//必须标记为final
	final int name = "zhangsan";

	btn.setOnClickListener(new View.OnClickListener() {
		@Override
		public void onClick(View v) {
			btn.setText(name); //动态改变按钮的文字
		}
	});
}
```

**为何name变量需被标志为final？**这深层次的原因是什么？为什么有这样一个让人摸不着头脑的规定？

##	解释

+ [_Java中的闭包_](/2019/20190728-Java中的闭包)
+   匿名内部类在方法里面,也就是说,内部类和外部方法形成一个闭包,也就是说内部类能够访问外部方法的变量
+   **由于匿名内部类的生命周期有可能比外部的方法要长,所以有可能出现外部变量访问不到的情况**
+   解决这个问题很简单,就是将外部方法的变量复制一份给匿名内部类,这样即使外部方法"死了",内部类还是能拿到变量
+   这样会产生新的问题,那就是当我们在内部类修改了外部变量的值时,由于内部类修改的是"复制品",就会造成和外部变量不一致的情况
+   那怎么办?**不让改就好了**,所以外部变量要使用final关键字,告诉内部类这个变量是不允许改的
