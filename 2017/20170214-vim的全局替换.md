---
title: vim的全局替换
description: vim的普通替换及上下文替换
date: 2017-02-14 20:27:10
categories:
- vim
tags:
- vim
---
#   来源
[vim的全局替换](https://blog.csdn.net/shuangde800/article/details/10554513)

#   替换命令的基本语法
+   在全局替换中，ex编辑器使用指定的字符模式对文件中的每行进行检查。在所有行中发现模式的位置，ex使用新字符串来替换模式。
+   全局替换真正使用的是两个ex命令是`:g（global全局）`和`:s（switch替换）`。

##  不带任何参数
替换命令的语法如下:
```
#   命令中空格不是必须的
:s / old / new /  
```
+   这将把**当前中模式old的`第一次出现`修改为new**。
+   `/（斜杆）`是命令不同部分之间的分隔符（当斜杆为该行的最后一个字符时，可不写）

##  行尾添加参数g -> 当前行old的每次出现改为new
下面这种形式的替换命令:
```
:s / old / new / g
```
+   把**当前行old的`每次`出现改为new**，而不只是该行的第一个old。
+   :s命令允许替换串后面带有选项，上面语法中的g代表全局（g选项影响一行中的每个模式，不要把它与影响文件中所有行的:g命令混淆）

##  行首添加范围 -> 指定替换范围
通过在:s命令前加上地址前缀，可以把它的范围扩展到多行。例如下面命令把50行到100行的old的每次出现都改为new:
```
:50, 100 s / old / new / g
```

下面的命令把整个文件中的old的每次出现都改为new:
```
:1, $s / old / new / g
```
我们知道%等价于1，$，所以上行命令也可以这样写:
```
:% s / old / new / g
```

##  行尾添加参数c -> 替换前确认

+   使用搜索替换命令有时候会出错，而得到不想要的结果。所以小心并确认文件中需要修改的内容是一个明智的做法
+   在替换命令尾部加上c (confirm用于确认)，在替换每个old前都会提示并确认:

语法如下
```
:1, 30 s /old/new/ gc
```
-> 将会出现提示replace with hehe (y/n/a/q/l/^E/^Y)?  
+   y替换
+   n不替换
+   a替换所有
+   q放弃
+   l替换第一个并进入插入模式
+   ^E和^Y是提示你用Ctrl+e或Ctrl+y来滚动屏幕的。

#   上下文相关替换
+   除了直接使用一个单词（或短语）替换另一个，还有稍微复杂的全局替换语法。这些语法可以对一个模式进行搜索，一旦找到含有模式的行，就可以使用不同与模式的串进行替换，我们把这种替换叫做上下文相关替换。

语法格式如下:
```
:g /pattern/s/old/new/g    将会把包含pattern的行中，把所有old替换为new
```
+   第一个g表示是在文件的所有行上执行的命令，模式pattern识别要发生替换的行。
+   在那些包含模式pattern的行上，ex将把old替换（s）为new。最后的g表示在该行上进行全部替换。

如果用来进行搜索的模式与想要修改的模式相同，那么就不必重复它:
```
:g/string/s//new/g  等价于  :g/string/s/string/new/g
```
还要注意:
```
:g/string/s//new/g  也等价于 :% s/string/new/g
```
可以用第二种方式少输一些字符
