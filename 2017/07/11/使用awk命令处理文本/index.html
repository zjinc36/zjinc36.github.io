<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.5"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.5"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><title>使用Awk命令处理文本 | 想了20分钟的博客名</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">使用Awk命令处理文本</h1><a id="logo" href="/.">想了20分钟的博客名</a><p class="description">世界是唯物辩证的</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">使用Awk命令处理文本</h1><div class="post-meta"><a href="/2017/07/11/使用awk命令处理文本/#comments" class="comment-count"></a><p><span class="date">Jul 11, 2017</span><span><a href="/categories/Ubuntu/" class="category">Ubuntu</a></span></p></div><div class="post-content"><h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><ol>
<li><p>使用awk批量修改文件名</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">   命令</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   将01_abc_def文件名变更为0100_abc_def文件名</span></span><br><span class="line">ll | awk '&#123;print $9&#125;' | awk -F '_' '&#123;if ($1 * 100 &lt; 3901 &amp;&amp; $1 * 100 &gt; 1)&#123;if ($3)&#123;printf("mv %s \t %s \n", $0, $1 "00_"$2 "_"$3)&#125; else &#123;printf("mv %s \t %s \n", $0, $1 "00_"$2)&#125;&#125;&#125;' | sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   稍微分解一下</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   查看所有文件</span></span><br><span class="line">ll</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取文件名列</span></span><br><span class="line">awk '&#123;print $9&#125;'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 处理文本,得到<span class="string">"mv 01_abc_def 0100_abc_def"</span>语句</span></span><br><span class="line">awk -F '_' '&#123;if ($1 * 100 &lt; 3901 &amp;&amp; $1 * 100 &gt; 1)&#123;if ($3)&#123;printf("mv %s \t %s \n", $0, $1 "00_"$2 "_"$3)&#125; else &#123;printf("mv %s \t %s \n", $0, $1 "00_"$2)&#125;&#125;&#125;'</span><br><span class="line"><span class="meta">#</span><span class="bash"> ====&gt; 相当与 &lt;====</span></span><br><span class="line">awk -F '_' # 分割字符串,分割符为'_'</span><br><span class="line">&#123;</span><br><span class="line">    if ($1 * 100 &lt; 3901 &amp;&amp; $1 * 100 &gt; 1) &#123;  # 排除一些不需要修改的</span><br><span class="line">        if ($3) &#123;   # 当第三列存在时</span><br><span class="line">            printf("mv %s \t %s \n", $0, $1 "00_"$2 "_"$3)  # 拼接字符串用双引号将要拼接的字符串引起来</span><br><span class="line">        &#125; else &#123;    # 当第三列不存在时</span><br><span class="line">            printf("mv %s \t %s \n", $0, $1 "00_"$2)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sh  # 执行前面的文本</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 awk 过滤 history 输出，找到最常用的命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">history | awk '&#123;a[$2]++&#125;END&#123;for(i in a)&#123;print a[i] " " i&#125;&#125;' | sort -rn | head</span><br></pre></td></tr></table></figure>
</li>
<li><p>过滤文件中重复行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk '!x[$0]++' &lt;file&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>将一行长度超过 72 字符的行打印</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'length&gt;72' file</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看最近哪些用户使用系统</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">last | grep -v "^$" | awk '&#123; print $1 &#125;' | sort -nr | uniq -c</span><br></pre></td></tr></table></figure>
</li>
<li><p>假设有一个文本，每一行都是一个 int 数值，想要计算这个文件每一行的和，可以使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;s+=$1&#125; ENG &#123;printf "%.0f", s&#125;' /path/to/file</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="调用awk"><a href="#调用awk" class="headerlink" title="调用awk"></a>调用awk</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.命令行方式</span><br><span class="line">awk [-F  field-separator]  &apos;commands&apos;  input-file(s)</span><br><span class="line">其中，commands 是真正awk命令，[-F域分隔符]是可选的。 input-file(s) 是待处理的文件。</span><br><span class="line">在awk中，文件的每一行中，由域分隔符分开的每一项称为一个域。通常，在不指名-F域分隔符的情况下，默认的域分隔符是空格。</span><br><span class="line"></span><br><span class="line">2.shell脚本方式</span><br><span class="line">将所有的awk命令插入一个文件，并使awk程序可执行，然后awk命令解释器作为脚本的首行，一遍通过键入脚本名称来调用。</span><br><span class="line">相当于shell脚本首行的：#!/bin/sh</span><br><span class="line">可以换成：#!/bin/awk</span><br><span class="line"></span><br><span class="line">3.将所有的awk命令插入一个单独文件，然后调用：</span><br><span class="line">awk -f awk-script-file input-file(s)</span><br><span class="line">其中，-f选项加载awk-script-file中的awk脚本，input-file(s)跟上面的是一样的。</span><br></pre></td></tr></table></figure>

<h1 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h1><h2 id="基本格式"><a href="#基本格式" class="headerlink" title="基本格式"></a>基本格式</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk [options] 'script' file</span><br></pre></td></tr></table></figure>

<h2 id="awk-同时处理多个文件"><a href="#awk-同时处理多个文件" class="headerlink" title="awk 同时处理多个文件"></a>awk 同时处理多个文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;print FILENAME "\t" $0&#125;' demo1.txt demo2.txt</span><br></pre></td></tr></table></figure>

<h2 id="awk-自定义分隔符"><a href="#awk-自定义分隔符" class="headerlink" title="awk 自定义分隔符"></a>awk 自定义分隔符</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">awk -F ':' '&#123;print $1&#125;' /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> nectarine(200g)2008 -&gt; nectarine 200g 2008</span></span><br><span class="line">awk -F '[()]' '&#123;print $1, $2, $3&#125;' some.log</span><br></pre></td></tr></table></figure>

<ul>
<li>awk 默认的分割符为空格和制表符</li>
<li>分割后的字段依次用 $1, $2,$3 来表示</li>
<li>$0 表示字符串本身</li>
<li>在 -F 参数中使用一对方括号来指定多个分隔符，awk 处理 some.log 文件时就会使用 “(“ 或者 “)” 来对文件的每一行进行分割</li>
</ul>
<h2 id="在-awk-中使用正则表达式"><a href="#在-awk-中使用正则表达式" class="headerlink" title="在 awk 中使用正则表达式"></a>在 awk 中使用正则表达式</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">   待匹配文本</span></span><br><span class="line">This above all: to thine self be true</span><br><span class="line">There is nothing either good or bad, but thinking makes it so</span><br><span class="line">There’s a special providence in the fall of a sparrow</span><br><span class="line">No matter how dark long, may eventually in the day arrival</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   匹配字符串 “There” ，将包含这个字符串的行打印并输出</span></span><br><span class="line">awk '/There/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line">There is nothing either good or bad, but thinking makes it so</span><br><span class="line">There’s a special providence in the fall of a sparrow</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   匹配一个包含字母 t 和字母 e 并且 t 和 e 中间只能有任意单个字符的行</span></span><br><span class="line">awk '/t.e/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line">There is nothing either good or bad, but thinking makes it so</span><br><span class="line">There’s a special providence in the fall of a sparrow</span><br><span class="line">No matter how dark long, may eventually in the day arrival</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   以 “The” 字符串开头的行</span></span><br><span class="line">awk '/^The/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   以 “<span class="literal">true</span>” 字符串结尾的行</span></span><br><span class="line">awk '/true$/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   /s[a-z]/ 表示匹配包含字符 s 然后后面跟着任意 a 到 z 之间的单个字符的字符串</span></span><br><span class="line">awk '/s[a-z]/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">     字母 <span class="string">"o"</span> 只能可以出现 2 次，3 次，4 次，5 次，6 次 ... 一直到 10 次</span></span><br><span class="line">awk '/go&#123;2,10&#125;d/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   字母 <span class="string">"o"</span> 必须至少出现 2 次或着 2 次以上</span></span><br><span class="line">awk '/go&#123;2,&#125;d/&#123;print $0&#125;' poetry.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">   星号表示字符匹配 0 次或者多次</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   加号表示字符匹配 1 个或者 1 个以上</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   问号字符只能出现 0 次 或者 1 次</span></span><br><span class="line">awk '/go*d/&#123;print $0&#125;' poetry.txt</span><br><span class="line">awk '/go+d/&#123;print $0&#125;' poetry.txt</span><br><span class="line">awk '/go?d/&#123;print $0&#125;' poetry.txt</span><br></pre></td></tr></table></figure>

<h2 id="使用-AWK-移除行中特定模式"><a href="#使用-AWK-移除行中特定模式" class="headerlink" title="使用 AWK 移除行中特定模式"></a>使用 AWK 移除行中特定模式</h2><p>文件中有行数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/abc/def/123 456</span><br><span class="line">/abc/def/222 456</span><br></pre></td></tr></table></figure>

<p>想要移除 123，保留之前的字母和后面的数字，则可以使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'sub(/[0-9]+/,"",$1)' /path/to/file</span><br></pre></td></tr></table></figure>

<h2 id="print和printf"><a href="#print和printf" class="headerlink" title="print和printf"></a>print和printf</h2><ul>
<li>awk中同时提供了print和printf两种打印输出的函数。</li>
<li>print函数的参数可以是变量、数值或者字符串。字符串必须用双引号引用，参数用逗号分隔。如果没有逗号，参数就串联在一起而无法区分。这里，逗号的作用与输出文件的分隔符的作用是一样的，只是后者是空格而已</li>
<li>printf函数，其用法和c语言中printf基本相似,可以格式化字符串,输出复杂时，printf更加好用，代码更易懂</li>
</ul>
<h1 id="awk-编程"><a href="#awk-编程" class="headerlink" title="awk 编程"></a>awk 编程</h1><h2 id="BEGIN-和-END-关键字的使用"><a href="#BEGIN-和-END-关键字的使用" class="headerlink" title="BEGIN 和 END 关键字的使用"></a>BEGIN 和 END 关键字的使用</h2><ul>
<li>BEGIN:会在开始读取一个文件之前，运行一次 BEGIN 关键字后面的脚本代码段</li>
<li>END:读取并且处理完文件的所有内容行之后，才会执行 END 后面的脚本代码段</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd |awk  -F ':'  'BEGIN &#123;print "name,shell"&#125;  &#123;print $1","$7&#125; END &#123;print "blue,/bin/nosh"&#125;'</span><br><span class="line">name,shell  # BEGIN多这一行</span><br><span class="line">root,/bin/bash</span><br><span class="line">daemon,/bin/sh</span><br><span class="line">bin,/bin/sh</span><br><span class="line">sys,/bin/sh</span><br><span class="line">....</span><br><span class="line">blue,/bin/nosh # END多这一行</span><br></pre></td></tr></table></figure>

<h2 id="在-awk-中使用变量"><a href="#在-awk-中使用变量" class="headerlink" title="在 awk 中使用变量"></a>在 awk 中使用变量</h2><h3 id="可以在-awk-脚本中声明和使用变量"><a href="#可以在-awk-脚本中声明和使用变量" class="headerlink" title="可以在 awk 脚本中声明和使用变量"></a>可以在 awk 脚本中声明和使用变量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;msg="hello world"; print msg&#125;' /etc/passwd</span><br></pre></td></tr></table></figure>

<p>awk 声明的变量可以在任何多个花括号脚本中使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 'BEGIN &#123;msg="hello world"&#125; &#123;print msg&#125;' /etc/passwd</span><br></pre></td></tr></table></figure>

<p>在 awk 中使用数学运算，在 awk 中，像其他编程语言一样，它也支持一些基本的数学运算操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;a = 12; b = 24; print a + b&#125;' company.txt</span><br></pre></td></tr></table></figure>

<p>上面这段脚本表示，先声明两个变量 a = 12 和 b = 24，然后用 print 打印出 a 加上 b 的结果<br>awk 还支持其他的数学运算符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ 加法运算符</span><br><span class="line">- 减法运算符</span><br><span class="line">* 乘法运算符</span><br><span class="line">/ 除法运算符</span><br><span class="line">% 取余运算符</span><br></pre></td></tr></table></figure>

<h3 id="awk-内置变量的使用"><a href="#awk-内置变量的使用" class="headerlink" title="awk 内置变量的使用"></a>awk 内置变量的使用</h3><ul>
<li><p>0这个表示文本处理时的当前行，1 表示文本行被分隔后的第 1 个字段列，2表示文本行被分割后的第2个字段列，3 表示文本行被分割后的第 3 个字段列，$n 表示文本行被分割后的第 n 个字段列</p>
</li>
<li><p>NR 表示文件中的行号，表示当前是第几行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;print NR "\t" $0&#125;' fruit.txt</span><br><span class="line"></span><br><span class="line">1   peach    100   Mar  1997   China</span><br><span class="line">2   Lemon    150   Jan  1986   America</span><br><span class="line">3   Pear     240   Mar  1990   Janpan</span><br><span class="line">4   avocado  120   Feb  2008   china</span><br></pre></td></tr></table></figure>
</li>
<li><p>NF 表示文件中的当前行被分割的列数，可以理解为 MySQL 数据表里面每一条记录有多少个字段，所以 NF就表示最后一个字段，(NF-1) 就表示倒数第二个字段</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">awk '&#123;print NF "\t" $0&#125;' fruit.txt</span><br><span class="line"></span><br><span class="line">5   peach    100   Mar  1997   China</span><br><span class="line">5   Lemon    150   Jan  1986   America</span><br><span class="line">5   Pear     240   Mar  1990   Janpan</span><br><span class="line">5   avocado  120   Feb  2008   china</span><br><span class="line"></span><br><span class="line">awk '&#123;print $(NF - 1)&#125;' fruit.txt</span><br><span class="line"></span><br><span class="line">1997</span><br><span class="line">1986</span><br><span class="line">1990</span><br><span class="line">2008</span><br><span class="line"></span><br><span class="line">awk 'NR % 6'        # 打印出了 6 倍数行之外的其他行</span><br><span class="line">awk 'NR &gt; 5'        # 打印第 5 行之后内容，类似 `tail -n +6` 或者 `sed '1,5d'`</span><br><span class="line">awk 'NF &gt;= 6'       # 打印大于等于 6 列的行</span><br><span class="line">awk '/foo/ &amp;&amp; /bar/'    # 打印匹配 `/foo/` 和 `/bar/` 的行</span><br><span class="line">awk '/foo/ &amp;&amp; !/bar/'   # 打印包含 `/foo/` 不包含 `/bar/` 的行</span><br><span class="line">awk '/foo/ || /bar/'    # 或</span><br><span class="line">awk '/foo/,/bar/'       # 打印从匹配 `/foo/` 开始的行到 `/bar/` 的行，包含这两行</span><br></pre></td></tr></table></figure>
</li>
<li><p>FS 表示 awk 的输入分隔符，默认分隔符为空格和制表符，可以对其进行自定义设置</p>
</li>
<li><p>OFS 表示 awk 的输出分隔符，默认为空格，也可以对其进行自定义设置</p>
</li>
<li><p>FILENAME 表示当前文件的文件名称，如果同时处理多个文件，它也表示当前文件名称</p>
</li>
<li><p>RS 行分隔符，用于分割行，默认为换行符</p>
</li>
<li><p>ORS 输出记录的分隔符，默认为换行符</p>
</li>
</ul>
<h2 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h2><p>awk中的条件语句是从C语言中借鉴来的，见如下声明方式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">if (expression) &#123;</span><br><span class="line">    statement;</span><br><span class="line">    statement;</span><br><span class="line">    ... ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (expression) &#123;</span><br><span class="line">    statement;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    statement2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (expression) &#123;</span><br><span class="line">    statement1;</span><br><span class="line">&#125; else if (expression1) &#123;</span><br><span class="line">    statement2;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    statement3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>统计某个文件夹下的文件占用的字节数,过滤4096大小的文件(一般都是文件夹):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -l |awk &apos;BEGIN &#123;size=0;print &quot;[start]size is &quot;, size&#125; &#123;if($5!=4096)&#123;size=size+$5;&#125;&#125; END&#123;print &quot;[end]size is &quot;, size/1024/1024,&quot;M&quot;&#125;&apos; </span><br><span class="line">[end]size is  8.22339 M</span><br></pre></td></tr></table></figure>

<h2 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h2><p>awk中的循环语句同样借鉴于C语言，支持while、do/while、for、break、continue，这些关键字的语义和C语言中的语义完全相同。</p>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>因为awk中数组的下标可以是数字和字母，数组的下标通常被称为关键字(key)。值和关键字都存储在内部的一张针对key/value应用hash的表格里。由于hash不是顺序存储，因此在显示数组内容时会发现，它们并不是按照你预料的顺序显示出来的。数组和变量一样，都是在使用时自动创建的，awk也同样会自动判断其存储的是数字还是字符串。一般而言，awk中的数组用来从记录中收集信息，可以用于计算总和、统计单词以及跟踪模板被匹配的次数等等。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">   显示/etc/passwd的账户</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   这里使用<span class="keyword">for</span>循环遍历数组</span></span><br><span class="line">awk -F ':' 'BEGIN &#123;count=0;&#125; &#123;name[count] = $1;count++;&#125;; END&#123;for (i = 0; i &lt; NR; i++) print i, name[i]&#125;' /etc/passwd</span><br><span class="line">0 root</span><br><span class="line">1 daemon</span><br><span class="line">2 bin</span><br><span class="line">3 sys</span><br><span class="line">4 sync</span><br><span class="line">5 games</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h2 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h2><ul>
<li>toupper() 用于将字符转为大写</li>
<li>tolower() 将字符转为小写</li>
<li>length() 长度</li>
<li>substr() 子字符串</li>
<li>sin() 正弦</li>
<li>cos() 余弦</li>
<li>sqrt() 平方根</li>
<li>rand() 随机数</li>
</ul>
<p>更多的方法可以参考：man awk</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li><a href="http://www.gnu.org/software/gawk/manual/gawk.html" target="_blank" rel="noopener">http://www.gnu.org/software/gawk/manual/gawk.html</a></li>
<li><a href="https://www.cnblogs.com/ggjucheng/archive/2013/01/13/2858470.html" target="_blank" rel="noopener">linux awk命令详解</a></li>
<li><a href="http://einverne.github.io/post/2018/01/awk.html" target="_blank" rel="noopener">每天学习一个命令：awk 处理文本 </a></li>
</ol>
</div><div class="tags"><a href="/tags/Linux命令/">Linux命令</a></div><div class="post-share"></div><div class="post-nav"><a href="/2017/08/10/调整eclipse左边包的显示方式/" class="pre">调整Eclipse左边包的显示方式</a><a href="/2017/05/31/Vim全局命令g/" class="next">Vim全局命令g</a></div><div id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC80NDg2NC8yMTM4NQ=="></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#案例"><span class="toc-text">案例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#调用awk"><span class="toc-text">调用awk</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用说明"><span class="toc-text">使用说明</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#基本格式"><span class="toc-text">基本格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk-同时处理多个文件"><span class="toc-text">awk 同时处理多个文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awk-自定义分隔符"><span class="toc-text">awk 自定义分隔符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在-awk-中使用正则表达式"><span class="toc-text">在 awk 中使用正则表达式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-AWK-移除行中特定模式"><span class="toc-text">使用 AWK 移除行中特定模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#print和printf"><span class="toc-text">print和printf</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#awk-编程"><span class="toc-text">awk 编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#BEGIN-和-END-关键字的使用"><span class="toc-text">BEGIN 和 END 关键字的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在-awk-中使用变量"><span class="toc-text">在 awk 中使用变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#可以在-awk-脚本中声明和使用变量"><span class="toc-text">可以在 awk 脚本中声明和使用变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#awk-内置变量的使用"><span class="toc-text">awk 内置变量的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#条件语句"><span class="toc-text">条件语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#循环语句"><span class="toc-text">循环语句</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数组"><span class="toc-text">数组</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内置函数"><span class="toc-text">内置函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考"><span class="toc-text">参考</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/08/02/Ubuntu20-04中安装flameshot截屏工具/">Ubuntu20.04中安装flameshot截屏工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/31/Ubuntu刷新DNS/">Ubuntu刷新DNS</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/28/循环冗余校验（CRC）算法/">循环冗余校验（CRC）算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/26/ubuntu中Rime输入法的安装和配置/">ubuntu中Rime输入法的安装和配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/26/Ubuntu18.04中ibus-sunpinyin的安装与设置/">ubuntu18.04中ibus-Sunpinyin的安装与设置</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/25/Ubuntu设置开机自动加-挂载硬盘/">Ubuntu设置开机自动加/挂载硬盘</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/18/Ubuntu18-04如何固定图标到任务栏/">Ubuntu18.04如何固定图标到任务栏</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/11/Ubuntu中批量下载bilibili网站的视频/">Ubuntu中批量下载bilibili网站的视频</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/08/Ubuntu中安装分区管理工具gparted/">Ubuntu中安装分区管理工具gparted</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/08/Ubuntu中基于Docker安装QQ和WeChat/">Ubuntu中基于Docker安装QQ和WeChat</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/BigData/">BigData</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Eclipse/">Eclipse</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Excel/">Excel</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">90</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/">Javascript</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tampermonkey/">Tampermonkey</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ubuntu/">Ubuntu</a><span class="category-list-count">47</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/vim/">vim</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/人工智能/">人工智能</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构与算法/">数据结构与算法</a><span class="category-list-count">40</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/">未分类</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/正则表达式/">正则表达式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/视频笔记/">视频笔记</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机操作系统/">计算机操作系统</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算机组成原理/">计算机组成原理</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Http/" style="font-size: 15px;">Http</a> <a href="/tags/Eclipse/" style="font-size: 15px;">Eclipse</a> <a href="/tags/vim/" style="font-size: 15px;">vim</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Ubuntu装机日志/" style="font-size: 15px;">Ubuntu装机日志</a> <a href="/tags/Linux命令/" style="font-size: 15px;">Linux命令</a> <a href="/tags/Spring/" style="font-size: 15px;">Spring</a> <a href="/tags/SpringMVC/" style="font-size: 15px;">SpringMVC</a> <a href="/tags/Java细节/" style="font-size: 15px;">Java细节</a> <a href="/tags/Thymeleaf/" style="font-size: 15px;">Thymeleaf</a> <a href="/tags/Lombok/" style="font-size: 15px;">Lombok</a> <a href="/tags/Linux配置/" style="font-size: 15px;">Linux配置</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Junit/" style="font-size: 15px;">Junit</a> <a href="/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/tags/BigData/" style="font-size: 15px;">BigData</a> <a href="/tags/Jackson/" style="font-size: 15px;">Jackson</a> <a href="/tags/Tomcat/" style="font-size: 15px;">Tomcat</a> <a href="/tags/Servlet/" style="font-size: 15px;">Servlet</a> <a href="/tags/Eclipse插件/" style="font-size: 15px;">Eclipse插件</a> <a href="/tags/Hibernate/" style="font-size: 15px;">Hibernate</a> <a href="/tags/JSP-EL-JSTL/" style="font-size: 15px;">JSP/EL/JSTL</a> <a href="/tags/Struts2/" style="font-size: 15px;">Struts2</a> <a href="/tags/OGNL/" style="font-size: 15px;">OGNL</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/MyBatis/" style="font-size: 15px;">MyBatis</a> <a href="/tags/人工智能/" style="font-size: 15px;">人工智能</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/Jquery/" style="font-size: 15px;">Jquery</a> <a href="/tags/SSH/" style="font-size: 15px;">SSH</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/SpringSecurity/" style="font-size: 15px;">SpringSecurity</a> <a href="/tags/Hadoop/" style="font-size: 15px;">Hadoop</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/Excel/" style="font-size: 15px;">Excel</a> <a href="/tags/视频笔记/" style="font-size: 15px;">视频笔记</a> <a href="/tags/Ubuntu配置/" style="font-size: 15px;">Ubuntu配置</a> <a href="/tags/计算机组成原理/" style="font-size: 15px;">计算机组成原理</a> <a href="/tags/数据结构与算法-Java实现/" style="font-size: 15px;">数据结构与算法(Java实现)</a> <a href="/tags/Tampermonkey/" style="font-size: 15px;">Tampermonkey</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">82</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">85</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017</a><span class="archive-list-count">35</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://lotabout.me/" title="三点水" target="_blank">三点水</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p><span> Copyright &copy;<a href="/." rel="nofollow">zjc.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=2.0.5"></script><div id="fullscreen-img" class="hide"><span class="close"></span></div><script type="text/javascript" src="/js/imgview.js?v=2.0.5" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.5" async></script><script>(function(d, s) {
  var j, e = d.getElementsByTagName('body')[0];
  if (typeof LivereTower === 'function') { return; }
  j = d.createElement(s);
  j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
  j.async = true;
  e.appendChild(j);
})(document, 'script');
</script></body></html>